import{c as y2,g as x2,H as Ow,A as v2}from"./admin-background-animations.js";function _C(){import.meta.url,import("_").catch(()=>1),async function*(){}().next()}var Fw={exports:{}};(function(S,t){(function(a,c){S.exports=c()})(y2,function(){var a,c,f;function _(r,E){if(!a)a=E;else if(!c)c=E;else{var k="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+a+")(sharedChunk); ("+c+")(sharedChunk); self.onerror = null;",P={};a(P),f=E(P),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(f.workerUrl=window.URL.createObjectURL(new Blob([k],{type:"text/javascript"})))}}_(["exports"],function(r){var E=1e-6,k=typeof Float32Array<"u"?Float32Array:Array;function P(n,e){var s=e[0],l=e[1],h=e[2],p=e[3],g=s*p-h*l;return g?(n[0]=p*(g=1/g),n[1]=-l*g,n[2]=-h*g,n[3]=s*g,n):null}function L(){var n=new k(9);return k!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function O(n,e){var s=e[0],l=e[1],h=e[2],p=e[3],g=e[4],x=e[5],w=e[6],T=e[7],I=e[8];return n[0]=g*I-x*T,n[1]=h*T-l*I,n[2]=l*x-h*g,n[3]=x*w-p*I,n[4]=s*I-h*w,n[5]=h*p-s*x,n[6]=p*T-g*w,n[7]=l*w-s*T,n[8]=s*g-l*p,n}function N(n,e,s){var l=e[0],h=e[1],p=e[2],g=e[3],x=e[4],w=e[5],T=e[6],I=e[7],M=e[8],R=s[0],B=s[1],V=s[2],q=s[3],Z=s[4],$=s[5],ne=s[6],ae=s[7],le=s[8];return n[0]=R*l+B*g+V*T,n[1]=R*h+B*x+V*I,n[2]=R*p+B*w+V*M,n[3]=q*l+Z*g+$*T,n[4]=q*h+Z*x+$*I,n[5]=q*p+Z*w+$*M,n[6]=ne*l+ae*g+le*T,n[7]=ne*h+ae*x+le*I,n[8]=ne*p+ae*w+le*M,n}function G(){var n=new k(16);return k!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n}function H(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Q(n,e){var s=e[0],l=e[1],h=e[2],p=e[3],g=e[4],x=e[5],w=e[6],T=e[7],I=e[8],M=e[9],R=e[10],B=e[11],V=e[12],q=e[13],Z=e[14],$=e[15],ne=s*x-l*g,ae=s*w-h*g,le=s*T-p*g,be=l*w-h*x,we=l*T-p*x,ke=h*T-p*w,Le=I*q-M*V,ze=I*Z-R*V,rt=I*$-B*V,Be=M*Z-R*q,st=M*$-B*q,ut=R*$-B*Z,nt=ne*ut-ae*st+le*Be+be*rt-we*ze+ke*Le;return nt?(n[0]=(x*ut-w*st+T*Be)*(nt=1/nt),n[1]=(h*st-l*ut-p*Be)*nt,n[2]=(q*ke-Z*we+$*be)*nt,n[3]=(R*we-M*ke-B*be)*nt,n[4]=(w*rt-g*ut-T*ze)*nt,n[5]=(s*ut-h*rt+p*ze)*nt,n[6]=(Z*le-V*ke-$*ae)*nt,n[7]=(I*ke-R*le+B*ae)*nt,n[8]=(g*st-x*rt+T*Le)*nt,n[9]=(l*rt-s*st-p*Le)*nt,n[10]=(V*we-q*le+$*ne)*nt,n[11]=(M*le-I*we-B*ne)*nt,n[12]=(x*ze-g*Be-w*Le)*nt,n[13]=(s*Be-l*ze+h*Le)*nt,n[14]=(q*ae-V*be-Z*ne)*nt,n[15]=(I*be-M*ae+R*ne)*nt,n):null}function ee(n,e,s){var l=e[0],h=e[1],p=e[2],g=e[3],x=e[4],w=e[5],T=e[6],I=e[7],M=e[8],R=e[9],B=e[10],V=e[11],q=e[12],Z=e[13],$=e[14],ne=e[15],ae=s[0],le=s[1],be=s[2],we=s[3];return n[0]=ae*l+le*x+be*M+we*q,n[1]=ae*h+le*w+be*R+we*Z,n[2]=ae*p+le*T+be*B+we*$,n[3]=ae*g+le*I+be*V+we*ne,n[4]=(ae=s[4])*l+(le=s[5])*x+(be=s[6])*M+(we=s[7])*q,n[5]=ae*h+le*w+be*R+we*Z,n[6]=ae*p+le*T+be*B+we*$,n[7]=ae*g+le*I+be*V+we*ne,n[8]=(ae=s[8])*l+(le=s[9])*x+(be=s[10])*M+(we=s[11])*q,n[9]=ae*h+le*w+be*R+we*Z,n[10]=ae*p+le*T+be*B+we*$,n[11]=ae*g+le*I+be*V+we*ne,n[12]=(ae=s[12])*l+(le=s[13])*x+(be=s[14])*M+(we=s[15])*q,n[13]=ae*h+le*w+be*R+we*Z,n[14]=ae*p+le*T+be*B+we*$,n[15]=ae*g+le*I+be*V+we*ne,n}function ie(n,e,s){var l,h,p,g,x,w,T,I,M,R,B,V,q=s[0],Z=s[1],$=s[2];return e===n?(n[12]=e[0]*q+e[4]*Z+e[8]*$+e[12],n[13]=e[1]*q+e[5]*Z+e[9]*$+e[13],n[14]=e[2]*q+e[6]*Z+e[10]*$+e[14],n[15]=e[3]*q+e[7]*Z+e[11]*$+e[15]):(h=e[1],p=e[2],g=e[3],x=e[4],w=e[5],T=e[6],I=e[7],M=e[8],R=e[9],B=e[10],V=e[11],n[0]=l=e[0],n[1]=h,n[2]=p,n[3]=g,n[4]=x,n[5]=w,n[6]=T,n[7]=I,n[8]=M,n[9]=R,n[10]=B,n[11]=V,n[12]=l*q+x*Z+M*$+e[12],n[13]=h*q+w*Z+R*$+e[13],n[14]=p*q+T*Z+B*$+e[14],n[15]=g*q+I*Z+V*$+e[15]),n}function ue(n,e,s){var l=s[0],h=s[1],p=s[2];return n[0]=e[0]*l,n[1]=e[1]*l,n[2]=e[2]*l,n[3]=e[3]*l,n[4]=e[4]*h,n[5]=e[5]*h,n[6]=e[6]*h,n[7]=e[7]*h,n[8]=e[8]*p,n[9]=e[9]*p,n[10]=e[10]*p,n[11]=e[11]*p,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function ve(n,e,s){var l=Math.sin(s),h=Math.cos(s),p=e[4],g=e[5],x=e[6],w=e[7],T=e[8],I=e[9],M=e[10],R=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=p*h+T*l,n[5]=g*h+I*l,n[6]=x*h+M*l,n[7]=w*h+R*l,n[8]=T*h-p*l,n[9]=I*h-g*l,n[10]=M*h-x*l,n[11]=R*h-w*l,n}function ce(n,e,s){var l=Math.sin(s),h=Math.cos(s),p=e[0],g=e[1],x=e[2],w=e[3],T=e[8],I=e[9],M=e[10],R=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=p*h-T*l,n[1]=g*h-I*l,n[2]=x*h-M*l,n[3]=w*h-R*l,n[8]=p*l+T*h,n[9]=g*l+I*h,n[10]=x*l+M*h,n[11]=w*l+R*h,n}function Te(n,e,s){var l=Math.sin(s),h=Math.cos(s),p=e[0],g=e[1],x=e[2],w=e[3],T=e[4],I=e[5],M=e[6],R=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=p*h+T*l,n[1]=g*h+I*l,n[2]=x*h+M*l,n[3]=w*h+R*l,n[4]=T*h-p*l,n[5]=I*h-g*l,n[6]=M*h-x*l,n[7]=R*h-w*l,n}function Se(n,e){return n[0]=e[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=e[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Ie(n,e,s){var l,h,p,g=s[0],x=s[1],w=s[2],T=Math.sqrt(g*g+x*x+w*w);return T<E?null:(g*=T=1/T,x*=T,w*=T,l=Math.sin(e),h=Math.cos(e),n[0]=g*g*(p=1-h)+h,n[1]=x*g*p+w*l,n[2]=w*g*p-x*l,n[3]=0,n[4]=g*x*p-w*l,n[5]=x*x*p+h,n[6]=w*x*p+g*l,n[7]=0,n[8]=g*w*p+x*l,n[9]=x*w*p-g*l,n[10]=w*w*p+h,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n)}function Ue(n,e){var s=e[0],l=e[1],h=e[2],p=e[3],g=s+s,x=l+l,w=h+h,T=s*g,I=l*g,M=l*x,R=h*g,B=h*x,V=h*w,q=p*g,Z=p*x,$=p*w;return n[0]=1-M-V,n[1]=I+$,n[2]=R-Z,n[3]=0,n[4]=I-$,n[5]=1-T-V,n[6]=B+q,n[7]=0,n[8]=R+Z,n[9]=B-q,n[10]=1-T-M,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}var Ke=ee;function qe(){var n=new k(3);return k!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function ft(n){var e=new k(3);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e}function bt(n){var e=n[0],s=n[1],l=n[2];return Math.sqrt(e*e+s*s+l*l)}function Tt(n,e,s){var l=new k(3);return l[0]=n,l[1]=e,l[2]=s,l}function Et(n,e,s,l){return n[0]=e,n[1]=s,n[2]=l,n}function Lt(n,e,s){return n[0]=e[0]+s[0],n[1]=e[1]+s[1],n[2]=e[2]+s[2],n}function qt(n,e,s){return n[0]=e[0]-s[0],n[1]=e[1]-s[1],n[2]=e[2]-s[2],n}function ui(n,e,s){return n[0]=e[0]*s[0],n[1]=e[1]*s[1],n[2]=e[2]*s[2],n}function Ti(n,e,s){return n[0]=Math.min(e[0],s[0]),n[1]=Math.min(e[1],s[1]),n[2]=Math.min(e[2],s[2]),n}function vi(n,e,s){return n[0]=Math.max(e[0],s[0]),n[1]=Math.max(e[1],s[1]),n[2]=Math.max(e[2],s[2]),n}function Kt(n,e,s){return n[0]=e[0]*s,n[1]=e[1]*s,n[2]=e[2]*s,n}function Hi(n,e,s,l){return n[0]=e[0]+s[0]*l,n[1]=e[1]+s[1]*l,n[2]=e[2]+s[2]*l,n}function Br(n,e){var s=e[0]-n[0],l=e[1]-n[1],h=e[2]-n[2];return s*s+l*l+h*h}function ar(n){var e=n[0],s=n[1],l=n[2];return e*e+s*s+l*l}function Xr(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n}function mi(n,e){var s=e[0],l=e[1],h=e[2],p=s*s+l*l+h*h;return p>0&&(p=1/Math.sqrt(p)),n[0]=e[0]*p,n[1]=e[1]*p,n[2]=e[2]*p,n}function Ci(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function zi(n,e,s){var l=e[0],h=e[1],p=e[2],g=s[0],x=s[1],w=s[2];return n[0]=h*w-p*x,n[1]=p*g-l*w,n[2]=l*x-h*g,n}function mr(n,e,s,l){var h=e[0],p=e[1],g=e[2];return n[0]=h+l*(s[0]-h),n[1]=p+l*(s[1]-p),n[2]=g+l*(s[2]-g),n}function Wi(n,e,s){var l=e[0],h=e[1],p=e[2],g=s[3]*l+s[7]*h+s[11]*p+s[15];return n[0]=(s[0]*l+s[4]*h+s[8]*p+s[12])/(g=g||1),n[1]=(s[1]*l+s[5]*h+s[9]*p+s[13])/g,n[2]=(s[2]*l+s[6]*h+s[10]*p+s[14])/g,n}function ns(n,e,s){var l=e[0],h=e[1],p=e[2];return n[0]=l*s[0]+h*s[3]+p*s[6],n[1]=l*s[1]+h*s[4]+p*s[7],n[2]=l*s[2]+h*s[5]+p*s[8],n}function nn(n,e,s){var l=s[0],h=s[1],p=s[2],g=s[3],x=e[0],w=e[1],T=e[2],I=h*T-p*w,M=p*x-l*T,R=l*w-h*x;return n[0]=x+g*(I+=I)+h*(R+=R)-p*(M+=M),n[1]=w+g*M+p*I-l*R,n[2]=T+g*R+l*M-h*I,n}function ws(n){return n[0]=0,n[1]=0,n[2]=0,n}function _s(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]}var jr=qt,Gl=ui,Oa=bt;function Xl(){var n=new k(4);return k!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function $s(n,e,s){return n[0]=e[0]*s,n[1]=e[1]*s,n[2]=e[2]*s,n[3]=e[3]*s,n}function Fa(n,e){var s=e[0],l=e[1],h=e[2],p=e[3],g=s*s+l*l+h*h+p*p;return g>0&&(g=1/Math.sqrt(g)),n[0]=s*g,n[1]=l*g,n[2]=h*g,n[3]=p*g,n}function an(n,e,s){var l=e[0],h=e[1],p=e[2],g=e[3];return n[0]=s[0]*l+s[4]*h+s[8]*p+s[12]*g,n[1]=s[1]*l+s[5]*h+s[9]*p+s[13]*g,n[2]=s[2]*l+s[6]*h+s[10]*p+s[14]*g,n[3]=s[3]*l+s[7]*h+s[11]*p+s[15]*g,n}function pa(){var n=new k(4);return k!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function ga(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n}function fo(n,e,s){s*=.5;var l=e[0],h=e[1],p=e[2],g=e[3],x=Math.sin(s),w=Math.cos(s);return n[0]=l*w+g*x,n[1]=h*w+p*x,n[2]=p*w-h*x,n[3]=g*w-l*x,n}function po(n,e,s){s*=.5;var l=e[0],h=e[1],p=e[2],g=e[3],x=Math.sin(s),w=Math.cos(s);return n[0]=l*w-p*x,n[1]=h*w+g*x,n[2]=p*w+l*x,n[3]=g*w-h*x,n}qe(),Xl();var Js,fn,Yl,ma=Fa,Yo=(Js=qe(),fn=Tt(1,0,0),Yl=Tt(0,1,0),function(n,e,s){var l=Ci(e,s);return l<-.999999?(zi(Js,fn,e),Oa(Js)<1e-6&&zi(Js,Yl,e),mi(Js,Js),function(h,p,g){g*=.5;var x=Math.sin(g);h[0]=x*p[0],h[1]=x*p[1],h[2]=x*p[2],h[3]=Math.cos(g)}(n,Js,Math.PI),n):l>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(zi(Js,e,s),n[0]=Js[0],n[1]=Js[1],n[2]=Js[2],n[3]=1+l,ma(n,n))});function ks(){var n=new k(2);return k!=Float32Array&&(n[0]=0,n[1]=0),n}function Dn(n,e){var s=new k(2);return s[0]=n,s[1]=e,s}function ql(n,e,s){return n[0]=e,n[1]=s,n}function Ba(n,e,s){return n[0]=e[0]+s[0],n[1]=e[1]+s[1],n}function Jn(n,e,s){return n[0]=e[0]-s[0],n[1]=e[1]-s[1],n}function _a(n,e,s){return n[0]=e[0]*s,n[1]=e[1]*s,n}function go(n){var e=n[0],s=n[1];return Math.sqrt(e*e+s*s)}function Dr(n,e){var s=e[0],l=e[1],h=s*s+l*l;return h>0&&(h=1/Math.sqrt(h)),n[0]=e[0]*h,n[1]=e[1]*h,n}function As(n,e){return n[0]*e[0]+n[1]*e[1]}pa(),pa(),L();var Zl,mo,On=Jn;function $l(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}ks();var Jl=function(){if(mo)return Zl;function n(e,s,l,h){this.cx=3*e,this.bx=3*(l-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(h-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=s,this.p2x=l,this.p2y=h}return mo=1,Zl=n,n.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,s){if(s===void 0&&(s=1e-6),e<0)return 0;if(e>1)return 1;for(var l=e,h=0;h<8;h++){var p=this.sampleCurveX(l)-e;if(Math.abs(p)<s)return l;var g=this.sampleCurveDerivativeX(l);if(Math.abs(g)<1e-6)break;l-=p/g}var x=0,w=1;for(l=e,h=0;h<20&&(p=this.sampleCurveX(l),!(Math.abs(p-e)<s));h++)e>p?x=l:w=l,l=.5*(w-x)+x;return l},solve:function(e,s){return this.sampleCurveY(this.solveCurveX(e,s))}},Zl}(),eh=$l(Jl);function mt(n,e){this.x=n,this.y=e}function ya(n,e){if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let s=0;s<n.length;s++)if(!ya(n[s],e[s]))return!1;return!0}if(typeof n=="object"&&n!==null&&e!==null){if(typeof e!="object"||Object.keys(n).length!==Object.keys(e).length)return!1;for(const s in n)if(!ya(n[s],e[s]))return!1;return!0}return n===e}mt.prototype={clone(){return new mt(this.x,this.y)},add(n){return this.clone()._add(n)},sub(n){return this.clone()._sub(n)},multByPoint(n){return this.clone()._multByPoint(n)},divByPoint(n){return this.clone()._divByPoint(n)},mult(n){return this.clone()._mult(n)},div(n){return this.clone()._div(n)},rotate(n){return this.clone()._rotate(n)},rotateAround(n,e){return this.clone()._rotateAround(n,e)},matMult(n){return this.clone()._matMult(n)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(n){return this.x===n.x&&this.y===n.y},dist(n){return Math.sqrt(this.distSqr(n))},distSqr(n){const e=n.x-this.x,s=n.y-this.y;return e*e+s*s},angle(){return Math.atan2(this.y,this.x)},angleTo(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith(n){return this.angleWithSep(n.x,n.y)},angleWithSep(n,e){return Math.atan2(this.x*e-this.y*n,this.x*n+this.y*e)},_matMult(n){const e=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=e,this},_add(n){return this.x+=n.x,this.y+=n.y,this},_sub(n){return this.x-=n.x,this.y-=n.y,this},_mult(n){return this.x*=n,this.y*=n,this},_div(n){return this.x/=n,this.y/=n,this},_multByPoint(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint(n){return this.x/=n.x,this.y/=n.y,this},_unit(){return this._div(this.mag()),this},_perp(){const n=this.y;return this.y=this.x,this.x=-n,this},_rotate(n){const e=Math.cos(n),s=Math.sin(n),l=s*this.x+e*this.y;return this.x=e*this.x-s*this.y,this.y=l,this},_rotateAround(n,e){const s=Math.cos(n),l=Math.sin(n),h=e.y+l*(this.x-e.x)+s*(this.y-e.y);return this.x=e.x+s*(this.x-e.x)-l*(this.y-e.y),this.y=h,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:mt},mt.convert=function(n){if(n instanceof mt)return n;if(Array.isArray(n))return new mt(+n[0],+n[1]);if(n.x!==void 0&&n.y!==void 0)return new mt(+n.x,+n.y);throw new Error("Expected [x, y] or {x, y} point format")};const Wu=Math.PI/180,qo=180/Math.PI;function Oe(n){return n*Wu}function K(n){return n*qo}const se=[[0,0],[1,0],[1,1],[0,1]];function pe(n){if(n<=0)return 0;if(n>=1)return 1;const e=n*n,s=e*n;return 4*(n<.5?s:3*(n-e)+s-.75)}function Me(n,e,s,l){const h=new eh(n,e,s,l);return function(p){return h.solve(p)}}const Ce=Me(.25,.1,.25,1);function Ee(n,e,s){return Math.min(s,Math.max(e,n))}function Ye(n,e,s){return(s=Ee((s-n)/(e-n),0,1))*s*(3-2*s)}function De(n,e,s){const l=s-e,h=((n-e)%l+l)%l+e;return h===e?s:h}function Ze(n,e,s){if(!n.length)return s(null,[]);let l=n.length;const h=new Array(n.length);let p=null;n.forEach((g,x)=>{e(g,(w,T)=>{w&&(p=w),h[x]=T,--l==0&&s(p,h)})})}let wt=1;function lt(){return wt++}function Zt(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log2(n)))}function ni(n,e){n.forEach(s=>{e[s]&&(e[s]=e[s].bind(e))})}function ci(n,e,s){const l={};for(const h in n)l[h]=e.call(this,n[h],h,n);return l}function Ri(n,e,s){const l={};for(const h in n)e.call(this,n[h],h,n)&&(l[h]=n[h]);return l}function Li(n){return Array.isArray(n)?n.map(Li):typeof n=="object"&&n?ci(n,Li):n}function Bi(n,e){for(let s=0;s<n.length;s++)if(e.indexOf(n[s])>=0)return!0;return!1}const fr={};function Di(n){fr[n]||(typeof console<"u"&&console.warn(n),fr[n]=!0)}function Yr(n,e,s){return(s.y-n.y)*(e.x-n.x)>(e.y-n.y)*(s.x-n.x)}function os(n){let e=0;for(let s,l,h=0,p=n.length,g=p-1;h<p;g=h++)s=n[h],l=n[g],e+=(l.x-s.x)*(s.y+l.y);return e}function ls([n,e,s]){const l=Oe(e+90),h=Oe(s);return{x:n*Math.cos(l)*Math.sin(h),y:n*Math.sin(l)*Math.sin(h),z:n*Math.cos(h),azimuthal:e,polar:s}}function dr(n){return(typeof self<"u"||n!==void 0)&&typeof WorkerGlobalScope<"u"&&(n!==void 0?n:self)instanceof WorkerGlobalScope}function Ki(n){const e={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(s,l,h,p)=>{const g=h||p;return e[l]=!g||g.toLowerCase(),""}),e["max-age"]){const s=parseInt(e["max-age"],10);isNaN(s)?delete e["max-age"]:e["max-age"]=s}return e}let Hr=null;function Wr(n,e){return[n[4*e],n[4*e+1],n[4*e+2],n[4*e+3]]}function Sr(n,e,s,l){for(;e<s;){const h=e+s>>1;n[h]<l?e=h+1:s=h}return e}function Ms(n,e,s,l){for(;e<s;){const h=e+s>>1;n[h]<=l?e=h+1:s=h}return e}function js(n){return n>0?1/(1.001-n):1+n}function pn(n){return n>0?1-1/(1.001-n):-n}function xa(n,e,s){return(n-e.min)*(s.max-s.min)/(e.max-e.min)+s.min}const Fs={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Fs.API_URL)return null;try{const n=new URL(Fs.API_URL);return n.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":n.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.3.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Zo(n){return Fs.API_URL_REGEX.test(n)}function ip(n){return Fs.API_SPRITE_REGEX.test(n)}let Na,$o,Kl,Ql,Va,ec;function Gu(){return Na==null&&(Na=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Na}const Kn={now:()=>Ql!==void 0?Ql:performance.now(),setNow(n){Ql=n},restoreNow(){Ql=void 0},frame(n){const e=requestAnimationFrame(n);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(n,e=0){const{width:s,height:l}=n;Va||(Va=document.createElement("canvas"));const h=Va.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return(s>Va.width||l>Va.height)&&(Va.width=s,Va.height=l),h.clearRect(-e,-e,s+2*e,l+2*e),h.drawImage(n,0,0,s,l),h.getImageData(-e,-e,s+2*e,l+2*e)},resolveURL:n=>($o||($o=document.createElement("a")),$o.href=n,$o.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Kl==null&&(Kl=window.matchMedia("(prefers-reduced-motion: reduce)")),Kl.matches)},hasCanvasFingerprintNoise(){if(ec!==void 0)return ec;if(!Gu())return ec=!1,!1;const n=new OffscreenCanvas(85,1),e=n.getContext("2d",{willReadFrequently:!0});let s=0;for(let h=0;h<n.width;++h)e.fillStyle=`rgba(${s++},${s++},${s++}, 255)`,e.fillRect(h,0,1,1);const l=e.getImageData(0,0,n.width,n.height);s=0;for(let h=0;h<l.data.length;++h)if(h%4!=3&&s++!==l.data[h])return ec=!0,!0;return ec=!1,!1}};function Xu(n,e){const s=n.indexOf("?");if(s<0)return`${n}?${new URLSearchParams(e).toString()}`;const l=new URLSearchParams(n.slice(s));for(const h in e)l.set(h,e[h]);return`${n.slice(0,s)}?${l.toString()}`}function th(n,e={persistentParams:[]}){const s=n.indexOf("?");if(s<0)return n;const l=new URLSearchParams,h=new URLSearchParams(n.slice(s));for(const g of e.persistentParams){const x=h.get(g);x&&l.set(g,x)}const p=l.toString();return`${n.slice(0,s)}${p.length>0?`?${p}`:""}`}const gn="mapbox-tiles";let Fn=500,va=50;const Bn=["language","worldview","jobid"];let Hs,_o;function Yu(){try{return caches}catch{}}function tc(){const n=Yu();n&&Hs==null&&(Hs=n.open(gn))}let Ua=1/0;const ic={supported:!1,testSupport:function(n){!mn&&Jo&&(qu?Ko(n):rc=n)}};let rc,Jo,mn=!1,qu=!1;const ih=typeof self<"u"?self:{};function Ko(n){const e=n.createTexture();n.bindTexture(n.TEXTURE_2D,e);try{if(n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,Jo),n.isContextLost())return;ic.supported=!0}catch{}n.deleteTexture(e),mn=!0}ih.document&&(Jo=ih.document.createElement("img"),Jo.onload=function(){rc&&Ko(rc),rc=null,qu=!0},Jo.onerror=function(){mn=!0,rc=null},Jo.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const rh={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(rh);class Zu extends Error{constructor(e,s,l){s===401&&Zo(l)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=s,this.url=l}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const sh=dr()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Ui=function(n,e){if(!(/^file:/.test(s=n.url)||/^file:/.test(sh())&&!/^\w+:/.test(s))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(l,h){const p=new AbortController,g=new Request(l.url,{method:l.method||"GET",body:l.body,credentials:l.credentials,headers:l.headers,referrer:sh(),referrerPolicy:l.referrerPolicy,signal:p.signal});let x=!1,w=!1;const T=(I=g.url).indexOf("sku=")>0&&Zo(I);var I;l.type==="json"&&g.headers.set("Accept","application/json");const M=(B,V,q)=>{if(w)return;if(B&&B.message!=="SecurityError"&&Di(B.toString()),V&&q)return R(V);const Z=Date.now();fetch(g).then($=>{if($.ok){const ne=T?$.clone():null;return R($,ne,Z)}return h(new Zu($.statusText,$.status,l.url))}).catch($=>{$.name!=="AbortError"&&h(new Error(`${$.message} ${l.url}`))})},R=(B,V,q)=>{(l.type==="arrayBuffer"?B.arrayBuffer():l.type==="json"?B.json():B.text()).then(Z=>{w||(V&&q&&function($,ne,ae){if(tc(),Hs==null)return;const le=Ki(ne.headers.get("Cache-Control")||"");if(le["no-store"])return;const be={status:ne.status,statusText:ne.statusText,headers:new Headers};ne.headers.forEach((Le,ze)=>be.headers.set(ze,Le)),le["max-age"]&&be.headers.set("Expires",new Date(ae+1e3*le["max-age"]).toUTCString());const we=be.headers.get("Expires");if(!we||new Date(we).getTime()-ae<42e4)return;let ke=th($.url,{persistentParams:Bn});if(ne.status===206){const Le=$.headers.get("Range");if(!Le)return;be.status=200,ke=Xu(ke,{range:Le})}(function(Le,ze){if(_o===void 0)try{new Response(new ReadableStream),_o=!0}catch{_o=!1}_o?ze(Le.body):Le.blob().then(ze).catch(rt=>Di(rt.message))})(ne,Le=>{const ze=new Response((rt=ne.status)!==200&&rt!==404&&[101,103,204,205,304].includes(rt)?null:Le,be);var rt;tc(),Hs!=null&&Hs.then(Be=>Be.put(ke,ze)).catch(Be=>Di(Be.message))})}(g,V,q),x=!0,h(null,Z,B.headers.get("Cache-Control"),B.headers.get("Expires")))}).catch(Z=>{w||h(new Error(Z.message))})};return T?function(B,V){if(tc(),Hs==null)return V(null);Hs.then(q=>{let Z=th(B.url,{persistentParams:Bn});const $=B.headers.get("Range");$&&(Z=Xu(Z,{range:$})),q.match(Z).then(ne=>{const ae=function(le){if(!le)return!1;const be=new Date(le.headers.get("Expires")||0),we=Ki(le.headers.get("Cache-Control")||"");return Number(be)>Date.now()&&!we["no-cache"]}(ne);q.delete(Z).catch(V),ae&&q.put(Z,ne.clone()).catch(V),V(null,ne,ae)}).catch(V)}).catch(V)}(g,M):M(null,null),{cancel:()=>{w=!0,x||p.abort()}}}(n,e);if(dr(self)&&self.worker.actor)return self.worker.actor.send("getResource",n,e,void 0,!0)}var s;return function(l,h){const p=new XMLHttpRequest;p.open(l.method||"GET",l.url,!0),l.type==="arrayBuffer"&&(p.responseType="arraybuffer");for(const g in l.headers)p.setRequestHeader(g,l.headers[g]);return l.type==="json"&&(p.responseType="text",p.setRequestHeader("Accept","application/json")),p.withCredentials=l.credentials==="include",p.onerror=()=>{h(new Error(p.statusText))},p.onload=()=>{if((p.status>=200&&p.status<300||p.status===0)&&p.response!==null){let g=p.response;if(l.type==="json")try{g=JSON.parse(p.response)}catch(x){return h(x)}h(null,g,p.getResponseHeader("Cache-Control"),p.getResponseHeader("Expires"))}else h(new Zu(p.statusText,p.status,l.url))},p.send(l.body),{cancel:()=>p.abort()}}(n,e)},Qo=function(n,e){return Ui(Object.assign(n,{type:"arrayBuffer"}),e)};function rp(n){const e=document.createElement("a");return e.href=n,e.protocol===location.protocol&&e.host===location.host}const sp="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let nh,ja;nh=[],ja=0;const el=function(n,e){if(ic.supported&&(n.headers||(n.headers={}),n.headers.accept="image/webp,*/*"),ja>=Fs.MAX_PARALLEL_IMAGE_REQUESTS){const p={requestParameters:n,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return nh.push(p),p}ja++;let s=!1;const l=()=>{if(!s)for(s=!0,ja--;nh.length&&ja<Fs.MAX_PARALLEL_IMAGE_REQUESTS;){const p=nh.shift(),{requestParameters:g,callback:x,cancelled:w}=p;w||(p.cancel=el(g,x).cancel)}},h=Qo(n,(p,g,x,w)=>{l(),p?e(p):g&&(self.createImageBitmap?function(T,I){const M=new Blob([new Uint8Array(T)],{type:"image/png"});createImageBitmap(M).then(R=>{I(null,R)}).catch(R=>{I(new Error(`Could not load image because of ${R.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(g,(T,I)=>e(T,I,x,w)):function(T,I){const M=new Image;M.onload=()=>{I(null,M),URL.revokeObjectURL(M.src),M.onload=null,requestAnimationFrame(()=>{M.src=sp})},M.onerror=()=>I(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const R=new Blob([new Uint8Array(T)],{type:"image/png"});M.src=T.byteLength?URL.createObjectURL(R):sp}(g,(T,I)=>e(T,I,x,w)))});return{cancel:()=>{h.cancel(),l()}}};var sc,ah,np,yo={exports:{}},ap={exports:{}},$u={exports:{}},tl=function(){if(np)return yo.exports;np=1;var n=(sc||(sc=1,ap.exports=function(s,l){var h,p,g,x,w,T,I,M;for(p=s.length-(h=3&s.length),g=l,w=3432918353,T=461845907,M=0;M<p;)I=255&s.charCodeAt(M)|(255&s.charCodeAt(++M))<<8|(255&s.charCodeAt(++M))<<16|(255&s.charCodeAt(++M))<<24,++M,g=27492+(65535&(x=5*(65535&(g=(g^=I=(65535&(I=(I=(65535&I)*w+(((I>>>16)*w&65535)<<16)&4294967295)<<15|I>>>17))*T+(((I>>>16)*T&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(x>>>16)&65535)<<16);switch(I=0,h){case 3:I^=(255&s.charCodeAt(M+2))<<16;case 2:I^=(255&s.charCodeAt(M+1))<<8;case 1:g^=I=(65535&(I=(I=(65535&(I^=255&s.charCodeAt(M)))*w+(((I>>>16)*w&65535)<<16)&4294967295)<<15|I>>>17))*T+(((I>>>16)*T&65535)<<16)&4294967295}return g^=s.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0}),ap.exports),e=(ah||(ah=1,$u.exports=function(s,l){for(var h,p=s.length,g=l^p,x=0;p>=4;)h=1540483477*(65535&(h=255&s.charCodeAt(x)|(255&s.charCodeAt(++x))<<8|(255&s.charCodeAt(++x))<<16|(255&s.charCodeAt(++x))<<24))+((1540483477*(h>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),p-=4,++x;switch(p){case 3:g^=(255&s.charCodeAt(x+2))<<16;case 2:g^=(255&s.charCodeAt(x+1))<<8;case 1:g=1540483477*(65535&(g^=255&s.charCodeAt(x)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0}),$u.exports);return yo.exports=n,yo.exports.murmur3=n,yo.exports.murmur2=e,yo.exports}(),oh=$l(tl);class Nn{constructor(e,...s){Object.assign(this,s[0]||{}),this.type=e}}class nc extends Nn{constructor(e,s={}){super("error",Object.assign({error:e},s))}}function lh(n,e,s){s[n]&&s[n].indexOf(e)!==-1||(s[n]=s[n]||[],s[n].push(e))}function _n(n,e,s){if(s&&s[n]){const l=s[n].indexOf(e);l!==-1&&s[n].splice(l,1)}}class xo{on(e,s){return this._listeners=this._listeners||{},lh(e,s,this._listeners),this}off(e,s){return _n(e,s,this._listeners),_n(e,s,this._oneTimeListeners),this}once(e,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},lh(e,s,this._oneTimeListeners),this):new Promise(l=>{this.once(e,l)})}fire(e,s){const l=typeof e=="string"?new Nn(e,s):e,h=l.type;if(this.listens(h)){l.target=this;const p=this._listeners&&this._listeners[h]?this._listeners[h].slice():[];for(const w of p)w.call(this,l);const g=this._oneTimeListeners&&this._oneTimeListeners[h]?this._oneTimeListeners[h].slice():[];for(const w of g)_n(h,w,this._oneTimeListeners),w.call(this,l);const x=this._eventedParent;if(x){const w=typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData;Object.assign(l,w),x.fire(l)}}else l instanceof nc&&console.error(l.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,s){return this._eventedParent=e,this._eventedParentData=s,this}}class yn{constructor(e){typeof e=="string"?this.name=e:(this.name=e.name,this.iconsetId=e.iconsetId)}static from(e){return new yn(e)}static toString(e){return e.iconsetId?`${e.name}${e.iconsetId}`:e.name}static parse(e){const[s,l]=e.split("");return new yn({name:s,iconsetId:l})}static isEqual(e,s){return e.name===s.name&&e.iconsetId===s.iconsetId}toString(){return yn.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var Ju,ch={},Ku=function(){if(Ju)return ch;Ju=1;var n={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(p){return(p=Math.round(p))<0?0:p>255?255:p}function s(p){return e(p[p.length-1]==="%"?parseFloat(p)/100*255:parseInt(p))}function l(p){return(g=p[p.length-1]==="%"?parseFloat(p)/100:parseFloat(p))<0?0:g>1?1:g;var g}function h(p,g,x){return x<0?x+=1:x>1&&(x-=1),6*x<1?p+(g-p)*x*6:2*x<1?g:3*x<2?p+(g-p)*(2/3-x)*6:p}try{ch.parseCSSColor=function(p){var g,x=p.replace(/ /g,"").toLowerCase();if(x in n)return n[x].slice();if(x[0]==="#")return x.length===4?(g=parseInt(x.substr(1),16))>=0&&g<=4095?[(3840&g)>>4|(3840&g)>>8,240&g|(240&g)>>4,15&g|(15&g)<<4,1]:null:x.length===7&&(g=parseInt(x.substr(1),16))>=0&&g<=16777215?[(16711680&g)>>16,(65280&g)>>8,255&g,1]:null;var w=x.indexOf("("),T=x.indexOf(")");if(w!==-1&&T+1===x.length){var I=x.substr(0,w),M=x.substr(w+1,T-(w+1)).split(","),R=1;switch(I){case"rgba":if(M.length!==4)return null;R=l(M.pop());case"rgb":return M.length!==3?null:[s(M[0]),s(M[1]),s(M[2]),R];case"hsla":if(M.length!==4)return null;R=l(M.pop());case"hsl":if(M.length!==3)return null;var B=(parseFloat(M[0])%360+360)%360/360,V=l(M[1]),q=l(M[2]),Z=q<=.5?q*(V+1):q+V-q*V,$=2*q-Z;return[e(255*h($,Z,B+1/3)),e(255*h($,Z,B)),e(255*h($,Z,B-1/3)),R];default:return null}}return null}}catch{}return ch}();class er{constructor(e,s,l,h=1){this.r=e,this.g=s,this.b=l,this.a=h}static parse(e){if(!e)return;if(e instanceof er)return e;if(typeof e!="string")return;const s=Ku.parseCSSColor(e);return s?new er(s[0]/255,s[1]/255,s[2]/255,s[3]):void 0}toString(){const[e,s,l,h]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*s)},${Math.round(255*l)},${h})`}toNonPremultipliedRenderColor(e){const{r:s,g:l,b:h,a:p}=this;return new op(e,s,l,h,p)}toPremultipliedRenderColor(e){const{r:s,g:l,b:h,a:p}=this;return new hh(e,s*p,l*p,h*p,p)}clone(){return new er(this.r,this.g,this.b,this.a)}}class Qu{constructor(e,s,l,h,p,g=!1){if(this.premultiplied=!1,this.premultiplied=g,e){const x=e.image.height,w=x*x;this.premultiplied?(s=p===0?0:s/p*(x-1),l=p===0?0:l/p*(x-1),h=p===0?0:h/p*(x-1)):(s*=x-1,l*=x-1,h*=x-1);const T=Math.floor(s),I=Math.floor(l),M=Math.floor(h),R=Math.ceil(s),B=Math.ceil(l),V=Math.ceil(h),q=s-T,Z=l-I,$=h-M,ne=e.image.data,ae=4*(T+I*w+M*x),le=4*(T+I*w+V*x),be=4*(T+B*w+M*x),we=4*(T+B*w+V*x),ke=4*(R+I*w+M*x),Le=4*(R+I*w+V*x),ze=4*(R+B*w+M*x),rt=4*(R+B*w+V*x);if(ae<0||rt>=ne.length)throw new Error("out of range");this.r=ei(ei(ei(ne[ae],ne[le],$),ei(ne[be],ne[we],$),Z),ei(ei(ne[ke],ne[Le],$),ei(ne[ze],ne[rt],$),Z),q)/255*(this.premultiplied?p:1),this.g=ei(ei(ei(ne[ae+1],ne[le+1],$),ei(ne[be+1],ne[we+1],$),Z),ei(ei(ne[ke+1],ne[Le+1],$),ei(ne[ze+1],ne[rt+1],$),Z),q)/255*(this.premultiplied?p:1),this.b=ei(ei(ei(ne[ae+2],ne[le+2],$),ei(ne[be+2],ne[we+2],$),Z),ei(ei(ne[ke+2],ne[Le+2],$),ei(ne[ze+2],ne[rt+2],$),Z),q)/255*(this.premultiplied?p:1),this.a=p}else this.r=s,this.g=l,this.b=h,this.a=p}toArray(){const{r:e,g:s,b:l,a:h}=this;return[255*e,255*s,255*l,h]}toHslaArray(){let{r:e,g:s,b:l,a:h}=this;if(this.premultiplied){if(h===0)return[0,0,0,0];const V=1/h;e*=V,s*=V,l*=V}const p=Math.min(Math.max(e,0),1),g=Math.min(Math.max(s,0),1),x=Math.min(Math.max(l,0),1),w=Math.min(p,g,x),T=Math.max(p,g,x),I=T-w,M=.5*(w+T);if(I===0)return[0,0,100*M,h];const R=M>.5?I/(2-T-w):I/(T+w);let B;switch(T){case p:B=60*((g-x)/I+(g<x?6:0));break;case g:B=60*((x-p)/I+2);break;default:B=60*((p-g)/I+4)}return[B,100*R,100*M,h]}toArray01(){const{r:e,g:s,b:l,a:h}=this;return[e,s,l,h]}toArray01Scaled(e){const{r:s,g:l,b:h}=this;return[s*e,l*e,h*e]}toArray01Linear(){const{r:e,g:s,b:l,a:h}=this;return[Math.pow(e,2.2),Math.pow(s,2.2),Math.pow(l,2.2),h]}}class op extends Qu{constructor(e,s,l,h,p){super(e,s,l,h,p,!1)}}class hh extends Qu{constructor(e,s,l,h,p){super(e,s,l,h,p,!0)}}function ei(n,e,s){return n*(1-s)+e*s}function ed(n,e,s){return n.map((l,h)=>ei(l,e[h],s))}er.black=new er(0,0,0,1),er.white=new er(1,1,1,1),er.transparent=new er(0,0,0,0),er.red=new er(1,0,0,1),er.blue=new er(0,0,1,1);var xn=Object.freeze({__proto__:null,array:ed,color:function(n,e,s){return new er(ei(n.r,e.r,s),ei(n.g,e.g,s),ei(n.b,e.b,s),ei(n.a,e.a,s))},number:ei});class Vn extends Error{constructor(e,s){super(s),this.message=s,this.key=e}}class uh{constructor(e,s=[]){this.parent=e,this.bindings={};for(const[l,h]of s)this.bindings[l]=h}concat(e){return new uh(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Qn={kind:"null"},Xt={kind:"number"},tr={kind:"string"},nr={kind:"boolean"},on={kind:"color"},vo={kind:"object"},$i={kind:"value"},dh={kind:"collator"},Ha={kind:"formatted"},ac={kind:"resolvedImage"};function Bs(n,e){return{kind:"array",itemType:n,N:e}}function cs(n){if(n.kind==="array"){const e=cs(n.itemType);return typeof n.N=="number"?`array<${e}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${e}>`}return n.kind}const pm=[Qn,Xt,tr,nr,on,Ha,vo,Bs($i),ac];function oc(n,e){if(e.kind==="error")return null;if(n.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!oc(n.itemType,e.itemType))&&(typeof n.N!="number"||n.N===e.N))return null}else{if(n.kind===e.kind)return null;if(n.kind==="value"){for(const s of pm)if(!oc(s,e))return null}}return`Expected ${cs(n)} but found ${cs(e)} instead.`}function td(n,e){return e.some(s=>s.kind===n.kind)}function lc(n,e){return e.some(s=>s==="null"?n===null:s==="array"?Array.isArray(n):s==="object"?n&&!Array.isArray(n)&&typeof n=="object":s===typeof n)}function cc(n,e){return n.kind==="array"&&e.kind==="array"?n.N===e.N&&cc(n.itemType,e.itemType):n.kind===e.kind}class Wa{constructor(e,s,l){this.sensitivity=e?s?"variant":"case":s?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,s){return this.collator.compare(e,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class fh{constructor(e,s,l,h,p){this.text=e.normalize?e.normalize():e,this.image=s,this.scale=l,this.fontStack=h,this.textColor=p}}class Ws{constructor(e){this.sections=e}static fromString(e){return new Ws([new fh(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||!!e.image&&e.image.hasPrimary())}static factory(e){return e instanceof Ws?e:Ws.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const s of this.sections){if(s.image){const h=s.image.getPrimary().id.toString();e.push(["image",h]);continue}e.push(s.text);const l={};s.fontStack&&(l["text-font"]=["literal",s.fontStack.split(",")]),s.scale&&(l["font-scale"]=s.scale),s.textColor&&(l["text-color"]=["rgba"].concat(s.textColor.toNonPremultipliedRenderColor(null).toArray())),e.push(l)}return e}}class Un{constructor(e,s={}){if(this.id=yn.from(e),this.options=Object.assign({},s),s.transform){const{a:l,b:h,c:p,d:g,e:x,f:w}=s.transform;this.options.transform=new DOMMatrix([l,h,p,g,x,w])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:e,b:s,c:l,d:h,e:p,f:g}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:e,b:s,c:l,d:h,e:p,f:g}})}static parse(e){let s,l,h,p;try{({name:s,iconsetId:l,params:h,transform:p}=JSON.parse(e)||{})}catch{return null}if(!s)return null;const{a:g,b:x,c:w,d:T,e:I,f:M}=p||{};return new Un({name:s,iconsetId:l},{params:h,transform:new DOMMatrix([g,x,w,T,I,M])})}scaleSelf(e,s){return this.options.transform.scaleSelf(e,s),this}}class Ks{constructor(e,s,l,h,p=!1){this.primaryId=yn.from(e),this.primaryOptions=s,l&&(this.secondaryId=yn.from(l)),this.secondaryOptions=h,this.available=p}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Un(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Un(this.secondaryId,this.secondaryOptions):null}static from(e){return typeof e=="string"?Ks.build({name:e}):e}static build(e,s,l,h){return!e||typeof e=="object"&&!("name"in e)?null:new Ks(e,l,s,h)}}function lp(n,e,s,l){return typeof n=="number"&&n>=0&&n<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof s=="number"&&s>=0&&s<=255?l===void 0||typeof l=="number"&&l>=0&&l<=1?null:`Invalid rgba value [${[n,e,s,l].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof l=="number"?[n,e,s,l]:[n,e,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function il(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof er||n instanceof Wa||n instanceof Ws||n instanceof Ks)return!0;if(Array.isArray(n)){for(const e of n)if(!il(e))return!1;return!0}if(typeof n=="object"){for(const e in n)if(!il(n[e]))return!1;return!0}return!1}function ys(n){if(n===null)return Qn;if(typeof n=="string")return tr;if(typeof n=="boolean")return nr;if(typeof n=="number")return Xt;if(n instanceof er)return on;if(n instanceof Wa)return dh;if(n instanceof Ws)return Ha;if(n instanceof Ks)return ac;if(Array.isArray(n)){const e=n.length;let s;for(const l of n){const h=ys(l);if(s){if(s===h)continue;s=$i;break}s=h}return Bs(s||$i,e)}return vo}function Qs(n){const e=typeof n;return n===null?"":e==="string"||e==="number"||e==="boolean"?String(n):n instanceof Ws||n instanceof Ks||n instanceof er?n.toString():JSON.stringify(n)}class bi{constructor(e,s){this.type=e,this.value=s}static parse(e,s){if(e.length!==2)return s.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!il(e[1]))return s.error("invalid value");const l=e[1];let h=ys(l);const p=s.expectedType;return h.kind!=="array"||h.N!==0||!p||p.kind!=="array"||typeof p.N=="number"&&p.N!==0||(h=p),new bi(h,l)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof er?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof Ws?this.value.serialize():this.value}}class Rt{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const hc={string:tr,number:Xt,boolean:nr,object:vo};class ii{constructor(e,s){this.type=e,this.args=s}static parse(e,s){if(e.length<2)return s.error("Expected at least one argument.");let l,h=1;const p=e[0];if(p==="array"){let x,w;if(e.length>2){const T=e[1];if(typeof T!="string"||!(T in hc)||T==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);x=hc[T],h++}else x=$i;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return s.error('The length argument to "array" must be a positive integer literal',2);w=e[2],h++}l=Bs(x,w)}else l=hc[p];const g=[];for(;h<e.length;h++){const x=s.parse(e[h],h,$i);if(!x)return null;g.push(x)}return new ii(l,g)}evaluate(e){for(let s=0;s<this.args.length;s++){const l=this.args[s].evaluate(e);if(!oc(this.type,ys(l)))return l;if(s===this.args.length-1)throw new Rt(`The expression ${JSON.stringify(this.args[s].serialize())} evaluated to ${cs(ys(l))} but was expected to be of type ${cs(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,s=[e.kind];if(e.kind==="array"){const l=e.itemType;if(l.kind==="string"||l.kind==="number"||l.kind==="boolean"){s.push(l.kind);const h=e.N;(typeof h=="number"||this.args.length>1)&&s.push(h)}}return s.concat(this.args.map(l=>l.serialize()))}}class bo{constructor(e){this.type=Ha,this.sections=e}static parse(e,s){if(e.length<2)return s.error("Expected at least one argument.");const l=e[1];if(!Array.isArray(l)&&typeof l=="object")return s.error("First argument must be an image or text section.");const h=[];let p=!1;for(let g=1;g<=e.length-1;++g){const x=e[g];if(p&&typeof x=="object"&&!Array.isArray(x)){p=!1;let w=null;if(x["font-scale"]&&(w=s.parseObjectValue(x["font-scale"],g,"font-scale",Xt),!w))return null;let T=null;if(x["text-font"]&&(T=s.parseObjectValue(x["text-font"],g,"text-font",Bs(tr)),!T))return null;let I=null;if(x["text-color"]&&(I=s.parseObjectValue(x["text-color"],g,"text-color",on),!I))return null;const M=h[h.length-1];M.scale=w,M.font=T,M.textColor=I}else{const w=s.parse(e[g],g,$i);if(!w)return null;const T=w.type.kind;if(T!=="string"&&T!=="value"&&T!=="null"&&T!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,h.push({content:w,scale:null,font:null,textColor:null})}}return new bo(h)}evaluate(e){return new Ws(this.sections.map(s=>{const l=s.content.evaluate(e);return cc(ys(l),ac)?new fh("",l,null,null,null):new fh(Qs(l),null,s.scale?s.scale.evaluate(e):null,s.font?s.font.evaluate(e).join(","):null,s.textColor?s.textColor.evaluate(e):null)}))}eachChild(e){for(const s of this.sections)e(s.content),s.scale&&e(s.scale),s.font&&e(s.font),s.textColor&&e(s.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const s of this.sections){e.push(s.content.serialize());const l={};s.scale&&(l["font-scale"]=s.scale.serialize()),s.font&&(l["text-font"]=s.font.serialize()),s.textColor&&(l["text-color"]=s.textColor.serialize()),e.push(l)}return e}}class rl{constructor(e,s,l,h){this._imageWarnHistory={},this.type=ac,this.namePrimary=e,this.nameSecondary=s,l&&(this.paramsPrimary=l.params,this.iconsetIdPrimary=l.iconset?l.iconset.id:void 0),h&&(this.paramsSecondary=h.params,this.iconsetIdSecondary=h.iconset?h.iconset.id:void 0)}static parse(e,s){if(e.length<2)return s.error("Expected two or more arguments.");let l=1;const h=[];function p(){if(l<e.length){const x=s.parse(e[l],l++,tr);return x?(h.push({image:x,options:{}}),!0):(s.error(h.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function g(){if(l<e.length){const w=e[l];if((x=w)===null||typeof x!="object"||Array.isArray(x))return!0;const T=w.params,I=w.iconset,M=s.concat(l);if(!T&&!I)return l++,!0;if(T){if(typeof T!="object"||T.constructor!==Object)return M.error('Image options "params" should be an object'),!1;const R={},B=M.concat(void 0,"params");for(const V in T){if(!V)return B.error("Image parameter name should be non-empty"),!1;const q=B.concat(void 0,V).parse(T[V],void 0,on,void 0,{typeAnnotation:"coerce"});if(!q)return!1;R[V]=q}h[h.length-1].options.params=R}if(I){if(typeof I!="object"||I.constructor!==Object)return M.error('Image options "iconset" should be an object'),!1;if(!I.id)return M.error('Image options "iconset" should have an "id" property'),!1;h[h.length-1].options.iconset=I}return l++,!0}var x;return!0}for(let x=0;x<2;x++)if(!p()||!g())return;return new rl(h[0].image,h[1]?h[1].image:void 0,h[0].options,h[1]?h[1].options:void 0)}evaluateParams(e,s){const l={};if(s){for(const h in s)if(s[h])try{l[h]=s[h].evaluate(e)}catch{continue}if(Object.keys(l).length!==0)return{params:l}}}evaluate(e){const s={name:this.namePrimary.evaluate(e),iconsetId:this.iconsetIdPrimary},l=this.nameSecondary?{name:this.nameSecondary.evaluate(e),iconsetId:this.iconsetIdSecondary}:void 0,h=Ks.build(s,l,this.paramsPrimary?this.evaluateParams(e,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(e,this.paramsSecondary):void 0);if(h&&e.availableImages){const p=h.getPrimary().id;if(h.available=e.availableImages.some(g=>yn.isEqual(g,p)),h.available){const g=h.getSecondary()?h.getSecondary().id:null;g&&(h.available=e.availableImages.some(x=>yn.isEqual(x,g)))}}return h}eachChild(e){if(e(this.namePrimary),this.paramsPrimary)for(const s in this.paramsPrimary)this.paramsPrimary[s]&&e(this.paramsPrimary[s]);if(this.nameSecondary&&(e(this.nameSecondary),this.paramsSecondary))for(const s in this.paramsSecondary)this.paramsSecondary[s]&&e(this.paramsSecondary[s])}outputDefined(){return!1}serializeOptions(e,s){const l={};if(s&&(l.iconset={id:s}),e){l.params={};for(const h in e)e[h]&&(l.params[h]=e[h].serialize())}return Object.keys(l).length>0?l:void 0}serialize(){const e=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const s=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);s&&e.push(s)}if(this.nameSecondary&&(e.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const s=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);s&&e.push(s)}return e}}function ai(n){return uc(n)?"string":dc(n)?"number":rd(n)?"boolean":Array.isArray(n)?"array":n===null?"null":id(n)?"object":typeof n}function id(n){return n!=null&&!Array.isArray(n)&&typeof n!="function"&&!(n instanceof String||n instanceof Number||n instanceof Boolean)&&typeof n=="object"}function uc(n){return typeof n=="string"||n instanceof String}function dc(n){return typeof n=="number"||n instanceof Number}function rd(n){return typeof n=="boolean"||n instanceof Boolean}const ph={"to-boolean":nr,"to-color":on,"to-number":Xt,"to-string":tr};class ts{constructor(e,s){this.type=e,this.args=s}static parse(e,s){if(e.length<2)return s.error("Expected at least one argument.");const l=e[0],h=[];let p=Qn;if(l==="to-array"){if(!Array.isArray(e[1]))return null;const g=e[1].length;if(s.expectedType){if(s.expectedType.kind!=="array")return s.error(`Expected ${s.expectedType.kind} but found array.`);p=Bs(s.expectedType.itemType,g)}else{if(!(g>0&&il(e[1][0])))return null;p=Bs(ys(e[1][0]),g)}for(let x=0;x<g;x++){const w=e[1][x];let T;if(Array.isArray(w))T=s.parse(w,void 0,p.itemType);else{const I=ai(w);if(I!==p.itemType.kind)return s.error(`Expected ${p.itemType.kind} but found ${I}.`);T=s.registry.literal.parse(["literal",w===void 0?null:w],s)}if(!T)return null;h.push(T)}}else{if((l==="to-boolean"||l==="to-string")&&e.length!==2)return s.error("Expected one argument.");p=ph[l];for(let g=1;g<e.length;g++){const x=s.parse(e[g],g,$i);if(!x)return null;h.push(x)}}return new ts(p,h)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let s,l;for(const h of this.args){if(s=h.evaluate(e),l=null,s instanceof er)return s;if(typeof s=="string"){const p=e.parseColor(s);if(p)return p}else if(Array.isArray(s)&&(l=s.length<3||s.length>4?`Invalid rbga value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:lp(s[0],s[1],s[2],s[3]),!l))return new er(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new Rt(l||`Could not parse color from value '${typeof s=="string"?s:String(JSON.stringify(s))}'`)}if(this.type.kind==="number"){let s=null;for(const l of this.args){if(s=l.evaluate(e),s===null)return 0;const h=Number(s);if(!isNaN(h))return h}throw new Rt(`Could not convert ${JSON.stringify(s)} to number.`)}return this.type.kind==="formatted"?Ws.fromString(Qs(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Ks.build(Qs(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(s=>s.evaluate(e)):Qs(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new bo([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new rl(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(s=>{e.push(s.serialize())}),e}}const sd=["Unknown","Point","LineString","Polygon"];class ba{constructor(e,s,l){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=s,this.iconImageUseTheme=l}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?sd[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,s=this.featureDistanceData.scale,{x:l,y:h}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(l*s-e[0])+this.featureDistanceData.bearing[1]*(h*s-e[1])}return 0}parseColor(e){let s=this._parseColorCache[e];return s||(s=this._parseColorCache[e]=er.parse(e)),s}getConfig(e){return this.options?this.options.get(e):null}}class Gs{constructor(e,s,l,h,p){this.name=e,this.type=s,this._evaluate=l,this.args=h,this._overloadIndex=p}evaluate(e){if(!this._evaluate){const s=Gs.definitions[this.name];this._evaluate=Array.isArray(s)?s[2]:s.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,s){const l=e[0],h=Gs.definitions[l];if(!h)return s.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0);const p=Array.isArray(h)?h[0]:h.type,g=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,x=[];let w=null,T=-1;for(const[I,M]of g){if(Array.isArray(I)&&I.length!==e.length-1)continue;x.push(I),T++,w=new kh(s.registry,s.path,null,s.scope,void 0,s._scope,s.options,s.iconImageUseTheme);const R=[];let B=!1;for(let V=1;V<e.length;V++){const q=e[V],Z=Array.isArray(I)?I[V-1]:I.type,$=w.parse(q,1+R.length,Z);if(!$){B=!0;break}R.push($)}if(!B)if(Array.isArray(I)&&I.length!==R.length)w.error(`Expected ${I.length} arguments, but found ${R.length} instead.`);else{for(let V=0;V<R.length;V++){const q=Array.isArray(I)?I[V]:I.type,Z=R[V];w.concat(V+1).checkSubtype(q,Z.type)}if(w.errors.length===0)return new Gs(l,p,M,R,T)}}if(x.length===1)s.errors.push(...w.errors);else{const I=(x.length?x:g.map(([R])=>R)).map(Ga).join(" | "),M=[];for(let R=1;R<e.length;R++){const B=s.parse(e[R],1+M.length);if(!B)return null;M.push(cs(B.type))}s.error(`Expected arguments of type ${I}, but found (${M.join(", ")}) instead.`)}return null}static register(e,s){Gs.definitions=s;for(const l in s)e[l]=Gs}}function Ga(n){return Array.isArray(n)?`(${n.map(cs).join(", ")})`:`(${cs(n.type)}...)`}class Ps{constructor(e,s,l){this.type=dh,this.locale=l,this.caseSensitive=e,this.diacriticSensitive=s}static parse(e,s){if(e.length!==2)return s.error("Expected one argument.");const l=e[1];if(typeof l!="object"||Array.isArray(l))return s.error("Collator options argument must be an object.");const h=l["case-sensitive"]===void 0?s.parse(!1,1,nr):s.parseObjectValue(l["case-sensitive"],1,"case-sensitive",nr);if(!h)return null;const p=l["diacritic-sensitive"]===void 0?s.parse(!1,1,nr):s.parseObjectValue(l["diacritic-sensitive"],1,"diacritic-sensitive",nr);if(!p)return null;let g=null;return l.locale&&(g=s.parseObjectValue(l.locale,1,"locale",tr),!g)?null:new Ps(h,p,g)}evaluate(e){return new Wa(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function cp(n,e,s=0,l=n.length-1,h=gm){for(;l>s;){if(l-s>600){const w=l-s+1,T=e-s+1,I=Math.log(w),M=.5*Math.exp(2*I/3),R=.5*Math.sqrt(I*M*(w-M)/w)*(T-w/2<0?-1:1);cp(n,e,Math.max(s,Math.floor(e-T*M/w+R)),Math.min(l,Math.floor(e+(w-T)*M/w+R)),h)}const p=n[e];let g=s,x=l;for(fc(n,s,e),h(n[l],p)>0&&fc(n,s,l);g<x;){for(fc(n,g,x),g++,x--;h(n[g],p)<0;)g++;for(;h(n[x],p)>0;)x--}h(n[s],p)===0?fc(n,s,x):(x++,fc(n,x,l)),x<=e&&(s=x+1),e<=x&&(l=x-1)}}function fc(n,e,s){const l=n[e];n[e]=n[s],n[s]=l}function gm(n,e){return n<e?-1:n>e?1:0}function gh(n){let e=0;for(let s,l,h=0,p=n.length,g=p-1;h<p;g=h++)s=n[h],l=n[g],e+=(l.x-s.x)*(s.y+l.y);return e}function sl(n,e){n[0]=Math.min(n[0],e[0]),n[1]=Math.min(n[1],e[1]),n[2]=Math.max(n[2],e[0]),n[3]=Math.max(n[3],e[1])}function jn(n,e){return!(n[0]<=e[0]||n[2]>=e[2]||n[1]<=e[1]||n[3]>=e[3])}function mm(n,e,s){const l=n[0]-e[0],h=n[1]-e[1],p=n[0]-s[0],g=n[1]-s[1];return l*g-p*h==0&&l*p<=0&&h*g<=0}function nl(n,e,s=!1){let l=!1;for(let x=0,w=e.length;x<w;x++){const T=e[x];for(let I=0,M=T.length,R=M-1;I<M;R=I++){const B=T[R],V=T[I];if(mm(n,B,V))return s;(p=B)[1]>(h=n)[1]!=(g=V)[1]>h[1]&&h[0]<(g[0]-p[0])*(h[1]-p[1])/(g[1]-p[1])+p[0]&&(l=!l)}}var h,p,g;return l}function hp(n,e,s,l){const h=l[0]-s[0],p=l[1]-s[1],g=(n[0]-s[0])*p-h*(n[1]-s[1]),x=(e[0]-s[0])*p-h*(e[1]-s[1]);return g>0&&x<0||g<0&&x>0}function mh(n,e,s,l){return(h=[l[0]-s[0],l[1]-s[1]])[0]*(p=[e[0]-n[0],e[1]-n[1]])[1]-h[1]*p[0]!=0&&!(!hp(n,e,s,l)||!hp(s,l,n,e));var h,p}function _h(n){const e=new mt(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),s=new mt(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const l of n[0])e.x>l.x&&(e.x=l.x),e.y>l.y&&(e.y=l.y),s.x<l.x&&(s.x=l.x),s.y<l.y&&(s.y=l.y);return{min:e,max:s}}const Xa=8192;function wo(n,e){const s=(180+n[0])/360,l=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,h=Math.pow(2,e.z);return[Math.round(s*h*Xa),Math.round(l*h*Xa)]}function _m(n,e){for(let s=0;s<e.length;s++)if(nl(n,e[s]))return!0;return!1}function ym(n,e,s){for(const l of s)for(let h=0,p=l.length,g=p-1;h<p;g=h++)if(mh(n,e,l[g],l[h]))return!0;return!1}function yh(n,e){for(let s=0;s<n.length;++s)if(!nl(n[s],e))return!1;for(let s=0;s<n.length-1;++s)if(ym(n[s],n[s+1],e))return!1;return!0}function up(n,e){for(let s=0;s<e.length;s++)if(yh(n,e[s]))return!0;return!1}function xh(n,e,s){const l=[];for(let h=0;h<n.length;h++){const p=[];for(let g=0;g<n[h].length;g++){const x=wo(n[h][g],s);sl(e,x),p.push(x)}l.push(p)}return l}function Mn(n,e,s){const l=[];for(let h=0;h<n.length;h++){const p=xh(n[h],e,s);l.push(p)}return l}function dp(n,e,s,l){if(n[0]<s[0]||n[0]>s[2]){const h=.5*l;let p=n[0]-s[0]>h?-l:s[0]-n[0]>h?l:0;p===0&&(p=n[0]-s[2]>h?-l:s[2]-n[0]>h?l:0),n[0]+=p}sl(e,n)}function fp(n,e,s,l){const h=Math.pow(2,l.z)*Xa,p=[l.x*Xa,l.y*Xa],g=[];if(!n)return g;for(const x of n)for(const w of x){const T=[w.x+p[0],w.y+p[1]];dp(T,e,s,h),g.push(T)}return g}function pp(n,e,s,l){const h=Math.pow(2,l.z)*Xa,p=[l.x*Xa,l.y*Xa],g=[];if(!n)return g;for(const w of n){const T=[];for(const I of w){const M=[I.x+p[0],I.y+p[1]];sl(e,M),T.push(M)}g.push(T)}if(e[2]-e[0]<=h/2){(x=e)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const w of g)for(const T of w)dp(T,e,s,h)}var x;return g}class So{constructor(e,s){this.type=nr,this.geojson=e,this.geometries=s}static parse(e,s){if(e.length!==2)return s.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(il(e[1])){const l=e[1];if(l.type==="FeatureCollection")for(let h=0;h<l.features.length;++h){const p=l.features[h].geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new So(l,l.features[h].geometry)}else if(l.type==="Feature"){const h=l.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new So(l,l.geometry)}else if(l.type==="Polygon"||l.type==="MultiPolygon")return new So(l,l)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(s,l){const h=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],g=s.canonicalID();if(!g)return!1;if(l.type==="Polygon"){const x=xh(l.coordinates,p,g),w=fp(s.geometry(),h,p,g);if(!jn(h,p))return!1;for(const T of w)if(!nl(T,x))return!1}if(l.type==="MultiPolygon"){const x=Mn(l.coordinates,p,g),w=fp(s.geometry(),h,p,g);if(!jn(h,p))return!1;for(const T of w)if(!_m(T,x))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(s,l){const h=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],g=s.canonicalID();if(!g)return!1;if(l.type==="Polygon"){const x=xh(l.coordinates,p,g),w=pp(s.geometry(),h,p,g);if(!jn(h,p))return!1;for(const T of w)if(!yh(T,x))return!1}if(l.type==="MultiPolygon"){const x=Mn(l.coordinates,p,g),w=pp(s.geometry(),h,p,g);if(!jn(h,p))return!1;for(const T of w)if(!up(T,x))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const pc={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},nd=1/298.257223563,ad=nd*(2-nd),al=Math.PI/180;class ol{static fromTile(e,s,l){const h=Math.PI*(1-2*(e+.5)/Math.pow(2,s)),p=Math.atan(.5*(Math.exp(h)-Math.exp(-h)))/al;return new ol(p,l)}static get units(){return pc}constructor(e,s){if(e===void 0)throw new Error("No latitude given.");if(s&&!pc[s])throw new Error(`Unknown unit ${s}. Use one of: ${Object.keys(pc).join(", ")}`);const l=6378.137*al*(s?pc[s]:1),h=Math.cos(e*al),p=1/(1-ad*(1-h*h)),g=Math.sqrt(p);this.kx=l*g*h,this.ky=l*g*p*(1-ad)}distance(e,s){const l=vn(e[0]-s[0])*this.kx,h=(e[1]-s[1])*this.ky;return Math.sqrt(l*l+h*h)}bearing(e,s){const l=vn(s[0]-e[0])*this.kx;return Math.atan2(l,(s[1]-e[1])*this.ky)/al}destination(e,s,l){const h=l*al;return this.offset(e,Math.sin(h)*s,Math.cos(h)*s)}offset(e,s,l){return[e[0]+s/this.kx,e[1]+l/this.ky]}lineDistance(e){let s=0;for(let l=0;l<e.length-1;l++)s+=this.distance(e[l],e[l+1]);return s}area(e){let s=0;for(let l=0;l<e.length;l++){const h=e[l];for(let p=0,g=h.length,x=g-1;p<g;x=p++)s+=vn(h[p][0]-h[x][0])*(h[p][1]+h[x][1])*(l?-1:1)}return Math.abs(s)/2*this.kx*this.ky}along(e,s){let l=0;if(s<=0)return e[0];for(let h=0;h<e.length-1;h++){const p=e[h],g=e[h+1],x=this.distance(p,g);if(l+=x,l>s)return vh(p,g,(s-(l-x))/x)}return e[e.length-1]}pointToSegmentDistance(e,s,l){let[h,p]=s,g=vn(l[0]-h)*this.kx,x=(l[1]-p)*this.ky;if(g!==0||x!==0){const w=(vn(e[0]-h)*this.kx*g+(e[1]-p)*this.ky*x)/(g*g+x*x);w>1?(h=l[0],p=l[1]):w>0&&(h+=g/this.kx*w,p+=x/this.ky*w)}return g=vn(e[0]-h)*this.kx,x=(e[1]-p)*this.ky,Math.sqrt(g*g+x*x)}pointOnLine(e,s){let l=1/0,h=e[0][0],p=e[0][1],g=0,x=0;for(let w=0;w<e.length-1;w++){let T=e[w][0],I=e[w][1],M=vn(e[w+1][0]-T)*this.kx,R=(e[w+1][1]-I)*this.ky,B=0;M===0&&R===0||(B=(vn(s[0]-T)*this.kx*M+(s[1]-I)*this.ky*R)/(M*M+R*R),B>1?(T=e[w+1][0],I=e[w+1][1]):B>0&&(T+=M/this.kx*B,I+=R/this.ky*B)),M=vn(s[0]-T)*this.kx,R=(s[1]-I)*this.ky;const V=M*M+R*R;V<l&&(l=V,h=T,p=I,g=w,x=B)}return{point:[h,p],index:g,t:Math.max(0,Math.min(1,x))}}lineSlice(e,s,l){let h=this.pointOnLine(l,e),p=this.pointOnLine(l,s);if(h.index>p.index||h.index===p.index&&h.t>p.t){const T=h;h=p,p=T}const g=[h.point],x=h.index+1,w=p.index;!od(l[x],g[0])&&x<=w&&g.push(l[x]);for(let T=x+1;T<=w;T++)g.push(l[T]);return od(l[w],p.point)||g.push(p.point),g}lineSliceAlong(e,s,l){let h=0;const p=[];for(let g=0;g<l.length-1;g++){const x=l[g],w=l[g+1],T=this.distance(x,w);if(h+=T,h>e&&p.length===0&&p.push(vh(x,w,(e-(h-T))/T)),h>=s)return p.push(vh(x,w,(s-(h-T))/T)),p;h>e&&p.push(w)}return p}bufferPoint(e,s){const l=s/this.ky,h=s/this.kx;return[e[0]-h,e[1]-l,e[0]+h,e[1]+l]}bufferBBox(e,s){const l=s/this.ky,h=s/this.kx;return[e[0]-h,e[1]-l,e[2]+h,e[3]+l]}insideBBox(e,s){return vn(e[0]-s[0])>=0&&vn(e[0]-s[2])<=0&&e[1]>=s[1]&&e[1]<=s[3]}}function od(n,e){return n[0]===e[0]&&n[1]===e[1]}function vh(n,e,s){const l=vn(e[0]-n[0]);return[n[0]+l*s,n[1]+(e[1]-n[1])*s]}function vn(n){for(;n<-180;)n+=360;for(;n>180;)n-=360;return n}class bh{constructor(e=[],s=(l,h)=>l<h?-1:l>h?1:0){if(this.data=e,this.length=this.data.length,this.compare=s,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],s=this.data.pop();return--this.length>0&&(this.data[0]=s,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:s,compare:l}=this,h=s[e];for(;e>0;){const p=e-1>>1,g=s[p];if(l(h,g)>=0)break;s[e]=g,e=p}s[e]=h}_down(e){const{data:s,compare:l}=this,h=this.length>>1,p=s[e];for(;e<h;){let g=1+(e<<1);const x=g+1;if(x<this.length&&l(s[x],s[g])<0&&(g=x),l(s[g],p)>=0)break;s[e]=s[g],e=g}s[e]=p}}var At=8192;function ld(n,e){return e.dist-n.dist}const ll=100,cl=50;function gc(n){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==n.length)return!1;for(let s=0;s<e.length;s++)if(e[s]!==n[s])return!1;return!0}function mc(n){return n[1]-n[0]+1}function ea(n,e){const s=n[1]>=n[0]&&n[1]<e;return s||console.warn("Distance Expression: Index is out of range"),s}function wh(n,e){if(n[0]>n[1])return[null,null];const s=mc(n);if(e){if(s===2)return[n,null];const l=Math.floor(s/2);return[[n[0],n[0]+l],[n[0]+l,n[1]]]}{if(s===1)return[n,null];const l=Math.floor(s/2)-1;return[[n[0],n[0]+l],[n[0]+l+1,n[1]]]}}function Pn(n,e){const s=[1/0,1/0,-1/0,-1/0];if(!ea(e,n.length))return s;for(let l=e[0];l<=e[1];++l)sl(s,n[l]);return s}function Oi(n){const e=[1/0,1/0,-1/0,-1/0];for(let s=0;s<n.length;++s)for(let l=0;l<n[s].length;++l)sl(e,n[s][l]);return e}function hl(n,e,s){if(gc(n)||gc(e))return NaN;let l=0,h=0;return n[2]<e[0]&&(l=e[0]-n[2]),n[0]>e[2]&&(l=n[0]-e[2]),n[1]>e[3]&&(h=n[1]-e[3]),n[3]<e[1]&&(h=e[1]-n[3]),s.distance([0,0],[l,h])}function xm(n){return 360*n-180}function vm(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function Sh(n,e){const s=Math.pow(2,e.z),l=(n.y/At+e.y)/s;return[xm((n.x/At+e.x)/s),vm(l)]}function bm(n,e){const s=[];for(let l=0;l<n.length;++l)s.push(Sh(n[l],e));return s}function Lr(n,e,s){const l=s.pointOnLine(e,n).point;return s.distance(n,l)}function gp(n,e,s,l,h){const p=s.slice(l[0],l[1]+1);let g=1/0;for(let x=e[0];x<=e[1];++x)if((g=Math.min(g,Lr(n[x],p,h)))===0)return 0;return g}function cd(n,e,s,l,h){const p=Math.min(h.pointToSegmentDistance(n,s,l),h.pointToSegmentDistance(e,s,l)),g=Math.min(h.pointToSegmentDistance(s,n,e),h.pointToSegmentDistance(l,n,e));return Math.min(p,g)}function wm(n,e,s,l,h){if(!ea(e,n.length)||!ea(l,s.length))return NaN;let p=1/0;for(let g=e[0];g<e[1];++g)for(let x=l[0];x<l[1];++x){if(mh(n[g],n[g+1],s[x],s[x+1]))return 0;p=Math.min(p,cd(n[g],n[g+1],s[x],s[x+1],h))}return p}function Sm(n,e,s,l,h){if(!ea(e,n.length)||!ea(l,s.length))return NaN;let p=1/0;for(let g=e[0];g<=e[1];++g)for(let x=l[0];x<=l[1];++x)if((p=Math.min(p,h.distance(n[g],s[x])))===0)return p;return p}function Am(n,e,s){if(nl(n,e,!0))return 0;let l=1/0;for(const h of e){const p=h.length;if(p<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(h[0]!==h[p-1]&&(l=Math.min(l,s.pointToSegmentDistance(n,h[p-1],h[0])))===0||(l=Math.min(l,Lr(n,h,s)))===0)return l}return l}function Tm(n,e,s,l){if(!ea(e,n.length))return NaN;for(let p=e[0];p<=e[1];++p)if(nl(n[p],s,!0))return 0;let h=1/0;for(let p=e[0];p<e[1];++p)for(const g of s)for(let x=0,w=g.length,T=w-1;x<w;T=x++){if(mh(n[p],n[p+1],g[T],g[x]))return 0;h=Math.min(h,cd(n[p],n[p+1],g[T],g[x],l))}return h}function mp(n,e){for(const s of n)for(let l=0;l<=s.length-1;++l)if(nl(s[l],e,!0))return!0;return!1}function Em(n,e,s,l=1/0){const h=Oi(n),p=Oi(e);if(l!==1/0&&hl(h,p,s)>=l)return l;if(jn(h,p)){if(mp(n,e))return 0}else if(mp(e,n))return 0;let g=l;for(const x of n)for(let w=0,T=x.length,I=T-1;w<T;I=w++)for(const M of e)for(let R=0,B=M.length,V=B-1;R<B;V=R++){if(mh(x[I],x[w],M[V],M[R]))return 0;g=Math.min(g,cd(x[I],x[w],M[V],M[R],s))}return g}function Ah(n,e,s,l,h,p,g){if(p===null||g===null)return;const x=hl(Pn(l,p),Pn(h,g),s);x<e&&n.push({dist:x,range1:p,range2:g})}function Cm(n,e,s,l,h=1/0){let p=Math.min(l.distance(n[0],s[0][0]),h);if(p===0)return p;const g=new bh([{dist:0,range1:[0,n.length-1],range2:[0,0]}],ld),x=e?cl:ll,w=Oi(s);for(;g.length;){const T=g.pop();if(T.dist>=p)continue;const I=T.range1;if(mc(I)<=x){if(!ea(I,n.length))return NaN;if(e){const M=Tm(n,I,s,l);if((p=Math.min(p,M))===0)return p}else for(let M=I[0];M<=I[1];++M){const R=Am(n[M],s,l);if((p=Math.min(p,R))===0)return p}}else{const M=wh(I,e);if(M[0]!==null){const R=hl(Pn(n,M[0]),w,l);R<p&&g.push({dist:R,range1:M[0],range2:[0,0]})}if(M[1]!==null){const R=hl(Pn(n,M[1]),w,l);R<p&&g.push({dist:R,range1:M[1],range2:[0,0]})}}}return p}function _p(n,e,s,l,h,p=1/0){let g=Math.min(p,h.distance(n[0],s[0]));if(g===0)return g;const x=new bh([{dist:0,range1:[0,n.length-1],range2:[0,s.length-1]}],ld),w=e?cl:ll,T=l?cl:ll;for(;x.length;){const I=x.pop();if(I.dist>=g)continue;const M=I.range1,R=I.range2;if(mc(M)<=w&&mc(R)<=T){if(!ea(M,n.length)||!ea(R,s.length))return NaN;if(e&&l?g=Math.min(g,wm(n,M,s,R,h)):e||l?e&&!l?g=Math.min(g,gp(s,R,n,M,h)):!e&&l&&(g=Math.min(g,gp(n,M,s,R,h))):g=Math.min(g,Sm(n,M,s,R,h)),g===0)return g}else{const B=wh(M,e),V=wh(R,l);Ah(x,g,h,n,s,B[0],V[0]),Ah(x,g,h,n,s,B[0],V[1]),Ah(x,g,h,n,s,B[1],V[0]),Ah(x,g,h,n,s,B[1],V[1])}}return g}function hd(n,e,s,l,h=1/0){let p=h;const g=Pn(n,[0,n.length-1]);for(const x of s)if(!(p!==1/0&&hl(g,Pn(x,[0,x.length-1]),l)>=p)&&(p=Math.min(p,_p(n,e,x,!0,l,p)),p===0))return p;return p}function Th(n,e,s,l,h=1/0){let p=h;const g=Pn(n,[0,n.length-1]);for(const x of s){if(p!==1/0&&hl(g,Oi(x),l)>=p)continue;const w=Cm(n,e,x,l,p);if(isNaN(w))return w;if((p=Math.min(p,w))===0)return p}return p}function ud(n){return n==="Point"||n==="MultiPoint"||n==="LineString"||n==="MultiLineString"||n==="Polygon"||n==="MultiPolygon"}class Ao{constructor(e,s){this.type=Xt,this.geojson=e,this.geometries=s}static parse(e,s){if(e.length!==2)return s.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(il(e[1])){const l=e[1];if(l.type==="FeatureCollection"){for(let h=0;h<l.features.length;++h)if(ud(l.features[h].geometry.type))return new Ao(l,l.features[h].geometry)}else if(l.type==="Feature"){if(ud(l.geometry.type))return new Ao(l,l.geometry)}else if(ud(l.type))return new Ao(l,l)}return s.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const s=e.geometry(),l=e.canonicalID();if(s!=null&&l!=null){if(e.geometryType()==="Point")return function(h,p,g){const x=[];for(const T of h)for(const I of T)x.push(Sh(I,p));const w=new ol(x[0][1],"meters");return g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString"?_p(x,!1,g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",w):g.type==="MultiLineString"?hd(x,!1,g.coordinates,w):g.type==="Polygon"||g.type==="MultiPolygon"?Th(x,!1,g.type==="Polygon"?[g.coordinates]:g.coordinates,w):null}(s,l,this.geometries);if(e.geometryType()==="LineString")return function(h,p,g){const x=[];for(const T of h){const I=[];for(const M of T)I.push(Sh(M,p));x.push(I)}const w=new ol(x[0][0][1],"meters");if(g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString")return hd(g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",x,w);if(g.type==="MultiLineString"){let T=1/0;for(let I=0;I<g.coordinates.length;I++){const M=hd(g.coordinates[I],!0,x,w,T);if(isNaN(M))return M;if((T=Math.min(T,M))===0)return T}return T}if(g.type==="Polygon"||g.type==="MultiPolygon"){let T=1/0;for(let I=0;I<x.length;I++){const M=Th(x[I],!0,g.type==="Polygon"?[g.coordinates]:g.coordinates,w,T);if(isNaN(M))return M;if((T=Math.min(T,M))===0)return T}return T}return null}(s,l,this.geometries);if(e.geometryType()==="Polygon")return function(h,p,g){const x=[];for(const T of function(I,M){const R=I.length;if(R<=1)return[I];const B=[];let V,q;for(let Z=0;Z<R;Z++){const $=gh(I[Z]);$!==0&&(I[Z].area=Math.abs($),q===void 0&&(q=$<0),q===$<0?(V&&B.push(V),V=[I[Z]]):V.push(I[Z]))}return V&&B.push(V),B}(h)){const I=[];for(let M=0;M<T.length;++M)I.push(bm(T[M],p));x.push(I)}const w=new ol(x[0][0][0][1],"meters");if(g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString")return Th(g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",x,w);if(g.type==="MultiLineString"){let T=1/0;for(let I=0;I<g.coordinates.length;I++){const M=Th(g.coordinates[I],!0,x,w,T);if(isNaN(M))return M;if((T=Math.min(T,M))===0)return T}return T}return g.type==="Polygon"||g.type==="MultiPolygon"?function(T,I,M){let R=1/0;for(const B of T)for(const V of I){const q=Em(B,V,M,R);if(isNaN(q))return q;if((R=Math.min(R,q))===0)return R}return R}(g.type==="Polygon"?[g.coordinates]:g.coordinates,x,w):null}(s,l,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function ul(n){if(n instanceof Gs&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof So||n instanceof Ao)return!1;if(n instanceof fl)return n.featureConstant;let e=!0;return n.eachChild(s=>{e&&!ul(s)&&(e=!1)}),e}function Eh(n){if(n instanceof Gs&&n.name==="feature-state")return!1;let e=!0;return n.eachChild(s=>{e&&!Eh(s)&&(e=!1)}),e}function Ch(n){if(n instanceof fl)return new Set([n.key]);let e=new Set;return n.eachChild(s=>{e=new Set([...e,...Ch(s)])}),e}function dl(n,e){if(n instanceof Gs&&e.indexOf(n.name)>=0)return!1;let s=!0;return n.eachChild(l=>{s&&!dl(l,e)&&(s=!1)}),s}function yp(n,e,s){return[n,e,s].filter(Boolean).join("")}function dd(n,e){switch(n){case"string":return Qs(e);case"number":return+e;case"boolean":return!!e;case"color":return er.parse(e);case"formatted":return Ws.fromString(Qs(e));case"resolvedImage":return Ks.build(Qs(e))}return e}function xp(n,e,s,l){return l!==void 0&&(n=l*Math.round(n/l)),e!==void 0&&n<e&&(n=e),s!==void 0&&n>s&&(n=s),n}class fl{constructor(e,s,l,h=!1){this.type=e,this.key=s,this.scope=l,this.featureConstant=h}static parse(e,s){let l=s.expectedType;if(l==null&&(l=$i),e.length<2||e.length>3)return s.error("Invalid number of arguments for 'config' expression.");const h=s.parse(e[1],1);if(!(h instanceof bi))return s.error("Key name of 'config' expression must be a string literal.");let p,g=!0;const x=Qs(h.value);if(e.length>=3){const w=s.parse(e[2],2);if(!(w instanceof bi))return s.error("Scope of 'config' expression must be a string literal.");p=Qs(w.value)}if(s.options){const w=yp(x,p,s._scope),T=s.options.get(w);T&&(g=ul(T.value||T.default))}return new fl(l,x,p,g)}evaluate(e){const s=yp(this.key,this.scope,e.scope),l=e.getConfig(s);if(!l)return null;const{type:h,value:p,values:g,minValue:x,maxValue:w,stepValue:T}=l,I=l.default.evaluate(e);let M=I;if(p){const R=e.scope;e.scope=(R||"").split("").slice(1).join(""),M=p.evaluate(e),e.scope=R}return h&&(M=dd(h,M)),M===void 0||x===void 0&&w===void 0&&T===void 0||(typeof M=="number"?M=xp(M,x,w,T):Array.isArray(M)&&(M=M.map(R=>typeof R=="number"?xp(R,x,w,T):R))),p!==void 0&&M!==void 0&&g&&!g.includes(M)&&(M=I,h&&(M=dd(h,M))),(h&&h!==this.type||M!==void 0&&!cc(ys(M),this.type))&&(M=dd(this.type.kind,M)),M}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.scope),e}}class Ih{constructor(e,s){this.type=s.type,this.name=e,this.boundExpression=s}static parse(e,s){if(e.length!==2||typeof e[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");const l=e[1];return s.scope.has(l)?new Ih(l,s.scope.get(l)):s.error(`Unknown variable "${l}". Make sure "${l}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class kh{constructor(e,s=[],l,h=new uh,p=[],g,x,w){this.registry=e,this.path=s,this.key=s.map(T=>typeof T=="string"?`['${T}']`:`[${T}]`).join(""),this.scope=h,this.errors=p,this.expectedType=l,this._scope=g,this.options=x,this.iconImageUseTheme=w}parse(e,s,l,h,p={}){return s||l?this.concat(s,null,l,h)._parse(e,p):this._parse(e,p)}parseObjectValue(e,s,l,h,p,g={}){return this.concat(s,l,h,p)._parse(e,g)}_parse(e,s){function l(h,p,g){return g==="assert"?new ii(p,[h]):g==="coerce"?new ts(p,[h]):h}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(h){let p=h.parse(e,this);if(!p)return null;if(this.expectedType){const g=this.expectedType,x=p.type;if(g.kind!=="string"&&g.kind!=="number"&&g.kind!=="boolean"&&g.kind!=="object"&&g.kind!=="array"||x.kind!=="value")if(g.kind!=="color"&&g.kind!=="formatted"&&g.kind!=="resolvedImage"||x.kind!=="value"&&x.kind!=="string"){if(this.checkSubtype(g,x))return null}else p=l(p,g,s.typeAnnotation||"coerce");else p=l(p,g,s.typeAnnotation||"assert")}if(!(p instanceof bi)&&p.type.kind!=="resolvedImage"&&fd(p)){const g=new ba(this._scope,this.options,this.iconImageUseTheme);try{p=new bi(p.type,p.evaluate(g))}catch(x){return this.error(x.message),null}}return p}return ts.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,s,l,h){let p=typeof e=="number"?this.path.concat(e):this.path;p=typeof s=="string"?p.concat(s):p;const g=h?this.scope.concat(h):this.scope;return new kh(this.registry,p,l||null,g,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(e,...s){const l=`${this.key}${s.map(h=>`[${h}]`).join("")}`;this.errors.push(new Vn(l,e))}checkSubtype(e,s){const l=oc(e,s);return l&&this.error(l),l}}function fd(n){if(n instanceof Ih)return fd(n.boundExpression);if(n instanceof Gs&&n.name==="error"||n instanceof Ps||n instanceof So||n instanceof Ao||n instanceof fl)return!1;const e=n instanceof ts||n instanceof ii;let s=!0;return n.eachChild(l=>{s=e?s&&fd(l):s&&l instanceof bi}),!!s&&ul(n)&&dl(n,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Mh(n,e){const s=n.length-1;let l,h,p=0,g=s,x=0;for(;p<=g;)if(x=Math.floor((p+g)/2),l=n[x],h=n[x+1],l<=e){if(x===s||e<h)return x;p=x+1}else{if(!(l>e))throw new Rt("Input is not a number.");g=x-1}return 0}class _c{constructor(e,s,l){this.type=e,this.input=s,this.labels=[],this.outputs=[];for(const[h,p]of l)this.labels.push(h),this.outputs.push(p)}static parse(e,s){if(e.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return s.error("Expected an even number of arguments.");const l=s.parse(e[1],1,Xt);if(!l)return null;const h=[];let p=null;s.expectedType&&s.expectedType.kind!=="value"&&(p=s.expectedType);for(let g=1;g<e.length;g+=2){const x=g===1?-1/0:e[g],w=e[g+1],T=g,I=g+1;if(typeof x!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',T);if(h.length&&h[h.length-1][0]>=x)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',T);const M=s.parse(w,I,p);if(!M)return null;p=p||M.type,h.push([x,M])}return new _c(p,l,h)}evaluate(e){const s=this.labels,l=this.outputs;if(s.length===1)return l[0].evaluate(e);const h=this.input.evaluate(e);if(h<=s[0])return l[0].evaluate(e);const p=s.length;return h>=s[p-1]?l[p-1].evaluate(e):l[Mh(s,h)].evaluate(e)}eachChild(e){e(this.input);for(const s of this.outputs)e(s)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let s=0;s<this.labels.length;s++)s>0&&e.push(this.labels[s]),e.push(this.outputs[s].serialize());return e}}const vp=.95047,bp=1.08883,wp=4/29,Ya=6/29,Sp=3*Ya*Ya,Ap=Ya*Ya*Ya,Im=Math.PI/180,km=180/Math.PI;function pd(n){return n>Ap?Math.pow(n,1/3):n/Sp+wp}function Ph(n){return n>Ya?n*n*n:Sp*(n-wp)}function Lh(n){return 255*(n<=.0031308?12.92*n:1.055*Math.pow(n,1/2.4)-.055)}function qa(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function gd(n){const e=qa(n.r),s=qa(n.g),l=qa(n.b),h=pd((.4124564*e+.3575761*s+.1804375*l)/vp),p=pd((.2126729*e+.7151522*s+.072175*l)/1);return{l:116*p-16,a:500*(h-p),b:200*(p-pd((.0193339*e+.119192*s+.9503041*l)/bp)),alpha:n.a}}function md(n){let e=(n.l+16)/116,s=isNaN(n.a)?e:e+n.a/500,l=isNaN(n.b)?e:e-n.b/200;return e=1*Ph(e),s=vp*Ph(s),l=bp*Ph(l),new er(Lh(3.2404542*s-1.5371385*e-.4985314*l),Lh(-.969266*s+1.8760108*e+.041556*l),Lh(.0556434*s-.2040259*e+1.0572252*l),n.alpha)}function Mm(n,e,s){const l=e-n;return n+s*(l>180||l<-180?l-360*Math.round(l/360):l)}const To={forward:gd,reverse:md,interpolate:function(n,e,s){return{l:ei(n.l,e.l,s),a:ei(n.a,e.a,s),b:ei(n.b,e.b,s),alpha:ei(n.alpha,e.alpha,s)}}},Eo={forward:function(n){const{l:e,a:s,b:l}=gd(n),h=Math.atan2(l,s)*km;return{h:h<0?h+360:h,c:Math.sqrt(s*s+l*l),l:e,alpha:n.a}},reverse:function(n){const e=n.h*Im,s=n.c;return md({l:n.l,a:Math.cos(e)*s,b:Math.sin(e)*s,alpha:n.alpha})},interpolate:function(n,e,s){return{h:Mm(n.h,e.h,s),c:ei(n.c,e.c,s),l:ei(n.l,e.l,s),alpha:ei(n.alpha,e.alpha,s)}}};var Tp=Object.freeze({__proto__:null,hcl:Eo,lab:To});class bn{constructor(e,s,l,h,p){this.type=e,this.operator=s,this.interpolation=l,this.input=h,this.labels=[],this.outputs=[];for(const[g,x]of p)this.labels.push(g),this.outputs.push(x)}static interpolationFactor(e,s,l,h){let p=0;if(e.name==="exponential")p=zh(s,e.base,l,h);else if(e.name==="linear")p=zh(s,1,l,h);else if(e.name==="cubic-bezier"){const g=e.controlPoints;p=new eh(g[0],g[1],g[2],g[3]).solve(zh(s,1,l,h))}return p}static parse(e,s){let[l,h,p,...g]=e;if(!Array.isArray(h)||h.length===0)return s.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){const T=h[1];if(typeof T!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:T}}else{if(h[0]!=="cubic-bezier")return s.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const T=h.slice(1);if(T.length!==4||T.some(I=>typeof I!="number"||I<0||I>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:T}}}if(e.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(p=s.parse(p,2,Xt),!p)return null;const x=[];let w=null;l==="interpolate-hcl"||l==="interpolate-lab"?w=on:s.expectedType&&s.expectedType.kind!=="value"&&(w=s.expectedType);for(let T=0;T<g.length;T+=2){const I=g[T],M=g[T+1],R=T+3,B=T+4;if(typeof I!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',R);if(x.length&&x[x.length-1][0]>=I)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',R);const V=s.parse(M,B,w);if(!V)return null;w=w||V.type,x.push([I,V])}return w.kind==="number"||w.kind==="color"||w.kind==="array"&&w.itemType.kind==="number"&&typeof w.N=="number"?new bn(w,l,h,p,x):s.error(`Type ${cs(w)} is not interpolatable.`)}evaluate(e){const s=this.labels,l=this.outputs;if(s.length===1)return l[0].evaluate(e);const h=this.input.evaluate(e);if(h<=s[0])return l[0].evaluate(e);const p=s.length;if(h>=s[p-1])return l[p-1].evaluate(e);const g=Mh(s,h),x=bn.interpolationFactor(this.interpolation,h,s[g],s[g+1]),w=l[g].evaluate(e),T=l[g+1].evaluate(e);return this.operator==="interpolate"?xn[this.type.kind.toLowerCase()](w,T,x):this.operator==="interpolate-hcl"?Eo.reverse(Eo.interpolate(Eo.forward(w),Eo.forward(T),x)):To.reverse(To.interpolate(To.forward(w),To.forward(T),x))}eachChild(e){e(this.input);for(const s of this.outputs)e(s)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const s=[this.operator,e,this.input.serialize()];for(let l=0;l<this.labels.length;l++)s.push(this.labels[l],this.outputs[l].serialize());return s}}function zh(n,e,s,l){const h=l-s,p=n-s;return h===0?0:e===1?p/h:(Math.pow(e,p)-1)/(Math.pow(e,h)-1)}class yc{constructor(e,s){this.type=e,this.args=s}static parse(e,s){if(e.length<2)return s.error("Expectected at least one argument.");let l=null;const h=s.expectedType;h&&h.kind!=="value"&&(l=h);const p=[];for(const x of e.slice(1)){const w=s.parse(x,1+p.length,l,void 0,{typeAnnotation:"omit"});if(!w)return null;l=l||w.type,p.push(w)}const g=h&&p.some(x=>oc(h,x.type));return new yc(g?$i:l,p)}evaluate(e){let s,l=null,h=0;for(const p of this.args){if(h++,l=p.evaluate(e),l&&l instanceof Ks&&!l.available&&(s||(s=l),l=null,h===this.args.length))return s;if(l!==null)break}return l}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(s=>{e.push(s.serialize())}),e}}class Rh{constructor(e,s){this.type=s.type,this.bindings=[].concat(e),this.result=s}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const s of this.bindings)e(s[1]);e(this.result)}static parse(e,s){if(e.length<4)return s.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const l=[];for(let p=1;p<e.length-1;p+=2){const g=e[p];if(typeof g!="string")return s.error(`Expected string, but found ${typeof g} instead.`,p);if(/[^a-zA-Z0-9_]/.test(g))return s.error("Variable names must contain only alphanumeric characters or '_'.",p);const x=s.parse(e[p+1],p+1);if(!x)return null;l.push([g,x])}const h=s.parse(e[e.length-1],e.length-1,s.expectedType,l);return h?new Rh(l,h):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[s,l]of this.bindings)e.push(s,l.serialize());return e.push(this.result.serialize()),e}}class _d{constructor(e,s,l){this.type=e,this.index=s,this.input=l}static parse(e,s){if(e.length!==3)return s.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=s.parse(e[1],1,Xt),h=s.parse(e[2],2,Bs(s.expectedType||$i));return l&&h?new _d(h.type.itemType,l,h):null}evaluate(e){const s=this.index.evaluate(e),l=this.input.evaluate(e);if(s<0)throw new Rt("Array index out of bounds: negative index");if(s>=l.length)throw new Rt("Array index out of bounds: index exceeds array size");if(s!==Math.floor(s))throw new Rt("Array index must be an integer. Use at-interpolated for fractional indices");return l[s]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class yd{constructor(e,s,l){this.type=e,this.index=s,this.input=l}static parse(e,s){if(e.length!==3)return s.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=s.parse(e[1],1,Xt),h=s.parse(e[2],2,Bs(s.expectedType||$i));return l&&h?new yd(h.type.itemType,l,h):null}evaluate(e){const s=this.index.evaluate(e),l=this.input.evaluate(e);if(s<0)throw new Rt(`Array index out of bounds: ${s} < 0.`);if(s>l.length-1)throw new Rt(`Array index out of bounds: ${s} > ${l.length-1}.`);if(s===Math.floor(s))return l[s];const h=Math.floor(s),p=Math.ceil(s),g=l[h],x=l[p];if(typeof g!="number"||typeof x!="number")throw new Rt(`Cannot interpolate between non-number values at index ${s}.`);const w=s-h;return g*(1-w)+x*w}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class Dh{constructor(e,s){this.type=nr,this.needle=e,this.haystack=s}static parse(e,s){if(e.length!==3)return s.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=s.parse(e[1],1,$i),h=s.parse(e[2],2,$i);return l&&h?td(l.type,[nr,tr,Xt,Qn,$i])?new Dh(l,h):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${cs(l.type)} instead`):null}evaluate(e){const s=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(l==null)return!1;if(!lc(s,["boolean","string","number","null"]))throw new Rt(`Expected first argument to be of type boolean, string, number or null, but found ${cs(ys(s))} instead.`);if(!lc(l,["string","array"]))throw new Rt(`Expected second argument to be of type array or string, but found ${cs(ys(l))} instead.`);return l.indexOf(s)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class xc{constructor(e,s,l){this.type=Xt,this.needle=e,this.haystack=s,this.fromIndex=l}static parse(e,s){if(e.length<=2||e.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const l=s.parse(e[1],1,$i),h=s.parse(e[2],2,$i);if(!l||!h)return null;if(!td(l.type,[nr,tr,Xt,Qn,$i]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${cs(l.type)} instead`);if(e.length===4){const p=s.parse(e[3],3,Xt);return p?new xc(l,h,p):null}return new xc(l,h)}evaluate(e){const s=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(!lc(s,["boolean","string","number","null"]))throw new Rt(`Expected first argument to be of type boolean, string, number or null, but found ${cs(ys(s))} instead.`);if(!lc(l,["string","array"]))throw new Rt(`Expected second argument to be of type array or string, but found ${cs(ys(l))} instead.`);if(this.fromIndex){const h=this.fromIndex.evaluate(e);return l.indexOf(s,h)}return l.indexOf(s)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class pl{constructor(e,s,l,h,p,g){this.inputType=e,this.type=s,this.input=l,this.cases=h,this.outputs=p,this.otherwise=g}static parse(e,s){if(e.length<5)return s.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return s.error("Expected an even number of arguments.");let l,h;s.expectedType&&s.expectedType.kind!=="value"&&(h=s.expectedType);const p={},g=[];for(let T=2;T<e.length-1;T+=2){let I=e[T];const M=e[T+1];Array.isArray(I)||(I=[I]);const R=s.concat(T);if(I.length===0)return R.error("Expected at least one branch label.");for(const V of I){if(typeof V!="number"&&typeof V!="string")return R.error("Branch labels must be numbers or strings.");if(typeof V=="number"&&Math.abs(V)>Number.MAX_SAFE_INTEGER)return R.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof V=="number"&&Math.floor(V)!==V)return R.error("Numeric branch labels must be integer values.");if(l){if(R.checkSubtype(l,ys(V)))return null}else l=ys(V);if(p[String(V)]!==void 0)return R.error("Branch labels must be unique.");p[String(V)]=g.length}const B=s.parse(M,T,h);if(!B)return null;h=h||B.type,g.push(B)}const x=s.parse(e[1],1,$i);if(!x)return null;const w=s.parse(e[e.length-1],e.length-1,h);return w?x.type.kind!=="value"&&s.concat(1).checkSubtype(l,x.type)?null:new pl(l,h,x,p,g,w):null}evaluate(e){const s=this.input.evaluate(e);return(cc(ys(s),this.inputType)&&this.outputs[this.cases[s]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],s=Object.keys(this.cases).sort(),l=[],h={};for(const g of s){const x=h[this.cases[g]];x===void 0?(h[this.cases[g]]=l.length,l.push([this.cases[g],[g]])):l[x][1].push(g)}const p=g=>this.inputType.kind==="number"?Number(g):g;for(const[g,x]of l)e.push(x.length===1?p(x[0]):x.map(p)),e.push(this.outputs[g].serialize());return e.push(this.otherwise.serialize()),e}}class xd{constructor(e,s,l){this.type=e,this.branches=s,this.otherwise=l}static parse(e,s){if(e.length<4)return s.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return s.error("Expected an odd number of arguments.");let l;s.expectedType&&s.expectedType.kind!=="value"&&(l=s.expectedType);const h=[];for(let g=1;g<e.length-1;g+=2){const x=s.parse(e[g],g,nr);if(!x)return null;const w=s.parse(e[g+1],g+1,l);if(!w)return null;h.push([x,w]),l=l||w.type}const p=s.parse(e[e.length-1],e.length-1,l);return p?new xd(l,h,p):null}evaluate(e){for(const[s,l]of this.branches)if(s.evaluate(e))return l.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[s,l]of this.branches)e(s),e(l);e(this.otherwise)}outputDefined(){return this.branches.every(([e,s])=>s.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(s=>{e.push(s.serialize())}),e}}class vc{constructor(e,s,l,h){this.type=e,this.input=s,this.beginIndex=l,this.endIndex=h}static parse(e,s){if(e.length<=2||e.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const l=s.parse(e[1],1,$i),h=s.parse(e[2],2,Xt);if(!l||!h)return null;if(!td(l.type,[Bs($i),tr,$i]))return s.error(`Expected first argument to be of type array or string, but found ${cs(l.type)} instead`);if(e.length===4){const p=s.parse(e[3],3,Xt);return p?new vc(l.type,l,h,p):null}return new vc(l.type,l,h)}evaluate(e){const s=this.input.evaluate(e),l=this.beginIndex.evaluate(e);if(!lc(s,["string","array"]))throw new Rt(`Expected first argument to be of type array or string, but found ${cs(ys(s))} instead.`);if(this.endIndex){const h=this.endIndex.evaluate(e);return s.slice(l,h)}return s.slice(l)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class vd{constructor(e,s){this.type=Bs(tr),this.str=e,this.delimiter=s}static parse(e,s){if(e.length!==3)return s.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=s.parse(e[1],1,tr),h=s.parse(e[2],2,tr);return l&&h?new vd(l,h):void 0}evaluate(e){const s=this.str.evaluate(e),l=this.delimiter.evaluate(e);return s.split(l)}eachChild(e){e(this.str),e(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function Ep(n,e){return n==="=="||n==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function bd(n,e,s,l){return l.compare(e,s)===0}function Co(n,e,s){const l=n!=="=="&&n!=="!=";return class Bw{constructor(p,g,x){this.type=nr,this.lhs=p,this.rhs=g,this.collator=x,this.hasUntypedArgument=p.type.kind==="value"||g.type.kind==="value"}static parse(p,g){if(p.length!==3&&p.length!==4)return g.error("Expected two or three arguments.");const x=p[0];let w=g.parse(p[1],1,$i);if(!w)return null;if(!Ep(x,w.type))return g.concat(1).error(`"${x}" comparisons are not supported for type '${cs(w.type)}'.`);let T=g.parse(p[2],2,$i);if(!T)return null;if(!Ep(x,T.type))return g.concat(2).error(`"${x}" comparisons are not supported for type '${cs(T.type)}'.`);if(w.type.kind!==T.type.kind&&w.type.kind!=="value"&&T.type.kind!=="value")return g.error(`Cannot compare types '${cs(w.type)}' and '${cs(T.type)}'.`);l&&(w.type.kind==="value"&&T.type.kind!=="value"?w=new ii(T.type,[w]):w.type.kind!=="value"&&T.type.kind==="value"&&(T=new ii(w.type,[T])));let I=null;if(p.length===4){if(w.type.kind!=="string"&&T.type.kind!=="string"&&w.type.kind!=="value"&&T.type.kind!=="value")return g.error("Cannot use collator to compare non-string types.");if(I=g.parse(p[3],3,dh),!I)return null}return new Bw(w,T,I)}evaluate(p){const g=this.lhs.evaluate(p),x=this.rhs.evaluate(p);if(l&&this.hasUntypedArgument){const w=ys(g),T=ys(x);if(w.kind!==T.kind||w.kind!=="string"&&w.kind!=="number")throw new Rt(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${w.kind}, ${T.kind}) instead.`)}if(this.collator&&!l&&this.hasUntypedArgument){const w=ys(g),T=ys(x);if(w.kind!=="string"||T.kind!=="string")return e(p,g,x)}return this.collator?s(p,g,x,this.collator.evaluate(p)):e(p,g,x)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}serialize(){const p=[n];return this.eachChild(g=>{p.push(g.serialize())}),p}}}const Pm=Co("==",function(n,e,s){return e===s},bd),Lm=Co("!=",function(n,e,s){return e!==s},function(n,e,s,l){return!bd(0,e,s,l)}),zm=Co("<",function(n,e,s){return e<s},function(n,e,s,l){return l.compare(e,s)<0}),Oh=Co(">",function(n,e,s){return e>s},function(n,e,s,l){return l.compare(e,s)>0}),Rm=Co("<=",function(n,e,s){return e<=s},function(n,e,s,l){return l.compare(e,s)<=0}),Dm=Co(">=",function(n,e,s){return e>=s},function(n,e,s,l){return l.compare(e,s)>=0});class wd{constructor(e,s,l,h,p,g){this.type=tr,this.number=e,this.locale=s,this.currency=l,this.unit=h,this.minFractionDigits=p,this.maxFractionDigits=g}static parse(e,s){if(e.length!==3)return s.error("Expected two arguments.");const l=s.parse(e[1],1,Xt);if(!l)return null;const h=e[2];if(typeof h!="object"||Array.isArray(h))return s.error("NumberFormat options argument must be an object.");let p=null;if(h.locale&&(p=s.parseObjectValue(h.locale,2,"locale",tr),!p))return null;let g=null;if(h.currency&&(g=s.parseObjectValue(h.currency,2,"currency",tr),!g))return null;let x=null;if(h.unit&&(x=s.parseObjectValue(h.unit,2,"unit",tr),!x))return null;let w=null;if(h["min-fraction-digits"]&&(w=s.parseObjectValue(h["min-fraction-digits"],2,"min-fraction-digits",Xt),!w))return null;let T=null;return h["max-fraction-digits"]&&(T=s.parseObjectValue(h["max-fraction-digits"],2,"max-fraction-digits",Xt),!T)?null:new wd(l,p,g,x,w,T)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Sd{constructor(e){this.type=Xt,this.input=e}static parse(e,s){if(e.length!==2)return s.error(`Expected 1 argument, but found ${e.length-1} instead.`);const l=s.parse(e[1],1);return l?l.type.kind!=="array"&&l.type.kind!=="string"&&l.type.kind!=="value"?s.error(`Expected argument of type string or array, but found ${cs(l.type)} instead.`):new Sd(l):null}evaluate(e){const s=this.input.evaluate(e);if(typeof s=="string"||Array.isArray(s))return s.length;throw new Rt(`Expected value to be of type string or array, but found ${cs(ys(s))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(s=>{e.push(s.serialize())}),e}}function Ad(n){return function(){n=1831565813+(n|=0)|0;let e=Math.imul(n^n>>>15,1|n);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const gl={"==":Pm,"!=":Lm,">":Oh,"<":zm,">=":Dm,"<=":Rm,array:ii,at:_d,"at-interpolated":yd,boolean:ii,case:xd,coalesce:yc,collator:Ps,format:bo,image:rl,in:Dh,"index-of":xc,interpolate:bn,"interpolate-hcl":bn,"interpolate-lab":bn,length:Sd,let:Rh,literal:bi,match:pl,number:ii,"number-format":wd,object:ii,slice:vc,step:_c,string:ii,"to-boolean":ts,"to-color":ts,"to-number":ts,"to-string":ts,var:Ih,within:So,distance:Ao,config:fl,split:vd};function Cp(n,[e,s,l,h]){e=e.evaluate(n),s=s.evaluate(n),l=l.evaluate(n);const p=h?h.evaluate(n):1,g=lp(e,s,l,p);if(g)throw new Rt(g);return new er(e/255,s/255,l/255,p)}function Td(n,[e,s,l,h]){e=e.evaluate(n),s=s.evaluate(n),l=l.evaluate(n);const p=h?h.evaluate(n):1,g=function(T,I,M,R){return typeof T=="number"&&T>=0&&T<=360?typeof I=="number"&&I>=0&&I<=100&&typeof M=="number"&&M>=0&&M<=100?R===void 0||typeof R=="number"&&R>=0&&R<=1?null:`Invalid hsla value [${[T,I,M,R].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof R=="number"?[T,I,M,R]:[T,I,M]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof R=="number"?[T,I,M,R]:[T,I,M]).join(", ")}]: 'h' must be between 0 and 360.`}(e,s,l,p);if(g)throw new Rt(g);const x=`hsla(${e}, ${s}%, ${l}%, ${p})`,w=er.parse(x);if(!w)throw new Rt(`Failed to parse HSLA color: ${x}`);return w}function Ed(n,e){return n in e}function Fh(n,e){const s=e[n];return s===void 0?null:s}function Io(n){return{type:n}}function ko(n){return{result:"success",value:n}}function Za(n){return{result:"error",value:n}}function Cd(n,e){return!!n&&!!n.parameters&&n.parameters.indexOf(e)>-1}function Bh(n){return n["property-type"]==="data-driven"}function Id(n){return Cd(n.expression,"measure-light")}function kd(n){return Cd(n.expression,"zoom")}function Nh(n){return!!n.expression&&n.expression.interpolated}function Vh(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}function Md(n){return n}function Uh(n,e){const s=e.type==="color",l=n.stops&&typeof n.stops[0][0]=="object",h=l||!(l||n.property!==void 0),p=n.type||(Nh(e)?"exponential":"interval");if(s&&((n=Object.assign({},n)).stops&&(n.stops=n.stops.map(T=>[T[0],er.parse(T[1])])),n.default=er.parse(n.default?n.default:e.default)),n.colorSpace&&n.colorSpace!=="rgb"&&!Tp[n.colorSpace])throw new Error(`Unknown color space: ${n.colorSpace}`);let g,x,w;if(p==="exponential")g=Ip;else if(p==="interval")g=$a;else if(p==="categorical"){g=Om,x=Object.create(null);for(const T of n.stops)x[T[0]]=T[1];w=typeof n.stops[0][0]}else{if(p!=="identity")throw new Error(`Unknown function type "${p}"`);g=Fm}if(l){const T={},I=[];for(let B=0;B<n.stops.length;B++){const V=n.stops[B],q=V[0].zoom;T[q]===void 0&&(T[q]={zoom:q,type:n.type,property:n.property,default:n.default,stops:[]},I.push(q)),T[q].stops.push([V[0].value,V[1]])}const M=[];for(const B of I)M.push([T[B].zoom,Uh(T[B],e)]);const R={name:"linear"};return{kind:"composite",interpolationType:R,interpolationFactor:bn.interpolationFactor.bind(void 0,R),zoomStops:M.map(B=>B[0]),evaluate:({zoom:B},V)=>Ip({stops:M,base:n.base},e,B).evaluate(B,V)}}if(h){const T=p==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:T,interpolationFactor:bn.interpolationFactor.bind(void 0,T),zoomStops:n.stops.map(I=>I[0]),evaluate:({zoom:I})=>g(n,e,I,x,w)}}return{kind:"source",evaluate(T,I){const M=I&&I.properties?I.properties[n.property]:void 0;return M===void 0?ml(n.default,e.default):g(n,e,M,x,w)}}}function ml(n,e,s){return n!==void 0?n:e!==void 0?e:s!==void 0?s:void 0}function Om(n,e,s,l,h){return ml(typeof s===h?l[s]:void 0,n.default,e.default)}function $a(n,e,s){if(!dc(s))return ml(n.default,e.default);const l=n.stops.length;if(l===1||s<=n.stops[0][0])return n.stops[0][1];if(s>=n.stops[l-1][0])return n.stops[l-1][1];const h=Mh(n.stops.map(p=>p[0]),s);return n.stops[h][1]}function Ip(n,e,s){const l=n.base!==void 0?n.base:1;if(!dc(s))return ml(n.default,e.default);const h=n.stops.length;if(h===1||s<=n.stops[0][0])return n.stops[0][1];if(s>=n.stops[h-1][0])return n.stops[h-1][1];const p=Mh(n.stops.map(I=>I[0]),s),g=function(I,M,R,B){const V=B-R,q=I-R;return V===0?0:M===1?q/V:(Math.pow(M,q)-1)/(Math.pow(M,V)-1)}(s,l,n.stops[p][0],n.stops[p+1][0]),x=n.stops[p][1],w=n.stops[p+1][1];let T=xn[e.type]||Md;if(n.colorSpace&&n.colorSpace!=="rgb"){const I=Tp[n.colorSpace];T=(M,R)=>I.reverse(I.interpolate(I.forward(M),I.forward(R),g))}return typeof x.evaluate=="function"?{evaluate(...I){const M=x.evaluate.apply(void 0,I),R=w.evaluate.apply(void 0,I);if(M!==void 0&&R!==void 0)return T(M,R,g)}}:T(x,w,g)}function Fm(n,e,s){return e.type==="color"?s=er.parse(s):e.type==="formatted"?s=Ws.fromString(s.toString()):e.type==="resolvedImage"?s=Ks.build(s.toString()):ai(s)===e.type||e.type==="enum"&&e.values[s]||(s=void 0),ml(s,n.default,e.default)}Gs.register(gl,{error:[{kind:"error"},[tr],(n,[e])=>{throw new Rt(e.evaluate(n))}],typeof:[tr,[$i],(n,[e])=>cs(ys(e.evaluate(n)))],"to-rgba":[Bs(Xt,4),[on],(n,[e])=>e.evaluate(n).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[Bs(Xt,4),[on],(n,[e])=>e.evaluate(n).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[on,[Xt,Xt,Xt],Cp],rgba:[on,[Xt,Xt,Xt,Xt],Cp],hsl:[on,[Xt,Xt,Xt],Td],hsla:[on,[Xt,Xt,Xt,Xt],Td],has:{type:nr,overloads:[[[tr],(n,[e])=>Ed(e.evaluate(n),n.properties())],[[tr,vo],(n,[e,s])=>Ed(e.evaluate(n),s.evaluate(n))]]},get:{type:$i,overloads:[[[tr],(n,[e])=>Fh(e.evaluate(n),n.properties())],[[tr,vo],(n,[e,s])=>Fh(e.evaluate(n),s.evaluate(n))]]},"feature-state":[$i,[tr],(n,[e])=>Fh(e.evaluate(n),n.featureState||{})],properties:[vo,[],n=>n.properties()],"geometry-type":[tr,[],n=>n.geometryType()],worldview:[tr,[],n=>n.globals.worldview||""],id:[$i,[],n=>n.id()],zoom:[Xt,[],n=>n.globals.zoom],pitch:[Xt,[],n=>n.globals.pitch||0],"distance-from-center":[Xt,[],n=>n.distanceFromCenter()],"measure-light":[Xt,[tr],(n,[e])=>n.measureLight(e.evaluate(n))],"heatmap-density":[Xt,[],n=>n.globals.heatmapDensity||0],"line-progress":[Xt,[],n=>n.globals.lineProgress||0],"raster-value":[Xt,[],n=>n.globals.rasterValue||0],"raster-particle-speed":[Xt,[],n=>n.globals.rasterParticleSpeed||0],"sky-radial-progress":[Xt,[],n=>n.globals.skyRadialProgress||0],accumulated:[$i,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[Xt,Io(Xt),(n,e)=>{let s=0;for(const l of e)s+=l.evaluate(n);return s}],"*":[Xt,Io(Xt),(n,e)=>{let s=1;for(const l of e)s*=l.evaluate(n);return s}],"-":{type:Xt,overloads:[[[Xt,Xt],(n,[e,s])=>e.evaluate(n)-s.evaluate(n)],[[Xt],(n,[e])=>-e.evaluate(n)]]},"/":[Xt,[Xt,Xt],(n,[e,s])=>e.evaluate(n)/s.evaluate(n)],"%":[Xt,[Xt,Xt],(n,[e,s])=>e.evaluate(n)%s.evaluate(n)],ln2:[Xt,[],()=>Math.LN2],pi:[Xt,[],()=>Math.PI],e:[Xt,[],()=>Math.E],"^":[Xt,[Xt,Xt],(n,[e,s])=>Math.pow(e.evaluate(n),s.evaluate(n))],sqrt:[Xt,[Xt],(n,[e])=>Math.sqrt(e.evaluate(n))],log10:[Xt,[Xt],(n,[e])=>Math.log(e.evaluate(n))/Math.LN10],ln:[Xt,[Xt],(n,[e])=>Math.log(e.evaluate(n))],log2:[Xt,[Xt],(n,[e])=>Math.log2(e.evaluate(n))],sin:[Xt,[Xt],(n,[e])=>Math.sin(e.evaluate(n))],cos:[Xt,[Xt],(n,[e])=>Math.cos(e.evaluate(n))],tan:[Xt,[Xt],(n,[e])=>Math.tan(e.evaluate(n))],asin:[Xt,[Xt],(n,[e])=>Math.asin(e.evaluate(n))],acos:[Xt,[Xt],(n,[e])=>Math.acos(e.evaluate(n))],atan:[Xt,[Xt],(n,[e])=>Math.atan(e.evaluate(n))],min:[Xt,Io(Xt),(n,e)=>Math.min(...e.map(s=>s.evaluate(n)))],max:[Xt,Io(Xt),(n,e)=>Math.max(...e.map(s=>s.evaluate(n)))],abs:[Xt,[Xt],(n,[e])=>Math.abs(e.evaluate(n))],round:[Xt,[Xt],(n,[e])=>{const s=e.evaluate(n);return s<0?-Math.round(-s):Math.round(s)}],floor:[Xt,[Xt],(n,[e])=>Math.floor(e.evaluate(n))],ceil:[Xt,[Xt],(n,[e])=>Math.ceil(e.evaluate(n))],"filter-==":[nr,[tr,$i],(n,[e,s])=>n.properties()[e.value]===s.value],"filter-id-==":[nr,[$i],(n,[e])=>n.id()===e.value],"filter-type-==":[nr,[tr],(n,[e])=>n.geometryType()===e.value],"filter-<":[nr,[tr,$i],(n,[e,s])=>{const l=n.properties()[e.value],h=s.value;return typeof l==typeof h&&l<h}],"filter-id-<":[nr,[$i],(n,[e])=>{const s=n.id(),l=e.value;return typeof s==typeof l&&s<l}],"filter->":[nr,[tr,$i],(n,[e,s])=>{const l=n.properties()[e.value],h=s.value;return typeof l==typeof h&&l>h}],"filter-id->":[nr,[$i],(n,[e])=>{const s=n.id(),l=e.value;return typeof s==typeof l&&s>l}],"filter-<=":[nr,[tr,$i],(n,[e,s])=>{const l=n.properties()[e.value],h=s.value;return typeof l==typeof h&&l<=h}],"filter-id-<=":[nr,[$i],(n,[e])=>{const s=n.id(),l=e.value;return typeof s==typeof l&&s<=l}],"filter->=":[nr,[tr,$i],(n,[e,s])=>{const l=n.properties()[e.value],h=s.value;return typeof l==typeof h&&l>=h}],"filter-id->=":[nr,[$i],(n,[e])=>{const s=n.id(),l=e.value;return typeof s==typeof l&&s>=l}],"filter-has":[nr,[$i],(n,[e])=>e.value in n.properties()],"filter-has-id":[nr,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[nr,[Bs(tr)],(n,[e])=>e.value.indexOf(n.geometryType())>=0],"filter-id-in":[nr,[Bs($i)],(n,[e])=>e.value.indexOf(n.id())>=0],"filter-in-small":[nr,[tr,Bs($i)],(n,[e,s])=>s.value.indexOf(n.properties()[e.value])>=0],"filter-in-large":[nr,[tr,Bs($i)],(n,[e,s])=>function(l,h,p,g){for(;p<=g;){const x=p+g>>1;if(h[x]===l)return!0;h[x]>l?g=x-1:p=x+1}return!1}(n.properties()[e.value],s.value,0,s.value.length-1)],all:{type:nr,overloads:[[[nr,nr],(n,[e,s])=>e.evaluate(n)&&s.evaluate(n)],[Io(nr),(n,e)=>{for(const s of e)if(!s.evaluate(n))return!1;return!0}]]},any:{type:nr,overloads:[[[nr,nr],(n,[e,s])=>e.evaluate(n)||s.evaluate(n)],[Io(nr),(n,e)=>{for(const s of e)if(s.evaluate(n))return!0;return!1}]]},"!":[nr,[nr],(n,[e])=>!e.evaluate(n)],"is-supported-script":[nr,[tr],(n,[e])=>{const s=n.globals&&n.globals.isSupportedScript;return!s||s(e.evaluate(n))}],upcase:[tr,[tr],(n,[e])=>e.evaluate(n).toUpperCase()],downcase:[tr,[tr],(n,[e])=>e.evaluate(n).toLowerCase()],concat:[tr,Io($i),(n,e)=>e.map(s=>Qs(s.evaluate(n))).join("")],"resolved-locale":[tr,[dh],(n,[e])=>e.evaluate(n).resolvedLocale()],random:[Xt,[Xt,Xt,$i],(n,e)=>{const[s,l,h]=e.map(g=>g.evaluate(n));if(s>l||s===l)return s;let p;if(typeof h=="string")p=function(g){let x=0;if(g.length===0)return x;for(let w=0;w<g.length;w++)x=(x<<5)-x+g.charCodeAt(w),x|=0;return x}(h);else{if(typeof h!="number")throw new Rt(`Invalid seed input: ${h}`);p=h}return s+Ad(p)()*(l-s)}]});class jh{constructor(e,s,l,h,p){this.expression=e,this._warningHistory={},this._evaluator=new ba(l,h,p),this._defaultValue=s?function(g){return g.type==="color"&&(Vh(g.default)||Array.isArray(g.default))?new er(0,0,0,0):g.type==="color"?er.parse(g.default)||null:g.default===void 0?null:g.default}(s):null,this._enumValues=s&&s.type==="enum"?s.values:null,this.configDependencies=Ch(e)}evaluateWithoutErrorHandling(e,s,l,h,p,g,x,w){return this._evaluator.globals=e,this._evaluator.feature=s,this._evaluator.featureState=l,this._evaluator.canonical=h||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=g,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=w||null,this.expression.evaluate(this._evaluator)}evaluate(e,s,l,h,p,g,x,w,T){this._evaluator.globals=e,this._evaluator.feature=s||null,this._evaluator.featureState=l||null,this._evaluator.canonical=h||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=g||null,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=w||null,this._evaluator.iconImageUseTheme=T||null;try{const I=this.expression.evaluate(this._evaluator);if(I==null||typeof I=="number"&&I!=I)return this._defaultValue;if(this._enumValues&&!(I in this._enumValues))throw new Rt(`Expected value to be one of ${Object.keys(this._enumValues).map(M=>JSON.stringify(M)).join(", ")}, but found ${JSON.stringify(I)} instead.`);return I}catch(I){return this._warningHistory[I.message]||(this._warningHistory[I.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${I.message}`)),this._defaultValue}}}function Pd(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in gl}function ta(n,e,s,l,h){const p=new kh(gl,[],e?function(x){const w={color:on,string:tr,number:Xt,enum:tr,boolean:nr,formatted:Ha,resolvedImage:ac};return x.type==="array"?Bs(w[x.value]||$i,x.length):w[x.type]}(e):void 0,void 0,void 0,s,l,h),g=p.parse(n,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return g?ko(new jh(g,e,s,l,h)):Za(p.errors)}class bc{constructor(e,s,l,h){this.kind=e,this._styleExpression=s,this.isLightConstant=l,this.isLineProgressConstant=h,this.isStateDependent=e!=="constant"&&!Eh(s.expression),this.configDependencies=Ch(s.expression)}evaluateWithoutErrorHandling(e,s,l,h,p,g){return this._styleExpression.evaluateWithoutErrorHandling(e,s,l,h,p,g)}evaluate(e,s,l,h,p,g,x){return this._styleExpression.evaluate(e,s,l,h,p,g,void 0,void 0,x)}}class Ja{constructor(e,s,l,h,p,g){this.kind=e,this.zoomStops=l,this._styleExpression=s,this.isStateDependent=e!=="camera"&&!Eh(s.expression),this.isLightConstant=p,this.isLineProgressConstant=g,this.configDependencies=Ch(s.expression),this.interpolationType=h}evaluateWithoutErrorHandling(e,s,l,h,p,g){return this._styleExpression.evaluateWithoutErrorHandling(e,s,l,h,p,g)}evaluate(e,s,l,h,p,g){return this._styleExpression.evaluate(e,s,l,h,p,g)}interpolationFactor(e,s,l){return this.interpolationType?bn.interpolationFactor(this.interpolationType,e,s,l):0}}function Ld(n,e,s,l,h){if((n=ta(n,e,s,l,h)).result==="error")return n;const p=n.value.expression,g=ul(p);if(!g&&!Bh(e))return Za([new Vn("","data expressions not supported")]);const x=dl(p,["zoom","pitch","distance-from-center"]);if(!x&&!kd(e))return Za([new Vn("","zoom expressions not supported")]);const w=dl(p,["measure-light"]);if(!w&&!Id(e))return Za([new Vn("","measure-light expression not supported")]);const T=dl(p,["line-progress"]);if(!T&&!function(R){return Cd(R.expression,"line-progress")}(e))return Za([new Vn("","line-progress expression not supported")]);const I=e.expression&&e.expression.relaxZoomRestriction,M=Wh(p);return M||x||I?M instanceof Vn?Za([M]):M instanceof bn&&!Nh(e)?Za([new Vn("",'"interpolate" expressions cannot be used with this property')]):ko(M?new Ja(g&&T?"camera":"composite",n.value,M.labels,M instanceof bn?M.interpolation:void 0,w,T):new bc(g&&T?"constant":"source",n.value,w,T)):Za([new Vn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Hh{constructor(e,s){this._parameters=e,this._specification=s,Object.assign(this,Uh(this._parameters,this._specification))}static deserialize(e){return new Hh(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Wh(n){let e=null;if(n instanceof Rh)e=Wh(n.result);else if(n instanceof yc){for(const s of n.args)if(e=Wh(s),e)break}else(n instanceof _c||n instanceof bn)&&n.input instanceof Gs&&n.input.name==="zoom"&&(e=n);return e instanceof Vn||n.eachChild(s=>{const l=Wh(s);l instanceof Vn?e=l:e&&l&&e!==l&&(e=new Vn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var wc,Gh,kp=function(){if(Gh)return wc;Gh=1,wc=e;var n=3;function e(s,l,h){var p=this.cells=[];if(s instanceof ArrayBuffer){this.arrayBuffer=s;var g=new Int32Array(this.arrayBuffer);s=g[0],this.d=(l=g[1])+2*(h=g[2]);for(var x=0;x<this.d*this.d;x++){var w=g[n+x],T=g[n+x+1];p.push(w===T?null:g.subarray(w,T))}var I=g[n+p.length+1];this.keys=g.subarray(g[n+p.length],I),this.bboxes=g.subarray(I),this.insert=this._insertReadonly}else{this.d=l+2*h;for(var M=0;M<this.d*this.d;M++)p.push([]);this.keys=[],this.bboxes=[]}this.n=l,this.extent=s,this.padding=h,this.scale=l/s,this.uid=0;var R=h/l*s;this.min=-R,this.max=s+R}return e.prototype.insert=function(s,l,h,p,g){this._forEachCell(l,h,p,g,this._insertCell,this.uid++),this.keys.push(s),this.bboxes.push(l),this.bboxes.push(h),this.bboxes.push(p),this.bboxes.push(g)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(s,l,h,p,g,x){this.cells[g].push(x)},e.prototype.query=function(s,l,h,p,g){var x=this.min,w=this.max;if(s<=x&&l<=x&&w<=h&&w<=p&&!g)return Array.prototype.slice.call(this.keys);var T=[];return this._forEachCell(s,l,h,p,this._queryCell,T,{},g),T},e.prototype._queryCell=function(s,l,h,p,g,x,w,T){var I=this.cells[g];if(I!==null)for(var M=this.keys,R=this.bboxes,B=0;B<I.length;B++){var V=I[B];if(w[V]===void 0){var q=4*V;(T?T(R[q+0],R[q+1],R[q+2],R[q+3]):s<=R[q+2]&&l<=R[q+3]&&h>=R[q+0]&&p>=R[q+1])?(w[V]=!0,x.push(M[V])):w[V]=!1}}},e.prototype._forEachCell=function(s,l,h,p,g,x,w,T){for(var I=this._convertToCellCoord(s),M=this._convertToCellCoord(l),R=this._convertToCellCoord(h),B=this._convertToCellCoord(p),V=I;V<=R;V++)for(var q=M;q<=B;q++){var Z=this.d*q+V;if((!T||T(this._convertFromCellCoord(V),this._convertFromCellCoord(q),this._convertFromCellCoord(V+1),this._convertFromCellCoord(q+1)))&&g.call(this,s,l,h,p,Z,x,w,T))return}},e.prototype._convertFromCellCoord=function(s){return(s-this.padding)/this.scale},e.prototype._convertToCellCoord=function(s){return Math.max(0,Math.min(this.d-1,Math.floor(s*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var s=this.cells,l=n+this.cells.length+1+1,h=0,p=0;p<this.cells.length;p++)h+=this.cells[p].length;var g=new Int32Array(l+h+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;for(var x=l,w=0;w<s.length;w++){var T=s[w];g[n+w]=x,g.set(T,x),x+=T.length}return g[n+s.length]=x,g.set(this.keys,x),g[n+s.length+1]=x+=this.keys.length,g.set(this.bboxes,x),x+=this.bboxes.length,g.buffer},wc}(),Mo=$l(kp);const _l={};function Dt(n,e,s={}){Object.defineProperty(n,"_classRegistryKey",{value:e,writable:!1}),_l[e]={klass:n,omit:s.omit||[]}}Dt(Object,"Object"),Mo.serialize=function(n,e){const s=n.toArrayBuffer();return e&&e.add(s),{buffer:s}},Mo.deserialize=function(n){return new Mo(n.buffer)},Object.defineProperty(Mo,"name",{value:"Grid"}),Dt(Mo,"Grid"),delete mt.prototype.constructor,typeof DOMMatrix<"u"&&Dt(DOMMatrix,"DOMMatrix"),Dt(er,"Color"),Dt(Error,"Error"),Dt(Ws,"Formatted"),Dt(fh,"FormattedSection"),Dt(Zu,"AJAXError"),Dt(Ks,"ResolvedImage"),Dt(Hh,"StylePropertyFunction"),Dt(jh,"StyleExpression",{omit:["_evaluator"]}),Dt(yn,"ImageId"),Dt(Un,"ImageVariant"),Dt(Ja,"ZoomDependentExpression"),Dt(bc,"ZoomConstantExpression"),Dt(Gs,"CompoundExpression",{omit:["_evaluate"]});for(const n in gl)_l[gl[n]._classRegistryKey]||Dt(gl[n],`Expression${n}`);function zd(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function wa(n){return self.ImageBitmap&&n instanceof ImageBitmap}function Ka(n,e){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp)return n;if(zd(n)||wa(n))return e&&e.add(n),n;if(ArrayBuffer.isView(n))return e&&e.add(n.buffer),n;if(n instanceof ImageData)return e&&e.add(n.data.buffer),n;if(Array.isArray(n)){const s=[];for(const l of n)s.push(Ka(l,e));return s}if(n instanceof Map){const s={$name:"Map",entries:[]};for(const[l,h]of n.entries())s.entries.push(Ka(l),Ka(h,e));return s}if(n instanceof Set){const s={$name:"Set"};let l=0;for(const h of n.values())s[++l]=Ka(h);return s}if(n instanceof DOMMatrix){const s={$name:"DOMMatrix"},l=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const h of l)s[h]=n[h];return s}if(typeof n=="bigint")return{$name:"BigInt",value:n.toString()};if(typeof n=="object"){const s=n.constructor,l=s._classRegistryKey;if(!l)throw new Error(`Can't serialize object of unregistered class "${s.name}".`);const h=s.serialize?s.serialize(n,e):{};if(!s.serialize){for(const p in n)n.hasOwnProperty(p)&&(_l[l].omit.indexOf(p)>=0||(h[p]=Ka(n[p],e)));n instanceof Error&&(h.message=n.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return l!=="Object"&&(h.$name=l),h}throw new Error("can't serialize object of type "+typeof n)}function Qa(n){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||zd(n)||wa(n)||ArrayBuffer.isView(n)||n instanceof ImageData)return n;if(Array.isArray(n))return n.map(Qa);if(typeof n=="object"){const e=n.$name||"Object";if(e==="Map"){const h=n.entries||[],p=new Map;for(let g=0;g<h.length;g+=2)p.set(Qa(h[g]),Qa(h[g+1]));return p}if(e==="Set"){const h=new Set;for(const p of Object.keys(n))p!=="$name"&&h.add(Qa(n[p]));return h}if(e==="DOMMatrix"){let h;return h=n.is2D?[n.a,n.b,n.c,n.d,n.e,n.f]:[n.m11,n.m12,n.m13,n.m14,n.m21,n.m22,n.m23,n.m24,n.m31,n.m32,n.m33,n.m34,n.m41,n.m42,n.m43,n.m44],new DOMMatrix(h)}if(e==="BigInt")return BigInt(n.value);const{klass:s}=_l[e];if(!s)throw new Error(`Can't deserialize unregistered class "${e}".`);if(s.deserialize)return s.deserialize(n);const l=Object.create(s.prototype);for(const h of Object.keys(n))h!=="$name"&&(l[h]=Qa(n[h]));return l}throw new Error("can't deserialize object of type "+typeof n)}const Qt={"Latin-1 Supplement":n=>n>=128&&n<=255,Arabic:n=>n>=1536&&n<=1791,"Arabic Supplement":n=>n>=1872&&n<=1919,"Arabic Extended-A":n=>n>=2208&&n<=2303,"Hangul Jamo":n=>n>=4352&&n<=4607,"Unified Canadian Aboriginal Syllabics":n=>n>=5120&&n<=5759,Khmer:n=>n>=6016&&n<=6143,"Unified Canadian Aboriginal Syllabics Extended":n=>n>=6320&&n<=6399,"General Punctuation":n=>n>=8192&&n<=8303,"Letterlike Symbols":n=>n>=8448&&n<=8527,"Number Forms":n=>n>=8528&&n<=8591,"Miscellaneous Technical":n=>n>=8960&&n<=9215,"Control Pictures":n=>n>=9216&&n<=9279,"Optical Character Recognition":n=>n>=9280&&n<=9311,"Enclosed Alphanumerics":n=>n>=9312&&n<=9471,"Geometric Shapes":n=>n>=9632&&n<=9727,"Miscellaneous Symbols":n=>n>=9728&&n<=9983,"Miscellaneous Symbols and Arrows":n=>n>=11008&&n<=11263,"CJK Radicals Supplement":n=>n>=11904&&n<=12031,"Kangxi Radicals":n=>n>=12032&&n<=12255,"Ideographic Description Characters":n=>n>=12272&&n<=12287,"CJK Symbols and Punctuation":n=>n>=12288&&n<=12351,Hiragana:n=>n>=12352&&n<=12447,Katakana:n=>n>=12448&&n<=12543,Bopomofo:n=>n>=12544&&n<=12591,"Hangul Compatibility Jamo":n=>n>=12592&&n<=12687,Kanbun:n=>n>=12688&&n<=12703,"Bopomofo Extended":n=>n>=12704&&n<=12735,"CJK Strokes":n=>n>=12736&&n<=12783,"Katakana Phonetic Extensions":n=>n>=12784&&n<=12799,"Enclosed CJK Letters and Months":n=>n>=12800&&n<=13055,"CJK Compatibility":n=>n>=13056&&n<=13311,"CJK Unified Ideographs Extension A":n=>n>=13312&&n<=19903,"Yijing Hexagram Symbols":n=>n>=19904&&n<=19967,"CJK Unified Ideographs":n=>n>=19968&&n<=40959,"Yi Syllables":n=>n>=40960&&n<=42127,"Yi Radicals":n=>n>=42128&&n<=42191,"Hangul Jamo Extended-A":n=>n>=43360&&n<=43391,"Hangul Syllables":n=>n>=44032&&n<=55215,"Hangul Jamo Extended-B":n=>n>=55216&&n<=55295,"Private Use Area":n=>n>=57344&&n<=63743,"CJK Compatibility Ideographs":n=>n>=63744&&n<=64255,"Arabic Presentation Forms-A":n=>n>=64336&&n<=65023,"Vertical Forms":n=>n>=65040&&n<=65055,"CJK Compatibility Forms":n=>n>=65072&&n<=65103,"Small Form Variants":n=>n>=65104&&n<=65135,"Arabic Presentation Forms-B":n=>n>=65136&&n<=65279,"Halfwidth and Fullwidth Forms":n=>n>=65280&&n<=65519,Osage:n=>n>=66736&&n<=66815,"CJK Unified Ideographs Extension B":n=>n>=131072&&n<=173791};function Rd(n){for(const e of n)if(Yh(e.charCodeAt(0)))return!0;return!1}function Mp(n){for(const e of n)if(!Xh(e.charCodeAt(0)))return!1;return!0}function Xh(n){return!(Qt.Arabic(n)||Qt["Arabic Supplement"](n)||Qt["Arabic Extended-A"](n)||Qt["Arabic Presentation Forms-A"](n)||Qt["Arabic Presentation Forms-B"](n))}function Yh(n){return!(n!==746&&n!==747&&(n<4352||!(Qt["Bopomofo Extended"](n)||Qt.Bopomofo(n)||Qt["CJK Compatibility Forms"](n)&&!(n>=65097&&n<=65103)||Qt["CJK Compatibility Ideographs"](n)||Qt["CJK Compatibility"](n)||Qt["CJK Radicals Supplement"](n)||Qt["CJK Strokes"](n)||!(!Qt["CJK Symbols and Punctuation"](n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||Qt["CJK Unified Ideographs Extension A"](n)||Qt["CJK Unified Ideographs"](n)||Qt["Enclosed CJK Letters and Months"](n)||Qt["Hangul Compatibility Jamo"](n)||Qt["Hangul Jamo Extended-A"](n)||Qt["Hangul Jamo Extended-B"](n)||Qt["Hangul Jamo"](n)||Qt["Hangul Syllables"](n)||Qt.Hiragana(n)||Qt["Ideographic Description Characters"](n)||Qt.Kanbun(n)||Qt["Kangxi Radicals"](n)||Qt["Katakana Phonetic Extensions"](n)||Qt.Katakana(n)&&n!==12540||!(!Qt["Halfwidth and Fullwidth Forms"](n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!Qt["Small Form Variants"](n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||Qt["Unified Canadian Aboriginal Syllabics"](n)||Qt["Unified Canadian Aboriginal Syllabics Extended"](n)||Qt["Vertical Forms"](n)||Qt["Yijing Hexagram Symbols"](n)||Qt["Yi Syllables"](n)||Qt["Yi Radicals"](n))))}function qh(n){return!(Yh(n)||function(e){return!!(Qt["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Qt["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Qt["Letterlike Symbols"](e)||Qt["Number Forms"](e)||Qt["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Qt["Control Pictures"](e)&&e!==9251||Qt["Optical Character Recognition"](e)||Qt["Enclosed Alphanumerics"](e)||Qt["Geometric Shapes"](e)||Qt["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Qt["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Qt["CJK Symbols and Punctuation"](e)||Qt.Katakana(e)||Qt["Private Use Area"](e)||Qt["CJK Compatibility Forms"](e)||Qt["Small Form Variants"](e)||Qt["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(n))}function Bm(n){return Qt.Arabic(n)||Qt["Arabic Supplement"](n)||Qt["Arabic Extended-A"](n)||Qt["Arabic Presentation Forms-A"](n)||Qt["Arabic Presentation Forms-B"](n)}function Pp(n){return n>=1424&&n<=2303||Qt["Arabic Presentation Forms-A"](n)||Qt["Arabic Presentation Forms-B"](n)}function Nm(n,e){return!(!e&&Pp(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||Qt.Khmer(n))}function Vm(n){for(const e of n)if(Pp(e.charCodeAt(0)))return!0;return!1}const ln={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let Dd=null,Xs=ln.unavailable,eo=null;const Lp=function(n){n&&typeof n=="string"&&n.indexOf("NetworkError")>-1&&(Xs=ln.error),Dd&&Dd(n)};function Od(){Fd.fire(new Nn("pluginStateChange",{pluginStatus:Xs,pluginURL:eo}))}const Fd=new xo,Zh=function(){return Xs},Po=function(){if(Xs!==ln.deferred||!eo)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Xs=ln.loading,Od(),eo&&Qo({url:eo},n=>{n?Lp(n):(Xs=ln.loaded,Od())})},ia={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Xs===ln.loaded||ia.applyArabicShaping!=null,isLoading:()=>Xs===ln.loading,setState(n){Xs=n.pluginStatus,eo=n.pluginURL},isParsing:()=>Xs===ln.parsing,isParsed:()=>Xs===ln.parsed,getPluginURL:()=>eo};class _r{constructor(e,s){this.zoom=e,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.transition=s.transition,this.pitch=s.pitch,this.brightness=s.brightness,this.worldview=s.worldview):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(s,l){for(const h of s)if(!Nm(h.charCodeAt(0),l))return!1;return!0}(e,ia.isLoaded())}}class Lo{constructor(e,s,l,h,p){this.property=e,this.value=s,this.expression=function(g,x,w,T,I){if(Vh(g))return new Hh(g,x);if(Pd(g)||Array.isArray(g)&&g.length>0){const M=Ld(g,x,w,T,I);if(M.result==="error")throw new Error(M.value.map(R=>`${R.key}: ${R.message}`).join(", "));return M.value}{let M=g;return typeof g=="string"&&x.type==="color"&&(M=er.parse(g)),{kind:"constant",configDependencies:new Set,evaluate:()=>M}}}(s===void 0?e.specification.default:s,e.specification,l,h,p)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,s,l,h){return this.property.possiblyEvaluate(this,e,s,l,h)}}class Bd{constructor(e,s,l,h){this.property=e,this.value=new Lo(e,void 0,s,l,h)}transitioned(e,s){return new Sa(this.property,this.value,s,Object.assign({},e.transition,this.transition),e.now)}untransitioned(){return new Sa(this.property,this.value,null,{},0)}}class zp{constructor(e,s,l,h){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=s,this._options=l,this._iconImageUseTheme=h,this.configDependencies=new Set}getValue(e){return Li(this._values[e].value.value)}setValue(e,s){this._values.hasOwnProperty(e)||(this._values[e]=new Bd(this._values[e].property,this._scope,this._options,this._iconImageUseTheme)),this._values[e].value=new Lo(this._values[e].property,s===null?void 0:Li(s),this._scope,this._options,this._iconImageUseTheme),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]))}setTransitionOrValue(e,s){s&&(this._options=s);const l=this._properties.properties;if(e)for(const h in e){const p=e[h];if(h.endsWith("-transition")){const g=h.slice(0,-11);l[g]&&this.setTransition(g,p)}else l.hasOwnProperty(h)&&this.setValue(h,p)}}getTransition(e){return Li(this._values[e].transition)}setTransition(e,s){this._values.hasOwnProperty(e)||(this._values[e]=new Bd(this._values[e].property)),this._values[e].transition=Li(s)||void 0}serialize(){const e={};for(const s of Object.keys(this._values)){const l=this.getValue(s);l!==void 0&&(e[s]=l);const h=this.getTransition(s);h!==void 0&&(e[`${s}-transition`]=h)}return e}transitioned(e,s){const l=new Nd(this._properties);for(const h of Object.keys(this._values))l._values[h]=this._values[h].transitioned(e,s._values[h]);return l}untransitioned(){const e=new Nd(this._properties);for(const s of Object.keys(this._values))e._values[s]=this._values[s].untransitioned();return e}}class Sa{constructor(e,s,l,h,p){const g=h.delay||0,x=h.duration||0;p=p||0,this.property=e,this.value=s,this.begin=p+g,this.end=this.begin+x,e.specification.transition&&(h.delay||h.duration)&&(this.prior=l)}possiblyEvaluate(e,s,l){const h=e.now||0,p=this.value.possiblyEvaluate(e,s,l),g=this.prior;if(g){if(h>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(h<this.begin)return g.possiblyEvaluate(e,s,l);{const x=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(e,s,l),p,pe(x))}}return p}}class Nd{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,s,l){const h=new Do(this._properties);for(const p of Object.keys(this._values))h._values[p]=this._values[p].possiblyEvaluate(e,s,l);return h}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class zo{constructor(e,s,l,h){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=s,this._options=l,this._iconImageUseTheme=h,this.configDependencies=new Set}getValue(e){return Li(this._values[e].value)}setValue(e,s){this._values[e]=new Lo(this._values[e].property,s===null?void 0:Li(s),this._scope,this._options,this._iconImageUseTheme),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]))}serialize(){const e={};for(const s of Object.keys(this._values)){const l=this.getValue(s);l!==void 0&&(e[s]=l)}return e}possiblyEvaluate(e,s,l,h){const p=new Do(this._properties);for(const g of Object.keys(this._values))p._values[g]=this._values[g].possiblyEvaluate(e,s,l,h);return p}}class Ro{constructor(e,s,l,h){this.property=e,this.value=s,this.parameters=l,this.iconImageUseTheme=h}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,s,l,h){return this.property.evaluate(this.value,this.parameters,e,s,l,h,this.iconImageUseTheme)}}class Do{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class yt{constructor(e){this.specification=e}possiblyEvaluate(e,s){return e.expression.evaluate(s)}interpolate(e,s,l){const h=xn[this.specification.type];return h?h(e,s,l):e}}class Mt{constructor(e,s){this.specification=e,this.overrides=s}possiblyEvaluate(e,s,l,h,p){return e.expression.kind==="constant"||e.expression.kind==="camera"?new Ro(this,{kind:"constant",value:e.expression.evaluate(s,null,{},l,h,void 0,p)},s):new Ro(this,e.expression,s,p)}interpolate(e,s,l){if(e.value.kind!=="constant"||s.value.kind!=="constant")return e;if(e.value.value===void 0||s.value.value===void 0)return new Ro(this,{kind:"constant",value:void 0},e.parameters);const h=xn[this.specification.type];return h?new Ro(this,{kind:"constant",value:h(e.value.value,s.value.value,l)},e.parameters):e}evaluate(e,s,l,h,p,g,x){return e.kind==="constant"?e.value:e.evaluate(s,l,h,p,g,void 0,x)}}class yl{constructor(e){this.specification=e}possiblyEvaluate(e,s,l,h){return!!e.expression.evaluate(s,null,{},l,h)}interpolate(){return!1}}class Nr{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const s=new _r(0,{});for(const l in e){const h=e[l];h.specification.overridable&&this.overridableProperties.push(l);const p=this.defaultPropertyValues[l]=new Lo(h,void 0),g=this.defaultTransitionablePropertyValues[l]=new Bd(h);this.defaultTransitioningPropertyValues[l]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[l]=p.possiblyEvaluate(s)}}}Dt(Mt,"DataDrivenProperty"),Dt(yt,"DataConstantProperty"),Dt(yl,"ColorRampProperty");var Fe=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","expression":{}},"buildingFeaturesetId":{"type":"string","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function $h(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function Oo(n){if(Array.isArray(n))return n.map(Oo);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const e={};for(const s in n)e[s]=Oo(n[s]);return e}return $h(n)}function Jh(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const e of n.slice(1))if(!Jh(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Sc(n,e="",s=null,l="fill"){if(n==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Jh(n)||(n=Kh(n));const h=n;let p=!0;try{p=function(I){if(!xl(I))return I;let M=Oo(I);return Hn(M),M=Rp(M),M}(h)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(h,null,2)}
        `)}let g=null,x=null;if(l!=="background"&&l!=="sky"&&l!=="slot"){x=Fe[`filter_${l}`];const I=ta(p,x,e,s);if(I.result==="error")throw new Error(I.value.map(M=>`${M.key}: ${M.message}`).join(", "));g=(M,R,B)=>I.value.evaluate(M,R,{},B)}let w=null,T=null;if(p!==h){const I=ta(h,x,e,s);if(I.result==="error")throw new Error(I.value.map(M=>`${M.key}: ${M.message}`).join(", "));w=(M,R,B,V,q)=>I.value.evaluate(M,R,{},B,void 0,void 0,V,q),T=!ul(I.value.expression)}return{filter:g,dynamicFilter:w||void 0,needGeometry:Op(p),needFeature:!!T}}function Rp(n){if(!Array.isArray(n))return n;const e=function(s){if(Dp.has(s[0])){for(let l=1;l<s.length;l++)if(xl(s[l]))return!0}return s}(n);return e===!0?e:e.map(s=>Rp(s))}function Hn(n){let e=!1;const s=[];if(n[0]==="case"){for(let l=1;l<n.length-1;l+=2)e=e||xl(n[l]),s.push(n[l+1]);s.push(n[n.length-1])}else if(n[0]==="match"){e=e||xl(n[1]);for(let l=2;l<n.length-1;l+=2)s.push(n[l+1]);s.push(n[n.length-1])}else if(n[0]==="step"){e=e||xl(n[1]);for(let l=1;l<n.length-1;l+=2)s.push(n[l+1])}e&&(n.length=0,n.push("any",...s));for(let l=1;l<n.length;l++)Hn(n[l])}function xl(n){if(!Array.isArray(n))return!1;if((e=n[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let s=1;s<n.length;s++)if(xl(n[s]))return!0;return!1}const Dp=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Um(n,e){return n<e?-1:n>e?1:0}function Op(n){if(!Array.isArray(n))return!1;if(n[0]==="within"||n[0]==="distance")return!0;for(let e=1;e<n.length;e++)if(Op(n[e]))return!0;return!1}function Kh(n){if(!n)return!0;const e=n[0];return n.length<=1?e!=="any":e==="=="?Vd(n[1],n[2],"=="):e==="!="?Qh(Vd(n[1],n[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Vd(n[1],n[2],e):e==="any"?(s=n.slice(1),["any"].concat(s.map(Kh))):e==="all"?["all"].concat(n.slice(1).map(Kh)):e==="none"?["all"].concat(n.slice(1).map(Kh).map(Qh)):e==="in"?Fp(n[1],n.slice(2)):e==="!in"?Qh(Fp(n[1],n.slice(2))):e==="has"?Bp(n[1]):e!=="!has"||Qh(Bp(n[1]));var s}function Vd(n,e,s){switch(n){case"$type":return[`filter-type-${s}`,e];case"$id":return[`filter-id-${s}`,e];default:return[`filter-${s}`,n,e]}}function Fp(n,e){if(e.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(s=>typeof s!=typeof e[0])?["filter-in-large",n,["literal",e.sort(Um)]]:["filter-in-small",n,["literal",e]]}}function Bp(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function Qh(n){return["!",n]}const Ac="";function vl(n,e){return e?`${n}${Ac}${e}`:n}let Ud;const Np=()=>Ud||(Ud=new Nr({"icon-size":new Mt(Fe.layout_symbol["icon-size"]),"icon-image":new Mt(Fe.layout_symbol["icon-image"]),"icon-rotate":new Mt(Fe.layout_symbol["icon-rotate"]),"icon-offset":new Mt(Fe.layout_symbol["icon-offset"])}));class jm{constructor(e,s,l,h,p,g){const x=ta(e,Fe.appearance.condition);if(x.result==="success"&&(this.condition=x.value),this.name=s,l){this.properties=new Do(Np()),this.unevaluatedLayout=new zo(Np(),h,p,g);for(const w in l)this.unevaluatedLayout.setValue(w,l[w])}}isActive(e){return!(this.condition||!e.isHidden||this.name!=="hidden")||this.condition.evaluate(e.globals,e.feature,e.featureState,e.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(e){return this.properties.get(e)}getUnevaluatedProperties(){return this.unevaluatedLayout}serialize(){const e={};return e.condition=this.condition.expression.serialize(),this.name&&(e.name=this.name),this.properties&&(e.properties=this.properties),e}}const Vp="-transition",Up=new Set(["fill","line","background","hillshade","raster"]);class Ns extends xo{constructor(e,s,l,h,p,g){if(super(),this.id=e.id,this.fqid=vl(this.id,l),this.type=e.type,this.scope=l,this.lut=h,this.options=p,this.iconImageUseTheme=g,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const x=ta(this.filter,Fe[`filter_${e.type}`]);x.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...x.value.configDependencies]))}if(e.slot&&(this.slot=e.slot),e.appearances&&e.appearances.forEach(x=>{this.appearances.push(new jm(x.condition,x.name,x.properties,this.scope,p,this.iconImageUseTheme))}),s.layout&&(this._unevaluatedLayout=new zo(s.layout,this.scope,p,this.iconImageUseTheme),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),s.paint){this._transitionablePaint=new zp(s.paint,this.scope,p);for(const x in e.paint)this.setPaintProperty(x,e.paint[x]);for(const x in e.layout)this.setLayoutProperty(x,e.layout[x]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Do(s.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D(!0)&&Up.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,s){if(this.type==="custom"&&e==="visibility")return void(this.visibility=s);const l=this._unevaluatedLayout;l._properties.properties[e]&&(l.setValue(e,s),this.configDependencies=new Set([...this.configDependencies,...l.configDependencies]),e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return e.endsWith(Vp)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,s){const l=this._transitionablePaint,h=l._properties.properties;if(e.endsWith(Vp)){const M=e.slice(0,-11);return h[M]&&l.setTransition(M,s||void 0),!1}if(!h[e])return!1;const p=l._values[e],g=p.value.isDataDriven(),x=p.value;l.setValue(e,s),this.configDependencies=new Set([...this.configDependencies,...l.configDependencies]),this._handleSpecialPaintPropertyUpdate(e);const w=l._values[e].value,T=w.isDataDriven(),I=e.endsWith("pattern")||e==="line-dasharray";return T||g||I||this._handleOverridablePaintPropertyUpdate(e,x,w)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,s,l){return null}_handleOverridablePaintPropertyUpdate(e,s,l){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,s){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,s,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,s)}serialize(){const e={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.appearances.length!==0&&(e.appearances=this.appearances.map(s=>s.serialize())),Ri(e,(s,l)=>!(s===void 0||l==="layout"&&!Object.keys(s).length||l==="paint"&&!Object.keys(s).length))}is3D(e){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const e in this.paint._values){const s=this.paint.get(e);if(s instanceof Ro&&Bh(s.property.specification)&&(s.value.kind==="source"||s.value.kind==="composite")&&s.value.isStateDependent)return!0}return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=Sc(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRadius(e){}queryIntersectsFeature(e,s,l,h,p,g,x,w,T){}}const to={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class bl{constructor(e,s){this._structArray=e,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ar{constructor(){this.capacity=-1,this.resize(0)}static serialize(e,s){return e._trim(),s&&s.add(e.arrayBuffer),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const s=Object.create(this.prototype);return s.arrayBuffer=e.arrayBuffer,s.length=e.length,s.capacity=e.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Fi(n,e=1){let s=0,l=0;return{members:n.map(h=>{const p=to[h.type].BYTES_PER_ELEMENT,g=s=jp(s,Math.max(e,p)),x=h.components||1;return l=Math.max(l,p),s+=p*x,{name:h.name,type:h.type,components:x,offset:g}}),size:jp(s,Math.max(l,e)),alignment:e}}function jp(n,e){return Math.ceil(n/e)*e}class io extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s){const l=this.length;return this.resize(l+1),this.emplace(l,e,s)}emplace(e,s,l){const h=2*e;return this.int16[h+0]=s,this.int16[h+1]=l,e}}io.prototype.bytesPerElement=4,Dt(io,"StructArrayLayout2i4");class Fo extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,s,l)}emplace(e,s,l,h){const p=3*e;return this.int16[p+0]=s,this.int16[p+1]=l,this.int16[p+2]=h,e}}Fo.prototype.bytesPerElement=6,Dt(Fo,"StructArrayLayout3i6");class Bo extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,s,l,h)}emplace(e,s,l,h,p){const g=4*e;return this.int16[g+0]=s,this.int16[g+1]=l,this.int16[g+2]=h,this.int16[g+3]=p,e}}Bo.prototype.bytesPerElement=8,Dt(Bo,"StructArrayLayout4i8");class ro extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const s=this.length;return this.resize(s+1),this.emplace(s,e)}emplace(e,s){return this.float32[1*e+0]=s,e}}ro.prototype.bytesPerElement=4,Dt(ro,"StructArrayLayout1f4");class jd extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,s,l)}emplace(e,s,l,h){const p=4*e,g=2*e;return this.int16[p+0]=s,this.int16[p+1]=l,this.float32[g+1]=h,e}}jd.prototype.bytesPerElement=8,Dt(jd,"StructArrayLayout2i1f8");class eu extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,s,l)}emplace(e,s,l,h){const p=4*e;return this.int16[p+0]=s,this.int16[p+1]=l,this.int16[p+2]=h,e}}eu.prototype.bytesPerElement=8,Dt(eu,"StructArrayLayout3i8");class Hd extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,l,h,p){const g=this.length;return this.resize(g+1),this.emplace(g,e,s,l,h,p)}emplace(e,s,l,h,p,g){const x=5*e;return this.int16[x+0]=s,this.int16[x+1]=l,this.int16[x+2]=h,this.int16[x+3]=p,this.int16[x+4]=g,e}}Hd.prototype.bytesPerElement=10,Dt(Hd,"StructArrayLayout5i10");class tu extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,l,h,p,g,x){const w=this.length;return this.resize(w+1),this.emplace(w,e,s,l,h,p,g,x)}emplace(e,s,l,h,p,g,x,w){const T=6*e,I=12*e,M=3*e;return this.int16[T+0]=s,this.int16[T+1]=l,this.uint8[I+4]=h,this.uint8[I+5]=p,this.uint8[I+6]=g,this.uint8[I+7]=x,this.float32[M+2]=w,e}}tu.prototype.bytesPerElement=12,Dt(tu,"StructArrayLayout2i4ub1f12");class en extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,s,l)}emplace(e,s,l,h){const p=3*e;return this.float32[p+0]=s,this.float32[p+1]=l,this.float32[p+2]=h,e}}en.prototype.bytesPerElement=12,Dt(en,"StructArrayLayout3f12");class so extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,l,h,p){const g=this.length;return this.resize(g+1),this.emplace(g,e,s,l,h,p)}emplace(e,s,l,h,p,g){const x=6*e,w=3*e;return this.uint16[x+0]=s,this.uint16[x+1]=l,this.uint16[x+2]=h,this.uint16[x+3]=p,this.float32[w+2]=g,e}}so.prototype.bytesPerElement=12,Dt(so,"StructArrayLayout4ui1f12");class wl extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,s,l,h)}emplace(e,s,l,h,p){const g=4*e;return this.uint16[g+0]=s,this.uint16[g+1]=l,this.uint16[g+2]=h,this.uint16[g+3]=p,e}}wl.prototype.bytesPerElement=8,Dt(wl,"StructArrayLayout4ui8");class iu extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,l,h,p,g){const x=this.length;return this.resize(x+1),this.emplace(x,e,s,l,h,p,g)}emplace(e,s,l,h,p,g,x){const w=6*e;return this.int16[w+0]=s,this.int16[w+1]=l,this.int16[w+2]=h,this.int16[w+3]=p,this.int16[w+4]=g,this.int16[w+5]=x,e}}iu.prototype.bytesPerElement=12,Dt(iu,"StructArrayLayout6i12");class Wd extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,l,h,p,g,x,w,T,I,M,R){const B=this.length;return this.resize(B+1),this.emplace(B,e,s,l,h,p,g,x,w,T,I,M,R)}emplace(e,s,l,h,p,g,x,w,T,I,M,R,B){const V=12*e;return this.int16[V+0]=s,this.int16[V+1]=l,this.int16[V+2]=h,this.int16[V+3]=p,this.uint16[V+4]=g,this.uint16[V+5]=x,this.uint16[V+6]=w,this.uint16[V+7]=T,this.int16[V+8]=I,this.int16[V+9]=M,this.int16[V+10]=R,this.int16[V+11]=B,e}}Wd.prototype.bytesPerElement=24,Dt(Wd,"StructArrayLayout4i4ui4i24");class Gd extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,l,h,p,g){const x=this.length;return this.resize(x+1),this.emplace(x,e,s,l,h,p,g)}emplace(e,s,l,h,p,g,x){const w=10*e,T=5*e;return this.int16[w+0]=s,this.int16[w+1]=l,this.int16[w+2]=h,this.float32[T+2]=p,this.float32[T+3]=g,this.float32[T+4]=x,e}}Gd.prototype.bytesPerElement=20,Dt(Gd,"StructArrayLayout3i3f20");class Wn extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,s,l,h)}emplace(e,s,l,h,p){const g=4*e;return this.float32[g+0]=s,this.float32[g+1]=l,this.float32[g+2]=h,this.float32[g+3]=p,e}}Wn.prototype.bytesPerElement=16,Dt(Wn,"StructArrayLayout4f16");class Sl extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const s=this.length;return this.resize(s+1),this.emplace(s,e)}emplace(e,s){return this.uint32[1*e+0]=s,e}}Sl.prototype.bytesPerElement=4,Dt(Sl,"StructArrayLayout1ul4");class hs extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s){const l=this.length;return this.resize(l+1),this.emplace(l,e,s)}emplace(e,s,l){const h=2*e;return this.uint16[h+0]=s,this.uint16[h+1]=l,e}}hs.prototype.bytesPerElement=4,Dt(hs,"StructArrayLayout2ui4");class Al extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,l,h,p,g,x,w,T,I,M,R,B){const V=this.length;return this.resize(V+1),this.emplace(V,e,s,l,h,p,g,x,w,T,I,M,R,B)}emplace(e,s,l,h,p,g,x,w,T,I,M,R,B,V){const q=20*e,Z=10*e;return this.int16[q+0]=s,this.int16[q+1]=l,this.int16[q+2]=h,this.int16[q+3]=p,this.int16[q+4]=g,this.float32[Z+3]=x,this.float32[Z+4]=w,this.float32[Z+5]=T,this.float32[Z+6]=I,this.int16[q+14]=M,this.uint32[Z+8]=R,this.uint16[q+18]=B,this.uint16[q+19]=V,e}}Al.prototype.bytesPerElement=40,Dt(Al,"StructArrayLayout5i4f1i1ul2ui40");class ru extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,l,h,p,g,x){const w=this.length;return this.resize(w+1),this.emplace(w,e,s,l,h,p,g,x)}emplace(e,s,l,h,p,g,x,w){const T=8*e;return this.int16[T+0]=s,this.int16[T+1]=l,this.int16[T+2]=h,this.int16[T+4]=p,this.int16[T+5]=g,this.int16[T+6]=x,this.int16[T+7]=w,e}}ru.prototype.bytesPerElement=16,Dt(ru,"StructArrayLayout3i2i2i16");class Xd extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,l,h,p){const g=this.length;return this.resize(g+1),this.emplace(g,e,s,l,h,p)}emplace(e,s,l,h,p,g){const x=4*e,w=8*e;return this.float32[x+0]=s,this.float32[x+1]=l,this.float32[x+2]=h,this.int16[w+6]=p,this.int16[w+7]=g,e}}Xd.prototype.bytesPerElement=16,Dt(Xd,"StructArrayLayout2f1f2i16");class Yd extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,l,h,p,g){const x=this.length;return this.resize(x+1),this.emplace(x,e,s,l,h,p,g)}emplace(e,s,l,h,p,g,x){const w=20*e,T=5*e;return this.uint8[w+0]=s,this.uint8[w+1]=l,this.float32[T+1]=h,this.float32[T+2]=p,this.float32[T+3]=g,this.float32[T+4]=x,e}}Yd.prototype.bytesPerElement=20,Dt(Yd,"StructArrayLayout2ub4f20");class gs extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,s,l)}emplace(e,s,l,h){const p=3*e;return this.uint16[p+0]=s,this.uint16[p+1]=l,this.uint16[p+2]=h,e}}gs.prototype.bytesPerElement=6,Dt(gs,"StructArrayLayout3ui6");class Tc extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,s,l,h,p,g,x,w,T,I,M,R,B,V,q,Z,$,ne,ae,le,be){const we=this.length;return this.resize(we+1),this.emplace(we,e,s,l,h,p,g,x,w,T,I,M,R,B,V,q,Z,$,ne,ae,le,be)}emplace(e,s,l,h,p,g,x,w,T,I,M,R,B,V,q,Z,$,ne,ae,le,be,we){const ke=30*e,Le=15*e,ze=60*e;return this.int16[ke+0]=s,this.int16[ke+1]=l,this.int16[ke+2]=h,this.float32[Le+2]=p,this.float32[Le+3]=g,this.uint16[ke+8]=x,this.uint16[ke+9]=w,this.uint32[Le+5]=T,this.uint32[Le+6]=I,this.uint32[Le+7]=M,this.uint16[ke+16]=R,this.uint16[ke+17]=B,this.uint16[ke+18]=V,this.float32[Le+10]=q,this.float32[Le+11]=Z,this.uint8[ze+48]=$,this.uint8[ze+49]=ne,this.uint8[ze+50]=ae,this.uint32[Le+13]=le,this.int16[ke+28]=be,this.uint8[ze+58]=we,e}}Tc.prototype.bytesPerElement=60,Dt(Tc,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class qd extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,s,l,h,p,g,x,w,T,I,M,R,B,V,q,Z,$,ne,ae,le,be,we,ke,Le,ze,rt,Be,st,ut,nt,ot,gt,tt){const ct=this.length;return this.resize(ct+1),this.emplace(ct,e,s,l,h,p,g,x,w,T,I,M,R,B,V,q,Z,$,ne,ae,le,be,we,ke,Le,ze,rt,Be,st,ut,nt,ot,gt,tt)}emplace(e,s,l,h,p,g,x,w,T,I,M,R,B,V,q,Z,$,ne,ae,le,be,we,ke,Le,ze,rt,Be,st,ut,nt,ot,gt,tt,ct){const Xe=20*e,He=40*e,_t=80*e;return this.float32[Xe+0]=s,this.float32[Xe+1]=l,this.int16[He+4]=h,this.int16[He+5]=p,this.int16[He+6]=g,this.int16[He+7]=x,this.int16[He+8]=w,this.int16[He+9]=T,this.int16[He+10]=I,this.int16[He+11]=M,this.int16[He+12]=R,this.uint16[He+13]=B,this.uint16[He+14]=V,this.uint16[He+15]=q,this.uint16[He+16]=Z,this.uint16[He+17]=$,this.uint16[He+18]=ne,this.uint16[He+19]=ae,this.uint16[He+20]=le,this.uint16[He+21]=be,this.uint16[He+22]=we,this.uint16[He+23]=ke,this.uint16[He+24]=Le,this.uint16[He+25]=ze,this.uint16[He+26]=rt,this.uint16[He+27]=Be,this.uint32[Xe+14]=st,this.float32[Xe+15]=ut,this.float32[Xe+16]=nt,this.float32[Xe+17]=ot,this.float32[Xe+18]=gt,this.uint8[_t+76]=tt,this.uint16[He+39]=ct,e}}qd.prototype.bytesPerElement=80,Dt(qd,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class Ec extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,l,h,p,g){const x=this.length;return this.resize(x+1),this.emplace(x,e,s,l,h,p,g)}emplace(e,s,l,h,p,g,x){const w=6*e;return this.float32[w+0]=s,this.float32[w+1]=l,this.float32[w+2]=h,this.float32[w+3]=p,this.float32[w+4]=g,this.float32[w+5]=x,e}}Ec.prototype.bytesPerElement=24,Dt(Ec,"StructArrayLayout6f24");class No extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,l,h,p){const g=this.length;return this.resize(g+1),this.emplace(g,e,s,l,h,p)}emplace(e,s,l,h,p,g){const x=5*e;return this.float32[x+0]=s,this.float32[x+1]=l,this.float32[x+2]=h,this.float32[x+3]=p,this.float32[x+4]=g,e}}No.prototype.bytesPerElement=20,Dt(No,"StructArrayLayout5f20");class Zd extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,l,h,p,g,x){const w=this.length;return this.resize(w+1),this.emplace(w,e,s,l,h,p,g,x)}emplace(e,s,l,h,p,g,x,w){const T=7*e;return this.float32[T+0]=s,this.float32[T+1]=l,this.float32[T+2]=h,this.float32[T+3]=p,this.float32[T+4]=g,this.float32[T+5]=x,this.float32[T+6]=w,e}}Zd.prototype.bytesPerElement=28,Dt(Zd,"StructArrayLayout7f28");class su extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,l,h,p,g,x,w,T,I,M){const R=this.length;return this.resize(R+1),this.emplace(R,e,s,l,h,p,g,x,w,T,I,M)}emplace(e,s,l,h,p,g,x,w,T,I,M,R){const B=11*e;return this.float32[B+0]=s,this.float32[B+1]=l,this.float32[B+2]=h,this.float32[B+3]=p,this.float32[B+4]=g,this.float32[B+5]=x,this.float32[B+6]=w,this.float32[B+7]=T,this.float32[B+8]=I,this.float32[B+9]=M,this.float32[B+10]=R,e}}su.prototype.bytesPerElement=44,Dt(su,"StructArrayLayout11f44");class Cc extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,l,h,p,g,x,w,T){const I=this.length;return this.resize(I+1),this.emplace(I,e,s,l,h,p,g,x,w,T)}emplace(e,s,l,h,p,g,x,w,T,I){const M=9*e;return this.float32[M+0]=s,this.float32[M+1]=l,this.float32[M+2]=h,this.float32[M+3]=p,this.float32[M+4]=g,this.float32[M+5]=x,this.float32[M+6]=w,this.float32[M+7]=T,this.float32[M+8]=I,e}}Cc.prototype.bytesPerElement=36,Dt(Cc,"StructArrayLayout9f36");class Tl extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s){const l=this.length;return this.resize(l+1),this.emplace(l,e,s)}emplace(e,s,l){const h=2*e;return this.float32[h+0]=s,this.float32[h+1]=l,e}}Tl.prototype.bytesPerElement=8,Dt(Tl,"StructArrayLayout2f8");class nu extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,s,l,h)}emplace(e,s,l,h,p){const g=6*e;return this.uint32[3*e+0]=s,this.uint16[g+2]=l,this.uint16[g+3]=h,this.uint16[g+4]=p,e}}nu.prototype.bytesPerElement=12,Dt(nu,"StructArrayLayout1ul3ui12");class au extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const s=this.length;return this.resize(s+1),this.emplace(s,e)}emplace(e,s){return this.uint16[1*e+0]=s,e}}au.prototype.bytesPerElement=2,Dt(au,"StructArrayLayout1ui2");class $d extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,l,h,p,g,x,w,T,I,M,R,B,V,q,Z){const $=this.length;return this.resize($+1),this.emplace($,e,s,l,h,p,g,x,w,T,I,M,R,B,V,q,Z)}emplace(e,s,l,h,p,g,x,w,T,I,M,R,B,V,q,Z,$){const ne=16*e;return this.float32[ne+0]=s,this.float32[ne+1]=l,this.float32[ne+2]=h,this.float32[ne+3]=p,this.float32[ne+4]=g,this.float32[ne+5]=x,this.float32[ne+6]=w,this.float32[ne+7]=T,this.float32[ne+8]=I,this.float32[ne+9]=M,this.float32[ne+10]=R,this.float32[ne+11]=B,this.float32[ne+12]=V,this.float32[ne+13]=q,this.float32[ne+14]=Z,this.float32[ne+15]=$,e}}$d.prototype.bytesPerElement=64,Dt($d,"StructArrayLayout16f64");class El extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,l,h,p,g,x){const w=this.length;return this.resize(w+1),this.emplace(w,e,s,l,h,p,g,x)}emplace(e,s,l,h,p,g,x,w){const T=10*e,I=5*e;return this.uint16[T+0]=s,this.uint16[T+1]=l,this.uint16[T+2]=h,this.uint16[T+3]=p,this.float32[I+2]=g,this.float32[I+3]=x,this.float32[I+4]=w,e}}El.prototype.bytesPerElement=20,Dt(El,"StructArrayLayout4ui3f20");class Cl extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const s=this.length;return this.resize(s+1),this.emplace(s,e)}emplace(e,s){return this.int16[1*e+0]=s,e}}Cl.prototype.bytesPerElement=2,Dt(Cl,"StructArrayLayout1i2");class ou extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const s=this.length;return this.resize(s+1),this.emplace(s,e)}emplace(e,s){return this.uint8[1*e+0]=s,e}}ou.prototype.bytesPerElement=1,Dt(ou,"StructArrayLayout1ub1");class Hp extends bl{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Hp.prototype.size=40;class Jd extends Al{get(e){return new Hp(this,e)}}Dt(Jd,"CollisionBoxArray");class Wp extends bl{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Wp.prototype.size=60;class lu extends Tc{get(e){return new Wp(this,e)}}Dt(lu,"PlacedSymbolArray");class Gp extends bl{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}Gp.prototype.size=80;class Xp extends qd{get(e){return new Gp(this,e)}}Dt(Xp,"SymbolInstanceArray");class Yp extends ro{getoffsetX(e){return this.float32[1*e+0]}}Dt(Yp,"GlyphOffsetArray");class qp extends io{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Dt(qp,"SymbolLineVertexArray");class Kd extends bl{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Kd.prototype.size=12;class Zp extends nu{get(e){return new Kd(this,e)}}Dt(Zp,"FeatureIndexArray");class $p extends hs{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Dt($p,"FillExtrusionCentroidArray");class Jp extends bl{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}Jp.prototype.size=6;class Kp extends Fo{get(e){return new Jp(this,e)}}Dt(Kp,"FillExtrusionWallArray");const Hm=Fi([{name:"a_pos",components:2,type:"Int16"}],4),Wm=Fi([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),Gm=Fi([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class zr{constructor(e=[]){this.segments=e}_prepareSegment(e,s,l,h){let p=this.segments[this.segments.length-1];return e>zr.MAX_VERTEX_ARRAY_LENGTH&&Di(`Max vertices per segment is ${zr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!p||p.vertexLength+e>zr.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==h)&&(p={vertexOffset:s,primitiveOffset:l,vertexLength:0,primitiveLength:0},h!==void 0&&(p.sortKey=h),this.segments.push(p)),p}prepareSegment(e,s,l,h){return this._prepareSegment(e,s.length,l.length,h)}get(){return this.segments}destroy(){for(const e of this.segments)for(const s in e.vaos)e.vaos[s].destroy()}static simpleSegment(e,s,l,h){return new zr([{vertexOffset:e,primitiveOffset:s,vertexLength:l,primitiveLength:h,vaos:{},sortKey:0}])}}function Ic(n,e){return 256*(n=Ee(Math.floor(n),0,255))+Ee(Math.floor(e),0,255)}zr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Dt(zr,"SegmentVector");const Xm=Fi([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Ym=Fi([{name:"a_pattern_b",components:4,type:"Uint16"}]),cu=Fi([{name:"a_dash",components:4,type:"Uint16"}]);class kc{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,s,l,h){this.ids.push(Qd(e)),this.positions.push(s,l,h)}eachPosition(e,s){const l=Qd(e);let h=0,p=this.ids.length-1;for(;h<p;){const g=h+p>>1;this.ids[g]>=l?p=g:h=g+1}for(;this.ids[h]===l;)s(this.positions[3*h],this.positions[3*h+1],this.positions[3*h+2]),h++}static serialize(e,s){const l=new Float64Array(e.ids),h=new Uint32Array(e.positions);return ef(l,h,0,l.length-1),s&&(s.add(l.buffer),s.add(h.buffer)),{ids:l,positions:h}}static deserialize(e){const s=new kc;let l;s.ids=e.ids,s.positions=e.positions;for(const h of s.ids)h!==l&&s.uniqueIds.push(h),l=h;return s.indexed=!0,s}}function Qd(n){const e=+n;return Number.isSafeInteger(e)?e:oh(String(n))}function ef(n,e,s,l){for(;s<l;){const h=n[s+l>>1];let p=s-1,g=l+1;for(;;){do p++;while(n[p]<h);do g--;while(n[g]>h);if(p>=g)break;Mc(n,p,g),Mc(e,3*p,3*g),Mc(e,3*p+1,3*g+1),Mc(e,3*p+2,3*g+2)}g-s<l-g?(ef(n,e,s,g),s=g+1):(ef(n,e,g+1,l),l=g)}}function Mc(n,e,s){const l=n[e];n[e]=n[s],n[s]=l}Dt(kc,"FeaturePositionMap");class ra{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,s){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,s),this.initialized=!0),!!this.location}set(e,s,l){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Pc extends ra{constructor(e){super(e),this.current=0}set(e,s,l){this.fetchUniformLocation(e,s)&&this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))}}class Kr extends ra{constructor(e){super(e),this.current=0}set(e,s,l){this.fetchUniformLocation(e,s)&&this.current!==l&&(this.current=l,this.gl.uniform1f(this.location,l))}}class sa extends ra{constructor(e){super(e),this.current=[0,0]}set(e,s,l){this.fetchUniformLocation(e,s)&&(l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1])))}}class Lc extends ra{constructor(e){super(e),this.current=[0,0,0]}set(e,s,l){this.fetchUniformLocation(e,s)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2])))}}class zc extends ra{constructor(e){super(e),this.current=[0,0,0,0]}set(e,s,l){this.fetchUniformLocation(e,s)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]&&l[3]===this.current[3]||(this.current=l,this.gl.uniform4f(this.location,l[0],l[1],l[2],l[3])))}}class Qp extends ra{constructor(e){super(e),this.current=er.transparent.toPremultipliedRenderColor(null)}set(e,s,l){this.fetchUniformLocation(e,s)&&(l.r===this.current.r&&l.g===this.current.g&&l.b===this.current.b&&l.a===this.current.a||(this.current=l,this.gl.uniform4f(this.location,l.r,l.g,l.b,l.a)))}}const qm=new Float32Array(16);class Rc extends ra{constructor(e){super(e),this.current=qm}set(e,s,l){if(this.fetchUniformLocation(e,s)){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(let h=1;h<16;h++)if(l[h]!==this.current[h]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}}}}const Zm=new Float32Array(9),$m=new Float32Array(4);class hu extends ra{constructor(e){super(e),this.current=$m}set(e,s,l){if(this.fetchUniformLocation(e,s)){for(let h=0;h<4;h++)if(l[h]!==this.current[h]){this.current=l,this.gl.uniformMatrix2fv(this.location,!1,l);break}}}}function Dc(n){return[Ic(255*n.r,255*n.g),Ic(255*n.b,255*n.a)]}class wn{constructor(e,s,l,h){this.value=e,this.uniformNames=s.map(p=>`u_${p}`),this.type=l,this.context=h}setUniform(e,s,l,h,p){const g=h.constantOr(this.value);s.set(e,p,g instanceof er?g.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.kind==="constant"&&this.lutExpression.value==="none"?null:this.context.lut):g)}getBinding(e,s){return this.type==="color"?new Qp(e):new Kr(e)}}class Vo{constructor(e,s){this.uniformNames=s.map(l=>`u_${l}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(e,s){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br),this.patternTransition=s?s.tl.concat(s.br):this.pattern}setUniform(e,s,l,h,p){let g=null;p!=="u_pattern"&&p!=="u_dash"||(g=this.pattern),p==="u_pattern_b"&&(g=this.patternTransition),p==="u_pixel_ratio"&&(g=this.pixelRatio),g&&s.set(e,p,g)}getBinding(e,s){return s==="u_pattern"||s==="u_pattern_b"||s==="u_dash"?new zc(e):new Kr(e)}}class no{constructor(e,s,l,h){this.expression=e,this.type=l,this.maxValue=0,this.paintVertexAttributes=s.map(p=>({name:`a_${p}`,type:"Float32",components:l==="color"?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(e,s,l,h,p,g,x,w){const T=this.paintVertexArray.length,I=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new _r(0,{brightness:g,worldview:w}),s,{},p,h,x):this.expression.kind==="constant"&&this.expression.value,M=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new _r(0,{brightness:g,worldview:w}),s,{},p,h,x):this.lutExpression.value)==="none";this.paintVertexArray.resize(e),this._setPaintValue(T,e,I,M?null:this.context.lut)}updatePaintArray(e,s,l,h,p,g,x,w){const T=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:x,worldview:w},l,h,void 0,p):this.expression.kind==="constant"&&this.expression.value,I=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new _r(0,{brightness:x,worldview:w}),l,h,void 0,p):this.lutExpression.value)==="none";this._setPaintValue(e,s,T,I?null:this.context.lut)}_setPaintValue(e,s,l,h){if(this.type==="color"){const p=Dc(l.toPremultipliedRenderColor(h));for(let g=e;g<s;g++)this.paintVertexArray.emplace(g,p[0],p[1])}else{for(let p=e;p<s;p++)this.paintVertexArray.emplace(p,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Aa{constructor(e,s,l,h,p,g){this.expression=e,this.uniformNames=s.map(x=>`u_${x}_t`),this.type=l,this.useIntegerZoom=h,this.context=p,this.maxValue=0,this.paintVertexAttributes=s.map(x=>({name:`a_${x}`,type:"Float32",components:l==="color"?4:2,offset:0})),this.paintVertexArray=new g}populatePaintArray(e,s,l,h,p,g,x,w){const T=this.expression.evaluate(new _r(this.context.zoom,{brightness:g,worldview:w}),s,{},p,h,x),I=this.expression.evaluate(new _r(this.context.zoom+1,{brightness:g,worldview:w}),s,{},p,h,x),M=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new _r(0,{brightness:g,worldview:w}),s,{},p,h,x):this.lutExpression.value)==="none",R=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(R,e,T,I,M?null:this.context.lut)}updatePaintArray(e,s,l,h,p,g,x,w){const T=this.expression.evaluate({zoom:this.context.zoom,brightness:x,worldview:w},l,h,void 0,p),I=this.expression.evaluate({zoom:this.context.zoom+1,brightness:x,worldview:w},l,h,void 0,p),M=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new _r(0,{brightness:x,worldview:w}),l,h,void 0,p):this.lutExpression.value)==="none";this._setPaintValue(e,s,T,I,M?null:this.context.lut)}_setPaintValue(e,s,l,h,p){if(this.type==="color"){const g=Dc(l.toPremultipliedRenderColor(p)),x=Dc(l.toPremultipliedRenderColor(p));for(let w=e;w<s;w++)this.paintVertexArray.emplace(w,g[0],g[1],x[0],x[1])}else{for(let g=e;g<s;g++)this.paintVertexArray.emplace(g,l,h);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(h))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,s,l,h,p){const g=this.useIntegerZoom?Math.floor(l.zoom):l.zoom,x=Ee(this.expression.interpolationFactor(g,this.context.zoom,this.context.zoom+1),0,1);s.set(e,p,x)}getBinding(e,s){return new Kr(e)}}class Ta{constructor(e,s,l,h,p){this.expression=e,this.layerId=p,this.paintVertexAttributes=(l==="array"?cu:Xm).members;for(let g=0;g<s.length;++g);this.paintVertexArray=new h,this.paintTransitionVertexArray=new wl}populatePaintArray(e,s,l,h){const p=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(p,e,s.patterns&&s.patterns[this.layerId],l)}updatePaintArray(e,s,l,h,p,g,x){this._setPaintValues(e,s,l.patterns&&l.patterns[this.layerId],g)}_setPaintValues(e,s,l,h){if(!h||!l)return;const p=h[l[0]],g=h[l[1]];if(p){if(p){const{tl:x,br:w,pixelRatio:T}=p;for(let I=e;I<s;I++)this.paintVertexArray.emplace(I,x[0],x[1],w[0],w[1],T)}if(g){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:x,br:w}=g;for(let T=e;T<s;T++)this.paintTransitionVertexArray.emplace(T,x[0],x[1],w[0],w[1])}}}upload(e){const s=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,s)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=e.createVertexBuffer(this.paintTransitionVertexArray,Ym.members,s))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class Uo{constructor(e,s,l=()=>!0){this.binders={},this._buffers=[],this.context=s;const h=[];for(const p in e.paint._values){const g=e.paint.get(p);if(p.endsWith("-use-theme")||!l(p)||!(g instanceof Ro&&Bh(g.property.specification)))continue;const x=_x(p,e.type),w=g.value,T=g.property.specification.type,I=!!g.property.useIntegerZoom,M=p==="line-dasharray"||p.endsWith("pattern"),R=e.paint.get(`${p}-use-theme`),B=p==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant"||R&&R.value.kind!=="constant";if(w.kind!=="constant"||B)if(w.kind==="source"||B||M){const V=o(p,T,"source");this.binders[p]=M?new Ta(w,x,T,V,e.id):new no(w,x,T,V),h.push(`/a_${p}`)}else{const V=o(p,T,"composite");this.binders[p]=new Aa(w,x,T,I,s,V),h.push(`/z_${p}`)}else this.binders[p]=M?new Vo(w.value,x):new wn(w.value,x,T,s),h.push(`/u_${p}`);R&&(this.binders[p].lutExpression=R.value)}this.cacheKey=h.sort().join("")}getMaxValue(e){const s=this.binders[e];return s instanceof no||s instanceof Aa?s.maxValue:0}populatePaintArrays(e,s,l,h,p,g,x,w){for(const T in this.binders){const I=this.binders[T];I.context=this.context,(I instanceof no||I instanceof Aa||I instanceof Ta)&&I.populatePaintArray(e,s,l,h,p,g,x,w)}}setConstantPatternPositions(e,s){for(const l in this.binders){const h=this.binders[l];h instanceof Vo&&h.setConstantPatternPositions(e,s)}}getPatternTransitionVertexBuffer(e){const s=this.binders[e];return s instanceof Ta?s.paintTransitionVertexBuffer:null}updatePaintArrays(e,s,l,h,p,g,x,w,T,I){let M=!1;const R=Object.keys(e),B=R.length!==0&&!w,V=B?R:s.uniqueIds;this.context.lut=p.lut;for(const q in this.binders){const Z=this.binders[q];if(Z.context=this.context,(Z instanceof no||Z instanceof Aa||Z instanceof Ta)&&Z.expression&&Z.expression.kind&&Z.expression.kind!=="constant"&&(Z.expression.isStateDependent===!0||Z.expression.isLightConstant===!1)){const $=p.paint.get(q);Z.expression=$.value;for(const ne of V){const ae=e[ne.toString()];s.eachPosition(ne,(le,be,we)=>{const ke=h.feature(le);Z.updatePaintArray(be,we,ke,ae,g,x,T,I)})}if(!B)for(const ne of l.uniqueIds){const ae=e[ne.toString()];l.eachPosition(ne,(le,be,we)=>{const ke=h.feature(le);Z.updatePaintArray(be,we,ke,ae,g,x,T,I)})}M=!0}}return M}defines(){const e=[];for(const s in this.binders){const l=this.binders[s];(l instanceof wn||l instanceof Vo)&&e.push(...l.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const s=[];for(const l in this.binders){const h=this.binders[l];if(h instanceof wn||h instanceof Vo||h instanceof Aa)for(const p of h.uniformNames)s.push({name:p,property:l,binding:h.getBinding(e,p)})}return s}setUniforms(e,s,l,h,p){for(const{name:g,property:x,binding:w}of l)this.binders[x].setUniform(e,w,p,h.get(x),g)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const s=this.binders[e];(s instanceof no||s instanceof Aa||s instanceof Ta)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer),s instanceof Ta&&s.paintTransitionVertexBuffer&&this._buffers.push(s.paintTransitionVertexBuffer)}}upload(e){for(const s in this.binders){const l=this.binders[s];(l instanceof no||l instanceof Aa||l instanceof Ta)&&l.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const s=this.binders[e];(s instanceof no||s instanceof Aa||s instanceof Ta)&&s.destroy()}}}class Gn{constructor(e,s,l=()=>!0){this.programConfigurations={};for(const h of e)this.programConfigurations[h.id]=new Uo(h,s,l);this.needsUpload=!1,this._featureMap=new kc,this._featureMapWithoutIds=new kc,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,s,l,h,p,g,x,w,T){for(const I in this.programConfigurations)this.programConfigurations[I].populatePaintArrays(e,s,h,p,g,x,w,T);s.id!==void 0?this._featureMap.add(s.id,l,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,l,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,s,l,h,p,g,x,w){for(const T of l)this.needsUpload=this.programConfigurations[T.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,s,T,h,p,g,x||0,w)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const s in this.programConfigurations)this.programConfigurations[s].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const eg={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function _x(n,e){return eg[n]||[n.replace(`${e}-`,"").replace(/-/g,"_")]}const d={"line-pattern":{source:so,composite:so},"fill-pattern":{source:so,composite:so},"fill-extrusion-pattern":{source:so,composite:so},"line-dasharray":{source:wl,composite:wl}},i={color:{source:Tl,composite:Wn},number:{source:ro,composite:Tl}};function o(n,e,s){const l=d[n];return l&&l[s]||i[e][s]}Dt(wn,"ConstantBinder"),Dt(Vo,"PatternConstantBinder"),Dt(no,"SourceExpressionBinder"),Dt(Ta,"PatternCompositeBinder"),Dt(Aa,"CompositeExpressionBinder"),Dt(Uo,"ProgramConfiguration",{omit:["_buffers"]}),Dt(Gn,"ProgramConfigurationSet");const u=At/Math.PI/2,m=5,y=6,b=16383,A=64,C=[A,32,16],z=-u,D=u;function U(n,e,s,l=u){return s=Oe(s),[n*Math.sin(s)*l,-e*l,n*Math.cos(s)*l]}function F(n,e,s){return U(Math.cos(Oe(n)),Math.sin(Oe(n)),e,s)}const W=63710088e-1,X=2*Math.PI*W;class Y{constructor(e,s){if(isNaN(e)||isNaN(s))throw new Error(`Invalid LngLat object: (${e}, ${s})`);if(this.lng=+e,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Y(De(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const s=Math.PI/180,l=this.lat*s,h=e.lat*s,p=Math.sin(l)*Math.sin(h)+Math.cos(l)*Math.cos(h)*Math.cos((e.lng-this.lng)*s);return W*Math.acos(Math.min(p,1))}toBounds(e=0){const s=360*e/40075017,l=s/Math.cos(Math.PI/180*this.lat);return new te({lng:this.lng-l,lat:this.lat-s},{lng:this.lng+l,lat:this.lat+s})}toEcef(e){return F(this.lat,this.lng,u+e*u/W)}static convert(e){if(e instanceof Y)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Y(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Y(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class te{constructor(e,s){e&&(s?this.setSouthWest(e).setNorthEast(s):Array.isArray(e)&&e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Y?new Y(e.lng,e.lat):Y.convert(e),this}setSouthWest(e){return this._sw=e instanceof Y?new Y(e.lng,e.lat):Y.convert(e),this}extend(e){const s=this._sw,l=this._ne;let h,p;if(e instanceof Y)h=e,p=e;else{if(!(e instanceof te))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(te.convert(e)):this.extend(Y.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(Y.convert(e)):this;if(h=e._sw,p=e._ne,!h||!p)return this}return s||l?(s.lng=Math.min(h.lng,s.lng),s.lat=Math.min(h.lat,s.lat),l.lng=Math.max(p.lng,l.lng),l.lat=Math.max(p.lat,l.lat)):(this._sw=new Y(h.lng,h.lat),this._ne=new Y(p.lng,p.lat)),this}getCenter(){return new Y((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Y(this.getWest(),this.getNorth())}getSouthEast(){return new Y(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:s,lat:l}=Y.convert(e);let h=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&h}static convert(e){if(e)return e instanceof te?e:new te(e)}}const J=0,re=25.5;function oe(n){return X*Math.cos(n*Math.PI/180)}function he(n){return(180+n)/360}function ye(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function me(n,e){return n/oe(e)}function xe(n){return 360*n-180}function _e(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function ge(n,e){return n*oe(_e(e))}const Ae=85.051129;function je(n){return Math.cos(Oe(Ee(n,-85.051129,Ae)))}function Re(n,e){const s=Ee(e,J,re),l=Math.pow(2,s);return je(n)*X/(512*l)}function Je(n){return 1/Math.cos(n*Math.PI/180)}function Ne(n,e=0){const s=Math.exp(Math.PI*(1-(n.y+e/At)/(1<<n.z)*2));return 80150034*s/(s*s+1)/At/(1<<n.z)}class $e{constructor(e,s,l=0){this.x=+e,this.y=+s,this.z=+l}static fromLngLat(e,s=0){const l=Y.convert(e);return new $e(he(l.lng),ye(l.lat),me(s,l.lat))}toLngLat(){return new Y(xe(this.x),_e(this.y))}toAltitude(){return ge(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/X*Je(_e(this.y))}}function vt(n,e,s,l,h,p,g,x,w){const T=(e+l)/2,I=(s+h)/2,M=new mt(T,I);x(M),function(R,B,V,q,Z,$){const ne=V-Z,ae=q-$;return Math.abs((q-B)*ne-(V-R)*ae)/Math.hypot(ne,ae)}(M.x,M.y,p.x,p.y,g.x,g.y)>=w?(vt(n,e,s,T,I,p,M,x,w),vt(n,T,I,l,h,M,g,x,w)):n.push(g)}function Ve(n,e,s){let l=n[0],h=l.x,p=l.y;e(l);const g=[l];for(let x=1;x<n.length;x++){const w=n[x],{x:T,y:I}=w;e(w),vt(g,h,p,T,I,l,w,e,s),h=T,p=I,l=w}return g}function Pe(n,e,s,l){if(l(e,s)){const h=e.add(s)._mult(.5);Pe(n,e,h,l),Pe(n,h,s,l)}else n.push(s)}function Qe(n,e){let s=n[0];const l=[s];for(let h=1;h<n.length;h++){const p=n[h];Pe(l,s,p,e),s=p}return l}const We=Math.pow(2,14)-1,at=-We-1;function xt(n,e){const s=Math.round(n.x*e),l=Math.round(n.y*e);return n.x=Ee(s,at,We),n.y=Ee(l,at,We),(s<n.x||s>n.x+1||l<n.y||l>n.y+1)&&Di("Geometry exceeds allowed extent, reduce your vector tile buffer size"),n}function Pt(n,e,s){const l=n.loadGeometry(),h=n.extent,p=At/h;if(e&&s&&s.projection.isReprojectedInTileSpace){const g=1<<e.z,{scale:x,x:w,y:T,projection:I}=s,M=R=>{const B=xe((e.x+R.x/h)/g),V=_e((e.y+R.y/h)/g),q=I.project(B,V);R.x=(q.x*x-w)*h,R.y=(q.y*x-T)*h};for(let R=0;R<l.length;R++)if(n.type!==1)l[R]=Ve(l[R],M,1);else{const B=[];for(const V of l[R])V.x<0||V.x>=h||V.y<0||V.y>=h||(M(V),B.push(V));l[R]=B}}for(const g of l)for(const x of g)xt(x,p);return l}function pt(n,e){return{type:n.type,id:n.id,properties:n.properties,geometry:e?Pt(n):[]}}class ht{constructor(e,s,l,h,p){this.properties={},this.extent=l,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=h,this._values=p,e.readFields(Wt,this,s)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const s=e.readVarint()+e.pos,l=[];let h,p=1,g=0,x=0,w=0;for(;e.pos<s;){if(g<=0){const T=e.readVarint();p=7&T,g=T>>3}if(g--,p===1||p===2)x+=e.readSVarint(),w+=e.readSVarint(),p===1&&(h&&l.push(h),h=[]),h&&h.push(new mt(x,w));else{if(p!==7)throw new Error(`unknown command ${p}`);h&&h.push(h[0].clone())}}return h&&l.push(h),l}bbox(){const e=this._pbf;e.pos=this._geometry;const s=e.readVarint()+e.pos;let l=1,h=0,p=0,g=0,x=1/0,w=-1/0,T=1/0,I=-1/0;for(;e.pos<s;){if(h<=0){const M=e.readVarint();l=7&M,h=M>>3}if(h--,l===1||l===2)p+=e.readSVarint(),g+=e.readSVarint(),p<x&&(x=p),p>w&&(w=p),g<T&&(T=g),g>I&&(I=g);else if(l!==7)throw new Error(`unknown command ${l}`)}return[x,T,w,I]}toGeoJSON(e,s,l){const h=this.extent*Math.pow(2,l),p=this.extent*e,g=this.extent*s,x=this.loadGeometry();function w(R){return[360*(R.x+p)/h-180,360/Math.PI*Math.atan(Math.exp((1-2*(R.y+g)/h)*Math.PI))-90]}function T(R){return R.map(w)}let I;if(this.type===1){const R=[];for(const V of x)R.push(V[0]);const B=T(R);I=R.length===1?{type:"Point",coordinates:B[0]}:{type:"MultiPoint",coordinates:B}}else if(this.type===2){const R=x.map(T);I=R.length===1?{type:"LineString",coordinates:R[0]}:{type:"MultiLineString",coordinates:R}}else{if(this.type!==3)throw new Error("unknown feature type");{const R=function(V){const q=V.length;if(q<=1)return[V];const Z=[];let $,ne;for(let ae=0;ae<q;ae++){const le=Ut(V[ae]);le!==0&&(ne===void 0&&(ne=le<0),ne===le<0?($&&Z.push($),$=[V[ae]]):$&&$.push(V[ae]))}return $&&Z.push($),Z}(x),B=[];for(const V of R)B.push(V.map(T));I=B.length===1?{type:"Polygon",coordinates:B[0]}:{type:"MultiPolygon",coordinates:B}}}const M={type:"Feature",geometry:I,properties:this.properties};return this.id!=null&&(M.id=this.id),M}}function Wt(n,e,s){n===1?e.id=s.readVarint():n===2?function(l,h){const p=l.readVarint()+l.pos;for(;l.pos<p;){const g=h._keys[l.readVarint()],x=h._values[l.readVarint()];h.properties[g]=x}}(s,e):n===3?e.type=s.readVarint():n===4&&(e._geometry=s.pos)}function Ut(n){let e=0;for(let s,l,h=0,p=n.length,g=p-1;h<p;g=h++)s=n[h],l=n[g],e+=(l.x-s.x)*(s.y+l.y);return e}ht.types=["Unknown","Point","LineString","Polygon"];class Ht{constructor(e,s){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(Vt,this,s),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const s=this._pbf.readVarint()+this._pbf.pos;return new ht(this._pbf,s,this.extent,this._keys,this._values)}}function Vt(n,e,s){n===15?e.version=s.readVarint():n===1?e.name=s.readString():n===5?e.extent=s.readVarint():n===2?e._features.push(s.pos):n===3?e._keys.push(s.readString()):n===4&&e._values.push(function(l){let h=null;const p=l.readVarint()+l.pos;for(;l.pos<p;){const g=l.readVarint()>>3;h=g===1?l.readString():g===2?l.readFloat():g===3?l.readDouble():g===4?l.readVarint64():g===5?l.readVarint():g===6?l.readSVarint():g===7?l.readBoolean():null}if(h==null)throw new Error("unknown feature value");return h}(s))}class oi{constructor(e,s){this.layers=e.readFields(yi,{},s)}}function yi(n,e,s){if(n===3){const l=new Ht(s,s.readVarint()+s.pos);l.length&&(e[l.name]=l)}}const wi="3d_elevation_id",ir="level";class hi{constructor(){this._valid=!1}reset(e){return this.feature=e,this._valid=!0,this._geometry=e.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(e,s){return this._valid&&e(s(this._geometry)),this}require(e,s,l){return this.get(e,!0,s,l)}optional(e,s,l){return this.get(e,!1,s,l)}success(){return this._valid}get(e,s,l,h){const p=this.feature.properties.hasOwnProperty(e)?+this.feature.properties[e]:void 0;return this._valid&&p!==void 0&&!Number.isNaN(p)?l(h?h(p):p):s&&(this._valid=!1),this}}class Gi{constructor(e,s){this.featureFunc=e,this.vertexFunc=s}parseFeature(e,s,l){return this.featureFunc(e,s,l)}parseVertex(e,s,l){return this.vertexFunc(e,s,l)}}const Qi=new Gi((n,e,s)=>n.reset(e).require(wi,l=>{s.id=l}).optional("fixed_height_relative",l=>{s.constantHeight=l},xi.decodeRelativeHeight).geometry(l=>{s.bounds=l},_h).success(),(n,e,s)=>n.reset(e).require(wi,l=>{s.id=l}).require("elevation_idx",l=>{s.idx=l}).require("extent",l=>{s.extent=l}).require("height_relative",l=>{s.height=l},xi.decodeRelativeHeight).geometry(l=>{s.position=l},xi.getPoint).success()),Tr=new Gi((n,e,s)=>n.reset(e).require(wi,l=>{s.id=l}).optional("fixed_height",l=>{s.constantHeight=l},xi.decodeMetricHeight).geometry(l=>{s.bounds=l},_h).success(),(n,e,s)=>n.reset(e).require(wi,l=>{s.id=l}).require("elevation_idx",l=>{s.idx=l}).require("extent",l=>{s.extent=l}).require("height",l=>{s.height=l},xi.decodeMetricHeight).geometry(l=>{s.position=l},xi.getPoint).success());class xi{static getPoint(e){return Dn(e[0][0].x,e[0][0].y)}static decodeRelativeHeight(e){return 1e-4*e*5}static decodeMetricHeight(e){return 1e-4*e}static getVersionSchema(e){return e?e==="1.0.1"?Tr:void 0:Qi}static parse(e){const s=[],l=[],h=e.length,p=new hi;for(let g=0;g<h;g++){const x=e.feature(g),w=x.properties.version,T=xi.getVersionSchema(w);if(T===void 0){Di(`Unknown elevation feature version number ${w||"(unknown)"}`);continue}const I=x.properties.type;if(!I)continue;const M=ht.types[x.type];if(M==="Point"&&I==="curve_point"){const R={};T.parseVertex(p,x,R)&&s.push(R)}else if(M==="Polygon"&&I==="curve_meta"){const R={};T.parseFeature(p,x,R)&&l.push(R)}}return{vertices:s,features:l}}}class Zi{constructor(e,s){this.pos=e,this.dir=s}intersectsPlane(e,s,l){const h=As(s,this.dir);if(Math.abs(h)<1e-6)return!1;const p=((e[0]-this.pos[0])*s[0]+(e[1]-this.pos[1])*s[1])/h;return l[0]=this.pos[0]+this.dir[0]*p,l[1]=this.pos[1]+this.dir[1]*p,!0}}class Yi{constructor(e,s){this.pos=e,this.dir=s}intersectsPlane(e,s,l){const h=Ci(s,this.dir);if(Math.abs(h)<1e-6)return!1;const p=((e[0]-this.pos[0])*s[0]+(e[1]-this.pos[1])*s[1]+(e[2]-this.pos[2])*s[2])/h;return l[0]=this.pos[0]+this.dir[0]*p,l[1]=this.pos[1]+this.dir[1]*p,l[2]=this.pos[2]+this.dir[2]*p,!0}closestPointOnSphere(e,s,l){if(function(B,V){var q=B[0],Z=B[1],$=B[2],ne=V[0],ae=V[1],le=V[2];return Math.abs(q-ne)<=E*Math.max(1,Math.abs(q),Math.abs(ne))&&Math.abs(Z-ae)<=E*Math.max(1,Math.abs(Z),Math.abs(ae))&&Math.abs($-le)<=E*Math.max(1,Math.abs($),Math.abs(le))}(this.pos,e)||s===0)return l[0]=l[1]=l[2]=0,!1;const[h,p,g]=this.dir,x=this.pos[0]-e[0],w=this.pos[1]-e[1],T=this.pos[2]-e[2],I=h*h+p*p+g*g,M=2*(x*h+w*p+T*g),R=M*M-4*I*(x*x+w*w+T*T-s*s);if(R<0){const B=Math.max(-M/2,0),V=x+h*B,q=w+p*B,Z=T+g*B,$=Math.hypot(V,q,Z);return l[0]=V*s/$,l[1]=q*s/$,l[2]=Z*s/$,!1}{const B=(-M-Math.sqrt(R))/(2*I);if(B<0){const V=Math.hypot(x,w,T);return l[0]=x*s/V,l[1]=w*s/V,l[2]=T*s/V,!1}return l[0]=x+h*B,l[1]=w+p*B,l[2]=T+g*B,!0}}}class Ji{constructor(e,s,l,h,p){this.TL=e,this.TR=s,this.BR=l,this.BL=h,this.horizon=p}static fromInvProjectionMatrix(e,s,l){const h=[-1,1,1],p=[1,1,1],g=[1,-1,1],x=[-1,-1,1],w=Wi(h,h,e),T=Wi(p,p,e),I=Wi(g,g,e),M=Wi(x,x,e);return new Ji(w,T,I,M,s/l)}}function Cr(n,e,s){let l=1/0,h=-1/0;const p=[];for(const g of n){jr(p,g,e);const x=Ci(p,s);l=Math.min(l,x),h=Math.max(h,x)}return[l,h]}function qr(n,e){let s=!0;for(let l=0;l<n.planes.length;l++){const h=n.planes[l];let p=0;for(let g=0;g<e.length;g++)p+=+(Ci(h,e[g])+h[3]>=0);if(p===0)return 0;p!==e.length&&(s=!1)}return s?2:1}function xs(n,e){for(const s of n.projections){const l=Cr(e,n.points[0],s.axis);if(s.projection[1]<l[0]||s.projection[0]>l[1])return 0}return 1}function Ir(n,e){let s=0;const l=[0,0,0,0];for(let g=0;g<n.length;g++)l[0]=n[g][0],l[1]=n[g][1],l[2]=n[g][2],l[3]=1,(h=l)[0]*(p=e)[0]+h[1]*p[1]+h[2]*p[2]+h[3]*p[3]>=0&&s++;var h,p;return s}class Si{constructor(e,s){this.points=e||new Array(8).fill([0,0,0]),this.planes=s||new Array(6).fill([0,0,0,0]),this.bounds=ri.fromPoints(this.points),this.projections=[],this.frustumEdges=[jr([],this.points[2],this.points[3]),jr([],this.points[0],this.points[3]),jr([],this.points[4],this.points[0]),jr([],this.points[5],this.points[1]),jr([],this.points[6],this.points[2]),jr([],this.points[7],this.points[3])];for(const l of this.frustumEdges){const h=[0,-l[2],l[1]],p=[l[2],0,-l[0]];this.projections.push({axis:h,projection:Cr(this.points,this.points[0],h)}),this.projections.push({axis:p,projection:Cr(this.points,this.points[0],p)})}}static fromInvProjectionMatrix(e,s,l,h){const p=Math.pow(2,l),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(T=>{const I=an([],T,e),M=1/I[3]/s*p;return(R=I)[0]=(B=I)[0]*(V=[M,M,h?1/I[3]:M,M])[0],R[1]=B[1]*V[1],R[2]=B[2]*V[2],R[3]=B[3]*V[3],R;var R,B,V}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(T=>{const I=mi([],zi([],jr([],g[T[0]],g[T[1]]),jr([],g[T[2]],g[T[1]]))),M=-Ci(I,g[T[1]]);return I.concat(M)}),w=[];for(let T=0;T<g.length;T++)w.push([g[T][0],g[T][1],g[T][2]]);return new Si(w,x)}intersectsPrecise(e,s,l){for(let h=0;h<s.length;h++)if(!Ir(e,s[h]))return 0;for(let h=0;h<this.planes.length;h++)if(!Ir(e,this.planes[h]))return 0;for(const h of l)for(const p of this.frustumEdges){const g=zi([],h,p),x=bt(g);if(x===0)continue;Kt(g,g,1/x);const w=Cr(this.points,this.points[0],g),T=Cr(e,this.points[0],g);if(w[0]>T[1]||T[0]>w[1])return 0}return 1}containsPoint(e){for(const s of this.planes){const l=s[3];if(Ci([s[0],s[1],s[2]],e)+l<0)return!1}return!0}}class ri{static fromPoints(e){const s=[1/0,1/0,1/0],l=[-1/0,-1/0,-1/0];for(const h of e)Ti(s,s,h),vi(l,l,h);return new ri(s,l)}static fromTileIdAndHeight(e,s,l){const h=1<<e.canonical.z,p=e.canonical.x,g=e.canonical.y;return new ri([p/h,g/h,s],[(p+1)/h,(g+1)/h,l])}static applyTransform(e,s){const l=e.getCorners();for(let h=0;h<l.length;++h)Wi(l[h],l[h],s);return ri.fromPoints(l)}static applyTransformFast(e,s){const l=[s[12],s[13],s[14]],h=[...l];for(let p=0;p<3;p++)for(let g=0;g<3;g++){const x=s[4*g+p],w=x*e.min[g],T=x*e.max[g];l[p]+=Math.min(w,T),h[p]+=Math.max(w,T)}return new ri(l,h)}static projectAabbCorners(e,s){const l=e.getCorners();for(let h=0;h<l.length;++h)Wi(l[h],l[h],s);return l}constructor(e,s){this.min=e,this.max=s,this.center=Kt([],Lt([],this.min,this.max),.5)}quadrant(e){const s=[e%2==0,e<2],l=ft(this.min),h=ft(this.max);for(let p=0;p<s.length;p++)l[p]=s[p]?this.min[p]:this.center[p],h[p]=s[p]?this.center[p]:this.max[p];return h[2]=this.max[2],new ri(l,h)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,s=this.max;return[[e[0],e[1],e[2]],[s[0],e[1],e[2]],[s[0],s[1],e[2]],[e[0],s[1],e[2]],[e[0],e[1],s[2]],[s[0],e[1],s[2]],[s[0],s[1],s[2]],[e[0],s[1],s[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?qr(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?qr(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,s){return s||this.intersects(e)?xs(e,this.getCorners()):0}intersectsPreciseFlat(e,s){return s||this.intersectsFlat(e)?xs(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let s=0;s<3;++s)if(this.min[s]>e.max[s]||e.min[s]>this.max[s])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let s=0;s<3;s++)this.min[s]=Math.min(this.min[s],e.min[s]),this.max[s]=Math.max(this.max[s],e.max[s])}encapsulatePoint(e){for(let s=0;s<3;s++)this.min[s]=Math.min(this.min[s],e[s]),this.max[s]=Math.max(this.max[s],e[s])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}Dt(ri,"Aabb");class rr{constructor(e,s){this.feature=e,this.metersToTile=s,this.index=0}get(){const e=this.feature.vertices[this.index],s=this.feature.vertexProps[this.index].dir,l=s[1],h=-s[0],p=(e.extent+1)*this.metersToTile;return[new mt(Math.trunc(e.position[0]+l*p),Math.trunc(e.position[1]+h*p)),new mt(Math.trunc(e.position[0]-l*p),Math.trunc(e.position[1]-h*p))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class Vr{constructor(e,s,l,h,p,g){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[ks(),ks(),ks(),ks(),ks(),ks(),ks()],this.id=e,this.heightRange={min:l,max:l},this.safeArea=s,this.constantHeight=l,this.constantHeight==null&&(this.constantHeight!=null||h.length!==0)){this.vertices=h,this.edges=p,this.edges=this.edges.filter(x=>{return x.a<this.vertices.length&&x.b<this.vertices.length&&!((w=this.vertices[x.a].position)[0]===(T=this.vertices[x.b].position)[0]&&w[1]===T[1]);var w,T}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const x of this.vertices)this.vertexProps.push({dir:Dn(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,x.height),this.heightRange.max=Math.max(this.heightRange.max,x.height);for(const x of this.edges){const w=this.vertices[x.a].position,T=this.vertices[x.b].position,I=Jn(ks(),T,w),M=go(I),R=_a(ks(),I,1/M);this.edgeProps.push({vec:I,dir:R,len:M});const B=this.vertexProps[x.a].dir,V=this.vertexProps[x.b].dir;Ba(B,B,R),Ba(V,V,R)}for(const x of this.vertexProps)x.dir[0]===0&&x.dir[1]===0||Dr(x.dir,x.dir);this.tessellate(g)}}pointElevation(e){if(this.constantHeight!=null)return this.constantHeight;const s=this.getClosestEdge(e);if(s==null)return 0;const[l,h]=s;return ei(this.vertices[this.edges[l].a].height,this.vertices[this.edges[l].b].height,h)}computeSlopeNormal(e,s){const l=this.getClosestEdge(e);if(!l)return Tt(0,0,1);const h=l[0],p=this.edges[h],g=this.edgeProps[h].vec,x=Tt(g[0],g[1],(this.vertices[p.b].height-this.vertices[p.a].height)*s),w=Tt(x[1],-x[0],0);zi(w,w,x);const T=bt(w);return T>0?Kt(w,w,1/T):Et(w,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(e){if(this.edges.length===0)return;let s=0,l=Number.POSITIVE_INFINITY,h=0;const[p,g,x,w,T,I,M]=this._tmpVec2;ql(M,e.x,e.y);const R=new Zi(M,null);for(let B=0;B<this.edges.length;B++){const V=this.edges[B],q=this.edgeProps[B].dir;R.dir=q;const Z=this.vertices[V.a].position,$=this.vertices[V.b].position,ne=R.intersectsPlane(Z,this.vertexProps[V.a].dir,p),ae=R.intersectsPlane($,this.vertexProps[V.b].dir,g);if(!ne||!ae)continue;Jn(x,g,p),Jn(w,M,p);const le=As(x,x),be=le>0?As(w,x)/le:0,we=Ee(be,0,1),ke=Math.abs((be-we)*this.edgeProps[B].len);Jn(T,M,Z),ql(I,q[1],-q[0]);const Le=ke+Math.abs(As(T,I));Le<l&&(s=B,l=Le,h=we)}return[s,h]}tessellate(e){const s=qe(),l=qe(),h=qe(),p=qe();for(let g=this.edges.length-1;g>=0;--g){const x=this.edges[g].a,w=this.edges[g].b,{position:T,height:I,extent:M}=this.vertices[x],{position:R,height:B,extent:V}=this.vertices[w],q=this.vertexProps[x].dir,Z=this.vertexProps[w].dir;if(Et(s,T[0]/e,T[1]/e,I),Et(l,R[0]/e,R[1]/e,B),Et(h,q[1],-q[0],0),Kt(h,h,M),Et(p,Z[1],-Z[0],0),Kt(p,p,V),this.distSqLines(Tt(s[0]+.5*h[0],s[1]+.5*h[1],s[2]+.5*h[2]),Tt(l[0]-.5*p[0],l[1]-.5*p[1],l[2]-.5*p[2]),Tt(s[0]-.5*h[0],s[1]-.5*h[1],s[2]-.5*h[2]),Tt(l[0]+.5*p[0],l[1]+.5*p[1],l[2]+.5*p[2]))<=.0025000000000000005)continue;const $=this.vertices.length,ne=Ba(ks(),T,R);this.vertices.push({position:_a(ne,ne,.5),height:.5*(I+B),extent:.5*(M+V)});const ae=Ba(ks(),q,Z);this.vertexProps.push({dir:Dr(ae,ae)}),this.edges.splice(g,1),this.edgeProps.splice(g,1),this.edges.push({a:x,b:$}),this.edges.push({a:$,b:w});const le=Jn(ks(),this.vertices[$].position,T),be=go(le),we={vec:le,dir:_a(ks(),le,1/be),len:be};this.edgeProps.push(we),this.edgeProps.push(we)}}distSqLines(e,s,l,h){const p=qt(qe(),s,e),g=qt(qe(),h,l),x=qt(qe(),e,l),w=Ci(p,p),T=Ci(p,g),I=Ci(p,x),M=Ci(g,g),R=Ci(g,x),B=w*M-T*T;if(B===0)return Br(mr(p,l,h,Ci(x,g)/Ci(g,g)),e);const V=(w*R-T*I)/B;return Br(mr(p,e,s,(T*R-I*M)/B),mr(g,l,h,V))}}class Mr{static parseFrom(e,s){const l=xi.parse(e);if(!l)return[];let{vertices:h,features:p}=l;const g=1/Ne(s);p.sort((I,M)=>I.id-M.id),h.sort((I,M)=>I.id-M.id||I.idx-M.idx),h=h.filter((I,M,R)=>M===R.findIndex(B=>B.id===I.id&&B.idx===I.idx));const x=new Array;let w=0;const T=h.length;for(const I of p){if(I.constantHeight){x.push(new Vr(I.id,I.bounds,I.constantHeight));continue}for(;w!==T&&h[w].id<I.id;)w++;if(w===T||h[w].id!==I.id)continue;const M=new Array,R=new Array,B=w;for(;w!==T&&h[w].id===I.id;){const V=h[w];if(M.push({position:V.position,height:V.height,extent:V.extent}),w!==B&&h[w-1].idx===V.idx-1){const q=w-B;R.push({a:q-1,b:q})}w++}x.push(new Vr(I.id,I.bounds,void 0,M,R,g))}return x}static getElevationFeature(e,s){if(!s)return;const l=+e.properties[wi];return Number.isNaN(l)?void 0:s.find(h=>h.id===l)}}class is{constructor(e,s){this.zScale=1,this.xOffset=0,this.yOffset=0,e.equals(s)||(this.zScale=Math.pow(2,s.z-e.z),this.xOffset=(e.x*this.zScale-s.x)*At,this.yOffset=(e.y*this.zScale-s.y)*At)}constantElevation(e,s){if(e.constantHeight!=null)return this.computeBiasedHeight(e.constantHeight,s)}pointElevation(e,s,l){const h=this.constantElevation(s,l);return h!=null?h:(e.x=e.x*this.zScale+this.xOffset,e.y=e.y*this.zScale+this.yOffset,this.computeBiasedHeight(s.pointElevation(e),l))}computeBiasedHeight(e,s){return s<=0?e:e+s*Ye(0,s,e>=0?e:Math.abs(.5*e))}}Dt(Vr,"ElevationFeature");class Ts{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new io,this.indexArray=new gs,this.segments=new zr,this.programConfigurations=new Gn(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new ro),this.worldview=e.worldview}updateFootprints(e,s){}populate(e,s,l,h){const p=this.layers[0],g=[];let x=null;p.type==="circle"&&(x=p.layout.get("circle-sort-key"));for(const{feature:T,id:I,index:M,sourceLayerIndex:R}of e){const B=this.layers[0]._featureFilter.needGeometry,V=pt(T,B);if(!this.layers[0]._featureFilter.filter(new _r(this.zoom,{worldview:this.worldview}),V,l))continue;const q=x?x.evaluate(V,{},l):void 0,Z={id:I,properties:T.properties,type:T.type,sourceLayerIndex:R,index:M,geometry:B?V.geometry:Pt(T,l,h),patterns:{},sortKey:q};g.push(Z)}x&&g.sort((T,I)=>T.sortKey-I.sortKey);let w=null;h.projection.name==="globe"&&(this.globeExtVertexArray=new iu,w=h.projection);for(const T of g){const{geometry:I,index:M,sourceLayerIndex:R}=T,B=e[M].feature;this.addFeature(T,I,M,s.availableImages,l,w,s.brightness,s.elevationFeatures),s.featureIndex.insert(B,I,M,R,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(e,s,l,h,p,g,x){this.programConfigurations.updatePaintArrays(e,s,p,l,h,g,x,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Hm.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Gm.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,Wm.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(e,s,l,h,p,g,x,w){let T;this.elevationMode!=="none"&&(T=Mr.getElevationFeature(e,w));for(const I of s)for(const M of I){const R=M.x,B=M.y;if(R<0||R>=At||B<0||B>=At)continue;if(g){const Z=g.projectTilePoint(R,B,p),$=g.upVector(p,R,B);this.addGlobeExtVertex(Z,$),this.addGlobeExtVertex(Z,$),this.addGlobeExtVertex(Z,$),this.addGlobeExtVertex(Z,$)}const V=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),q=V.vertexLength;if(this.addCircleVertex(R,B,-1,-1),this.addCircleVertex(R,B,1,-1),this.addCircleVertex(R,B,1,1),this.addCircleVertex(R,B,-1,1),this.elevationMode!=="none"){const Z=T?T.pointElevation(new mt(R,B)):0;this.hasElevation=this.hasElevation||Z!==0;for(let $=0;$<4;$++)this.elevatedLayoutVertexArray.emplaceBack(Z)}this.indexArray.emplaceBack(q,q+1,q+2),this.indexArray.emplaceBack(q,q+2,q+3),V.vertexLength+=4,V.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,{},h,p,x,void 0,this.worldview)}addCircleVertex(e,s,l,h){this.layoutVertexArray.emplaceBack(2*e+(l+1)/2,2*s+(h+1)/2)}addGlobeExtVertex(e,s){this.globeExtVertexArray.emplaceBack(e.x,e.y,e.z,s[0]*16384,s[1]*16384,s[2]*16384)}}function Sn(n,e){for(let s=0;s<n.length;s++)if(vs(e,n[s]))return!0;for(let s=0;s<e.length;s++)if(vs(n,e[s]))return!0;return!!Ys(n,e)}function An(n,e,s){return!!vs(n,e)||!!Zr(e,n,s)}function cn(n,e){if(n.length===1)return us(e,n[0]);for(let s=0;s<e.length;s++){const l=e[s];for(let h=0;h<l.length;h++)if(vs(n,l[h]))return!0}for(let s=0;s<n.length;s++)if(us(e,n[s]))return!0;for(let s=0;s<e.length;s++)if(Ys(n,e[s]))return!0;return!1}function hn(n,e,s){if(n.length>1){if(Ys(n,e))return!0;for(let l=0;l<e.length;l++)if(Zr(e[l],n,s))return!0}for(let l=0;l<n.length;l++)if(Zr(n[l],e,s))return!0;return!1}function Ys(n,e){if(n.length===0||e.length===0)return!1;for(let s=0;s<n.length-1;s++){const l=n[s],h=n[s+1];for(let p=0;p<e.length-1;p++)if(Ln(l,h,e[p],e[p+1]))return!0}return!1}function Ln(n,e,s,l){return Yr(n,s,l)!==Yr(e,s,l)&&Yr(n,e,s)!==Yr(n,e,l)}function Xn(n,e,s){return(n.x-s.x)*(e.y-s.y)-(n.y-s.y)*(e.x-s.x)}function Gr(n,e,s,l){const h=Xn(n,e,l),p=Xn(n,e,s);if(Math.sign(h)===Math.sign(p))return;const g=Xn(s,l,n),x=g+p-h;return Math.sign(g)!==Math.sign(x)?[g/(g-x),p/(p-h)]:void 0}function Zr(n,e,s){const l=s*s;if(e.length===1)return n.distSqr(e[0])<l;for(let h=1;h<e.length;h++)if(Pr(n,e[h-1],e[h])<l)return!0;return!1}function Pr(n,e,s){const l=e.distSqr(s);if(l===0)return n.distSqr(e);const h=((n.x-e.x)*(s.x-e.x)+(n.y-e.y)*(s.y-e.y))/l;return n.distSqr(h<0?e:h>1?s:s.sub(e)._mult(h)._add(e))}function us(n,e){let s,l,h,p=!1;for(let g=0;g<n.length;g++){s=n[g];for(let x=0,w=s.length-1;x<s.length;w=x++)l=s[x],h=s[w],l.y>e.y!=h.y>e.y&&e.x<(h.x-l.x)*(e.y-l.y)/(h.y-l.y)+l.x&&(p=!p)}return p}function vs(n,e){let s=!1;for(let l=0,h=n.length-1;l<n.length;h=l++){const p=n[l],g=n[h];p.y>e.y!=g.y>e.y&&e.x<(g.x-p.x)*(e.y-p.y)/(g.y-p.y)+p.x&&(s=!s)}return s}function Qr(n,e,s,l,h){for(const g of n)if(e<=g.x&&s<=g.y&&l>=g.x&&h>=g.y)return!0;const p=[new mt(e,s),new mt(e,h),new mt(l,h),new mt(l,s)];if(n.length>2){for(const g of p)if(vs(n,g))return!0}for(let g=0;g<n.length-1;g++)if(zs(n[g],n[g+1],p))return!0;return!1}function zs(n,e,s){const l=s[0],h=s[2];if(n.x<l.x&&e.x<l.x||n.x>h.x&&e.x>h.x||n.y<l.y&&e.y<l.y||n.y>h.y&&e.y>h.y)return!1;const p=Yr(n,e,s[0]);return p!==Yr(n,e,s[1])||p!==Yr(n,e,s[2])||p!==Yr(n,e,s[3])}function na(n,e,s,l,h,p){let g=e.y-n.y,x=n.x-e.x;if(p=p||0){const w=g*g+x*x;if(w===0)return!0;const T=Math.sqrt(w);g/=T,x/=T}return!((s.x-n.x)*g+(s.y-n.y)*x-p<0||(l.x-n.x)*g+(l.y-n.y)*x-p<0||(h.x-n.x)*g+(h.y-n.y)*x-p<0)}function Ea(n,e,s,l,h,p,g){return!(na(n,e,l,h,p,g)||na(e,s,l,h,p,g)||na(s,n,l,h,p,g)||na(l,h,n,e,s,g)||na(h,p,n,e,s,g)||na(p,l,n,e,s,g))}function Yn(n,e,s){const l=e.paint.get(n).value;return l.kind==="constant"?l.value:s.programConfigurations.get(e.id).getMaxValue(n)}function ao(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function oo(n,e,s,l,h){if(!e[0]&&!e[1])return n;const p=mt.convert(e)._mult(h);s==="viewport"&&p._rotate(-l);const g=[];for(let x=0;x<n.length;x++)g.push(n[x].sub(p));return g}function aa(n,e,s,l){const h=mt.convert(n)._mult(l);return e==="viewport"&&h._rotate(-s),h}let Il,Ca;function oa(n,e,s){var l=2*Math.PI*6378137/256/Math.pow(2,s);return[n*l-2*Math.PI*6378137/2,e*l-2*Math.PI*6378137/2]}Dt(Ts,"CircleBucket",{omit:["layers"]});class Ia{constructor(e,s,l){this.z=e,this.x=s,this.y=l,this.key=du(0,e,e,s,l)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}isChildOf(e){const s=this.z-e.z;return e.z===0||e.z<this.z&&e.x===this.x>>s&&e.y===this.y>>s}url(e,s){const l=function(p,g,x){var w=oa(256*p,256*(g=Math.pow(2,x)-g-1),x),T=oa(256*(p+1),256*(g+1),x);return w[0]+","+w[1]+","+T[0]+","+T[1]}(this.x,this.y,this.z),h=function(p,g,x){let w,T="";for(let I=p;I>0;I--)w=1<<I-1,T+=(g&w?1:0)+(x&w?2:0);return T}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",h).replace("{bbox-epsg-3857}",l)}toString(){return`${this.z}/${this.x}/${this.y}`}}class uu{constructor(e,s){this.wrap=e,this.canonical=s,this.key=du(e,s.z,s.z,s.x,s.y)}}class qs{constructor(e,s,l,h,p){this.overscaledZ=e,this.wrap=s,this.canonical=new Ia(l,+h,+p),this.key=s===0&&e===l?this.canonical.key:du(s,e,l,h,p)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const s=this.canonical.z-e;return e>this.canonical.z?new qs(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new qs(e,this.wrap,e,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(e,s=!0){if(this.overscaledZ===e&&s)return this.key;if(e>this.canonical.z)return du(this.wrap*+s,e,this.canonical.z,this.canonical.x,this.canonical.y);{const l=this.canonical.z-e;return du(this.wrap*+s,e,e,this.canonical.x>>l,this.canonical.y>>l)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const s=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>s&&e.canonical.y===this.canonical.y>>s}children(e){if(this.overscaledZ>=e)return[new qs(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const s=this.canonical.z+1,l=2*this.canonical.x,h=2*this.canonical.y;return[new qs(s,this.wrap,s,l,h),new qs(s,this.wrap,s,l+1,h),new qs(s,this.wrap,s,l,h+1),new qs(s,this.wrap,s,l+1,h+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new qs(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new qs(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new uu(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function du(n,e,s,l,h){const p=1<<Math.min(s,22);let g=p*(h%p)+l%p;return n&&s<22&&(g+=p*p*((n<0?-2*n-1:2*n)%(1<<2*(22-s)))),16*(32*g+s)+(e-s)}const N1=[n=>{let e=n.canonical.x-1,s=n.wrap;return e<0&&(e=(1<<n.canonical.z)-1,s--),new qs(n.overscaledZ,s,n.canonical.z,e,n.canonical.y)},n=>{let e=n.canonical.x+1,s=n.wrap;return e===1<<n.canonical.z&&(e=0,s++),new qs(n.overscaledZ,s,n.canonical.z,e,n.canonical.y)},n=>new qs(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,(n.canonical.y===0?1<<n.canonical.z:n.canonical.y)-1),n=>new qs(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y===(1<<n.canonical.z)-1?0:n.canonical.y+1)];Dt(Ia,"CanonicalTileID"),Dt(qs,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const V1=Fi([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:tg}=V1,U1=Fi([{name:"a_pos_3",components:3,type:"Int16"}]);var yx=Fi([{name:"a_pos",type:"Int16",components:2}]);function ig(n){return n*u/W}const j1=[new ri([z,z,z],[D,D,D]),new ri([z,z,z],[0,0,D]),new ri([0,z,z],[D,0,D]),new ri([z,0,z],[0,D,D]),new ri([0,0,z],[D,D,D])];function xx(n,e,s,l=!0){const h=Kt([],n._camera.position,n.worldSize),p=[e,s,1,1];an(p,p,n.pixelMatrixInverse),$s(p,p,1/p[3]);const g=mi([],jr([],p,h)),x=n.globeMatrix,w=[x[12],x[13],x[14]],T=jr([],w,h),I=bt(T),M=mi([],T),R=n.worldSize/(2*Math.PI),B=Ci(M,g),V=Math.asin(R/I);if(V<Math.acos(B)){if(!l)return null;const rt=[],Be=[];Kt(rt,g,I/B),mi(Be,jr(Be,rt,T)),mi(g,Lt(g,T,Kt(g,Be,Math.tan(V)*I)))}const q=[];new Yi(h,g).closestPointOnSphere(w,R,q);const Z=mi([],Wr(x,0)),$=mi([],Wr(x,1)),ne=mi([],Wr(x,2)),ae=Ci(Z,q),le=Ci($,q),be=Ci(ne,q),we=K(Math.asin(-le/R));let ke=K(Math.atan2(ae,be));ke=n.center.lng+function(rt,Be){const st=(Be-rt+180)%360-180;return st<-180?st+360:st}(n.center.lng,ke);const Le=he(ke),ze=Ee(ye(we),0,1);return new $e(Le,ze)}class H1{constructor(e,s,l){this.a=jr([],e,l),this.b=jr([],s,l),this.center=l;const h=mi([],this.a),p=mi([],this.b);this.angle=Math.acos(Ci(h,p))}}function Jm(n,e){if(n.angle===0)return null;let s;return s=n.a[e]===0?1/n.angle*.5*Math.PI:1/n.angle*Math.atan(n.b[e]/n.a[e]/Math.sin(n.angle)-1/Math.tan(n.angle)),s<0||s>1?null:function(l,h,p,g){const x=Math.sin(p);return l*(Math.sin((1-g)*p)/x)+h*(Math.sin(g*p)/x)}(n.a[e],n.b[e],n.angle,Ee(s,0,1))+n.center[e]}function lo(n){if(n.z<=1)return j1[n.z+2*n.y+n.x];const e=Km(rg(n));return ri.fromPoints(e)}function jo(n,e,s){return Kt(n,n,1-s),Hi(n,n,e,s)}function vx(n,e,s){for(const l of n)Wi(l,l,e),Kt(l,l,s)}function bx(n,e,s,l){const h=e/n.worldSize,p=n.globeMatrix;if(s.z<=1){const ze=lo(s).getCorners();return vx(ze,p,h),ri.fromPoints(ze)}const g=rg(s,l),x=Km(g,u+ig(n._tileCoverLift));vx(x,p,h);const w=Number.MAX_VALUE,T=[-w,-w,-w],I=[w,w,w];if(g.contains(n.center)){for(const Be of x)Ti(I,I,Be),vi(T,T,Be);T[2]=0;const ze=n.point,rt=[ze.x*h,ze.y*h,0];return Ti(I,I,rt),vi(T,T,rt),new ri(I,T)}if(n._tileCoverLift>0){for(const ze of x)Ti(I,I,ze),vi(T,T,ze);return new ri(I,T)}const M=[p[12]*h,p[13]*h,p[14]*h],R=g.getCenter(),B=Ee(n.center.lat,-85.051129,Ae),V=Ee(R.lat,-85.051129,Ae),q=he(n.center.lng),Z=ye(B);let $=q-he(R.lng);const ne=Z-ye(V);$>.5?$-=1:$<-.5&&($+=1);let ae=0;Math.abs($)>Math.abs(ne)?ae=$>=0?1:3:(ae=ne>=0?0:2,Hi(M,M,[p[4]*h,p[5]*h,p[6]*h],-Math.sin(Oe(ne>=0?g.getSouth():g.getNorth()))*u));const le=x[ae],be=x[(ae+1)%4],we=new H1(le,be,M),ke=[Jm(we,0)||le[0],Jm(we,1)||le[1],Jm(we,2)||le[2]],Le=kl(n.zoom);if(Le>0){const ze=function({x:Be,y:st,z:ut},nt,ot,gt,tt){const ct=1/(1<<ut);let Xe=Be*ct,He=Xe+ct,_t=st*ct,dt=_t+ct,Yt=0;const zt=(Xe+He)/2-gt;return zt>.5?Yt=-1:zt<-.5&&(Yt=1),Xe=((Xe+Yt)*nt-(gt*=nt))*ot+gt,He=((He+Yt)*nt-gt)*ot+gt,_t=(_t*nt-(tt*=nt))*ot+tt,dt=(dt*nt-tt)*ot+tt,[[Xe,dt,0],[He,dt,0],[He,_t,0],[Xe,_t,0]]}(s,e,n._pixelsPerMercatorPixel,q,Z);for(let Be=0;Be<x.length;Be++)jo(x[Be],ze[Be],Le);const rt=Lt([],ze[ae],ze[(ae+1)%4]);Kt(rt,rt,.5),jo(ke,rt,Le)}for(const ze of x)Ti(I,I,ze),vi(T,T,ze);return I[2]=Math.min(le[2],be[2]),Ti(I,I,ke),vi(T,T,ke),new ri(I,T)}function rg({x:n,y:e,z:s},l=!1){const h=1/(1<<s),p=new Y(xe(n*h),e===(1<<s)-1&&l?-90:_e((e+1)*h)),g=new Y(xe((n+1)*h),e===0&&l?90:_e(e*h));return new te(p,g)}function Km(n,e=u){const s=Oe(n.getNorth()),l=Oe(n.getSouth()),h=Math.cos(s),p=Math.cos(l),g=Math.sin(s),x=Math.sin(l),w=n.getWest(),T=n.getEast();return[U(p,x,w,e),U(p,x,T,e),U(h,g,T,e),U(h,g,w,e)]}function tf(n,e,s,l){const h=1<<s.z,p=(n/At+s.x)/h;return F(_e((e/At+s.y)/h),xe(p),l)}function sg({min:n,max:e}){return b/Math.max(e[0]-n[0],e[1]-n[1],e[2]-n[2])}const wx=new Float64Array(16);function ng(n){const e=sg(n),s=Se(wx,[e,e,e]);return ie(s,s,Xr([],n.min))}function Qm(n){const e=(l=n.min,(s=wx)[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=l[0],s[13]=l[1],s[14]=l[2],s[15]=1,s);var s,l;const h=1/sg(n);return ue(e,e,[h,h,h])}function e_(n){const e=At/(2*Math.PI);return n/(2*Math.PI)/e}function Sx(n,e){return At/(512*Math.pow(2,n))*sg(lo(e))}function Ax(n,e,s,l,h){const p=e_(s),g=[n,e,-s/(2*Math.PI)],x=H(new Float64Array(16));return ie(x,x,g),ue(x,x,[p,p,p]),ve(x,x,Oe(-h)),ce(x,x,Oe(-l)),x}function kl(n){return Ye(m,y,n)}function Tx(n,e){const s=F(e.lat,e.lng),l=function(V){const q=F(V._center.lat,V._center.lng);let Z=zi([],Tt(0,1,0),q);const $=Ie([],-V.angle,q);Z=Wi(Z,Z,$),Ie($,-V._pitch,Z);const ne=mi([],q);return Kt(ne,ne,ig(V.cameraToCenterDistance/V.pixelsPerMeter)),Wi(ne,ne,$),Lt([],q,ne)}(n);return g=(h=qt([],l,s))[0],x=h[1],w=h[2],T=(p=s)[0],I=p[1],M=p[2],B=(R=Math.sqrt((g*g+x*x+w*w)*(T*T+I*I+M*M)))&&Ci(h,p)/R,Math.acos(Math.min(Math.max(B,-1),1));var h,p,g,x,w,T,I,M,R,B}function t_(n,e){return Tx(n,e)>Math.PI/2*1.01}const Ex=Oe(85),W1=Math.cos(Ex),G1=Math.sin(Ex),X1=G(),Cx=n=>{const e=[];return n.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),n.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function Ix(n,e,s,l,h,p,g,x,w){if(p&&n.queryGeometry.isAboveHorizon)return!1;p&&(w*=n.pixelToTileUnitsFactor);const T=n.tileID.canonical,I=s.projection.upVectorScale(T,s.center.lat,s.worldSize).metersToTile;for(const M of e)for(const R of M){const B=R.add(x),V=h&&s.elevation?s.elevation.exaggeration()*h.getElevationAt(B.x,B.y,!0):0,q=s.projection.projectTilePoint(B.x,B.y,T);if(V>0){const ae=s.projection.upVector(T,B.x,B.y);q.x+=ae[0]*I*V,q.y+=ae[1]*I*V,q.z+=ae[2]*I*V}const Z=p?B:Y1(q.x,q.y,q.z,l),$=p?n.tilespaceRays.map(ae=>Z1(ae,V)):n.queryGeometry.screenGeometry,ne=an([],[q.x,q.y,q.z,1],l);if(!g&&p?w*=ne[3]/s.cameraToCenterDistance:g&&!p&&(w*=s.cameraToCenterDistance/ne[3]),p){const ae=_e((R.y/At+T.y)/(1<<T.z));w/=s.projection.pixelsPerMeter(ae,1)/me(1,ae)}if(An($,Z,w))return!0}return!1}function Y1(n,e,s,l){const h=an([],[n,e,s,1],l);return new mt(h[0]/h[3],h[1]/h[3])}const kx=Tt(0,0,0),q1=Tt(0,0,1);function Z1(n,e){const s=qe();return kx[2]=e,n.intersectsPlane(kx,q1,s),new mt(s[0],s[1])}class Mx extends Ts{}let Px,Lx,zx,Rx;function Dx(n,{width:e,height:s},l,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==e*s*l)throw new RangeError("mismatched image size")}else h=new Uint8Array(e*s*l);return n.width=e,n.height=s,n.data=h,n}function Ox(n,e,s){const{width:l,height:h}=e;l===n.width&&h===n.height||(i_(n,e,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,l),height:Math.min(n.height,h)},s,null),n.width=l,n.height=h,n.data=e.data)}function i_(n,e,s,l,h,p,g,x){if(h.width===0||h.height===0)return e;if(h.width>n.width||h.height>n.height||s.x>n.width-h.width||s.y>n.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>e.width||h.height>e.height||l.x>e.width-h.width||l.y>e.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const w=n.data,T=e.data,I=p===4&&x;for(let M=0;M<h.height;M++){const R=((s.y+M)*n.width+s.x)*p,B=((l.y+M)*e.width+l.x)*p;if(I)for(let V=0;V<h.width;V++){const q=R+V*p+3,Z=B+V*p;T[Z+0]=255,T[Z+1]=255,T[Z+2]=255,T[Z+3]=w[q]}else if(g)for(let V=0;V<h.width;V++){const q=R+V*p,Z=B+V*p,$=new er(w[q+0]/255,w[q+1]/255,w[q+2]/255,w[q+3]).toNonPremultipliedRenderColor(g).toArray();T[Z+0]=$[0],T[Z+1]=$[1],T[Z+2]=$[2],T[Z+3]=$[3]}else for(let V=0;V<h.width*p;V++)T[B+V]=w[R+V]}return e}Dt(Mx,"HeatmapBucket",{omit:["layers"]});class Ml{constructor(e,s){Dx(this,e,1,s)}resize(e){Ox(this,new Ml(e),1)}clone(){return new Ml({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,s,l,h,p){i_(e,s,l,h,p,1,null)}}class Rs{constructor(e,s){Dx(this,e,4,s)}resize(e){Ox(this,new Rs(e),4)}replace(e,s){s?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Rs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,s,l,h,p,g,x){i_(e,s,l,h,p,4,g,x)}}class Fx{constructor(e,s){this.width=e.width,this.height=e.height,this.data=s instanceof Uint8Array?new Float32Array(s.buffer):s}}function rf(n){const e={},s=n.resolution||256,l=n.clips?n.clips.length:1,h=n.image||new Rs({width:s,height:l}),p=(g,x,w)=>{e[n.evaluationKey]=w;const T=n.expression.evaluate(e),I=T?T.toNonPremultipliedRenderColor(null):null;I&&(h.data[g+x+0]=Math.floor(255*I.r),h.data[g+x+1]=Math.floor(255*I.g),h.data[g+x+2]=Math.floor(255*I.b),h.data[g+x+3]=Math.floor(255*I.a))};if(n.clips)for(let g=0,x=0;g<l;++g,x+=4*s)for(let w=0,T=0;w<s;w++,T+=4){const I=w/(s-1),{start:M,end:R}=n.clips[g];p(x,T,M*(1-I)+R*I)}else for(let g=0,x=0;g<s;g++,x+=4)p(0,x,g/(s-1));return h}Dt(Ml,"AlphaImage"),Dt(Rs,"RGBAImage");const $1=Fi([{name:"a_pos",components:2,type:"Int16"}],4),J1=Fi([{name:"a_road_z_offset",components:1,type:"Float32"}],4),K1=Fi([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),Q1=Fi([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function fu(n,e,s=2){const l=e&&e.length,h=l?e[0]*s:n.length;let p=Bx(n,0,h,s,!0);const g=[];if(!p||p.next===p.prev)return g;let x,w,T;if(l&&(p=function(I,M,R,B){const V=[];for(let q=0,Z=M.length;q<Z;q++){const $=Bx(I,M[q]*B,q<Z-1?M[q+1]*B:I.length,B,!1);$===$.next&&($.steiner=!0),V.push(oS($))}V.sort(sS);for(let q=0;q<V.length;q++)R=nS(V[q],R);return R}(n,e,p,s)),n.length>80*s){x=n[0],w=n[1];let I=x,M=w;for(let R=s;R<h;R+=s){const B=n[R],V=n[R+1];B<x&&(x=B),V<w&&(w=V),B>I&&(I=B),V>M&&(M=V)}T=Math.max(I-x,M-w),T=T!==0?32767/T:0}return sf(p,g,s,x,w,T,0),g}function Bx(n,e,s,l,h){let p;if(h===function(g,x,w,T){let I=0;for(let M=x,R=w-T;M<w;M+=T)I+=(g[R]-g[M])*(g[M+1]+g[R+1]),R=M;return I}(n,e,s,l)>0)for(let g=e;g<s;g+=l)p=jx(g/l|0,n[g],n[g+1],p);else for(let g=s-l;g>=e;g-=l)p=jx(g/l|0,n[g],n[g+1],p);return p&&pu(p,p.next)&&(of(p),p=p.next),p}function Oc(n,e){if(!n)return n;e||(e=n);let s,l=n;do if(s=!1,l.steiner||!pu(l,l.next)&&Ss(l.prev,l,l.next)!==0)l=l.next;else{if(of(l),l=e=l.prev,l===l.next)break;s=!0}while(s||l!==e);return e}function sf(n,e,s,l,h,p,g){if(!n)return;!g&&p&&function(w,T,I,M){let R=w;do R.z===0&&(R.z=r_(R.x,R.y,T,I,M)),R.prevZ=R.prev,R.nextZ=R.next,R=R.next;while(R!==w);R.prevZ.nextZ=null,R.prevZ=null,function(B){let V,q=1;do{let Z,$=B;B=null;let ne=null;for(V=0;$;){V++;let ae=$,le=0;for(let we=0;we<q&&(le++,ae=ae.nextZ,ae);we++);let be=q;for(;le>0||be>0&&ae;)le!==0&&(be===0||!ae||$.z<=ae.z)?(Z=$,$=$.nextZ,le--):(Z=ae,ae=ae.nextZ,be--),ne?ne.nextZ=Z:B=Z,Z.prevZ=ne,ne=Z;$=ae}ne.nextZ=null,q*=2}while(V>1)}(R)}(n,l,h,p);let x=n;for(;n.prev!==n.next;){const w=n.prev,T=n.next;if(p?tS(n,l,h,p):eS(n))e.push(w.i,n.i,T.i),of(n),n=T.next,x=T.next;else if((n=T)===x){g?g===1?sf(n=iS(Oc(n),e),e,s,l,h,p,2):g===2&&rS(n,e,s,l,h,p):sf(Oc(n),e,s,l,h,p,1);break}}}function eS(n){const e=n.prev,s=n,l=n.next;if(Ss(e,s,l)>=0)return!1;const h=e.x,p=s.x,g=l.x,x=e.y,w=s.y,T=l.y,I=Math.min(h,p,g),M=Math.min(x,w,T),R=Math.max(h,p,g),B=Math.max(x,w,T);let V=l.next;for(;V!==e;){if(V.x>=I&&V.x<=R&&V.y>=M&&V.y<=B&&nf(h,x,p,w,g,T,V.x,V.y)&&Ss(V.prev,V,V.next)>=0)return!1;V=V.next}return!0}function tS(n,e,s,l){const h=n.prev,p=n,g=n.next;if(Ss(h,p,g)>=0)return!1;const x=h.x,w=p.x,T=g.x,I=h.y,M=p.y,R=g.y,B=Math.min(x,w,T),V=Math.min(I,M,R),q=Math.max(x,w,T),Z=Math.max(I,M,R),$=r_(B,V,e,s,l),ne=r_(q,Z,e,s,l);let ae=n.prevZ,le=n.nextZ;for(;ae&&ae.z>=$&&le&&le.z<=ne;){if(ae.x>=B&&ae.x<=q&&ae.y>=V&&ae.y<=Z&&ae!==h&&ae!==g&&nf(x,I,w,M,T,R,ae.x,ae.y)&&Ss(ae.prev,ae,ae.next)>=0||(ae=ae.prevZ,le.x>=B&&le.x<=q&&le.y>=V&&le.y<=Z&&le!==h&&le!==g&&nf(x,I,w,M,T,R,le.x,le.y)&&Ss(le.prev,le,le.next)>=0))return!1;le=le.nextZ}for(;ae&&ae.z>=$;){if(ae.x>=B&&ae.x<=q&&ae.y>=V&&ae.y<=Z&&ae!==h&&ae!==g&&nf(x,I,w,M,T,R,ae.x,ae.y)&&Ss(ae.prev,ae,ae.next)>=0)return!1;ae=ae.prevZ}for(;le&&le.z<=ne;){if(le.x>=B&&le.x<=q&&le.y>=V&&le.y<=Z&&le!==h&&le!==g&&nf(x,I,w,M,T,R,le.x,le.y)&&Ss(le.prev,le,le.next)>=0)return!1;le=le.nextZ}return!0}function iS(n,e){let s=n;do{const l=s.prev,h=s.next.next;!pu(l,h)&&Vx(l,s,s.next,h)&&af(l,h)&&af(h,l)&&(e.push(l.i,s.i,h.i),of(s),of(s.next),s=n=h),s=s.next}while(s!==n);return Oc(s)}function rS(n,e,s,l,h,p){let g=n;do{let x=g.next.next;for(;x!==g.prev;){if(g.i!==x.i&&lS(g,x)){let w=Ux(g,x);return g=Oc(g,g.next),w=Oc(w,w.next),sf(g,e,s,l,h,p,0),void sf(w,e,s,l,h,p,0)}x=x.next}g=g.next}while(g!==n)}function sS(n,e){let s=n.x-e.x;return s===0&&(s=n.y-e.y,s===0)&&(s=(n.next.y-n.y)/(n.next.x-n.x)-(e.next.y-e.y)/(e.next.x-e.x)),s}function nS(n,e){const s=function(h,p){let g=p;const x=h.x,w=h.y;let T,I=-1/0;if(pu(h,g))return g;do{if(pu(h,g.next))return g.next;if(w<=g.y&&w>=g.next.y&&g.next.y!==g.y){const q=g.x+(w-g.y)*(g.next.x-g.x)/(g.next.y-g.y);if(q<=x&&q>I&&(I=q,T=g.x<g.next.x?g:g.next,q===x))return T}g=g.next}while(g!==p);if(!T)return null;const M=T,R=T.x,B=T.y;let V=1/0;g=T;do{if(x>=g.x&&g.x>=R&&x!==g.x&&Nx(w<B?x:I,w,R,B,w<B?I:x,w,g.x,g.y)){const q=Math.abs(w-g.y)/(x-g.x);af(g,h)&&(q<V||q===V&&(g.x>T.x||g.x===T.x&&aS(T,g)))&&(T=g,V=q)}g=g.next}while(g!==M);return T}(n,e);if(!s)return e;const l=Ux(s,n);return Oc(l,l.next),Oc(s,s.next)}function aS(n,e){return Ss(n.prev,n,e.prev)<0&&Ss(e.next,n,n.next)<0}function r_(n,e,s,l,h){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-s)*h|0)|n<<8))|n<<4))|n<<2))|n<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-l)*h|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function oS(n){let e=n,s=n;do(e.x<s.x||e.x===s.x&&e.y<s.y)&&(s=e),e=e.next;while(e!==n);return s}function Nx(n,e,s,l,h,p,g,x){return(h-g)*(e-x)>=(n-g)*(p-x)&&(n-g)*(l-x)>=(s-g)*(e-x)&&(s-g)*(p-x)>=(h-g)*(l-x)}function nf(n,e,s,l,h,p,g,x){return!(n===g&&e===x)&&Nx(n,e,s,l,h,p,g,x)}function lS(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!function(s,l){let h=s;do{if(h.i!==s.i&&h.next.i!==s.i&&h.i!==l.i&&h.next.i!==l.i&&Vx(h,h.next,s,l))return!0;h=h.next}while(h!==s);return!1}(n,e)&&(af(n,e)&&af(e,n)&&function(s,l){let h=s,p=!1;const g=(s.x+l.x)/2,x=(s.y+l.y)/2;do h.y>x!=h.next.y>x&&h.next.y!==h.y&&g<(h.next.x-h.x)*(x-h.y)/(h.next.y-h.y)+h.x&&(p=!p),h=h.next;while(h!==s);return p}(n,e)&&(Ss(n.prev,n,e.prev)||Ss(n,e.prev,e))||pu(n,e)&&Ss(n.prev,n,n.next)>0&&Ss(e.prev,e,e.next)>0)}function Ss(n,e,s){return(e.y-n.y)*(s.x-e.x)-(e.x-n.x)*(s.y-e.y)}function pu(n,e){return n.x===e.x&&n.y===e.y}function Vx(n,e,s,l){const h=og(Ss(n,e,s)),p=og(Ss(n,e,l)),g=og(Ss(s,l,n)),x=og(Ss(s,l,e));return h!==p&&g!==x||!(h!==0||!ag(n,s,e))||!(p!==0||!ag(n,l,e))||!(g!==0||!ag(s,n,l))||!(x!==0||!ag(s,e,l))}function ag(n,e,s){return e.x<=Math.max(n.x,s.x)&&e.x>=Math.min(n.x,s.x)&&e.y<=Math.max(n.y,s.y)&&e.y>=Math.min(n.y,s.y)}function og(n){return n>0?1:n<0?-1:0}function af(n,e){return Ss(n.prev,n,n.next)<0?Ss(n,e,n.next)>=0&&Ss(n,n.prev,e)>=0:Ss(n,e,n.prev)<0||Ss(n,n.next,e)<0}function Ux(n,e){const s=s_(n.i,n.x,n.y),l=s_(e.i,e.x,e.y),h=n.next,p=e.prev;return n.next=e,e.prev=n,s.next=h,h.prev=s,l.next=s,s.prev=l,p.next=l,l.prev=p,l}function jx(n,e,s,l){const h=s_(n,e,s);return l?(h.next=l.next,h.prev=l,l.next.prev=h,l.next=h):(h.prev=h,h.next=h),h}function of(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function s_(n,e,s){return{i:n,x:e,y:s,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function lf(n,e){const s=n.length;if(s<=1)return[n];const l=[];let h,p;for(let g=0;g<s;g++){const x=os(n[g]);x!==0&&(n[g].area=Math.abs(x),p===void 0&&(p=x<0),p===x<0?(h&&l.push(h),h=[n[g]]):h.push(n[g]))}if(h&&l.push(h),e>1)for(let g=0;g<l.length;g++)l[g].length<=e||(cp(l[g],e,1,l[g].length-1,cS),l[g]=l[g].slice(0,e));return l}function cS(n,e){return e.area-n.area}function Hx(n,e,s=1){if(!n)return null;const l=typeof n=="string"?Ks.from(n).getPrimary():n.getPrimary(),h=typeof n=="string"?null:n.getSecondary();for(const p of[l,h]){if(!p)continue;const g=p.id.toString();e.has(g)||e.set(g,[]),p.scaleSelf(s),e.get(g).push(p)}return{primary:l.toString(),secondary:h?h.toString():null}}function n_(n,e,s,l){const h=l.patternDependencies;let p=!1;for(const g of e){const x=g.paint.get(`${n}-pattern`);x.isConstant()||(p=!0),Hx(x.constantOr(null),h,s)&&(p=!0)}return p}function a_(n,e,s,l,h,p){const g=p.patternDependencies;for(const x of e){const w=x.paint.get(`${n}-pattern`).value;if(w.kind!=="constant"){let T=w.evaluate({zoom:l},s,{},p.availableImages);T=T&&T.name?T.name:T;const I=Hx(T,g,h);if(!I)continue;const{primary:M,secondary:R}=I;M&&(s.patterns[x.id]=[M,R].filter(Boolean))}}return s}class Wx{constructor(){this.polygons=new Map}add(e,...s){const l=this.polygons.get(e);l?l.push(...s):this.polygons.set(e,s)}merge(e){for(const[s,l]of e.polygons)this.add(s,...l)}}class Ho{constructor(){this.portals=[]}static isOnBorder(e,s){return e<=0&&s<=0||e>=At&&s>=At}static evaluate(e){if(e.length===0)return new Ho;let s=[];for(const w of e)s.push(...w.portals);if(s.length===0)return new Ho;for(const w of s){const T=w.va,I=w.vb;(Ho.isOnBorder(T.x,I.x)||Ho.isOnBorder(T.y,I.y))&&(w.type="border")}const l=s.filter(w=>w.type!=="unevaluated"),h=s.filter(w=>w.type==="unevaluated");if(h.length===0)return new Ho;h.sort((w,T)=>w.hash===T.hash?w.isTunnel===T.isTunnel?0:w.isTunnel?-1:1:w.hash<T.hash?1:-1),s=l.concat(h);let p=l.length,g=p,x=p;do if(g++,g===s.length||s[p].hash!==s[g].hash){if(g-p==2){x<p&&(s[x]=s[p],s[p]=null);const w=s[x],T=s[g-1];w.type=w.isTunnel!==T.isTunnel?"tunnel":"polygon",w.connection={a:w.connection.a,b:T.connection.a},x++}p=g}while(p!==s.length);return s.splice(x),s.sort((w,T)=>w.hash<T.hash?1:-1),{portals:s}}}Dt(Ho,"ElevationPortalGraph"),Dt(Wx,"ElevationPolygons");class hS{constructor(e,s,l){this.outPositions=e,this.outNormals=s,this.outIndices=l,this.vertexLookup=new Map}addVertex(e,s,l){let h=e[2];l!=null&&(h*=l);const p=`${e[0]},${e[1]},${e[2]},${s[0]},${s[1]},${s[2]}`,g=this.vertexLookup.get(p);if(g!=null)return g;const x=this.outPositions.length;this.vertexLookup.set(p,x);const w=Math.trunc(16384*s[0]),T=Math.trunc(16384*s[1]),I=Math.trunc(16384*s[2]);return this.outPositions.emplaceBack(e[0],e[1],h),this.outNormals.emplaceBack(w,T,I),x}addTriangle(e,s,l){this.outIndices.emplaceBack(e,s,l)}addTriangles(e,s,l){if(e.length===0)return;const h=l.length===1,p=qe(),g=qe();for(let x=0;x<e.length;x+=3){const w=s[e[x+0]],T=s[e[x+1]],I=s[e[x+2]],M=h?l[0]:l[e[x+1]],R=h?l[0]:l[e[x+2]];Et(p,w.x,w.y,h?l[0]:l[e[x+0]]);const B=this.addVertex(p,g);Et(p,T.x,T.y,M);const V=this.addVertex(p,g);Et(p,I.x,I.y,R);const q=this.addVertex(p,g);this.outIndices.emplaceBack(B,V,q)}}addQuad(e,s,l,h,p,g){const x=this.addVertex(e,p,g),w=this.addVertex(s,p,g),T=this.addVertex(l,p,g),I=this.addVertex(h,p,g);this.addTriangle(x,w,T),this.addTriangle(T,I,x)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class Tn{constructor(e,s,l,h){this.unevaluatedPortals=new Ho,this.portalPolygons=new Wx,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new jd,this.vertexNormals=new eu,this.indexArray=new gs,this.tileToMeters=Ne(e),this.bridgeProgramConfigurations=new Gn(s,{zoom:l,lut:h},p=>p!=="fill-tunnel-structure-color"),this.tunnelProgramConfigurations=new Gn(s,{zoom:l,lut:h},p=>p!=="fill-bridge-guard-rail-color")}addVertices(e,s){const l=this.unevalVertices.length;for(let h=0;h<e.length;h++)this.unevalVertices.push(e[h]),this.unevalHeights.push(s[h]);return l}addTriangles(e,s,l){const h=l?this.unevalTunnelTriangles:this.unevalTriangles;for(const p of e)h.push(p+s)}addRenderableRing(e,s,l,h,p,g){const x=[new mt(p.min.x,p.min.y),new mt(p.max.x,p.min.y),new mt(p.max.x,p.max.y),new mt(p.min.x,p.max.y)];for(let w=0;w<l-1;w++){const T=s+w,I=T+1,M=this.unevalVertices[T],R=this.unevalVertices[I];if(!(M.x>=p.min.x&&M.x<=p.max.x&&M.y>=p.min.y&&M.y<=p.max.y||R.x>=p.min.x&&R.x<=p.max.x&&R.y>=p.min.y&&R.y<=p.max.y||zs(M,R,x))||this.isOnBorder(M.x,R.x)||this.isOnBorder(M.y,R.y))continue;const B=Tn.computeEdgeHash(this.unevalVertices[T],this.unevalVertices[I]);let V,q=this.vertexHashLookup.get(Tn.computePosHash(M));q!=null?V=q.next:(q=this.vertexHashLookup.get(Tn.computePosHash(R)),V=q!=null?q.prev:B),this.unevalEdges.push({polygonIdx:e,a:T,b:I,hash:B,portalHash:V,isTunnel:h,type:"unevaluated",featureInfo:g})}}addPortalCandidates(e,s,l,h,p){if(s.length===0)return;this.portalPolygons.add(e,{geometry:s,zLevel:p});const g=s[0];this.vertexHashLookup.clear();let x=Tn.computeEdgeHash(g[g.length-2],g[g.length-1]);for(let w=0;w<g.length-1;w++){const T=g[w+0],I=g[w+1],M=Dn(I.x-T.x,I.y-T.y),R=go(M);if(R===0)continue;let B="unevaluated";const V=h.pointElevation(T),q=h.pointElevation(I);Math.abs(V)<.01&&Math.abs(q)<.01?B="entrance":(this.isOnBorder(T.x,I.x)||this.isOnBorder(T.y,I.y))&&(B="border");const Z=Tn.computeEdgeHash(T,I);this.unevaluatedPortals.portals.push({connection:{a:e,b:void 0},va:T,vb:I,vab:M,length:R,hash:Z,isTunnel:l,type:B});const $=Tn.computePosHash(T);this.vertexHashLookup.set($,{prev:x,next:Z}),x=Z}}construct(e){if(this.unevalVertices.length===0)return;const s=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),l=R=>{R.primitiveLength=this.indexArray.length-R.primitiveOffset},h=new hS(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(e.portals,this.unevalEdges);const p=s(),g=s(),x=s(),w=(R,B)=>{R.sort((q,Z)=>q.type===B&&Z.type!==B?-1:q.type!==B&&Z.type===B?1:0);const V=R.findIndex(q=>q.type!==B);return V>=0?V:R.length};let T=0;this.unevalEdges.length>0&&(T=w(this.unevalEdges,"none"),this.constructBridgeStructures(h,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:T},this.tileToMeters)),l(x);const I=s(),M=s();if(this.unevalEdges.length>0){const R=this.unevalEdges.splice(T),B=w(R,"tunnel")+T;this.unevalEdges.push(...R),this.constructTunnelStructures(h,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:T},{min:T,max:B})}l(I),h.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),l(M),h.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),l(g),h.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),l(p),this.maskSegments=zr.simpleSegment(0,M.primitiveOffset,0,M.primitiveLength),this.depthSegments=zr.simpleSegment(0,g.primitiveOffset,0,g.primitiveLength),this.renderableBridgeSegments=zr.simpleSegment(0,x.primitiveOffset,0,x.primitiveLength),this.renderableTunnelSegments=zr.simpleSegment(0,I.primitiveOffset,0,I.primitiveLength),this.shadowCasterSegments=zr.simpleSegment(0,p.primitiveOffset,0,p.primitiveLength)}update(e,s,l,h,p,g,x,w){this.bridgeProgramConfigurations.updatePaintArrays(e,s,p,l,h,g,x,w),this.tunnelProgramConfigurations.updatePaintArrays(e,s,p,l,h,g,x,w)}upload(e){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=e.createVertexBuffer(this.vertexPositions,K1.members),this.vertexBufferNormal=e.createVertexBuffer(this.vertexNormals,Q1.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(e),this.tunnelProgramConfigurations.upload(e))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(e,s,l,h,p){const g=(x,w)=>{for(let T=0;T<w.length-1;T++){const I=w[T].featureIndex,M=w[T+1].vertexStart,R=e.feature(I);x.populatePaintArrays(M,R,I,{},l,s,h,void 0,p)}};g(this.bridgeProgramConfigurations,this.bridgeFeatureSections),g(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(e,s,l,h,p){const g=new Map;for(let x=h;x<p;x++){const w=l[x],T=w.a,I=w.b,M=Tn.computePosHash(e[T]),R=Tn.computePosHash(e[I]);let B=g.get(M);B||(B={},g.set(M,B));let V=g.get(R);V||(V={},g.set(R,V)),s[T]<=0&&s[I]<=0||(B.to=I,V.from=T)}return g}isTerminalVertex(e,s){const l=Tn.computePosHash(this.unevalVertices[e]),h=s.get(l);return!h||!h.from||!h.to}constructBridgeStructures(e,s,l,h,p,g){e.clearVertexLookup();const x=this.computeVertexConnections(s,l,h,p.min,p.max),w=1/g,T=.5*w,I=(ot,gt)=>Et(ot,s[gt].x,s[gt].y,l[gt]*w),M=qe(),R=qe(),B=qe(),V=qe(),q=qe(),Z=(ot,gt)=>{const tt=x.get(Tn.computePosHash(s[gt])),ct=tt.from,Xe=tt.to;if(!ct||!Xe)return;I(M,ct),I(R,gt),I(B,Xe),ws(V),_s(M,R)||(jr(q,R,M),mi(V,q)),_s(B,R)||(jr(q,B,R),Lt(V,V,mi(q,q)));const He=Oa(V);return He>0?Kt(ot,V,1/He):void 0};let $=Number.POSITIVE_INFINITY;this.sortSubarray(h,p.min,p.max,(ot,gt)=>ot.featureInfo.featureIndex-gt.featureInfo.featureIndex);const ne=qe(),ae=qe(),le=qe(),be=qe(),we=qe(),ke=qe(),Le=qe(),ze=qe(),rt=qe(),Be=[qe(),qe(),qe(),qe()],st=[qe(),qe(),qe(),qe()],ut=[{coord:new mt(0,0),height:0},{coord:new mt(0,0),height:0}],nt=(ot,gt)=>ot>gt;for(let ot=p.min;ot<p.max;ot++){const gt=h[ot];if(!gt.featureInfo.guardRailEnabled||!this.prepareEdgePoints(ut,s,l,gt,nt))continue;const[tt,ct]=ut;if(Et(ne,tt.coord.x,tt.coord.y,w*tt.height),Et(ae,ct.coord.x,ct.coord.y,w*ct.height),_s(ne,ae))continue;jr(le,ae,ne),mi(le,le);const Xe=Z(ze,gt.a)||le,He=Z(rt,gt.b)||le;Et(be,Xe[1],-Xe[0],0),mi(be,be),Et(we,He[1],-He[0],0),mi(we,we),zi(ze,be,Xe),mi(ke,ze),zi(ze,we,He),mi(Le,ze),Lt(Be[0],ne,Kt(ze,jr(ze,be,ke),T)),Lt(Be[1],ne,Kt(ze,Lt(ze,be,ke),T)),Lt(Be[2],ne,Kt(ze,ke,T)),Be[3]=ne,Lt(st[0],ae,Kt(ze,jr(ze,we,Le),T)),Lt(st[1],ae,Kt(ze,Lt(ze,we,Le),T)),Lt(st[2],ae,Kt(ze,Le,T)),st[3]=ae,$=this.addFeatureSection(gt.featureInfo.featureIndex,$,this.bridgeFeatureSections,e);const _t=e.addVertex(Be[0],be,g),dt=e.addVertex(Be[1],be,g),Yt=e.addVertex(st[0],we,g),zt=e.addVertex(st[1],we,g);e.addTriangle(_t,dt,Yt),e.addTriangle(dt,zt,Yt);const Bt=e.addVertex(Be[1],ke,g),St=e.addVertex(Be[2],ke,g),Gt=e.addVertex(st[1],Le,g),li=e.addVertex(st[2],Le,g);e.addTriangle(Bt,St,Gt),e.addTriangle(St,li,Gt),Xr(be,be),Xr(we,we);const kt=e.addVertex(Be[2],be,g),jt=e.addVertex(Be[3],be,g),ti=e.addVertex(st[2],we,g),di=e.addVertex(st[3],we,g);e.addTriangle(kt,jt,ti),e.addTriangle(jt,di,ti);const Ii=this.isTerminalVertex(gt.a,x),_i=this.isTerminalVertex(gt.b,x);tt.height<.01&&Ii&&e.addQuad(Be[3],Be[2],Be[1],Be[0],Xr(Xe,Xe),g),ct.height<.01&&_i&&e.addQuad(st[0],st[1],st[2],st[3],He,g)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}constructTunnelStructures(e,s,l,h,p,g){e.clearVertexLookup();let x=Number.POSITIVE_INFINITY;const w=($,ne)=>$.featureInfo.featureIndex-ne.featureInfo.featureIndex;this.sortSubarray(h,p.min,p.max,w),this.sortSubarray(h,g.min,g.max,w);const T=$=>mi($,$),I=[{coord:new mt(0,0),height:0},{coord:new mt(0,0),height:0}],M=($,ne)=>$<ne,R=qe(),B=qe(),V=qe(),q=qe(),Z=qe();for(let $=p.min;$<p.max;$++){if(!this.prepareEdgePoints(I,s,l,h[$],M))continue;const[ne,ae]=I,le=T(Et(Z,-(ae.coord.y-ne.coord.y),ae.coord.x-ne.coord.x,0));x=this.addFeatureSection(h[$].featureInfo.featureIndex,x,this.tunnelFeatureSections,e),e.addQuad(Et(R,ne.coord.x,ne.coord.y,ne.height),Et(B,ae.coord.x,ae.coord.y,ae.height),Et(V,ae.coord.x,ae.coord.y,h[$].isTunnel?-.1:0),Et(q,ne.coord.x,ne.coord.y,h[$].isTunnel?-.1:0),le)}for(let $=g.min;$<g.max;$++){const ne=h[$];ne.isTunnel&&([ne.a,ne.b]=[ne.b,ne.a]);const ae=s[ne.a],le=s[ne.b],be=T(Et(Z,-(le.y-ae.y),le.x-ae.x,0));x=this.addFeatureSection(ne.featureInfo.featureIndex,x,this.tunnelFeatureSections,e),e.addQuad(Et(R,le.x,le.y,0),Et(B,ae.x,ae.y,0),Et(V,ae.x,ae.y,l[ne.a]+4),Et(q,le.x,le.y,l[ne.b]+4),be),e.addQuad(Et(R,ae.x,ae.y,0),Et(B,le.x,le.y,0),Et(V,le.x,le.y,l[ne.b]+4),Et(q,ae.x,ae.y,l[ne.a]+4),be)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}setElevatedPoint(e,s,l,h){e.coord.x=s,e.coord.y=l,e.height=h}prepareEdgePoints(e,s,l,h,p){let g=s[h.a].x,x=s[h.a].y,w=s[h.b].x,T=s[h.b].y,I=l[h.a],M=l[h.b];const R=p(I,0),B=p(M,0);if(R&&B)return this.setElevatedPoint(e[0],g,x,I),this.setElevatedPoint(e[1],w,T,M),!0;if(!R&&!B)return!1;if(R){if(!B){const V=M/(M-I);w=ei(w,g,V),T=ei(T,x,V),M=ei(M,I,V)}}else{const V=I/(I-M);g=ei(g,w,V),x=ei(x,T,V),I=ei(I,M,V)}return this.setElevatedPoint(e[0],g,x,I),this.setElevatedPoint(e[1],w,T,M),!0}prepareEdges(e,s){if(s.length===0)return;s.sort((x,w)=>x.hash===w.hash?w.polygonIdx-x.polygonIdx:w.hash>x.hash?1:-1);let l=0,h=0,p=0,g=s[l].polygonIdx;do h++,(h===s.length||s[l].hash!==s[h].hash)&&((h-l==1||s[h-1].polygonIdx!==g)&&(p<l&&(s[p]=s[l],s[l]=null),s[p].type="none",p++),l=h,l!==s.length&&(g=s[l].polygonIdx));while(l!==s.length);if(s.splice(p),s.length!==0&&e.length!==0){s.sort((T,I)=>T.portalHash<I.portalHash?1:-1);let x=0,w=0;for(;x!==s.length&&w!==e.length;){const T=s[x],I=e[w];T.portalHash>I.hash?x++:I.hash>T.portalHash?w++:(T.type=I.type,x++)}}}isOnBorder(e,s){return e<=0&&s<=0||e>=At&&s>=At}addFeatureSection(e,s,l,h){return e!==s&&(s=e,l.push({featureIndex:e,vertexStart:h.getVertexCount()}),h.clearVertexLookup()),s}sortSubarray(e,s,l,h){const p=e.slice(s,l);p.sort(h),e.splice(s,p.length,...p)}static computeEdgeHash(e,s){return(e.y===s.y&&e.x>s.x||e.y>s.y)&&([e,s]=[s,e]),BigInt(Tn.computePosHash(e))<<32n|BigInt(Tn.computePosHash(s))}static computePosHash(e){return((65535&e.x)<<16|65535&e.y)>>>0}}var Gx,Xx={exports:{}},Yx=(Gx||(Gx=1,function(n,e){(function(s){function l(de,fe){return de>fe?1:de<fe?-1:0}var h=function(de,fe){de===void 0&&(de=l),fe===void 0&&(fe=!1),this._compare=de,this._root=null,this._size=0,this._noDuplicates=!!fe},p={size:{configurable:!0}};function g(de,fe,Ge,it,It){var Ct=It-it;if(Ct>0){var Ot=it+Math.floor(Ct/2),$t={key:fe[Ot],data:Ge[Ot],parent:de};return $t.left=g($t,fe,Ge,it,Ot),$t.right=g($t,fe,Ge,Ot+1,It),$t}return null}function x(de,fe,Ge,it,It){if(!(Ge>=it)){for(var Ct=de[Ge+it>>1],Ot=Ge-1,$t=it+1;;){do Ot++;while(It(de[Ot],Ct)<0);do $t--;while(It(de[$t],Ct)>0);if(Ot>=$t)break;var ki=de[Ot];de[Ot]=de[$t],de[$t]=ki,ki=fe[Ot],fe[Ot]=fe[$t],fe[$t]=ki}x(de,fe,Ge,$t,It),x(de,fe,$t+1,it,It)}}h.prototype.rotateLeft=function(de){var fe=de.right;fe&&(de.right=fe.left,fe.left&&(fe.left.parent=de),fe.parent=de.parent),de.parent?de===de.parent.left?de.parent.left=fe:de.parent.right=fe:this._root=fe,fe&&(fe.left=de),de.parent=fe},h.prototype.rotateRight=function(de){var fe=de.left;fe&&(de.left=fe.right,fe.right&&(fe.right.parent=de),fe.parent=de.parent),de.parent?de===de.parent.left?de.parent.left=fe:de.parent.right=fe:this._root=fe,fe&&(fe.right=de),de.parent=fe},h.prototype._splay=function(de){for(;de.parent;){var fe=de.parent;fe.parent?fe.left===de&&fe.parent.left===fe?(this.rotateRight(fe.parent),this.rotateRight(fe)):fe.right===de&&fe.parent.right===fe?(this.rotateLeft(fe.parent),this.rotateLeft(fe)):fe.left===de&&fe.parent.right===fe?(this.rotateRight(fe),this.rotateLeft(fe)):(this.rotateLeft(fe),this.rotateRight(fe)):fe.left===de?this.rotateRight(fe):this.rotateLeft(fe)}},h.prototype.splay=function(de){for(var fe,Ge,it,It,Ct;de.parent;)(Ge=(fe=de.parent).parent)&&Ge.parent?((it=Ge.parent).left===Ge?it.left=de:it.right=de,de.parent=it):(de.parent=null,this._root=de),It=de.left,Ct=de.right,de===fe.left?(Ge&&(Ge.left===fe?(fe.right?(Ge.left=fe.right,Ge.left.parent=Ge):Ge.left=null,fe.right=Ge,Ge.parent=fe):(It?(Ge.right=It,It.parent=Ge):Ge.right=null,de.left=Ge,Ge.parent=de)),Ct?(fe.left=Ct,Ct.parent=fe):fe.left=null,de.right=fe,fe.parent=de):(Ge&&(Ge.right===fe?(fe.left?(Ge.right=fe.left,Ge.right.parent=Ge):Ge.right=null,fe.left=Ge,Ge.parent=fe):(Ct?(Ge.left=Ct,Ct.parent=Ge):Ge.left=null,de.right=Ge,Ge.parent=de)),It?(fe.right=It,It.parent=fe):fe.right=null,de.left=fe,fe.parent=de)},h.prototype.replace=function(de,fe){de.parent?de===de.parent.left?de.parent.left=fe:de.parent.right=fe:this._root=fe,fe&&(fe.parent=de.parent)},h.prototype.minNode=function(de){if(de===void 0&&(de=this._root),de)for(;de.left;)de=de.left;return de},h.prototype.maxNode=function(de){if(de===void 0&&(de=this._root),de)for(;de.right;)de=de.right;return de},h.prototype.insert=function(de,fe){var Ge=this._root,it=null,It=this._compare;if(this._noDuplicates)for(;Ge;){if(it=Ge,It(Ge.key,de)===0)return;Ge=It(Ge.key,de)<0?Ge.right:Ge.left}else for(;Ge;)it=Ge,Ge=It(Ge.key,de)<0?Ge.right:Ge.left;return Ge={key:de,data:fe,left:null,right:null,parent:it},it?It(it.key,Ge.key)<0?it.right=Ge:it.left=Ge:this._root=Ge,this.splay(Ge),this._size++,Ge},h.prototype.find=function(de){for(var fe=this._root,Ge=this._compare;fe;){var it=Ge(fe.key,de);if(it<0)fe=fe.right;else{if(!(it>0))return fe;fe=fe.left}}return null},h.prototype.contains=function(de){for(var fe=this._root,Ge=this._compare;fe;){var it=Ge(de,fe.key);if(it===0)return!0;fe=it<0?fe.left:fe.right}return!1},h.prototype.remove=function(de){var fe=this.find(de);if(!fe)return!1;if(this.splay(fe),fe.left)if(fe.right){var Ge=this.minNode(fe.right);Ge.parent!==fe&&(this.replace(Ge,Ge.right),Ge.right=fe.right,Ge.right.parent=Ge),this.replace(fe,Ge),Ge.left=fe.left,Ge.left.parent=Ge}else this.replace(fe,fe.left);else this.replace(fe,fe.right);return this._size--,!0},h.prototype.removeNode=function(de){if(!de)return!1;if(this.splay(de),de.left)if(de.right){var fe=this.minNode(de.right);fe.parent!==de&&(this.replace(fe,fe.right),fe.right=de.right,fe.right.parent=fe),this.replace(de,fe),fe.left=de.left,fe.left.parent=fe}else this.replace(de,de.left);else this.replace(de,de.right);return this._size--,!0},h.prototype.erase=function(de){var fe=this.find(de);if(fe){this.splay(fe);var Ge=fe.left,it=fe.right,It=null;Ge&&(Ge.parent=null,It=this.maxNode(Ge),this.splay(It),this._root=It),it&&(Ge?It.right=it:this._root=it,it.parent=It),this._size--}},h.prototype.pop=function(){var de=this._root,fe=null;if(de){for(;de.left;)de=de.left;fe={key:de.key,data:de.data},this.remove(de.key)}return fe},h.prototype.next=function(de){var fe=de;if(fe)if(fe.right)for(fe=fe.right;fe&&fe.left;)fe=fe.left;else for(fe=de.parent;fe&&fe.right===de;)de=fe,fe=fe.parent;return fe},h.prototype.prev=function(de){var fe=de;if(fe)if(fe.left)for(fe=fe.left;fe&&fe.right;)fe=fe.right;else for(fe=de.parent;fe&&fe.left===de;)de=fe,fe=fe.parent;return fe},h.prototype.forEach=function(de){for(var fe=this._root,Ge=[],it=!1,It=0;!it;)fe?(Ge.push(fe),fe=fe.left):Ge.length>0?(de(fe=Ge.pop(),It++),fe=fe.right):it=!0;return this},h.prototype.range=function(de,fe,Ge,it){for(var It=[],Ct=this._compare,Ot=this._root;It.length!==0||Ot;)if(Ot)It.push(Ot),Ot=Ot.left;else{if(Ct((Ot=It.pop()).key,fe)>0)break;if(Ct(Ot.key,de)>=0&&Ge.call(it,Ot))return this;Ot=Ot.right}return this},h.prototype.keys=function(){for(var de=this._root,fe=[],Ge=[],it=!1;!it;)de?(fe.push(de),de=de.left):fe.length>0?(de=fe.pop(),Ge.push(de.key),de=de.right):it=!0;return Ge},h.prototype.values=function(){for(var de=this._root,fe=[],Ge=[],it=!1;!it;)de?(fe.push(de),de=de.left):fe.length>0?(de=fe.pop(),Ge.push(de.data),de=de.right):it=!0;return Ge},h.prototype.at=function(de){for(var fe=this._root,Ge=[],it=!1,It=0;!it;)if(fe)Ge.push(fe),fe=fe.left;else if(Ge.length>0){if(fe=Ge.pop(),It===de)return fe;It++,fe=fe.right}else it=!0;return null},h.prototype.load=function(de,fe,Ge){if(de===void 0&&(de=[]),fe===void 0&&(fe=[]),Ge===void 0&&(Ge=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var it=de.length;return Ge&&x(de,fe,0,it-1,this._compare),this._root=g(null,de,fe,0,it),this._size=it,this},h.prototype.min=function(){var de=this.minNode(this._root);return de?de.key:null},h.prototype.max=function(){var de=this.maxNode(this._root);return de?de.key:null},h.prototype.isEmpty=function(){return this._root===null},p.size.get=function(){return this._size},h.createTree=function(de,fe,Ge,it,It){return new h(Ge,It).load(de,fe,it)},Object.defineProperties(h.prototype,p);var w=0,T=1,I=2,M=3,R=0,B=1,V=2,q=3;function Z(de,fe,Ge){fe===null?(de.inOut=!1,de.otherInOut=!0):(de.isSubject===fe.isSubject?(de.inOut=!fe.inOut,de.otherInOut=fe.otherInOut):(de.inOut=!fe.otherInOut,de.otherInOut=fe.isVertical()?!fe.inOut:fe.inOut),fe&&(de.prevInResult=!$(fe,Ge)||fe.isVertical()?fe.prevInResult:fe));var it=$(de,Ge);de.resultTransition=it?function(It,Ct){var Ot,$t=!It.inOut,ki=!It.otherInOut;switch(Ct){case R:Ot=$t&&ki;break;case B:Ot=$t||ki;break;case q:Ot=$t^ki;break;case V:Ot=It.isSubject?$t&&!ki:ki&&!$t}return Ot?1:-1}(de,Ge):0}function $(de,fe){switch(de.type){case w:switch(fe){case R:return!de.otherInOut;case B:return de.otherInOut;case V:return de.isSubject&&de.otherInOut||!de.isSubject&&!de.otherInOut;case q:return!0}break;case I:return fe===R||fe===B;case M:return fe===V;case T:return!1}return!1}var ne=function(de,fe,Ge,it,It){this.left=fe,this.point=de,this.otherEvent=Ge,this.isSubject=it,this.type=It||w,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},ae={inResult:{configurable:!0}};function le(de,fe){return de[0]===fe[0]&&de[1]===fe[1]}ne.prototype.isBelow=function(de){var fe=this.point,Ge=this.otherEvent.point;return this.left?(fe[0]-de[0])*(Ge[1]-de[1])-(Ge[0]-de[0])*(fe[1]-de[1])>0:(Ge[0]-de[0])*(fe[1]-de[1])-(fe[0]-de[0])*(Ge[1]-de[1])>0},ne.prototype.isAbove=function(de){return!this.isBelow(de)},ne.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},ae.inResult.get=function(){return this.resultTransition!==0},ne.prototype.clone=function(){var de=new ne(this.point,this.left,this.otherEvent,this.isSubject,this.type);return de.contourId=this.contourId,de.resultTransition=this.resultTransition,de.prevInResult=this.prevInResult,de.isExteriorRing=this.isExteriorRing,de.inOut=this.inOut,de.otherInOut=this.otherInOut,de},Object.defineProperties(ne.prototype,ae);var be=11102230246251565e-32,we=134217729,ke=(3+8*be)*be;function Le(de,fe,Ge,it,It){var Ct,Ot,$t,ki,Mi=fe[0],Ei=it[0],sr=0,kr=0;Ei>Mi==Ei>-Mi?(Ct=Mi,Mi=fe[++sr]):(Ct=Ei,Ei=it[++kr]);var Ai=0;if(sr<de&&kr<Ge)for(Ei>Mi==Ei>-Mi?($t=Ct-((Ot=Mi+Ct)-Mi),Mi=fe[++sr]):($t=Ct-((Ot=Ei+Ct)-Ei),Ei=it[++kr]),Ct=Ot,$t!==0&&(It[Ai++]=$t);sr<de&&kr<Ge;)Ei>Mi==Ei>-Mi?($t=Ct-((Ot=Ct+Mi)-(ki=Ot-Ct))+(Mi-ki),Mi=fe[++sr]):($t=Ct-((Ot=Ct+Ei)-(ki=Ot-Ct))+(Ei-ki),Ei=it[++kr]),Ct=Ot,$t!==0&&(It[Ai++]=$t);for(;sr<de;)$t=Ct-((Ot=Ct+Mi)-(ki=Ot-Ct))+(Mi-ki),Mi=fe[++sr],Ct=Ot,$t!==0&&(It[Ai++]=$t);for(;kr<Ge;)$t=Ct-((Ot=Ct+Ei)-(ki=Ot-Ct))+(Ei-ki),Ei=it[++kr],Ct=Ot,$t!==0&&(It[Ai++]=$t);return Ct===0&&Ai!==0||(It[Ai++]=Ct),Ai}function ze(de){return new Float64Array(de)}var rt=33306690738754716e-32,Be=22204460492503146e-32,st=11093356479670487e-47,ut=ze(4),nt=ze(8),ot=ze(12),gt=ze(16),tt=ze(4);function ct(de,fe,Ge){var it=function(It,Ct,Ot,$t,ki,Mi){var Ei=(Ct-Mi)*(Ot-ki),sr=(It-ki)*($t-Mi),kr=Ei-sr;if(Ei===0||sr===0||Ei>0!=sr>0)return kr;var Ai=Math.abs(Ei+sr);return Math.abs(kr)>=rt*Ai?kr:-function(yr,or,qi,vr,br,pr,xr){var lr,Pi,cr,Rr,si,ji,wr,Ur,Er,ds,ur,as,un,Ds,Ls,dn,uo,fs,bs=yr-br,Os=qi-br,Zs=or-pr,Vs=vr-pr;ut[0]=(Ls=(Ur=bs-(wr=(ji=we*bs)-(ji-bs)))*(ds=Vs-(Er=(ji=we*Vs)-(ji-Vs)))-((Ds=bs*Vs)-wr*Er-Ur*Er-wr*ds))-((ur=Ls-(uo=(Ur=Zs-(wr=(ji=we*Zs)-(ji-Zs)))*(ds=Os-(Er=(ji=we*Os)-(ji-Os)))-((dn=Zs*Os)-wr*Er-Ur*Er-wr*ds)))+(si=Ls-ur))+(si-uo),ut[1]=(un=Ds-((as=Ds+ur)-(si=as-Ds))+(ur-si))-((ur=un-dn)+(si=un-ur))+(si-dn),ut[2]=as-((fs=as+ur)-(si=fs-as))+(ur-si),ut[3]=fs;var Ol=function(mC,aw){for(var ow=aw[0],dy=1;dy<4;dy++)ow+=aw[dy];return ow}(0,ut),Bf=Be*xr;if(Ol>=Bf||-Ol>=Bf||(lr=yr-(bs+(si=yr-bs))+(si-br),cr=qi-(Os+(si=qi-Os))+(si-br),Pi=or-(Zs+(si=or-Zs))+(si-pr),Rr=vr-(Vs+(si=vr-Vs))+(si-pr),lr===0&&Pi===0&&cr===0&&Rr===0)||(Bf=st*xr+ke*Math.abs(Ol),(Ol+=bs*Rr+Vs*lr-(Zs*cr+Os*Pi))>=Bf||-Ol>=Bf))return Ol;tt[0]=(Ls=(Ur=lr-(wr=(ji=we*lr)-(ji-lr)))*(ds=Vs-(Er=(ji=we*Vs)-(ji-Vs)))-((Ds=lr*Vs)-wr*Er-Ur*Er-wr*ds))-((ur=Ls-(uo=(Ur=Pi-(wr=(ji=we*Pi)-(ji-Pi)))*(ds=Os-(Er=(ji=we*Os)-(ji-Os)))-((dn=Pi*Os)-wr*Er-Ur*Er-wr*ds)))+(si=Ls-ur))+(si-uo),tt[1]=(un=Ds-((as=Ds+ur)-(si=as-Ds))+(ur-si))-((ur=un-dn)+(si=un-ur))+(si-dn),tt[2]=as-((fs=as+ur)-(si=fs-as))+(ur-si),tt[3]=fs;var g2=Le(4,ut,4,tt,nt);tt[0]=(Ls=(Ur=bs-(wr=(ji=we*bs)-(ji-bs)))*(ds=Rr-(Er=(ji=we*Rr)-(ji-Rr)))-((Ds=bs*Rr)-wr*Er-Ur*Er-wr*ds))-((ur=Ls-(uo=(Ur=Zs-(wr=(ji=we*Zs)-(ji-Zs)))*(ds=cr-(Er=(ji=we*cr)-(ji-cr)))-((dn=Zs*cr)-wr*Er-Ur*Er-wr*ds)))+(si=Ls-ur))+(si-uo),tt[1]=(un=Ds-((as=Ds+ur)-(si=as-Ds))+(ur-si))-((ur=un-dn)+(si=un-ur))+(si-dn),tt[2]=as-((fs=as+ur)-(si=fs-as))+(ur-si),tt[3]=fs;var m2=Le(g2,nt,4,tt,ot);tt[0]=(Ls=(Ur=lr-(wr=(ji=we*lr)-(ji-lr)))*(ds=Rr-(Er=(ji=we*Rr)-(ji-Rr)))-((Ds=lr*Rr)-wr*Er-Ur*Er-wr*ds))-((ur=Ls-(uo=(Ur=Pi-(wr=(ji=we*Pi)-(ji-Pi)))*(ds=cr-(Er=(ji=we*cr)-(ji-cr)))-((dn=Pi*cr)-wr*Er-Ur*Er-wr*ds)))+(si=Ls-ur))+(si-uo),tt[1]=(un=Ds-((as=Ds+ur)-(si=as-Ds))+(ur-si))-((ur=un-dn)+(si=un-ur))+(si-dn),tt[2]=as-((fs=as+ur)-(si=fs-as))+(ur-si),tt[3]=fs;var _2=Le(m2,ot,4,tt,gt);return gt[_2-1]}(It,Ct,Ot,$t,ki,Mi,Ai)}(de[0],de[1],fe[0],fe[1],Ge[0],Ge[1]);return it>0?-1:it<0?1:0}function Xe(de,fe){var Ge=de.point,it=fe.point;return Ge[0]>it[0]?1:Ge[0]<it[0]?-1:Ge[1]!==it[1]?Ge[1]>it[1]?1:-1:function(It,Ct,Ot,$t){return It.left!==Ct.left?It.left?1:-1:ct(Ot,It.otherEvent.point,Ct.otherEvent.point)!==0?It.isBelow(Ct.otherEvent.point)?-1:1:!It.isSubject&&Ct.isSubject?1:-1}(de,fe,Ge)}function He(de,fe,Ge){var it=new ne(fe,!1,de,de.isSubject),It=new ne(fe,!0,de.otherEvent,de.isSubject);return le(de.point,de.otherEvent.point)&&console.warn("what is that, a collapsed segment?",de),it.contourId=It.contourId=de.contourId,Xe(It,de.otherEvent)>0&&(de.otherEvent.left=!0,It.left=!1),de.otherEvent.otherEvent=It,de.otherEvent=it,Ge.push(It),Ge.push(it),Ge}function _t(de,fe){return de[0]*fe[1]-de[1]*fe[0]}function dt(de,fe){return de[0]*fe[0]+de[1]*fe[1]}function Yt(de,fe,Ge){var it=function(ki,Mi,Ei,sr,kr){var Ai=[Mi[0]-ki[0],Mi[1]-ki[1]],yr=[sr[0]-Ei[0],sr[1]-Ei[1]];function or(ji,wr,Ur){return[ji[0]+wr*Ur[0],ji[1]+wr*Ur[1]]}var qi=[Ei[0]-ki[0],Ei[1]-ki[1]],vr=_t(Ai,yr),br=vr*vr,pr=dt(Ai,Ai);if(br>0){var xr=_t(qi,yr)/vr;if(xr<0||xr>1)return null;var lr=_t(qi,Ai)/vr;return lr<0||lr>1?null:xr===0||xr===1?[or(ki,xr,Ai)]:lr===0||lr===1?[or(Ei,lr,yr)]:[or(ki,xr,Ai)]}if((br=(vr=_t(qi,Ai))*vr)>0)return null;var Pi=dt(Ai,qi)/pr,cr=Pi+dt(Ai,yr)/pr,Rr=Math.min(Pi,cr),si=Math.max(Pi,cr);return Rr<=1&&si>=0?Rr===1?[or(ki,Rr>0?Rr:0,Ai)]:si===0?[or(ki,si<1?si:1,Ai)]:[or(ki,Rr>0?Rr:0,Ai),or(ki,si<1?si:1,Ai)]:null}(de.point,de.otherEvent.point,fe.point,fe.otherEvent.point),It=it?it.length:0;if(It===0||It===1&&(le(de.point,fe.point)||le(de.otherEvent.point,fe.otherEvent.point))||It===2&&de.isSubject===fe.isSubject)return 0;if(It===1)return le(de.point,it[0])||le(de.otherEvent.point,it[0])||He(de,it[0],Ge),le(fe.point,it[0])||le(fe.otherEvent.point,it[0])||He(fe,it[0],Ge),1;var Ct=[],Ot=!1,$t=!1;return le(de.point,fe.point)?Ot=!0:Xe(de,fe)===1?Ct.push(fe,de):Ct.push(de,fe),le(de.otherEvent.point,fe.otherEvent.point)?$t=!0:Xe(de.otherEvent,fe.otherEvent)===1?Ct.push(fe.otherEvent,de.otherEvent):Ct.push(de.otherEvent,fe.otherEvent),Ot&&$t||Ot?(fe.type=T,de.type=fe.inOut===de.inOut?I:M,Ot&&!$t&&He(Ct[1].otherEvent,Ct[0].point,Ge),2):$t?(He(Ct[0],Ct[1].point,Ge),3):Ct[0]!==Ct[3].otherEvent?(He(Ct[0],Ct[1].point,Ge),He(Ct[1],Ct[2].point,Ge),3):(He(Ct[0],Ct[1].point,Ge),He(Ct[3].otherEvent,Ct[2].point,Ge),3)}function zt(de,fe){if(de===fe)return 0;if(ct(de.point,de.otherEvent.point,fe.point)!==0||ct(de.point,de.otherEvent.point,fe.otherEvent.point)!==0)return le(de.point,fe.point)?de.isBelow(fe.otherEvent.point)?-1:1:de.point[0]===fe.point[0]?de.point[1]<fe.point[1]?-1:1:Xe(de,fe)===1?fe.isAbove(de.point)?-1:1:de.isBelow(fe.point)?-1:1;if(de.isSubject!==fe.isSubject)return de.isSubject?-1:1;var Ge=de.point,it=fe.point;return Ge[0]===it[0]&&Ge[1]===it[1]?(Ge=de.otherEvent.point)[0]===(it=fe.otherEvent.point)[0]&&Ge[1]===it[1]?0:de.contourId>fe.contourId?1:-1:Xe(de,fe)===1?1:-1}var Bt=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function St(de,fe,Ge,it){var It,Ct=de+1,Ot=fe[de].point,$t=fe.length;for(Ct<$t&&(It=fe[Ct].point);Ct<$t&&It[0]===Ot[0]&&It[1]===Ot[1];){if(!Ge[Ct])return Ct;++Ct<$t&&(It=fe[Ct].point)}for(Ct=de-1;Ge[Ct]&&Ct>it;)Ct--;return Ct}Bt.prototype.isExterior=function(){return this.holeOf==null};var Gt=kt,li=kt;function kt(de,fe){if(!(this instanceof kt))return new kt(de,fe);if(this.data=de||[],this.length=this.data.length,this.compare=fe||jt,this.length>0)for(var Ge=(this.length>>1)-1;Ge>=0;Ge--)this._down(Ge)}function jt(de,fe){return de<fe?-1:de>fe?1:0}kt.prototype={push:function(de){this.data.push(de),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var de=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),de}},peek:function(){return this.data[0]},_up:function(de){for(var fe=this.data,Ge=this.compare,it=fe[de];de>0;){var It=de-1>>1,Ct=fe[It];if(Ge(it,Ct)>=0)break;fe[de]=Ct,de=It}fe[de]=it},_down:function(de){for(var fe=this.data,Ge=this.compare,it=this.length>>1,It=fe[de];de<it;){var Ct=1+(de<<1),Ot=Ct+1,$t=fe[Ct];if(Ot<this.length&&Ge(fe[Ot],$t)<0&&(Ct=Ot,$t=fe[Ot]),Ge($t,It)>=0)break;fe[de]=$t,de=Ct}fe[de]=It}},Gt.default=li;var ti=Math.max,di=Math.min,Ii=0;function _i(de,fe,Ge,it,It,Ct){var Ot,$t,ki,Mi,Ei,sr;for(Ot=0,$t=de.length-1;Ot<$t;Ot++)if(Mi=de[Ot+1],Ei=new ne(ki=de[Ot],!1,void 0,fe),sr=new ne(Mi,!1,Ei,fe),Ei.otherEvent=sr,ki[0]!==Mi[0]||ki[1]!==Mi[1]){Ei.contourId=sr.contourId=Ge,Ct||(Ei.isExteriorRing=!1,sr.isExteriorRing=!1),Xe(Ei,sr)>0?sr.left=!0:Ei.left=!0;var kr=ki[0],Ai=ki[1];It[0]=di(It[0],kr),It[1]=di(It[1],Ai),It[2]=ti(It[2],kr),It[3]=ti(It[3],Ai),it.push(Ei),it.push(sr)}}var Ft=[];function fi(de,fe,Ge){typeof de[0][0][0]=="number"&&(de=[de]),typeof fe[0][0][0]=="number"&&(fe=[fe]);var it=function(Ai,yr,or){var qi=null;return Ai.length*yr.length==0&&(or===R?qi=Ft:or===V?qi=Ai:or!==B&&or!==q||(qi=Ai.length===0?yr:Ai)),qi}(de,fe,Ge);if(it)return it===Ft?null:it;var It=[1/0,1/0,-1/0,-1/0],Ct=[1/0,1/0,-1/0,-1/0],Ot=function(Ai,yr,or,qi,vr){var br,pr,xr,lr,Pi,cr,Rr=new Gt(null,Xe);for(xr=0,lr=Ai.length;xr<lr;xr++)for(Pi=0,cr=(br=Ai[xr]).length;Pi<cr;Pi++)(pr=Pi===0)&&Ii++,_i(br[Pi],!0,Ii,Rr,or,pr);for(xr=0,lr=yr.length;xr<lr;xr++)for(Pi=0,cr=(br=yr[xr]).length;Pi<cr;Pi++)pr=Pi===0,vr===V&&(pr=!1),pr&&Ii++,_i(br[Pi],!1,Ii,Rr,qi,pr);return Rr}(de,fe,It,Ct,Ge);if(it=function(Ai,yr,or,qi,vr){var br=null;return(or[0]>qi[2]||qi[0]>or[2]||or[1]>qi[3]||qi[1]>or[3])&&(vr===R?br=Ft:vr===V?br=Ai:vr!==B&&vr!==q||(br=Ai.concat(yr))),br}(de,fe,It,Ct,Ge))return it===Ft?null:it;for(var $t=function(Ai){var yr,or,qi=function(xr){var lr,Pi,cr,Rr,si=[];for(Pi=0,cr=xr.length;Pi<cr;Pi++)((lr=xr[Pi]).left&&lr.inResult||!lr.left&&lr.otherEvent.inResult)&&si.push(lr);for(var ji=!1;!ji;)for(ji=!0,Pi=0,cr=si.length;Pi<cr;Pi++)Pi+1<cr&&Xe(si[Pi],si[Pi+1])===1&&(Rr=si[Pi],si[Pi]=si[Pi+1],si[Pi+1]=Rr,ji=!1);for(Pi=0,cr=si.length;Pi<cr;Pi++)(lr=si[Pi]).otherPos=Pi;for(Pi=0,cr=si.length;Pi<cr;Pi++)(lr=si[Pi]).left||(Rr=lr.otherPos,lr.otherPos=lr.otherEvent.otherPos,lr.otherEvent.otherPos=Rr);return si}(Ai),vr={},br=[],pr=function(){if(!vr[yr]){var xr=br.length,lr=function(si,ji,wr){var Ur=new Bt;if(si.prevInResult!=null){var Er=si.prevInResult,ds=Er.outputContourId;if(Er.resultTransition>0){var ur=ji[ds];if(ur.holeOf!=null){var as=ur.holeOf;ji[as].holeIds.push(wr),Ur.holeOf=as,Ur.depth=ji[ds].depth}else ji[ds].holeIds.push(wr),Ur.holeOf=ds,Ur.depth=ji[ds].depth+1}else Ur.holeOf=null,Ur.depth=ji[ds].depth}else Ur.holeOf=null,Ur.depth=0;return Ur}(qi[yr],br,xr),Pi=function(si){vr[si]=!0,si<qi.length&&qi[si]&&(qi[si].outputContourId=xr)},cr=yr,Rr=yr;for(lr.points.push(qi[yr].point);Pi(cr),Pi(cr=qi[cr].otherPos),lr.points.push(qi[cr].point),!((cr=St(cr,qi,vr,Rr))==Rr||cr>=qi.length)&&qi[cr];);br.push(lr)}};for(yr=0,or=qi.length;yr<or;yr++)pr();return br}(function(Ai,yr,or,qi,vr,br){for(var pr,xr,lr,Pi=new h(zt),cr=[],Rr=Math.min(qi[2],vr[2]);Ai.length!==0;){var si=Ai.pop();if(cr.push(si),br===R&&si.point[0]>Rr||br===V&&si.point[0]>qi[2])break;if(si.left){xr=pr=Pi.insert(si),pr=pr!==(lr=Pi.minNode())?Pi.prev(pr):null,xr=Pi.next(xr);var ji=pr?pr.key:null;if(Z(si,ji,br),xr&&Yt(si,xr.key,Ai)===2&&(Z(si,ji,br),Z(xr.key,si,br)),pr&&Yt(pr.key,si,Ai)===2){var wr=pr;Z(ji,(wr=wr!==lr?Pi.prev(wr):null)?wr.key:null,br),Z(si,ji,br)}}else xr=pr=Pi.find(si=si.otherEvent),pr&&xr&&(pr=pr!==lr?Pi.prev(pr):null,xr=Pi.next(xr),Pi.remove(si),xr&&pr&&Yt(pr.key,xr.key,Ai))}return cr}(Ot,0,0,It,Ct,Ge)),ki=[],Mi=0;Mi<$t.length;Mi++){var Ei=$t[Mi];if(Ei.isExterior()){for(var sr=[Ei.points],kr=0;kr<Ei.holeIds.length;kr++)sr.push($t[Ei.holeIds[kr]].points);ki.push(sr)}}return ki}var Vi={UNION:B,DIFFERENCE:V,INTERSECTION:R,XOR:q};s.diff=function(de,fe){return fi(de,fe,V)},s.intersection=function(de,fe){return fi(de,fe,R)},s.operations=Vi,s.union=function(de,fe){return fi(de,fe,B)},s.xor=function(de,fe){return fi(de,fe,q)},Object.defineProperty(s,"__esModule",{value:!0})})(e)}(0,Xx.exports)),Xx.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function lg(n,e,s,l){const h=[],p=l===0?(g,x,w,T,I,M)=>{g.push(new mt(M,w+(M-x)/(T-x)*(I-w)))}:(g,x,w,T,I,M)=>{g.push(new mt(x+(M-w)/(I-w)*(T-x),M))};for(const g of n){const x=[];for(const w of g){if(w.length<=2)continue;const T=[];for(let R=0;R<w.length-1;R++){const B=w[R].x,V=w[R].y,q=w[R+1].x,Z=w[R+1].y,$=l===0?B:V,ne=l===0?q:Z;$<e?ne>e&&p(T,B,V,q,Z,e):$>s?ne<s&&p(T,B,V,q,Z,s):T.push(w[R]),ne<e&&$>=e&&p(T,B,V,q,Z,e),ne>s&&$<=s&&p(T,B,V,q,Z,s)}let I=w[w.length-1];const M=l===0?I.x:I.y;M>=e&&M<=s&&T.push(I),T.length&&(I=T[T.length-1],T[0].x===I.x&&T[0].y===I.y||T.push(T[0]),x.push(T))}x.length&&h.push(x)}return h}function uS(n,e){const s=o_(n),l=o_([e]),h=Yx.intersection(s,l);return h==null?[]:qx(h)}function dS(n,e){let l=o_(n,65536);const h=[];for(;e.valid();e.next()){const[p,g]=e.get(),x=p.x*65536,w=p.y*65536,T=g.x*65536,I=g.y*65536,M=T-x,R=I-w,B=Math.hypot(M,R);if(B===0)continue;const V=Math.trunc(R/B*3),q=-Math.trunc(M/B*3);h.push([[[x,w],[T,I],[T+V,I+q],[x+V,w+q],[x,w]]])}return h.length>0&&(l=Yx.diff(l,h)),qx(l,1/65536)}function o_(n,e=1){return[n.map(s=>s.map(l=>[l.x*e,l.y*e]))]}function qx(n,e=1){return n.map(s=>s.map((l,h)=>{const p=l.map(g=>new mt(g[0]*e,g[1]*e).round());return h>0&&p.reverse(),p}))}class l_{constructor(e,s){this.layoutVertexArray=new io,this.indexArray=new gs,this.lineIndexArray=new hs,this.triangleSegments=new zr,this.lineSegments=new zr,this.programConfigurations=new Gn(e.layers,{zoom:e.zoom,lut:e.lut}),this.uploaded=!1,s&&(this.elevatedLayoutVertexArray=new ro)}update(e,s,l,h,p,g,x,w){this.programConfigurations.updatePaintArrays(e,s,p,l,h,g,x,w)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,$1.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.lineIndexBuffer=e.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,J1.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(e,s,l,h,p,g,x){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,l,h,p,g,void 0,x)}}class c_{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=e.lut,this.bufferData=new l_(e,!1),this.elevationBufferData=new l_(e,!0),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.projection=e.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=e.sourceLayerIndex,this.worldview=e.worldview}updateFootprints(e,s){}populate(e,s,l,h){this.hasPattern=n_("fill",this.layers,this.pixelRatio,s);const p=this.layers[0].layout.get("fill-sort-key"),g=[];for(const{feature:x,id:w,index:T,sourceLayerIndex:I}of e){const M=this.layers[0]._featureFilter.needGeometry,R=pt(x,M);if(!this.layers[0]._featureFilter.filter(new _r(this.zoom,{worldview:this.worldview}),R,l))continue;const B=p?p.evaluate(R,{},l,s.availableImages):void 0,V={id:w,properties:x.properties,type:x.type,sourceLayerIndex:I,index:T,geometry:M?R.geometry:Pt(x,l,h),patterns:{},sortKey:B};g.push(V)}p&&g.sort((x,w)=>x.sortKey-w.sortKey);for(const x of g){const{geometry:w,index:T,sourceLayerIndex:I}=x;if(this.hasPattern){const M=a_("fill",this.layers,x,this.zoom,this.pixelRatio,s);this.patternFeatures.push(M)}else this.addFeature(x,w,T,l,{},s.availableImages,s.brightness,s.elevationFeatures);s.featureIndex.insert(e[T].feature,w,T,I,this.index)}}update(e,s,l,h,p,g,x){this.bufferData.update(e,s,l,h,p,g,x,this.worldview),this.elevationBufferData.update(e,s,l,h,p,g,x,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(e,s,l,h,p,g,x,this.worldview)}addFeatures(e,s,l,h,p,g){for(const x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,s,l,h,g,e.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(e){this.bufferData.upload(e),this.elevationBufferData.upload(e),this.elevatedStructures&&this.elevatedStructures.upload(e)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(e,s,l,h,p,g=[],x,w){const T=lf(s,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(e,T,h,l,w):this.addGeometry(T,this.bufferData),this.bufferData.populatePaintArrays(e,l,p,g,h,x,this.worldview),this.elevationBufferData.populatePaintArrays(e,l,p,g,h,x,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(e,s,l,h,p){this.elevatedStructures&&(this.elevatedStructures.construct(e),this.elevatedStructures.populatePaintArrays(s,l,h,p,this.worldview))}addElevatedRoadFeature(e,s,l,h,p){const g=new Array,x=Mr.getElevationFeature(e,p);if(!x)return void this.addGeometry(s,this.bufferData);{const T=this.clipPolygonsToTile(s,1);T.length>0&&g.push({polygons:T,elevationFeature:x,elevationTileID:l})}const w={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(e,{},l),featureIndex:h};for(const T of g)if(T.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new Tn(T.elevationTileID,this.layers,this.zoom,this.lut));const M=T.elevationFeature.isTunnel();let R=0;e.properties.hasOwnProperty(ir)&&(R=+e.properties[ir]);for(const B of T.polygons)this.elevatedStructures.addPortalCandidates(T.elevationFeature.id,B,M,T.elevationFeature,R)}T.elevationFeature.constantHeight==null&&(T.polygons=this.prepareElevatedPolygons(T.polygons,T.elevationFeature,T.elevationTileID));const I=new is(l,T.elevationTileID);this.addElevatedGeometry(T.polygons,I,T.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,h,w)}}addElevatedGeometry(e,s,l,h,p,g){const x={elevation:l,elevationSampler:s,bias:h,index:p,featureInfo:g},[w,T]=this.addGeometry(e,this.elevationBufferData,x);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:w,max:T}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,w),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,T))}addGeometry(e,s,l){let h=Number.POSITIVE_INFINITY,p=Number.NEGATIVE_INFINITY,g=null;l&&(g=l.elevationSampler.constantElevation(l.elevation,l.bias),g!=null&&(h=g,p=g));const x=(w,T,I)=>{if(l!=null)if(T.push(w),g!=null)s.elevatedLayoutVertexArray.emplaceBack(g),I.push(g);else{const M=l.elevationSampler.pointElevation(w,l.elevation,l.bias);s.elevatedLayoutVertexArray.emplaceBack(M),I.push(M),h=Math.min(h,M),p=Math.max(p,M)}};for(const w of e){let T=0;for(const ae of w)T+=ae.length;const I=s.triangleSegments.prepareSegment(T,s.layoutVertexArray,s.indexArray),M=I.vertexLength,R=[],B=[],V=[],q=[],Z=[],$=s.layoutVertexArray.length;for(const ae of w){if(ae.length===0)continue;ae!==w[0]&&B.push(R.length/2);const le=s.lineSegments.prepareSegment(ae.length,s.layoutVertexArray,s.lineIndexArray),be=le.vertexLength;l&&Z.push(s.layoutVertexArray.length-$),x(ae[0],V,q),s.layoutVertexArray.emplaceBack(ae[0].x,ae[0].y),s.lineIndexArray.emplaceBack(be+ae.length-1,be),R.push(ae[0].x),R.push(ae[0].y);for(let we=1;we<ae.length;we++)x(ae[we],V,q),s.layoutVertexArray.emplaceBack(ae[we].x,ae[we].y),s.lineIndexArray.emplaceBack(be+we-1,be+we),R.push(ae[we].x),R.push(ae[we].y);le.vertexLength+=ae.length,le.primitiveLength+=ae.length}const ne=fu(R,B);for(let ae=0;ae<ne.length;ae+=3)s.indexArray.emplaceBack(M+ne[ae],M+ne[ae+1],M+ne[ae+2]);if(ne.length>0&&l&&this.elevationMode==="hd-road-base"){const ae=l.elevation.isTunnel(),le=l.elevation.safeArea,be=this.elevatedStructures.addVertices(V,q);this.elevatedStructures.addTriangles(ne,be,ae);const we=Z.length;if(we>0){for(let ke=0;ke<we-1;ke++)this.elevatedStructures.addRenderableRing(l.index,Z[ke]+be,Z[ke+1]-Z[ke],ae,le,l.featureInfo);this.elevatedStructures.addRenderableRing(l.index,Z[we-1]+be,V.length-Z[we-1],ae,le,l.featureInfo)}}I.vertexLength+=T,I.primitiveLength+=ne.length/3}return[h,p]}prepareElevatedPolygons(e,s,l){const h=1/Ne(l),p=[];for(const g of e){const x=dS(g,new rr(s,h));p.push(...x)}return p}clipPolygonsToTile(e,s){const l=-s,h=-s,p=At+s,g=At+s;let x=0;const w=[],T=[];for(;x<e.length;x++){const R=e[x],B=_h(R);(B.min.x>=l&&B.max.x<=p&&B.min.y>=h&&B.max.y<=g?w:T).push(R)}if(w.length===e.length)return e;const I=[new mt(l,h),new mt(p,h),new mt(p,g),new mt(l,g),new mt(l,h)],M=w;for(const R of T)M.push(...uS(R,I));return M}}let Zx,$x,Jx,Kx;Dt(c_,"FillBucket",{omit:["layers","patternFeatures"]}),Dt(l_,"FillBufferData"),Dt(Tn,"ElevatedStructures");class cg{constructor(e,s,l,h){if(this.triangleCount=s.length/3,this.min=new mt(0,0),this.max=new mt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[p,g]=[e[0].clone(),e[0].clone()];for(let M=1;M<e.length;++M){const R=e[M];p.x=Math.min(p.x,R.x),p.y=Math.min(p.y,R.y),g.x=Math.max(g.x,R.x),g.y=Math.max(g.y,R.y)}if(h){const M=Math.ceil(Math.max(g.x-p.x,g.y-p.y)/h);l=Math.max(l,M)}if(l===0)return;this.min=p,this.max=g;const x=this.max.sub(this.min);x.x=Math.max(x.x,1),x.y=Math.max(x.y,1);const w=Math.max(x.x,x.y)/l;this.cellsX=Math.max(1,Math.ceil(x.x/w)),this.cellsY=Math.max(1,Math.ceil(x.y/w)),this.xScale=1/w,this.yScale=1/w;const T=[];for(let M=0;M<this.triangleCount;M++){const R=e[s[3*M+0]].sub(this.min),B=e[s[3*M+1]].sub(this.min),V=e[s[3*M+2]].sub(this.min),q=co(Math.floor(Math.min(R.x,B.x,V.x)),this.xScale,this.cellsX),Z=co(Math.floor(Math.max(R.x,B.x,V.x)),this.xScale,this.cellsX),$=co(Math.floor(Math.min(R.y,B.y,V.y)),this.yScale,this.cellsY),ne=co(Math.floor(Math.max(R.y,B.y,V.y)),this.yScale,this.cellsY),ae=new mt(0,0),le=new mt(0,0),be=new mt(0,0),we=new mt(0,0);for(let ke=$;ke<=ne;++ke){ae.y=le.y=ke*w,be.y=we.y=(ke+1)*w;for(let Le=q;Le<=Z;++Le)ae.x=be.x=Le*w,le.x=we.x=(Le+1)*w,(Ea(R,B,V,ae,le,we)||Ea(R,B,V,ae,we,be))&&T.push({cellIdx:ke*this.cellsX+Le,triIdx:M})}}if(T.length===0)return;T.sort((M,R)=>M.cellIdx-R.cellIdx||M.triIdx-R.triIdx);let I=0;for(;I<T.length;){const M=T[I].cellIdx,R={start:this.payload.length,len:0};for(;I<T.length&&T[I].cellIdx===M;)++R.len,this.payload.push(T[I++].triIdx);this.cells[M]=R}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,s){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const l=co(e.x-this.min.x,this.xScale,this.cellsX),h=co(e.y-this.min.y,this.yScale,this.cellsY),p=this.cells[h*this.cellsX+l];if(p){this._lazyInitLookup();for(let g=0;g<p.len;g++){const x=this.payload[p.start+g],w=Math.floor(x/8),T=1<<x%8;if(!(this.lookup[w]&T)&&(this.lookup[w]|=T,s.push(x),s.length===this.triangleCount))return}}}query(e,s,l){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>s.x||e.y>this.max.y||this.min.y>s.y)return;this._lazyInitLookup();const h=co(e.x-this.min.x,this.xScale,this.cellsX),p=co(s.x-this.min.x,this.xScale,this.cellsX),g=co(e.y-this.min.y,this.yScale,this.cellsY),x=co(s.y-this.min.y,this.yScale,this.cellsY);for(let w=g;w<=x;w++)for(let T=h;T<=p;T++){const I=this.cells[w*this.cellsX+T];if(I)for(let M=0;M<I.len;M++){const R=this.payload[I.start+M],B=Math.floor(R/8),V=1<<R%8;if(!(this.lookup[B]&V)&&(this.lookup[B]|=V,l.push(R),l.length===this.triangleCount))return}}}}function co(n,e,s){return Math.max(0,Math.min(s-1,Math.floor(n*e)))}Dt(cg,"TriangleGridIndex");class Qx{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.footprints=[],this.worldview=e.worldview}updateFootprints(e,s){for(const l of this.footprints)s.push({footprint:l,id:e})}populate(e,s,l,h){const p=[];for(const{feature:g,id:x,index:w,sourceLayerIndex:T}of e){const I=this.layers[0]._featureFilter.needGeometry,M=pt(g,I);if(!this.layers[0]._featureFilter.filter(new _r(this.zoom,{worldview:this.worldview}),M,l))continue;const R={id:x,properties:g.properties,type:g.type,sourceLayerIndex:T,index:w,geometry:I?M.geometry:Pt(g,l,h),patterns:{}};p.push(R)}for(const g of p){const{geometry:x,index:w,sourceLayerIndex:T}=g;this.addFeature(g,x,w,l,{},s.availableImages,s.brightness),s.featureIndex.insert(e[w].feature,x,w,T,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,s,l,h,p,g,x){}destroy(){}addFeature(e,s,l,h,p,g=[],x){for(const w of lf(s,2)){const T=[],I=[],M=[],R=new mt(1/0,1/0),B=new mt(-1/0,-1/0);for(const Z of w)if(Z.length!==0){Z!==w[0]&&M.push(I.length/2);for(let $=0;$<Z.length;$++)I.push(Z[$].x),I.push(Z[$].y),T.push(Z[$]),R.x=Math.min(R.x,Z[$].x),R.y=Math.min(R.y,Z[$].y),B.x=Math.max(B.x,Z[$].x),B.y=Math.max(B.y,Z[$].y)}const V=fu(I,M),q=new cg(T,V,8,256);this.footprints.push({vertices:T,indices:V,grid:q,min:R,max:B})}}}Dt(Qx,"ClipBucket",{omit:["layers"]});const fS=Fi([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),pS=Fi([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),gS=Fi([{name:"a_centroid_pos",components:2,type:"Uint16"}]),mS=Fi([{name:"a_join_normal_inside",components:3,type:"Int16"}]),_S=Fi([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),yS=Fi([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:xS}=fS,cf=Number.MAX_SAFE_INTEGER,ev=cf-1;function tv(n,e,s,l){return n.order<e||n.order===cf||!(n.clipMask&s)||function(h,p){return p.length!==0&&p.find(g=>g===h)===void 0}(l,n.clipScope)}function hg(n,e){return n.x-e.x||n.y-e.y}function iv(n,e){return hg(n.min,e.min)===0&&hg(n.max,e.max)===0}function h_(n,e){return!(n.min.x>e.max.x||n.max.x<e.min.x||n.min.y>e.max.y||n.max.y<e.min.y)}function ug(n,e){if(n.length!==e.length)return!1;for(let s=0;s<n.length;s++)if(n[s].sourceId!==e[s].sourceId||!iv(n[s],e[s])||n[s].order!==e[s].order||n[s].clipMask!==e[s].clipMask||!ya(n[s].clipScope,e[s].clipScope))return!1;return!0}function rv(n,e,s){const l=1/At,h=1/(1<<s.canonical.z),p=(e.x*l+s.canonical.x)*h+s.wrap,g=(e.y*l+s.canonical.y)*h;return{min:new mt((n.x*l+s.canonical.x)*h+s.wrap,(n.y*l+s.canonical.y)*h),max:new mt(p,g)}}function vS(n,e,s){const l=1<<s.canonical.z,h=((e.x-s.wrap)*l-s.canonical.x)*At,p=(e.y*l-s.canonical.y)*At;return{min:new mt(((n.x-s.wrap)*l-s.canonical.x)*At,(n.y*l-s.canonical.y)*At),max:new mt(h,p)}}function u_(n,e,s,l,h,p,g){const x=n.indices,w=n.vertices,T=[];for(let I=l;I<l+h;I+=3){const M=e[s[I+0]+p],R=e[s[I+1]+p],B=e[s[I+2]+p],V=Math.min(M.x,R.x,B.x),q=Math.max(M.x,R.x,B.x),Z=Math.min(M.y,R.y,B.y),$=Math.max(M.y,R.y,B.y);T.length=0,n.grid.query(new mt(V,Z),new mt(q,$),T);for(let ne=0;ne<T.length;ne++){const ae=T[ne];if(Ea(w[x[3*ae+0]],w[x[3*ae+1]],w[x[3*ae+2]],M,R,B,g))return!0}}return!1}function sv(n,e,s,l){if(!n||!s)return!1;let h=n.vertices;if(!e.canonical.equals(l.canonical)||e.wrap!==l.wrap){if(s.vertices.length<n.vertices.length)return sv(s,l,n,e);const p=e.canonical,g=l.canonical,x=Math.pow(2,g.z-p.z);h=n.vertices.map(w=>new mt((w.x+p.x*At)*x-g.x*At,(w.y+p.y*At)*x-g.y*At))}return u_(s,h,n.indices,0,n.indices.length,0,0)}function nv(n,e,s,l){const h=Math.pow(2,l.z-s.z);return new mt((n+s.x*At)*h-l.x*At,(e+s.y*At)*h-l.y*At)}function d_(n,e){const s=[];e.grid.queryPoint(n,s);const l=e.indices,h=e.vertices;for(let p=0;p<s.length;p++){const g=s[p];if(vs([h[l[3*g+0]],h[l[3*g+1]],h[l[3*g+2]]],n))return!0}return!1}const f_=[new mt(0,0),new mt(At,0),new mt(At,At),new mt(0,At)];function av(n,e){const s=[];let l=[];if(!e||n.length<2)return[n];if(n.length===2)return zs(n[0],n[1],f_)?[n]:[];for(let h=0;h<n.length+2;h++){const p=n[h%n.length],g=n[(h+1)%n.length],x=zs(h===0?n[n.length-1]:n[(h-1)%n.length],p,f_),w=zs(p,g,f_),T=x||w;T&&l.push(p),T&&w||l.length>0&&(l.length>1&&s.push(l),l=[])}return l.length>1&&s.push(l),s}const p_=ht.types,bS=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],wS=["fill-extrusion-flood-light-ground-radius"],SS=Math.pow(2,13),AS=Math.pow(2,15)-1,ov=new mt(0,1),Pl=2147483648;function hf(n,e,s,l,h,p,g,x){n.emplaceBack((e<<1)+g,(s<<1)+p,(Math.floor(l*SS)<<1)+h,Math.round(x))}function uf(n,e,s){n.emplaceBack(e.x*At,e.y*At,s?1:0)}function dg(n,e,s,l,h,p){n.emplaceBack(e.x,e.y,(s.x<<1)+l,(s.y<<1)+h,p)}function df(n,e,s){n.emplaceBack(e.x,e.y,e.z,s[0]*16384,s[1]*16384,s[2]*16384)}class lv{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class cv{constructor(){this.centroidXY=new mt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new mt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new mt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new mt(this.max.x-this.min.x,this.max.y-this.min.y)}}class hv{constructor(){this.acc=new mt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,s){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=s.x,e.min.y=e.max.y=s.y)}appendEdge(e,s,l){this.accCount++,this.acc._add(s);let h=!!this.borders;s.x<e.min.x?(e.min.x=s.x,h=!0):s.x>e.max.x&&(e.max.x=s.x,h=!0),s.y<e.min.y?(e.min.y=s.y,h=!0):s.y>e.max.y&&(e.max.y=s.y,h=!0),((s.x===0||s.x===At)&&s.x===l.x)!=((s.y===0||s.y===At)&&s.y===l.y)&&this.processBorderOverlap(s,l),h&&this.checkBorderIntersection(s,l)}checkBorderIntersection(e,s){s.x<0!=e.x<0&&this.addBorderIntersection(0,ei(s.y,e.y,(0-s.x)/(e.x-s.x))),s.x>At!=e.x>At&&this.addBorderIntersection(1,ei(s.y,e.y,(At-s.x)/(e.x-s.x))),s.y<0!=e.y<0&&this.addBorderIntersection(2,ei(s.x,e.x,(0-s.y)/(e.y-s.y))),s.y>At!=e.y>At&&this.addBorderIntersection(3,ei(s.x,e.x,(At-s.y)/(e.y-s.y)))}addBorderIntersection(e,s){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const l=this.borders[e];s<l[0]&&(l[0]=s),s>l[1]&&(l[1]=s)}processBorderOverlap(e,s){if(e.x===s.x){if(e.y===s.y)return;const l=e.x===0?0:1;this.addBorderIntersection(l,s.y),this.addBorderIntersection(l,e.y)}else{const l=e.y===0?2:3;this.addBorderIntersection(l,s.x),this.addBorderIntersection(l,e.x)}}centroid(){return this.accCount===0?new mt(0,0):new mt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,s)=>e+ +(s[0]!==Number.MAX_VALUE),0):0}}function uv(n,e){const s=n.add(e)._unit(),l=Ee(n.x*s.x+n.y*s.y,-1,1);var h,p,g;return h=Math.acos(l),Math.min(4,Math.max(-4,Math.tan(h)))/4*AS*((p=n).x*(g=e).y-p.y*g.x<0?-1:1)}const TS=[n=>n.x<0,n=>n.x>At,n=>n.y<0,n=>n.y>At];function ES(n,e,s,l){const h=[4];if(l===0)return h;s._mult(l);const p=n.sub(s),g=e.sub(s),x=[n,e,p,g];for(let w=0;w<4;w++)for(const T of x)if(TS[w](T)){h.push(w);break}return h}class g_{constructor(e){this.vertexArray=new Hd,this.indexArray=new gs,this.programConfigurations=new Gn(e.layers,{zoom:e.zoom,lut:e.lut},s=>wS.includes(s)),this._segments=new zr,this.hiddenByLandmarkVertexArray=new ou,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new zr}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,s,l,h=!1){const p=e.length;if(p>2){let g=Math.max(0,this._segments.get().length-1);const x=this._segments._prepareSegment(4*p,this.vertexArray.length,2*this._segmentToGroundQuads[g].length);let w;g!==this._segments.get().length-1&&(g++,this._segmentToGroundQuads[g]=[],this._segmentToRegionTriCounts[g]=[0,0,0,0,0]);{const T=e[0],I=e[1];w=uv(T.sub(e[p-1])._perp()._unit(),I.sub(T)._perp()._unit())}for(let T=0;T<p;T++){const I=T===p-1?0:T+1,M=e[T],R=e[I],B=e[I===p-1?0:I+1],V=R.sub(M)._perp()._unit(),q=uv(V,B.sub(R)._perp()._unit()),Z=w,$=q;if(m_(M,R,s)||h&&pv(M,s)&&pv(R,s)){w=q;continue}const ne=x.vertexLength;dg(this.vertexArray,M,R,1,1,Z),dg(this.vertexArray,M,R,1,0,Z),dg(this.vertexArray,M,R,0,1,$),dg(this.vertexArray,M,R,0,0,$),x.vertexLength+=4;const ae=ES(M,R,V,l);for(const le of ae)this._segmentToGroundQuads[g].push({id:ne,region:le}),this._segmentToRegionTriCounts[g][le]+=2,x.primitiveLength+=2;w=q}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),s=e.length;for(let l=0;l<s;l++)this._segmentToGroundQuads[l].sort((h,p)=>h.region-p.region);for(let l=0;l<s;l++){const h=this._segmentToGroundQuads[l],p=e[l],g=this._segmentToRegionTriCounts[l];g.reduce((w,T)=>w+T,0);let x=0;for(let w=0;w<=4;w++){const T=g[w];if(T!==0){let I=this.regionSegments[w];I||(I=this.regionSegments[w]=new zr);const M={vertexOffset:p.vertexOffset,primitiveOffset:p.primitiveOffset+x,vertexLength:p.vertexLength,primitiveLength:T};I.get().push(M)}x+=T}for(let w=0;w<h.length;w++){const T=h[w].id;this.indexArray.emplaceBack(T,T+1,T+3),this.indexArray.emplaceBack(T,T+3,T+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,s,l,h,p,g,x){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,s,l,h,p,g,void 0,x)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,pS.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,s,l,h,p,g,x,w){this.hasData()&&this.programConfigurations.updatePaintArrays(e,s,l,h,p,g,x,w)}updateHiddenByLandmark(e){this.updateHiddenByLandmarkRange(e.groundVertexArrayOffset,e.groundVertexCount,!!(e.flags&Pl))}updateHiddenByLandmarkRange(e,s,l){if(!this.hasData())return;const h=s+e;if(s!==0){for(let p=e;p<h;++p)this.hiddenByLandmarkVertexArray.emplace(p,l?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,_S.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const s=this.regionSegments[e];s&&s.destroy()}}}}class fg{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map(s=>s.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new gs,this.footprintVertices=new io,this.footprintSegments=[],this.layoutVertexArray=new Bo,this.centroidVertexArray=new $p,this.wallVertexArray=new Kp,this.indexArray=new gs,this.programConfigurations=new Gn(e.layers,{zoom:e.zoom,lut:e.lut},s=>bS.includes(s)),this.segments=new zr,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.groundEffect=new g_(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=e.worldview}updateFootprints(e,s){}populate(e,s,l,h){this.features=[],this.hasPattern=n_("fill-extrusion",this.layers,this.pixelRatio,s),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=Ne(l),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:p,id:g,index:x,sourceLayerIndex:w}of e){const T=this.layers[0]._featureFilter.needGeometry,I=pt(p,T);if(!this.layers[0]._featureFilter.filter(new _r(this.zoom,{worldview:this.worldview}),I,l))continue;const M={id:g,sourceLayerIndex:w,index:x,geometry:T?I.geometry:Pt(p,l,h),properties:p.properties,type:p.type,patterns:{}},R=this.layoutVertexArray.length,B=p_[M.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:p.id,feature:a_("fill-extrusion",this.layers,M,this.zoom,this.pixelRatio,s)});else if(this.wallMode)for(const V of M.geometry)for(const q of av(V,B))this.addFeature(p.id,M,[q],x,l,{},s.availableImages,h,s.brightness);else this.addFeature(p.id,M,M.geometry,x,l,{},s.availableImages,h,s.brightness);s.featureIndex.insert(p,M.geometry,x,w,this.index,R)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,s,l,h,p,g){for(const{featureId:x,feature:w}of this.features){const T=p_[w.type]==="Polygon",{geometry:I}=w;if(this.wallMode)for(const M of I)for(const R of av(M,T))this.addFeature(x,w,[R],w.index,s,l,h,p,g);else this.addFeature(x,w,I,w.index,s,l,h,p,g)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,s,l,h,p,g,x){this.programConfigurations.updatePaintArrays(e,s,p,l,h,g,x,this.worldview),this.groundEffect.update(e,s,p,l,h,g,x,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,xS),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,mS.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,yS.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,gS.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,s,l,h,p,g,x,w,T){const I=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(s,{})/this.tileToMeter,M=[new mt(0,0),new mt(At,At)],R=w.projection,B=R.name==="globe",V=this.wallMode||p_[s.type]==="Polygon",q=new hv;q.centroidDataIndex=this.centroidData.length;const Z=new cv;Z.buildingId=e,s.properties&&s.properties.hasOwnProperty("building_id")&&(Z.buildingId=s.properties.building_id);const $=this.layers[0].paint.get("fill-extrusion-base").evaluate(s,{},p)<=0,ne=this.layers[0].paint.get("fill-extrusion-height").evaluate(s,{},p);let ae;if(Z.height=ne,Z.vertexArrayOffset=this.layoutVertexArray.length,Z.groundVertexArrayOffset=this.groundEffect.vertexArray.length,B&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new iu),this.wallMode){if(B)return void Di("Non zero fill-extrusion-line-width is not yet supported on globe.");if(l.length!==1)return;ae=function(Be){const st=Be[0].x===Be[Be.length-1].x&&Be[0].y===Be[Be.length-1].y;(function(St){let Gt=0;const li=St.length;for(let kt=0;kt<li;kt++)Gt+=(St[(kt+1)%li].x-St[kt].x)*(St[(kt+1)%li].y+St[kt].y);return Gt>=0})(Be)||(Be=Be.reverse());const nt={geometry:[],joinNormals:[],indices:[]},ot=[],gt=[],tt=[];let ct=Be.length;for(;ct>=2&&Be[ct-1].equals(Be[ct-2]);)ct--;if(ct<(st?3:2))return nt;let Xe,He,_t,dt,Yt,zt=0;for(;zt<ct-1&&Be[zt].equals(Be[zt+1]);)zt++;st&&(Xe=Be[ct-2],Yt=Be[zt].sub(Xe)._unit()._perp());for(let St=zt;St<ct;St++){if(_t=St===ct-1?st?Be[zt+1]:void 0:Be[St+1],_t&&Be[St].equals(_t))continue;Yt&&(dt=Yt),Xe&&(He=Xe),Xe=Be[St],Yt=_t?_t.sub(Xe)._unit()._perp():dt,dt=dt||Yt;let Gt=dt.add(Yt);Gt.x===0&&Gt.y===0||Gt._unit();const li=Gt.x*Yt.x+Gt.y*Yt.y,kt=li!==0?1/li:1/0,jt=dt.x*Yt.y-dt.y*Yt.x>0;let ti="miter";const di=2;ti==="miter"&&kt>di&&(ti="bevel"),ti==="bevel"&&(kt>100&&(ti="flipbevel"),kt<di&&(ti="miter"));const Ii=(_i,Ft,fi,Vi)=>{const de=new mt(_i.x,_i.y),fe=new mt(_i.x,_i.y);de.x+=Ft.x*Vi,de.y+=Ft.y*Vi,fe.x-=Ft.x*Math.max(fi,1),fe.y-=Ft.y*Math.max(fi,1),tt.push(Ft),ot.push(de),gt.push(fe)};if(ti==="miter")Gt._mult(kt),Ii(Xe,Gt,0,0);else if(ti==="flipbevel")Gt=Yt.mult(-1),Ii(Xe,Gt,0,0),Ii(Xe,Gt.mult(-1),0,0);else{const _i=-Math.sqrt(kt*kt-1),Ft=jt?_i:0,fi=jt?0:_i;He&&Ii(Xe,dt,Ft,fi),_t&&Ii(Xe,Yt,Ft,fi)}}nt.geometry=[...ot,...gt.reverse(),ot[0]],nt.joinNormals=[...tt,...tt.reverse(),tt[tt.length-1]];const Bt=nt.geometry.length-1;for(let St=0;St<Bt/2;St++)if(St+1<Bt/2){let Gt=St,li=St+1,kt=Bt-1-St,jt=Bt-2-St;Gt=Gt===0?Bt-1:Gt-1,li=li===0?Bt-1:li-1,kt=kt===0?Bt-1:kt-1,jt=jt===0?Bt-1:jt-1,nt.indices.push(kt),nt.indices.push(li),nt.indices.push(Gt),nt.indices.push(kt),nt.indices.push(jt),nt.indices.push(li)}return nt}(l[0]),l=[ae.geometry]}const le=(Be,st)=>Be<(st.length-1)/2||Be===st.length-1,be=this.wallMode?[l]:lf(l,500);for(let Be=be.length-1;Be>=0;Be--){const st=be[Be];(st.length===0||(we=st[0]).every(ut=>ut.x<=0)||we.every(ut=>ut.x>=At)||we.every(ut=>ut.y<=0)||we.every(ut=>ut.y>=At))&&be.splice(Be,1)}var we;let ke;if(B)ke=yv(be,M,p);else{ke=[];for(const Be of be)ke.push({polygon:Be,bounds:M})}const Le=V?this.edgeRadius:0,ze=Le>0&&this.zoom<17,rt=(Be,st)=>{if(Be.length===0)return!1;const ut=Be[Be.length-1];return st.x===ut.x&&st.y===ut.y};for(const{polygon:Be,bounds:st}of ke){let ut=0,nt=0;for(const ct of Be)V&&!ct[0].equals(ct[ct.length-1])&&ct.push(ct[0]),nt+=V?ct.length-1:ct.length;const ot=this.segments.prepareSegment((V?5:4)*nt,this.layoutVertexArray,this.indexArray);Z.footprintSegIdx<0&&(Z.footprintSegIdx=this.footprintSegments.length),Z.polygonSegIdx<0&&(Z.polygonSegIdx=this.polygonSegments.length);const gt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},tt=new lv;if(tt.vertexOffset=this.footprintVertices.length,tt.indexOffset=3*this.footprintIndices.length,tt.ringIndices=[],V){const ct=[],Xe=[];ut=ot.vertexLength;for(let _t=0;_t<Be.length;_t++){const dt=Be[_t];dt.length&&_t!==0&&Xe.push(ct.length/2);const Yt=[];let zt,Bt;zt=dt[1].sub(dt[0])._perp()._unit(),tt.ringIndices.push(dt.length-1);for(let St=1;St<dt.length;St++){const Gt=dt[St],li=dt[St===dt.length-1?1:St+1],kt=Gt.clone();if(Le){Bt=li.sub(Gt)._perp()._unit();const jt=zt.add(Bt)._unit(),ti=Le*Math.min(4,1/(zt.x*jt.x+zt.y*jt.y));kt.x+=ti*jt.x,kt.y+=ti*jt.y,kt.x=Math.round(kt.x),kt.y=Math.round(kt.y),zt=Bt}if(!$||Le!==0&&!ze||rt(Yt,kt)||Yt.push(kt),hf(this.layoutVertexArray,kt.x,kt.y,0,0,1,1,0),this.wallMode){const jt=le(St,dt);uf(this.wallVertexArray,ae.joinNormals[St],!jt)}ot.vertexLength++,this.footprintVertices.emplaceBack(Gt.x,Gt.y),ct.push(Gt.x,Gt.y),B&&df(this.layoutVertexExtArray,R.projectTilePoint(kt.x,kt.y,p),R.upVector(p,kt.x,kt.y))}$&&(Le===0||ze)&&(Yt.length!==0&&rt(Yt,Yt[0])&&Yt.pop(),this.groundEffect.addData(Yt,st,I))}const He=this.wallMode?ae.indices:fu(ct,Xe);for(let _t=0;_t<He.length;_t+=3)this.footprintIndices.emplaceBack(tt.vertexOffset+He[_t+0],tt.vertexOffset+He[_t+1],tt.vertexOffset+He[_t+2]),this.indexArray.emplaceBack(ut+He[_t],ut+He[_t+2],ut+He[_t+1]),ot.primitiveLength++;tt.indexCount+=He.length,tt.vertexCount+=this.footprintVertices.length-tt.vertexOffset}for(let ct=0;ct<Be.length;ct++){const Xe=Be[ct];q.startRing(Z,Xe[0]);let He=Xe.length>4&&gv(Xe[Xe.length-2],Xe[0],Xe[1]),_t=Le?CS(Xe[Xe.length-2],Xe[0],Xe[1],Le):0;const dt=[];let Yt,zt,Bt;zt=Xe[1].sub(Xe[0])._perp()._unit();let St=!0;for(let Gt=1,li=0;Gt<Xe.length;Gt++){let kt=Xe[Gt-1],jt=Xe[Gt];const ti=Xe[Gt===Xe.length-1?1:Gt+1];if(q.appendEdge(Z,jt,kt),m_(jt,kt,st)){Le&&(zt=ti.sub(jt)._perp()._unit(),St=!St);continue}const di=jt.sub(kt)._perp(),Ii=di.x/(Math.abs(di.x)+Math.abs(di.y)),_i=di.y>0?1:0,Ft=kt.dist(jt);if(li+Ft>32768&&(li=0),Le){Bt=ti.sub(jt)._perp()._unit();let fe=fv(kt,jt,ti,dv(zt,Bt),Le);isNaN(fe)&&(fe=0);const Ge=jt.sub(kt)._unit();kt=kt.add(Ge.mult(_t))._round(),jt=jt.add(Ge.mult(-fe))._round(),_t=fe,zt=Bt,$&&this.zoom>=17&&(rt(dt,kt)||dt.push(kt),rt(dt,jt)||dt.push(jt))}const fi=ot.vertexLength,Vi=Xe.length>4&&gv(kt,jt,ti);let de=mv(li,He,St);if(hf(this.layoutVertexArray,kt.x,kt.y,Ii,_i,0,0,de),hf(this.layoutVertexArray,kt.x,kt.y,Ii,_i,0,1,de),this.wallMode){const fe=le(Gt-1,Xe),Ge=ae.joinNormals[Gt-1];uf(this.wallVertexArray,Ge,fe),uf(this.wallVertexArray,Ge,fe)}if(li+=Ft,de=mv(li,Vi,!St),He=Vi,hf(this.layoutVertexArray,jt.x,jt.y,Ii,_i,0,0,de),hf(this.layoutVertexArray,jt.x,jt.y,Ii,_i,0,1,de),this.wallMode){const fe=le(Gt,Xe),Ge=ae.joinNormals[Gt];uf(this.wallVertexArray,Ge,fe),uf(this.wallVertexArray,Ge,fe)}if(ot.vertexLength+=4,this.indexArray.emplaceBack(fi+0,fi+1,fi+2),this.indexArray.emplaceBack(fi+1,fi+3,fi+2),ot.primitiveLength+=2,Le){const fe=ut+(Gt===1?Xe.length-2:Gt-2),Ge=Gt===1?ut:fe+1;if(this.indexArray.emplaceBack(fi+1,fe,fi+3),this.indexArray.emplaceBack(fe,Ge,fi+3),ot.primitiveLength+=2,Yt===void 0&&(Yt=fi),!m_(ti,Xe[Gt],st)){const it=Gt===Xe.length-1?Yt:ot.vertexLength;this.indexArray.emplaceBack(fi+2,fi+3,it),this.indexArray.emplaceBack(fi+3,it+1,it),this.indexArray.emplaceBack(fi+3,Ge,it+1),ot.primitiveLength+=3}St=!St}if(B){const fe=this.layoutVertexExtArray,Ge=R.projectTilePoint(kt.x,kt.y,p),it=R.projectTilePoint(jt.x,jt.y,p),It=R.upVector(p,kt.x,kt.y),Ct=R.upVector(p,jt.x,jt.y);df(fe,Ge,It),df(fe,Ge,It),df(fe,it,Ct),df(fe,it,Ct)}}V&&(ut+=Xe.length-1),$&&Le&&this.zoom>=17&&(dt.length!==0&&rt(dt,dt[0])&&dt.pop(),this.groundEffect.addData(dt,st,I,Le>0))}this.footprintSegments.push(tt),gt.triangleCount=this.indexArray.length-gt.triangleArrayOffset,this.polygonSegments.push(gt),++Z.footprintSegLen,++Z.polygonSegLen}if(Z.vertexCount=this.layoutVertexArray.length-Z.vertexArrayOffset,Z.groundVertexCount=this.groundEffect.vertexArray.length-Z.groundVertexArrayOffset,Z.vertexCount!==0){if(Z.centroidXY=q.borders?ov:this.encodeCentroid(q,Z),this.centroidData.push(Z),q.borders){this.featuresOnBorder.push(q);const Be=this.featuresOnBorder.length-1;for(let st=0;st<q.borders.length;st++)q.borders[st][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[st].push(Be)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,h,g,x,p,T,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(s,h,g,x,p,T,this.worldview),this.maxHeight=Math.max(this.maxHeight,ne)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((s,l)=>this.featuresOnBorder[s].borders[e][0]-this.featuresOnBorder[l].borders[e][0])}splitToSubtiles(){const e=[];for(let x=0;x<this.centroidData.length;x++){const w=this.centroidData[x],T=+(w.min.y+w.max.y>At),I=2*T+(+(w.min.x+w.max.x>At)^T);for(let M=0;M<w.polygonSegLen;M++){const R=w.polygonSegIdx+M;e.push({centroidIdx:x,subtile:I,polygonSegmentIdx:R,triangleSegmentIdx:this.polygonSegments[R].triangleSegIdx})}}const s=new gs;e.sort((x,w)=>x.triangleSegmentIdx===w.triangleSegmentIdx?x.subtile-w.subtile:x.triangleSegmentIdx-w.triangleSegmentIdx);let l=0,h=0,p=0;for(const x of e){if(x.triangleSegmentIdx!==l)break;p++}const g=e.length;for(;h!==e.length;){l=e[h].triangleSegmentIdx;let x=0,w=h,T=h;for(let I=w;I<p&&e[I].subtile===x;I++)T++;for(;w!==p;){const I=e[w];x=I.subtile;const M=this.centroidData[I.centroidIdx].min.clone(),R=this.centroidData[I.centroidIdx].max.clone(),B={vertexOffset:this.segments.segments[l].vertexOffset,primitiveOffset:s.length,vertexLength:this.segments.segments[l].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let V=w;V<T;V++){const q=e[V],Z=this.polygonSegments[q.polygonSegmentIdx],$=this.centroidData[q.centroidIdx].min,ne=this.centroidData[q.centroidIdx].max,ae=this.indexArray.uint16;for(let le=Z.triangleArrayOffset;le<Z.triangleArrayOffset+Z.triangleCount;le++)s.emplaceBack(ae[3*le],ae[3*le+1],ae[3*le+2]);B.primitiveLength+=Z.triangleCount,M.x=Math.min(M.x,$.x),M.y=Math.min(M.y,$.y),R.x=Math.max(R.x,ne.x),R.y=Math.max(R.y,ne.y)}B.primitiveLength>0&&this.triangleSubSegments.push({segment:B,min:M,max:R}),w=T;for(let V=w;V<p&&e[V].subtile===e[w].subtile;V++)T++}h=p;for(let I=h;I<g&&e[I].triangleSegmentIdx===e[h].triangleSegmentIdx;I++)p++}s._trim(),this.indexArray=s}getVisibleSegments(e,s,l){const h=new zr;if(this.wallMode){for(const q of this.triangleSubSegments)h.segments.push(q.segment);return h}let p=0,g=0;const x=1<<e.canonical.z;if(s){const q=s.getMinMaxForTile(e);q&&(p=q.min,g=q.max)}g+=this.maxHeight;const w=e.toUnwrapped();let T;const I=[w.canonical.x/x+w.wrap,w.canonical.y/x],M=[(w.canonical.x+1)/x+w.wrap,(w.canonical.y+1)/x],R=(q,Z,$)=>[q[0]*(1-$[0])+Z[0]*$[0],q[1]*(1-$[1])+Z[1]*$[1]],B=[],V=[];for(const q of this.triangleSubSegments){B[0]=q.min.x/At,B[1]=q.min.y/At,V[0]=q.max.x/At,V[1]=q.max.y/At;const Z=R(I,M,B),$=R(I,M,V);if(new ri([Z[0],Z[1],p],[$[0],$[1],g]).intersectsPrecise(l)===0){T&&(h.segments.push(T),T=void 0);continue}const ne=q.segment;T&&T.vertexOffset!==ne.vertexOffset&&(h.segments.push(T),T=void 0),T?(T.vertexLength+=ne.vertexLength,T.primitiveLength+=ne.primitiveLength):T={vertexOffset:ne.vertexOffset,primitiveLength:ne.primitiveLength,vertexLength:ne.vertexLength,primitiveOffset:ne.primitiveOffset,sortKey:void 0,vaos:{}}}return T&&h.segments.push(T),h}encodeCentroid(e,s){const l=e.centroid(),h=s.span(),p=Math.min(7,Math.round(h.x*this.tileToMeter/10)),g=Math.min(7,Math.round(h.y*this.tileToMeter/10));return new mt(Ee(l.x,1,At-1)<<3|p,Ee(l.y,1,At-1)<<3|g)}encodeBorderCentroid(e){if(!e.borders)return new mt(0,0);const s=e.borders,l=Number.MAX_VALUE;if(s[0][0]!==l||s[1][0]!==l){const h=s[0][0]!==l?0:1;return new mt(6|(s[0][0]!==l?0:65528),(s[h][0]+s[h][1])/2<<3|6)}{const h=s[2][0]!==l?2:3;return new mt((s[h][0]+s[h][1])/2<<3|6,6|(s[2][0]!==l?0:65528))}}showCentroid(e){const s=this.centroidData[e.centroidDataIndex];s.flags&=2147483647,s.centroidXY.x=0,s.centroidXY.y=0,this.writeCentroidToBuffer(s)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const s=e.vertexArrayOffset,l=e.vertexCount+e.vertexArrayOffset,h=e.flags&Pl?ov:e.centroidXY,p=this.centroidVertexArray.geta_centroid_pos0(s);if(this.centroidVertexArray.geta_centroid_pos1(s)!==h.y||p!==h.x){for(let g=s;g<l;++g)this.centroidVertexArray.emplace(g,h.x,h.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,s,l){if(s.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=s.updateTime;const h=s.getReplacementRegionsForTile(e.toUnwrapped());if(ug(this.activeReplacements,h))return;if(this.activeReplacements=h,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const g of this.centroidData)g.flags&=2147483647;const p=[];for(const g of this.activeReplacements){if(g.order<l)continue;const x=Math.max(1,Math.pow(2,g.footprintTileId.canonical.z-e.canonical.z));if(g.footprint.buildingId){const w=g.footprint.buildingId;for(const T of this.centroidData)T.buildingId===w&&(T.flags|=Pl)}else for(const w of this.centroidData)if(!(w.flags&Pl||g.min.x>w.max.x||w.min.x>g.max.x||g.min.y>w.max.y||w.min.y>g.max.y))for(let T=0;T<w.footprintSegLen;T++){const I=this.footprintSegments[w.footprintSegIdx+T];if(p.length=0,IS(this.footprintVertices,I.vertexOffset,I.vertexCount,g.footprintTileId.canonical,e.canonical,p),u_(g.footprint,p,this.footprintIndices.uint16,I.indexOffset,I.indexCount,-I.vertexOffset,-x)){w.flags|=Pl;break}}}for(const g of this.centroidData)this.writeCentroidToBuffer(g);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,s,l){let h=!1;for(let p=0;p<l.footprintSegLen;p++){const g=this.footprintSegments[l.footprintSegIdx+p];let x=0;for(const w of g.ringIndices){for(let T=x,I=w+x-1;T<w+x;I=T++){const M=this.footprintVertices.int16[2*(T+g.vertexOffset)+0],R=this.footprintVertices.int16[2*(T+g.vertexOffset)+1],B=this.footprintVertices.int16[2*(I+g.vertexOffset)+1];R>s!=B>s&&e<(this.footprintVertices.int16[2*(I+g.vertexOffset)+0]-M)*(s-R)/(B-R)+M&&(h=!h)}x=w}}return h}getHeightAtTileCoord(e,s){let l=Number.NEGATIVE_INFINITY,h=!0;const p=4*(e+At)*At+(s+At);if(this.partLookup.hasOwnProperty(p)){const g=this.partLookup[p];return g?{height:g.height,hidden:!!(g.flags&Pl)}:void 0}for(const g of this.centroidData)e>g.max.x||g.min.x>e||s>g.max.y||g.min.y>s||g.height<=l||this.footprintContainsPoint(e,s,g)&&(l=g.height,this.partLookup[p]=g,h=!!(g.flags&Pl));if(l!==Number.NEGATIVE_INFINITY)return{height:l,hidden:h};this.partLookup[p]=void 0}}function dv(n,e){const s=n.add(e)._unit();return n.x*s.x+n.y*s.y}function CS(n,e,s,l){const h=e.sub(n)._perp()._unit(),p=s.sub(e)._perp()._unit();return fv(n,e,s,dv(h,p),l)}function fv(n,e,s,l,h){const p=Math.sqrt(1-l*l);return Math.min(n.dist(e)/3,e.dist(s)/3,h*p/l)}function m_(n,e,s){return n.x<s[0].x&&e.x<s[0].x||n.x>s[1].x&&e.x>s[1].x||n.y<s[0].y&&e.y<s[0].y||n.y>s[1].y&&e.y>s[1].y}function pv(n,e){return n.x<e[0].x||n.x>e[1].x||n.y<e[0].y||n.y>e[1].y}function gv(n,e,s){if(n.x<0||n.x>=At||e.x<0||e.x>=At||s.x<0||s.x>=At)return!1;const l=s.sub(e),h=l.perp(),p=n.sub(e);return(l.x*p.x+l.y*p.y)/Math.sqrt((l.x*l.x+l.y*l.y)*(p.x*p.x+p.y*p.y))>-.866&&h.x*p.x+h.y*p.y<0}function mv(n,e,s){const l=e?2|n:-3&n;return s?1|l:-2&l}function _v(){const n=Math.PI/32,e=Math.tan(n),s=W;return s*Math.sqrt(1+2*e*e)-s}function yv(n,e,s){const l=1<<s.z,h=xe(s.x/l),p=xe((s.x+1)/l),g=_e(s.y/l),x=_e((s.y+1)/l);return function(w,T,I,M,R=0,B){const V=[];if(!w.length||!I||!M)return V;const q=(we,ke)=>{for(const Le of we)V.push({polygon:Le,bounds:ke})},Z=Math.ceil(Math.log2(I)),$=Math.ceil(Math.log2(M)),ne=Z-$,ae=[];for(let we=0;we<Math.abs(ne);we++)ae.push(ne>0?0:1);for(let we=0;we<Math.min(Z,$);we++)ae.push(0),ae.push(1);let le=w;if(le=lg(le,T[0].y-R,T[1].y+R,1),le=lg(le,T[0].x-R,T[1].x+R,0),!le.length)return V;const be=[];for(ae.length?be.push({polygons:le,bounds:T,depth:0}):q(le,T);be.length;){const we=be.pop(),ke=we.depth,Le=ae[ke],ze=we.bounds[0],rt=we.bounds[1],Be=Le===0?ze.x:ze.y,st=Le===0?rt.x:rt.y,ut=B?B(Le,Be,st):.5*(Be+st),nt=lg(we.polygons,Be-R,ut+R,Le),ot=lg(we.polygons,ut-R,st+R,Le);if(nt.length){const gt=[ze,new mt(Le===0?ut:rt.x,Le===1?ut:rt.y)];ae.length>ke+1?be.push({polygons:nt,bounds:gt,depth:ke+1}):q(nt,gt)}if(ot.length){const gt=[new mt(Le===0?ut:ze.x,Le===1?ut:ze.y),rt];ae.length>ke+1?be.push({polygons:ot,bounds:gt,depth:ke+1}):q(ot,gt)}}return V}(n,e,Math.ceil((p-h)/11.25),Math.ceil((g-x)/11.25),1,(w,T,I)=>{if(w===0)return .5*(T+I);{const M=_e((s.y+T/At)/l);return(ye(.5*(_e((s.y+I/At)/l)+M))*l-s.y)*At}})}function IS(n,e,s,l,h,p){const g=Math.pow(2,l.z-h.z);for(let x=0;x<s;x++){let w=n.int16[2*(x+e)+0],T=n.int16[2*(x+e)+1];w=(w+h.x*At)*g-l.x*At,T=(T+h.y*At)*g-l.y*At,p.push(new mt(w,T))}}let xv,vv;Dt(fg,"FillExtrusionBucket",{omit:["layers","features"]}),Dt(cv,"PartData"),Dt(lv,"FootprintSegment"),Dt(hv,"BorderCentroidData"),Dt(g_,"GroundEffect");class Fc extends mt{constructor(e,s,l){super(e,s),this.z=l}}class bv extends Fc{constructor(e,s,l,h){super(e,s,l),this.w=h}}function wv(n,e,s,l){const h=s==="x"?"y":"x",p=(l-n[s])/(e[s]-n[s]);n[h]=Math.round(n[h]+(e[h]-n[h])*p),n[s]=l,n.hasOwnProperty("z")&&(n.z=ei(n.z,e.z,p)),n.hasOwnProperty("w")&&(n.w=ei(n.w,e.w,p))}function Sv(n,e,s,l){const h=s,p=l;for(const g of["x","y"]){let x=n,w=e;x[g]>=w[g]&&(x=e,w=n),x[g]<h&&w[g]>h&&wv(x,w,g,h),x[g]<p&&w[g]>p&&wv(w,x,g,p)}}function pg(n,e,s,l,h,p){const g=[];for(let x=0;x<n.length;x++){const w=n[x];let T;const I=g.length;let M=0;for(let R=0;R<w.length-1;R++){let B=w[R],V=w[R+1],q=0;const Z=M;let $,ne;p&&(q=Math.hypot(V.x-B.x,V.y-B.y),M+=q,$=B,ne=V),B.x<e&&V.x<e||(B.x<e?B=new mt(e,B.y+(e-B.x)/(V.x-B.x)*(V.y-B.y))._round():V.x<e&&(V=new mt(e,B.y+(e-B.x)/(V.x-B.x)*(V.y-B.y))._round()),B.y<s&&V.y<s||(B.y<s?B=new mt(B.x+(s-B.y)/(V.y-B.y)*(V.x-B.x),s)._round():V.y<s&&(V=new mt(B.x+(s-B.y)/(V.y-B.y)*(V.x-B.x),s)._round()),B.x>=l&&V.x>=l||(B.x>=l?B=new mt(l,B.y+(l-B.x)/(V.x-B.x)*(V.y-B.y))._round():V.x>=l&&(V=new mt(l,B.y+(l-B.x)/(V.x-B.x)*(V.y-B.y))._round()),B.y>=h&&V.y>=h||(B.y>=h?B=new mt(B.x+(h-B.y)/(V.y-B.y)*(V.x-B.x),h)._round():V.y>=h&&(V=new mt(B.x+(h-B.y)/(V.y-B.y)*(V.x-B.x),h)._round()),T&&B.equals(T[T.length-1])||(T=[B],g.push(T),p&&p.push({progress:{min:Z+Av($,ne,B)*q,max:1},parentIndex:x,prevPoint:$,nextPoint:ne})),T.push(V),p&&(p[p.length-1].progress.max=Z+Av($,ne,V)*q,p[p.length-1].nextPoint=ne)))))}if(p&&M>0)for(let R=I;R<g.length;R++)p[R].progress.min/=M,p[R].progress.max/=M}return g}function kS(n,e,s,l,h){if(n.length<2)return void l.push(n);const p=[];for(;e.valid();){const[T,I]=e.get();for(let M=0;M<n.length-1;M++){const R=n[M],B=n[M+1],V=Gr(R,B,T,I);if(V){const[q]=V,Z=new mt(ei(R.x,B.x,q),ei(R.y,B.y,q));p.push({t:M+q,distance:0,point:Z})}}e.next()}if(p.length===0)return void l.push(n);p.sort((T,I)=>T.t-I.t);let g=0,x=0,w=[];for(l.push(w);g!==n.length;){if(x===p.length){for(;g!==n.length;)w.length!==0&&w[w.length-1].equals(n[g])||w.push(n[g]),g++;break}p[x].t<=g?(w.length!==0&&w[w.length-1].equals(p[x].point)||w.push(p[x].point),Math.trunc(p[x].t),x++):(w.length!==0&&w[w.length-1].equals(n[g])||w.push(n[g]),g++)}}function Av(n,e,s){return n.x!==e.x?(s.x-n.x)/(e.x-n.x):n.y!==e.y?(s.y-n.y)/(e.y-n.y):0}function ff(n,e){return n.x*e.x+n.y*e.y}function Tv(n,e){if(n.length===1){let s=0;const l=e[s++];let h;for(;!h||l.equals(h);)if(h=e[s++],!h)return 1/0;for(;s<e.length;s++){const p=e[s],g=n[0],x=h.sub(l),w=p.sub(l),T=g.sub(l),I=ff(x,x),M=ff(x,w),R=ff(w,w),B=ff(T,x),V=ff(T,w),q=I*R-M*M,Z=(R*B-M*V)/q,$=(I*V-M*B)/q,ne=l.z*(1-Z-$)+h.z*Z+p.z*$;if(isFinite(ne))return ne}return 1/0}{let s=1/0;for(const l of e)s=Math.min(s,l.z);return s}}function Ev(n,e,s,l,h,p,g,x){const w=g*h.getElevationAt(n,e,!0,!0),T=p[0]!==0,I=T?p[1]===0?g*(p[0]/7-450):g*function(M,R,B){const V=Math.floor(R[0]/8),q=Math.floor(R[1]/8),Z=10*(R[0]-8*V),$=10*(R[1]-8*q),ne=M.getElevationAt(V,q,!0,!0),ae=M.getMeterToDEM(B),le=Math.floor(.5*(Z*ae-1)),be=Math.floor(.5*($*ae-1)),we=M.tileCoordToPixel(V,q),ke=2*le+1,Le=2*be+1,ze=function(ot,gt,tt,ct,Xe){return[ot.getElevationAtPixel(gt,tt,!0),ot.getElevationAtPixel(gt+Xe,tt,!0),ot.getElevationAtPixel(gt,tt+Xe,!0),ot.getElevationAtPixel(gt+ct,tt+Xe,!0)]}(M,we.x-le,we.y-be,ke,Le),rt=Math.abs(ze[0]-ze[1]),Be=Math.abs(ze[2]-ze[3]),st=Math.abs(ze[0]-ze[2])+Math.abs(ze[1]-ze[3]),ut=Math.min(.25,.5*ae*(rt+Be)/ke),nt=Math.min(.25,.5*ae*st/Le);return ne+Math.max(ut*Z,nt*$)}(h,p,x):w;return{base:w+(s===0?-1:s),top:T?Math.max(I+l,w+s+2):w+l}}class MS{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class PS{constructor(){this.tasks={},this.taskQueue=[],ni(["process"],this),this.invoker=new MS(this.process),this.nextId=0}add(e,s){const l=this.nextId++,h=function({type:p,isSymbolTile:g,zoom:x}){return x=x||0,p==="message"?0:p!=="maybePrepare"||g?p!=="parseTile"||g?p==="parseTile"&&g?300-x:p==="maybePrepare"&&g?400-x:500:200-x:100-x}(s);if(h===0){try{e()}finally{}return null}return this.tasks[l]={fn:e,metadata:s,priority:h,id:l},this.taskQueue.push(l),this.invoker.trigger(),{cancel:()=>{delete this.tasks[l]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(l=>!!this.tasks[l]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const s=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!s)return;s.fn()}finally{}}pick(){let e=null,s=1/0;for(let h=0;h<this.taskQueue.length;h++){const p=this.tasks[this.taskQueue[h]];p.priority<s&&(s=p.priority,e=h)}if(e===null)return null;const l=this.taskQueue[e];return this.taskQueue.splice(e,1),l}remove(){this.invoker.remove()}}class Cv{constructor(e,s,l){this.target=e,this.parent=s,this.mapId=l,this.callbacks={},this.cancelCallbacks={},ni(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new PS}send(e,s,l,h,p=!1,g){const x=Math.round(1e18*Math.random()).toString(36).substring(0,10);l&&(l.metadata=g,this.callbacks[x]=l);const w=new Set;return this.target.postMessage({id:x,type:e,hasCallback:!!l,targetMapId:h,mustQueue:p,sourceMapId:this.mapId,data:Ka(s,w)},w),{cancel:()=>{l&&delete this.callbacks[x],this.target.postMessage({id:x,type:"<cancel>",targetMapId:h,sourceMapId:this.mapId})}}}receive(e){const s=e.data;if(!s)return;const l=s.id;if(l&&(!s.targetMapId||this.mapId===s.targetMapId))if(s.type==="<cancel>"){const h=this.cancelCallbacks[l];delete this.cancelCallbacks[l],h&&h.cancel()}else if(s.mustQueue||dr(self)){const h=this.callbacks[l],p=this.scheduler.add(()=>this.processTask(l,s),h&&h.metadata||{type:"message"});p&&(this.cancelCallbacks[l]=p)}else this.processTask(l,s)}processTask(e,s){if(delete this.cancelCallbacks[e],s.type==="<response>"){const l=this.callbacks[e];delete this.callbacks[e],l&&(s.error?l(Qa(s.error)):l(null,Qa(s.data)))}else{const l=new Set,h=s.hasCallback?(g,x)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:g?Ka(g):null,data:Ka(x,l)},l)}:()=>{},p=Qa(s.data);if(this.parent[s.type])this.parent[s.type](s.sourceMapId,p,h);else if(this.parent.getWorkerSource){const g=s.type.split("."),{source:x,scope:w}=p;this.parent.getWorkerSource(s.sourceMapId,g[0],x,w)[g[1]](p,h)}else h(new Error(`Could not find function ${s.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var pf={workerUrl:"",workerClass:null,workerParams:void 0};const __="mapboxgl_preloaded_worker_pool";class Bc{constructor(){this.active={}}acquire(e,s=Bc.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<s;)this.workers.push(pf.workerClass!=null?new pf.workerClass:new self.Worker(pf.workerUrl,pf.workerParams));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(s=>{s.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[__]}numActive(){return Object.keys(this.active).length}}Bc.workerCount=2;class gu{constructor(e,s,l="Worker",h=Bc.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=lt();const p=this.workerPool.acquire(this.id,h);for(let g=0;g<p.length;g++){const x=new gu.Actor(p[g],s,this.id);x.name=`${l} ${g}`,this.actors.push(x)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,s,l){Ze(this.actors,(h,p)=>{h.send(e,s,p)},l=l||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}let gf,y_;function gg(){return gf||(gf=new Bc),gf}gu.Actor=Cv;class LS{constructor(e){this.module=e}createIntArray(e){const s=new Int32Array(e),l=this.module.malloc(s.length*s.BYTES_PER_ELEMENT);return this.module.heap32.set(s,l/s.BYTES_PER_ELEMENT),l}createFloatArray(e){const s=new Float32Array(e),l=this.module.malloc(s.length*s.BYTES_PER_ELEMENT);return this.module.heapF32.set(s,l/s.BYTES_PER_ELEMENT),l}createStringBuffer(e){const s=this.module.malloc(e.length+1);for(let l=0;l<e.length;++l)this.module.heapU8[s+l]=e.charCodeAt(l);return this.module.heapU8[s+e.length]=0,s}readStringBuffer(e){let s="";for(;this.module.heapU8[e]!==0;)s+=String.fromCharCode(this.module.heapU8[e]),++e;return s}setStyle(e){const s=e.entranceColorRgb,l=e.facadeGlazingColorRgb,h=e.roofColorRgb,p=e.wallColorRgb,g=e.normalScale;this.module.setStyle(s[0],s[1],s[2],l[0],l[1],l[2],h[0],h[1],h[2],p[0],p[1],p[2],g[0],g[1],g[2],e.tileToMeters)}setAOOptions(e,s){this.module.setAOOptions(e?1:0,s)}setMetricOptions(e,s){this.module.setMetricOptions(e?1:0,s)}setStructuralOptions(e){this.module.setStructuralOptions(e?1:0)}setFacadeOptions(e,s){this.module.setFacadeOptions(e,s?1:0)}setFauxFacadeOptions(e,s,l){this.module.setFauxFacadeOptions(e?1:0,s?1:0,l)}setFacadeClassifierOptions(e){this.module.setFacadeClassifierOptions(e)}generateMesh(e,s){for(const x of e){const w=this.createStringBuffer(x.roofType),T=[0],I=[];for(const B of x.coordinates)if(Array.isArray(B)){for(const V of B)I.push(V.x),I.push(V.y);T.push(I.length)}const M=this.createIntArray(T),R=this.createFloatArray(I);this.module.addFeature(x.id,x.sourceId,x.minHeight,x.height,w,x.roofType.length,R,M,T.length-1),this.module.free(w),this.module.free(M),this.module.free(R)}for(const x of s){let w;w=x.entrances?JSON.parse(x.entrances):[];const T=this.createFloatArray(w),I=[];for(const R of x.coordinates)I.push(R.x),I.push(R.y);const M=this.createFloatArray(I);this.module.addFacade(x.sourceId,x.crossPerc,x.distanceToRoad,T,w.length,M,I.length),this.module.free(T),this.module.free(M)}if(!this.module.generateMesh()){const x=this.module.getLastError();return this.readStringBuffer(x)}const l=this.module.getMeshCount(),h=new Array(l);for(let x=0;x<l;x++){const w=this.module.getPositionsPtr(x),T=this.module.getPositionsLength(x),I=new Float32Array(this.module.heapF32.buffer,w,T),M=this.module.getNormalsPtr(x),R=this.module.getNormalsLength(x),B=new Float32Array(this.module.heapF32.buffer,M,R),V=this.module.getColorsPtr(x),q=this.module.getColorsLength(x),Z=new Uint8Array(this.module.heapU8.buffer,V,q),$=this.module.getAOPtr(x),ne=this.module.getAOLength(x),ae=new Float32Array(this.module.heapF32.buffer,$,ne),le=this.module.getUVPtr(x),be=this.module.getUVLength(x),we=new Float32Array(this.module.heapF32.buffer,le,be),ke=this.module.getFauxFacadePtr(x),Le=this.module.getFauxFacadeLength(x),ze=new Uint8Array(this.module.heapU8.buffer,ke,Le),rt=this.module.getIndicesPtr(x),Be=this.module.getIndicesLength(x),st=new Int32Array(this.module.heap32.buffer,rt,Be),ut=this.module.getBuildingPart(x),nt=this.readStringBuffer(ut);h[x]={positions:I,normals:B,colors:Z,ao:ae,uv:we,isFauxFacade:ze,indices:st,buildingPart:nt}}const p=this.module.getRingCount(),g=[];for(let x=0;x<p;x++){const w=this.module.getRingPtr(x),T=this.module.getRingLength(x),I=new Float32Array(this.module.heapF32.buffer,w,T);g.push(I)}return{meshes:h,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:g}}}let mf,x_,ka,mu,v_,_u=null,yu=null,Iv=null,mg=null;function kv(){return dr(self)&&self.worker.dracoUrl?self.worker.dracoUrl:x_||Fs.DRACO_URL}function Mv(){if(dr(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(mu)return mu;const n=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return mu=WebAssembly.validate(n)?Fs.MESHOPT_SIMD_URL:Fs.MESHOPT_URL,mu}function zS(){return mg}const _g={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},RS={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},_f={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function Pv(n,e,s){const l=s.json.bufferViews.length,h=s.buffers.length;e.bufferView=l,s.json.bufferViews[l]={buffer:h,byteLength:n.byteLength},s.buffers[h]=n}const b_="KHR_draco_mesh_compression";function DS(n,e){const s=n.extensions&&n.extensions[b_];if(!s)return;const l=new ka.Decoder,h=Dv(e,s.bufferView),p=new ka.Mesh;if(!l.DecodeArrayToMesh(h,h.byteLength,p))throw new Error("Failed to decode Draco mesh");const g=e.json.accessors[n.indices],x=_g[g.componentType],w=g.count*x.BYTES_PER_ELEMENT,T=ka._malloc(w);x===Uint16Array?l.GetTrianglesUInt16Array(p,w,T):l.GetTrianglesUInt32Array(p,w,T),Pv(ka.memory.buffer.slice(T,T+w),g,e),ka._free(T);for(const I of Object.keys(s.attributes)){const M=l.GetAttributeByUniqueId(p,s.attributes[I]),R=e.json.accessors[n.attributes[I]],B=RS[R.componentType],V=R.count*_f[R.type]*_g[R.componentType].BYTES_PER_ELEMENT,q=ka._malloc(V);l.GetAttributeDataArrayForAllPoints(p,M,ka[B],V,q),Pv(ka.memory.buffer.slice(q,q+V),R,e),ka._free(q)}l.destroy(),p.destroy(),delete n.extensions[b_]}const yg="EXT_meshopt_compression";function OS(n,e){if(!n.extensions||!n.extensions[yg])return;const s=n.extensions[yg],l=new Uint8Array(e.buffers[s.buffer],s.byteOffset||0,s.byteLength||0),h=new Uint8Array(s.count*s.byteStride);v_.decodeGltfBuffer(h,s.count,s.byteStride,l,s.mode,s.filter),n.buffer=e.buffers.length,n.byteOffset=0,e.buffers[n.buffer]=h.buffer,delete n.extensions[yg]}const Lv=1179937895,zv=new TextDecoder("utf8");function Rv(n,e){return new URL(n,e).href}function FS(n,e,s,l){return fetch(Rv(n.uri,l)).then(h=>h.arrayBuffer()).then(h=>{e.buffers[s]=h})}function Dv(n,e){const s=n.json.bufferViews[e];return new Uint8Array(n.buffers[s.buffer],s.byteOffset||0,s.byteLength)}function BS(n,e,s,l){if(n.uri){const h=Rv(n.uri,l);return fetch(h).then(p=>p.blob()).then(p=>createImageBitmap(p)).then(p=>{e.images[s]=p})}if(n.bufferView!==void 0){const h=Dv(e,n.bufferView),p=new Blob([h],{type:n.mimeType});return createImageBitmap(p).then(g=>{e.images[s]=g})}}function Ov(n,e=0,s){const l={json:null,images:[],buffers:[]};if(new Uint32Array(n,e,1)[0]===Lv){const I=new Uint32Array(n,e);let M=2;const R=(I[M++]>>2)-3,B=I[M++]>>2;if(M++,l.json=JSON.parse(zv.decode(I.subarray(M,M+B))),M+=B,M<R){const V=I[M++];M++;const q=e+(M<<2);l.buffers[0]=n.slice(q,q+V)}}else l.json=JSON.parse(zv.decode(new Uint8Array(n,e)));const{buffers:h,images:p,meshes:g,extensionsUsed:x,bufferViews:w}=l.json;let T=Promise.resolve();if(h){const I=[];for(let M=0;M<h.length;M++){const R=h[M];R.uri?I.push(FS(R,l,M,s)):l.buffers[M]||(l.buffers[M]=null)}T=Promise.all(I)}return T.then(()=>{const I=[],M=x&&x.includes(b_),R=x&&x.includes(yg);if(M&&I.push(function(){if(!ka)return mf!=null?mf:(mf=function(B){let V,q=null;function Z(){V=new Uint8Array(q.buffer)}function $(){throw new Error("Unexpected Draco error.")}const ne={a:{a:$,d:function(ae,le,be){return V.copyWithin(ae,le,le+be)},c:function(ae){const le=V.length,be=Math.max(ae>>>0,Math.ceil(1.2*le)),we=Math.ceil((be-le)/65536);try{return q.grow(we),Z(),!0}catch{return!1}},b:$}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(B,ne):B.then(ae=>ae.arrayBuffer()).then(ae=>WebAssembly.instantiate(ae,ne))).then(ae=>{const{Rb:le,Qb:be,P:we,T:ke,X:Le,Ja:ze,La:rt,Qa:Be,Va:st,Wa:ut,eb:nt,jb:ot,f:gt,e:tt,yb:ct,zb:Xe,Ab:He,Bb:_t,Db:dt,Gb:Yt}=ae.instance.exports;q=tt;const zt=(()=>{let Bt=0,St=0,Gt=0,li=0;return kt=>{Gt&&(le(li),le(Bt),St+=Gt,Gt=Bt=0),Bt||(St+=128,Bt=be(St));const jt=kt.length+7&-8;let ti=Bt;jt>=St&&(Gt=jt,ti=li=be(jt));for(let di=0;di<kt.length;di++)V[ti+di]=kt[di];return ti}})();return Z(),gt(),{memory:tt,_free:le,_malloc:be,Mesh:class{constructor(){this.ptr=we()}destroy(){ke(this.ptr)}},Decoder:class{constructor(){this.ptr=ze()}destroy(){ot(this.ptr)}DecodeArrayToMesh(Bt,St,Gt){const li=zt(Bt),kt=rt(this.ptr,li,St,Gt.ptr);return!!Le(kt)}GetAttributeByUniqueId(Bt,St){return{ptr:Be(this.ptr,Bt.ptr,St)}}GetTrianglesUInt16Array(Bt,St,Gt){st(this.ptr,Bt.ptr,St,Gt)}GetTrianglesUInt32Array(Bt,St,Gt){ut(this.ptr,Bt.ptr,St,Gt)}GetAttributeDataArrayForAllPoints(Bt,St,Gt,li,kt){nt(this.ptr,Bt.ptr,St.ptr,Gt,li,kt)}},DT_INT8:ct(),DT_UINT8:Xe(),DT_INT16:He(),DT_UINT16:_t(),DT_UINT32:dt(),DT_FLOAT32:Yt()}})}(fetch(kv())),mf.then(B=>{ka=B,mf=void 0}))}()),R&&I.push(function(){if(v_)return;const B=function(V){let q;const Z=WebAssembly.instantiateStreaming(V,{}).then(ae=>{q=ae.instance,q.exports.__wasm_call_ctors()}),$={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},ne={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:Z,supported:!0,decodeGltfBuffer(ae,le,be,we,ke,Le){(function(ze,rt,Be,st,ut,nt,ot){const gt=ze.exports.sbrk,tt=st+3&-4,ct=gt(tt*ut),Xe=gt(nt.length),He=new Uint8Array(ze.exports.memory.buffer);He.set(nt,Xe);const _t=rt(ct,st,ut,Xe,nt.length);if(_t===0&&ot&&ot(ct,tt,ut),Be.set(He.subarray(ct,ct+st*ut)),gt(ct-gt(0)),_t!==0)throw new Error(`Malformed buffer data: ${_t}`)})(q,q.exports[ne[ke]],ae,le,be,we,q.exports[$[Le]])}}}(fetch(Mv()));return B.ready.then(()=>{v_=B})}()),p)for(let B=0;B<p.length;B++)I.push(BS(p[B],l,B,s));return(I.length?Promise.all(I):Promise.resolve()).then(()=>{if(M&&g)for(const{primitives:B}of g)for(const V of B)DS(V,l);if(R&&g&&w)for(const B of w)OS(B,l);return l})})}function w_(n){switch(n){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function S_(n){switch(n){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class A_{constructor(e,s,l,h){this.context=e,this.format=l,this.useMipmap=h&&h.useMipmap,this.texture=e.gl.createTexture(),this.update(s,{premultiply:h&&h.premultiply})}update(e,s){const l=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,h=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:p}=this,{gl:g}=p,{x,y:w}=s&&s.position?s.position:{x:0,y:0},T=x+l,I=w+h;!this.size||this.size[0]===T&&this.size[1]===I||(g.bindTexture(g.TEXTURE_2D,null),g.deleteTexture(this.texture),this.texture=g.createTexture(),this.size=null),g.bindTexture(g.TEXTURE_2D,this.texture),p.pixelStoreUnpackFlipY.set(!1),p.pixelStoreUnpack.set(1),p.pixelStoreUnpackPremultiplyAlpha.set(this.format===g.RGBA8&&(!s||s.premultiply!==!1));const M=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&T>0&&I>0){const R=this.useMipmap?Math.floor(Math.log2(Math.max(T,I)))+1:1;g.texStorage2D(g.TEXTURE_2D,R,this.format,T,I),this.size=[T,I]}this.size&&(M?g.texSubImage2D(g.TEXTURE_2D,0,x,w,w_(this.format),S_(this.format),e):"data"in e&&e.data&&g.texSubImage2D(g.TEXTURE_2D,0,x,w,l,h,w_(this.format),S_(this.format),e.data)),this.useMipmap&&g.generateMipmap(g.TEXTURE_2D)}bind(e,s,l=!1){const{context:h}=this,{gl:p}=h;p.bindTexture(p.TEXTURE_2D,this.texture),e!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,e),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap&&!l?e===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),s!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,s),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,s),this.wrapS=s)}bindExtraParam(e,s,l,h,p){const{context:g}=this,{gl:x}=g;x.bindTexture(x.TEXTURE_2D,this.texture),s!==this.magFilter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,s),this.magFilter=s),e!==this.minFilter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,this.useMipmap?e===x.NEAREST?x.NEAREST_MIPMAP_NEAREST:x.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),l!==this.wrapS&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,l),this.wrapS=l),h!==this.wrapT&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,h),this.wrapT=h),p!==this.compareMode&&(p?(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_COMPARE_MODE,x.COMPARE_REF_TO_TEXTURE),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_COMPARE_FUNC,p)):x.texParameteri(x.TEXTURE_2D,x.TEXTURE_COMPARE_MODE,x.NONE),this.compareMode=p)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class yf{constructor(e,s){this.context=e,this.texture=s}bind(e,s){const{context:l}=this,{gl:h}=l;h.bindTexture(h.TEXTURE_2D,this.texture),e!==this.minFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,e),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,e),this.minFilter=e),s!==this.wrapS&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,s),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,s),this.wrapS=s)}}const NS=Fi([{name:"a_pos_3f",components:3,type:"Float32"}]),VS=Fi([{name:"a_color_3f",components:3,type:"Float32"}]),US=Fi([{name:"a_color_4f",components:4,type:"Float32"}]),jS=Fi([{name:"a_uv_2f",components:2,type:"Float32"}]),HS=Fi([{name:"a_normal_3f",components:3,type:"Float32"}]),WS=Fi([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),GS=Fi([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function Fv(n,e){const s=xg(n.projection,n.zoom,n.width,n.height),l=function(p,g,x,w,T){const I=new Y(x.lng-180*Ll,x.lat),M=new Y(x.lng+180*Ll,x.lat),R=p.project(I.lng,I.lat),B=p.project(M.lng,M.lat),V=-Math.atan2(B.y-R.y,B.x-R.x),q=$e.fromLngLat(x);q.y=Ee(q.y,-1+Ll,1-Ll);const Z=q.toLngLat(),$=p.project(Z.lng,Z.lat),ne=$e.fromLngLat(Z);ne.x+=Ll;const ae=ne.toLngLat(),le=p.project(ae.lng,ae.lat),be=Nv(le.x-$.x,le.y-$.y,V),we=$e.fromLngLat(Z);we.y+=Ll;const ke=we.toLngLat(),Le=p.project(ke.lng,ke.lat),ze=Nv(Le.x-$.x,Le.y-$.y,V),rt=Math.abs(be.x)/Math.abs(ze.y),Be=H([]);Te(Be,Be,-V*(1-(T?0:w)));const st=H([]);return ue(st,st,[1,1-(1-rt)*w,1]),st[4]=-ze.x/ze.y*w,Te(st,st,V),ee(st,Be,st),st}(n.projection,0,n.center,s,e),h=Bv(n);return ue(l,l,[h,h,1]),l}function Bv(n){const e=n.projection,s=xg(n.projection,n.zoom,n.width,n.height),l=T_(e,n.center),h=T_(e,Y.convert(e.center));return Math.pow(2,l*s+(1-s)*h)}function xg(n,e,s,l,h=1/0){const p=n.range;if(!p)return 0;const g=Math.min(h,Math.max(s,l)),x=Math.log2(g/1024);return Ye(p[0]+x,p[1]+x,e)}const Ll=1/4e4;function T_(n,e){const s=Ee(e.lat,-85.051129,Ae),l=new Y(e.lng-180*Ll,s),h=new Y(e.lng+180*Ll,s),p=n.project(l.lng,s),g=n.project(h.lng,s),x=$e.fromLngLat(l),w=$e.fromLngLat(h),T=g.x-p.x,I=g.y-p.y,M=w.x-x.x,R=w.y-x.y,B=Math.sqrt((M*M+R*R)/(T*T+I*I));return Math.log2(B)}function Nv(n,e,s){const l=Math.cos(s),h=Math.sin(s);return{x:n*l-e*h,y:n*h+e*l}}function Vv(n,e,s){H(n),Te(n,n,Oe(e[2])),ve(n,n,Oe(e[0])),ce(n,n,Oe(e[1])),ue(n,n,s),ee(n,n,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function vg(n,e,s,l,h,p,g,x){const w=[s[0]-e[0],s[1]-e[1],0],T=[l[0]-e[0],l[1]-e[1],0];if(bt(w)<1e-12||bt(T)<1e-12)return ga(n);const I=zi([],w,T);mi(I,I),qt(T,l,e),w[2]=(p-h)*x,T[2]=(g-h)*x;const M=w;return zi(M,w,T),mi(M,M),Yo(n,I,M)}function E_(n,e,s=!1){const l=kl(e.zoom),h=function(p,g,x){const w=g.worldSize,T=[p[12],p[13],p[14]],I=_e(T[1]/w),M=xe(T[0]/w),R=H([]),B=me(1,I)*w,V=me(1,0)*w*Re(I,g.zoom),q=1/e_(w);let Z=V*q;if(x){const le=xg(g.projection,g.zoom,g.width,g.height,1024);Z=q*g.projection.pixelSpaceConversion(g.center.lat,w,le)}const $=F(I,M);Lt($,$,Kt([],mi([],$),B*Z*T[2]));const ne=function(le){const be=[le[0],le[1],le[2]];let we=[0,1,0];const ke=zi([],we,be);return zi(we,be,ke),ar(we)===0&&(we=[0,1,0],zi(ke,be,we)),mi(ke,ke),mi(we,we),mi(be,be),[ke[0],ke[1],ke[2],0,we[0],we[1],we[2],0,be[0],be[1],be[2],0,le[0],le[1],le[2],1]}($);ue(R,R,[Z,Z,Z*B]),ie(R,R,[-T[0],-T[1],-T[2]]);const ae=ee([],g.globeMatrix,ne);return ee(ae,ae,R),ee(ae,ae,p),ae}(n,e,s);if(l>0){const p=function(g,x){const w=x.worldSize,T=me(1,0)*w*Re(x.center.lat,x.zoom)/e_(w),I=me(1,x.center.lat)*w,M=H([]);ce(M,M,Oe(x.center.lng)),ve(M,M,Oe(x.center.lat)),ie(M,M,[0,0,u]),ue(M,M,[T,T,T*I]);const R=x.point;return ie(M,M,[-R.x,-R.y,0]),ee(M,M,g),ee(M,x.globeMatrix,M)}(n,e);return function(g,x,w){const T=(V,q,Z)=>{const $=bt(V),ne=bt(q),ae=jo(V,q,Z);return Kt(ae,ae,1/bt(ae)*ei($,ne,Z))},I=T([g[0],g[1],g[2]],[x[0],x[1],x[2]],w),M=T([g[4],g[5],g[6]],[x[4],x[5],x[6]],w),R=T([g[8],g[9],g[10]],[x[8],x[9],x[10]],w),B=jo([g[12],g[13],g[14]],[x[12],x[13],x[14]],w);return[I[0],I[1],I[2],0,M[0],M[1],M[2],0,R[0],R[1],R[2],0,B[0],B[1],B[2],1]}(h,p,l)}return h}function Uv(n,e,s,l){const h=ri.projectAabbCorners(l,s);let p=Number.MAX_VALUE,g=-1;for(let T=0;T<h.length;++T){const I=h[T];I[0]=(.5*I[0]+.5)*e.width,I[1]=(.5-.5*I[1])*e.height,I[2]<p&&(g=T,p=I[2])}const x=T=>new mt(h[T][0],h[T][1]);let w;switch(g){case 0:case 6:w=[x(1),x(5),x(4),x(7),x(3),x(2),x(1)];break;case 1:case 7:w=[x(0),x(4),x(5),x(6),x(2),x(3),x(0)];break;case 3:case 5:w=[x(1),x(0),x(4),x(7),x(6),x(2),x(1)];break;default:w=[x(1),x(5),x(6),x(7),x(3),x(0),x(1)]}if(Sn(n,w))return p}const Nc=64,xu={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function jv(n,e,s,l,h,p,g,x,w,T=!1){const I=s.zoom,M=s.project(l),R=Re(l.lat,I),B=1/R;H(n),ie(n,n,[M.x+g[0]*B,M.y+g[1]*B,g[2]]);let V=1,q=1;const Z=s.worldSize;if(T){if(s.projection.name==="mercator"){let le=0;s.elevation&&(le=s.elevation.getAtPointOrZero(new $e(M.x/Z,M.y/Z),0));const be=an([],[M.x,M.y,le,1],s.projMatrix)[3]/s.cameraToCenterDistance;V=be,q=be*Re(s.center.lat,I)}else if(s.projection.name==="globe"){const le=E_(n,s),be=[0,0,0,1];an(be,be,ee([],s.projMatrix,le));const we=be[3]/s.cameraToCenterDistance,ke=kl(I),Le=s.projection.pixelsPerMeter(l.lat,Z)*Re(l.lat,I),ze=s.projection.pixelsPerMeter(s.center.lat,Z)*Re(s.center.lat,I);V=we/ei(Le,je(s.center.lat),ke),q=we*R/Le,V*=ze,q*=ze}}else V=B;ue(n,n,[V,V,q]);const $=[...n],ne=e.orientation,ae=[];if(Vv(ae,[ne[0]+h[0],ne[1]+h[1],ne[2]+h[2]],p),ee(n,$,ae),x&&s.elevation){let le=0;const be=[];if(w&&s.elevation){le=function(ke,Le,ze,rt,Be){const st=Le.elevation;if(!st)return 0;const ut=ri.projectAabbCorners(ze,rt),nt=me(1,Be.lat)*Le.worldSize,ot=function(St,Gt){const li=[0,0,1],kt=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const jt of kt){const ti=St[jt.corners[0]],di=St[jt.corners[1]],Ii=St[jt.corners[2]],_i=[di[0]-ti[0],di[1]-ti[1],Gt*(di[2]-ti[2])],Ft=zi(_i,_i,[Ii[0]-ti[0],Ii[1]-ti[1],Gt*(Ii[2]-ti[2])]);mi(Ft,Ft),jt.dotProductWithUp=Ci(Ft,li)}return kt.sort((jt,ti)=>jt.dotProductWithUp-ti.dotProductWithUp),kt[0].corners}(ut,nt),gt=ut[ot[0]],tt=ut[ot[1]],ct=ut[ot[2]],Xe=ut[ot[3]],He=st.getAtPointOrZero(new $e(gt[0]/Le.worldSize,gt[1]/Le.worldSize),0),_t=st.getAtPointOrZero(new $e(tt[0]/Le.worldSize,tt[1]/Le.worldSize),0),dt=st.getAtPointOrZero(new $e(ct[0]/Le.worldSize,ct[1]/Le.worldSize),0),Yt=st.getAtPointOrZero(new $e(Xe[0]/Le.worldSize,Xe[1]/Le.worldSize),0),zt=(He+Yt)/2,Bt=(_t+dt)/2;return zt>Bt?_t<dt?vg(ke,tt,Xe,gt,_t,Yt,He,nt):vg(ke,ct,gt,Xe,dt,He,Yt,nt):He<Yt?vg(ke,gt,tt,ct,He,_t,dt,nt):vg(ke,Xe,ct,tt,Yt,dt,_t,nt),Math.max(zt,Bt)}(be,s,e.aabb,n,l);const we=ee([],Ue([],be),ae);ee(n,$,we)}else le=s.elevation.getAtPointOrZero(new $e(M.x/Z,M.y/Z),0);le!==0&&(n[14]+=le)}}function xf(n,e,s=!1){n.uploaded||(n.gfxTexture=new A_(e,n.image,s?e.gl.R8:e.gl.RGBA8,{useMipmap:n.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),n.uploaded=!0,n.image=null)}function XS(n,e,s){n.indexBuffer=e.createIndexBuffer(n.indexArray,!1,!0),n.vertexBuffer=e.createVertexBuffer(n.vertexArray,NS.members,!1,!0),n.normalArray&&(n.normalBuffer=e.createVertexBuffer(n.normalArray,HS.members,!1,!0)),n.texcoordArray&&(n.texcoordBuffer=e.createVertexBuffer(n.texcoordArray,jS.members,!1,!0)),n.colorArray&&(n.colorBuffer=e.createVertexBuffer(n.colorArray,(n.colorArray.bytesPerElement===12?VS:US).members,!1,!0)),n.featureArray&&(n.pbrBuffer=e.createVertexBuffer(n.featureArray,GS.members,!0)),n.segments=zr.simpleSegment(0,0,n.vertexArray.length,n.indexArray.length);const l=n.material;l.pbrMetallicRoughness.baseColorTexture&&xf(l.pbrMetallicRoughness.baseColorTexture,e),l.pbrMetallicRoughness.metallicRoughnessTexture&&xf(l.pbrMetallicRoughness.metallicRoughnessTexture,e),l.normalTexture&&xf(l.normalTexture,e),l.occlusionTexture&&xf(l.occlusionTexture,e,s),l.emissionTexture&&xf(l.emissionTexture,e)}function C_(n,e,s){if(n.meshes)for(const l of n.meshes)XS(l,e,s);if(n.children)for(const l of n.children)C_(l,e,s)}function bg(n){if(n.meshes)for(const e of n.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(n.children)for(const e of n.children)bg(e)}function I_(n){if(n.meshes)for(const s of n.meshes)s.vertexBuffer&&(s.vertexBuffer.destroy(),s.indexBuffer.destroy(),s.normalBuffer&&s.normalBuffer.destroy(),s.texcoordBuffer&&s.texcoordBuffer.destroy(),s.colorBuffer&&s.colorBuffer.destroy(),s.pbrBuffer&&s.pbrBuffer.destroy(),s.segments.destroy(),s.material&&((e=s.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(n.children)for(const s of n.children)I_(s)}function Vc(n,e){const s=n.json.bufferViews[e.bufferView],l=_g[e.componentType];return new l(n.buffers[s.buffer],(e.byteOffset||0)+(s.byteOffset||0),e.count*(s.byteStride&&s.byteStride!==_f[e.type]*l.BYTES_PER_ELEMENT?s.byteStride/l.BYTES_PER_ELEMENT:_f[e.type]))}function k_(n,e,s,l){const h=_g[e.componentType],p=function(I){switch(I){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(h),g=n.json.bufferViews[e.bufferView],x=g.byteStride?g.byteStride/h.BYTES_PER_ELEMENT:_f[e.type],w=s.float32,T=w.length/s.capacity;for(let I=0,M=0;I<e.count*x;I+=x,M+=T)for(let R=0;R<T;R++)w[M+R]=l[I+R]*p;s._trim()}function YS(n,e,s){const l=n.indices,h=n.attributes,p={};p.indexArray=new gs;const g=e.json.accessors[l],x=g.count/3;p.indexArray.reserve(x);const w=Vc(e,g);for(let R=0;R<x;R++)p.indexArray.emplaceBack(w[3*R],w[3*R+1],w[3*R+2]);p.indexArray._trim(),p.vertexArray=new en;const T=e.json.accessors[h.POSITION];p.vertexArray.reserve(T.count);const I=Vc(e,T);for(let R=0;R<T.count;R++)p.vertexArray.emplaceBack(I[3*R],I[3*R+1],I[3*R+2]);if(p.vertexArray._trim(),p.aabb=new ri(T.min,T.max),p.centroid=function(R,B){const V=[0,0,0],q=R.length;if(q>0){for(let Z=0;Z<q;Z++){const $=3*R[Z];V[0]+=B[$],V[1]+=B[$+1],V[2]+=B[$+2]}V[0]/=q,V[1]/=q,V[2]/=q}return V}(w,I),h.COLOR_0!==void 0){const R=e.json.accessors[h.COLOR_0],B=_f[R.type],V=Vc(e,R);p.colorArray=B===3?new en:new Wn,p.colorArray.resize(R.count),k_(e,R,p.colorArray,V)}if(h.NORMAL!==void 0){p.normalArray=new en;const R=e.json.accessors[h.NORMAL];p.normalArray.resize(R.count);const B=Vc(e,R);k_(e,R,p.normalArray,B)}if(h.TEXCOORD_0!==void 0&&s.length>0){p.texcoordArray=new Tl;const R=e.json.accessors[h.TEXCOORD_0];p.texcoordArray.resize(R.count);const B=Vc(e,R);k_(e,R,p.texcoordArray,B)}if(h._FEATURE_ID_RGBA4444!==void 0){const R=e.json.accessors[h._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(p.featureData=Vc(e,R))}h._FEATURE_RGBA4444!==void 0&&(p.featureData=new Uint32Array(Vc(e,e.json.accessors[h._FEATURE_RGBA4444]).buffer));const M=n.material;return p.material=function(R,B){const{emissiveFactor:V=[0,0,0],alphaMode:q="OPAQUE",alphaCutoff:Z=.5,normalTexture:$,occlusionTexture:ne,emissiveTexture:ae,doubleSided:le}=R,{baseColorFactor:be=[1,1,1,1],metallicFactor:we=1,roughnessFactor:ke=1,baseColorTexture:Le,metallicRoughnessTexture:ze}=R.pbrMetallicRoughness||{},rt=ne?B[ne.index]:void 0;if(ne&&ne.extensions&&ne.extensions.KHR_texture_transform&&rt){const Be=ne.extensions.KHR_texture_transform;rt.offsetScale=[Be.offset[0],Be.offset[1],Be.scale[0],Be.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new er(...be),metallicFactor:we,roughnessFactor:ke,baseColorTexture:Le?B[Le.index]:void 0,metallicRoughnessTexture:ze?B[ze.index]:void 0},doubleSided:le,emissiveFactor:new er(...V),alphaMode:q,alphaCutoff:Z,normalTexture:$?B[$.index]:void 0,occlusionTexture:rt,emissionTexture:ae?B[ae.index]:void 0,defined:R.defined===void 0}}(M!==void 0?e.json.materials[M]:{defined:!1},s),p}function Hv(n,e,s){const{matrix:l,rotation:h,translation:p,scale:g,mesh:x,extras:w,children:T}=n,I={};if(I.matrix=l||function(M,R,B,V){var q=R[0],Z=R[1],$=R[2],ne=R[3],ae=q+q,le=Z+Z,be=$+$,we=q*ae,ke=q*le,Le=q*be,ze=Z*le,rt=Z*be,Be=$*be,st=ne*ae,ut=ne*le,nt=ne*be,ot=V[0],gt=V[1],tt=V[2];return M[0]=(1-(ze+Be))*ot,M[1]=(ke+nt)*ot,M[2]=(Le-ut)*ot,M[3]=0,M[4]=(ke-nt)*gt,M[5]=(1-(we+Be))*gt,M[6]=(rt+st)*gt,M[7]=0,M[8]=(Le+ut)*tt,M[9]=(rt-st)*tt,M[10]=(1-(we+ze))*tt,M[11]=0,M[12]=B[0],M[13]=B[1],M[14]=B[2],M[15]=1,M}([],h||[0,0,0,1],p||[0,0,0],g||[1,1,1]),x!==void 0){I.meshes=s[x];const M=I.anchor=[0,0];for(const R of I.meshes){const{min:B,max:V}=R.aabb;M[0]+=B[0]+V[0],M[1]+=B[1]+V[1]}M[0]=Math.floor(M[0]/I.meshes.length/2),M[1]=Math.floor(M[1]/I.meshes.length/2)}if(w&&(w.id&&(I.id=w.id),w.lights&&(I.lights=function(M){if(!M.length)return[];const R=function($){const ne=atob($),ae=new Uint8Array(ne.length);for(let le=0;le<ne.length;le++)ae[le]=ne.codePointAt(le);return ae}(M),B=[],V=R.length/24,q=new Uint16Array(R.buffer),Z=new Float32Array(R.buffer);for(let $=0;$<V;$++){const ne=q[2*$*6]/30,ae=q[2*$*6+1]/30,le=q[2*$*6+10]/100,be=Z[6*$+1],we=Z[6*$+2],ke=Z[6*$+3],Le=Z[6*$+4],ze=ke-be,rt=Le-we,Be=Math.hypot(ze,rt);B.push({pos:[be+.5*ze,we+.5*rt,ae],normal:[rt/Be,-ze/Be,0],width:Be,height:ne,depth:le,points:[be,we,ke,Le]})}return B}(w.lights))),T){const M=[];for(const R of T)M.push(Hv(e.json.nodes[R],e,s));I.children=M}return I}function qS(n){if(n.vertices.length===0||n.indices.length===0)return null;const e=new cg(n.vertices,n.indices,8,256),[s,l]=[e.min.clone(),e.max.clone()];return{vertices:n.vertices,indices:n.indices,grid:e,min:s,max:l}}function ZS(n){if(!n.extras||!n.extras.ground)return null;const e=n.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const s=e[0];if(!s||!Array.isArray(s)||s.length===0)return null;const l=[];for(const g of s){if(!Array.isArray(g)||g.length!==2)continue;const x=g[0],w=g[1];typeof x=="number"&&typeof w=="number"&&l.push(new mt(x,w))}if(l.length<3)return null;l.length>1&&l[l.length-1].equals(l[0])&&l.pop();let h=0;for(let g=0;g<l.length;g++){const x=l[g],w=l[(g+1)%l.length],T=l[(g+2)%l.length];h+=(x.x-w.x)*(T.y-w.y)-(T.x-w.x)*(x.y-w.y)}h>0&&l.reverse();const p=fu(l.flatMap(g=>[g.x,g.y]),[]);return p.length===0?null:{vertices:l,indices:p}}function $S(n,e){const s=[],l=[];let h=0;const p=[];for(const g of n){h=s.length;const x=g.vertexArray.float32,w=g.indexArray.uint16;for(let T=0;T<g.vertexArray.length;T++)p[0]=x[3*T+0],p[1]=x[3*T+1],p[2]=x[3*T+2],Wi(p,p,e),s.push(new mt(p[0],p[1]));for(let T=0;T<3*g.indexArray.length;T++)l.push(w[T]+h)}if(l.length%3!=0)return null;for(let g=0;g<l.length;g+=3){const x=s[l[g+0]],w=s[l[g+1]],T=s[l[g+2]];(x.x-w.x)*(T.y-w.y)-(T.x-w.x)*(x.y-w.y)>0&&([l[g+1],l[g+2]]=[l[g+2],l[g+1]])}return{vertices:s,indices:l}}function Wv(n){const e=function(w,T){const I=[],M=WebGL2RenderingContext;if(w.json.textures)for(const R of w.json.textures){const B={magFilter:M.LINEAR,minFilter:M.NEAREST,wrapS:M.REPEAT,wrapT:M.REPEAT};R.sampler!==void 0&&Object.assign(B,w.json.samplers[R.sampler]),I.push({image:T[R.source],sampler:B,uploaded:!1})}return I}(n,n.images),s=function(w,T){const I=[];for(const M of w.json.meshes){const R=[];for(const B of M.primitives)R.push(YS(B,w,T));I.push(R)}return I}(n,e),{scenes:l,scene:h,nodes:p}=n.json,g=l?l[h||0].nodes:[...p.keys()],x=[];for(const w of g)x.push(Hv(p[w],n,s));return function(w,T,I){const M={},R=new Set;for(let B=0;B<w.length;B++){const V=I[T[B]];if(!V.extras)continue;const q=V.extras["mapbox:footprint:version"],Z=V.extras["mapbox:footprint:id"];(q||Z)&&R.add(B),q==="1.0.0"&&Z&&(M[Z]=B)}for(let B=0;B<w.length;B++){if(R.has(B))continue;const V=w[B],q=I[T[B]];if(!q.extras)continue;let Z=null;V.id in M&&(Z=$S(w[M[V.id]].meshes,V.matrix)),Z||(Z=ZS(q)),Z&&(V.footprint=qS(Z))}if(R.size>0){const B=Array.from(R.values()).sort((V,q)=>V-q);for(let V=B.length-1;V>=0;V--)w.splice(B[V],1)}}(x,g,n.json.nodes),x}function JS(n){n.heightmap=new Float32Array(4096),n.heightmap.fill(-1);const e=n.vertexArray.float32,s=n.aabb.min[0]-1,l=n.aabb.min[1]-1,h=Nc/(n.aabb.max[0]-s+2),p=Nc/(n.aabb.max[1]-l+2);for(let g=0;g<e.length;g+=3){const x=e[g+2],w=(e[g+0]-s)*h|0,T=(e[g+1]-l)*p|0;x>n.heightmap[T*Nc+w]&&(n.heightmap[T*Nc+w]=x)}}function Gv(n,e,s,l,h){s.reserve(s.length+4*n.length),l.reserve(l.length+10*n.length),h.reserve(h.length+10*n.length);let p=l.length;for(const g of n){const x=Math.min(10,Math.max(4,1.3*g.height))*e,w=[-g.normal[1],g.normal[0],0],T=Math.min(.29,.1*g.width/g.depth),I=g.width-2*g.depth*e*(T+.01),M=Hi([],g.pos,w,I/2),R=Hi([],g.pos,w,-I/2),B=[M[0],M[1],M[2]+g.height],V=[R[0],R[1],R[2]+g.height],q=Hi([],g.normal,w,T);Kt(q,q,x);const Z=Hi([],g.normal,w,-T);Kt(Z,Z,x),Lt(q,M,q),Lt(Z,R,Z),M[2]+=.1,R[2]+=.1,l.emplaceBack(q[0],q[1],q[2]),l.emplaceBack(Z[0],Z[1],Z[2]),l.emplaceBack(M[0],M[1],M[2]),l.emplaceBack(R[0],R[1],R[2]),l.emplaceBack(B[0],B[1],B[2]),l.emplaceBack(V[0],V[1],V[2]),l.emplaceBack(M[0],M[1],M[2]),l.emplaceBack(R[0],R[1],R[2]),l.emplaceBack(q[0],q[1],q[2]),l.emplaceBack(Z[0],Z[1],Z[2]);const $=I/x/2;h.emplaceBack(-$-T,-1,$,.8),h.emplaceBack($+T,-1,$,.8),h.emplaceBack(-$,0,$,1.3),h.emplaceBack($,0,$,1.3),h.emplaceBack($+T,-.8,$,.7),h.emplaceBack($+T,-.8,$,.7),h.emplaceBack(0,0,$,1.3),h.emplaceBack(0,0,$,1.3),h.emplaceBack($+T,-1.2,$,.8),h.emplaceBack($+T,-1.2,$,.8),s.emplaceBack(6+p,4+p,8+p),s.emplaceBack(7+p,9+p,5+p),s.emplaceBack(0+p,1+p,2+p),s.emplaceBack(1+p,3+p,2+p),p+=10}}function KS(n,e){const s={};s.indexArray=new gs,s.vertexArray=new en,s.colorArray=new Wn,Gv(n,e,s.indexArray,s.vertexArray,s.colorArray);const l={defined:!0};l.emissiveFactor=er.black;const h={};return h.baseColorFactor=er.white,l.pbrMetallicRoughness=h,s.material=l,s.aabb=new ri([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),s}const Xv=Fi([{name:"a_pos_3f",components:3,type:"Float32"}]),QS=Fi([{name:"a_normal_3",components:3,type:"Int16"}]),eA=Fi([{name:"a_centroid_3",components:3,type:"Int16"}]),Yv=Fi([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),tA=Fi([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),iA=Fi([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),rA=Fi([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),sA=Fi([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),qv=ht.types,M_=32767;function nA(n,e){const s=At+e;for(const l of n)for(const h of l)if(h.x<-163||h.x>s||h.y<-163||h.y>s)return!1;return!0}class Zv{constructor(){this.layoutVertexArray=new en,this.layoutAttenuationArray=new Wn,this.layoutColorArray=new hs,this.indexArray=new gs,this.indexArrayForConflation=new gs,this.segmentsBucket=new zr}}class P_{constructor(){this.layoutVertexArray=new en,this.layoutNormalArray=new Fo,this.layoutCentroidArray=new Fo,this.layoutColorArray=new hs,this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.layoutAOArray=[],this.indexArray=new gs,this.indexArrayForConflation=new gs,this.segmentsBucket=new zr,this.entranceBloom=new Zv}}class $v{constructor(e){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.featuresOnBorder=[],this.buildingFeatures=[],this.buildingWithoutFacade=new P_,this.buildingWithFacade=new P_,this.indexArrayForConflationUploaded=!1,this.footprintLookup={},this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=e.index,this.hasPattern=!1,this.worldview=e.worldview,this.lut=e.lut,this.buildingWithFacade.layoutFacadePaintArray=new hs,this.buildingWithFacade.layoutFacadeDataArray=new wl,this.buildingWithFacade.layoutFacadeVerticalRangeArray=new hs,this.programConfigurations=new Gn(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.projection=e.projection,this.groundEffect=new g_(e)}updateFootprints(e,s){for(const l of this.footprints)s.push({footprint:l,id:e})}prepare(){return function(){if(mg!=null||Iv!=null)return null;if(yu!=null)return yu;const e=fetch(Fs.BUILDING_GEN_URL);return yu=function(s){let l,h,p,g;function x(){l=new Uint8Array(g.buffer),h=new Int32Array(g.buffer),p=new Float32Array(g.buffer)}function w(){throw new Error("Unexpected BuildingGen error.")}const T=()=>{},I={a:{a:w,f:function(M){const R=l.length,B=Math.max(M>>>0,Math.ceil(1.2*R)),V=Math.ceil((B-R)/65536);try{return g.grow(V),x(),!0}catch{return!1}},g:w,b:T,c:T,d:T,e:T}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(s,I):s.then(M=>M.arrayBuffer()).then(M=>WebAssembly.instantiate(M,I))).then(M=>{const R=M.instance.exports;return(0,R.g)(),g=R.f,x(),new LS({setStyle:R.h,setAOOptions:R.i,setMetricOptions:R.j,setStructuralOptions:R.k,setFacadeOptions:R.l,setFauxFacadeOptions:R.m,setFacadeClassifierOptions:R.n,addFeature:R.o,addFacade:R.p,generateMesh:R.q,getLastError:R.r,getOuterRingLength:R.s,getMeshCount:R.t,getPositionsPtr:R.u,getPositionsLength:R.v,getNormalsPtr:R.w,getNormalsLength:R.x,getColorsPtr:R.y,getColorsLength:R.z,getAOPtr:R.A,getAOLength:R.B,getUVPtr:R.C,getUVLength:R.D,getFauxFacadePtr:R.E,getFauxFacadeLength:R.F,getIndicesPtr:R.G,getIndicesLength:R.H,getBuildingPart:R.I,getRingCount:R.J,getRingPtr:R.K,getRingLength:R.L,free:R.M,malloc:R.N,heapU8:l,heap32:h,heapF32:p})})}(e).then(s=>(yu=null,mg=s,mg)).catch(s=>{Di("Could not load building-gen"),yu=null,Iv=s}),yu}()}populate(e,s,l,h){const p=zS();if(!p)return;const g=Ne(l);this.tileToMeter=g,this.brightness=s.brightness,p.setStyle({convertToMeters:!1,entranceColorRgb:[1,1,1],facadeGlazingColorRgb:[.5607843137254902,.6745098039215687,.7215686274509804],normalScale:[1,-1,g],ridgeHeight:3,roofColorRgb:[.886274516,.784313738,.713725507],tileToMeters:g,tileZoom:16,wallColorRgb:[.988235294,.933333337,.811764717]}),p.setAOOptions(!1,.3),p.setMetricOptions(!1,16),p.setStructuralOptions(!0),p.setFacadeClassifierOptions(3);const x=new Map;for(const{feature:w}of e){if(qv[w.type]!=="LineString")continue;const T=this.layers[0]._featureFilter.needGeometry,I=pt(w,T);if(!this.layers[0]._featureFilter.filter(new _r(this.zoom),I,l))continue;const M=T?I.geometry:Pt(w,l,h),R=[];for(const Z of M)for(const $ of Z)R.push({x:$.x,y:$.y});const B={coordinates:R,crossPerc:w.properties.cross_perc,distanceToRoad:w.properties.distance_to_road,entrances:w.properties.entrances,sourceId:0},V=w.properties.source_id;let q=x.get(V);q||(q=[],x.set(V,q)),q.push(B)}this.maxHeight=0;for(const{feature:w,index:T}of e){if(qv[w.type]==="LineString")continue;const I=this.layers[0]._featureFilter.needGeometry,M=pt(w,I);if(!this.layers[0]._featureFilter.filter(new _r(this.zoom),M,l))continue;const R=I?M.geometry:Pt(w,l,h),B=lf(R,500);if(!nA(R,163))continue;const V=this.layers[0],q=V.layout.get("building-base").evaluate(w,{},l),Z=V.layout.get("building-height").evaluate(w,{},l),$=V.layout.get("building-roof-shape").evaluate(w,{},l),ne=V.paint.get("building-ambient-occlusion-intensity"),ae=V.paint.get("building-ambient-occlusion-ground-radius")/this.tileToMeter;if($==="flat")continue;const le=V.layout.get("building-facade").evaluate(w,{},l);p.setFacadeOptions(4,!0),p.setFauxFacadeOptions(le,!1,1);const be=w.properties.source_id;let we;we=x.has(be)?x.get(be):[];let ke=0,Le=0,ze=0,rt=0,Be=0,st=0;if(le){let Ft=Math.round(V.layout.get("building-facade-floors").evaluate(w,{},l));if(q===0){Ft=Math.max(1,Ft-(we.length>0?1:0));let Vi=4;if(Z>100){const de=[10,13,15];Vi=de[w.id?w.id%de.length:0],p.setFacadeOptions(Vi,!0)}Be=1.6803*Vi/g}else Be=q/g;st=Z/g,Be=Math.min(Be,st),ze=V.layout.get("building-facade-unit-width").evaluate(w,{},l)/g,rt=(st-Be)/Ft,p.setFauxFacadeOptions(!0,!0,ze);const fi=V.layout.get("building-facade-window").evaluate(w,{},l);ke=fi[0],Le=fi[1]}const ut=[],nt=new mt(1/0,1/0),ot=new mt(-1/0,-1/0),gt=new mt(0,0);let tt=0;for(const Ft of B)if(Ft.length>0){const fi=[];for(const Vi of Ft){const de=[];for(let fe=Vi.length-1;fe>=0;fe--){const Ge=Vi[fe];de.push({x:Ge.x,y:Ge.y}),nt.x=Math.min(nt.x,Ge.x),nt.y=Math.min(nt.y,Ge.y),ot.x=Math.max(ot.x,Ge.x),ot.y=Math.max(ot.y,Ge.y),gt.x+=Ge.x,gt.y+=Ge.y,tt++}fi.push(de)}ut.push({id:w.id?w.id:0,height:Z,minHeight:q,sourceId:0,roofType:$,coordinates:fi})}gt.x/=tt||1,gt.y/=tt||1;const ct=p.generateMesh(ut,we);if(typeof ct=="string"){Di(`Unable to generate building ${w.id}: ${ct}`);continue}if(ct.meshes.length===0||ct.modifiedPolygonRings.length===0)continue;let Xe=0;for(const Ft of ct.meshes)Xe+=Ft.positions.length/3;const He=le?this.buildingWithFacade:this.buildingWithoutFacade,_t=He.segmentsBucket.prepareSegment(Xe,He.layoutVertexArray,He.indexArray),dt=[];let Yt=null,zt=0,Bt=-1;const St=He.indexArray.length;let Gt=0;for(const Ft of ct.meshes){const fi=He.layoutVertexArray.length;if(Ft.buildingPart==="entrance"){const it=new Array;for(let $t=0;$t<Ft.indices.length;$t+=12){const ki=Ft.positions[$t+0],Mi=Ft.positions[$t+1],Ei=Ft.positions[$t+3],sr=Ft.positions[$t+4],kr=Ft.positions[$t+2],Ai=Ft.positions[$t+8]-kr,yr=1,or=Ei-ki,qi=sr-Mi,vr=Math.hypot(or,qi);it.push({pos:[ki+.5*or,Mi+.5*qi,kr],normal:[qi/vr,-or/vr,0],width:vr,height:Ai,depth:yr,points:[ki,Mi,Ei,sr]})}const It=He.entranceBloom.segmentsBucket.prepareSegment(10*it.length,He.entranceBloom.layoutVertexArray,He.entranceBloom.indexArray),Ct=He.entranceBloom.layoutVertexArray.length;zt=He.entranceBloom.indexArray.length,Gv(it,.5/this.tileToMeter,He.entranceBloom.indexArray,He.entranceBloom.layoutVertexArray,He.entranceBloom.layoutAttenuationArray);const Ot=He.entranceBloom.layoutVertexArray.length-Ct;Bt=He.entranceBloom.indexArray.length-zt;for(let $t=0;$t<Ot;$t++)He.entranceBloom.layoutColorArray.emplaceBack(65535,65535);It.vertexLength+=Ot,It.primitiveLength+=Bt,Yt={part:Ft.buildingPart,vertexOffset:Ct,vertexLength:Ot}}for(let it=0;it<Ft.positions.length;it+=3)Gt=Math.max(Gt,Ft.positions[it+2]),He.layoutVertexArray.emplaceBack(Ft.positions[it],Ft.positions[it+1],Ft.positions[it+2]);const Vi=Math.floor(gt.x),de=Math.floor(gt.y),fe=Math.floor(Gt);for(let it=0;it<Ft.positions.length;it+=3)He.layoutCentroidArray.emplaceBack(Vi,de,fe);for(let it=0;it<Ft.normals.length;it+=3)He.layoutNormalArray.emplaceBack(Ft.normals[it+0]*M_,Ft.normals[it+1]*M_,Ft.normals[it+2]*M_);for(let it=0;it<Ft.ao.length;it++)He.layoutAOArray.push(Ft.ao[it]);for(let it=0;it<Ft.colors.length;it+=3){const It=1+(Ft.ao[it/3]-1)*ne;He.layoutColorArray.emplaceBack(Ft.colors[it]*It<<8|Ft.colors[it+1]*It,Ft.colors[it+2]*It<<8)}if(le){for(let it=0;it<Ft.positions.length;it+=3)He.layoutFacadePaintArray.emplaceBack(65535,255);for(let it=0;it<Ft.isFauxFacade.length;it++)if(Ft.isFauxFacade[it]){const It=1|Math.min(65535,Math.floor(Ft.uv[2*it]*ct.outerRingLength)),Ct=Math.floor(255*ke)<<8|Math.floor(255*Le),Ot=Math.floor(65535*Math.min(1,ze/At)),$t=Math.floor(65535*Math.min(1,rt/At));He.layoutFacadeDataArray.emplaceBack(It,Ct,Ot,$t);const ki=Math.floor(65535*Math.min(1,Be/At)),Mi=Math.floor(65535*Math.min(1,st/At));He.layoutFacadeVerticalRangeArray.emplaceBack(ki,Mi)}else He.layoutFacadeDataArray.emplaceBack(0,0,0,0),He.layoutFacadeVerticalRangeArray.emplaceBack(0,0)}const Ge=_t.vertexLength;for(let it=0;it<Ft.indices.length;it+=3)He.indexArray.emplaceBack(Ge+Ft.indices[it],Ge+Ft.indices[it+1],Ge+Ft.indices[it+2]);_t.vertexLength+=Ft.positions.length/3,_t.primitiveLength+=Ft.indices.length/3,(Ft.buildingPart==="roof"||Ft.buildingPart==="wall"||Ft.buildingPart==="facade_glazing"||Ft.buildingPart==="entrance")&&dt.push({part:Ft.buildingPart,vertexOffset:fi,vertexLength:Ft.positions.length/3})}this.maxHeight=Math.max(this.maxHeight,Gt),this.buildingFeatures.push({feature:M,hasFauxFacade:le,segment:_t,parts:dt,buildingBloom:Yt});const li=He.indexArray.length-St,kt=[],jt=[],ti=new mt(1/0,1/0),di=new mt(-1/0,-1/0),Ii=this.groundEffect.vertexArray.length;for(const Ft of ct.modifiedPolygonRings){const fi=[],Vi=new mt(1/0,1/0),de=new mt(-1/0,-1/0);for(let fe=0;fe<Ft.length;fe+=2){const Ge=Ft.length-fe-2;Vi.x=Math.min(Vi.x,Ft[Ge]),Vi.y=Math.min(Vi.y,Ft[Ge+1]),de.x=Math.max(de.x,Ft[Ge]),de.y=Math.max(de.y,Ft[Ge+1]);const it=new mt(Ft[Ge],Ft[Ge+1]);fi.push(it),kt.push(it.x,it.y),jt.push(it.clone())}ti.x=Math.min(ti.x,Vi.x),ti.y=Math.min(ti.y,Vi.y),di.x=Math.max(di.x,de.x),di.y=Math.max(di.y,de.y),this.groundEffect.addData(fi,[Vi,de],ae)}const _i=this.groundEffect.vertexArray.length-Ii;(nt.x<0||ot.x>At||nt.y<0||ot.y>At)&&this.featuresOnBorder.push({featureId:w.id,footprintIndex:this.footprints.length});{const Ft=fu(kt,null,2),fi=new cg(jt,Ft,8,256);let Vi=w.id;w.properties&&w.properties.hasOwnProperty("building_id")&&(Vi=w.properties.building_id),this.footprints.push({vertices:jt,indices:Ft,grid:fi,min:ti,max:di,buildingId:Vi,hiddenFlags:0,indicesOffset:St,indicesLength:li,bloomIndicesOffset:zt,bloomIndicesLength:Bt,groundEffectVertexOffset:Ii,groundEffectVertexLength:_i,hasFauxFacade:le,segment:_t,height:Gt})}this.programConfigurations.populatePaintArrays(He.layoutVertexArray.length,w,T,{},s.availableImages,l,s.brightness),this.groundEffect.addPaintPropertiesData(w,T,{},s.availableImages,l,s.brightness)}this.groundEffect.prepareBorderSegments(),this.evaluate(this.layers[0],{})}update(e,s,l,h,p,g,x){this.programConfigurations.updatePaintArrays(e,s,p,l,h,g,x),this.groundEffect.update(e,s,p,l,h,g,x),this.evaluate(this.layers[0],e),this.colorBufferUploaded=!1}isEmpty(){return this.buildingWithoutFacade.layoutVertexArray.length===0&&this.buildingWithFacade.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){const s=l=>{l.layoutVertexBuffer=e.createVertexBuffer(l.layoutVertexArray,Xv.members),l.layoutNormalBuffer=e.createVertexBuffer(l.layoutNormalArray,QS.members),l.layoutCentroidBuffer=e.createVertexBuffer(l.layoutCentroidArray,eA.members),l.layoutFacadeDataArray&&l.layoutFacadeDataArray.length&&(l.layoutFacadeDataBuffer=e.createVertexBuffer(l.layoutFacadeDataArray,iA.members)),l.layoutFacadeVerticalRangeArray&&l.layoutFacadeVerticalRangeArray.length&&(l.layoutFacadeVerticalRangeBuffer=e.createVertexBuffer(l.layoutFacadeVerticalRangeArray,rA.members)),l.entranceBloom.layoutVertexArray.length&&(l.entranceBloom.layoutVertexBuffer=e.createVertexBuffer(l.entranceBloom.layoutVertexArray,Xv.members),l.entranceBloom.layoutAttenuationBuffer=e.createVertexBuffer(l.entranceBloom.layoutAttenuationArray,sA.members)),this.uploadUpdatedColorBuffer(e),this.uploadUpdatedIndexBuffer(e)};this.uploaded||(s(this.buildingWithoutFacade),s(this.buildingWithFacade),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){const e=s=>{s.layoutVertexBuffer&&(s.layoutVertexBuffer.destroy(),s.layoutNormalBuffer.destroy(),s.layoutColorBuffer.destroy(),s.segmentsBucket.destroy(),s.indexBuffer&&s.indexBuffer.destroy(),s.entranceBloom.layoutVertexBuffer&&(s.entranceBloom.layoutVertexBuffer.destroy(),s.entranceBloom.layoutColorBuffer.destroy(),s.entranceBloom.layoutAttenuationBuffer.destroy(),s.entranceBloom.indexBuffer.destroy(),s.entranceBloom.segmentsBucket.destroy()))};e(this.buildingWithoutFacade),e(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(e,s,l=!0){let h=!1;const p=l?s:0,g=0|(l?-1:~s);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const x of e){const w=this.footprints[x],T=w.hiddenFlags&g|p;w.hiddenFlags!==T&&(w.hiddenFlags=T,h=!0,this.groundEffect.updateHiddenByLandmarkRange(w.groundEffectVertexOffset,w.groundEffectVertexLength,w.hiddenFlags!==0))}return h&&(this.indexArrayForConflationUploaded=!1),h}uploadUpdatedIndexBuffer(e){if(this.groundEffect.uploadHiddenByLandmark(e),this.indexArrayForConflationUploaded)return;const s=h=>{h.indexArray.length!==0&&(h.indexArrayForConflation.resize(h.indexArray.length),h.indexArrayForConflation.uint16.set(h.indexArray.uint16),h.entranceBloom.indexArrayForConflation.resize(h.entranceBloom.indexArray.length),h.entranceBloom.indexArrayForConflation.uint16.set(h.entranceBloom.indexArray.uint16))};s(this.buildingWithoutFacade),s(this.buildingWithFacade);for(const h of this.footprints){const p=h.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,g=h.indicesOffset+h.indicesLength;if(h.hiddenFlags!==0){for(let w=h.indicesOffset;w<g;w++)p.indexArrayForConflation.uint16[3*w+0]=0,p.indexArrayForConflation.uint16[3*w+1]=0,p.indexArrayForConflation.uint16[3*w+2]=0;const x=h.bloomIndicesOffset+h.bloomIndicesLength;for(let w=h.bloomIndicesOffset;w<x;w++)p.entranceBloom.indexArrayForConflation.uint16[3*w+0]=0,p.entranceBloom.indexArrayForConflation.uint16[3*w+1]=0,p.entranceBloom.indexArrayForConflation.uint16[3*w+2]=0}}const l=h=>{h.indexArray.length!==0&&(h.indexBuffer?h.indexBuffer.updateData(h.indexArrayForConflation):h.indexBuffer=e.createIndexBuffer(h.indexArrayForConflation,!0),h.entranceBloom.indexBuffer?h.entranceBloom.indexBuffer.updateData(h.entranceBloom.indexArrayForConflation):h.entranceBloom.indexBuffer=e.createIndexBuffer(h.entranceBloom.indexArrayForConflation,!0))};l(this.buildingWithoutFacade),l(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(e){const s=l=>{l.layoutColorBuffer?l.layoutColorBuffer.updateData(l.layoutColorArray):l.layoutColorBuffer=e.createVertexBuffer(l.layoutColorArray,Yv.members,!0),l.layoutFacadePaintArray&&(l.layoutFacadePaintBuffer?l.layoutFacadePaintBuffer.updateData(l.layoutFacadePaintArray):l.layoutFacadePaintBuffer=e.createVertexBuffer(l.layoutFacadePaintArray,tA.members,!0)),l.entranceBloom.layoutColorBuffer?l.entranceBloom.layoutColorBuffer.updateData(l.entranceBloom.layoutColorArray):l.entranceBloom.layoutColorBuffer=e.createVertexBuffer(l.entranceBloom.layoutColorArray,Yv.members,!0)};s(this.buildingWithoutFacade),s(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(e,s){const l=e.paint.get("building-ambient-occlusion-intensity");for(const h of this.buildingFeatures){const p=s[h.feature.id],g=h.feature;g.properties["building-part"]="roof";const x=e.paint.get("building-color").evaluate(g,p,this.canonical).toPremultipliedRenderColor(this.lut),w=e.paint.get("building-emissive-strength").evaluate(g,p,this.canonical);g.properties["building-part"]="wall";const T=e.paint.get("building-color").evaluate(g,p,this.canonical).toPremultipliedRenderColor(this.lut),I=e.paint.get("building-emissive-strength").evaluate(g,p,this.canonical);g.properties["building-part"]="window";const M=e.paint.get("building-color").evaluate(g,p,this.canonical).toPremultipliedRenderColor(this.lut),R=e.paint.get("building-emissive-strength").evaluate(g,p,this.canonical);g.properties["building-part"]="door";const B=e.paint.get("building-color").evaluate(g,p,this.canonical).toPremultipliedRenderColor(this.lut),V=e.paint.get("building-emissive-strength").evaluate(g,p,this.canonical),q=h.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(const $ of h.parts){let ne,ae=x;$.part==="roof"?(ae=x,ne=w):$.part==="wall"?(ae=T,ne=I):$.part==="facade_glazing"?(ae=M,ne=R):$.part==="entrance"&&(ae=B,ne=V),ne=Ee(ne,0,1);for(let le=0;le<$.vertexLength;le++){const be=$.vertexOffset+le,we=1+(q.layoutAOArray[be]-1)*l;q.layoutColorArray.emplace(be,ae.r*we*255<<8|ae.g*we*255,ae.b*we*255<<8|255*ne),h.hasFauxFacade&&q.layoutFacadePaintArray.emplace(be,255*M.r<<8|255*M.g,255*M.b<<8|255*R)}}const Z=h.buildingBloom;if(Z)for(let $=0;$<Z.vertexLength;$++)q.entranceBloom.layoutColorArray.emplace(Z.vertexOffset+$,255*B.r<<8|255*B.g,255*B.b<<8|51*V)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(e,s,l){if(s.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=s.updateTime;const h=s.getReplacementRegionsForTile(e.toUnwrapped());if(ug(this.activeReplacements,h))return;this.activeReplacements=h;for(const g of this.footprints)g.hiddenFlags&=-2;const p=[];for(const g of this.activeReplacements){if(g.order<=ev)continue;const x=Math.max(1,Math.pow(2,g.footprintTileId.canonical.z-e.canonical.z));for(const w of this.footprints)w.min.x>g.max.x||w.max.x<g.min.x||w.min.y>g.max.y||w.max.y<g.min.y||(p.length=0,aA(w.vertices,0,w.vertices.length,g.footprintTileId.canonical,e.canonical,p),u_(g.footprint,p,w.indices,0,w.indices.length,0,-x)&&(w.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const g of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(g.groundEffectVertexOffset,g.groundEffectVertexLength,g.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getHeightAtTileCoord(e,s){let l=Number.NEGATIVE_INFINITY,h=!0;const p=4*(e+At)*At+(s+At);if(this.footprintLookup.hasOwnProperty(p)){const x=this.footprintLookup[p];return x?{height:x.height,hidden:x.hiddenFlags!==0}:void 0}const g=new mt(e,s);for(const x of this.footprints)e>x.max.x||x.min.x>e||s>x.max.y||x.min.y>s||x.height<=l||d_(g,x)&&(l=x.height,this.footprintLookup[p]=x,h=x.hiddenFlags!==0);if(l!==Number.NEGATIVE_INFINITY)return{height:l,hidden:h};this.footprintLookup[p]=void 0}}function aA(n,e,s,l,h,p){const g=Math.pow(2,l.z-h.z);for(let x=0;x<s;x++){let w=n[x+e].x,T=n[x+e].y;w=(w+h.x*At)*g-l.x*At,T=(T+h.y*At)*g-l.y*At,p.push(new mt(w,T))}}let Jv,Kv;Dt($v,"BuildingBucket",{omit:["layers"]}),Dt(P_,"BuildingGeometry"),Dt(Zv,"BuildingBloomGeometry");const oA=Fi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),lA=Fi([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:cA}=oA,hA=Fi([{name:"a_packed",components:3,type:"Float32"}]),{members:uA}=hA,dA=Fi([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:fA}=dA;class Qv{constructor(e,s){this.width=e,this.height=s,this.nextRow=0,this.image=new Ml({width:e,height:s}),this.positions={},this.uploaded=!1}getDash(e,s){const l=this.getKey(e,s);return this.positions[l]}trim(){const e=this.width,s=this.height=Zt(this.nextRow);this.image.resize({width:e,height:s})}getKey(e,s){return e.join(",")+s}getDashRanges(e,s,l){const h=[];let p=e.length%2==1?-e[e.length-1]*l:0,g=e[0]*l,x=!0;h.push({left:p,right:g,isDash:x,zeroLength:e[0]===0});let w=e[0];for(let T=1;T<e.length;T++){x=!x;const I=e[T];p=w*l,w+=I,g=w*l,h.push({left:p,right:g,isDash:x,zeroLength:I===0})}return h}addRoundDash(e,s,l){const h=s/2;for(let p=-l;p<=l;p++){const g=this.width*(this.nextRow+l+p);let x=0,w=e[x];for(let T=0;T<this.width;T++){T/w.right>1&&(w=e[++x]);const I=Math.abs(T-w.left),M=Math.abs(T-w.right),R=Math.min(I,M);let B;const V=p/l*(h+1);if(w.isDash){const q=h-Math.abs(V);B=Math.sqrt(R*R+q*q)}else B=h-Math.sqrt(R*R+V*V);this.image.data[g+T]=Math.max(0,Math.min(255,B+128))}}}addRegularDash(e,s){for(let w=e.length-1;w>=0;--w){const T=e[w],I=e[w+1];T.zeroLength?e.splice(w,1):I&&I.isDash===T.isDash&&(I.left=T.left,e.splice(w,1))}const l=e[0],h=e[e.length-1];l.isDash===h.isDash&&(l.left=h.left-this.width,h.right=l.right+this.width);const p=this.width*this.nextRow;let g=0,x=e[g];for(let w=0;w<this.width;w++){w/x.right>1&&(x=e[++g]);const T=Math.abs(w-x.left),I=Math.abs(w-x.right),M=Math.min(T,I);this.image.data[p+w]=Math.max(0,Math.min(255,(x.isDash?M:-M)+s+128))}}addDash(e,s){const l=this.getKey(e,s);if(this.positions[l])return this.positions[l];const h=s==="round",p=h?7:0,g=2*p+1;if(this.nextRow+g>this.height)return Di("LineAtlas out of space"),null;e.length===0&&e.push(1);let x=0;for(let I=0;I<e.length;I++)e[I]<0&&(Di("Negative value is found in line dasharray, replacing values with 0"),e[I]=0),x+=e[I];if(x!==0){const I=this.width/x,M=this.getDashRanges(e,this.width,I);h?this.addRoundDash(M,I,p):this.addRegularDash(M,s==="square"?.5*I:0)}const w=this.nextRow+p;this.nextRow+=g;const T={tl:[w,p],br:[x,0]};return this.positions[l]=T,T}}Dt(Qv,"LineAtlas");const pA=ht.types,gA=Math.cos(Math.PI/180*37.5),mA=Math.cos(Math.PI/180*5);class L_{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new tu,this.layoutVertexArray2=new en,this.patternVertexArray=new en,this.indexArray=new gs,this.programConfigurations=new Gn(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new zr,this.maxLineLength=0,this.zOffsetVertexArray=new en,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:At/64,this.worldview=e.worldview}updateFootprints(e,s){}populate(e,s,l,h){this.hasPattern=n_("line",this.layers,this.pixelRatio,s);const p=this.layers[0].layout.get("line-sort-key");this.tileToMeter=Ne(l);const g=this.layers[0].layout.get("line-elevation-reference");if(g==="hd-road-markup")this.elevationType="road";else{const R=this.layers[0].layout.get("line-z-offset"),B=R.isConstant()&&!R.constantOr(0);this.elevationType=g!=="sea"&&g!=="ground"&&B?"none":"offset",this.elevationType==="offset"&&g==="none"&&Di(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const x=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&x!==void 0;const w=[];for(const{feature:R,id:B,index:V,sourceLayerIndex:q}of e){const Z=this.layers[0]._featureFilter.needGeometry,$=pt(R,Z);if(!this.layers[0]._featureFilter.filter(new _r(this.zoom,{worldview:this.worldview}),$,l))continue;const ne=p?p.evaluate($,{},l):void 0,ae={id:B,properties:R.properties,type:R.type,sourceLayerIndex:q,index:V,geometry:Z?$.geometry:Pt(R,l,h),patterns:{},sortKey:ne};w.push(ae)}p&&w.sort((R,B)=>R.sortKey-B.sortKey);const{lineAtlas:T,featureIndex:I}=s,M=this.addConstantDashes(T);for(const R of w){const{geometry:B,index:V,sourceLayerIndex:q}=R;if(M&&this.addFeatureDashes(R,T),this.hasPattern){const Z=a_("line",this.layers,R,this.zoom,this.pixelRatio,s);this.patternFeatures.push(Z)}else this.addFeature(R,B,V,l,T.positions,s.availableImages,s.brightness,s.elevationFeatures);I.insert(e[V].feature,B,V,q,this.index)}}addConstantDashes(e){let s=!1;for(const l of this.layers){const h=l.paint.get("line-dasharray").value,p=l.layout.get("line-cap").value;if(h.kind!=="constant"||p.kind!=="constant")s=!0;else{const g=p.value,x=h.value;if(!x)continue;e.addDash(x,g)}}return s}addFeatureDashes(e,s){const l=this.zoom;for(const h of this.layers){const p=h.paint.get("line-dasharray").value,g=h.layout.get("line-cap").value;if(p.kind==="constant"&&g.kind==="constant")continue;let x,w;if(p.kind==="constant"){if(x=p.value,!x)continue}else x=p.evaluate({zoom:l},e);w=g.kind==="constant"?g.value:g.evaluate({zoom:l},e),s.addDash(x,w),e.patterns[h.id]=[s.getKey(x,w)]}}update(e,s,l,h,p,g,x,w){this.programConfigurations.updatePaintArrays(e,s,p,l,h,g,x,w)}addFeatures(e,s,l,h,p,g){for(const x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,s,l,h,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,uA)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,fA)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,lA.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,cA),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e,s){let l,h;if(s&&s>0?(l=`mapbox_clip_start_${s}`,h=`mapbox_clip_end_${s}`):(l="mapbox_clip_start",h="mapbox_clip_end"),e.properties&&e.properties.hasOwnProperty(l)&&e.properties.hasOwnProperty(h))return{start:+e.properties[l],end:+e.properties[h]}}addFeature(e,s,l,h,p,g,x,w){const T=this.layers[0].layout,I=T.get("line-join").evaluate(e,{}),M=T.get("line-cap").evaluate(e,{}),R=T.get("line-miter-limit"),B=T.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e;const V=!(!e.properties||!e.properties.hasOwnProperty("mapbox_line_metrics"))&&e.properties.mapbox_line_metrics;this.zOffsetValue=T.get("line-z-offset").value;const q=this.layers[0].paint.get("line-width").value;if(q.kind!=="constant"&&q.isLineProgressConstant===!1&&(this.variableWidthValue=q),this.elevationType==="road"){const Z=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(e,s,h,w,I,M,R,B)){const[$,ne]=this.clipRuntimeLinesToTile(s,1);for(let ae=0;ae<$.length;ae++){const le=$[ae],be=ne[ae],we={progress:{min:be.progress.min,max:be.progress.max},nextDir:this.computeSegNextDir(be,le),prevDir:this.computeSegPrevDir(be,le)};this.addLine(le,e,h,I,M,R,B,we,V&&be.parentIndex>0?be.parentIndex:null)}this.fillNonElevatedRoadSegment(Z)}}else for(let Z=0;Z<s.length;Z++)this.addLine(s[Z],e,h,I,M,R,B,void 0,V&&Z>0?Z:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,p,g,h,x,void 0,this.worldview)}computeSegNextDir(e,s){return e.nextPoint.sub(s.at(-2)).unit()}computeSegPrevDir(e,s){return s[1].sub(e.prevPoint).unit()}clipLinesToTile(e,s){return pg(e,-s,-s,At+s,At+s)}clipRuntimeLinesToTile(e,s){const l=[];return[pg(e,-s,-s,At+s,At+s,l),l]}addElevatedRoadFeature(e,s,l,h,p,g,x,w){const T=[],I=Mr.getElevationFeature(e,h);if(I){const M=this.clipLinesToTile(s,1),R=this.prepareElevatedLines(M,I,l);for(const B of R)T.push({geometry:B,elevation:I,elevationTileID:l,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(T.length===0)return!1;for(const M of T){const R=this.layoutVertexArray.length;this.addLine(M.geometry,e,l,p,g,x,w);const B=new is(l,M.elevationTileID);if(M.elevation)for(let V=R;V<this.layoutVertexArray.length;V++){const q=new mt(this.layoutVertexArray.int16[6*V]>>1,this.layoutVertexArray.int16[6*V+1]>>1),Z=B.pointElevation(q,M.elevation,.05);this.updateHeightRange(Z),this.zOffsetVertexArray.emplaceBack(Z,0,0)}else this.fillNonElevatedRoadSegment(R)}return!0}prepareElevatedLines(e,s,l){if(s.constantHeight!=null)return e;const h=[],p=1/Ne(l);for(const g of e)kS(g,new rr(s,p),0,h);return h}fillNonElevatedRoadSegment(e){for(let s=e;s<this.layoutVertexArray.length;s++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(e){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,e),this.heightRange.max=Math.max(this.heightRange.max,e)):this.heightRange={min:e,max:e}}addLine(e,s,l,h,p,g,x,w,T){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=T?this.lineFeatureClips(s,T):this.lineClips;const I=h==="none";this.patternJoinNone=this.hasPattern&&I,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const M=w&&w.progress.min>0,R=w&&w.progress.max<1;if(this.lineClips){let ze={min:this.lineClips.start,max:this.lineClips.end},rt=1;if(w){const ut=this.lineClips.end-this.lineClips.start;ze=function(nt,ot,gt){return{min:xa(nt.min,ot,gt),max:xa(nt.max,ot,gt)}}(w.progress,{min:0,max:1},ze),ut>0&&(rt=(ze.max-ze.min)/ut)}const Be=+s.properties.mapbox_clip_feature_len,st=+s.properties.mapbox_clip_seg_len;if(Number.isNaN(Be)||Number.isNaN(st)){for(let nt=0;nt<e.length-1;nt++)this.totalDistance+=e[nt].dist(e[nt+1]);const ut=this.totalDistance/(ze.max-ze.min);this.totalFeatureLength=Number.isFinite(ut)?ut:0,this.lineClips.start=ze.min,this.lineClips.end=ze.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=Be,this.distance=st*rt,this.lineClips.start=ze.min,this.lineClips.end=ze.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const B=pA[s.type]==="Polygon";let V=e.length;for(;V>=2&&e[V-1].equals(e[V-2]);)V--;let q=0;for(;q<V-1&&e[q].equals(e[q+1]);)q++;if(V<(B?3:2))return;h==="bevel"&&(g=1.05);const Z=this.segments.prepareSegment(10*V,this.layoutVertexArray,this.indexArray);let $,ne,ae,le,be,we,ke,Le;w&&w.prevDir&&(we=w.prevDir.perp()),w&&w.nextDir&&(ke=w.nextDir.perp()),this.e1=this.e2=-1,B&&($=e[V-2],be=e[q].sub($)._unit()._perp());for(let ze=q;ze<V;ze++){if(ae=ze===V-1?B?e[q+1]:void 0:e[ze+1],ae&&e[ze].equals(ae))continue;be&&(le=be),$&&(ne=$),$=e[ze],Le=this.evaluateLineProgressFeatures(ne?ne.dist($):0),be=ae?ae.sub($)._unit()._perp():le,le=le||be;const rt=ne&&ae;let Be=rt?h:B||I?"butt":p;const st=le.x*be.x+le.y*be.y;if(I){const He=function(_t){if(_t.patternJoinNone){const dt=_t.segmentPoints.length/2,Yt=_t.lineSoFar-_t.segmentStart;for(let zt=0;zt<dt;++zt){const Bt=_t.segmentPoints[2*zt+1],St=Math.round(_t.segmentPoints[2*zt])+.5+.25*Bt;_t.patternVertexArray.emplaceBack(St,Yt,_t.segmentStart),_t.patternVertexArray.emplaceBack(St,Yt,_t.segmentStart)}_t.segmentPoints.length=0}_t.e1=_t.e2=-1};if(rt&&st<mA){this.updateDistance(ne,$),this.addCurrentVertex($,le,1,1,Z,Le),He(this),this.addCurrentVertex($,be,-1,-1,Z,Le);continue}if(ne){if(!ae){this.updateDistance(ne,$),this.addCurrentVertex($,le,1,1,Z,Le),He(this);continue}Be="miter"}}let ut=le.add(be);ut.x===0&&ut.y===0||ut._unit();const nt=ut.x*be.x+ut.y*be.y,ot=nt!==0?1/nt:1/0,gt=2*Math.sqrt(2-2*nt),tt=nt<gA&&ne&&ae,ct=le.x*be.y-le.y*be.x>0,Xe=this.overscaling<=16?15*At/(512*this.overscaling):0;if(rt&&Be==="round"){if(ot<x)Be="miter";else if(ot<=2){const He=z_($,-10,At+10);Be=this.elevationType==="offset"&&(He||this.hasCrossSlope)?"miter":"fakeround"}}if(Be==="miter"&&ot>g&&(Be="bevel"),Be==="bevel"&&(ot>2&&(Be="flipbevel"),ot<g&&(Be="miter")),ne&&!(Be==="miter"&&tt)&&this.updateDistance(ne,$),Be==="miter")if(tt){const He=$.dist(ne);if(He>2*Xe){const dt=$.sub($.sub(ne)._mult(Xe/He)._round());this.updateDistance(ne,dt),this.addCurrentVertex(dt,le,0,0,Z,Le),ne=dt}this.updateDistance(ne,$),ut._mult(ot),this.addCurrentVertex($,ut,0,0,Z,Le);const _t=$.dist(ae);if(_t>2*Xe){const dt=$.add(ae.sub($)._mult(Xe/_t)._round());this.updateDistance($,dt),this.addCurrentVertex(dt,be,0,0,Z,Le),$=dt}}else ut._mult(ot),this.addCurrentVertex($,ut,0,0,Z,Le);else if(Be==="flipbevel"){if(ot>100)ut=be.mult(-1);else{const He=ot*le.add(be).mag()/le.sub(be).mag();ut._perp()._mult(He*(ct?-1:1))}this.addCurrentVertex($,ut,0,0,Z,Le),this.addCurrentVertex($,ut.mult(-1),0,0,Z,Le)}else if(Be==="bevel"||Be==="fakeround"){Le!=null&&ne&&this.addCurrentVertex($,ke||le,-1,-1,Z,Le);const He=$.dist(ne)<=2*Xe&&Be!=="bevel",_t=ut.mult(ct?1:-1);_t._mult(ot);const dt=be.mult(ct?-1:1),Yt=le.mult(ct?-1:1),zt=this.evaluateLineProgressFeatures(this.distance);if(Le==null&&(this.addHalfVertex($,_t.x,_t.y,!1,!ct,0,Z,zt),He||this.addHalfVertex($,_t.x+2*Yt.x,_t.y+2*Yt.y,!1,ct,0,Z,zt)),Be==="fakeround"){const Bt=Math.round(180*gt/Math.PI/20);this.addHalfVertex($,Yt.x,Yt.y,!1,ct,0,Z,zt);for(let St=0;St<Bt;St++){let Gt=St/Bt;if(Gt!==.5){const kt=Gt-.5;Gt+=Gt*kt*(Gt-1)*((1.0904+st*(st*(3.55645-1.43519*st)-3.2452))*kt*kt+(.848013+st*(.215638*st-1.06021)))}const li=dt.sub(Yt)._mult(Gt)._add(Yt)._unit();this.addHalfVertex($,li.x,li.y,!1,ct,0,Z,zt)}this.addHalfVertex($,dt.x,dt.y,!1,ct,0,Z,zt)}He||Le!=null||this.addHalfVertex($,_t.x+2*dt.x,_t.y+2*dt.y,!1,ct,0,Z,zt),Le!=null&&ae&&this.addCurrentVertex($,we||be,1,1,Z,Le)}else if(Be==="butt")this.addCurrentVertex($,ut,0,0,Z,Le);else if(Be==="square"){if(!ne){const He=M?0:-1;this.addCurrentVertex($,ut,He,He,Z,Le)}if(this.addCurrentVertex($,ut,0,0,Z,Le),ne){const He=R?0:1;this.addCurrentVertex($,ut,He,He,Z,Le)}}else if(Be==="round"){if(ne){const He=!rt&&ke?ke:le;this.addCurrentVertex($,He,0,0,Z,Le),!rt&&R||this.addCurrentVertex($,He,1,1,Z,Le,!0)}if(ae){const He=!rt&&we?we:be;!rt&&M||this.addCurrentVertex($,He,-1,-1,Z,Le,!0),this.addCurrentVertex($,He,0,0,Z,Le)}}}}addVerticesTo(e,s,l,h,p,g,x,w,T,I){const M=(s.w-e.w)/this.tessellationStep|0;let R=0;const B=this.scaledDistance;if(M>1){this.lineSoFar=e.w;const q=(s.x-e.x)/M,Z=(s.y-e.y)/M,$=(s.z-e.z)/M,ne=(s.w-e.w)/M;for(let ae=1;ae<M;++ae){e.x+=q,e.y+=Z,e.z+=$,this.lineSoFar+=ne,R+=ne;const le=this.evaluateLineProgressFeatures(this.prevDistance+R);this.scaledDistance=(this.prevDistance+R)/this.totalDistance,this.addHalfVertex(e,l,h,I,!1,x,T,le),this.addHalfVertex(e,p,g,I,!0,-w,T,le)}}this.lineSoFar=s.w,this.scaledDistance=B;const V=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(s,l,h,I,!1,x,T,V),this.addHalfVertex(s,p,g,I,!0,-w,T,V)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):Di(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let s=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(s=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:s}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:s}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:s}}addCurrentVertex(e,s,l,h,p,g,x=!1){const w=s.x+s.y*l,T=s.y-s.x*l,I=s.y*h-s.x,M=-s.y-s.x*h;if(g!=null){const R=this.elevationType==="offset",B=-10,V=At+10,q=g.zOffset,Z=new bv(e.x,e.y,q,this.lineSoFar),$=!!R&&z_(e,B,V),ne=this.lineSoFar,ae=this.distance;if(this.currentVertex)if($){const le=this.currentVertexIsOutside,be=this.currentVertex,we=new bv(e.x,e.y,q,this.lineSoFar);if(Sv(be,we,B,V),!z_(we,B,V)){if(le){this.e1=this.e2=-1,this.distance-=be.dist(Z),this.lineSoFar=be.w;const ke=this.evaluateLineProgressFeatures(be.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(be,w,T,x,!1,l,p,ke),this.addHalfVertex(be,I,M,x,!0,-h,p,ke),this.prevDistance=this.distance}this.distance=this.prevDistance+be.dist(we),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(be,we,w,T,I,M,l,h,p,x),this.distance=ae,this.scaledDistance=this.distance/this.totalDistance}}else{const le=this.currentVertex;if(this.currentVertexIsOutside){Sv(le,Z,B,V),this.e1=this.e2=-1,this.distance-=le.dist(Z),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=le.w;const be=this.evaluateLineProgressFeatures(le.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(le,w,T,x,!1,l,p,be),this.addHalfVertex(le,I,M,x,!0,-h,p,be),this.prevDistance=this.distance,this.distance=ae,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(le,Z,w,T,I,M,l,h,p,x)}else $||(this.addHalfVertex(e,w,T,x,!1,l,p,g),this.addHalfVertex(e,I,M,x,!0,-h,p,g));this.currentVertex=Z,this.currentVertexIsOutside=$,this.lineSoFar=ne}else this.addHalfVertex(e,w,T,x,!1,l,p,g),this.addHalfVertex(e,I,M,x,!0,-h,p,g)}addHalfVertex({x:e,y:s},l,h,p,g,x,w,T){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),g||this.segmentPoints.push(this.lineSoFar-this.segmentStart,x)),this.layoutVertexArray.emplaceBack((e<<1)+(p?1:0),(s<<1)+(g?1:0),Math.round(63*l)+128,Math.round(63*h)+128,1+(x===0?0:x<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const M=ei(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,M)}const I=w.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,I),w.primitiveLength++),g?this.e2=I:this.e1=I,T!=null&&this.zOffsetVertexArray.emplaceBack(T.zOffset,T.variableWidth,T.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,s){this.prevDistance=this.distance,this.distance+=e.dist(s),this.updateScaledDistance()}}function z_(n,e,s){return n.x<e||n.x>s||n.y<e||n.y>s}let e0,t0;function i0(n,e,s){return e*(At/(n.tileSize*Math.pow(2,s-n.tileID.overscaledZ)))}Dt(L_,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const r0=(n,e,s)=>(1-s)*n+s*e;function s0(n,e){return 1/i0(n,1,e.tileZoom)}function n0(n,e,s,l){return n.translatePosMatrix(l||e.tileID.projMatrix,e,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}const a0=n=>{const e=[];o0(n)&&e.push("RENDER_LINE_DASH"),n.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const s=n.paint.get("line-trim-offset");s[0]===0&&s[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),n.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const l=n.layout.get("line-join").constantOr("miter")==="none",h=!!n.paint.get("line-pattern").constantOr(1);return l&&h&&e.push("LINE_JOIN_NONE"),e};function o0(n){const e=n.paint.get("line-dasharray").value;return e.kind!=="constant"||e.value}let R_;const l0=()=>R_||(R_={layout:e0||(e0=new Nr({"line-cap":new Mt(Fe.layout_line["line-cap"]),"line-join":new Mt(Fe.layout_line["line-join"]),"line-miter-limit":new yt(Fe.layout_line["line-miter-limit"]),"line-round-limit":new yt(Fe.layout_line["line-round-limit"]),"line-sort-key":new Mt(Fe.layout_line["line-sort-key"]),"line-z-offset":new Mt(Fe.layout_line["line-z-offset"]),"line-elevation-reference":new yt(Fe.layout_line["line-elevation-reference"]),"line-cross-slope":new yt(Fe.layout_line["line-cross-slope"]),visibility:new yt(Fe.layout_line.visibility),"line-width-unit":new yt(Fe.layout_line["line-width-unit"])})),paint:t0||(t0=new Nr({"line-opacity":new Mt(Fe.paint_line["line-opacity"]),"line-color":new Mt(Fe.paint_line["line-color"]),"line-translate":new yt(Fe.paint_line["line-translate"]),"line-translate-anchor":new yt(Fe.paint_line["line-translate-anchor"]),"line-width":new Mt(Fe.paint_line["line-width"]),"line-gap-width":new Mt(Fe.paint_line["line-gap-width"]),"line-offset":new Mt(Fe.paint_line["line-offset"]),"line-blur":new Mt(Fe.paint_line["line-blur"]),"line-dasharray":new Mt(Fe.paint_line["line-dasharray"]),"line-pattern":new Mt(Fe.paint_line["line-pattern"]),"line-pattern-cross-fade":new yt(Fe.paint_line["line-pattern-cross-fade"]),"line-gradient":new yl(Fe.paint_line["line-gradient"]),"line-trim-offset":new yt(Fe.paint_line["line-trim-offset"]),"line-trim-fade-range":new yt(Fe.paint_line["line-trim-fade-range"]),"line-trim-color":new yt(Fe.paint_line["line-trim-color"]),"line-emissive-strength":new yt(Fe.paint_line["line-emissive-strength"]),"line-border-width":new Mt(Fe.paint_line["line-border-width"]),"line-border-color":new Mt(Fe.paint_line["line-border-color"]),"line-occlusion-opacity":new yt(Fe.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Mt({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Mt({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Mt({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Mt({type:"string",default:"default","property-type":"data-driven"})}))},R_);class _A extends Mt{possiblyEvaluate(e,s){return s=new _r(Math.floor(s.zoom),{now:s.now,fadeDuration:s.fadeDuration,transition:s.transition,worldview:s.worldview}),super.possiblyEvaluate(e,s)}evaluate(e,s,l,h){return s=Object.assign({},s,{zoom:Math.floor(s.zoom)}),super.evaluate(e,s,l,h)}}let vf;function c0(n,e){return e>0?e+2*n:n}const yA=Fi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),xA=Fi([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),vA=Fi([{name:"a_projected_pos",components:4,type:"Float32"}],4);Fi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const bA=Fi([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),wA=Fi([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),SA=Fi([{name:"a_texb",components:2,type:"Uint16"}]),AA=Fi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),TA=Fi([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Fi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const h0=Fi([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),EA=Fi([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Fi([{name:"triangle",components:3,type:"Uint16"}]),Fi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Fi([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),Fi([{type:"Float32",name:"offsetX"}]),Fi([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Es=24;function CA(n,e,s){return n.sections.forEach(l=>{l.text=function(h,p,g){const x=p.layout.get("text-transform").evaluate(g,{});return x==="uppercase"?h=h.toLocaleUpperCase():x==="lowercase"&&(h=h.toLocaleLowerCase()),ia.applyArabicShaping&&(h=ia.applyArabicShaping(h)),h}(l.text,e,s)}),n}const bf={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function IA(n){return n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""}function kA(n){return n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""}const D_=4294967296,u0=1/D_,d0=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let wg=class{constructor(n=new Uint8Array(16)){this.buf=ArrayBuffer.isView(n)?n:new Uint8Array(n),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(n,e,s=this.length){for(;this.pos<s;){const l=this.readVarint(),h=l>>3,p=this.pos;this.type=7&l,n(h,e,this),this.pos===p&&this.skip(l)}return e}readMessage(n,e){return this.readFields(n,e,this.readVarint()+this.pos)}readFixed32(){const n=this.dataView.getUint32(this.pos,!0);return this.pos+=4,n}readSFixed32(){const n=this.dataView.getInt32(this.pos,!0);return this.pos+=4,n}readFixed64(){const n=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*D_;return this.pos+=8,n}readSFixed64(){const n=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*D_;return this.pos+=8,n}readFloat(){const n=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,n}readDouble(){const n=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,n}readVarint(n){const e=this.buf;let s,l;return l=e[this.pos++],s=127&l,l<128?s:(l=e[this.pos++],s|=(127&l)<<7,l<128?s:(l=e[this.pos++],s|=(127&l)<<14,l<128?s:(l=e[this.pos++],s|=(127&l)<<21,l<128?s:(l=e[this.pos],s|=(15&l)<<28,function(h,p,g){const x=g.buf;let w,T;if(T=x[g.pos++],w=(112&T)>>4,T<128||(T=x[g.pos++],w|=(127&T)<<3,T<128)||(T=x[g.pos++],w|=(127&T)<<10,T<128)||(T=x[g.pos++],w|=(127&T)<<17,T<128)||(T=x[g.pos++],w|=(127&T)<<24,T<128)||(T=x[g.pos++],w|=(1&T)<<31,T<128))return vu(h,w,p);throw new Error("Expected varint not more than 10 bytes")}(s,n,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const n=this.readVarint();return n%2==1?(n+1)/-2:n/2}readBoolean(){return!!this.readVarint()}readString(){const n=this.readVarint()+this.pos,e=this.pos;return this.pos=n,n-e>=12&&d0?d0.decode(this.buf.subarray(e,n)):function(s,l,h){let p="",g=l;for(;g<h;){const x=s[g];let w,T,I,M=null,R=x>239?4:x>223?3:x>191?2:1;if(g+R>h)break;R===1?x<128&&(M=x):R===2?(w=s[g+1],(192&w)==128&&(M=(31&x)<<6|63&w,M<=127&&(M=null))):R===3?(w=s[g+1],T=s[g+2],(192&w)==128&&(192&T)==128&&(M=(15&x)<<12|(63&w)<<6|63&T,(M<=2047||M>=55296&&M<=57343)&&(M=null))):R===4&&(w=s[g+1],T=s[g+2],I=s[g+3],(192&w)==128&&(192&T)==128&&(192&I)==128&&(M=(15&x)<<18|(63&w)<<12|(63&T)<<6|63&I,(M<=65535||M>=1114112)&&(M=null))),M===null?(M=65533,R=1):M>65535&&(M-=65536,p+=String.fromCharCode(M>>>10&1023|55296),M=56320|1023&M),p+=String.fromCharCode(M),g+=R}return p}(this.buf,e,n)}readBytes(){const n=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,n);return this.pos=n,e}readPackedVarint(n=[],e){const s=this.readPackedEnd();for(;this.pos<s;)n.push(this.readVarint(e));return n}readPackedSVarint(n=[]){const e=this.readPackedEnd();for(;this.pos<e;)n.push(this.readSVarint());return n}readPackedBoolean(n=[]){const e=this.readPackedEnd();for(;this.pos<e;)n.push(this.readBoolean());return n}readPackedFloat(n=[]){const e=this.readPackedEnd();for(;this.pos<e;)n.push(this.readFloat());return n}readPackedDouble(n=[]){const e=this.readPackedEnd();for(;this.pos<e;)n.push(this.readDouble());return n}readPackedFixed32(n=[]){const e=this.readPackedEnd();for(;this.pos<e;)n.push(this.readFixed32());return n}readPackedSFixed32(n=[]){const e=this.readPackedEnd();for(;this.pos<e;)n.push(this.readSFixed32());return n}readPackedFixed64(n=[]){const e=this.readPackedEnd();for(;this.pos<e;)n.push(this.readFixed64());return n}readPackedSFixed64(n=[]){const e=this.readPackedEnd();for(;this.pos<e;)n.push(this.readSFixed64());return n}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(n){const e=7&n;if(e===0)for(;this.buf[this.pos++]>127;);else if(e===2)this.pos=this.readVarint()+this.pos;else if(e===5)this.pos+=4;else{if(e!==1)throw new Error(`Unimplemented type: ${e}`);this.pos+=8}}writeTag(n,e){this.writeVarint(n<<3|e)}realloc(n){let e=this.length||16;for(;e<this.pos+n;)e*=2;if(e!==this.length){const s=new Uint8Array(e);s.set(this.buf),this.buf=s,this.dataView=new DataView(s.buffer),this.length=e}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(n){this.realloc(4),this.dataView.setInt32(this.pos,n,!0),this.pos+=4}writeSFixed32(n){this.realloc(4),this.dataView.setInt32(this.pos,n,!0),this.pos+=4}writeFixed64(n){this.realloc(8),this.dataView.setInt32(this.pos,-1&n,!0),this.dataView.setInt32(this.pos+4,Math.floor(n*u0),!0),this.pos+=8}writeSFixed64(n){this.realloc(8),this.dataView.setInt32(this.pos,-1&n,!0),this.dataView.setInt32(this.pos+4,Math.floor(n*u0),!0),this.pos+=8}writeVarint(n){(n=+n||0)>268435455||n<0?function(e,s){let l,h;if(e>=0?(l=e%4294967296|0,h=e/4294967296|0):(l=~(-e%4294967296),h=~(-e/4294967296),4294967295^l?l=l+1|0:(l=0,h=h+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),function(p,g,x){x.buf[x.pos++]=127&p|128,p>>>=7,x.buf[x.pos++]=127&p|128,p>>>=7,x.buf[x.pos++]=127&p|128,p>>>=7,x.buf[x.pos++]=127&p|128,x.buf[x.pos]=127&(p>>>=7)}(l,0,s),function(p,g){const x=(7&p)<<4;g.buf[g.pos++]|=x|((p>>>=3)?128:0),p&&(g.buf[g.pos++]=127&p|((p>>>=7)?128:0),p&&(g.buf[g.pos++]=127&p|((p>>>=7)?128:0),p&&(g.buf[g.pos++]=127&p|((p>>>=7)?128:0),p&&(g.buf[g.pos++]=127&p|((p>>>=7)?128:0),p&&(g.buf[g.pos++]=127&p)))))}(h,s)}(n,this):(this.realloc(4),this.buf[this.pos++]=127&n|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=n>>>7&127))))}writeSVarint(n){this.writeVarint(n<0?2*-n-1:2*n)}writeBoolean(n){this.writeVarint(+n)}writeString(n){n=String(n),this.realloc(4*n.length),this.pos++;const e=this.pos;this.pos=function(l,h,p){for(let g,x,w=0;w<h.length;w++){if(g=h.charCodeAt(w),g>55295&&g<57344){if(!x){g>56319||w+1===h.length?(l[p++]=239,l[p++]=191,l[p++]=189):x=g;continue}if(g<56320){l[p++]=239,l[p++]=191,l[p++]=189,x=g;continue}g=x-55296<<10|g-56320|65536,x=null}else x&&(l[p++]=239,l[p++]=191,l[p++]=189,x=null);g<128?l[p++]=g:(g<2048?l[p++]=g>>6|192:(g<65536?l[p++]=g>>12|224:(l[p++]=g>>18|240,l[p++]=g>>12&63|128),l[p++]=g>>6&63|128),l[p++]=63&g|128)}return p}(this.buf,n,this.pos);const s=this.pos-e;s>=128&&f0(e,s,this),this.pos=e-1,this.writeVarint(s),this.pos+=s}writeFloat(n){this.realloc(4),this.dataView.setFloat32(this.pos,n,!0),this.pos+=4}writeDouble(n){this.realloc(8),this.dataView.setFloat64(this.pos,n,!0),this.pos+=8}writeBytes(n){const e=n.length;this.writeVarint(e),this.realloc(e);for(let s=0;s<e;s++)this.buf[this.pos++]=n[s]}writeRawMessage(n,e){this.pos++;const s=this.pos;n(e,this);const l=this.pos-s;l>=128&&f0(s,l,this),this.pos=s-1,this.writeVarint(l),this.pos+=l}writeMessage(n,e,s){this.writeTag(n,2),this.writeRawMessage(e,s)}writePackedVarint(n,e){e.length&&this.writeMessage(n,MA,e)}writePackedSVarint(n,e){e.length&&this.writeMessage(n,PA,e)}writePackedBoolean(n,e){e.length&&this.writeMessage(n,RA,e)}writePackedFloat(n,e){e.length&&this.writeMessage(n,LA,e)}writePackedDouble(n,e){e.length&&this.writeMessage(n,zA,e)}writePackedFixed32(n,e){e.length&&this.writeMessage(n,DA,e)}writePackedSFixed32(n,e){e.length&&this.writeMessage(n,OA,e)}writePackedFixed64(n,e){e.length&&this.writeMessage(n,FA,e)}writePackedSFixed64(n,e){e.length&&this.writeMessage(n,BA,e)}writeBytesField(n,e){this.writeTag(n,2),this.writeBytes(e)}writeFixed32Field(n,e){this.writeTag(n,5),this.writeFixed32(e)}writeSFixed32Field(n,e){this.writeTag(n,5),this.writeSFixed32(e)}writeFixed64Field(n,e){this.writeTag(n,1),this.writeFixed64(e)}writeSFixed64Field(n,e){this.writeTag(n,1),this.writeSFixed64(e)}writeVarintField(n,e){this.writeTag(n,0),this.writeVarint(e)}writeSVarintField(n,e){this.writeTag(n,0),this.writeSVarint(e)}writeStringField(n,e){this.writeTag(n,2),this.writeString(e)}writeFloatField(n,e){this.writeTag(n,5),this.writeFloat(e)}writeDoubleField(n,e){this.writeTag(n,1),this.writeDouble(e)}writeBooleanField(n,e){this.writeVarintField(n,+e)}};function vu(n,e,s){return s?4294967296*e+(n>>>0):4294967296*(e>>>0)+(n>>>0)}function f0(n,e,s){const l=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));s.realloc(l);for(let h=s.pos-1;h>=n;h--)s.buf[h+l]=s.buf[h]}function MA(n,e){for(let s=0;s<n.length;s++)e.writeVarint(n[s])}function PA(n,e){for(let s=0;s<n.length;s++)e.writeSVarint(n[s])}function LA(n,e){for(let s=0;s<n.length;s++)e.writeFloat(n[s])}function zA(n,e){for(let s=0;s<n.length;s++)e.writeDouble(n[s])}function RA(n,e){for(let s=0;s<n.length;s++)e.writeBoolean(n[s])}function DA(n,e){for(let s=0;s<n.length;s++)e.writeFixed32(n[s])}function OA(n,e){for(let s=0;s<n.length;s++)e.writeSFixed32(n[s])}function FA(n,e){for(let s=0;s<n.length;s++)e.writeFixed64(n[s])}function BA(n,e){for(let s=0;s<n.length;s++)e.writeSFixed64(n[s])}const O_=3;function NA(n,e,s){e.glyphs=[],n===1&&s.readMessage(VA,e)}function VA(n,e,s){if(n===3){const{id:l,bitmap:h,width:p,height:g,left:x,top:w,advance:T}=s.readMessage(UA,{});e.glyphs.push({id:l,bitmap:new Ml({width:p+2*O_,height:g+2*O_},h),metrics:{width:p,height:g,left:x,top:w,advance:T}})}else n===4?e.ascender=s.readSVarint():n===5&&(e.descender=s.readSVarint())}function UA(n,e,s){n===1?e.id=s.readVarint():n===2?e.bitmap=s.readBytes():n===3?e.width=s.readVarint():n===4?e.height=s.readVarint():n===5?e.left=s.readSVarint():n===6?e.top=s.readSVarint():n===7&&(e.advance=s.readVarint())}const jA=O_,En={horizontal:1,vertical:2,horizontalOnly:3};class wf{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,s){const l=new wf;return l.scale=e||1,l.fontStack=s,l}static forImage(e){const s=new wf;return s.image=e,s}}class bu{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,s,l){const h=new bu;for(let p=0;p<e.sections.length;p++){const g=e.sections[p];g.image?h.addImageSection(g,l):h.addTextSection(g,s)}return h}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(s,l){let h="";for(let p=0;p<s.length;p++){const g=s.charCodeAt(p+1)||null,x=s.charCodeAt(p-1)||null;h+=!l&&(g&&qh(g)&&!bf[s[p+1]]||x&&qh(x)&&!bf[s[p-1]])||!bf[s[p]]?s[p]:bf[s[p]]}return h}(this.text,e)}trim(){let e=0;for(let l=0;l<this.text.length&&Sg[this.text.charCodeAt(l)];l++)e++;let s=this.text.length;for(let l=this.text.length-1;l>=0&&l>=e&&Sg[this.text.charCodeAt(l)];l--)s--;this.text=this.text.substring(e,s),this.sectionIndex=this.sectionIndex.slice(e,s)}substring(e,s){const l=new bu;return l.text=this.text.substring(e,s),l.sectionIndex=this.sectionIndex.slice(e,s),l.sections=this.sections,l}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,s)=>Math.max(e,this.sections[s].scale),0)}addTextSection(e,s){this.text+=e.text,this.sections.push(wf.forText(e.scale,e.fontStack||s));const l=this.sections.length-1;for(let h=0;h<e.text.length;++h)this.sectionIndex.push(l)}addImageSection(e,s){const l=e.image?e.image.getPrimary():null;if(!l)return void Di("Can't add FormattedSection with an empty image.");l.scaleSelf(s);const h=this.getNextImageSectionCharCode();h?(this.text+=String.fromCodePoint(h),this.sections.push(wf.forImage(l)),this.sectionIndex.push(this.sections.length-1)):Di("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function F_(n,e,s,l,h,p,g,x,w,T,I,M,R,B,V,q=1){const Z=bu.fromFeature(n,h,q);M===En.vertical&&Z.verticalizePunctuation(R);let $=[];const ne=function(ke,Le,ze,rt,Be,st){if(!ke)return[];const ut=[],nt=function(ct,Xe,He,_t,dt,Yt){let zt=0;for(let Bt=0;Bt<ct.length();Bt++){const St=ct.getSection(Bt);zt+=p0(ct.getCodePoint(Bt),St,_t,dt,Xe,Yt)}return zt/Math.max(1,Math.ceil(zt/He))}(ke,Le,ze,rt,Be,st),ot=ke.text.indexOf("")>=0;let gt=0;for(let ct=0;ct<ke.length();ct++){const Xe=ke.getSection(ct),He=ke.getCodePoint(ct);if(Sg[He]||(gt+=p0(He,Xe,rt,Be,Le,st)),ct<ke.length()-1){const _t=!((tt=He)<11904||!(Qt["Bopomofo Extended"](tt)||Qt.Bopomofo(tt)||Qt["CJK Compatibility Forms"](tt)||Qt["CJK Compatibility Ideographs"](tt)||Qt["CJK Compatibility"](tt)||Qt["CJK Radicals Supplement"](tt)||Qt["CJK Strokes"](tt)||Qt["CJK Symbols and Punctuation"](tt)||Qt["CJK Unified Ideographs Extension A"](tt)||Qt["CJK Unified Ideographs"](tt)||Qt["Enclosed CJK Letters and Months"](tt)||Qt["Halfwidth and Fullwidth Forms"](tt)||Qt.Hiragana(tt)||Qt["Ideographic Description Characters"](tt)||Qt["Kangxi Radicals"](tt)||Qt["Katakana Phonetic Extensions"](tt)||Qt.Katakana(tt)||Qt["Vertical Forms"](tt)||Qt["Yi Radicals"](tt)||Qt["Yi Syllables"](tt)));(HA[He]||_t||Xe.image)&&ut.push(m0(ct+1,gt,nt,ut,WA(He,ke.getCodePoint(ct+1),_t&&ot),!1))}}var tt;return _0(m0(ke.length(),gt,nt,ut,0,!0))}(Z,T,p,e,l,B),{processBidirectionalText:ae,processStyledBidirectionalText:le}=ia;if(ae&&Z.sections.length===1){const ke=ae(Z.toString(),ne);for(const Le of ke){const ze=new bu;ze.text=Le,ze.sections=Z.sections;for(let rt=0;rt<Le.length;rt++)ze.sectionIndex.push(0);$.push(ze)}}else if(le){const ke=le(Z.text,Z.sectionIndex,ne);for(const Le of ke){const ze=new bu;ze.text=Le[0],ze.sectionIndex=Le[1],ze.sections=Z.sections,$.push(ze)}}else $=function(ke,Le){const ze=[],rt=ke.text;let Be=0;for(const st of Le)ze.push(ke.substring(Be,st)),Be=st;return Be<rt.length&&ze.push(ke.substring(Be,rt.length)),ze}(Z,ne);const be=[],we={positionedLines:be,text:Z.toString(),top:I[1],bottom:I[1],left:I[0],right:I[0],writingMode:M,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(ke,Le,ze,rt,Be,st,ut,nt,ot,gt,tt,ct){let Xe=0,He=0,_t=0;const dt=nt==="right"?1:nt==="left"?0:.5;let Yt=!1;for(const kt of Be){const jt=kt.getSections();for(const ti of jt){if(ti.image)continue;const di=Le[ti.fontStack];if(di&&(Yt=di.ascender!==void 0&&di.descender!==void 0,!Yt))break}if(!Yt)break}let zt=0;for(const kt of Be){kt.trim();const jt=kt.getMaxScale(),ti=(jt-1)*Es,di={positionedGlyphs:[],lineOffset:0};ke.positionedLines[zt]=di;const Ii=di.positionedGlyphs;let _i=0;if(!kt.length()){He+=st,++zt;continue}let Ft=0,fi=0;for(let de=0;de<kt.length();de++){const fe=kt.getSection(de),Ge=kt.getSectionIndex(de),it=kt.getCodePoint(de);let It=fe.scale,Ct=null,Ot=null,$t=null,ki=Es,Mi=0,Ei=ot;Ei===En.vertical&&((Bt=it)===12312||Bt===12313||Bt===12316||Bt===12540||Bt===12448)&&(Ei=En.horizontal);const sr=!(Ei===En.horizontal||!tt&&!Yh(it)||tt&&(Sg[it]||Bm(it)));if(fe.image){const kr=rt.get(fe.image.toString());if(!kr)continue;$t=fe.image,ke.iconsInText=ke.iconsInText||!0,Ot=kr.paddedRect;const Ai=kr.displaySize;It=It*Es/ct,Ct={width:Ai[0],height:Ai[1],left:0,top:-3,advance:sr?Ai[1]:Ai[0],localGlyph:!1},Mi=Yt?-Ct.height*It:jt*Es-17-Ai[1]*It,ki=Ct.advance;const yr=(sr?Ai[0]:Ai[1])*It-Es*jt;yr>0&&yr>_i&&(_i=yr)}else{const kr=ze[fe.fontStack];if(!kr)continue;kr[it]&&(Ot=kr[it]);const Ai=Le[fe.fontStack];if(!Ai)continue;const yr=Ai.glyphs[it];if(!yr)continue;if(Ct=yr.metrics,ki=it!==8203?Es:0,Yt){const or=Ai.ascender!==void 0?Math.abs(Ai.ascender):0,qi=Ai.descender!==void 0?Math.abs(Ai.descender):0,vr=(or+qi)*It;Ft<vr&&(Ft=vr,fi=(or-qi)/2*It),Mi=-or*It}else Mi=(jt-It)*Es-17}sr?(ke.verticalizable=!0,Ii.push({glyph:it,image:$t,x:Xe,y:He+Mi,vertical:sr,scale:It,localGlyph:Ct.localGlyph,fontStack:fe.fontStack,sectionIndex:Ge,metrics:Ct,rect:Ot}),Xe+=ki*It+gt):(Ii.push({glyph:it,image:$t,x:Xe,y:He+Mi,vertical:sr,scale:It,localGlyph:Ct.localGlyph,fontStack:fe.fontStack,sectionIndex:Ge,metrics:Ct,rect:Ot}),Xe+=Ct.advance*It+gt)}Ii.length!==0&&(_t=Math.max(Xe-gt,_t),Yt?y0(Ii,dt,_i,fi,st*jt/2):y0(Ii,dt,_i,0,st/2)),Xe=0;const Vi=st*jt+_i;di.lineOffset=Math.max(_i,ti),He+=Vi,++zt}var Bt;const St=He,{horizontalAlign:Gt,verticalAlign:li}=B_(ut);(function(kt,jt,ti,di,Ii,_i){const Ft=(jt-ti)*Ii,fi=-_i*di;for(const Vi of kt)for(const de of Vi.positionedGlyphs)de.x+=Ft,de.y+=fi})(ke.positionedLines,dt,Gt,li,_t,St),ke.top+=-li*St,ke.bottom=ke.top+St,ke.left+=-Gt*_t,ke.right=ke.left+_t,ke.hasBaseline=Yt}(we,e,s,l,$,g,x,w,M,T,R,V),!function(ke){for(const Le of ke)if(Le.positionedGlyphs.length!==0)return!1;return!0}(be))return we}const Sg={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},HA={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function p0(n,e,s,l,h,p){if(e.image){const g=l.get(e.image.toString());return g?g.displaySize[0]*e.scale*Es/p+h:0}{const g=s[e.fontStack],x=g&&g.glyphs[n];return x?x.metrics.advance*e.scale+h:0}}function g0(n,e,s,l){const h=Math.pow(n-e,2);return l?n<e?h/2:2*h:h+Math.abs(s)*s}function WA(n,e,s){let l=0;return n===10&&(l-=1e4),s&&(l+=150),n!==40&&n!==65288||(l+=50),e!==41&&e!==65289||(l+=50),l}function m0(n,e,s,l,h,p){let g=null,x=g0(e,s,h,p);for(const w of l){const T=g0(e-w.x,s,h,p)+w.badness;T<=x&&(g=w,x=T)}return{index:n,x:e,priorBreak:g,badness:x}}function _0(n){return n?_0(n.priorBreak).concat(n.index):[]}function B_(n){let e=.5,s=.5;switch(n){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:e,verticalAlign:s}}function y0(n,e,s,l,h){if(!(e||s||l||h))return;const p=n.length-1,g=n[p],x=(g.x+g.metrics.advance*g.scale)*e;for(let w=0;w<=p;w++)n[w].x-=x,n[w].y+=s+l+h}function x0(n){return n.imagePrimary!==void 0&&n.top!==void 0&&n.bottom!==void 0&&n.left!==void 0&&n.right!==void 0}function GA(n,e,s,l){const{horizontalAlign:h,verticalAlign:p}=B_(l),g=s[0]-n.displaySize[0]*h,x=s[1]-n.displaySize[1]*p;return{imagePrimary:n,imageSecondary:e,top:x,bottom:x+n.displaySize[1],left:g,right:g+n.displaySize[0]}}function v0(n,e,s,l,h,p){const g=n.imagePrimary;let x;if(g.content){const Z=g.content,$=g.pixelRatio||1;x=[Z[0]/$,Z[1]/$,g.displaySize[0]-Z[2]/$,g.displaySize[1]-Z[3]/$]}const w=e.left*p,T=e.right*p;let I,M,R,B;s==="width"||s==="both"?(B=h[0]+w-l[3],M=h[0]+T+l[1]):(B=h[0]+(w+T-g.displaySize[0])/2,M=B+g.displaySize[0]);const V=e.top*p,q=e.bottom*p;return s==="height"||s==="both"?(I=h[1]+V-l[0],R=h[1]+q+l[2]):(I=h[1]+(V+q-g.displaySize[1])/2,R=I+g.displaySize[1]),{imagePrimary:g,imageSecondary:void 0,top:I,right:M,bottom:R,left:B,collisionPadding:x}}function b0(n){return!n.imagePrimary.stretchX}function w0(n){return!n.imagePrimary.stretchY}function S0(n){return{width:n.right-n.left,height:n.bottom-n.top}}const ho=128;function A0(n,e,s){const{expression:l}=e;if(l.kind==="constant")return{kind:"constant",layoutSize:l.evaluate(new _r(n+1,{worldview:s}))};if(l.kind==="source")return{kind:"source"};{const{zoomStops:h,interpolationType:p}=l;let g=0;for(;g<h.length&&h[g]<=n;)g++;g=Math.max(0,g-1);let x=g;for(;x<h.length&&h[x]<n+1;)x++;x=Math.min(h.length-1,x);const w=h[g],T=h[x];return l.kind==="composite"?{kind:"composite",minZoom:w,maxZoom:T,interpolationType:p}:{kind:"camera",minZoom:w,maxZoom:T,minSize:l.evaluate(new _r(w,{worldview:s})),maxSize:l.evaluate(new _r(T,{worldview:s})),interpolationType:p}}}function N_(n,{uSize:e,uSizeT:s},{lowerSize:l,upperSize:h}){return n.kind==="source"?l/ho:n.kind==="composite"?ei(l/ho,h/ho,s):e}function Sf(n,e,s=1){let l=0,h=0;if(n.kind==="constant")h=n.layoutSize*s;else if(n.kind!=="source"){const{interpolationType:p,minZoom:g,maxZoom:x}=n,w=p?Ee(bn.interpolationFactor(p,e,g,x),0,1):0;n.kind==="camera"?h=ei(n.minSize,n.maxSize,w)*s:l=w*s}return{uSizeT:l,uSize:h}}class Wo extends mt{constructor(e,s,l,h,p){super(e,s),this.angle=h,this.z=l,p!==void 0&&(this.segment=p)}clone(){return new Wo(this.x,this.y,this.z,this.angle,this.segment)}}function T0(n,e,s,l,h){if(e.segment===void 0)return!0;let p=e,g=e.segment+1,x=0;for(;x>-s/2;){if(g--,g<0)return!1;x-=n[g].dist(p),p=n[g]}x+=n[g].dist(n[g+1]),g++;const w=[];let T=0;for(;x<s/2;){const I=n[g],M=n[g+1];if(!M)return!1;let R=n[g-1].angleTo(I)-I.angleTo(M);for(R=Math.abs((R+3*Math.PI)%(2*Math.PI)-Math.PI),w.push({distance:x,angleDelta:R}),T+=R;x-w[0].distance>l;)T-=w.shift().angleDelta;if(T>h)return!1;g++,x+=I.dist(M)}return!0}function E0(n){let e=0;for(let s=0;s<n.length-1;s++)e+=n[s].dist(n[s+1]);return e}function C0(n,e,s){return n?.6*e*s:0}function I0(n,e){return Math.max(n?n.right-n.left:0,e?e.right-e.left:0)}function XA(n,e,s,l,h,p){const g=C0(s,h,p),x=I0(s,l)*p;let w=0;const T=E0(n)/2;for(let I=0;I<n.length-1;I++){const M=n[I],R=n[I+1],B=M.dist(R);if(w+B>T){const V=(T-w)/B,q=ei(M.x,R.x,V),Z=ei(M.y,R.y,V),$=new Wo(q,Z,0,R.angleTo(M),I);return!g||T0(n,$,x,g,e)?$:void 0}w+=B}}function YA(n,e,s,l,h,p,g,x,w){const T=C0(l,p,g),I=I0(l,h),M=I*g,R=n[0].x===0||n[0].x===w||n[0].y===0||n[0].y===w;return e-M<e/4&&(e=M+e/4),k0(n,R?e/2*x%e:(I/2+2*p)*g*x%e,e,T,s,M,R,!1,w)}function k0(n,e,s,l,h,p,g,x,w){const T=p/2,I=E0(n);let M=0,R=e-s,B=[];for(let V=0;V<n.length-1;V++){const q=n[V],Z=n[V+1],$=q.dist(Z),ne=Z.angleTo(q);for(;R+s<M+$;){R+=s;const ae=(R-M)/$,le=ei(q.x,Z.x,ae),be=ei(q.y,Z.y,ae);if(le>=0&&le<w&&be>=0&&be<w&&R-T>=0&&R+T<=I){const we=new Wo(le,be,0,ne,V);l&&!T0(n,we,p,l,h)||B.push(we)}}M+=$}return x||B.length||g||(B=k0(n,M/2,s,l,h,p,g,!0,w)),B}function M0(n){let e=0,s=0;for(const g of n)e+=g.w*g.h,s=Math.max(s,g.w);n.sort((g,x)=>x.h-g.h);const l=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),s),h:1/0}];let h=0,p=0;for(const g of n)for(let x=l.length-1;x>=0;x--){const w=l[x];if(!(g.w>w.w||g.h>w.h)){if(g.x=w.x,g.y=w.y,p=Math.max(p,g.y+g.h),h=Math.max(h,g.x+g.w),g.w===w.w&&g.h===w.h){const T=l.pop();T&&x<l.length&&(l[x]=T)}else g.h===w.h?(w.x+=g.w,w.w-=g.w):g.w===w.w?(w.y+=g.h,w.h-=g.h):(l.push({x:w.x+g.w,y:w.y,w:w.w-g.w,h:g.h}),w.y+=g.h,w.h-=g.h);break}}return{w:h,h:p,fill:e/(h*p)||0}}Dt(Wo,"Anchor");const Uc=1;class Af{static getImagePositionScale(e,s,l){if(s&&e&&e.options&&e.options.transform){const h=e.options.transform;return{x:h.a,y:h.d}}return{x:l,y:l}}constructor(e,s,l,h){this.paddedRect=e;const{pixelRatio:p,version:g,stretchX:x,stretchY:w,content:T,sdf:I,usvg:M}=s;this.pixelRatio=p,this.stretchX=x,this.stretchY=w,this.content=T,this.version=g,this.padding=l,this.sdf=I,this.usvg=M,this.scale=Af.getImagePositionScale(h,M,p)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function V_(n,e,s){const l=Un.parse(n),h=function(p,g,x=[1,1]){return{x:0,y:0,w:(p.data?p.data.width:p.width*x[0])+2*g,h:(p.data?p.data.height:p.height*x[1])+2*g}}(e,s,[l.options.transform.a,l.options.transform.d]);return{bin:h,imagePosition:new Af(h,e,s,l),imageVariant:l}}class P0{constructor(e,s,l){const h=new Map,p=new Map;this.haveRenderCallbacks=[];const g=[];this.addImages(e,h,Uc,g),this.addImages(s,p,2,g);const{w:x,h:w}=M0(g),T=new Rs({width:x||1,height:w||1});for(const[I,M]of e.entries()){const R=h.get(I).paddedRect;Rs.copy(M.data,T,{x:0,y:0},{x:R.x+Uc,y:R.y+Uc},M.data,null,M.sdf)}for(const[I,M]of s.entries()){const R=p.get(I),B=R.paddedRect;let V=R.padding;const q=B.x+V,Z=B.y+V,$=M.data.width,ne=M.data.height;V=V>1?V-1:V,Rs.copy(M.data,T,{x:0,y:0},{x:q,y:Z},M.data,l),Rs.copy(M.data,T,{x:0,y:ne-V},{x:q,y:Z-V},{width:$,height:V},l),Rs.copy(M.data,T,{x:0,y:0},{x:q,y:Z+ne},{width:$,height:V},l),Rs.copy(M.data,T,{x:$-V,y:0},{x:q-V,y:Z},{width:V,height:ne},l),Rs.copy(M.data,T,{x:0,y:0},{x:q+$,y:Z},{width:V,height:ne},l),Rs.copy(M.data,T,{x:$-V,y:ne-V},{x:q-V,y:Z-V},{width:V,height:V},l),Rs.copy(M.data,T,{x:0,y:ne-V},{x:q+$,y:Z-V},{width:V,height:V},l),Rs.copy(M.data,T,{x:0,y:0},{x:q+$,y:Z+ne},{width:V,height:V},l),Rs.copy(M.data,T,{x:$-V,y:0},{x:q-V,y:Z+ne},{width:V,height:V},l)}this.lut=l,this.image=T,this.iconPositions=h,this.patternPositions=p}addImages(e,s,l,h){for(const[p,g]of e.entries()){const{bin:x,imagePosition:w,imageVariant:T}=V_(p,g,l);s.set(p,w),h.push(x),g.hasRenderCallback&&this.haveRenderCallbacks.push(T.id)}}patchUpdatedImages(e,s,l){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(h=>e.hasImage(h,l)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,l);for(const h of e.getUpdatedImages(l)){for(const p of this.iconPositions.keys()){const g=Un.parse(p);if(yn.isEqual(g.id,h)){const x=e.getImage(h,l);this.patchUpdatedImage(this.iconPositions.get(p),x,s,null)}}for(const p of this.patternPositions.keys()){const g=Un.parse(p);if(yn.isEqual(g.id,h)){const x=e.getImage(h,l);this.patchUpdatedImage(this.patternPositions.get(p),x,s,this.lut)}}}}patchUpdatedImage(e,s,l,h=null){if(!e||!s||e.version===s.version)return;e.version=s.version;const[p,g]=e.tl,x=e.sdf;if(this.lut||x){const w={width:s.data.width,height:s.data.height},T=new Rs(w);Rs.copy(s.data,T,{x:0,y:0},{x:0,y:0},w,h,x),l.update(T,{position:{x:p,y:g}})}else l.update(s.data,{position:{x:p,y:g}})}}Dt(Af,"ImagePosition"),Dt(P0,"ImageAtlas");const Ag=1e20;function L0(n,e,s,l,h,p,g,x,w){for(let T=e;T<e+l;T++)z0(n,s*p+T,p,h,g,x,w);for(let T=s;T<s+h;T++)z0(n,T*p+e,1,l,g,x,w)}function z0(n,e,s,l,h,p,g){p[0]=0,g[0]=-1e20,g[1]=Ag,h[0]=n[e];for(let x=1,w=0,T=0;x<l;x++){h[x]=n[e+x*s];const I=x*x;do{const M=p[w];T=(h[x]-h[M]+I-M*M)/(x-M)/2}while(T<=g[w]&&--w>-1);w++,p[w]=x,g[w]=T,g[w+1]=Ag}for(let x=0,w=0;x<l;x++){for(;g[w+1]<x;)w++;const T=p[w],I=x-T;n[e+x*s]=h[T]+I*I}}const Ma=2,U_={none:0,ideographs:1,all:2};class wu{constructor(e,s,l){this.requestManager=e,this.localGlyphMode=s,this.localFontFamily=l,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,s){const l=[],h=this.url||Fs.GLYPHS_URL;for(const p in e)for(const g of e[p])l.push({stack:p,id:g});Ze(l,({stack:p,id:g},x)=>{let w=this.entries[p];w||(w=this.entries[p]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let T=w.glyphs[g];if(T!==void 0)return void x(null,{stack:p,id:g,glyph:T});if(T=this._tinySDF(w,p,g),T)return w.glyphs[g]=T,void x(null,{stack:p,id:g,glyph:T});const I=Math.floor(g/256);if(256*I>65535)return Di("glyphs > 65535 not supported"),void x(null,{stack:p,id:g,glyph:T});if(w.ranges[I])return void x(null,{stack:p,id:g,glyph:T});let M=w.requests[I];M||(M=w.requests[I]=[],wu.loadGlyphRange(p,I,h,this.requestManager,(R,B)=>{if(B){w.ascender=B.ascender,w.descender=B.descender;for(const V in B.glyphs)this._doesCharSupportLocalGlyph(+V)||(w.glyphs[+V]=B.glyphs[+V]);w.ranges[I]=!0}for(const V of M)V(R,B);delete w.requests[I]})),M.push((R,B)=>{R?x(R):B&&x(null,{stack:p,id:g,glyph:B.glyphs[g]||null})})},(p,g)=>{if(p)s(p);else if(g){const x={};for(const{stack:w,id:T,glyph:I}of g)x[w]===void 0&&(x[w]={}),x[w].glyphs===void 0&&(x[w].glyphs={}),x[w].glyphs[T]=I&&{id:I.id,bitmap:I.bitmap.clone(),metrics:I.metrics},x[w].ascender=this.entries[w].ascender,x[w].descender=this.entries[w].descender;s(null,x)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==U_.none&&(this.localGlyphMode===U_.all?!!this.localFontFamily:!!this.localFontFamily&&(Qt["CJK Unified Ideographs"](e)||Qt["Hangul Syllables"](e)||Qt.Hiragana(e)||Qt.Katakana(e)||Qt["CJK Symbols and Punctuation"](e)||Qt["CJK Unified Ideographs Extension A"](e)||Qt["CJK Unified Ideographs Extension B"](e)||Qt.Osage(e)))}_tinySDF(e,s,l){const h=this.localFontFamily;if(!h||!this._doesCharSupportLocalGlyph(l))return;let p=e.tinySDF;if(!p){let q="400";/bold/i.test(s)?q="900":/medium/i.test(s)?q="500":/light/i.test(s)&&(q="200"),p=e.tinySDF=new wu.TinySDF({fontFamily:h,fontWeight:q,fontSize:24*Ma,buffer:3*Ma,radius:8*Ma}),p.fontWeight=q}if(this.localGlyphs[p.fontWeight][l])return this.localGlyphs[p.fontWeight][l];const g=String.fromCodePoint(l),{data:x,width:w,height:T,glyphWidth:I,glyphHeight:M,glyphLeft:R,glyphTop:B,glyphAdvance:V}=p.draw(g);return this.localGlyphs[p.fontWeight][l]={id:l,bitmap:new Ml({width:w,height:T},x),metrics:{width:I/Ma,height:M/Ma,left:R/Ma,top:B/Ma-27,advance:V/Ma,localGlyph:!0}}}}wu.loadGlyphRange=function(n,e,s,l,h){const p=256*e,g=p+255,x=l.transformRequest(l.normalizeGlyphsURL(s).replace("{fontstack}",n).replace("{range}",`${p}-${g}`),rh.Glyphs);Qo(x,(w,T)=>{if(w)h(w);else if(T){const I={},M=function(R){return new wg(R).readFields(NA,{})}(T);for(const R of M.glyphs)I[R.id]=R;h(null,{glyphs:I,ascender:M.ascender,descender:M.descender})}})},wu.TinySDF=class{constructor({fontSize:n=24,buffer:e=3,radius:s=8,cutoff:l=.25,fontFamily:h="sans-serif",fontWeight:p="normal",fontStyle:g="normal",lang:x=null}={}){this.buffer=e,this.cutoff=l,this.radius=s,this.lang=x;const w=this.size=n+4*e,T=this._createCanvas(w),I=this.ctx=T.getContext("2d",{willReadFrequently:!0});I.font=`${g} ${p} ${n}px ${h}`,I.textBaseline="alphabetic",I.textAlign="left",I.fillStyle="black",this.gridOuter=new Float64Array(w*w),this.gridInner=new Float64Array(w*w),this.f=new Float64Array(w),this.z=new Float64Array(w+1),this.v=new Uint16Array(w)}_createCanvas(n){const e=document.createElement("canvas");return e.width=e.height=n,e}draw(n){const{width:e,actualBoundingBoxAscent:s,actualBoundingBoxDescent:l,actualBoundingBoxLeft:h,actualBoundingBoxRight:p}=this.ctx.measureText(n),g=Math.ceil(s),x=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(p-h))),w=Math.min(this.size-this.buffer,g+Math.ceil(l)),T=x+2*this.buffer,I=w+2*this.buffer,M=Math.max(T*I,0),R=new Uint8ClampedArray(M),B={data:R,width:T,height:I,glyphWidth:x,glyphHeight:w,glyphTop:g,glyphLeft:0,glyphAdvance:e};if(x===0||w===0)return B;const{ctx:V,buffer:q,gridInner:Z,gridOuter:$}=this;this.lang&&(V.lang=this.lang),V.clearRect(q,q,x,w),V.fillText(n,q,q+g);const ne=V.getImageData(q,q,x,w);$.fill(Ag,0,M),Z.fill(0,0,M);for(let ae=0;ae<w;ae++)for(let le=0;le<x;le++){const be=ne.data[4*(ae*x+le)+3]/255;if(be===0)continue;const we=(ae+q)*T+le+q;if(be===1)$[we]=0,Z[we]=Ag;else{const ke=.5-be;$[we]=ke>0?ke*ke:0,Z[we]=ke<0?ke*ke:0}}L0($,0,0,T,I,T,this.f,this.v,this.z),L0(Z,q,q,x,w,T,this.f,this.v,this.z);for(let ae=0;ae<M;ae++){const le=Math.sqrt($[ae])-Math.sqrt(Z[ae]);R[ae]=Math.round(255-255*(le/this.radius+this.cutoff))}return B}};const jc=Uc;function R0(n,e){return n+e[1]-e[0]}function D0(n,e,s,l,h=1){const p=[],g=n.imagePrimary,x=g.pixelRatio,w=g.paddedRect.w-2*jc,T=g.paddedRect.h-2*jc,I=(n.right-n.left)*h,M=(n.bottom-n.top)*h,R=g.stretchX||[[0,w]],B=g.stretchY||[[0,T]],V=R.reduce(R0,0),q=B.reduce(R0,0),Z=w-V,$=T-q;let ne=0,ae=V,le=0,be=q,we=0,ke=Z,Le=0,ze=$;if(g.content&&l){const Be=g.content;ne=Tg(R,0,Be[0]),le=Tg(B,0,Be[1]),ae=Tg(R,Be[0],Be[2]),be=Tg(B,Be[1],Be[3]),we=Be[0]-ne,Le=Be[1]-le,ke=Be[2]-Be[0]-ae,ze=Be[3]-Be[1]-be}const rt=(Be,st,ut,nt)=>{const ot=Eg(Be.stretch-ne,ae,I,n.left*h),gt=Cg(Be.fixed-we,ke,Be.stretch,V),tt=Eg(st.stretch-le,be,M,n.top*h),ct=Cg(st.fixed-Le,ze,st.stretch,q),Xe=Eg(ut.stretch-ne,ae,I,n.left*h),He=Cg(ut.fixed-we,ke,ut.stretch,V),_t=Eg(nt.stretch-le,be,M,n.top*h),dt=Cg(nt.fixed-Le,ze,nt.stretch,q),Yt=new mt(ot,tt),zt=new mt(Xe,tt),Bt=new mt(Xe,_t),St=new mt(ot,_t),Gt=new mt(gt/x,ct/x),li=new mt(He/x,dt/x),kt=e*Math.PI/180;if(kt){const Ft=Math.sin(kt),fi=Math.cos(kt),Vi=[fi,-Ft,Ft,fi];Yt._matMult(Vi),zt._matMult(Vi),St._matMult(Vi),Bt._matMult(Vi)}const jt=Be.stretch+Be.fixed,ti=ut.stretch+ut.fixed,di=st.stretch+st.fixed,Ii=nt.stretch+nt.fixed,_i=n.imageSecondary;return{tl:Yt,tr:zt,bl:St,br:Bt,texPrimary:{x:g.paddedRect.x+jc+jt,y:g.paddedRect.y+jc+di,w:ti-jt,h:Ii-di},texSecondary:_i?{x:_i.paddedRect.x+jc+jt,y:_i.paddedRect.y+jc+di,w:ti-jt,h:Ii-di}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Gt,pixelOffsetBR:li,minFontScaleX:ke/x/I,minFontScaleY:ze/x/M,isSDF:s}};if(l&&(g.stretchX||g.stretchY)){const Be=O0(R,Z,V),st=O0(B,$,q);for(let ut=0;ut<Be.length-1;ut++){const nt=Be[ut],ot=Be[ut+1];for(let gt=0;gt<st.length-1;gt++)p.push(rt(nt,st[gt],ot,st[gt+1]))}}else p.push(rt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:w+1},{fixed:0,stretch:T+1}));return p}function Tg(n,e,s){let l=0;for(const h of n)l+=Math.max(e,Math.min(s,h[1]))-Math.max(e,Math.min(s,h[0]));return l}function O0(n,e,s){const l=[{fixed:-1,stretch:0}];for(const[h,p]of n){const g=l[l.length-1];l.push({fixed:h-g.stretch,stretch:g.stretch}),l.push({fixed:h-g.stretch,stretch:g.stretch+(p-h)})}return l.push({fixed:e+jc,stretch:s}),l}function Eg(n,e,s,l){return n/e*s+l}function Cg(n,e,s,l){return n-e*s/l}function qA(n,e,s,l){const h=e+n.positionedLines[l].lineOffset;return l===0?s+h/2:s+(h+(e+n.positionedLines[l-1].lineOffset))/2}function ZA(n,e=1,s=!1){let l=1/0,h=1/0,p=-1/0,g=-1/0;const x=n[0];for(let B=0;B<x.length;B++){const V=x[B];(!B||V.x<l)&&(l=V.x),(!B||V.y<h)&&(h=V.y),(!B||V.x>p)&&(p=V.x),(!B||V.y>g)&&(g=V.y)}const w=Math.min(p-l,g-h);let T=w/2;const I=new bh([],$A);if(w===0)return new mt(l,h);for(let B=l;B<p;B+=w)for(let V=h;V<g;V+=w)I.push(new Su(B+T,V+T,T,n));let M=function(B){let V=0,q=0,Z=0;const $=B[0];for(let ne=0,ae=$.length,le=ae-1;ne<ae;le=ne++){const be=$[ne],we=$[le],ke=be.x*we.y-we.x*be.y;q+=(be.x+we.x)*ke,Z+=(be.y+we.y)*ke,V+=3*ke}return new Su(q/V,Z/V,0,B)}(n),R=I.length;for(;I.length;){const B=I.pop();(B.d>M.d||!M.d)&&(M=B,s&&console.log("found best %d after %d probes",Math.round(1e4*B.d)/1e4,R)),B.max-M.d<=e||(T=B.h/2,I.push(new Su(B.p.x-T,B.p.y-T,T,n)),I.push(new Su(B.p.x+T,B.p.y-T,T,n)),I.push(new Su(B.p.x-T,B.p.y+T,T,n)),I.push(new Su(B.p.x+T,B.p.y+T,T,n)),R+=4)}return s&&(console.log(`num probes: ${R}`),console.log(`best distance: ${M.d}`)),M.p}function $A(n,e){return e.max-n.max}class Su{constructor(e,s,l,h){this.p=new mt(e,s),this.h=l,this.d=function(p,g){let x=!1,w=1/0;for(let T=0;T<g.length;T++){const I=g[T];for(let M=0,R=I.length,B=R-1;M<R;B=M++){const V=I[M],q=I[B];V.y>p.y!=q.y>p.y&&p.x<(q.x-V.x)*(p.y-V.y)/(q.y-V.y)+V.x&&(x=!x),w=Math.min(w,Pr(p,V,q))}}return(x?1:-1)*Math.sqrt(w)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}}const JA=Object.keys,j_=Number.POSITIVE_INFINITY,KA=Math.sqrt(2);function F0(n,[e,s]){let l=0,h=0;if(s===j_){e<0&&(e=0);const p=e/KA;switch(n){case"top-right":case"top-left":h=p-7;break;case"bottom-right":case"bottom-left":h=7-p;break;case"bottom":h=7-e;break;case"top":h=e-7}switch(n){case"top-right":case"bottom-right":l=-p;break;case"top-left":case"bottom-left":l=p;break;case"left":l=e;break;case"right":l=-e}}else{switch(e=Math.abs(e),s=Math.abs(s),n){case"top-right":case"top-left":case"top":h=s-7;break;case"bottom-right":case"bottom-left":case"bottom":h=7-s}switch(n){case"top-right":case"bottom-right":case"right":l=-e;break;case"top-left":case"bottom-left":case"left":l=e}}return[l,h]}function Ig(n,e,s,l,h,p,g,x,w){if(!e||!e.usvg)return;const T=S0(l),I=S0(h),M=p!=="both"&&p!=="width"||!b0(l)?1:I.width/T.width,R=p!=="both"&&p!=="height"||!w0(l)?1:I.height/T.height;s.scaleSelf(M,R);const B=s.toString();g.set(B,s),x.set(B,e);const{imagePosition:V}=V_(B,e,Uc);w.set(B,V)}function B0(n,e,s,l,h,p,g,x,w){if(!n)return;const T=function(I,M,R,B,V,q){if(I.kind==="camera")return I.maxSize;if(I.kind==="composite"){const Z=M.possiblyEvaluate(new _r(I.maxZoom,{worldview:q}),R).evaluate(V,{},R),$=M.possiblyEvaluate(new _r(I.minZoom,{worldview:q}),R).evaluate(V,{},R);return Math.max(Z,$)}return M.possiblyEvaluate(new _r(B,{worldview:q})).evaluate(V,{},R)}(e,s,l,h,p,w);return n.scaleSelf(T*x*g)}function N0(n,e,s,l,h,p,g,x,w){return{iconPrimary:B0(n.getPrimary(),e,s,l,h,p,g,x,w),iconSecondary:B0(n.getSecondary(),e,s,l,h,p,g,x,w)}}function QA(n,e,s){if(!e)return;const l=s.get(n.toString()),h=s.get(e.toString());l&&h&&(l.paddedRect.w===h.paddedRect.w&&l.paddedRect.h===h.paddedRect.h||Di(`Mismatch in icon variant sizes: ${n.toString()} and ${e.toString()}`),l.usvg!==h.usvg&&Di(`Mismatch in icon variant image types: ${n.id} and ${e.id}`))}function V0(n,e,s,l){if(!n)return;const h=e.get(s.toString());if(n.imagePrimary=h,l){const p=e.get(l.toString());n.imageSecondary=p}}function eT(n,e){for(const s in n.horizontal)U0(n.horizontal[s],e);U0(n.vertical,e)}function U0(n,e){if(n){for(const s of n.positionedLines)for(const l of s.positionedGlyphs)if(l.image!==null){const h=l.image.toString();l.rect=e.get(h).paddedRect}}}function H_(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function tT(n,e,s,l,h,p,g,x,w){const T=W_(p.horizontal)||p.vertical,I=s.get("icon-text-fit-padding").evaluate(l,{},h);let M,R=e;return e&&w!=="none"&&(n.allowVerticalPlacement&&p.vertical&&(M=v0(e,p.vertical,w,I,x,g)),T&&(R=v0(e,T,w,I,x,g))),{defaultShapedIcon:R,verticallyShapedIcon:M}}function iT(n,e,s,l,h,p,g,x,w,T,I,M,R,B,V,q,Z,$,ne,ae){let le=g.textMaxSize.evaluate(e,{},R);le===void 0?le=x*g.textScaleFactor:le*=g.textScaleFactor;const be=n.layers[0].layout,we=W_(s.horizontal)||s.vertical,ke=B.name==="globe",Le=Es,ze=n.tilePixelRatio*le/Le,rt=(gt=n.overscaling,n.zoom>18&&gt>2&&(gt>>=1),Math.max(At/(512*gt),1)*be.get("symbol-spacing")),Be=be.get("text-padding")*n.tilePixelRatio,st=be.get("icon-padding")*n.tilePixelRatio,ut=Oe(be.get("text-max-angle")),nt=be.get("icon-rotation-alignment")==="map"&&ae!=="point",ot=rt/2;var gt;n.hasAnyIconTextFit===!1&&Z!=="none"&&(n.hasAnyIconTextFit=!0);const tt=e.properties?+e.properties[wi]:null,ct=tt&&n.elevationFeatureIdToIndex?n.elevationFeatureIdToIndex.get(tt):65535,Xe=(He,_t,dt)=>{if(_t.x<0||_t.x>=At||_t.y<0||_t.y>=At)return;let Yt=null;if(ke){const{x:zt,y:Bt,z:St}=B.projectTilePoint(_t.x,_t.y,dt);Yt={anchor:new Wo(zt,Bt,St,0,void 0),up:B.upVector(dt,_t.x,_t.y)}}(function(zt,Bt,St,Gt,li,kt,jt,ti,di,Ii,_i,Ft,fi,Vi,de,fe,Ge,it,It,Ct,Ot,$t,ki,Mi,Ei,sr,kr,Ai,yr){const or=zt.addToLineVertexArray(Bt,Gt);let qi,vr,br,pr,xr,lr,Pi,cr=0,Rr=0,si=0,ji=0,wr=-1,Ur=-1;const Er={};let ds=oh("");const ur=St?St.anchor:Bt,as=Ai!=="none";let un=0,Ds=0;if(di._unevaluatedLayout.getValue("text-radial-offset")===void 0){const fs=di.layout.get("text-offset").evaluate(Ot,{},Ei);un=fs[0]*Es,Ds=fs[1]*Es}else un=di.layout.get("text-radial-offset").evaluate(Ot,{},Ei)*Es,Ds=j_;if(zt.allowVerticalPlacement&&li.vertical){const fs=li.vertical;if(de)lr=G_(fs),ti&&(Pi=G_(ti));else{const bs=di.layout.get("text-rotate").evaluate(Ot,{},Ei)+90;br=kg(Ii,ur,Bt,_i,Ft,fi,fs,Vi,bs,fe),ti&&(pr=kg(Ii,ur,Bt,_i,Ft,fi,ti,it,bs))}}if(kt){const fs=zt.iconSizeData,bs=di.layout.get("icon-rotate").evaluate(Ot,{},Ei),Os=D0(kt,bs,ki,as,$t.iconScaleFactor),Zs=ti?D0(ti,bs,ki,as,$t.iconScaleFactor):void 0;vr=kg(Ii,ur,Bt,_i,Ft,fi,kt,it,bs,null),cr=4*Os.length;let Vs=null;fs.kind==="source"?(Vs=[ho*di.layout.get("icon-size").evaluate(Ot,{},Ei)*$t.iconScaleFactor],Vs[0]>zl&&Di(`${zt.layerIds[0]}: Value for "icon-size" is >= ${Tf}. Reduce your "icon-size".`)):fs.kind==="composite"&&(Vs=[ho*$t.compositeIconSizes[0].evaluate(Ot,{},Ei)*$t.iconScaleFactor,ho*$t.compositeIconSizes[1].evaluate(Ot,{},Ei)*$t.iconScaleFactor],(Vs[0]>zl||Vs[1]>zl)&&Di(`${zt.layerIds[0]}: Value for "icon-size" is >= ${Tf}. Reduce your "icon-size".`)),zt.addSymbols(zt.icon,Os,Vs,Ct,It,Ot,void 0,St,Bt,or.lineStartIndex,or.lineLength,-1,Mi,Ei,sr,kr),wr=zt.icon.placedSymbolArray.length-1,Zs&&(Rr=4*Zs.length,zt.addSymbols(zt.icon,Zs,Vs,Ct,It,Ot,En.vertical,St,Bt,or.lineStartIndex,or.lineLength,-1,Mi,Ei,sr,kr),Ur=zt.icon.placedSymbolArray.length-1)}for(const fs in li.horizontal){const bs=fs,Os=li.horizontal[bs];qi||(ds=oh(Os.text),de?xr=G_(Os):qi=kg(Ii,ur,Bt,_i,Ft,fi,Os,Vi,di.layout.get("text-rotate").evaluate(Ot,{},Ei),fe));const Zs=Os.positionedLines.length===1;if(si+=j0(zt,St,Bt,Os,jt,di,de,Ot,fe,or,li.vertical?En.horizontal:En.horizontalOnly,Zs?JA(li.horizontal):[bs],Er,wr,$t,Mi,Ei,sr),Zs)break}li.vertical&&(ji+=j0(zt,St,Bt,li.vertical,jt,di,de,Ot,fe,or,En.vertical,["vertical"],Er,Ur,$t,Mi,Ei,sr));let Ls=-1;const dn=(fs,bs)=>fs?Math.max(fs,bs):bs;Ls=dn(xr,Ls),Ls=dn(lr,Ls),Ls=dn(Pi,Ls);const uo=Ls>-1?1:0;zt.glyphOffsetArray.length>=65535&&Di("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ot.sortKey!==void 0&&zt.addToSortKeyRanges(zt.symbolInstances.length,Ot.sortKey),zt.symbolInstances.emplaceBack(Bt.x,Bt.y,ur.x,ur.y,ur.z,Er.right>=0?Er.right:-1,Er.center>=0?Er.center:-1,Er.left>=0?Er.left:-1,Er.vertical>=0?Er.vertical:-1,wr,Ur,ds,qi!==void 0?qi:zt.collisionBoxArray.length,qi!==void 0?qi+1:zt.collisionBoxArray.length,br!==void 0?br:zt.collisionBoxArray.length,br!==void 0?br+1:zt.collisionBoxArray.length,vr!==void 0?vr:zt.collisionBoxArray.length,vr!==void 0?vr+1:zt.collisionBoxArray.length,pr||zt.collisionBoxArray.length,pr?pr+1:zt.collisionBoxArray.length,_i,si,ji,cr,Rr,uo,0,un,Ds,Ls,0,as?1:0,yr)})(n,_t,Yt,He,s,l,p,h,n.layers[0],n.collisionBoxArray,e.index,e.sourceLayerIndex,n.index,Be,ne,T,0,st,nt,$,e,g,I,M,R,V,q,Z,ct)};if(ae==="line")for(const He of pg(e.geometry,0,0,At,At)){const _t=YA(He,rt,ut,s.vertical||we,l,Le,ze,n.overscaling,At);for(const dt of _t)we&&rT(n,we.text,ot,dt)||Xe(He,dt,R)}else if(ae==="line-center"){for(const He of e.geometry)if(He.length>1){const _t=XA(He,ut,s.vertical||we,l,Le,ze);_t&&Xe(He,_t,R)}}else if(e.type==="Polygon")for(const He of lf(e.geometry,0)){const _t=ZA(He,16);Xe(He[0],new Wo(_t.x,_t.y,0,0,void 0),R)}else if(e.type==="LineString")for(const He of e.geometry)Xe(He,new Wo(He[0].x,He[0].y,0,0,void 0),R);else if(e.type==="Point")for(const He of e.geometry)for(const _t of He)Xe([_t],new Wo(_t.x,_t.y,0,0,void 0),R)}const Tf=255,zl=Tf*ho;function j0(n,e,s,l,h,p,g,x,w,T,I,M,R,B,V,q,Z,$){const ne=function(be,we,ke,Le,ze,rt,Be,st){const ut=[];if(we.positionedLines.length===0)return ut;const nt=Le.layout.get("text-rotate").evaluate(rt,{})*Math.PI/180,ot=function(He){const _t=He[0],dt=He[1],Yt=_t*dt;return Yt>0?[_t,-dt]:Yt<0?[-_t,dt]:_t===0?[dt,_t]:[dt,-_t]}(ke);let gt=Math.abs(we.top-we.bottom);for(const He of we.positionedLines)gt-=He.lineOffset;const tt=we.positionedLines.length,ct=gt/tt;let Xe=we.top-ke[1];for(let He=0;He<tt;++He){const _t=we.positionedLines[He];Xe=qA(we,ct,Xe,He);for(const dt of _t.positionedGlyphs){if(!dt.rect)continue;const Yt=dt.rect||{};let zt=jA+1,Bt=!0,St=1,Gt=0;if(dt.image){const Ot=Be.get(dt.image.toString());if(!Ot)continue;if(Ot.sdf){Di("SDF images are not supported in formatted text and will be ignored.");continue}Bt=!1,St=Ot.pixelRatio,zt=Uc/St}const li=(ze||st)&&dt.vertical,kt=dt.metrics.advance*dt.scale/2,jt=dt.metrics,ti=dt.rect;if(ti===null)continue;st&&we.verticalizable&&(Gt=dt.image?kt-dt.metrics.width*dt.scale/2:0);const di=ze?[dt.x+kt,dt.y]:[0,0];let Ii=[0,0],_i=[0,0],Ft=!1;ze||(li?(_i=[dt.x+kt+ot[0],dt.y+ot[1]-Gt],Ft=!0):Ii=[dt.x+kt+ke[0],dt.y+ke[1]-Gt]);const fi=ti.w*dt.scale/(St*(dt.localGlyph?Ma:1)),Vi=ti.h*dt.scale/(St*(dt.localGlyph?Ma:1));let de,fe,Ge,it;if(li){const Ot=dt.y-Xe,$t=new mt(-kt,kt-Ot),ki=-Math.PI/2,Mi=new mt(..._i);de=new mt(-kt+Ii[0],Ii[1]),de._rotateAround(ki,$t)._add(Mi),de.x+=-Ot+kt,de.y-=(jt.left-zt)*dt.scale;const Ei=dt.image?jt.advance*dt.scale:Es*dt.scale,sr=String.fromCodePoint(dt.glyph);IA(sr)?de.x+=(1-zt)*dt.scale:kA(sr)?de.x+=Ei-jt.height*dt.scale+(-zt-1)*dt.scale:de.x+=dt.image||jt.width+2*zt===ti.w&&jt.height+2*zt===ti.h?(Ei-Vi)/2:(Ei-(jt.height+2*zt)*dt.scale)/2,fe=new mt(de.x,de.y-fi),Ge=new mt(de.x+Vi,de.y),it=new mt(de.x+Vi,de.y-fi)}else{const Ot=(jt.left-zt)*dt.scale-kt+Ii[0],$t=(-jt.top-zt)*dt.scale+Ii[1],ki=Ot+fi,Mi=$t+Vi;de=new mt(Ot,$t),fe=new mt(ki,$t),Ge=new mt(Ot,Mi),it=new mt(ki,Mi)}if(nt){let Ot;Ot=ze?new mt(0,0):Ft?new mt(ot[0],ot[1]):new mt(ke[0],ke[1]),de._rotateAround(nt,Ot),fe._rotateAround(nt,Ot),Ge._rotateAround(nt,Ot),it._rotateAround(nt,Ot)}const It=new mt(0,0),Ct=new mt(0,0);ut.push({tl:de,tr:fe,bl:Ge,br:it,texPrimary:Yt,texSecondary:void 0,writingMode:we.writingMode,glyphOffset:di,sectionIndex:dt.sectionIndex,isSDF:Bt,pixelOffsetTL:It,pixelOffsetBR:Ct,minFontScaleX:0,minFontScaleY:0})}}return ut}(0,l,w,p,g,x,h,n.allowVerticalPlacement),ae=n.textSizeData;let le=null;ae.kind==="source"?(le=[ho*p.layout.get("text-size").evaluate(x,{},Z)*V.textScaleFactor],le[0]>zl&&Di(`${n.layerIds[0]}: Value for "text-size" is >= ${Tf}. Reduce your "text-size".`)):ae.kind==="composite"&&(le=[ho*V.compositeTextSizes[0].evaluate(x,{},Z)*V.textScaleFactor,ho*V.compositeTextSizes[1].evaluate(x,{},Z)*V.textScaleFactor],(le[0]>zl||le[1]>zl)&&Di(`${n.layerIds[0]}: Value for "text-size" is >= ${Tf}. Reduce your "text-size".`)),n.addSymbols(n.text,ne,le,w,g,x,I,e,s,T.lineStartIndex,T.lineLength,B,q,Z,$,!1);for(const be of M)R[be]=n.text.placedSymbolArray.length-1;return 4*ne.length}function W_(n){for(const e in n)return n[e];return null}function kg(n,e,s,l,h,p,g,x,w,T){let I=g.top,M=g.bottom,R=g.left,B=g.right;if(x0(g)&&g.collisionPadding){const V=g.collisionPadding;R-=V[0],I-=V[1],B+=V[2],M+=V[3]}if(w){const V=new mt(R,I),q=new mt(B,I),Z=new mt(R,M),$=new mt(B,M),ne=Oe(w);let ae=new mt(0,0);T&&(ae=new mt(T[0],T[1])),V._rotateAround(ne,ae),q._rotateAround(ne,ae),Z._rotateAround(ne,ae),$._rotateAround(ne,ae),R=Math.min(V.x,q.x,Z.x,$.x),B=Math.max(V.x,q.x,Z.x,$.x),I=Math.min(V.y,q.y,Z.y,$.y),M=Math.max(V.y,q.y,Z.y,$.y)}return n.emplaceBack(e.x,e.y,e.z,s.x,s.y,R,I,B,M,x,l,h,p),n.length-1}function G_(n){x0(n)&&n.collisionPadding&&(n.top-=n.collisionPadding[1],n.bottom+=n.collisionPadding[3]);const e=n.bottom-n.top;return e>0?Math.max(10,e):null}function rT(n,e,s,l){const h=n.compareText;if(e in h){const p=h[e];for(let g=p.length-1;g>=0;g--)if(l.dist(p[g])<s)return!0}else h[e]=[];return h[e].push(l),!1}function H0(n,e){const s=n.fovAboveCenter,l=n.elevation?n.elevation.getMinElevationBelowMSL()*e:0,h=(n._camera.position[2]*n.worldSize-l)/Math.cos(n._pitch),p=Math.sin(s)*h/Math.sin(Math.max(Math.PI/2-n._pitch-s,.01));let g=Math.sin(n._pitch)*p+h;const x=h*(1/n._horizonShift);if(!n.elevation||n.elevation.exaggeration()===0){let w=Math.max(n.zoom-17,0);n.isOrthographic&&(w/=10),g*=1+w}return Math.min(1.01*g,x)}function Ef(n,e){if(!e.isReprojectedInTileSpace)return{scale:1<<n.z,x:n.x,y:n.y,x2:n.x+1,y2:n.y+1,projection:e};const s=Math.pow(2,-n.z),l=n.x*s,h=(n.x+1)*s,p=n.y*s,g=(n.y+1)*s,x=xe(l),w=xe(h),T=_e(p),I=_e(g),M=e.project(x,T),R=e.project(w,T),B=e.project(w,I),V=e.project(x,I);let q=Math.min(M.x,R.x,B.x,V.x),Z=Math.min(M.y,R.y,B.y,V.y),$=Math.max(M.x,R.x,B.x,V.x),ne=Math.max(M.y,R.y,B.y,V.y);const ae=s/16;function le(we,ke,Le,ze,rt,Be){const st=(Le+rt)/2,ut=(ze+Be)/2,nt=e.project(xe(st),_e(ut)),ot=Math.max(0,q-nt.x,Z-nt.y,nt.x-$,nt.y-ne);q=Math.min(q,nt.x),$=Math.max($,nt.x),Z=Math.min(Z,nt.y),ne=Math.max(ne,nt.y),ot>ae&&(le(we,nt,Le,ze,st,ut),le(nt,ke,st,ut,rt,Be))}le(M,R,l,p,h,p),le(R,B,h,p,h,g),le(B,V,h,g,l,g),le(V,M,l,g,l,p),q-=ae,Z-=ae,$+=ae,ne+=ae;const be=1/Math.max($-q,ne-Z);return{scale:be,x:q*be,y:Z*be,x2:$*be,y2:ne*be,projection:e}}function W0(n,{x:e,y:s},l=0){return new mt(((e-l)*n.scale-n.x)*At,(s*n.scale-n.y)*At)}const sT=H(new Float32Array(16));class Rl{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,s){return{x:0,y:0,z:0}}unproject(e,s){return new Y(0,0)}projectTilePoint(e,s,l){return{x:e,y:s,z:0}}locationPoint(e,s,l,h=!0){return e._coordinatePoint(e.locationCoordinate(s,l),h)}pixelsPerMeter(e,s){return me(1,e)*s}pixelSpaceConversion(e,s,l){return 1}farthestPixelDistance(e){return H0(e,e.pixelsPerMeter)}pointCoordinate(e,s,l,h){const p=e.horizonLineFromTop(!1),g=new mt(s,Math.max(p,l));return e.rayIntersectionCoordinate(e.pointRayIntersection(g,h))}pointCoordinate3D(e,s,l){const h=new mt(s,l);if(e.elevation)return e.elevation.pointCoordinate(h);{const p=this.pointCoordinate(e,h.x,h.y,0);return[p.x,p.y,p.z]}}isPointAboveHorizon(e,s){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,s.x,s.y);const l=e.horizonLineFromTop();return s.y<l}createInversionMatrix(e,s){return sT}createTileMatrix(e,s,l){let h,p,g;const x=l.canonical,w=H(new Float64Array(16));if(this.isReprojectedInTileSpace){const T=Ef(x,this);h=1,p=T.x+l.wrap*T.scale,g=T.y,ue(w,w,[h/T.scale,h/T.scale,e.pixelsPerMeter/s])}else h=s/e.zoomScale(x.z),p=(x.x+Math.pow(2,x.z)*l.wrap)*h,g=x.y*h;return ie(w,w,[p,g,0]),ue(w,w,[h/At,h/At,1]),w}upVector(e,s,l){return[0,0,1]}upVectorScale(e,s,l){return{metersToTile:1}}}class nT extends Rl{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[s,l]=this.parallels=e.parallels||[29.5,45.5],h=Math.sin(Oe(s));this.n=(h+Math.sin(Oe(l)))/2,this.c=1+h*(2*this.n-h),this.r0=Math.sqrt(this.c)/this.n}project(e,s){const{n:l,c:h,r0:p}=this,g=Oe(e-this.center[0]),x=Oe(s),w=Math.sqrt(h-2*l*Math.sin(x))/l;return{x:w*Math.sin(g*l),y:w*Math.cos(g*l)-p,z:0}}unproject(e,s){const{n:l,c:h,r0:p}=this,g=p+s;let x=Math.atan2(e,Math.abs(g))*Math.sign(g);g*l<0&&(x-=Math.PI*Math.sign(e)*Math.sign(g));const w=Oe(this.center[0])*l;x=De(x,-Math.PI-w,Math.PI-w);const T=Ee(K(x/l)+this.center[0],-180,180),I=Math.asin(Ee((h-(e*e+g*g)*l*l)/(2*l),-1,1)),M=Ee(K(I),-85.051129,Ae);return new Y(T,M)}}const Cf=1.340264,If=-.081106,kf=893e-6,Mf=.003796,Mg=Math.sqrt(3)/2;class aT extends Rl{project(e,s){s=s/180*Math.PI,e=e/180*Math.PI;const l=Math.asin(Mg*Math.sin(s)),h=l*l,p=h*h*h;return{x:.5*(e*Math.cos(l)/(Mg*(Cf+3*If*h+p*(7*kf+9*Mf*h)))/Math.PI+.5),y:1-.5*(l*(Cf+If*h+p*(kf+Mf*h))/Math.PI+1),z:0}}unproject(e,s){e=(2*e-.5)*Math.PI;let l=s=(2*(1-s)-1)*Math.PI,h=l*l,p=h*h*h;for(let I,M,R,B=0;B<12&&(M=l*(Cf+If*h+p*(kf+Mf*h))-s,R=Cf+3*If*h+p*(7*kf+9*Mf*h),I=M/R,l=Ee(l-I,-Math.PI/3,Math.PI/3),h=l*l,p=h*h*h,!(Math.abs(I)<1e-12));++B);const g=Mg*e*(Cf+3*If*h+p*(7*kf+9*Mf*h))/Math.cos(l),x=Math.asin(Math.sin(l)/Mg),w=Ee(180*g/Math.PI,-180,180),T=Ee(180*x/Math.PI,-85.051129,Ae);return new Y(w,T)}}class oT extends Rl{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,s){return{x:.5+e/360,y:.5-s/360,z:0}}unproject(e,s){const l=360*(e-.5),h=Ee(360*(.5-s),-85.051129,Ae);return new Y(l,h)}}const Au=Math.PI/2;function Pg(n){return Math.tan((Au+n)/2)}class lT extends Rl{constructor(e){super(e),this.center=e.center||[0,30];const[s,l]=this.parallels=e.parallels||[30,30];let h=Oe(s),p=Oe(l);this.southernCenter=h+p<0,this.southernCenter&&(h=-h,p=-p);const g=Math.cos(h),x=Pg(h);this.n=h===p?Math.sin(h):Math.log(g/Math.cos(p))/Math.log(Pg(p)/x),this.f=g*Math.pow(Pg(h),this.n)/this.n}project(e,s){s=Oe(s),this.southernCenter&&(s=-s),e=Oe(e-this.center[0]);const l=1e-6,{n:h,f:p}=this;p>0?s<-Au+l&&(s=-Au+l):s>Au-l&&(s=Au-l);const g=p/Math.pow(Pg(s),h);let x=g*Math.sin(h*e),w=p-g*Math.cos(h*e);return x=.5*(x/Math.PI+.5),w=.5*(w/Math.PI+.5),{x,y:this.southernCenter?w:1-w,z:0}}unproject(e,s){e=(2*e-.5)*Math.PI,this.southernCenter&&(s=1-s),s=(2*(1-s)-.5)*Math.PI;const{n:l,f:h}=this,p=h-s,g=Math.sign(p),x=Math.sign(l)*Math.sqrt(e*e+p*p);let w=Math.atan2(e,Math.abs(p))*g;p*l<0&&(w-=Math.PI*Math.sign(e)*g);const T=Ee(K(w/l)+this.center[0],-180,180),I=Ee(K(2*Math.atan(Math.pow(h/x,1/l))-Au),-85.051129,Ae);return new Y(T,this.southernCenter?-I:I)}}class G0 extends Rl{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,s){return{x:he(e),y:ye(s),z:0}}unproject(e,s){const l=xe(e),h=_e(s);return new Y(l,h)}}const X0=Oe(Ae);class cT extends Rl{project(e,s){const l=(s=Oe(s))*s,h=l*l;return{x:.5*((e=Oe(e))*(.8707-.131979*l+h*(h*(.003971*l-.001529*h)-.013791))/Math.PI+.5),y:1-.5*(s*(1.007226+l*(.015085+h*(.028874*l-.044475-.005916*h)))/Math.PI+1),z:0}}unproject(e,s){e=(2*e-.5)*Math.PI;let l=s=(2*(1-s)-1)*Math.PI,h=25,p=0,g=l*l;do{g=l*l;const T=g*g;p=(l*(1.007226+g*(.015085+T*(.028874*g-.044475-.005916*T)))-s)/(1.007226+g*(.045255+T*(.259866*g-.311325-.005916*11*T))),l=Ee(l-p,-X0,X0)}while(Math.abs(p)>1e-6&&--h>0);g=l*l;const x=Ee(K(e/(.8707+g*(g*(g*g*g*(.003971-.001529*g)-.013791)-.131979))),-180,180),w=K(l);return new Y(x,w)}}const Y0=Oe(Ae);class hT extends Rl{project(e,s){s=Oe(s),e=Oe(e);const l=Math.cos(s),h=2/Math.PI,p=Math.acos(l*Math.cos(e/2)),g=Math.sin(p)/p,x=.5*(e*h+2*l*Math.sin(e/2)/g)||0,w=.5*(s+Math.sin(s)/g)||0;return{x:.5*(x/Math.PI+.5),y:1-.5*(w/Math.PI+1),z:0}}unproject(e,s){let l=e=(2*e-.5)*Math.PI,h=s=(2*(1-s)-1)*Math.PI,p=25;const g=1e-6;let x=0,w=0;do{const T=Math.cos(h),I=Math.sin(h),M=2*I*T,R=I*I,B=T*T,V=Math.cos(l/2),q=Math.sin(l/2),Z=2*V*q,$=q*q,ne=1-B*V*V,ae=ne?1/ne:0,le=ne?Math.acos(T*V)*Math.sqrt(1/ne):0,be=.5*(2*le*T*q+2*l/Math.PI)-e,we=.5*(le*I+h)-s,ke=.5*ae*(B*$+le*T*V*R)+1/Math.PI,Le=ae*(Z*M/4-le*I*q),ze=.125*ae*(M*q-le*I*B*Z),rt=.5*ae*(R*V+le*$*T)+.5,Be=Le*ze-rt*ke;x=(we*Le-be*rt)/Be,w=(be*ze-we*ke)/Be,l=Ee(l-x,-Math.PI,Math.PI),h=Ee(h-w,-Y0,Y0)}while((Math.abs(x)>g||Math.abs(w)>g)&&--p>0);return new Y(K(l),K(h))}}class q0 extends Rl{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Oe(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,s){const{scale:l,cosPhi:h}=this;return{x:Oe(e)*h*l+.5,y:-Math.sin(Oe(s))/h*l+.5,z:0}}unproject(e,s){const{scale:l,cosPhi:h}=this,p=-(s-.5)/l,g=Ee(K((e-.5)/l)/h,-180,180),x=Math.asin(Ee(p*h,-1,1)),w=Ee(K(x),-85.051129,Ae);return new Y(g,w)}}class uT extends G0{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,s,l){const h=tf(e,s,l);return Wi(h,h,ng(lo(l))),{x:h[0],y:h[1],z:h[2]}}locationPoint(e,s,l){const h=F(s.lat,s.lng),p=mi([],h),g=l?e._centerAltitude+l:e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(s),e._centerAltitude):e._centerAltitude;Hi(h,h,p,me(1,0)*At*g);const x=H(new Float64Array(16));return ee(x,e.pixelMatrix,e.globeMatrix),Wi(h,h,x),new mt(h[0],h[1])}pixelsPerMeter(e,s){return me(1,0)*s}pixelSpaceConversion(e,s,l){const h=me(1,e)*s,p=ei(me(1,45)*s,h,l);return this.pixelsPerMeter(e,s)/p}createTileMatrix(e,s,l){const h=Qm(lo(l.canonical));return ee(new Float64Array(16),e.globeMatrix,h)}createInversionMatrix(e,s){const{center:l}=e,h=ng(lo(s));return ce(h,h,Oe(l.lng)),ve(h,h,Oe(l.lat)),ue(h,h,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(h)}pointCoordinate(e,s,l,h){return xx(e,s,l,!0)||new $e(0,0)}pointCoordinate3D(e,s,l){const h=this.pointCoordinate(e,s,l,0);return[h.x,h.y,h.z]}isPointAboveHorizon(e,s){return!xx(e,s.x,s.y,!1)}farthestPixelDistance(e){const s=function(h,p){const g=h.cameraToCenterDistance,x=h._centerAltitude*p,w=h._camera,T=h._camera.forward(),I=Lt([],Kt([],T,-g),[0,0,x]),M=h.worldSize/(2*Math.PI),R=[0,0,-M],B=h.width/h.height,V=Math.tan(h.fovAboveCenter),q=Kt([],w.up(),V),Z=Kt([],w.right(),V*B),$=mi([],Lt([],Lt([],T,q),Z)),ne=[];let ae;if(new Yi(I,$).closestPointOnSphere(R,M,ne)){const le=Lt([],ne,R),be=jr([],le,I);ae=Math.cos(h.fovAboveCenter)*bt(be)}else{const le=jr([],I,R),be=jr([],R,I);mi(be,be);const we=bt(le)-M;ae=Math.sqrt(we*(we+2*M));const ke=Math.acos(ae/(M+we))-Math.acos(Ci(T,be));ae*=Math.cos(ke)}return 1.01*ae}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),l=kl(e.zoom);if(l>0){const h=H0(e,me(1,e.center.lat)*e.worldSize),p=e.worldSize/(2*Math.PI),g=Math.max(e.width,e.height)/e.worldSize*Math.PI;return ei(s,h+p*(1-Math.cos(g)),Math.pow(l,10))}return s}upVector(e,s,l){return tf(s,l,e,1)}upVectorScale(e){return{metersToTile:ig(sg(lo(e)))}}}function Z0(n){const e=n.parallels,s=!!e&&Math.abs(e[0]+e[1])<.01;switch(n.name){case"mercator":return new G0(n);case"equirectangular":return new oT(n);case"naturalEarth":return new cT(n);case"equalEarth":return new aT(n);case"winkelTripel":return new hT(n);case"albers":return s?new q0(n):new nT(n);case"lambertConformalConic":return s?new q0(n):new lT(n);case"globe":return new uT(n)}throw new Error(`Invalid projection name: ${n.name}`)}const dT=ht.types,fT=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Lg(n,e,s,l,h,p,g,x,w,T,I,M,R){const B=x?Math.min(zl,Math.round(x[0])):0,V=x?Math.min(zl,Math.round(x[1])):0;n.emplaceBack(e,s,Math.round(32*l),Math.round(32*h),p,g,(B<<1)+(w?1:0),V,16*T,16*I,256*M,256*R)}function zg(n,e,s){n.emplaceBack(e,s)}function Rg(n,e,s,l,h,p,g){n.emplaceBack(e,s,l,h,p,g)}const Dg=(n,e,s,l)=>{for(let h=0;h<e;h++)n.emplaceBack(s[0],s[1],s[2],l[0],l[1],l[2])};function Og(n,e,s,l,h){n.emplaceBack(e,s,l,h),n.emplaceBack(e,s,l,h),n.emplaceBack(e,s,l,h),n.emplaceBack(e,s,l,h)}function pT(n){for(const e of n.sections)if(Vm(e.text))return!0;return!1}class X_{constructor(e){this.layoutVertexArray=new Wd,this.indexArray=new gs,this.programConfigurations=e,this.segments=new zr,this.dynamicLayoutVertexArray=new Wn,this.opacityVertexArray=new Sl,this.placedSymbolArray=new lu,this.iconTransitioningVertexArray=new hs,this.globeExtVertexArray=new Gd,this.zOffsetVertexArray=new ro,this.orientationVertexArray=new Ec}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,s,l,h,p){this.isEmpty()||(l&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,yA.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,vA.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,fT,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,SA.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,xA.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||p)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,bA.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=e.createVertexBuffer(this.orientationVertexArray,wA.members,!0)),this.opacityVertexBuffer.itemSize=1),(l||h)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}Dt(X_,"SymbolBuffers");class Y_{constructor(e,s,l){this.layoutVertexArray=new e,this.layoutAttributes=s,this.indexArray=new l,this.segments=new zr,this.collisionVertexArray=new Yd,this.collisionVertexArrayExt=new Wn}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,AA.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,TA.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Dt(Y_,"CollisionBuffers");class Fg{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(g=>g.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=H([]),this.placementViewportMatrix=H([]);const s=this.layers[0]._unevaluatedLayout._values;this.worldview=e.worldview,this.textSizeData=A0(this.zoom,s["text-size"],this.worldview),this.iconSizeData=A0(this.zoom,s["icon-size"],this.worldview);const l=this.layers[0].layout,h=l.get("symbol-sort-key"),p=l.get("symbol-z-order");this.lut=e.lut,this.canOverlap=l.get("text-allow-overlap")||l.get("icon-allow-overlap")||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey=p!=="viewport-y"&&h.constantOr(1)!==void 0,this.sortFeaturesByY=(p==="viewport-y"||p==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=l.get("text-writing-mode").map(g=>En[g]),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1}createArrays(){this.text=new X_(new Gn(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("text")||e.startsWith("symbol"))),this.icon=new X_(new Gn(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("icon")||e.startsWith("symbol"))),this.glyphOffsetArray=new Yp,this.lineVertexArray=new qp,this.symbolInstances=new Xp}calculateGlyphDependencies(e,s,l,h,p){for(const g of e){const x=g.codePointAt(0);if(x===void 0)break;if(s[x]=!0,h&&p&&x<=65535){const w=bf[g];w&&(s[w.charCodeAt(0)]=!0)}}}updateFootprints(e,s){}updateReplacement(e,s){if(s.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=s.updateTime;const l=s.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!ug(this.activeReplacements,l)&&(this.activeReplacements=l,!0)}populate(e,s,l,h){const p=this.layers[0],g=p.layout,x=this.projection.name==="globe",w=g.get("text-font"),T=g.get("text-field"),I=g.get("icon-image"),[M,R]=g.get("icon-size-scale-range"),B=Ee(s.scaleFactor||1,M,R),V=(T.value.kind!=="constant"||T.value.value instanceof Ws&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&(w.value.kind!=="constant"||w.value.value.length>0),q=I.value.kind!=="constant"||!!I.value.value||Object.keys(I.parameters).length>0,Z=g.get("symbol-sort-key");if(this.features=[],!V&&!q)return;const $=s.iconDependencies,ne=s.glyphDependencies,ae=s.availableImages,le=new _r(this.zoom,{worldview:this.worldview});for(const{feature:be,id:we,index:ke,sourceLayerIndex:Le}of e){const ze=p._featureFilter.needGeometry,rt=pt(be,ze);if(!p._featureFilter.filter(le,rt,l))continue;if(ze||(rt.geometry=Pt(be,l,h)),x&&be.type!==1&&l.z<=5){const ot=rt.geometry,gt=.98078528056,tt=(ct,Xe)=>Ci(tf(ct.x,ct.y,l,1),tf(Xe.x,Xe.y,l,1))<gt;for(let ct=0;ct<ot.length;ct++)ot[ct]=Qe(ot[ct],tt)}let Be,st;if(V){const ot=p.getValueAndResolveTokens("text-field",rt,l,ae),gt=Ws.factory(ot);pT(gt)&&(this.hasRTLText=!0),(!this.hasRTLText||Zh()==="unavailable"||this.hasRTLText&&ia.isParsed())&&(Be=CA(gt,p,rt))}if(q){const ot=p.getValueAndResolveTokens("icon-image",rt,l,ae);st=typeof ot=="string"?Ks.build(ot):ot}if(!Be&&!st)continue;const ut=this.sortFeaturesByKey?Z.evaluate(rt,{},l):void 0,nt={id:we,text:Be,icon:st,index:ke,sourceLayerIndex:Le,geometry:rt.geometry,properties:be.properties,type:dT[be.type],sortKey:ut};if(this.features.push(nt),st){const ot=this.layers[0]._unevaluatedLayout._values,{iconPrimary:gt,iconSecondary:tt}=N0(st,this.iconSizeData,ot["icon-size"],l,this.zoom,nt,this.pixelRatio,B,this.worldview),ct=gt.id.toString();if($.has(ct)?$.get(ct).push(gt):$.set(ct,[gt]),tt){this.hasAnySecondaryIcon=!0;const Xe=tt.id.toString();$.has(Xe)?$.get(Xe).push(tt):$.set(Xe,[tt])}}if(Be){const ot=w.evaluate(rt,{},l).join(","),gt=g.get("text-rotation-alignment")==="map"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(En.vertical)>=0;for(const tt of Be.sections)if(tt.image){const ct=tt.image.getPrimary().scaleSelf(this.pixelRatio),Xe=ct.id.toString(),He=$.get(Xe)||[];He.push(ct),$.set(Xe,He)}else{const ct=Rd(Be.toString()),Xe=tt.fontStack||ot,He=ne[Xe]=ne[Xe]||{};this.calculateGlyphDependencies(tt.text,He,gt,this.allowVerticalPlacement,ct)}}}if(g.get("symbol-placement")==="line"&&(this.features=function(be){const we={},ke={},Le=[];let ze=0;function rt(nt){Le.push(be[nt]),ze++}function Be(nt,ot,gt){const tt=ke[nt];return delete ke[nt],ke[ot]=tt,Le[tt].geometry[0].pop(),Le[tt].geometry[0]=Le[tt].geometry[0].concat(gt[0]),tt}function st(nt,ot,gt){const tt=we[ot];return delete we[ot],we[nt]=tt,Le[tt].geometry[0].shift(),Le[tt].geometry[0]=gt[0].concat(Le[tt].geometry[0]),tt}function ut(nt,ot,gt){const tt=gt?ot[0][ot[0].length-1]:ot[0][0];return`${nt}:${tt.x}:${tt.y}`}for(let nt=0;nt<be.length;nt++){const ot=be[nt],gt=ot.geometry,tt=ot.text?ot.text.toString():null;if(!tt){rt(nt);continue}const ct=ut(tt,gt),Xe=ut(tt,gt,!0);if(ct in ke&&Xe in we&&ke[ct]!==we[Xe]){const He=st(ct,Xe,gt),_t=Be(ct,Xe,Le[He].geometry);delete we[ct],delete ke[Xe],ke[ut(tt,Le[_t].geometry,!0)]=_t,Le[He].geometry=null}else ct in ke?Be(ct,Xe,gt):Xe in we?st(ct,Xe,gt):(rt(nt),we[ct]=ze-1,ke[Xe]=ze-1)}return Le.filter(nt=>nt.geometry)}(this.features)),g.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",s.elevationFeatures){!this.elevationFeatures&&s.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const be of s.elevationFeatures)this.elevationFeatureIdToIndex.set(be.id,this.elevationFeatures.length),this.elevationFeatures.push(be)}}else g.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((be,we)=>be.sortKey-we.sortKey)}update(e,s,l,h,p,g,x){this.text.programConfigurations.updatePaintArrays(e,s,p,l,h,g,x,this.worldview),this.icon.programConfigurations.updatePaintArrays(e,s,p,l,h,g,x,this.worldview)}updateRoadElevation(e){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let s=!1;const l=Ne(e),h=1/l;let p=!1,g=!1;for(let x=0;x<this.symbolInstances.length;x++){const w=this.symbolInstances.get(x),T=Tt(1,0,0),I=Tt(0,1,0),{numHorizontalGlyphVertices:M,numVerticalGlyphVertices:R,numIconVertices:B,numVerticalIconVertices:V}=w,q=M>0||R>0,Z=B>0,$=this.elevationFeatures[w.elevationFeatureIndex];if($){const ne=new mt(w.tileAnchorX,w.tileAnchorY),ae=.075+$.pointElevation(ne);w.zOffset!==ae&&(s=!0,w.zOffset=ae);const le=$.computeSlopeNormal(ne,h),be=Yo(pa(),Tt(0,0,1),le);nn(T,T,be),nn(I,I,be),T[2]*=l,I[2]*=l,T[0]===1&&T[1]===0&&T[2]===0&&I[0]===0&&I[1]===1&&I[2]===0||(p=p||q,g=g||Z)}if(q&&(Dg(this.text.orientationVertexArray,M,T,I),Dg(this.text.orientationVertexArray,R,T,I)),Z){const{placedIconSymbolIndex:ne,verticalPlacedIconSymbolIndex:ae}=w;ne>=0&&Dg(this.icon.orientationVertexArray,B,T,I),ae>=0&&Dg(this.icon.orientationVertexArray,V,T,I)}}p||(this.text.orientationVertexArray=void 0),g||(this.icon.orientationVertexArray=void 0),s&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const e=(p,g,x)=>{l+=g,l>p.length&&p.resize(l);for(let w=-g;w<0;w++)p.emplace(w+l,x)},s=(p,g,x)=>{h+=g,h>p.length&&p.resize(h);for(let w=-g;w<0;w++)p.emplace(w+h,x)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let l=0,h=0;for(let p=0;p<this.symbolInstances.length;p++){const g=this.symbolInstances.get(p),{numHorizontalGlyphVertices:x,numVerticalGlyphVertices:w,numIconVertices:T}=g,I=g.zOffset,M=T>0;if((x>0||w>0)&&(e(this.text.zOffsetVertexArray,x,I),e(this.text.zOffsetVertexArray,w,I)),M){const{placedIconSymbolIndex:R,verticalPlacedIconSymbolIndex:B}=g;R>=0&&s(this.icon.zOffsetVertexArray,T,I),B>=0&&s(this.icon.zOffsetVertexArray,g.numVerticalIconVertices,I)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Z0(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,s){const l=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:h,y:p}of s)this.lineVertexArray.emplaceBack(h,p);return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}}addSymbols(e,s,l,h,p,g,x,w,T,I,M,R,B,V,q,Z){const $=e.indexArray,ne=e.layoutVertexArray,ae=e.globeExtVertexArray,le=e.segments.prepareSegment(4*s.length,ne,$,this.canOverlap?g.sortKey:void 0),be=this.glyphOffsetArray.length,we=le.vertexLength,ke=this.allowVerticalPlacement&&x===En.vertical?Math.PI/2:0,Le=g.text&&g.text.sections;for(let rt=0;rt<s.length;rt++){const{tl:Be,tr:st,bl:ut,br:nt,texPrimary:ot,texSecondary:gt,pixelOffsetTL:tt,pixelOffsetBR:ct,minFontScaleX:Xe,minFontScaleY:He,glyphOffset:_t,isSDF:dt,sectionIndex:Yt}=s[rt],zt=le.vertexLength,Bt=_t[1];if(Lg(ne,T.x,T.y,Be.x,Bt+Be.y,ot.x,ot.y,l,dt,tt.x,tt.y,Xe,He),Lg(ne,T.x,T.y,st.x,Bt+st.y,ot.x+ot.w,ot.y,l,dt,ct.x,tt.y,Xe,He),Lg(ne,T.x,T.y,ut.x,Bt+ut.y,ot.x,ot.y+ot.h,l,dt,tt.x,ct.y,Xe,He),Lg(ne,T.x,T.y,nt.x,Bt+nt.y,ot.x+ot.w,ot.y+ot.h,l,dt,ct.x,ct.y,Xe,He),w){const{x:St,y:Gt,z:li}=w.anchor,[kt,jt,ti]=w.up;Rg(ae,St,Gt,li,kt,jt,ti),Rg(ae,St,Gt,li,kt,jt,ti),Rg(ae,St,Gt,li,kt,jt,ti),Rg(ae,St,Gt,li,kt,jt,ti),Og(e.dynamicLayoutVertexArray,St,Gt,li,ke)}else Og(e.dynamicLayoutVertexArray,T.x,T.y,T.z,ke);if(Z){const St=gt||ot;zg(e.iconTransitioningVertexArray,St.x,St.y),zg(e.iconTransitioningVertexArray,St.x+St.w,St.y),zg(e.iconTransitioningVertexArray,St.x,St.y+St.h),zg(e.iconTransitioningVertexArray,St.x+St.w,St.y+St.h)}$.emplaceBack(zt,zt+1,zt+2),$.emplaceBack(zt+1,zt+2,zt+3),le.vertexLength+=4,le.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(_t[0]),rt!==s.length-1&&Yt===s[rt+1].sectionIndex||e.programConfigurations.populatePaintArrays(ne.length,g,g.index,{},B,V,q,Le&&Le[Yt],this.worldview)}const ze=w?w.anchor:T;e.placedSymbolArray.emplaceBack(ze.x,ze.y,ze.z,T.x,T.y,be,this.glyphOffsetArray.length-be,we,I,M,T.segment,l?l[0]:0,l?l[1]:0,h[0],h[1],x,0,0,0,R,0)}_commitLayoutVertex(e,s,l,h,p,g,x){e.emplaceBack(s,l,h,p,g,Math.round(x.x),Math.round(x.y))}_addCollisionDebugVertices(e,s,l,h,p,g,x){const w=l.segments.prepareSegment(4,l.layoutVertexArray,l.indexArray),T=w.vertexLength,I=x.tileAnchorX,M=x.tileAnchorY;for(let B=0;B<4;B++)l.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(l.collisionVertexArrayExt,s,e.padding,x.zOffset),this._commitLayoutVertex(l.layoutVertexArray,h,p,g,I,M,new mt(e.x1,e.y1)),this._commitLayoutVertex(l.layoutVertexArray,h,p,g,I,M,new mt(e.x2,e.y1)),this._commitLayoutVertex(l.layoutVertexArray,h,p,g,I,M,new mt(e.x2,e.y2)),this._commitLayoutVertex(l.layoutVertexArray,h,p,g,I,M,new mt(e.x1,e.y2)),w.vertexLength+=4;const R=l.indexArray;R.emplaceBack(T,T+1),R.emplaceBack(T+1,T+2),R.emplaceBack(T+2,T+3),R.emplaceBack(T+3,T),w.primitiveLength+=4}_addTextDebugCollisionBoxes(e,s,l,h,p,g){for(let x=h;x<p;x++){const w=l.get(x),T=this.getSymbolInstanceTextSize(e,g,s,x);this._addCollisionDebugVertices(w,T,this.textCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,g)}}_addIconDebugCollisionBoxes(e,s,l,h,p,g){for(let x=h;x<p;x++){const w=l.get(x),T=this.getSymbolInstanceIconSize(e,s,g.placedIconSymbolIndex);this._addCollisionDebugVertices(w,T,this.iconCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,g)}}generateCollisionDebugBuffers(e,s,l){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Y_(ru,h0.members,hs),this.iconCollisionBox=new Y_(ru,h0.members,hs);const h=Sf(this.iconSizeData,e),p=Sf(this.textSizeData,e,l);for(let g=0;g<this.symbolInstances.length;g++){const x=this.symbolInstances.get(g);this._addTextDebugCollisionBoxes(p,e,s,x.textBoxStartIndex,x.textBoxEndIndex,x),this._addTextDebugCollisionBoxes(p,e,s,x.verticalTextBoxStartIndex,x.verticalTextBoxEndIndex,x),this._addIconDebugCollisionBoxes(h,e,s,x.iconBoxStartIndex,x.iconBoxEndIndex,x),this._addIconDebugCollisionBoxes(h,e,s,x.verticalIconBoxStartIndex,x.verticalIconBoxEndIndex,x)}}getSymbolInstanceTextSize(e,s,l,h){const p=this.text.placedSymbolArray.get(s.rightJustifiedTextSymbolIndex>=0?s.rightJustifiedTextSymbolIndex:s.centerJustifiedTextSymbolIndex>=0?s.centerJustifiedTextSymbolIndex:s.leftJustifiedTextSymbolIndex>=0?s.leftJustifiedTextSymbolIndex:s.verticalPlacedTextSymbolIndex>=0?s.verticalPlacedTextSymbolIndex:h),g=N_(this.textSizeData,e,p)/Es;return this.tilePixelRatio*g}getSymbolInstanceIconSize(e,s,l){const h=this.icon.placedSymbolArray.get(l),p=N_(this.iconSizeData,e,h);return this.tilePixelRatio*p}_commitDebugCollisionVertexUpdate(e,s,l,h){e.emplaceBack(s,-l,-l,h),e.emplaceBack(s,l,-l,h),e.emplaceBack(s,l,l,h),e.emplaceBack(s,-l,l,h)}_updateTextDebugCollisionBoxes(e,s,l,h,p,g,x){for(let w=h;w<p;w++){const T=l.get(w),I=this.getSymbolInstanceTextSize(e,g,s,w);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,I,T.padding,g.zOffset)}}_updateIconDebugCollisionBoxes(e,s,l,h,p,g,x){for(let w=h;w<p;w++){const T=l.get(w),I=this.getSymbolInstanceIconSize(e,s,g.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,I,T.padding,g.zOffset)}}updateCollisionDebugBuffers(e,s,l,h){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const p=Sf(this.iconSizeData,e,h),g=Sf(this.textSizeData,e,l);for(let x=0;x<this.symbolInstances.length;x++){const w=this.symbolInstances.get(x);this._updateTextDebugCollisionBoxes(g,e,s,w.textBoxStartIndex,w.textBoxEndIndex,w,l),this._updateTextDebugCollisionBoxes(g,e,s,w.verticalTextBoxStartIndex,w.verticalTextBoxEndIndex,w,l),this._updateIconDebugCollisionBoxes(p,e,s,w.iconBoxStartIndex,w.iconBoxEndIndex,w,h),this._updateIconDebugCollisionBoxes(p,e,s,w.verticalIconBoxStartIndex,w.verticalIconBoxEndIndex,w,h)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,s,l,h,p,g,x,w,T){const I={};if(s<l){const{x1:M,y1:R,x2:B,y2:V,padding:q,projectedAnchorX:Z,projectedAnchorY:$,projectedAnchorZ:ne,tileAnchorX:ae,tileAnchorY:le,featureIndex:be}=e.get(s);I.textBox={x1:M,y1:R,x2:B,y2:V,padding:q,projectedAnchorX:Z,projectedAnchorY:$,projectedAnchorZ:ne,tileAnchorX:ae,tileAnchorY:le},I.textFeatureIndex=be}if(h<p){const{x1:M,y1:R,x2:B,y2:V,padding:q,projectedAnchorX:Z,projectedAnchorY:$,projectedAnchorZ:ne,tileAnchorX:ae,tileAnchorY:le,featureIndex:be}=e.get(h);I.verticalTextBox={x1:M,y1:R,x2:B,y2:V,padding:q,projectedAnchorX:Z,projectedAnchorY:$,projectedAnchorZ:ne,tileAnchorX:ae,tileAnchorY:le},I.verticalTextFeatureIndex=be}if(g<x){const{x1:M,y1:R,x2:B,y2:V,padding:q,projectedAnchorX:Z,projectedAnchorY:$,projectedAnchorZ:ne,tileAnchorX:ae,tileAnchorY:le,featureIndex:be}=e.get(g);I.iconBox={x1:M,y1:R,x2:B,y2:V,padding:q,projectedAnchorX:Z,projectedAnchorY:$,projectedAnchorZ:ne,tileAnchorX:ae,tileAnchorY:le},I.iconFeatureIndex=be}if(w<T){const{x1:M,y1:R,x2:B,y2:V,padding:q,projectedAnchorX:Z,projectedAnchorY:$,projectedAnchorZ:ne,tileAnchorX:ae,tileAnchorY:le,featureIndex:be}=e.get(w);I.verticalIconBox={x1:M,y1:R,x2:B,y2:V,padding:q,projectedAnchorX:Z,projectedAnchorY:$,projectedAnchorZ:ne,tileAnchorX:ae,tileAnchorY:le},I.verticalIconFeatureIndex=be}return I}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){const l=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,s){const l=e.placedSymbolArray.get(s),h=l.vertexStartIndex+4*l.numGlyphs;for(let p=l.vertexStartIndex;p<h;p+=4)e.indexArray.emplaceBack(p,p+1,p+2),e.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const s=Math.sin(e),l=Math.cos(e),h=[],p=[],g=[];for(let x=0;x<this.symbolInstances.length;++x){g.push(x);const w=this.symbolInstances.get(x);h.push(0|Math.round(s*w.tileAnchorX+l*w.tileAnchorY)),p.push(w.featureIndex)}return g.sort((x,w)=>h[x]-h[w]||p[w]-p[x]),g}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,s)=>this.symbolInstances.get(s).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,s){const l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===s?l.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const s of this.symbolInstanceIndexes){const l=this.symbolInstances.get(s);this.featureSortOrder.push(l.featureIndex);const{rightJustifiedTextSymbolIndex:h,centerJustifiedTextSymbolIndex:p,leftJustifiedTextSymbolIndex:g,verticalPlacedTextSymbolIndex:x,placedIconSymbolIndex:w,verticalPlacedIconSymbolIndex:T}=l;h>=0&&this.addIndicesForPlacedSymbol(this.text,h),p>=0&&p!==h&&this.addIndicesForPlacedSymbol(this.text,p),g>=0&&g!==p&&g!==h&&this.addIndicesForPlacedSymbol(this.text,g),x>=0&&this.addIndicesForPlacedSymbol(this.text,x),w>=0&&this.addIndicesForPlacedSymbol(this.icon,w),T>=0&&this.addIndicesForPlacedSymbol(this.icon,T)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let $0,J0,q_;Dt(Fg,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Fg.addDynamicAttributes=Og;class K0{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Qn,this.defaultValue=e}evaluate(e){if(e.formattedSection){const s=this.defaultValue.property.overrides;if(s&&s.hasOverride(e.formattedSection))return s.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Dt(K0,"FormatSectionOverride",{omit:["defaultValue"]});const Z_=()=>q_||(q_={layout:$0||($0=new Nr({"symbol-placement":new yt(Fe.layout_symbol["symbol-placement"]),"symbol-spacing":new yt(Fe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new yt(Fe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Mt(Fe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new yt(Fe.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new yt(Fe.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new yt(Fe.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new yt(Fe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new yt(Fe.layout_symbol["icon-ignore-placement"]),"icon-optional":new yt(Fe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new yt(Fe.layout_symbol["icon-rotation-alignment"]),"icon-size":new Mt(Fe.layout_symbol["icon-size"]),"icon-size-scale-range":new yt(Fe.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Mt(Fe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Mt(Fe.layout_symbol["icon-text-fit-padding"]),"icon-image":new Mt(Fe.layout_symbol["icon-image"]),"icon-image-use-theme":new yt({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new Mt(Fe.layout_symbol["icon-rotate"]),"icon-padding":new yt(Fe.layout_symbol["icon-padding"]),"icon-keep-upright":new yt(Fe.layout_symbol["icon-keep-upright"]),"icon-offset":new Mt(Fe.layout_symbol["icon-offset"]),"icon-anchor":new Mt(Fe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new yt(Fe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new yt(Fe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new yt(Fe.layout_symbol["text-rotation-alignment"]),"text-field":new Mt(Fe.layout_symbol["text-field"]),"text-font":new Mt(Fe.layout_symbol["text-font"]),"text-size":new Mt(Fe.layout_symbol["text-size"]),"text-size-scale-range":new yt(Fe.layout_symbol["text-size-scale-range"]),"text-max-width":new Mt(Fe.layout_symbol["text-max-width"]),"text-line-height":new Mt(Fe.layout_symbol["text-line-height"]),"text-letter-spacing":new Mt(Fe.layout_symbol["text-letter-spacing"]),"text-justify":new Mt(Fe.layout_symbol["text-justify"]),"text-radial-offset":new Mt(Fe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new yt(Fe.layout_symbol["text-variable-anchor"]),"text-anchor":new Mt(Fe.layout_symbol["text-anchor"]),"text-max-angle":new yt(Fe.layout_symbol["text-max-angle"]),"text-writing-mode":new yt(Fe.layout_symbol["text-writing-mode"]),"text-rotate":new Mt(Fe.layout_symbol["text-rotate"]),"text-padding":new yt(Fe.layout_symbol["text-padding"]),"text-keep-upright":new yt(Fe.layout_symbol["text-keep-upright"]),"text-transform":new Mt(Fe.layout_symbol["text-transform"]),"text-offset":new Mt(Fe.layout_symbol["text-offset"]),"text-allow-overlap":new yt(Fe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new yt(Fe.layout_symbol["text-ignore-placement"]),"text-optional":new yt(Fe.layout_symbol["text-optional"]),visibility:new yt(Fe.layout_symbol.visibility)})),paint:J0||(J0=new Nr({"icon-opacity":new Mt(Fe.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Mt(Fe.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Mt(Fe.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Mt(Fe.paint_symbol["text-emissive-strength"]),"icon-color":new Mt(Fe.paint_symbol["icon-color"]),"icon-halo-color":new Mt(Fe.paint_symbol["icon-halo-color"]),"icon-halo-width":new Mt(Fe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Mt(Fe.paint_symbol["icon-halo-blur"]),"icon-translate":new yt(Fe.paint_symbol["icon-translate"]),"icon-translate-anchor":new yt(Fe.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new yt(Fe.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Mt(Fe.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Mt(Fe.paint_symbol["text-occlusion-opacity"]),"text-color":new Mt(Fe.paint_symbol["text-color"],{runtimeType:on,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new Mt(Fe.paint_symbol["text-halo-color"]),"text-halo-width":new Mt(Fe.paint_symbol["text-halo-width"]),"text-halo-blur":new Mt(Fe.paint_symbol["text-halo-blur"]),"text-translate":new yt(Fe.paint_symbol["text-translate"]),"text-translate-anchor":new yt(Fe.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new yt(Fe.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new yt(Fe.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new yt(Fe.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new yt(Fe.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Mt(Fe.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Mt({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Mt({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Mt({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Mt({type:"string",default:"default","property-type":"data-driven"})}))},q_);class Bg extends Ns{constructor(e,s,l,h){super(e,Z_(),s,l,h,e.layout?e.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=H([]),this.hasOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}_handleSpecialPaintPropertyUpdate(e){e!=="icon-occlusion-opacity"&&e!=="text-occlusion-opacity"||(this.hasOcclusionOpacityProperties=!0)}recalculate(e,s){super.recalculate(e,s),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const l=this.layout.get("text-writing-mode");if(l){const h=[];for(const p of l)h.indexOf(p)<0&&h.push(p);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,s,l,h){return this._saturation===e&&this._contrast===s&&this._brightnessMin===l&&this._brightnessMax===h||(this._colorAdjustmentMatrix=function(p,g,x,w){p=pn(p),g=js(g);const T=G(),I=p/3,M=1-2*I,R=[M,I,I,0,I,M,I,0,I,I,M,0,0,0,0,1],B=.5-.5*g,V=w-x;return ee(T,[V,0,0,0,0,V,0,0,0,0,V,0,x,x,x,1],[g,0,0,0,0,g,0,0,0,0,g,0,B,B,B,1]),ee(T,T,R),T}(e,s,l,h),this._saturation=e,this._contrast=s,this._brightnessMin=l,this._brightnessMax=h),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,s,l,h){const p=this.layout.get(e).evaluate(s,{},l,h),g=this._unevaluatedLayout._values[e];return g.isDataDriven()||Pd(g.value)||!p?p:function(x,w){return w.replace(/{([^{}]+)}/g,(T,I)=>I in x?String(x[I]):"")}(s.properties,p)}createBucket(e){return new Fg(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Z_().paint.overridableProperties){if(!Bg.hasPaintOverride(this.layout,e))continue;const s=this.paint.get(e),l=new K0(s),h=new jh(l,s.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme"));let p=null;p=s.value.kind==="constant"||s.value.kind==="source"?new bc("source",h):new Ja("composite",h,s.value.zoomStops,s.value.interpolationType),this.paint._values[e]=new Ro(s.property,p,s.parameters)}}_handleOverridablePaintPropertyUpdate(e,s,l){return!(!this.layout||s.isDataDriven()||l.isDataDriven())&&Bg.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,s){const l=e.get("text-field"),h=Z_().paint.properties[s];let p=!1;const g=x=>{for(const w of x)if(h.overrides&&h.overrides.hasOverride(w))return void(p=!0)};if(l.value.kind==="constant"&&l.value.value instanceof Ws)g(l.value.value.sections);else if(l.value.kind==="source"){const x=T=>{p||(T instanceof bi&&ys(T.value)===Ha?g(T.value.sections):T instanceof bo?g(T.sections):T.eachChild(x))},w=l.value;w._styleExpression&&x(w._styleExpression.expression)}return p}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,s,l){return{config:new Uo(this,{zoom:s,lut:l}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let Q0,eb,tb,ib;var $_=Fi([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function Ng(n,e,s,l,h,p,g,x){const w=[n,e,1,s,l,1,h,p,1],T=[g,x,1],I=O([],w),[M,R,B]=ns(T,T,I);return N(w,w,[M,0,0,0,R,0,0,0,B])}function rb(n,e,s,l,h,p,g,x){const w=function(T,I,M,R,B,V,q,Z){const $=Ng(0,0,1,0,1,1,0,1),ne=Ng(T,I,M,R,B,V,q,Z);return N(ne,ne,O([],$))}(n,e,s,l,h,p,g,x);return[w[2]/w[8]/At,w[5]/w[8]/At]}function Vg(n){return[n[0],Math.min(Math.max(n[1],-85.051129),Ae)]}class sb extends xo{constructor(e,s,l,h){super(),this.id=e,this.dispatcher=l,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(h),this.options=s,this._dirty=!1}load(e,s){if(this._loaded=s||!1,this.fire(new Nn("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=el(this.map._requestManager.transformRequest(this.url,rh.Image),(l,h)=>{this._imageRequest=null,this._loaded=!0,l?this.fire(new nc(l)):h&&(this.image=h instanceof HTMLImageElement?Kn.getImageData(h):h,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new yf(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Nn("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof yf||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let s=e[0][1],l=e[0][1];for(const p of e)p[1]>l&&(l=p[1]),p[1]<s&&(s=p[1]);const h=(l+s)/2;if(h>Ae?this.onNorthPole=!0:h<-85.051129&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const p=e.map($e.fromLngLat);this.tileID=function(g){let x=1/0,w=1/0,T=-1/0,I=-1/0;for(const q of g)x=Math.min(x,q.x),w=Math.min(w,q.y),T=Math.max(T,q.x),I=Math.max(I,q.y);const M=Math.max(T-x,I-w),R=Math.max(0,Math.floor(-Math.log2(M))),B=Math.pow(2,R);let V=Math.floor((x+T)/2*B);return V>1&&(V-=1),new Ia(R,V,Math.floor((w+I)/2*B))}(p),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Nn("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof yf||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const $ in this.tiles){const ne=this.tiles[$];ne.state!=="loaded"&&(ne.state="loaded",ne.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const s=Ef(new Ia(0,0,0),this.map.transform.projection),l=[s.projection.project(this.coordinates[0][0],this.coordinates[0][1]),s.projection.project(this.coordinates[1][0],this.coordinates[1][1]),s.projection.project(this.coordinates[2][0],this.coordinates[2][1]),s.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function($){const ne=$[1].x-$[0].x,ae=$[1].y-$[0].y,le=$[2].x-$[1].x,be=$[2].y-$[1].y,we=$[3].x-$[2].x,ke=$[3].y-$[2].y,Le=$[0].x-$[3].x,ze=$[0].y-$[3].y,rt=ne*be-le*ae,Be=le*ke-we*be,st=we*ze-Le*ke,ut=Le*ae-ne*ze;return rt>0&&Be>0&&st>0&&ut>0||rt<0&&Be<0&&st<0&&ut<0}(l))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const h=Ef(this.tileID,this.map.transform.projection),[p,g,x,w]=this.coordinates.map($=>{const ne=h.projection.project($[0],$[1]);return W0(h,ne)._round()});this.perspectiveTransform=rb(p.x,p.y,g.x,g.y,x.x,x.y,w.x,w.y);const T=this._boundsArray=new Bo;T.emplaceBack(p.x,p.y,0,0),T.emplaceBack(g.x,g.y,At,0),T.emplaceBack(w.x,w.y,0,At),T.emplaceBack(x.x,x.y,At,At),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(T,$_.members),this.boundsSegments=zr.simpleSegment(0,0,4,2);const I=[],M=[Vg((R=this.coordinates)[0]),Vg(R[1]),Vg(R[2]),Vg(R[3])];var R;const[B,V,q,Z]=function($){let ne=$[0][0],ae=ne,le=$[0][1],be=le;for(let we=1;we<$.length;we++)$[we][0]<ne?ne=$[we][0]:$[we][0]>ae&&(ae=$[we][0]),$[we][1]<le?le=$[we][1]:$[we][1]>be&&(be=$[we][1]);return[ne,le,ae-ne,be-le]}(M);{const $=new Bo,[ne,ae,le,be]=function(tt){let ct=tt[0].x,Xe=ct,He=tt[0].y,_t=He;for(let dt=1;dt<tt.length;dt++)tt[dt].x<ct?ct=tt[dt].x:tt[dt].x>Xe&&(Xe=tt[dt].x),tt[dt].y<He?He=tt[dt].y:tt[dt].y>_t&&(_t=tt[dt].y);return[ct,He,Xe-ct,_t-He]}(l),we=tt=>[(tt.x-ne)/le,(tt.y-ae)/be],[ke,Le,ze,rt]=l.map(we),Be=function(tt,ct,Xe,He,_t,dt,Yt,zt){const Bt=Ng(0,0,1,0,1,1,0,1);return N(Bt,Bt,O([],Ng(tt,ct,Xe,He,_t,dt,Yt,zt)))}(ke[0],ke[1],Le[0],Le[1],ze[0],ze[1],rt[0],rt[1]);this.elevatedGlobePerspectiveTransform=rb(ke[0],ke[1],Le[0],Le[1],ze[0],ze[1],rt[0],rt[1]);const st=(tt,ct)=>{I.push(tt.lng);const Xe=Math.round((tt.lng-B)/q*At),He=Math.round((tt.lat-V)/Z*At),_t=we(ct),dt=ns([],[_t[0],_t[1],1],Be),Yt=Math.round(dt[0]/dt[2]*At),zt=Math.round(dt[1]/dt[2]*At);$.emplaceBack(Xe,He,Yt,zt)},ut=l[3].x-l[0].x,nt=l[3].y-l[0].y,ot=l[2].x-l[1].x,gt=l[2].y-l[1].y;for(let tt=0;tt<65;tt++){const ct=tt/64,Xe=[l[0].x+ct*ut,l[0].y+ct*nt],He=[l[1].x+ct*ot,l[1].y+ct*gt],_t=He[0]-Xe[0],dt=He[1]-Xe[1];for(let Yt=0;Yt<65;Yt++){const zt=Yt/64,Bt={x:Xe[0]+_t*zt,y:Xe[1]+dt*zt};st(s.projection.unproject(Bt.x,Bt.y),Bt)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer($,$_.members)}{this.maxLongitudeTriangleSize=0;let $=[],ne=new gs;const ae=(le,be,we)=>{ne.emplaceBack(le,be,we);const ke=I[le],Le=I[be],ze=I[we],rt=Math.min(Math.min(ke,Le),ze),Be=Math.max(Math.max(ke,Le),ze)-rt;Be>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Be),$.push(rt+Be/2)};for(let le=0;le<64;le++)for(let be=0;be<64;be++){const we=65*le+be,ke=we+1,Le=we+65,ze=Le+1;ae(we,Le,ke),ae(ke,Le,ze)}[$,ne]=function(le,be){const we=Array.from({length:le.length},(ze,rt)=>rt);we.sort((ze,rt)=>le[ze]-le[rt]);const ke=[],Le=new gs;for(let ze=0;ze<we.length;ze++){const rt=we[ze];ke.push(le[rt]);const Be=3*rt,st=Be+1;Le.emplaceBack(be.uint16[Be],be.uint16[st],be.uint16[st+1])}return[ke,Le]}($,ne),this.elevatedGlobeTrianglesCenterLongitudes=$,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(ne)}this.elevatedGlobeSegments=zr.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,q/At,0,Z/At,0,0,V,B,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const s=this.map.painter.context,l=s.gl;!this._dirty||this.texture instanceof yf||(this.texture?this.texture.update(this.image):(this.texture=new A_(s,this.image,l.RGBA8),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(s)}loadTile(e,s){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},s(null)):(e.state="errored",s(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const s=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!s)return null;const l=this.elevatedGlobeTrianglesCenterLongitudes;let h=(p=e+180)+360*Math.round((l[0]-p)/360);var p;const g=new zr,x=(M,R)=>{g.segments.push({vertexOffset:0,primitiveOffset:M,vertexLength:s.segments[0].vertexLength,primitiveLength:R,sortKey:void 0,vaos:{}})},w=.51*this.maxLongitudeTriangleSize;if(Math.abs(l[0]-h)<=w){const M=Ms(l,0,l.length,h+w);return M===l.length||x(M,Sr(l,M+1,l.length,h+360-w)-M),g}h<l[0]&&(h+=360);const T=Sr(l,0,l.length,h-w);if(T===l.length)return x(0,l.length),g;x(0,T-0);const I=Ms(l,T+1,l.length,h+w);return I!==l.length&&x(I,l.length-I),g}}const gT=(Math.pow(256,2)-1)/16907520;class nb extends Ns{constructor(e,s,l,h){super(e,{layout:tb||(tb=new Nr({visibility:new yt(Fe.layout_raster.visibility)})),paint:ib||(ib=new Nr({"raster-opacity":new yt(Fe.paint_raster["raster-opacity"]),"raster-color":new yl(Fe.paint_raster["raster-color"]),"raster-color-mix":new yt(Fe.paint_raster["raster-color-mix"]),"raster-color-range":new yt(Fe.paint_raster["raster-color-range"]),"raster-hue-rotate":new yt(Fe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new yt(Fe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new yt(Fe.paint_raster["raster-brightness-max"]),"raster-saturation":new yt(Fe.paint_raster["raster-saturation"]),"raster-contrast":new yt(Fe.paint_raster["raster-contrast"]),"raster-resampling":new yt(Fe.paint_raster["raster-resampling"]),"raster-fade-duration":new yt(Fe.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new yt(Fe.paint_raster["raster-emissive-strength"]),"raster-array-band":new yt(Fe.paint_raster["raster-array-band"]),"raster-elevation":new yt(Fe.paint_raster["raster-elevation"]),"raster-color-use-theme":new Mt({type:"string",default:"default","property-type":"data-driven"})}))},s,l,h),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof sb&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const s=this._transitionablePaint._values["raster-color"].value.expression,[l,h]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(l)&&isNaN(h)||l===this._curRampRange[0]&&h===this._curRampRange[1]||(this.colorRamp=rf({expression:s,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:l,end:h}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[l,h])}}let ab,ob,lb,cb,hb;class ub extends Ns{constructor(e,s,l,h){super(e,{layout:ab||(ab=new Nr({visibility:new yt(Fe["layout_raster-particle"].visibility)})),paint:ob||(ob=new Nr({"raster-particle-array-band":new yt(Fe["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new yt(Fe["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new yl(Fe["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new yt(Fe["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new yt(Fe["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new yt(Fe["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new yt(Fe["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new yt(Fe["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Mt({type:"string",default:"default","property-type":"data-driven"})}))},s,l,h),this._updateColorRamp(),this.lastInvalidatedAt=Kn.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,s=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=rf({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:s}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Kn.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class mT extends Ns{constructor(e,s){super(e,{},s,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(e){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function J_(n,e,s){const l=[0,0,1],h=ga([]);return po(h,h,s?-Oe(n)+Math.PI:Oe(n)),fo(h,h,-Oe(e)),nn(l,l,h),mi(l,l)}const db={None:0,Model:1,Symbol:2,FillExtrusion:4};class Ug{constructor(e,s,l,h){this.message=(e?`${e}: `:"")+l,h&&(this.identifier=h),s!=null&&s.__line__&&(this.line=s.__line__)}}function K_(n,e){const s=n.indexOf("://")===-1;try{return new URL(n,s&&e?"http://example.com":void 0),!0}catch{return!1}}class fb{constructor(e,s){this.feature=e,this.instancedDataOffset=s,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class pb{constructor(){this.instancedDataArray=new $d,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class Q_{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.fqid),this.projection=e.projection,this.index=e.index,this.worldview=e.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=e.styleDefinedModelURLs}updateFootprints(e,s){}populate(e,s,l,h){this.tileToMeter=Ne(l);const p=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:g,id:x,index:w,sourceLayerIndex:T}of e){const I=x!=null?x:g.properties&&g.properties.hasOwnProperty("id")?g.properties.id:void 0,M=pt(g,p);if(!this.layers[0]._featureFilter.filter(new _r(this.zoom,{worldview:this.worldview}),M,l))continue;const R={id:I,sourceLayerIndex:T,index:w,geometry:p?M.geometry:Pt(g,l,h),properties:g.properties,type:g.type,patterns:{}},B=this.addFeature(R,R.geometry,M);B&&s.featureIndex.insert(g,R.geometry,w,T,this.index,this.instancesPerModel[B].instancedDataArray.length,At/32)}this.lookup=null}update(e,s,l,h){for(const p in this.instancesPerModel){const g=this.instancesPerModel[p];for(const x in e)g.idToFeaturesIndex.hasOwnProperty(x)&&(this.evaluate(g.features[g.idToFeaturesIndex[x]],e[x],g,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const s in this.instancesPerModel){const l=this.instancesPerModel[s];for(const h of l.features){const p=this.layers[0],g=h.feature,x=this.canonical,w=p.paint.get("model-rotation").evaluate(g,{},x),T=p.paint.get("model-scale").evaluate(g,{},x),I=p.paint.get("model-translation").evaluate(g,{},x);_s(h.rotation,w)&&_s(h.scale,T)&&_s(h.translation,I)||(this.evaluate(h,h.featureStates,l,!0),e=!0)}}return e}updateReplacement(e,s,l,h){if(s.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=s.updateTime;const p=s.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(ug(this.activeReplacements,p))return!1;this.activeReplacements=p;let g=!1;for(const x in this.instancesPerModel){const w=this.instancesPerModel[x],T=w.instancedDataArray;for(const I of w.features){const M=I.instancedDataOffset,R=I.instancedDataCount;for(let B=0;B<R;B++){const V=16*(B+M);let q=T.float32[V+0];const Z=q>At;q=Z?q-At:q;const $=Math.floor(q),ne=T.float32[V+1];let ae=!1;for(const le of this.activeReplacements)if(!tv(le,l,db.Model,h)&&!(le.min.x>$||$>le.max.x||le.min.y>ne||ne>le.max.y)&&(ae=d_(nv($,ne,e.canonical,le.footprintTileId.canonical),le.footprint),ae))break;T.float32[V]=ae?q+At:q,g=g||ae!==Z}}}return g}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const s in this.instancesPerModel){const l=this.instancesPerModel[s];l.instancedDataArray.length<0||l.instancedDataArray.length===0||(l.instancedDataBuffer?l.instancedDataBuffer.updateData(l.instancedDataArray):l.instancedDataBuffer=e.createVertexBuffer(l.instancedDataArray,WS.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const s in this.instancesPerModel){const l=this.instancesPerModel[s];l.instancedDataArray.length!==0&&l.instancedDataBuffer&&l.instancedDataBuffer.destroy()}const e=this.layers[0].modelManager;if(e&&this.modelUris&&this.modelsRequested)for(const s of this.modelUris)e.removeModel(s,"",!0)}addFeature(e,s,l){const h=this.layers[0],p=h.layout.get("model-id").evaluate(l,{},this.canonical);if(!p)return Di(`modelId is not evaluated for layer ${h.id} and it is not going to get rendered.`),p;(K_(p,!1)||this.styleDefinedModelURLs[p]!==void 0)&&(this.modelUris.includes(p)||this.modelUris.push(p)),this.instancesPerModel[p]||(this.instancesPerModel[p]=new pb);const g=this.instancesPerModel[p],x=g.instancedDataArray,w=new fb(l,x.length);for(const T of s)for(const I of T){if(I.x<0||I.x>=At||I.y<0||I.y>=At)continue;if(this.lookupDim!==0){const R=(this.lookupDim-1)/At,B=this.lookupDim*(I.y*R|0)+I.x*R|0;if(this.lookup){if(this.lookup[B]!==0)continue;this.lookup[B]=1}}this.instanceCount++;const M=x.length;x.resize(M+1),g.instancesEvaluatedElevation.push(0),x.float32[16*M]=I.x,x.float32[16*M+1]=I.y}return w.instancedDataCount=g.instancedDataArray.length-w.instancedDataOffset,w.instancedDataCount>0&&(e.id&&(g.idToFeaturesIndex[e.id]=g.features.length),g.features.push(w),this.evaluate(w,{},g,!1)),p}getModelUris(){return this.modelUris}evaluate(e,s,l,h){const p=this.layers[0],g=e.feature,x=this.canonical,w=e.rotation=p.paint.get("model-rotation").evaluate(g,s,x),T=e.scale=p.paint.get("model-scale").evaluate(g,s,x),I=e.translation=p.paint.get("model-translation").evaluate(g,s,x),M=p.paint.get("model-color").evaluate(g,s,x);M.a=p.paint.get("model-color-mix-intensity").evaluate(g,s,x);const R=[];this.maxVerticalOffset<I[2]&&(this.maxVerticalOffset=I[2]),this.maxScale=Math.max(Math.max(this.maxScale,T[0]),Math.max(T[1],T[2])),Vv(R,w,T);const B=Math.round(100*M.a)+M.b/1.05;for(let V=0;V<e.instancedDataCount;++V){const q=e.instancedDataOffset+V,Z=16*q,$=l.instancedDataArray.float32;let ne=0;h&&(ne=$[Z+6]-l.instancesEvaluatedElevation[q]);const ae=0|$[Z+1];$[Z]=(0|$[Z])+M.r/1.05,$[Z+1]=ae+M.g/1.05,$[Z+2]=B,$[Z+3]=1/(x.z>10?this.tileToMeter:Ne(x,ae)),$[Z+4]=I[0],$[Z+5]=I[1],$[Z+6]=I[2]+ne,$[Z+7]=R[0],$[Z+8]=R[1],$[Z+9]=R[2],$[Z+10]=R[4],$[Z+11]=R[5],$[Z+12]=R[6],$[Z+13]=R[8],$[Z+14]=R[9],$[Z+15]=R[10],l.instancesEvaluatedElevation[q]=I[2]}}}let gb,mb;Dt(Q_,"ModelBucket",{omit:["layers"]}),Dt(pb,"PerModelAttributes"),Dt(fb,"ModelFeature");class Tu{constructor(e,s,l){this._demTile=e,this._dem=this._demTile.dem,this._scale=s,this._offset=l}static create(e,s,l){const h=l||e.findDEMTileFor(s);if(!h||!h.dem)return;const p=h.dem,g=h.tileID,x=1<<s.canonical.z-g.canonical.z;return new Tu(h,p.dim/At/x,[(s.canonical.x/x-g.canonical.x)*p.dim,(s.canonical.y/x-g.canonical.y)*p.dim])}tileCoordToPixel(e,s){const l=s*this._scale+this._offset[1];return new mt(Math.floor(e*this._scale+this._offset[0]),Math.floor(l))}getElevationAt(e,s,l,h){const p=e*this._scale+this._offset[0],g=s*this._scale+this._offset[1],x=Math.floor(p),w=Math.floor(g),T=this._dem;return h=!!h,l?ei(ei(T.get(x,w,h),T.get(x,w+1,h),g-w),ei(T.get(x+1,w,h),T.get(x+1,w+1,h),g-w),p-x):T.get(x,w,h)}getElevationAtPixel(e,s,l){return this._dem.get(e,s,!!l)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*me(1,e)*this._dem.stride}}const ey=new Float32Array(262144),Hc=new Uint8Array(262144);function _b(n){let e=0;if(n.meshes)for(const s of n.meshes)e=Math.max(e,s.aabb.max[2]);if(n.children)for(const s of n.children)e=Math.max(e,_b(s));return e}function yb(n,e,s){if(n.meshes)for(const l of n.meshes){if(l.aabb.min[0]===1/0)continue;const h=ri.applyTransform(l.aabb,n.matrix);s.insert(e,h.min[0],h.min[1],h.max[0],h.max[1])}if(n.children)for(const l of n.children)yb(l,e,s)}const xb=["","wall","door","roof","window","lamp","logo"];class vb{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:_b(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new ri([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const s=new ri([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const l of this.node.meshes)this.node.lightMeshIndex!==e&&(l.transformedAabb=ri.applyTransformFast(l.aabb,this.node.matrix),s.encapsulate(l.transformedAabb)),e++;this.aabb=s}return this.aabb}}class jg{constructor(e,s,l,h,p,g,x,w){this.id=l,this.layers=e,this.layerIds=this.layers.map(T=>T.fqid),this.stateDependentLayerIds=this.layers.filter(T=>T.isStateDependent()).map(T=>T.id),this.modelTraits|=xu.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,h&&(this.modelTraits|=xu.HasMapboxMeshFeatures),p&&(this.modelTraits|=xu.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=g,this.worldview=w,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const T of s)this.nodesInfo.push(new vb(T)),yb(T,x.featureIndexArray.length,x.grid),x.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,x.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(e,s){for(const l of this.getNodesInfo()){const h=l.node;h.footprint&&s.push({footprint:h.footprint,id:e})}}update(e){const s=Object.keys(e).length!==0;if(s&&!this.stateDependentLayers.length)return;const l=s?this.stateDependentLayers:this.layers;if(!ya(e,this.states))for(const h of l)this.evaluate(h,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const s=this.getNodesInfo();for(const l of s){const h=l.node;this.uploaded?this.updatePbrBuffer(h):C_(h,e,!0)}for(const l of s)bg(l.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let s=!1;if(!e.meshes)return s;for(const l of e.meshes)l.pbrBuffer&&(l.pbrBuffer.updateData(l.featureArray),s=!0);return s}needsReEvaluation(e,s,l){const h=e.transform.projectionOptions,p=e.style.getBrightness(),g=this.brightness!==p;if(!this.uploaded||this.dirty||h.name!==this.projection.name||Pf(l.paint.get("model-color").value,g)||Pf(l.paint.get("model-color-mix-intensity").value,g)||Pf(l.paint.get("model-roughness").value,g)||Pf(l.paint.get("model-emissive-strength").value,g)||Pf(l.paint.get("model-height-based-emissive-strength-multiplier").value,g)){this.projection=h,this.brightness=p;const x=this.getNodesInfo();for(const w of x)w.state=null;return!0}return!1}evaluateTransform(e,s){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const l=this.getNodesInfo(),h=this.id.canonical;for(const p of l){const g=p.feature;p.evaluatedTranslation=s.paint.get("model-translation").evaluate(g,{},h),p.evaluatedScale=s.paint.get("model-scale").evaluate(g,{},h)}}evaluate(e,s){const l=this.getNodesInfo();for(const h of l){if(!h.node.meshes)continue;const p=h.feature,g=s&&s[p.id];if(ya(g,h.state))continue;h.state=structuredClone(g);const x=h.node.meshes&&h.node.meshes[0].featureData,w=h.evaluatedColor[2],T=h.evaluatedRMEA[2],I=this.id.canonical;if(h.hasTranslucentParts=!1,x){for(let M=0;M<xb.length;M++){const R=xb[M];R.length&&(p.properties.part=R);const B=e.paint.get("model-color").evaluate(p,g,I).toPremultipliedRenderColor(null),V=e.paint.get("model-color-mix-intensity").evaluate(p,g,I);h.evaluatedColor[M]=[B.r,B.g,B.b,V],h.evaluatedRMEA[M][0]=e.paint.get("model-roughness").evaluate(p,g,I),h.evaluatedRMEA[M][2]=e.paint.get("model-emissive-strength").evaluate(p,g,I),h.evaluatedRMEA[M][3]=B.a,h.emissionHeightBasedParams[M]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(p,g,I),!h.hasTranslucentParts&&B.a<1&&(h.hasTranslucentParts=!0)}delete p.properties.part,yT(h,w!==h.evaluatedColor[2]||T!==h.evaluatedRMEA[2],this.modelTraits)}else h.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(p,g,I);h.evaluatedTranslation=e.paint.get("model-translation").evaluate(p,g,I),h.evaluatedScale=e.paint.get("model-scale").evaluate(p,g,I),this.updatePbrBuffer(h.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,s,l,h){const p=e.findDEMTileFor(l);if(p&&(p.tileID.canonical!==this.terrainTile||s!==this.terrainExaggeration)){if(p.dem&&p.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=p.tileID.overscaledZ;const g=Tu.create(e,l,p);if(!g)return;this.modelTraits&xu.HasMapboxMeshFeatures&&this.updateDEM(e,g,l,h);for(const x of this.getNodesInfo()){const w=x.node;if(!w.footprint||!w.footprint.vertices||!w.footprint.vertices.length)continue;const T=w.footprint.vertices;let I=g.getElevationAt(T[0].x,T[0].y,!0,!0);for(let M=1;M<T.length;M++)I=Math.min(I,g.getElevationAt(T[M].x,T[M].y,!0,!0));w.elevation=I}}this.terrainTile=p.tileID.canonical,this.terrainExaggeration=s}}updateDEM(e,s,l,h){let p=s._dem._modifiedForSources[h];if(p===void 0&&(s._dem._modifiedForSources[h]=[],p=s._dem._modifiedForSources[h]),p.includes(l.canonical))return;const g=s._dem.dim;p.push(l.canonical);let x=!1;for(const w of this.getNodesInfo()){const T=w.node;if(!T.footprint||!T.footprint.grid)continue;const I=T.footprint.grid,M=s.tileCoordToPixel(I.min.x,I.min.y),R=s.tileCoordToPixel(I.max.x,I.max.y),B=Math.min(Math.min(g-R.y,M.x),Math.min(M.y,g-R.x));if(B<0)continue;const V=Ee(B,2,5);let q=Math.max(0,M.x-V),Z=Math.max(0,M.y-V),$=Math.min(R.x+V,g-1),ne=Math.min(R.y+V,g-1);for(let we=Z;we<=ne;++we)for(let ke=q;ke<=$;++ke)Hc[we*g+ke]=255;let ae=0,le=0;for(let we=0;we<I.cellsY;++we)for(let ke=0;ke<I.cellsX;++ke){if(!I.cells[we*I.cellsX+ke])continue;const Le=s.tileCoordToPixel(I.min.x+ke/I.xScale,I.min.y+we/I.yScale),ze=s.tileCoordToPixel(I.min.x+(ke+1)/I.xScale,I.min.y+(we+1)/I.yScale);for(let rt=Le.y;rt<=Math.min(ze.y+1,g-1);++rt)for(let Be=Le.x;Be<=Math.min(ze.x+1,g-1);++Be)Hc[rt*g+Be]===255&&(Hc[rt*g+Be]=0,ae+=s.getElevationAtPixel(Be,rt),le++)}const be=ae/le;q=Math.max(1,M.x-V),Z=Math.max(1,M.y-V),$=Math.min(R.x+V,g-2),ne=Math.min(R.y+V,g-2),x=!0;for(let we=Z;we<=ne;++we)for(let ke=q;ke<=$;++ke)Hc[we*g+ke]===0&&(ey[we*g+ke]=s._dem.set(ke,we,be));for(let we=1;we<V;++we){q=Math.max(1,M.x-we),Z=Math.max(1,M.y-we),$=Math.min(R.x+we,g-2),ne=Math.min(R.y+we,g-2);for(let ke=Z;ke<=ne;++ke)for(let Le=q;Le<=$;++Le){const ze=ke*g+Le;if(Hc[ze]===255){let rt=0,Be=0,st=-1,ut=-1;for(let nt=-1;nt<=1;++nt)for(let ot=-1;ot<=1;++ot){const gt=(ke+nt)*g+Le+ot;if(Hc[gt]>=we)continue;const tt=ey[gt],ct=Math.abs(tt);ct>Be&&(rt=tt,Be=ct,st=ot,ut=nt)}if(Be>.1){const nt=1-(we+.5*Math.abs(st*ut))/V;let ot=s._dem.get(Le,ke)+rt*nt;const gt=s._dem.get(Le+st,ke+ut),tt=s._dem.get(Le-st,ke-ut,!0);(ot-gt)*(ot-tt)>0&&(ot=(gt+tt)/2),ey[ze]=s._dem.set(Le,ke,ot),Hc[ze]=we}}}}}x&&(s._demTile.needsDEMTextureUpload=!0,s._dem._timestamp=Kn.now())}setFilter(e){this.filter=e?Sc(e):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(e=>this.filter.filter(new _r(this.id.overscaledZ,{worldview:this.worldview}),e.feature,this.id.canonical)):this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const s of e)bg(s.node),I_(s.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,s){if(s.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=s.updateTime;const l=s.getReplacementRegionsForTile(e.toUnwrapped());for(const h of this.getNodesInfo()){const p=h.node.footprint;h.hiddenByReplacement=!!p&&!l.find(g=>g.footprint===p)}}getHeightAtTileCoord(e,s){const l=[],h=[0,0,0],p=H([]);for(const g of this.getNodesInfo()){const x=g.node.meshes[0],w=x.transformedAabb;if(e<w.min[0]||s<w.min[1]||e>w.max[0]||s>w.max[1])continue;if(g.node.hidden===!0)return{height:1/0,maxHeight:g.feature.properties.height,hidden:!1,verticalScale:g.evaluatedScale[2]};Q(p,g.node.matrix),h[0]=e,h[1]=s,Wi(h,h,p);const T=(h[0]-x.aabb.min[0])/(x.aabb.max[0]-x.aabb.min[0])*Nc|0,I=Math.min(63,(h[1]-x.aabb.min[1])/(x.aabb.max[1]-x.aabb.min[1])*Nc|0)*Nc+Math.min(63,T),M=x.heightmap[I];if(!(M<0&&g.node.footprint))return g.hiddenByReplacement?void 0:{height:M,maxHeight:g.feature.properties.height,hidden:!1,verticalScale:g.evaluatedScale[2]};if(g.node.footprint.grid.query(new mt(e,s),new mt(e,s),l),l.length>0)return{height:void 0,maxHeight:g.feature.properties.height,hidden:g.hiddenByReplacement,verticalScale:g.evaluatedScale[2]}}}}function Pf(n,e){return n instanceof bc&&!n.isLightConstant&&e}function _T(n,e,s,l,h,p,g,x){let w=(61440&e|(61440&e)>>4)>>8,T=(3840&e|(3840&e)>>4)>>4,I=240&e|(240&e)>>4;s[3]>0&&(w=ei(w,255*s[0],s[3]),T=ei(T,255*s[1],s[3]),I=ei(I,255*s[2],s[3]));const M=w<<8|T,R=I<<8|Math.floor(255*l[3]),B=function(we){const ke=Ee(we,0,2);return Math.min(Math.round(.5*ke*255),255)}(l[2])<<8|15*l[0]<<4|15*l[1],V=Ee(h[0],0,1),q=Ee(h[1],0,1),Z=Ee(h[2],0,1),$=Ee(h[3],0,1);let ne,ae,le,be;if(V!==q&&g!==p&&q!==V){const we=g-p;ae=1/(we*(q-V)),le=-(p+we*V)/(we*(q-V));const ke=Ee(h[4],-1,1);be=Math.pow(10,ke),ne=255*Z<<8|255*$}else ne=65535,ae=0,le=1,be=1;if(n.emplaceBack(M,R,B,ne,ae,le,be),x){const we=x.length;x.clear();for(let ke=0;ke<we;ke++)x.emplaceBack(M,R,B,ne,ae,le,be)}}function yT(n,e,s){const l=n.node;let h=0;const p=s&xu.HasMeshoptCompression;for(const g of l.meshes){if(l.lights&&l.lightMeshIndex===h||!g.featureData)continue;g.featureArray=new El,g.featureArray.reserve(g.featureData.length);let x=e;for(const w of g.featureData){const T=p?65535&w:w>>16&65535,I=p?w>>16&65535:65535&w,M=(15&I)<8?15&I:0,R=n.evaluatedRMEA[M],B=n.evaluatedColor[M],V=n.emissionHeightBasedParams[M];let q;if(x&&M===2&&l.lights&&(q=new El,q.resize(10*l.lights.length)),_T(g.featureArray,T,B,R,V,g.aabb.min[2],g.aabb.max[2],q),q&&x){x=!1;const Z=l.meshes[l.lightMeshIndex];Z.featureArray=q,Z.featureArray._trim()}}g.featureArray._trim(),h++}}function bb(n,e,s,l){const h=1<<n.z;e.lat=_e((l/At+n.y)/h),e.lng=xe((s/At+n.x)/h)}function xT(n,e,s,l){const h=n.getNodesInfo()[e];if(!h||h.hiddenByReplacement||!h.node.meshes)return;let p=Number.MAX_VALUE;const g=h.node,x=s.tile,w=l.calculatePosMatrix(x.tileID.toUnwrapped(),l.worldSize),T=h.evaluatedScale;let I=0;l.elevation&&g.elevation&&(I=g.elevation*l.elevation.exaggeration()),ie(w,w,[(g.anchor?g.anchor[0]:0)*(T[0]-1),(g.anchor?g.anchor[1]:0)*(T[1]-1),I]),ue(w,w,T);const M=s.queryGeometry,R=M.isPointQuery()?M.screenBounds:M.screenGeometry,B=function(q){const Z=ee([],w,q.matrix);ee(Z,l.expandedFarZProjMatrix,Z);for(let $=0;$<q.meshes.length;++$){const ne=q.meshes[$];if($===q.lightMeshIndex)continue;const ae=Uv(R,l,Z,ne.aabb);ae!=null&&(p=Math.min(ae,p))}if(q.children)for(const $ of q.children)B($)};if(B(g),p===Number.MAX_VALUE)return;const V=new Y(0,0);return bb(x.tileID.canonical,V,h.node.anchor[0],h.node.anchor[1]),{intersectionZ:p,position:V,feature:h.feature}}Dt(jg,"Tiled3dModelBucket",{omit:["layers"]}),Dt(vb,"Tiled3dModelFeature");const vT={circle:class extends Ns{constructor(n,e,s,l){super(n,{layout:Il||(Il=new Nr({"circle-sort-key":new Mt(Fe.layout_circle["circle-sort-key"]),"circle-elevation-reference":new yt(Fe.layout_circle["circle-elevation-reference"]),visibility:new yt(Fe.layout_circle.visibility)})),paint:Ca||(Ca=new Nr({"circle-radius":new Mt(Fe.paint_circle["circle-radius"]),"circle-color":new Mt(Fe.paint_circle["circle-color"]),"circle-blur":new Mt(Fe.paint_circle["circle-blur"]),"circle-opacity":new Mt(Fe.paint_circle["circle-opacity"]),"circle-translate":new yt(Fe.paint_circle["circle-translate"]),"circle-translate-anchor":new yt(Fe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new yt(Fe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new yt(Fe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Mt(Fe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Mt(Fe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Mt(Fe.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new yt(Fe.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Mt({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Mt({type:"string",default:"default","property-type":"data-driven"})}))},e,s,l)}createBucket(n){return new Ts(n)}queryRadius(n){const e=n;return Yn("circle-radius",this,e)+Yn("circle-stroke-width",this,e)+ao(this.paint.get("circle-translate"))}queryIntersectsFeature(n,e,s,l,h,p,g,x){const w=aa(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),p.angle,n.pixelToTileUnitsFactor),T=this.paint.get("circle-radius").evaluate(e,s)+this.paint.get("circle-stroke-width").evaluate(e,s);return Ix(n,l,p,g,x,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",w,T)}getProgramIds(){return["circle"]}getDefaultProgramParams(n,e,s){const l=Cx(this);return{config:new Uo(this,{zoom:e,lut:s}),defines:l,overrideFog:!1}}is3D(n){return!n&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends Ns{createBucket(n){return new Mx(n)}constructor(n,e,s,l){super(n,{layout:Px||(Px=new Nr({visibility:new yt(Fe.layout_heatmap.visibility)})),paint:Lx||(Lx=new Nr({"heatmap-radius":new Mt(Fe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Mt(Fe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new yt(Fe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new yl(Fe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new yt(Fe.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Mt({type:"string",default:"default","property-type":"data-driven"})}))},e,s,l),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){n==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=rf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(n){return Yn("heatmap-radius",this,n)}queryIntersectsFeature(n,e,s,l,h,p,g,x){const w=this.paint.get("heatmap-radius").evaluate(e,s);return Ix(n,l,p,g,x,!0,!0,new mt(0,0),w)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(n,e,s){return n==="heatmap"?{config:new Uo(this,{zoom:e,lut:s}),overrideFog:!1}:{}}},hillshade:class extends Ns{constructor(n,e,s,l){super(n,{layout:zx||(zx=new Nr({visibility:new yt(Fe.layout_hillshade.visibility)})),paint:Rx||(Rx=new Nr({"hillshade-illumination-direction":new yt(Fe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new yt(Fe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new yt(Fe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new yt(Fe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new yt(Fe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new yt(Fe.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new yt(Fe.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Mt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Mt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Mt({type:"string",default:"default","property-type":"data-driven"})}))},e,s,l)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(n,e,s){return{overrideFog:!1}}},fill:class extends Ns{constructor(n,e,s,l){super(n,{layout:Zx||(Zx=new Nr({"fill-sort-key":new Mt(Fe.layout_fill["fill-sort-key"]),visibility:new yt(Fe.layout_fill.visibility),"fill-elevation-reference":new yt(Fe.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new Mt(Fe.layout_fill["fill-construct-bridge-guard-rail"])})),paint:$x||($x=new Nr({"fill-antialias":new yt(Fe.paint_fill["fill-antialias"]),"fill-opacity":new Mt(Fe.paint_fill["fill-opacity"]),"fill-color":new Mt(Fe.paint_fill["fill-color"]),"fill-outline-color":new Mt(Fe.paint_fill["fill-outline-color"]),"fill-translate":new yt(Fe.paint_fill["fill-translate"]),"fill-translate-anchor":new yt(Fe.paint_fill["fill-translate-anchor"]),"fill-pattern":new Mt(Fe.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new yt(Fe.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new yt(Fe.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Mt(Fe.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new Mt(Fe.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new Mt(Fe.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new Mt({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Mt({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new Mt({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new Mt({type:"string",default:"default","property-type":"data-driven"})}))},e,s,l)}getProgramIds(){const n=this.paint.get("fill-pattern"),e=n&&n.constantOr(1),s=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&s.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),s}getDefaultProgramParams(n,e,s){return{config:new Uo(this,{zoom:e,lut:s}),overrideFog:!1}}recalculate(n,e){super.recalculate(n,e);const s=this.paint._values["fill-outline-color"];s.value.kind==="constant"&&s.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(n){return new c_(n)}queryRadius(){return ao(this.paint.get("fill-translate"))}queryIntersectsFeature(n,e,s,l,h,p){return!n.queryGeometry.isAboveHorizon&&cn(oo(n.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),p.angle,n.pixelToTileUnitsFactor),l)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(n){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const e=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return n!=null?e&&!n:e}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends Ns{constructor(n,e,s,l){super(n,{layout:xv||(xv=new Nr({visibility:new yt(Fe["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new yt(Fe["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:vv||(vv=new Nr({"fill-extrusion-opacity":new yt(Fe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Mt(Fe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new yt(Fe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new yt(Fe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Mt(Fe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new yt(Fe["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new Mt(Fe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Mt(Fe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new yt(Fe["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new yt(Fe["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new yt(Fe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new yt(Fe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new yt(Fe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new yt(Fe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new yt(Fe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new yt(Fe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new yt(Fe["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new yt(Fe["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Mt(Fe["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Mt(Fe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new yt(Fe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new yt(Fe["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new yt(Fe["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new yt(Fe["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Mt(Fe["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Mt(Fe["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new yt(Fe["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Mt({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Mt({type:"string",default:"default","property-type":"data-driven"})}))},e,s,l),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(n){return new fg(n)}queryRadius(){return ao(this.paint.get("fill-extrusion-translate"))}is3D(n){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(n,e,s,l,h,p,g,x,w){const T=aa(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),p.angle,n.pixelToTileUnitsFactor),I=this.paint.get("fill-extrusion-height").evaluate(e,s),M=this.paint.get("fill-extrusion-base").evaluate(e,s),R=[0,0],B=x&&p.elevation,V=p.elevation?p.elevation.exaggeration():1,q=n.tile.getBucket(this);if(B&&q instanceof fg){const le=q.centroidVertexArray,be=w+1;be<le.length&&(R[0]=le.geta_centroid_pos0(be),R[1]=le.geta_centroid_pos1(be))}if(R[0]===0&&R[1]===1)return!1;p.projection.name==="globe"&&(l=yv([l],[new mt(0,0),new mt(At,At)],n.tileID.canonical).map(le=>le.polygon).flat());const Z=B?x:null,[$,ne]=function(le,be,we,ke,Le,ze,rt,Be,st,ut,nt){return le.projection.name==="globe"?function(ot,gt,tt,ct,Xe,He,_t,dt,Yt,zt,Bt){const St=[],Gt=[],li=ot.projection.upVectorScale(Bt,ot.center.lat,ot.worldSize).metersToTile,kt=[0,0,0,1],jt=[0,0,0,1],ti=(Ii,_i,Ft,fi)=>{Ii[0]=_i,Ii[1]=Ft,Ii[2]=fi,Ii[3]=1},di=_v();tt>0&&(tt+=di),ct+=di;for(const Ii of gt){const _i=[],Ft=[];for(const fi of Ii){const Vi=fi.x+Xe.x,de=fi.y+Xe.y,fe=ot.projection.projectTilePoint(Vi,de,Bt),Ge=ot.projection.upVector(Bt,fi.x,fi.y);let it=tt,It=ct;if(_t){const Ct=Ev(Vi,de,tt,ct,_t,dt,Yt,zt);it+=Ct.base,It+=Ct.top}tt!==0?ti(kt,fe.x+Ge[0]*li*it,fe.y+Ge[1]*li*it,fe.z+Ge[2]*li*it):ti(kt,fe.x,fe.y,fe.z),ti(jt,fe.x+Ge[0]*li*It,fe.y+Ge[1]*li*It,fe.z+Ge[2]*li*It),Wi(kt,kt,He),Wi(jt,jt,He),_i.push(new Fc(kt[0],kt[1],kt[2])),Ft.push(new Fc(jt[0],jt[1],jt[2]))}St.push(_i),Gt.push(Ft)}return[St,Gt]}(le,be,we,ke,Le,ze,rt,Be,st,ut,nt):rt?function(ot,gt,tt,ct,Xe,He,_t,dt,Yt){const zt=[],Bt=[],St=[0,0,0,1];for(const Gt of ot){const li=[],kt=[];for(const jt of Gt){const ti=jt.x+ct.x,di=jt.y+ct.y,Ii=Ev(ti,di,gt,tt,He,_t,dt,Yt);St[0]=ti,St[1]=di,St[2]=Ii.base,St[3]=1,an(St,St,Xe),St[3]=Math.max(St[3],1e-5);const _i=new Fc(St[0]/St[3],St[1]/St[3],St[2]/St[3]);St[0]=ti,St[1]=di,St[2]=Ii.top,St[3]=1,an(St,St,Xe),St[3]=Math.max(St[3],1e-5);const Ft=new Fc(St[0]/St[3],St[1]/St[3],St[2]/St[3]);li.push(_i),kt.push(Ft)}zt.push(li),Bt.push(kt)}return[zt,Bt]}(be,we,ke,Le,ze,rt,Be,st,ut):function(ot,gt,tt,ct,Xe){const He=[],_t=[],dt=Xe[8]*gt,Yt=Xe[9]*gt,zt=Xe[10]*gt,Bt=Xe[11]*gt,St=Xe[8]*tt,Gt=Xe[9]*tt,li=Xe[10]*tt,kt=Xe[11]*tt;for(const jt of ot){const ti=[],di=[];for(const Ii of jt){const _i=Ii.x+ct.x,Ft=Ii.y+ct.y,fi=Xe[0]*_i+Xe[4]*Ft+Xe[12],Vi=Xe[1]*_i+Xe[5]*Ft+Xe[13],de=Xe[2]*_i+Xe[6]*Ft+Xe[14],fe=Xe[3]*_i+Xe[7]*Ft+Xe[15],Ge=fi+dt,it=Vi+Yt,It=de+zt,Ct=Math.max(fe+Bt,1e-5),Ot=fi+St,$t=Vi+Gt,ki=de+li,Mi=Math.max(fe+kt,1e-5);ti.push(new Fc(Ge/Ct,it/Ct,It/Ct)),di.push(new Fc(Ot/Mi,$t/Mi,ki/Mi))}He.push(ti),_t.push(di)}return[He,_t]}(be,we,ke,Le,ze)}(p,l,M,I,T,g,Z,R,V,p.center.lat,n.tileID.canonical),ae=n.queryGeometry;return function(le,be,we){let ke=1/0;cn(we,be)&&(ke=Tv(we,be[0]));for(let Le=0;Le<be.length;Le++){const ze=be[Le],rt=le[Le];for(let Be=0;Be<ze.length-1;Be++){const st=ze[Be],ut=[st,ze[Be+1],rt[Be+1],rt[Be],st];Sn(we,ut)&&(ke=Math.min(ke,Tv(we,ut)))}}return ke!==1/0&&ke}($,ne,ae.isPointQuery()?ae.screenBounds:ae.screenGeometry)}},building:class extends Ns{constructor(n,e,s,l){super(n,{layout:Jv||(Jv=new Nr({visibility:new yt(Fe.layout_building.visibility),"building-facade":new Mt(Fe.layout_building["building-facade"]),"building-facade-floors":new Mt(Fe.layout_building["building-facade-floors"]),"building-facade-unit-width":new Mt(Fe.layout_building["building-facade-unit-width"]),"building-facade-window":new Mt(Fe.layout_building["building-facade-window"]),"building-roof-shape":new Mt(Fe.layout_building["building-roof-shape"]),"building-height":new Mt(Fe.layout_building["building-height"]),"building-base":new Mt(Fe.layout_building["building-base"]),"building-flood-light-wall-radius":new Mt(Fe.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new Mt(Fe.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new Mt(Fe.layout_building["building-flip-roof-orientation"])})),paint:Kv||(Kv=new Nr({"building-opacity":new yt(Fe.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new yt(Fe.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new yt(Fe.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new yt(Fe.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new yt(Fe.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new yt(Fe.paint_building["building-vertical-scale"]),"building-cast-shadows":new yt(Fe.paint_building["building-cast-shadows"]),"building-color":new Mt(Fe.paint_building["building-color"]),"building-emissive-strength":new Mt(Fe.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new yt(Fe.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new yt(Fe.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new yt(Fe.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new yt(Fe.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new yt(Fe.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new Mt({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new Mt({type:"string",default:"default","property-type":"data-driven"})}))},e,s,l),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(n){return new $v(n)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(n){return!0}},line:class extends Ns{constructor(n,e,s,l){const h=l0();super(n,h,e,s,l),h.layout&&(this.layout=new Do(h.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(n){if(n==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof _c,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(n,e){super.recalculate(n,e),this.paint._values["line-floorwidth"]=(()=>{if(vf)return vf;const s=l0();return vf=new _A(s.paint.properties["line-width"].specification),vf.useIntegerZoom=!0,vf})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,n)}createBucket(n){return new L_(n)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(n,e,s){const l=a0(this);return{config:new Uo(this,{zoom:e,lut:s}),defines:l,overrideFog:!1}}queryRadius(n){const e=n,s=c0(Yn("line-width",this,e),Yn("line-gap-width",this,e)),l=Yn("line-offset",this,e);return s/2+Math.abs(l)+ao(this.paint.get("line-translate"))}queryIntersectsFeature(n,e,s,l,h,p){if(n.queryGeometry.isAboveHorizon)return!1;const g=oo(n.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),p.angle,n.pixelToTileUnitsFactor),x=n.pixelToTileUnitsFactor/2*c0(this.paint.get("line-width").evaluate(e,s),this.paint.get("line-gap-width").evaluate(e,s)),w=this.paint.get("line-offset").evaluate(e,s);return w&&(l=function(T,I){const M=[],R=new mt(0,0);for(let B=0;B<T.length;B++){const V=T[B],q=[];for(let Z=0;Z<V.length;Z++){const $=V[Z],ne=V[Z+1],ae=Z===0?R:$.sub(V[Z-1])._unit()._perp(),le=Z===V.length-1?R:ne.sub($)._unit()._perp(),be=ae._add(le)._unit();be._mult(1/(be.x*le.x+be.y*le.y)),q.push(be._mult(I)._add($))}M.push(q)}return M}(l,w*n.pixelToTileUnitsFactor)),function(T,I,M){for(let R=0;R<I.length;R++){const B=I[R];if(T.length>=3){for(let V=0;V<B.length;V++)if(vs(T,B[V]))return!0}if(hn(T,B,M))return!0}return!1}(g,l,x)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(n){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:Bg,background:class extends Ns{constructor(n,e,s,l){super(n,{layout:Q0||(Q0=new Nr({visibility:new yt(Fe.layout_background.visibility)})),paint:eb||(eb=new Nr({"background-pitch-alignment":new yt(Fe.paint_background["background-pitch-alignment"]),"background-color":new yt(Fe.paint_background["background-color"]),"background-pattern":new yt(Fe.paint_background["background-pattern"]),"background-opacity":new yt(Fe.paint_background["background-opacity"]),"background-emissive-strength":new yt(Fe.paint_background["background-emissive-strength"]),"background-color-use-theme":new Mt({type:"string",default:"default","property-type":"data-driven"})}))},e,s,l)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(n,e,s){return{overrideFog:!1}}is3D(n){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:nb,"raster-particle":ub,sky:class extends Ns{constructor(n,e,s,l){super(n,{layout:lb||(lb=new Nr({visibility:new yt(Fe.layout_sky.visibility)})),paint:cb||(cb=new Nr({"sky-type":new yt(Fe.paint_sky["sky-type"]),"sky-atmosphere-sun":new yt(Fe.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new yt(Fe.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new yt(Fe.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new yt(Fe.paint_sky["sky-gradient-radius"]),"sky-gradient":new yl(Fe.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new yt(Fe.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new yt(Fe.paint_sky["sky-atmosphere-color"]),"sky-opacity":new yt(Fe.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Mt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Mt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Mt({type:"string",default:"default","property-type":"data-driven"})}))},e,s,l),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(n){n==="sky-gradient"?this._updateColorRamp():n!=="sky-atmosphere-sun"&&n!=="sky-atmosphere-halo-color"&&n!=="sky-atmosphere-color"&&n!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=rf({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(n){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=n.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(n,e){if(this.paint.get("sky-type")==="atmosphere"){const l=this.paint.get("sky-atmosphere-sun"),h=!l,p=n.style.light,g=p.properties.get("position");return h&&p.properties.get("anchor")==="viewport"&&Di("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),h?J_(g.azimuthal,90-g.polar,e):J_(l[0],90-l[1],e)}const s=this.paint.get("sky-gradient-center");return J_(s[0],90-s[1],e)}isSky(){return!0}markSkyboxValid(n){this._skyboxInvalidated=!1,this._lightPosition=n.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const n=this.paint.get("sky-type");return n==="atmosphere"?["skyboxCapture","skybox"]:n==="gradient"?["skyboxGradient"]:null}},slot:class extends Ns{constructor(n,e,s,l){super(n,{paint:hb||(hb=new Nr({}))},e,null)}},model:class extends Ns{constructor(n,e,s,l){super(n,{layout:gb||(gb=new Nr({visibility:new yt(Fe.layout_model.visibility),"model-id":new Mt(Fe.layout_model["model-id"])})),paint:mb||(mb=new Nr({"model-opacity":new Mt(Fe.paint_model["model-opacity"]),"model-rotation":new Mt(Fe.paint_model["model-rotation"]),"model-scale":new Mt(Fe.paint_model["model-scale"]),"model-translation":new Mt(Fe.paint_model["model-translation"]),"model-color":new Mt(Fe.paint_model["model-color"]),"model-color-mix-intensity":new Mt(Fe.paint_model["model-color-mix-intensity"]),"model-type":new yt(Fe.paint_model["model-type"]),"model-cast-shadows":new yt(Fe.paint_model["model-cast-shadows"]),"model-receive-shadows":new yt(Fe.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new yt(Fe.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Mt(Fe.paint_model["model-emissive-strength"]),"model-roughness":new Mt(Fe.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Mt(Fe.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new yt(Fe.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new yt(Fe.paint_model["model-front-cutoff"]),"model-elevation-reference":new yt(Fe.paint_model["model-elevation-reference"]),"model-color-use-theme":new Mt({type:"string",default:"default","property-type":"data-driven"})}))},e,s,l),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(n){return new Q_(n)}getProgramIds(){return["model"]}is3D(n){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(n){return n instanceof jg?At-1:0}queryIntersectsFeature(n,e,s,l,h,p){if(!this.modelManager)return!1;const g=this.modelManager,x=n.tile.getBucket(this);if(!(x&&x instanceof Q_))return!1;for(const w in x.instancesPerModel){const T=x.instancesPerModel[w],I=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(T.idToFeaturesIndex.hasOwnProperty(I)){const M=T.features[T.idToFeaturesIndex[I]],R=g.getModel(w,this.scope);if(!R)return!1;let B=G();const V=new Y(0,0),q=x.canonical;let Z=Number.MAX_VALUE;for(let $=0;$<M.instancedDataCount;++$){const ne=16*(M.instancedDataOffset+$),ae=T.instancedDataArray.float32,le=[ae[ne+4],ae[ne+5],ae[ne+6]];bb(q,V,ae[ne],0|ae[ne+1]),jv(B,R,p,V,M.rotation,M.scale,le,!1,!1,!1),p.projection.name==="globe"&&(B=E_(B,p));const be=ee([],p.projMatrix,B),we=n.queryGeometry,ke=Uv(we.isPointQuery()?we.screenBounds:we.screenGeometry,p,be,R.aabb);ke!=null&&(Z=Math.min(ke,Z))}return Z!==Number.MAX_VALUE&&Z}}return!1}_handleOverridablePaintPropertyUpdate(n,e,s){return!(!this.layout||e.isDataDriven()||s.isDataDriven()||n!=="model-color"&&n!=="model-color-mix-intensity"&&n!=="model-rotation"&&n!=="model-scale"&&n!=="model-translation"&&n!=="model-emissive-strength")}_isPropertyZoomDependent(n){const e=this._transitionablePaint._values[n];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof Ja}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends Ns{constructor(n,e,s,l){super(n,{layout:Jx||(Jx=new Nr({"clip-layer-types":new yt(Fe.layout_clip["clip-layer-types"]),"clip-layer-scope":new yt(Fe.layout_clip["clip-layer-scope"])})),paint:Kx||(Kx=new Nr({}))},e,s,l)}recalculate(n,e){super.recalculate(n,e)}createBucket(n){return new Qx(n)}is3D(n){return!0}}},ty=new er(0,0,0),iy={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},ry={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},Hg={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},bT={PAINT_ORDER_FILL_AND_STROKE:1},Lf={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},wb={MASK_TYPE_LUMINANCE:1};function wT(n,e,s){n===1&&e.icons.push(function(l,h){return function(p){if(p.usvg_tree.height||(p.usvg_tree.height=p.usvg_tree.width),!p.metadata)return p;const{metadata:g}=p;if(g.content_area){const{content_area:x}=g;x.left==null&&(x.left=0),x.top==null&&(x.top=x.left),x.width==null&&(x.width=p.usvg_tree.width),x.height==null&&(x.height=x.width)}if(g.text_placeholder){const{text_placeholder:x}=g;x.top==null&&(x.top=x.left),x.height==null&&(x.height=x.width)}return g.stretch_x&&g.stretch_x.length&&Sb(g,"x"),g.stretch_y&&g.stretch_y.length&&Sb(g,"y"),p}(l.readFields(ST,{name:void 0},h))}(s,s.readVarint()+s.pos))}function Sb(n,e){const s=[],l=n[`stretch_${e}`];let h=null;for(let p=0;p<l.length;p++)h===null?h=s.length===0?l[0]:s[s.length-1][1]+l[p]:(s.push([h,h+l[p]]),h=null);n[`stretch_${e}_areas`]=s}function ST(n,e,s){n===1?e.name=s.readString():n===2?e.metadata=function(l,h){return l.readFields(AT,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},h)}(s,s.readVarint()+s.pos):n===3&&(e.usvg_tree=function(l,h){return l.readFields(CT,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},h)}(s,s.readVarint()+s.pos),e.data="usvg_tree")}function AT(n,e,s){n===1?e.stretch_x=s.readPackedVarint():n===2?e.stretch_y=s.readPackedVarint():n===3?e.content_area=Ab(s,s.readVarint()+s.pos):n===4?e.variables.push(function(l,h){return l.readFields(ET,{name:void 0},h)}(s,s.readVarint()+s.pos)):n===5&&(e.text_placeholder=Ab(s,s.readVarint()+s.pos))}function Ab(n,e){return n.readFields(TT,{},e)}function TT(n,e,s){n===1?e.left=s.readVarint():n===2?e.width=s.readVarint():n===3?e.top=s.readVarint():n===4&&(e.height=s.readVarint())}function ET(n,e,s){n===1?e.name=s.readString():n===2&&(e.rgb_color=Xg(s.readVarint()),e.value="rgb_color")}function CT(n,e,s){n===1?e.width=e.height=s.readVarint():n===2?e.height=s.readVarint():n===3?e.children.push(Wg(s,s.readVarint()+s.pos)):n===4?e.linear_gradients.push(function(l,h){return l.readFields(RT,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},h)}(s,s.readVarint()+s.pos)):n===5?e.radial_gradients.push(function(l,h){return l.readFields(OT,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},h)}(s,s.readVarint()+s.pos)):n===7?e.clip_paths.push(function(l,h){return l.readFields(FT,{children:[]},h)}(s,s.readVarint()+s.pos)):n===8&&e.masks.push(function(l,h){const p=l.readFields(BT,{left:0,width:20,mask_type:wb.MASK_TYPE_LUMINANCE,children:[]},h);return p.height==null&&(p.height=p.width),p.top==null&&(p.top=p.left),p}(s,s.readVarint()+s.pos))}function Wg(n,e){return n.readFields(IT,{},e)}function IT(n,e,s){n===1?(e.group=function(l,h){return l.readFields(kT,{opacity:255,children:[]},h)}(s,s.readVarint()+s.pos),e.node="group"):n===2&&(e.path=function(l,h){return l.readFields(PT,{paint_order:1,commands:[],step:1,diffs:[],rule:iy.PATH_RULE_NON_ZERO},h)}(s,s.readVarint()+s.pos),e.node="path")}function kT(n,e,s){n===1?e.transform=Gg(s,s.readVarint()+s.pos):n===2?e.opacity=s.readVarint():n===5?e.clip_path_idx=s.readVarint():n===6?e.mask_idx=s.readVarint():n===7&&e.children.push(Wg(s,s.readVarint()+s.pos))}function Gg(n,e){return n.readFields(MT,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function MT(n,e,s){n===1?e.sx=s.readFloat():n===2?e.ky=s.readFloat():n===3?e.kx=s.readFloat():n===4?e.sy=s.readFloat():n===5?e.tx=s.readFloat():n===6&&(e.ty=s.readFloat())}function PT(n,e,s){n===1?e.fill=function(l,h){return l.readFields(LT,{rgb_color:ty,paint:"rgb_color",opacity:255},h)}(s,s.readVarint()+s.pos):n===2?e.stroke=function(l,h){return l.readFields(zT,{rgb_color:ty,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},h)}(s,s.readVarint()+s.pos):n===3?e.paint_order=s.readVarint():n===5?s.readPackedVarint(e.commands):n===6?e.step=s.readFloat():n===7?s.readPackedSVarint(e.diffs):n===8&&(e.rule=s.readVarint())}function LT(n,e,s){n===1?(e.rgb_color=Xg(s.readVarint()),e.paint="rgb_color"):n===2?(e.linear_gradient_idx=s.readVarint(),e.paint="linear_gradient_idx"):n===3?(e.radial_gradient_idx=s.readVarint(),e.paint="radial_gradient_idx"):n===5&&(e.opacity=s.readVarint())}function Xg(n){return new er((n>>16&255)/255,(n>>8&255)/255,(255&n)/255,1)}function zT(n,e,s){n===1?(e.rgb_color=Xg(s.readVarint()),e.paint="rgb_color"):n===2?(e.linear_gradient_idx=s.readVarint(),e.paint="linear_gradient_idx"):n===3?(e.radial_gradient_idx=s.readVarint(),e.paint="radial_gradient_idx"):n===5?s.readPackedFloat(e.dasharray):n===6?e.dashoffset=s.readFloat():n===7?e.miterlimit=s.readFloat():n===8?e.opacity=s.readVarint():n===9?e.width=s.readFloat():n===10?e.linecap=s.readVarint():n===11&&(e.linejoin=s.readVarint())}function RT(n,e,s){n===1?e.transform=Gg(s,s.readVarint()+s.pos):n===2?e.spread_method=s.readVarint():n===3?e.stops.push(Tb(s,s.readVarint()+s.pos)):n===4?e.x1=s.readFloat():n===5?e.y1=s.readFloat():n===6?e.x2=s.readFloat():n===7&&(e.y2=s.readFloat())}function Tb(n,e){return n.readFields(DT,{offset:0,opacity:255,rgb_color:ty},e)}function DT(n,e,s){n===1?e.offset=s.readFloat():n===2?e.opacity=s.readVarint():n===3&&(e.rgb_color=Xg(s.readVarint()))}function OT(n,e,s){n===1?e.transform=Gg(s,s.readVarint()+s.pos):n===2?e.spread_method=s.readVarint():n===3?e.stops.push(Tb(s,s.readVarint()+s.pos)):n===4?e.cx=s.readFloat():n===5?e.cy=s.readFloat():n===6?e.r=s.readFloat():n===7?e.fx=s.readFloat():n===8?e.fy=s.readFloat():n===9&&(e.fr=s.readFloat())}function FT(n,e,s){n===1?e.transform=Gg(s,s.readVarint()+s.pos):n===2?e.clip_path_idx=s.readVarint():n===3&&e.children.push(Wg(s,s.readVarint()+s.pos))}function BT(n,e,s){n===1?e.left=e.top=s.readFloat():n===2?e.width=e.height=s.readFloat():n===3?e.top=s.readFloat():n===4?e.height=s.readFloat():n===5?e.mask_type=s.readVarint():n===6?e.mask_idx=s.readVarint():n===7&&e.children.push(Wg(s,s.readVarint()+s.pos))}class NT{static calculate(e={},s=[]){const l=new Map,h=new Map;if(Object.keys(e).length===0)return l;s.forEach(p=>{h.set(p.name,p.rgb_color||new er(0,0,0))});for(const[p,g]of Object.entries(e))h.has(p)?l.set(h.get(p).toString(),g):console.warn(`Ignoring unknown image variable "${p}"`);return l}}function Eu(n,e=255,s){const l=e/255,h=n.toString(),p=s.has(h)?s.get(h).clone():n.clone();return p.a*=l,p.toString()}function zf(n,e){if(!Gu()){const s=document.createElement("canvas");return s.width=n,s.height=e,s}return new OffscreenCanvas(n,e)}function VT(n,e){const s=NT.calculate(e.params,n.metadata?n.metadata.variables:[]),l=n.usvg_tree,h=l.width,p=l.height,g=e.transform?e.transform:new DOMMatrix,x=Math.max(1,Math.round(h*g.a)),w=Math.max(1,Math.round(p*g.d)),T=new DOMMatrix([x/h,0,0,w/p,0,0]),I=zf(x,w).getContext("2d");return sy(I,T,l,l,s),I.getImageData(0,0,x,w)}function sy(n,e,s,l,h){for(const p of l.children)Eb(n,e,s,p,h)}function Eb(n,e,s,l,h){l.group?(n.save(),function(p,g,x,w,T){const I=w.mask_idx!=null?x.masks[w.mask_idx]:null,M=w.clip_path_idx!=null?x.clip_paths[w.clip_path_idx]:null;if(w.transform&&(g=Cu(w.transform).preMultiplySelf(g)),!function(V,q,Z){return V.opacity!==255||q||Z}(w,M!=null,I!=null))return void sy(p,g,x,w,T);const R=zf(p.canvas.width,p.canvas.height),B=R.getContext("2d");sy(B,g,x,w,T),M&&zb(B,g,x,M),I&&Rb(B,g,x,I,T),p.globalAlpha=w.opacity/255,p.drawImage(R,0,0)}(n,e,s,l.group,h),n.restore()):l.path&&(n.save(),function(p,g,x,w,T){p.setTransform(g),w.paint_order===bT.PAINT_ORDER_FILL_AND_STROKE?(Cb(p,x,w,T),kb(p,x,w,T)):(kb(p,x,w,T),Cb(p,x,w,T))}(n,e,s,l.path,h),n.restore())}function Cb(n,e,s,l){const h=s.fill;if(!h)return;const p=h.opacity/255;switch(n.save(),n.beginPath(),Db(s,n),h.paint){case"rgb_color":n.fillStyle=Eu(h.rgb_color,h.opacity,l);break;case"linear_gradient_idx":{const g=e.linear_gradients[h.linear_gradient_idx];g.transform&&n.setTransform(Cu(g.transform).preMultiplySelf(n.getTransform())),n.fillStyle=Mb(n,g,p,l);break}case"radial_gradient_idx":{const g=e.radial_gradients[h.radial_gradient_idx];g.transform&&n.setTransform(Cu(g.transform).preMultiplySelf(n.getTransform())),n.fillStyle=Pb(n,g,p,l)}}n.fill(Ib(s)),n.restore()}function Ib(n){return n.rule===iy.PATH_RULE_NON_ZERO?"nonzero":n.rule===iy.PATH_RULE_EVEN_ODD?"evenodd":void 0}function kb(n,e,s,l){const h=s.stroke;if(!h)return;const p=Ob(s);n.lineWidth=h.width,n.miterLimit=h.miterlimit,n.setLineDash(h.dasharray),n.lineDashOffset=h.dashoffset;const g=h.opacity/255;switch(h.paint){case"rgb_color":n.strokeStyle=Eu(h.rgb_color,h.opacity,l);break;case"linear_gradient_idx":n.strokeStyle=Mb(n,e.linear_gradients[h.linear_gradient_idx],g,l,!0);break;case"radial_gradient_idx":n.strokeStyle=Pb(n,e.radial_gradients[h.radial_gradient_idx],g,l,!0)}switch(h.linejoin){case Hg.LINE_JOIN_MITER_CLIP:case Hg.LINE_JOIN_MITER:n.lineJoin="miter";break;case Hg.LINE_JOIN_ROUND:n.lineJoin="round";break;case Hg.LINE_JOIN_BEVEL:n.lineJoin="bevel"}switch(h.linecap){case ry.LINE_CAP_BUTT:n.lineCap="butt";break;case ry.LINE_CAP_ROUND:n.lineCap="round";break;case ry.LINE_CAP_SQUARE:n.lineCap="square"}n.stroke(p)}function Mb(n,e,s,l,h=!1){if(e.stops.length===1){const R=e.stops[0];return Eu(R.rgb_color,R.opacity*s,l)}const{x1:p,y1:g,x2:x,y2:w}=e;let T=new DOMPoint(p,g),I=new DOMPoint(x,w);if(h){const R=Cu(e.transform);T=R.transformPoint(T),I=R.transformPoint(I)}const M=n.createLinearGradient(T.x,T.y,I.x,I.y);for(const R of e.stops)M.addColorStop(R.offset,Eu(R.rgb_color,R.opacity*s,l));return M}function Pb(n,e,s,l,h=!1){if(e.stops.length===1){const $=e.stops[0];return Eu($.rgb_color,$.opacity*s,l)}const p=Cu(e.transform),{fx:g,fy:x,fr:w,cx:T,cy:I,r:M}=e;let R=new DOMPoint(g,x),B=new DOMPoint(T,I),V=w,q=M;if(h){R=p.transformPoint(R),B=p.transformPoint(B);const $=(p.a+p.d)/2;V=w*$,q=e.r*$}const Z=n.createRadialGradient(R.x,R.y,V,B.x,B.y,q);for(const $ of e.stops)Z.addColorStop($.offset,Eu($.rgb_color,$.opacity*s,l));return Z}function Lb(n,e,s,l){const h=l.transform?Cu(l.transform).preMultiplySelf(e):e,p=zf(n.canvas.width,n.canvas.height),g=p.getContext("2d");for(const w of l.children)if(w.group)Lb(g,h,s,w.group);else if(w.path){const T=w.path,I=new Path2D;I.addPath(Ob(T),h),g.fill(I,Ib(T))}const x=l.clip_path_idx!=null?s.clip_paths[l.clip_path_idx]:null;x&&zb(g,h,s,x),n.globalCompositeOperation="source-over",n.drawImage(p,0,0)}function zb(n,e,s,l){const h=zf(n.canvas.width,n.canvas.height);Lb(h.getContext("2d"),e,s,l),n.globalCompositeOperation="destination-in",n.drawImage(h,0,0)}function Rb(n,e,s,l,h){if(l.children.length===0)return;const p=l.mask_idx!=null?s.masks[l.mask_idx]:null;p&&Rb(n,e,s,p,h);const g=n.canvas.width,x=n.canvas.height,w=zf(g,x),T=w.getContext("2d"),I=l.width,M=l.height,R=l.left,B=l.top,V=new Path2D,q=new Path2D;q.rect(R,B,I,M),V.addPath(q,e),T.clip(V);for(const ne of l.children)Eb(T,e,s,ne,h);const Z=T.getImageData(0,0,g,x),$=Z.data;if(l.mask_type===wb.MASK_TYPE_LUMINANCE)for(let ne=0;ne<$.length;ne+=4)$[ne+3]=$[ne+3]/255*(.2126*$[ne]+.7152*$[ne+1]+.0722*$[ne+2]);T.putImageData(Z,0,0),n.globalCompositeOperation="destination-in",n.drawImage(w,0,0)}function Cu(n){return n?new DOMMatrix([n.sx,n.ky,n.kx,n.sy,n.tx,n.ty]):new DOMMatrix}function Db(n,e){const s=n.step;let l=n.diffs[0]*s,h=n.diffs[1]*s;e.moveTo(l,h);for(let p=0,g=2;p<n.commands.length;p++)switch(n.commands[p]){case Lf.PATH_COMMAND_MOVE:l+=n.diffs[g++]*s,h+=n.diffs[g++]*s,e.moveTo(l,h);break;case Lf.PATH_COMMAND_LINE:l+=n.diffs[g++]*s,h+=n.diffs[g++]*s,e.lineTo(l,h);break;case Lf.PATH_COMMAND_QUAD:{const x=l+n.diffs[g++]*s,w=h+n.diffs[g++]*s;l=x+n.diffs[g++]*s,h=w+n.diffs[g++]*s,e.quadraticCurveTo(x,w,l,h);break}case Lf.PATH_COMMAND_CUBIC:{const x=l+n.diffs[g++]*s,w=h+n.diffs[g++]*s,T=x+n.diffs[g++]*s,I=w+n.diffs[g++]*s;l=T+n.diffs[g++]*s,h=I+n.diffs[g++]*s,e.bezierCurveTo(x,w,T,I,l,h);break}case Lf.PATH_COMMAND_CLOSE:e.closePath()}return e}function Ob(n){return Db(n,new Path2D)}class Yg{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const s=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,s),s}put(e,s){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,s)}delete(e){this.cache.delete(e)}}Dt(Yg,"LRUCache");class ny{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new Rs(e,e.data)}getFromCache(e,s,l){return this.cacheMap.has(l)||this.cacheMap.set(l,new Yg(150)),this.cacheMap.get(l).get(vl(e.toString(),s))}setInCache(e,s,l,h){this.cacheDependenciesMap.has(h)||this.cacheDependenciesMap.set(h,new Map),this.cacheMap.has(h)||this.cacheMap.set(h,new Yg(150));const p=this.cacheDependenciesMap.get(h),g=vl(e.id.toString(),l);p.get(g)||p.set(g,new Set);const x=this.cacheMap.get(h),w=e.toString();p.get(g).add(w),x.put(vl(e.toString(),l),s)}removeImagesFromCacheByIds(e,s,l=0){if(!this.cacheMap.has(l)||!this.cacheDependenciesMap.has(l))return;const h=this.cacheMap.get(l),p=this.cacheDependenciesMap.get(l);for(const g of e){const x=vl(g.toString(),s);if(p.has(x)){for(const w of p.get(x))h.delete(w);p.delete(x)}}}rasterize(e,s,l,h,p=VT){const g=this.getFromCache(e,l,h);if(g)return g.clone();const x=p(s.icon,e.options),w=ny._getImage(x);return this.setInCache(e,w,l,h),w.clone()}}class Fb{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,s){const l=this.toIdx(e,s);return{min:this.minimums[l],max:this.maximums[l]}}isLeaf(e,s){return this.leaves[this.toIdx(e,s)]}toIdx(e,s){return s*this.size+e}}function Bb(n,e,s,l){let h=0,p=Number.MAX_VALUE;for(let g=0;g<3;g++)if(Math.abs(l[g])<1e-15){if(s[g]<n[g]||s[g]>e[g])return null}else{const x=1/l[g];let w=(n[g]-s[g])*x,T=(e[g]-s[g])*x;if(w>T){const I=w;w=T,T=I}if(w>h&&(h=w),T<p&&(p=T),h>p)return null}return h}function Nb(n,e,s,l,h,p,g,x,w,T,I){const M=l-n,R=h-e,B=p-s,V=g-n,q=x-e,Z=w-s,$=I[1]*Z-I[2]*q,ne=I[2]*V-I[0]*Z,ae=I[0]*q-I[1]*V,le=M*$+R*ne+B*ae;if(Math.abs(le)<1e-15)return null;const be=1/le,we=T[0]-n,ke=T[1]-e,Le=T[2]-s,ze=(we*$+ke*ne+Le*ae)*be;if(ze<0||ze>1)return null;const rt=ke*B-Le*R,Be=Le*M-we*B,st=we*R-ke*M,ut=(I[0]*rt+I[1]*Be+I[2]*st)*be;return ut<0||ze+ut>1?null:(V*rt+q*Be+Z*st)*be}function Vb(n,e,s){return(n-e)/(s-e)}function Ub(n,e,s,l,h,p,g,x,w){const T=1<<s,I=p-l,M=g-h,R=(n+1)/T*I+l,B=(e+0)/T*M+h,V=(e+1)/T*M+h;x[0]=(n+0)/T*I+l,x[1]=B,w[0]=R,w[1]=V}class jb{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const s=function(p){const g=Math.ceil(Math.log2(p.dim/8)),x=[];let w=Math.ceil(Math.pow(2,g));const T=1/w,I=(B,V,q,Z,$)=>{const ne=Z?1:0,ae=(B+1)*q-ne,le=V*q,be=(V+1)*q-ne;$[0]=B*q,$[1]=le,$[2]=ae,$[3]=be};let M=new Fb(w);const R=[];for(let B=0;B<w*w;B++){I(B%w,Math.floor(B/w),T,!1,R);const V=Dl(R[0],R[1],p),q=Dl(R[2],R[1],p),Z=Dl(R[2],R[3],p),$=Dl(R[0],R[3],p);M.minimums.push(Math.min(V,q,Z,$)),M.maximums.push(Math.max(V,q,Z,$)),M.leaves.push(1)}for(x.push(M),w/=2;w>=1;w/=2){const B=x[x.length-1];M=new Fb(w);for(let V=0;V<w*w;V++){I(V%w,Math.floor(V/w),2,!0,R);const q=B.getElevation(R[0],R[1]),Z=B.getElevation(R[2],R[1]),$=B.getElevation(R[2],R[3]),ne=B.getElevation(R[0],R[3]),ae=B.isLeaf(R[0],R[1]),le=B.isLeaf(R[2],R[1]),be=B.isLeaf(R[2],R[3]),we=B.isLeaf(R[0],R[3]),ke=Math.min(q.min,Z.min,$.min,ne.min),Le=Math.max(q.max,Z.max,$.max,ne.max),ze=ae&&le&&be&&we;M.maximums.push(Le),M.minimums.push(ke),M.leaves.push(Le-ke<=5&&ze?1:0)}x.push(M)}return x}(this.dem),l=s.length-1,h=s[l];this._addNode(h.minimums[0],h.maximums[0],h.leaves[0]),this._construct(s,0,0,l,0)}raycastRoot(e,s,l,h,p,g,x=1){return Bb([e,s,-100],[l,h,this.maximums[0]*x],p,g)}raycast(e,s,l,h,p,g,x=1){if(!this.nodeCount)return null;const w=this.raycastRoot(e,s,l,h,p,g,x);if(w==null)return null;const T=[],I=[],M=[],R=[],B=[{idx:0,t:w,nodex:0,nodey:0,depth:0}];for(;B.length>0;){const{idx:V,t:q,nodex:Z,nodey:$,depth:ne}=B.pop();if(this.leaves[V]){Ub(Z,$,ne,e,s,l,h,M,R);const le=1<<ne,be=(Z+0)/le,we=(Z+1)/le,ke=($+0)/le,Le=($+1)/le,ze=Dl(be,ke,this.dem)*x,rt=Dl(we,ke,this.dem)*x,Be=Dl(we,Le,this.dem)*x,st=Dl(be,Le,this.dem)*x,ut=Nb(M[0],M[1],ze,R[0],M[1],rt,R[0],R[1],Be,p,g),nt=Nb(R[0],R[1],Be,M[0],R[1],st,M[0],M[1],ze,p,g),ot=Math.min(ut!==null?ut:Number.MAX_VALUE,nt!==null?nt:Number.MAX_VALUE);if(ot!==Number.MAX_VALUE)return ot;{const gt=Hi([],p,g,q);if(Hb(ze,rt,st,Be,Vb(gt[0],M[0],R[0]),Vb(gt[1],M[1],R[1]))>=gt[2])return q}continue}let ae=0;for(let le=0;le<this._siblingOffset.length;le++){Ub((Z<<1)+this._siblingOffset[le][0],($<<1)+this._siblingOffset[le][1],ne+1,e,s,l,h,M,R),M[2]=-100,R[2]=this.maximums[this.childOffsets[V]+le]*x;const be=Bb(M,R,p,g);if(be!=null){const we=be;T[le]=we;let ke=!1;for(let Le=0;Le<ae&&!ke;Le++)we>=T[I[Le]]&&(I.splice(Le,0,le),ke=!0);ke||(I[ae]=le),ae++}}for(let le=0;le<ae;le++){const be=I[le];B.push({idx:this.childOffsets[V]+be,t:T[be],nodex:(Z<<1)+this._siblingOffset[be][0],nodey:($<<1)+this._siblingOffset[be][1],depth:ne+1})}}return null}_addNode(e,s,l){return this.minimums.push(e),this.maximums.push(s),this.leaves.push(l),this.childOffsets.push(0),this.nodeCount++}_construct(e,s,l,h,p){if(e[h].isLeaf(s,l)===1)return;this.childOffsets[p]||(this.childOffsets[p]=this.nodeCount);const g=h-1,x=e[g];let w=0,T=0;for(let I=0;I<this._siblingOffset.length;I++){const M=2*s+this._siblingOffset[I][0],R=2*l+this._siblingOffset[I][1],B=x.getElevation(M,R),V=x.isLeaf(M,R),q=this._addNode(B.min,B.max,V);V&&(w|=1<<I),T||(T=q)}for(let I=0;I<this._siblingOffset.length;I++)w&1<<I||this._construct(e,2*s+this._siblingOffset[I][0],2*l+this._siblingOffset[I][1],g,T+I)}}function Hb(n,e,s,l,h,p){return ei(ei(n,s,p),ei(e,l,p),h)}function Dl(n,e,s){const l=s.dim,h=Ee(n*l-.5,0,l-1),p=Ee(e*l-.5,0,l-1),g=Math.floor(h),x=Math.floor(p),w=Math.min(g+1,l-1),T=Math.min(x+1,l-1);return Hb(s.get(g,x),s.get(w,x),s.get(g,T),s.get(w,T),h-g,p-x)}const UT={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function jT(n,e,s){return(256*n*256+256*e+s)/10-1e4}function HT(n,e,s){return 256*n+e+s/256-32768}class qg{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,s,l,h=!1){if(this.uid=e,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(l&&l!=="mapbox"&&l!=="terrarium")return void Di(`"${l}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=s.height;const p=this.dim=s.height-2,g=new Uint32Array(s.data.buffer);if(this.pixels=new Uint8Array(s.data.buffer),this.floatView=new Float32Array(s.data.buffer),this.borderReady=h,this._modifiedForSources={},!h){for(let w=0;w<p;w++)g[this._idx(-1,w)]=g[this._idx(0,w)],g[this._idx(p,w)]=g[this._idx(p-1,w)],g[this._idx(w,-1)]=g[this._idx(w,0)],g[this._idx(w,p)]=g[this._idx(w,p-1)];g[this._idx(-1,-1)]=g[this._idx(0,0)],g[this._idx(p,-1)]=g[this._idx(p-1,0)],g[this._idx(-1,p)]=g[this._idx(0,p-1)],g[this._idx(p,p)]=g[this._idx(p-1,p-1)]}const x=l==="terrarium"?HT:jT;for(let w=0;w<g.length;++w){const T=4*w;this.floatView[w]=x(this.pixels[T],this.pixels[T+1],this.pixels[T+2])}this._timestamp=Kn.now()}_buildQuadTree(){this._tree=new jb(this)}get(e,s,l=!1){l&&(e=Ee(e,-1,this.dim),s=Ee(s,-1,this.dim));const h=this._idx(e,s);return this.floatView[h]}set(e,s,l){const h=this._idx(e,s),p=this.floatView[h];return this.floatView[h]=l,l-p}static getUnpackVector(e){return UT[e]}_idx(e,s){if(e<-1||e>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(e+1)}static pack(e,s){const l=[0,0,0,0],h=qg.getUnpackVector(s);let p=Math.floor((e+h[3])/h[2]);return l[2]=p%256,p=Math.floor(p/256),l[1]=p%256,p=Math.floor(p/256),l[0]=p,l}getPixels(){return new Fx({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,s,l){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let h=s*this.dim,p=s*this.dim+this.dim,g=l*this.dim,x=l*this.dim+this.dim;switch(s){case-1:h=p-1;break;case 1:p=h+1}switch(l){case-1:g=x-1;break;case 1:x=g+1}const w=-s*this.dim,T=-l*this.dim;for(let I=g;I<x;I++)for(let M=h;M<p;M++){const R=4*this._idx(M,I),B=4*this._idx(M+w,I+T);this.pixels[R+0]=e.pixels[B+0],this.pixels[R+1]=e.pixels[B+1],this.pixels[R+2]=e.pixels[B+2],this.pixels[R+3]=e.pixels[B+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function WT(n,e,s){n===1?e.headerLength=s.readFixed32():n===2?e.x=s.readVarint():n===3?e.y=s.readVarint():n===4?e.z=s.readVarint():n===5&&e.layers.push(function(l,h){return l.readFields(ZT,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},h)}(s,s.readVarint()+s.pos))}function GT(n,e,s){n===1?(e.delta_filter=function(l,h){return l.readFields(XT,{blockSize:0},h)}(s,s.readVarint()+s.pos),e.filter="delta_filter"):n===2?(s.readVarint(),e.filter="zigzag_filter"):n===3?(s.readVarint(),e.filter="bitshuffle_filter"):n===4&&(s.readVarint(),e.filter="byteshuffle_filter")}function XT(n,e,s){n===1&&(e.blockSize=s.readVarint())}function YT(n,e,s){n===1?(s.readVarint(),e.codec="gzip_data"):n===2?(s.readVarint(),e.codec="jpeg_image"):n===3?(s.readVarint(),e.codec="webp_image"):n===4&&(s.readVarint(),e.codec="png_image")}function qT(n,e,s){let l=0,h=0;n===1?e.firstByte=s.readFixed64():n===2?e.lastByte=s.readFixed64():n===3?e.filters.push(function(p,g){return p.readFields(GT,{},g)}(s,s.readVarint()+s.pos)):n===4?e.codec=function(p,g){return p.readFields(YT,{},g)}(s,s.readVarint()+s.pos):n===5?h=s.readFloat():n===6?l=s.readFloat():n===7?e.bands.push(s.readString()):n===8?e.offset=s.readDouble():n===9&&(e.scale=s.readDouble()),e.offset===0&&(e.offset=h),e.scale===0&&(e.scale=l)}function ZT(n,e,s){n===1?e.version=s.readVarint():n===2?e.name=s.readString():n===3?e.units=s.readString():n===4?e.tileSize=s.readVarint():n===5?e.buffer=s.readVarint():n===6?e.pixelFormat=s.readVarint():n===7&&e.dataIndex.push(function(l,h){return l.readFields(qT,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},h)}(s,s.readVarint()+s.pos))}function $T(n,e,s){if(n===2)(function(l,h,p){l.readFields(JT,p,h)})(s,s.readVarint()+s.pos,e);else if(n===3)throw new Error("Not implemented")}function JT(n,e,s){if(n===1){let l=0;const h=s.readVarint()+s.pos;for(;s.pos<h;)e[l++]=s.readVarint()}}function KT(n,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let s=e[3];for(let l=2;l>=1;l--){const h=l===1?1:0,p=l===2?1:0;for(let g=0;g<e[0];g++){const x=e[1]*g;for(let w=h;w<e[1];w++){const T=e[2]*(w+x);for(let I=p;I<e[2];I++){const M=e[3]*(I+T);for(let R=0;R<e[3];R++){const B=M+R;n[B]+=n[B-s]}}}}s*=e[l]}return n}function QT(n){for(let e=0,s=n.length;e<s;e++)n[e]=n[e]>>>1^-(1&n[e]);return n}function e2(n,e){switch(e){case"uint32":return n;case"uint16":for(let s=0;s<n.length;s+=2){const l=n[s],h=n[s+1];n[s]=(240&l)>>4|(61440&l)>>8|(240&h)<<4|61440&h,n[s+1]=15&l|(3840&l)>>4|(15&h)<<8|(3840&h)<<4}return n;case"uint8":for(let s=0;s<n.length;s+=4){const l=n[s],h=n[s+1],p=n[s+2],g=n[s+3];n[s+0]=(192&l)>>6|(192&h)>>4|(192&p)>>2|192&g,n[s+1]=(48&l)>>4|(48&h)>>2|48&p|(48&g)<<2,n[s+2]=(12&l)>>2|12&h|(12&p)<<2|(12&g)<<4,n[s+3]=3&l|(3&h)<<2|(3&p)<<4|(3&g)<<6}return n;default:throw new Error(`Invalid pixel format, "${e}"`)}}Dt(qg,"DEMData"),Dt(jb,"DemMinMaxQuadTree",{omit:["dem"]});var qn=Uint8Array,Rf=Uint16Array,t2=Int32Array,Wb=new qn([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Gb=new qn([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),i2=new qn([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Xb=function(n,e){for(var s=new Rf(31),l=0;l<31;++l)s[l]=e+=1<<n[l-1];var h=new t2(s[30]);for(l=1;l<30;++l)for(var p=s[l];p<s[l+1];++p)h[p]=p-s[l]<<5|l;return{b:s,r:h}},Yb=Xb(Wb,2),qb=Yb.b,r2=Yb.r;qb[28]=258,r2[258]=28;for(var s2=Xb(Gb,0).b,Zb=new Rf(32768),ms=0;ms<32768;++ms){var Iu=(43690&ms)>>1|(21845&ms)<<1;Zb[ms]=((65280&(Iu=(61680&(Iu=(52428&Iu)>>2|(13107&Iu)<<2))>>4|(3855&Iu)<<4))>>8|(255&Iu)<<8)>>1}var Df=function(n,e,s){for(var l=n.length,h=0,p=new Rf(e);h<l;++h)n[h]&&++p[n[h]-1];var g,x=new Rf(e);for(h=1;h<e;++h)x[h]=x[h-1]+p[h-1]<<1;g=new Rf(1<<e);var w=15-e;for(h=0;h<l;++h)if(n[h])for(var T=h<<4|n[h],I=e-n[h],M=x[n[h]-1]++<<I,R=M|(1<<I)-1;M<=R;++M)g[Zb[M]>>w]=T;return g},Of=new qn(288);for(ms=0;ms<144;++ms)Of[ms]=8;for(ms=144;ms<256;++ms)Of[ms]=9;for(ms=256;ms<280;++ms)Of[ms]=7;for(ms=280;ms<288;++ms)Of[ms]=8;var $b=new qn(32);for(ms=0;ms<32;++ms)$b[ms]=5;var n2=Df(Of,9),a2=Df($b,5),ay=function(n){for(var e=n[0],s=1;s<n.length;++s)n[s]>e&&(e=n[s]);return e},Pa=function(n,e,s){var l=e/8|0;return(n[l]|n[l+1]<<8)>>(7&e)&s},oy=function(n,e){var s=e/8|0;return(n[s]|n[s+1]<<8|n[s+2]<<16)>>(7&e)},o2=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],La=function(n,e,s){var l=new Error(e||o2[n]);if(l.code=n,Error.captureStackTrace&&Error.captureStackTrace(l,La),!s)throw l;return l},l2=new qn(0),c2=typeof TextDecoder<"u"&&new TextDecoder;try{c2.decode(l2,{stream:!0})}catch{}const h2={gzip_data:"gzip"};class la extends Error{constructor(e){super(e),this.name="MRTError"}}const u2={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},Jb={uint32:1,uint16:2,uint8:4},d2={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let ly;class Zg{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const s=this.layers[e];if(!s)throw new la(`Layer '${e}' not found`);return s}getHeaderLength(e){const s=new Uint8Array(e),l=new DataView(e);if(s[0]!==13)throw new la("File is not a valid MRT.");return l.getUint32(1,!0)}parseHeader(e){const s=new Uint8Array(e),l=this.getHeaderLength(e);if(s.length<l)throw new la(`Expected header with length >= ${l} but got buffer of length ${s.length}`);const h=new ly(s.subarray(0,l)).readFields(WT,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==h.x||this.y!==h.y||this.z!==h.z))throw new la(`Invalid attempt to parse header ${h.z}/${h.x}/${h.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=h.x,this.y=h.y,this.z=h.z;for(const p of h.layers)this.layers[p.name]=new Kb(p,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const s=[],l=this.getLayer(e.layerName);for(let h of e.blockIndices){const p=l.dataIndex[h],g=p.firstByte-e.firstByte,x=p.lastByte-e.firstByte;if(l._blocksInProgress.has(h))continue;const w={layerName:l.name,firstByte:g,lastByte:x,pixelFormat:l.pixelFormat,blockIndex:h,blockShape:[p.bands.length].concat(l.bandShape),buffer:l.buffer,codec:p.codec.codec,filters:p.filters.map(T=>T.filter)};l._blocksInProgress.add(h),s.push(w)}return new Qb(s,()=>{s.forEach(h=>l._blocksInProgress.delete(h.blockIndex))},(h,p)=>{if(s.forEach(g=>l._blocksInProgress.delete(g.blockIndex)),h)throw h;p.forEach(g=>{this.getLayer(g.layerName).processDecodedData(g)})})}}class Kb{constructor({version:e,name:s,units:l,tileSize:h,pixelFormat:p,buffer:g,dataIndex:x},w){if(this.version=e,this.version!==1)throw new la(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=s,this.units=l,this.tileSize=h,this.buffer=g,this.pixelFormat=u2[p],this.dataIndex=x,this.bandShape=[h+2*g,h+2*g,Jb[this.pixelFormat]],this._decodedBlocks=new Yg(w?w.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return Jb[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:e})=>e).flat()}processDecodedData(e){const s=e.blockIndex.toString();this._decodedBlocks.get(s)||this._decodedBlocks.put(s,e.data)}getBlockForBand(e){let s=0;switch(typeof e){case"string":for(const[l,h]of this.dataIndex.entries()){for(const[p,g]of h.bands.entries())if(g===e)return{bandIndex:s+p,blockIndex:l,blockBandIndex:p};s+=h.bands.length}break;case"number":for(const[l,h]of this.dataIndex.entries()){if(e>=s&&e<s+h.bands.length)return{bandIndex:e,blockIndex:l,blockBandIndex:e-s};s+=h.bands.length}break;default:throw new la(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(e){let s=1/0,l=-1/0;const h=[],p=new Set;for(const g of e){const{blockIndex:x}=this.getBlockForBand(g);if(x<0)throw new la(`Invalid band: ${JSON.stringify(g)}`);const w=this.dataIndex[x];h.includes(x)||h.push(x),p.add(x),s=Math.min(s,w.firstByte),l=Math.max(l,w.lastByte)}if(p.size>this.cacheSize)throw new la(`Number of blocks to decode (${p.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:s,lastByte:l,blockIndices:h}}hasBand(e){const{blockIndex:s}=this.getBlockForBand(e);return s>=0}hasDataForBand(e){const{blockIndex:s}=this.getBlockForBand(e);return s>=0&&!!this._decodedBlocks.get(s.toString())}getBandView(e){const{blockIndex:s,blockBandIndex:l}=this.getBlockForBand(e);if(s<0)throw new la(`Band not found: ${JSON.stringify(e)}`);const h=this._decodedBlocks.get(s.toString());if(!h)throw new la(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const p=this.dataIndex[s],g=this.bandShape.reduce((T,I)=>T*I,1),x=l*g,w=h.subarray(x,x+g);return{data:w,bytes:new Uint8Array(w.buffer).subarray(w.byteOffset,w.byteOffset+w.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:p.offset,scale:p.scale}}}Zg.setPbf=function(n){ly=n};class Qb{constructor(e,s,l){this.tasks=e,this._onCancel=s,this._onComplete=l,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,s){this._finalized||(this._onComplete(e,s),this._finalized=!0)}}Zg.performDecoding=function(n,e){const s=new Uint8Array(n);return Promise.all(e.tasks.map(l=>{const{layerName:h,firstByte:p,lastByte:g,pixelFormat:x,blockShape:w,blockIndex:T,filters:I,codec:M}=l,R=s.subarray(p,g+1),B=new Uint32Array(w[0]*w[1]*w[2]);let V;if(M!=="gzip_data")throw new la(`Unhandled codec: ${M}`);return V=function(q,Z){if(!globalThis.DecompressionStream&&Z==="gzip_data")return Promise.resolve(((le=function(ke){ke[0]==31&&ke[1]==139&&ke[2]==8||La(6,"invalid gzip data");var Le=ke[3],ze=10;4&Le&&(ze+=2+(ke[10]|ke[11]<<8));for(var rt=(Le>>3&1)+(Le>>4&1);rt>0;rt-=!ke[ze++]);return ze+(2&Le)}(ae=q))+8>ae.length&&La(6,"invalid gzip data"),function(ke,Le,ze,rt){var Be=ke.length;if(!Be||Le.f&&!Le.l)return ze||new qn(0);var st=!ze,ut=st||Le.i!=2,nt=Le.i;st&&(ze=new qn(3*Be));var ot,gt,tt=function(vr){var br=ze.length;if(vr>br){var pr=new qn(Math.max(2*br,vr));pr.set(ze),ze=pr}},ct=Le.f||0,Xe=Le.p||0,He=Le.b||0,_t=Le.l,dt=Le.d,Yt=Le.m,zt=Le.n,Bt=8*Be;do{if(!_t){ct=Pa(ke,Xe,1);var St=Pa(ke,Xe+1,3);if(Xe+=3,!St){var Gt=ke[(de=4+((Xe+7)/8|0))-4]|ke[de-3]<<8,li=de+Gt;if(li>Be){nt&&La(0);break}ut&&tt(He+Gt),ze.set(ke.subarray(de,li),He),Le.b=He+=Gt,Le.p=Xe=8*li,Le.f=ct;continue}if(St==1)_t=n2,dt=a2,Yt=9,zt=5;else if(St==2){var kt=Pa(ke,Xe,31)+257,jt=Pa(ke,Xe+10,15)+4,ti=kt+Pa(ke,Xe+5,31)+1;Xe+=14;for(var di=new qn(ti),Ii=new qn(19),_i=0;_i<jt;++_i)Ii[i2[_i]]=Pa(ke,Xe+3*_i,7);Xe+=3*jt;var Ft=ay(Ii),fi=(1<<Ft)-1,Vi=Df(Ii,Ft);for(_i=0;_i<ti;){var de,fe=Vi[Pa(ke,Xe,fi)];if(Xe+=15&fe,(de=fe>>4)<16)di[_i++]=de;else{var Ge=0,it=0;for(de==16?(it=3+Pa(ke,Xe,3),Xe+=2,Ge=di[_i-1]):de==17?(it=3+Pa(ke,Xe,7),Xe+=3):de==18&&(it=11+Pa(ke,Xe,127),Xe+=7);it--;)di[_i++]=Ge}}var It=di.subarray(0,kt),Ct=di.subarray(kt);Yt=ay(It),zt=ay(Ct),_t=Df(It,Yt),dt=Df(Ct,zt)}else La(1);if(Xe>Bt){nt&&La(0);break}}ut&&tt(He+131072);for(var Ot=(1<<Yt)-1,$t=(1<<zt)-1,ki=Xe;;ki=Xe){var Mi=(Ge=_t[oy(ke,Xe)&Ot])>>4;if((Xe+=15&Ge)>Bt){nt&&La(0);break}if(Ge||La(2),Mi<256)ze[He++]=Mi;else{if(Mi==256){ki=Xe,_t=null;break}var Ei=Mi-254;Mi>264&&(Ei=Pa(ke,Xe,(1<<(Ai=Wb[_i=Mi-257]))-1)+qb[_i],Xe+=Ai);var sr=dt[oy(ke,Xe)&$t],kr=sr>>4;if(sr||La(3),Xe+=15&sr,Ct=s2[kr],kr>3){var Ai=Gb[kr];Ct+=oy(ke,Xe)&(1<<Ai)-1,Xe+=Ai}if(Xe>Bt){nt&&La(0);break}ut&&tt(He+131072);var yr=He+Ei;if(He<Ct){var or=0-Ct,qi=Math.min(Ct,yr);for(or+He<0&&La(3);He<qi;++He)ze[He]=(void 0)[or+He]}for(;He<yr;++He)ze[He]=ze[He-Ct]}}Le.l=_t,Le.p=ki,Le.b=He,Le.f=ct,_t&&(ct=1,Le.m=Yt,Le.d=dt,Le.n=zt)}while(!ct);return He!=ze.length&&st?(ot=ze,((gt=He)==null||gt>ot.length)&&(gt=ot.length),new qn(ot.subarray(0,gt))):ze.subarray(0,He)}(ae.subarray(le,-8),{i:2},new qn((($=ae)[(ne=$.length)-4]|$[ne-3]<<8|$[ne-2]<<16|$[ne-1]<<24)>>>0))));var $,ne,ae,le;const be=h2[Z];if(!be)throw new Error(`Unhandled codec: ${Z}`);const we=new globalThis.DecompressionStream(be);return new Response(new Blob([q]).stream().pipeThrough(we)).arrayBuffer().then(ke=>new Uint8Array(ke))}(R,M).then(q=>(function(Z,$){Z.readFields($T,$)}(new ly(q),B),new d2[x](B.buffer))),V.then(q=>{for(let Z=I.length-1;Z>=0;Z--)switch(I[Z]){case"delta_filter":KT(q,w);break;case"zigzag_filter":QT(q);break;case"bitshuffle_filter":e2(q,x);break;default:throw new la(`Unhandled filter "${I[Z]}"`)}return{layerName:h,blockIndex:T,data:q}}).catch(q=>{throw q})}))},Dt(Qb,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),Dt(Zg,"MapboxRasterTile"),Dt(Kb,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class ew{constructor(e){this._stringToNumber={},this._numberToString=[];for(let s=0;s<e.length;s++){const l=e[s];this._stringToNumber[l]=s,this._numberToString[s]=l}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const f2=["id","tile","layer","source","sourceLayer","state"];class ku{constructor(e,s,l,h,p){this.type="Feature",this._vectorTileFeature=e,this._z=s,this._x=l,this._y=h,this.properties=e.properties,this.id=p}clone(){const e=new ku(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const s of f2)this[s]!==void 0&&(e[s]=this[s]);return e}}class tw{constructor(e,s){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Mo(At,16,0),this.featureIndexArray=new Zp,this.promoteId=s,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,s,l,h,p,g=0,x=0){const w=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,h,p,g);const T=this.grid;for(let I=0;I<s.length;I++){const M=s[I],R=[1/0,1/0,-1/0,-1/0];for(let B=0;B<M.length;B++){const V=M[B];R[0]=Math.min(R[0],V.x),R[1]=Math.min(R[1],V.y),R[2]=Math.max(R[2],V.x),R[3]=Math.max(R[3],V.y)}x!==0&&(R[0]-=x,R[1]-=x,R[2]+=x,R[3]+=x),R[0]<At&&R[1]<At&&R[2]>=0&&R[3]>=0&&T.insert(w,R[0],R[1],R[2],R[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new oi(new wg(this.rawTileData)).layers,this.sourceLayerCoder=new ew(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,s){const{tilespaceGeometry:l,transform:h,tileTransform:p,pixelPosMatrix:g,availableImages:x,worldview:w}=s;this.loadVTLayers(),this.serializedLayersCache.clear();const T=l.bufferedTilespaceBounds,I=this.grid.query(T.min.x,T.min.y,T.max.x,T.max.y,(V,q,Z,$)=>Qr(l.bufferedTilespaceGeometry,V,q,Z,$));I.sort(p2);let M=null;h.elevation&&I.length>0&&(M=Tu.create(h.elevation,this.tileID));const R={};let B;for(let V=0;V<I.length;V++){const q=I[V];if(q===B)continue;B=q;const Z=this.featureIndexArray.get(q);let $=null;this.is3DTile?this.loadMatchingModelFeature(R,Z,e,l,h,w):this.loadMatchingFeature(R,Z,e,x,w,(ne,ae,le,be=0)=>($||($=Pt(ne,this.tileID.canonical,p)),ae.queryIntersectsFeature(l,ne,le,$,this.z,h,g,M,be)))}return R}loadMatchingFeature(e,s,l,h,p,g){const{featureIndex:x,bucketIndex:w,sourceLayerIndex:T,layoutVertexArrayOffset:I}=s,M=this.bucketLayerIDs[w],R=l.layers,B=Object.keys(R);if(B.length&&!Bi(B,M))return;const V=l.sourceCache,q=this.sourceLayerCoder.decode(T),Z=this.vtLayers[q].feature(x),$=this.getId(Z,q);for(let ne=0;ne<M.length;ne++){const ae=M[ne];if(!R[ae])continue;const{styleLayer:le,targets:be}=R[ae];let we={};$!==void 0&&(we=V.getFeatureState(le.sourceLayer,$));const ke=!g||g(Z,le,we,I);if(!ke)continue;const Le=new ku(Z,this.z,this.x,this.y,$);Le.tile=this.tileID.canonical,Le.state=we;let ze=this.serializedLayersCache.get(ae);ze||(ze=le.serialize(),ze.id=ae,this.serializedLayersCache.set(ae,ze)),Le.source=ze.source,Le.sourceLayer=ze["source-layer"],Le.layer=Object.assign({},ze),Le.layer.paint=iw(ze.paint,le.paint,Z,we,h),Le.layer.layout=iw(ze.layout,le.layout,Z,we,h);let rt=!1;for(const Be of be){this.updateFeatureProperties(Le,Be);const{filter:st}=Be;if(st){if(Z.properties=Le.properties,st.needGeometry){const ut=pt(Z,!0);if(!st.filter(new _r(this.tileID.overscaledZ,{worldview:p}),ut,this.tileID.canonical))continue}else if(!st.filter(new _r(this.tileID.overscaledZ,{worldview:p}),Z))continue}rt=!0,Be.targetId&&this.addFeatureVariant(Le,Be)}rt&&this.appendToResult(e,ae,x,Le,ke)}}loadMatchingModelFeature(e,s,l,h,p,g){const{featureIndex:x,bucketIndex:w}=s,T=this.bucketLayerIDs[w],I=l.layers,M=Object.keys(I);if(!M.length||Bi(M,T))for(let R=0;R<T.length;R++){const B=T[R],{styleLayer:V,targets:q}=I[B];if(V.type!=="model")continue;const Z=h.tile,$=Z.getBucket(V);if(!($&&$ instanceof jg))continue;const ne=xT($,x,h,p);if(!ne)continue;const{z:ae,x:le,y:be}=Z.tileID.canonical,{feature:we,intersectionZ:ke,position:Le}=ne;let ze={};we.id!==void 0&&(ze=l.sourceCache.getFeatureState(V.sourceLayer,we.id));const rt=new ku({},ae,le,be,we.id);rt.tile=this.tileID.canonical,rt.state=ze,rt.properties=we.properties,rt.geometry={type:"Point",coordinates:[Le.lng,Le.lat]};let Be=this.serializedLayersCache.get(B);Be||(Be=V.serialize(),Be.id=B,this.serializedLayersCache.set(B,Be)),rt.source=Be.source,rt.sourceLayer=Be["source-layer"],rt.layer=Object.assign({},Be);let st=!1;for(const ut of q){this.updateFeatureProperties(rt,ut);const{filter:nt}=ut;if(nt){if(we.properties=rt.properties,nt.needGeometry){if(!nt.filter(new _r(this.tileID.overscaledZ,{worldview:g}),we,this.tileID.canonical))continue}else if(!nt.filter(new _r(this.tileID.overscaledZ,{worldview:g}),we))continue}st=!0,ut.targetId&&this.addFeatureVariant(rt,ut)}st&&this.appendToResult(e,B,x,rt,ke)}}updateFeatureProperties(e,s,l){if(s.properties){const h={};for(const p in s.properties){const g=s.properties[p].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,l);g!=null&&(h[p]=g)}e.properties=h}}addFeatureVariant(e,s,l){const h={target:s.target,namespace:s.namespace,uniqueFeatureID:s.uniqueFeatureID};s.properties&&(h.properties=e.properties),e.variants=e.variants||{},e.variants[s.targetId]=e.variants[s.targetId]||[],e.variants[s.targetId].push(h)}appendToResult(e,s,l,h,p){let g=e[s];g===void 0&&(g=e[s]=[]),g.push({featureIndex:l,feature:h,intersectionZ:p})}lookupSymbolFeatures(e,s,l,h,p,g){const x={};this.loadVTLayers();for(const w of e)this.loadMatchingFeature(x,{bucketIndex:s,sourceLayerIndex:l,featureIndex:w,layoutVertexArrayOffset:0},h,p,g);return x}loadFeature(e){const{featureIndex:s,sourceLayerIndex:l}=e;this.loadVTLayers();const h=this.sourceLayerCoder.decode(l),p=this.vtFeatures[h];if(p[s])return p[s];const g=this.vtLayers[h].feature(s);return p[s]=g,g}hasLayer(e){for(const s of this.bucketLayerIDs)for(const l of s)if(e===l)return!0;return!1}getId(e,s){let l=e.id;if(this.promoteId){const h=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[s];if(h!=null)if(Array.isArray(h)){if(!this.promoteIdExpression){const p=ta(h);if(p.result!=="success"){const g=p.value.map(x=>`${x.key}: ${x.message}`).join(", ");return void Di(`Failed to create expression for promoteId: ${g}`)}this.promoteIdExpression=p.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new ba),l=this.promoteIdExpression.evaluate({zoom:0},e)}else l=e.properties[h];typeof l=="boolean"&&(l=Number(l))}return l}}function iw(n,e,s,l,h){return ci(n,(p,g)=>{const x=e instanceof Do?e.get(g):null;return x&&x.evaluate?x.evaluate(s,l,void 0,h):x})}function p2(n,e){return e-n}Dt(tw,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const rw=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class cy{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[s,l]=new Uint8Array(e,0,2);if(s!==219)throw new Error("Data does not appear to be in a KDBush format.");const h=l>>4;if(h!==1)throw new Error(`Got v${h} data when expected v1.`);const p=rw[15&l];if(!p)throw new Error("Unrecognized array type.");const[g]=new Uint16Array(e,2,1),[x]=new Uint32Array(e,4,1);return new cy(x,g,p,e)}constructor(e,s=64,l=Float64Array,h){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+s,2),65535),this.ArrayType=l,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const p=rw.indexOf(this.ArrayType),g=2*e*this.ArrayType.BYTES_PER_ELEMENT,x=e*this.IndexArrayType.BYTES_PER_ELEMENT,w=(8-x%8)%8;if(p<0)throw new Error(`Unexpected typed array class: ${l}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+x+w,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+g+x+w),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+x+w,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+p]),new Uint16Array(this.data,2,1)[0]=s,new Uint32Array(this.data,4,1)[0]=e)}add(e,s){const l=this._pos>>1;return this.ids[l]=l,this.coords[this._pos++]=e,this.coords[this._pos++]=s,l}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return hy(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,s,l,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:g,nodeSize:x}=this,w=[0,p.length-1,0],T=[];for(;w.length;){const I=w.pop()||0,M=w.pop()||0,R=w.pop()||0;if(M-R<=x){for(let Z=R;Z<=M;Z++){const $=g[2*Z],ne=g[2*Z+1];$>=e&&$<=l&&ne>=s&&ne<=h&&T.push(p[Z])}continue}const B=R+M>>1,V=g[2*B],q=g[2*B+1];V>=e&&V<=l&&q>=s&&q<=h&&T.push(p[B]),(I===0?e<=V:s<=q)&&(w.push(R),w.push(B-1),w.push(1-I)),(I===0?l>=V:h>=q)&&(w.push(B+1),w.push(M),w.push(1-I))}return T}within(e,s,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:p,nodeSize:g}=this,x=[0,h.length-1,0],w=[],T=l*l;for(;x.length;){const I=x.pop()||0,M=x.pop()||0,R=x.pop()||0;if(M-R<=g){for(let Z=R;Z<=M;Z++)nw(p[2*Z],p[2*Z+1],e,s)<=T&&w.push(h[Z]);continue}const B=R+M>>1,V=p[2*B],q=p[2*B+1];nw(V,q,e,s)<=T&&w.push(h[B]),(I===0?e-l<=V:s-l<=q)&&(x.push(R),x.push(B-1),x.push(1-I)),(I===0?e+l>=V:s+l>=q)&&(x.push(B+1),x.push(M),x.push(1-I))}return w}}function hy(n,e,s,l,h,p){if(h-l<=s)return;const g=l+h>>1;sw(n,e,g,l,h,p),hy(n,e,s,l,g-1,1-p),hy(n,e,s,g+1,h,1-p)}function sw(n,e,s,l,h,p){for(;h>l;){if(h-l>600){const T=h-l+1,I=s-l+1,M=Math.log(T),R=.5*Math.exp(2*M/3),B=.5*Math.sqrt(M*R*(T-R)/T)*(I-T/2<0?-1:1);sw(n,e,s,Math.max(l,Math.floor(s-I*R/T+B)),Math.min(h,Math.floor(s+(T-I)*R/T+B)),p)}const g=e[2*s+p];let x=l,w=h;for(Ff(n,e,l,s),e[2*h+p]>g&&Ff(n,e,l,h);x<w;){for(Ff(n,e,x,w),x++,w--;e[2*x+p]<g;)x++;for(;e[2*w+p]>g;)w--}e[2*l+p]===g?Ff(n,e,l,w):(w++,Ff(n,e,w,h)),w<=s&&(l=w+1),s<=w&&(h=w-1)}}function Ff(n,e,s,l){uy(n,s,l),uy(e,2*s,2*l),uy(e,2*s+1,2*l+1)}function uy(n,e,s){const l=n[e];n[e]=n[s],n[s]=l}function nw(n,e,s,l){const h=n-s,p=e-l;return h*h+p*p}r.$=rd,r.A=Un,r.B=vl,r.C=2,r.D=gu,r.E=xo,r.F=Af,r.G=M0,r.H=id,r.I=yn,r.J=$h,r.K=ai,r.L=dc,r.M=Nh,r.N=Bh,r.O=kd,r.P=mt,r.Q=Pd,r.R=rh,r.S=Oo,r.T=A_,r.U=ta,r.V=Ug,r.W=Ld,r.X=dl,r.Y=ul,r.Z=Eh,r._=Gs,r.a=function(n){return Fs.API_CDN_URL_REGEX.test(n)},r.a$=_e,r.a0=uc,r.a1=Ku,r.a2=Jh,r.a3=class extends Ug{},r.a4=Vh,r.a5=Id,r.a6=Fe,r.a7=function(n){const e=n.value;return e?uc(e)?K_(e,!0)?[]:[new Ug(n.key,e,`invalid url "${e}"`)]:[new Ug(n.key,e,`string expected, "${ai(e)}" found`)]:[]},r.a8=zp,r.a9=Nr,r.aA=Ee,r.aB=ee,r.aC=an,r.aD=u,r.aE=vs,r.aF=he,r.aG=Ve,r.aH=function(n,e){const s={};for(let l=0;l<e.length;l++){const h=e[l];h in n&&(s[h]=n[h])}return s},r.aI=te,r.aJ=ye,r.aK=class{constructor(n){this.entries={},this.scheduler=n}request(n,e,s,l){const h=this.entries[n]=this.entries[n]||{callbacks:[]};if(h.result){const[p,g]=h.result;return this.scheduler?this.scheduler.add(()=>{l(p,g)},e):l(p,g),()=>{}}return h.callbacks.push(l),h.cancel||(h.cancel=s((p,g)=>{h.result=[p,g];for(const x of h.callbacks)this.scheduler?this.scheduler.add(()=>{x(p,g)},e):x(p,g);setTimeout(()=>delete this.entries[n],3e3)})),()=>{h.result||(h.callbacks=h.callbacks.filter(p=>p!==l),h.callbacks.length||(h.cancel(),delete this.entries[n]))}}},r.aL=function(n,e,s){const l=JSON.stringify(n.request);return n.data&&(this.deduped.entries[l]={result:[null,n.data]}),this.deduped.request(l,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom},h=>{const p=Qo(n.request,(g,x,w,T)=>{g?h(g):x&&h(null,{vectorTile:s?void 0:new oi(new wg(x)),rawData:x,cacheControl:w,expires:T})});return()=>{p.cancel(),h()}},e)},r.aM=function(n){Ua++,Ua>va&&(n.getActor().send("enforceCacheSizeLimit",Fn),Ua=0)},r.aN=function(n){return n<=1?1:Math.pow(2,Math.floor(Math.log2(n)))},r.aO=qs,r.aP=nb,r.aQ=ub,r.aR=Y,r.aS=sb,r.aT=function(n,e){const s=document.createElement("video");s.muted=!0,s.onloadstart=function(){e(null,s)};for(let l=0;l<n.length;l++){const h=document.createElement("source");rp(n[l])||(s.crossOrigin="Anonymous"),h.src=n[l],s.appendChild(h)}return{cancel:()=>{}}},r.aU=yf,r.aV=function(n){return fetch(n).then(e=>e.arrayBuffer()).then(e=>Ov(e,0,n))},r.aW=Wv,r.aX=class{constructor(n,e,s,l){this.id=n,this.position=e!=null?new Y(e[0],e[1]):new Y(0,0),this.orientation=s!=null?s:[0,0,0],this.nodes=l,this.uploaded=!1,this.aabb=new ri([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(n,e){if(ee(n.matrix,e,n.matrix),n.meshes)for(const s of n.meshes){const l=ri.applyTransformFast(s.aabb,n.matrix);this.aabb.encapsulate(l)}if(n.children)for(const s of n.children)this._applyTransformations(s,n.matrix)}computeBoundsAndApplyParent(){const n=H([]);for(const e of this.nodes)this._applyTransformations(e,n)}computeModelMatrix(n,e,s,l,h,p,g=!1){jv(this.matrix,this,n.transform,this.position,e,s,l,h,p,g)}upload(n){if(!this.uploaded){for(const e of this.nodes)C_(e,n);for(const e of this.nodes)bg(e);this.uploaded=!0}}destroy(){for(const n of this.nodes)I_(n)}},r.aY=ni,r.aZ=Ef,r.a_=xe,r.aa=yt,r.ab=class{constructor(n){this.specification=n}possiblyEvaluate(n,e){return ls(n.expression.evaluate(e))}interpolate(n,e,s){return{x:ei(n.x,e.x,s),y:ei(n.y,e.y,s),z:ei(n.z,e.z,s),azimuthal:ei(n.azimuthal,e.azimuthal,s),polar:ei(n.polar,e.polar,s)}}},r.ac=_r,r.ad=Ja,r.ae=$e,r.af=Wi,r.ag=bt,r.ah=Ye,r.ai=Do,r.aj=kl,r.ak=ei,r.al=At,r.am=ed,r.an=Oe,r.ao=er,r.ap=class{constructor(n){this.specification=n}possiblyEvaluate(n,e){return function([s,l]){const h=ls([1,s,l]);return{x:h.x,y:h.y,z:h.z}}(n.expression.evaluate(e))}interpolate(n,e,s){return{x:ei(n.x,e.x,s),y:ei(n.y,e.y,s),z:ei(n.z,e.z,s)}}},r.aq=function(n,e,s=0,l=!0){const h=new mt(s,s),p=n.sub(h),g=e.add(h),x=[p,new mt(g.x,p.y),g,new mt(p.x,g.y)];return l&&x.push(p.clone()),x},r.ar=function(n,e){const s=[];for(let l=0;l<n.length;l++){const h=De(l-1,-1,n.length-1),p=De(l+1,-1,n.length-1),g=n[l],x=n[p],w=n[h].sub(g).unit(),T=x.sub(g).unit(),I=T.angleWithSep(w.x,w.y),M=w.add(T).unit().mult(-1*e/Math.sin(I/2));s.push(g.add(M))}return s},r.as=W0,r.at=Qr,r.au=function(n,e,s=0){return Tt(((e.x-s)*n.scale-n.x)*At,(e.y*n.scale-n.y)*At,ge(e.z,e.y))},r.av=jr,r.aw=mi,r.ax=Yi,r.ay=i0,r.az=function(n){let e=1/0,s=1/0,l=-1/0,h=-1/0;for(const p of n)e=Math.min(e,p.x),s=Math.min(s,p.y),l=Math.max(l,p.x),h=Math.max(h,p.y);return{min:new mt(e,s),max:new mt(l,h)}},r.b=function(n){return Fs.API_FONTS_REGEX.test(n)},r.b$=d_,r.b0=Bo,r.b1=gs,r.b2=lt,r.b3=Jd,r.b4=Fg,r.b5=function(){ia.isLoading()||ia.isLoaded()||Zh()!=="deferred"||Po()},r.b6=Sc,r.b7=pt,r.b8=ku,r.b9=Ki,r.bA=H,r.bB=Te,r.bC=G,r.bD=function(n,e){const{x:s,y:l}=n.point,h=Ax(s,l,n.worldSize/n._pixelsPerMercatorPixel,0,0);return ee(h,h,Qm(lo(e)))},r.bE=P,r.bF=ws,r.bG=function(n,e){var s=e[0]-n[0],l=e[1]-n[1],h=e[2]-n[2];return Math.sqrt(s*s+l*l+h*h)},r.bH=Hi,r.bI=zi,r.bJ=Ci,r.bK=Sf,r.bL=En,r.bM=N_,r.bN=function(n,e,s,l,h){const p=5*e+2;n.float32[p+0]=s,n.float32[p+1]=l,n.float32[p+2]=h},r.bO=Og,r.bP=Dn,r.bQ=_a,r.bR=Ba,r.bS=On,r.bT=De,r.bU=function(n,e,s,l){var h=new k(4);return h[0]=n,h[1]=e,h[2]=s,h[3]=l,h},r.bV=pg,r.bW=Sn,r.bX=Es,r.bY=tv,r.bZ=db,r.b_=nv,r.ba=L_,r.bb=c_,r.bc=Pt,r.bd=io,r.be=au,r.bf=yx,r.bg=zr,r.bh=fu,r.bi=$_,r.bj=function(n,e){const s=kl(e.zoom);if(s===0)return lo(n);const l=rg(n),h=Km(l),p=he(l.getWest())*e.worldSize,g=he(l.getEast())*e.worldSize,x=ye(l.getNorth())*e.worldSize,w=ye(l.getSouth())*e.worldSize,T=[p,x,0],I=[g,x,0],M=[p,w,0],R=[g,w,0],B=Q([],e.globeMatrix);return Wi(T,T,B),Wi(I,I,B),Wi(M,M,B),Wi(R,R,B),h[0]=jo(h[0],M,s),h[1]=jo(h[1],R,s),h[2]=jo(h[2],I,s),h[3]=jo(h[3],T,s),ri.fromPoints(h)},r.bk=ng,r.bl=Q,r.bm=tf,r.bn=jo,r.bo=Fo,r.bp=U1,r.bq=Se,r.br=ie,r.bs=Zg,r.bt=wg,r.bu=Qo,r.bv=function(n,e){const s=[];for(const l in n)l in e||s.push(l);return s},r.bw=Ze,r.bx=["type","source","source-layer","minzoom","maxzoom","filter","layout"],r.by=ya,r.bz=function(n){var e=new k(16);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e},r.c=ip,r.c$=function(n){return n*n*n*n*n},r.c0=B_,r.c1=F0,r.c2=H_,r.c3=cy,r.c4=Kt,r.c5=Oa,r.c6=ga,r.c7=function(n,e,s){s*=.5;var l=e[0],h=e[1],p=e[2],g=e[3],x=Math.sin(s),w=Math.cos(s);return n[0]=l*w+h*x,n[1]=h*w-l*x,n[2]=p*w+g*x,n[3]=g*w-p*x,n},r.c8=fo,r.c9=Wr,r.cA=Si,r.cB=Bv,r.cC=Ia,r.cD=bx,r.cE=function(n,e,s,l,h,p,g,x,w){if(w.name==="globe")return bx(n,e,new Ia(s,l,h),!1);const T=Ef({z:s,x:l,y:h},w);return new ri([(p+T.x/T.scale)*e,e*(T.y/T.scale),g],[(p+T.x2/T.scale)*e,e*(T.y2/T.scale),x])},r.cF=function(n,e,s){return n[0]=Math.min(e[0],s[0]),n[1]=Math.min(e[1],s[1]),n[2]=Math.min(e[2],s[2]),n[3]=Math.min(e[3],s[3]),n},r.cG=function(n,e,s){return n[0]=Math.max(e[0],s[0]),n[1]=Math.max(e[1],s[1]),n[2]=Math.max(e[2],s[2]),n[3]=Math.max(e[3],s[3]),n},r.cH=function(n){const e=Math.round((n+45+360)%360/90)%4;return se[e]},r.cI=Ae,r.cJ=$s,r.cK=y,r.cL=function(n){const e=H(new Float64Array(16));ee(e,n.pixelMatrix,n.globeMatrix);const s=[0,z,0],l=[0,D,0];return Wi(s,s,e),Wi(l,l,e),[s[0]>0&&s[0]<=n.width&&s[1]>0&&s[1]<=n.height&&!t_(n,new Y(n.center.lat,90)),l[0]>0&&l[0]<=n.width&&l[1]>0&&l[1]<=n.height&&!t_(n,new Y(n.center.lat,-90))]},r.cM=function(n,e){const{scale:s}=n.tileTransform,l=s*At/(n.tileSize*Math.pow(2,e.zoom-n.tileID.overscaledZ+n.tileID.canonical.z));return function(h,p,g){var x=p[1],w=p[2],T=p[3],I=g[0],M=g[1];return h[0]=p[0]*I,h[1]=x*I,h[2]=w*M,h[3]=T*M,h}(new Float32Array(4),e.inverseAdjustmentMatrix,[l,l])},r.cN=xg,r.cO=Ke,r.cP=Fv,r.cQ=function(n){const e=Fv(n,!0);return P([],[e[0],e[1],e[4],e[5]])},r.cR=ue,r.cS=Ji,r.cT=ve,r.cU=function(n){const{x:e,y:s}=n.point,{lng:l,lat:h}=n._center;return Ax(e,s,n.worldSize,l,h)},r.cV=ui,r.cW=K,r.cX=du,r.cY=zs,r.cZ=m,r.c_=function(n,e,s){let l=0;for(let h=0;h<2;++h)n[h]>0&&(l+=(n[h]-0)*(n[h]-0)),e[h]<0&&(l+=(0-e[h])*(0-e[h]));return l},r.ca=function(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n[3]=e[3],n},r.cb=Ue,r.cc=function(n,e,s,l,h){var p=1/Math.tan(e/2);if(n[0]=p/s,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=p,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,h!=null&&h!==1/0){var g=1/(l-h);n[10]=(h+l)*g,n[14]=2*h*l*g}else n[10]=-1,n[14]=-2*l;return n},r.cd=function(n,e,s,l,h,p,g){var x=1/(e-s),w=1/(l-h),T=1/(p-g);return n[0]=-2*x,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*w,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*T,n[11]=0,n[12]=(e+s)*x,n[13]=(h+l)*w,n[14]=(g+p)*T,n[15]=1,n},r.ce=me,r.cf=function(n,e,s){n[4*e+0]=s[0],n[4*e+1]=s[1],n[4*e+2]=s[2],n[4*e+3]=s[3]},r.cg=Pc,r.ch=Lc,r.ci=Kr,r.cj=sa,r.ck=Rc,r.cl=Z0,r.cm=function(){var n=new k(4);return k!=Float32Array&&(n[1]=0,n[2]=0),n[0]=1,n[3]=1,n},r.cn=function(n,e,s){var l=e[0],h=e[1],p=e[2],g=e[3],x=Math.sin(s),w=Math.cos(s);return n[0]=l*w+p*x,n[1]=h*w+g*x,n[2]=l*-x+p*w,n[3]=h*-x+g*w,n},r.co=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]&&n[3]===e[3]},r.cp=_s,r.cq=function(n){var e=n[0],s=n[1],l=n[2],h=n[3];return Math.sqrt(e*e+s*s+l*l+h*h)},r.cr=ma,r.cs=nn,r.ct=uu,r.cu=3,r.cv=2,r.cw=7,r.cx=6,r.cy=mr,r.cz=qe,r.d=function(n){return Fs.API_TILEJSON_REGEX.test(n)},r.d$=a0,r.d0=oe,r.d1=45,r.d2=zc,r.d3=function(n,e,s){const l=Math.sqrt(n*n+e*e+s*s),h=l>0?Math.acos(s/l)*qo:0;let p=n!==0||e!==0?Math.atan2(-e,-n)*qo+90:0;return p<0&&(p+=360),[l,p,h]},r.d4=Tt,r.d5=ls,r.d6=Ne,r.d7=Lt,r.d8=ri,r.d9=qt,r.dA=function(n,e,s){const l=kl(s.zoom),h=n.style.map._antialias,p=n.terrain&&n.terrain.exaggeration()>0;return l===0&&!h&&!p},r.dB=function(n){const e=n.pixelsPerMeter,s=e/me(1,n.center.lat),l=H(new Float64Array(16));return ie(l,l,[n.point.x,n.point.y,0]),ue(l,l,[s,s,e]),Float32Array.from(l)},r.dC=rg,r.dD=function(n){const e=Ae-5;n=Ee(n,-80.051129,e)/e*90;const s=Math.pow(Math.abs(Math.sin(Oe(n))),3);return Math.round(s*(C.length-1))},r.dE=function(n,e,s,l){const h=e.getNorth(),p=e.getSouth(),g=e.getWest(),x=e.getEast(),w=1<<n.z,T=x-g,I=h-p,M=T/A,R=-I/C[s],B=[0,M,0,R,0,0,h,g,0];if(n.z>0){const V=180/l;N(B,B,[V/T+1,0,0,0,V/I+1,0,-.5*V/M,.5*V/R,1])}return B[2]=w,B[5]=n.x,B[8]=n.y,B},r.dF=lo,r.dG=function(n,e,s){const l=H(new Float64Array(16)),h=(e/(1<<n)-.5)*Math.PI*2;return ce(l,s.globeMatrix,h),Float32Array.from(l)},r.dH=class{isDataAvailableAtPoint(n){const e=this._source();if(this.isUsingMockSource()||!e||n.y<0||n.y>1)return!1;const s=e.getSource().maxzoom,l=1<<s,h=Math.floor(n.x),p=Math.floor((n.x-h)*l),g=Math.floor(n.y*l),x=this.findDEMTileFor(new qs(s,h,s,p,g));return!(!x||!x.dem)}getAtPointOrZero(n,e=0){return this.getAtPoint(n,e)||0}getAtPoint(n,e,s=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const l=this._source();if(!l||n.y<0||n.y>1)return e;const h=l.getSource().maxzoom,p=1<<h,g=Math.floor(n.x),x=n.x-g,w=new qs(h,g,h,Math.floor(x*p),Math.floor(n.y*p)),T=this.findDEMTileFor(w);if(!T||!T.dem)return e;const I=T.dem,M=1<<T.tileID.canonical.z,R=(x*M-T.tileID.canonical.x)*I.dim,B=(n.y*M-T.tileID.canonical.y)*I.dim,V=Math.floor(R),q=Math.floor(B);return(s?this.exaggeration():1)*ei(ei(I.get(V,q),I.get(V,q+1),B-q),ei(I.get(V+1,q),I.get(V+1,q+1),B-q),R-V)}getAtTileOffset(n,e,s){const l=1<<n.canonical.z;return this.getAtPointOrZero(new $e(n.wrap+(n.canonical.x+e/At)/l,(n.canonical.y+s/At)/l))}getAtTileOffsetFunc(n,e,s,l){return h=>{const p=this.getAtTileOffset(n,h.x,h.y),g=l.upVector(n.canonical,h.x,h.y);return Kt(g,g,p*l.upVectorScale(n.canonical,e,s).metersToTile),g}}getForTilePoints(n,e,s,l){if(this.isUsingMockSource())return!1;const h=Tu.create(this,n,l);return!!h&&(e.forEach(p=>{p[2]=this.exaggeration()*h.getElevationAt(p[0],p[1],s)}),!0)}getMinMaxForTile(n){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(n);if(!e||!e.dem)return null;const s=e.dem.tree,l=e.tileID,h=1<<n.canonical.z-l.canonical.z;let p=n.canonical.x/h-l.canonical.x,g=n.canonical.y/h-l.canonical.y,x=0;for(let w=0;w<n.canonical.z-l.canonical.z&&!s.leaves[x];w++){p*=2,g*=2;const T=2*Math.floor(g)+Math.floor(p);x=s.childOffsets[x]+T,p%=1,g%=1}return{min:this.exaggeration()*s.minimums[x],max:this.exaggeration()*s.maximums[x]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(n,e,s){throw new Error("Pure virtual method called.")}pointCoordinate(n){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(n){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const n=this.visibleDemTiles;if(n.length===0)return null;let e=!1,s=Number.MAX_VALUE,l=Number.MIN_VALUE;for(const h of n){const p=this.getMinMaxForTile(h.tileID);p&&(s=Math.min(s,p.min),l=Math.max(l,p.max),e=!0)}return e?{min:s,max:l}:null}},r.dI=Fx,r.dJ=ig,r.dK=function(n,e){return[Math.pow(n[0],2.2)*e,Math.pow(n[1],2.2)*e,Math.pow(n[2],2.2)*e]},r.dL=L,r.dM=function(n,e){var s=Math.sin(e),l=Math.cos(e);return n[0]=l,n[1]=s,n[2]=0,n[3]=-s,n[4]=l,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},r.dN=ns,r.dO=Sx,r.dP=js,r.dQ=pn,r.dR=256,r.dS=function(n,e){const s=[0,0,0];return Wi(s,s,ng(lo(e.canonical))),Wi(s,s,n),s},r.dT=n=>({u_matrix:new Rc(n),u_texsize:new sa(n),u_pixels_to_tile_units:new hu(n),u_device_pixel_ratio:new Kr(n),u_width_scale:new Kr(n),u_floor_width_scale:new Kr(n),u_image:new Pc(n),u_units_to_pixels:new sa(n),u_tile_units_to_pixels:new Kr(n),u_alpha_discard_threshold:new Kr(n),u_trim_offset:new sa(n),u_trim_fade_range:new sa(n),u_trim_color:new zc(n),u_emissive_strength:new Kr(n),u_zbias_factor:new Kr(n),u_tile_to_meter:new Kr(n),u_ground_shadow_factor:new Lc(n),u_pattern_transition:new Kr(n)}),r.dU=n=>({u_matrix:new Rc(n),u_pixels_to_tile_units:new hu(n),u_device_pixel_ratio:new Kr(n),u_width_scale:new Kr(n),u_floor_width_scale:new Kr(n),u_units_to_pixels:new sa(n),u_dash_image:new Pc(n),u_gradient_image:new Pc(n),u_image_height:new Kr(n),u_texsize:new sa(n),u_tile_units_to_pixels:new Kr(n),u_alpha_discard_threshold:new Kr(n),u_trim_offset:new sa(n),u_trim_fade_range:new sa(n),u_trim_color:new zc(n),u_emissive_strength:new Kr(n),u_zbias_factor:new Kr(n),u_tile_to_meter:new Kr(n),u_ground_shadow_factor:new Lc(n)}),r.dV=n=>({u_camera_to_center_distance:new Kr(n),u_extrude_scale:new hu(n),u_device_pixel_ratio:new Kr(n),u_matrix:new Rc(n),u_inv_rot_matrix:new Rc(n),u_merc_center:new sa(n),u_tile_id:new Lc(n),u_zoom_transition:new Kr(n),u_up_dir:new Lc(n),u_emissive_strength:new Kr(n)}),r.dW=Xd,r.dX=EA,r.dY=class{constructor(n,e,s,l){this.context=n,this.format=l,this.size=s,this.texture=n.gl.createTexture();const[h,p,g]=this.size,{gl:x}=n;x.bindTexture(x.TEXTURE_3D,this.texture),n.pixelStoreUnpackFlipY.set(!1),n.pixelStoreUnpack.set(1),n.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in e&&e.data&&x.texImage3D(x.TEXTURE_3D,0,this.format,h,p,g,0,w_(this.format),S_(this.format),e.data)}bind(n,e){const{context:s}=this,{gl:l}=s;l.bindTexture(l.TEXTURE_3D,this.texture),n!==this.minFilter&&(l.texParameteri(l.TEXTURE_3D,l.TEXTURE_MAG_FILTER,n),l.texParameteri(l.TEXTURE_3D,l.TEXTURE_MIN_FILTER,n),this.minFilter=n),e!==this.wrapS&&(l.texParameteri(l.TEXTURE_3D,l.TEXTURE_WRAP_S,e),l.texParameteri(l.TEXTURE_3D,l.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:n}=this.context;n.deleteTexture(this.texture),this.texture=null}},r.dZ=Cx,r.d_=(n,e,s,l,h,p)=>{const g=n.transform,x=g.projection.name==="globe";let w;if(p.paint.get("circle-pitch-alignment")==="map")if(x){const I=Sx(g.zoom,e.canonical)*g._pixelsPerMercatorPixel;w=Float32Array.from([I,0,0,I])}else w=g.calculatePixelsToTileUnitsMatrix(s);else w=new Float32Array([g.pixelsToGLUnits[0],0,0,g.pixelsToGLUnits[1]]);const T={u_camera_to_center_distance:n.transform.getCameraToCenterDistance(g.projection),u_matrix:n.translatePosMatrix(e.projMatrix,s,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Kn.devicePixelRatio,u_extrude_scale:w,u_inv_rot_matrix:X1,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:p.paint.get("circle-emissive-strength")};if(x){T.u_inv_rot_matrix=l,T.u_merc_center=h,T.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],T.u_zoom_transition=kl(g.zoom);const I=h[0]*At,M=h[1]*At;T.u_up_dir=g.projection.upVector(new Ia(0,0,0),I,M)}return T},r.da=function(n){return[Math.pow(n[0],1/2.2),Math.pow(n[1],1/2.2),Math.pow(n[2],1/2.2)]},r.db=K_,r.dc=function(n,e){return n.readFields(wT,{icons:[]},e)},r.dd=gg,r.de=wu,r.df=U_,r.dg=sh,r.dh=Lp,r.di=th,r.dj=oh,r.dk=Li,r.dl=function(n){const e=n.indexOf(Ac);return e>=0?n.slice(0,e):n},r.dm=function(n){return n.indexOf(Ac)>=0},r.dn=function(n){const e=n.lastIndexOf(Ac);return e>=0?n.slice(e+1):""},r.dp=function(n){const e=[],s=n.id;return s===void 0&&e.push({message:`layers.${s}: missing required property "id"`}),n.render===void 0&&e.push({message:`layers.${s}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&e.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),e},r.dq=function(n,e,s,l){return n.type==="custom"?new mT(n,e):new vT[n.type](n,e,s,l)},r.dr=Ri,r.ds=function(n){const e=n.indexOf(Ac);return e>=0?n.slice(e+1):""},r.dt=class extends ku{constructor(n,e){super(n._vectorTileFeature,n._z,n._x,n._y,n.id),n.state&&(this.state=Object.assign({},n.state)),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=n.source,this.sourceLayer=n.sourceLayer,this.layer=n.layer)}toJSON(){const n=super.toJSON();return n.target=this.target,n.namespace=this.namespace,n}},r.du=Fd,r.dv=Ui,r.dw=function(n){return n({pluginStatus:Xs,pluginURL:eo}),Fd.on("pluginStateChange",n),n},r.dx=Qp,r.dy=class extends ra{constructor(n){super(n),this.current=Zm}set(n,e,s){if(this.fetchUniformLocation(n,e)){for(let l=0;l<9;l++)if(s[l]!==this.current[l]){this.current=s,this.gl.uniformMatrix3fv(this.location,!1,s);break}}}},r.dz=pe,r.e=Fs,r.e$=function(){const n=gf;n&&(n.isPreloaded()&&n.numActive()===1?(n.release(__),gf=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},r.e0=Ks,r.e1=(n,e,s,l,h,p,g,x,w,T)=>{const I=n.transform,M=I.pitch<15?r0(.07,.7,Ee((14-I.zoom)/5,0,1)):.07,R=s.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:n0(n,e,s,l),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:I.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:h,u_width_scale:p,u_floor_width_scale:g,u_image:0,u_tile_units_to_pixels:s0(e,I),u_units_to_pixels:[1/I.pixelsToGLUnits[0],1/I.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:x,u_trim_fade_range:s.paint.get("line-trim-fade-range"),u_trim_color:s.paint.get("line-trim-color").toPremultipliedRenderColor(R?null:s.lut).toArray01(),u_emissive_strength:s.paint.get("line-emissive-strength"),u_zbias_factor:M,u_tile_to_meter:Ne(e.tileID.canonical,0),u_ground_shadow_factor:w,u_pattern_transition:T}},r.e2=(n,e,s,l,h,p,g,x,w,T)=>{const I=n.transform,M=I.calculatePixelsToTileUnitsMatrix(e),R=s.paint.get("line-trim-color-use-theme").constantOr("default")==="none",B=I.pitch<15?r0(.07,.7,Ee((14-I.zoom)/5,0,1)):.07;return{u_matrix:n0(n,e,s,l),u_pixels_to_tile_units:M,u_device_pixel_ratio:p,u_width_scale:g,u_floor_width_scale:x,u_units_to_pixels:[1/I.pixelsToGLUnits[0],1/I.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:h,u_texsize:o0(s)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:s0(e,n.transform),u_alpha_discard_threshold:0,u_trim_offset:w,u_trim_fade_range:s.paint.get("line-trim-fade-range"),u_trim_color:s.paint.get("line-trim-color").toPremultipliedRenderColor(R?null:s.lut).toArray01(),u_emissive_strength:s.paint.get("line-emissive-strength"),u_zbias_factor:B,u_tile_to_meter:Ne(e.tileID.canonical,0),u_ground_shadow_factor:T}},r.e3=Zt,r.e4=rf,r.e5=ge,r.e6=N1,r.e7=fg,r.e8=_v,r.e9=Pl,r.eA=hs,r.eB=Tl,r.eC=function(n,e,s,l,h,p,g,x,w,T,I,M,R,B,V,q){var Z=new k(16);return Z[0]=n,Z[1]=e,Z[2]=s,Z[3]=l,Z[4]=h,Z[5]=p,Z[6]=g,Z[7]=x,Z[8]=w,Z[9]=T,Z[10]=I,Z[11]=M,Z[12]=R,Z[13]=B,Z[14]=V,Z[15]=q,Z},r.eD=W,r.eE=Cc,r.eF=su,r.eG=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new mt(1/0,1/0),max:new mt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(n,e=!1){const s=rv(new mt(0,0),new mt(At,At),n),l=[];if(e&&!h_(s,this._globalClipBounds))return l;for(const h of this._activeRegions){if(h.hiddenByOverlap||!h_(s,h))continue;const p=vS(h.min,h.max,n);l.push({min:p.min,max:p.max,sourceId:this._sourceIds[h.priority],footprint:h.footprint,footprintTileId:h.tileId,order:h.order,clipMask:h.clipMask,clipScope:h.clipScope})}return l}setSources(n){this._setSources(n.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const s=[];for(const l of e.cache.getVisibleCoordinates()){const h=e.cache.getTile(l).buckets[e.layer];h&&h.updateFootprints(l.toUnwrapped(),s)}return s},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope})))}_addSource(n){const e=n.getFootprints();if(e.length===0)return;const s=n.getOrder(),l=n.getClipMask(),h=n.getClipScope();for(const p of e){if(!p.footprint)continue;const g=rv(p.footprint.min,p.footprint.max,p.id);this._activeRegions.push({min:g.min,max:g.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:p.id,footprint:p.footprint,order:s,clipMask:l,clipScope:h})}this._sourceIds.push(n.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,s)=>e.priority-s.priority||hg(e.min,s.min)||hg(e.max,s.max)||e.order-s.order||e.clipMask-s.clipMask||function(l,h){const p=(g,x)=>g+x;return l.length-h.length||l.reduce(p,"").localeCompare(h.reduce(p,""))}(e.clipScope,s.clipScope));let n=this._activeRegions.length!==this._prevRegions.length;if(!n){let e=0;for(;!n&&e!==this._activeRegions.length;){const s=this._activeRegions[e],l=this._prevRegions[e];n=s.priority!==l.priority||!iv(s,l)||s.order!==l.order||s.clipMask!==l.clipMask||!ya(s.clipScope,l.clipScope),++e}}if(n){++this._updateTime;for(const s of this._activeRegions)s.order!==cf&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,s.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,s.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,s.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,s.max.y));const e=s=>{const l=this._activeRegions;if(s>=l.length)return s;const h=l[s].priority;for(;s<l.length&&l[s].priority===h;)++s;return s};if(this._sourceIds.length>1){let s=0,l=e(s);for(;s!==l;){let h=s;const p=s;for(;h!==l;){const g=this._activeRegions[h];g.hiddenByOverlap=!1;for(let x=0;x<p;x++){const w=this._activeRegions[x];if(!w.hiddenByOverlap&&g.order===cf&&h_(g,w)&&(g.hiddenByOverlap=sv(g.footprint,g.tileId,w.footprint,w.tileId),g.hiddenByOverlap))break}++h}s=l,l=e(s)}}}}_setSources(n){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=n.length-1;e>=0;e--)this._addSource(n[e]);this._computeReplacement()}},r.eH=cf,r.eI=class{constructor(n){this._createGrid(n),this._createPoles(n)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const n of this._poleSegments)n.destroy();for(const n of this._gridSegments)n.withSkirts.destroy(),n.withoutSkirts.destroy()}_fillGridMeshWithLods(n,e){const s=new io,l=new gs,h=[],p=n+1+2,g=e[0]+1,x=e[0]+1+(1+e.length),w=(T,I,M)=>{let R=T===p-1?T-2:T===0?T:T-1;return R+=M?24575:0,[R,I]};for(let T=0;T<p;++T)s.emplaceBack(...w(T,0,!0));for(let T=0;T<g;++T)for(let I=0;I<p;++I)s.emplaceBack(...w(I,T,(I===0||I===p-1)&&!0));for(let T=0;T<e.length;++T){const I=e[T];for(let M=0;M<p;++M)s.emplaceBack(...w(M,I,!0))}for(let T=0;T<e.length;++T){const I=l.length,M=e[T]+1+2,R=new gs;for(let q=0;q<M-1;q++){const Z=q===M-2,$=Z?p*(x-e.length+T-q):p;for(let ne=0;ne<p-1;ne++){const ae=q*p+ne;q===0||Z||ne===0||ne===p-2?(R.emplaceBack(ae+1,ae,ae+$),R.emplaceBack(ae+$,ae+$+1,ae+1)):(l.emplaceBack(ae+1,ae,ae+$),l.emplaceBack(ae+$,ae+$+1,ae+1))}}const B=zr.simpleSegment(0,I,s.length,l.length-I);for(let q=0;q<R.uint16.length;q+=3)l.emplaceBack(R.uint16[q],R.uint16[q+1],R.uint16[q+2]);const V=zr.simpleSegment(0,I,s.length,l.length-I);h.push({withoutSkirts:B,withSkirts:V})}return{vertices:s,indices:l,segments:h}}_createGrid(n){const e=this._fillGridMeshWithLods(A,C);this._gridSegments=e.segments,this._gridBuffer=n.createVertexBuffer(e.vertices,yx.members),this._gridIndexBuffer=n.createIndexBuffer(e.indices,!0)}_createPoles(n){const e=new gs;for(let g=0;g<=A;g++)e.emplaceBack(0,g+1,g+2);this._poleIndexBuffer=n.createIndexBuffer(e,!0);const s=new No,l=new No,h=new No,p=new No;this._poleSegments=[];for(let g=0,x=0;g<m;g++){const w=360/(1<<g);s.emplaceBack(0,-u,0,.5,0),l.emplaceBack(0,-u,0,.5,1),h.emplaceBack(0,-u,0,.5,.5),p.emplaceBack(0,-u,0,.5,.5);for(let T=0;T<=A;T++){let I=T/A,M=0;const R=ei(0,w,I),[B,V,q]=U(W1,G1,R,u);s.emplaceBack(B,V,q,I,M),l.emplaceBack(B,V,q,I,1-M);const Z=Oe(R);I=.5+.5*Math.sin(Z),M=.5+.5*Math.cos(Z),h.emplaceBack(B,V,q,I,M),p.emplaceBack(B,V,q,I,1-M)}this._poleSegments.push(zr.simpleSegment(x,0,66,64)),x+=66}this._poleNorthVertexBuffer=n.createVertexBuffer(s,tg,!1),this._poleSouthVertexBuffer=n.createVertexBuffer(l,tg,!1),this._texturedPoleNorthVertexBuffer=n.createVertexBuffer(h,tg,!1),this._texturedPoleSouthVertexBuffer=n.createVertexBuffer(p,tg,!1)}getGridBuffers(n,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[n].withSkirts:this._gridSegments[n].withoutSkirts]}getPoleBuffers(n,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[n]]}},r.eJ=ev,r.eK=Me,r.eL=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},r.eM=Ce,r.eN=Je,r.eO=function(n,e,s){return n[0]=e[0]/s[0],n[1]=e[1]/s[1],n[2]=e[2]/s[2],n},r.eP=Gl,r.eQ=F,r.eR=ar,r.eS=Et,r.eT=function([n,e,s]){const l=Math.hypot(n,e,s),h=Math.atan2(n,s),p=.5*Math.PI-Math.acos(-e/l);return new Y(K(h),K(p))},r.eU=Fa,r.eV=T_,r.eW=function(n){const e=n.navigator?n.navigator.userAgent:null;return!!function(s){if(Hr==null){const l=s.navigator?s.navigator.userAgent:null;Hr=!!s.safari||!(!l||!(/\b(iPad|iPhone|iPod)\b/.test(l)||l.match("Safari")&&!l.match("Chrome")))}return Hr}(n)&&!(!e||!(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},r.eX=function(n,e){Fn=n,va=e},r.eY=t_,r.eZ=Tx,r.e_=function(n){const e=[0,0,0],s=H(new Float64Array(16));return ee(s,n.pixelMatrix,n.globeMatrix),Wi(e,e,s),new mt(e[0],e[1])},r.ea=450,r.eb=7,r.ec=Re,r.ed=function(n,e){if(n===e){var s=e[1],l=e[2],h=e[3],p=e[6],g=e[7],x=e[11];n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=s,n[6]=e[9],n[7]=e[13],n[8]=l,n[9]=p,n[11]=e[14],n[12]=h,n[13]=g,n[14]=x}else n[0]=e[0],n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=e[1],n[5]=e[5],n[6]=e[9],n[7]=e[13],n[8]=e[2],n[9]=e[6],n[10]=e[10],n[11]=e[14],n[12]=e[3],n[13]=e[7],n[14]=e[11],n[15]=e[15];return n},r.ee=gT,r.ef=Fi,r.eg=Cl,r.eh=256,r.ei=Qm,r.ej=en,r.ek=ce,r.el=function(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[4],n[4]=e[5],n[5]=e[6],n[6]=e[8],n[7]=e[9],n[8]=e[10],n},r.em=No,r.en=Zd,r.eo=Ad,r.ep=function(n,e,s,l,h){return Ee((n-e)/(s-e)*(h-l)+l,l,h)},r.eq=po,r.er=function(n,e){var s=e[0],l=e[1],h=e[2],p=e[3],g=e[4],x=e[5],w=e[6],T=e[7],I=e[8],M=I*g-x*T,R=-I*p+x*w,B=T*p-g*w,V=s*M+l*R+h*B;return V?(n[0]=M*(V=1/V),n[1]=(-I*l+h*T)*V,n[2]=(x*l-h*g)*V,n[3]=R*V,n[4]=(I*s-h*w)*V,n[5]=(-x*s+h*p)*V,n[6]=B*V,n[7]=(-T*s+l*w)*V,n[8]=(g*s-l*p)*V,n):null},r.es=2,r.et=Xr,r.eu=E_,r.ev=[1,1,1],r.ew=Tu,r.ex=Xl,r.ey=function(n,e,s,l){var h=e[0],p=e[1],g=e[2],x=e[3];return n[0]=h+l*(s[0]-h),n[1]=p+l*(s[1]-p),n[2]=g+l*(s[2]-g),n[3]=x+l*(s[3]-x),n},r.ez=xu,r.f=function(n){return btoa(encodeURIComponent(n).replace(/%([0-9A-F]{2})/g,(e,s)=>String.fromCharCode(+("0x"+s))))},r.f0=function(){gg().acquire(__)},r.f1=Zh,r.f2=function(n,e,s=!1){if(Xs===ln.deferred||Xs===ln.loading||Xs===ln.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");eo=Kn.resolveURL(n),Xs=ln.deferred,Dd=e,Od(),s||Po()},r.f3=function(n){mu=Kn.resolveURL(n),_u||(_u=new gu(gg(),new xo)),_u.broadcast("setMeshoptUrl",mu)},r.f4=Mv,r.f5=function(n){x_=Kn.resolveURL(n),_u||(_u=new gu(gg(),new xo)),_u.broadcast("setDracoUrl",x_)},r.f6=kv,r.f7=pf,r.f8=function(n){const e=Yu();if(!e)return;const s=e.delete(gn);n&&s.then(()=>n()).catch(n)},r.f9=Bc,r.fA=function(n){tc(),Hs!=null&&Hs.then(e=>{e.keys().then(s=>{for(let l=0;l<s.length-n;l++)e.delete(s[l]).catch(h=>Di(h.message))}).catch(s=>Di(s.message))}).catch(e=>Di(e.message))},r.fa=Dt,r.fb=Ml,r.fc=Ma,r.fd=ew,r.fe=tw,r.ff=Qv,r.fg=wi,r.fh="hd_road_elevation",r.fi=Mr,r.fj=ci,r.fk=Ho,r.fl=V_,r.fm=Uc,r.fn=function(n,e,s,l,h,p,g,x=1,w,T,I){n.createArrays(),n.tilePixelRatio=At/(512*n.overscaling),n.compareText={},n.iconsNeedLinear=!1;const M=n.layers[0].layout,R=n.layers[0]._unevaluatedLayout._values,B={};B.scaleFactor=x,B.textSizeScaleRange=M.get("text-size-scale-range"),B.iconSizeScaleRange=M.get("icon-size-scale-range");const[V,q]=B.textSizeScaleRange,[Z,$]=B.iconSizeScaleRange;B.textScaleFactor=Ee(B.scaleFactor,V,q),B.iconScaleFactor=Ee(B.scaleFactor,Z,$);const ne=R["text-size"],ae=R["icon-size"];if(n.textSizeData.kind==="composite"){const{minZoom:ze,maxZoom:rt}=n.textSizeData;B.compositeTextSizes=[ne.possiblyEvaluate(new _r(ze,{worldview:I}),p),ne.possiblyEvaluate(new _r(rt,{worldview:I}),p)]}if(n.iconSizeData.kind==="composite"){const{minZoom:ze,maxZoom:rt}=n.iconSizeData;B.compositeIconSizes=[ae.possiblyEvaluate(new _r(ze,{worldview:I}),p),ae.possiblyEvaluate(new _r(rt,{worldview:I}),p)]}B.layoutTextSize=ne.possiblyEvaluate(new _r(g+1,{worldview:I}),p),B.layoutIconSize=ae.possiblyEvaluate(new _r(g+1,{worldview:I}),p),B.textMaxSize=ne.possiblyEvaluate(new _r(18,{worldview:I}),p);const le=M.get("symbol-placement"),be=M.get("text-rotation-alignment")==="map"&&le!=="point",we=M.get("text-size");let ke=!1;const Le=[];for(const ze of n.features){const rt=M.get("text-font").evaluate(ze,{},p).join(","),Be=we.evaluate(ze,{},p)*B.textScaleFactor,st=B.layoutTextSize.evaluate(ze,{},p)*B.textScaleFactor,ut=B.layoutIconSize.evaluate(ze,{},p)*B.iconScaleFactor,nt={horizontal:{},vertical:void 0},ot=ze.text;let gt,tt=[0,0];if(ot){const jt=ot.toString(),ti=M.get("text-letter-spacing").evaluate(ze,{},p)*Es,di=M.get("text-line-height").evaluate(ze,{},p)*Es,Ii=Mp(jt)?ti:0,_i=M.get("text-anchor").evaluate(ze,{},p),Ft=M.get("text-variable-anchor");if(!Ft){const Ge=M.get("text-radial-offset").evaluate(ze,{},p);if(Ge)tt=F0(_i,[Ge*Es,j_]);else{const it=M.get("text-offset").evaluate(ze,{},p);tt=[it[0]*Es,it[1]*Es]}}let fi=be?"center":M.get("text-justify").evaluate(ze,{},p);const Vi=le==="point",de=Vi?M.get("text-max-width").evaluate(ze,{},p)*Es:1/0,fe=Ge=>{n.allowVerticalPlacement&&Rd(jt)&&(nt.vertical=F_(ot,e,s,h,rt,de,di,_i,Ge,Ii,tt,En.vertical,!0,st,Be,w))};if(!be&&Ft){const Ge=fi==="auto"?Ft.map(It=>H_(It)):[fi];let it=!1;for(let It=0;It<Ge.length;It++){const Ct=Ge[It];if(!nt.horizontal[Ct])if(it)nt.horizontal[Ct]=nt.horizontal[0];else{const Ot=F_(ot,e,s,h,rt,de,di,"center",Ct,Ii,tt,En.horizontal,!1,st,Be,w);Ot&&(nt.horizontal[Ct]=Ot,it=Ot.positionedLines.length===1)}}fe("left")}else{if(fi==="auto"&&(fi=H_(_i)),Vi||M.get("text-writing-mode").indexOf("horizontal")>=0||!Rd(jt)){const Ge=F_(ot,e,s,h,rt,de,di,_i,fi,Ii,tt,En.horizontal,!1,st,Be,w);Ge&&(nt.horizontal[fi]=Ge)}fe(Vi?"left":fi)}}let ct,Xe,He,_t,dt,Yt,zt=!1;const Bt=M.get("icon-text-fit").evaluate(ze,{},p);if(ze.icon&&ze.icon.hasPrimary()){const jt=N0(ze.icon,n.iconSizeData,R["icon-size"],p,n.zoom,ze,w,B.iconScaleFactor,I);ct=jt.iconPrimary,He=jt.iconSecondary;const ti=ct.toString();if(Xe=l.get(ti),Xe&&(dt=M.get("icon-offset").evaluate(ze,{},p),Yt=M.get("icon-anchor").evaluate(ze,{},p),gt=GA(h.get(ti),He?h.get(He.toString()):void 0,dt,Yt),zt=Xe.sdf,n.sdfIcons===void 0?n.sdfIcons=Xe.sdf:n.sdfIcons!==Xe.sdf&&Di("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Xe.pixelRatio!==n.pixelRatio||M.get("icon-rotate").constantOr(1)!==0)&&(n.iconsNeedLinear=!0)),He){const di=He.toString();_t=l.get(di)}}ke=ke||!(!ze.icon||!ze.icon.hasSecondary());const St=W_(nt.horizontal)||nt.vertical;n.iconsInText||(n.iconsInText=!!St&&St.iconsInText);const Gt=st*B.textScaleFactor/Es,{defaultShapedIcon:li,verticallyShapedIcon:kt}=tT(n,gt,M,ze,p,nt,Gt,dt,Bt);Bt!=="none"&&gt&&(b0(gt)||w0(gt))&&(Ig(0,Xe,ct,gt,li,Bt,T,l,h),Ig(0,_t,He,gt,li,Bt,T,l,h),kt&&(Ig(0,Xe,ct,gt,kt,Bt,T,l,h),Ig(0,_t,He,gt,kt,Bt,T,l,h))),gt=li,Le.push({feature:ze,shapedTextOrientations:nt,shapedText:St,shapedIcon:gt,iconPrimary:ct,iconSecondary:He,iconOffset:dt,iconAnchor:Yt,verticallyShapedIcon:kt,layoutTextSize:st,layoutIconSize:ut,textOffset:tt,isSDFIcon:zt,iconTextFit:Bt})}return{featureData:Le,sizes:B,hasAnySecondaryIcon:ke,textAlongLine:be,symbolPlacement:le}},r.fo=P0,r.fp=function(n,e,s,l,h,p,g,x,w,T){const{featureData:I,hasAnySecondaryIcon:M,sizes:R,textAlongLine:B,symbolPlacement:V}=e;for(const q of I){const{shapedIcon:Z,verticallyShapedIcon:$,feature:ne,shapedTextOrientations:ae,shapedText:le,layoutTextSize:be,textOffset:we,isSDFIcon:ke,iconPrimary:Le,iconSecondary:ze,iconTextFit:rt,iconOffset:Be}=q;V0(Z,T.iconPositions,Le,ze),V0($,T.iconPositions,Le,ze),eT(ae,T.iconPositions),QA(Le,ze,T.iconPositions),(le||Z)&&iT(n,ne,ae,Z,$,w,R,be,0,we,ke,l,h,g,x,M,rt,Be,B,V)}s&&n.generateCollisionDebugBuffers(p,n.collisionBoxArray,R.textScaleFactor)},r.fq=oi,r.fr=qg,r.fs=ht,r.ft=function(n){let e=0;if(new Uint32Array(n,0,1)[0]!==Lv){const s=new Uint32Array(n,0,7),[,,l,h,p,g]=s;e=s.byteLength+h+p+g+p,(l!==n.byteLength||e>=n.byteLength)&&Di("Invalid b3dm header information.")}return Ov(n,e)},r.fu=function(n,e){const s=Wv(n);for(const l of s){for(const h of l.meshes)JS(h);l.lights&&(l.lightMeshIndex=l.meshes.length,l.meshes.push(KS(l.lights,e)))}return s},r.fv=jg,r.fw=dr,r.fx=Cv,r.fy=ia,r.fz=ln,r.g=function(n,e){return Ui(Object.assign(n,{method:"GET"}),e)},r.h=function(n){return n.indexOf("mapbox:")===0},r.i=function(n){return Fs.API_STYLE_REGEX.test(n)&&!ip(n)},r.j=Zo,r.k=ic,r.l=function(n){return decodeURIComponent(atob(n).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))},r.m=function(n,e){return Ui(Object.assign(n,{type:"json"}),e)},r.n=el,r.o=Kn,r.p=function(n,e){return Ui(Object.assign(n,{method:"POST"}),e)},r.q=Rs,r.r=Gu,r.s=function(n){try{const e=self[n];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},r.t=function(){return y_||(y_=new Bc),y_},r.u=function(){return function n(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,n)}()},r.v=function(n){return!!n&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(n)},r.w=Di,r.x=ny,r.y=nc,r.z=Nn}),_(["./shared"],function(r){function E(Oe){const K=Oe?Oe.url.toString():void 0;return K?performance.getEntriesByName(K):[]}function k(Oe){if(typeof Oe=="number"||typeof Oe=="boolean"||typeof Oe=="string"||Oe==null)return JSON.stringify(Oe);if(Array.isArray(Oe)){let se="[";for(const pe of Oe)se+=`${k(pe)},`;return`${se}]`}let K="{";for(const se of Object.keys(Oe).sort())K+=`${se}:${k(Oe[se])},`;return`${K}}`}function P(Oe){let K="";for(const se of r.bx)K+=`/${k(Oe[se])}`;return K}class L{constructor(K){this.keyCache={},this._layers={},this._layerConfigs={},K&&this.replace(K)}replace(K,se){this._layerConfigs={},this._layers={},this.update(K,[],se)}update(K,se,pe){this._options=pe;for(const Ce of K)this._layerConfigs[Ce.id]=Ce,(this._layers[Ce.id]=r.dq(Ce,this.scope,null,this._options)).compileFilter(pe),this.keyCache[Ce.id]&&delete this.keyCache[Ce.id];for(const Ce of se)delete this.keyCache[Ce],delete this._layerConfigs[Ce],delete this._layers[Ce];this.familiesBySource={};const Me=function(Ce,Ee){const Ye={};for(let Ze=0;Ze<Ce.length;Ze++){const wt=Ce[Ze];let lt=Ee&&Ee[wt.id];lt||(wt.type==="symbol"?lt=wt.id:(lt=P(wt),wt.type==="line"&&wt.paint&&function ni(ci){return typeof ci=="string"&&ci==="line-progress"||(Array.isArray(ci)?ci.some(ni):!(!ci||typeof ci!="object")&&Object.values(ci).some(ni))}(wt.paint["line-width"])&&(lt+=`/${k(wt.paint["line-width"])}`))),Ee&&(Ee[wt.id]=lt);let Zt=Ye[lt];Zt||(Zt=Ye[lt]=[]),Zt.push(wt)}const De=[];for(const Ze in Ye)De.push(Ye[Ze]);return De}(Object.values(this._layerConfigs),this.keyCache);for(const Ce of Me){const Ee=Ce.map(Zt=>this._layers[Zt.id]),Ye=Ee[0];if(Ye.visibility==="none")continue;const De=Ye.source||"";let Ze=this.familiesBySource[De];Ze||(Ze=this.familiesBySource[De]={});const wt=Ye.sourceLayer||"_geojsonTileLayer";let lt=Ze[wt];lt||(lt=Ze[wt]=[]),lt.push(Ee)}}}const O=1*r.fc;class N{constructor(K){const se={},pe=[];for(const Ye in K){const De=K[Ye],Ze=se[Ye]={};for(const wt in De.glyphs){const lt=De.glyphs[+wt];if(!lt||lt.bitmap.width===0||lt.bitmap.height===0)continue;const Zt=lt.metrics.localGlyph?O:1,ni={x:0,y:0,w:lt.bitmap.width+2*Zt,h:lt.bitmap.height+2*Zt};pe.push(ni),Ze[wt]=ni}}const{w:Me,h:Ce}=r.G(pe),Ee=new r.fb({width:Me||1,height:Ce||1});for(const Ye in K){const De=K[Ye];for(const Ze in De.glyphs){const wt=De.glyphs[+Ze];if(!wt||wt.bitmap.width===0||wt.bitmap.height===0)continue;const lt=se[Ye][Ze],Zt=wt.metrics.localGlyph?O:1;r.fb.copy(wt.bitmap,Ee,{x:0,y:0},{x:lt.x+Zt,y:lt.y+Zt},wt.bitmap)}}this.image=Ee,this.positions=se}}r.fa(N,"GlyphAtlas");class G{constructor(K){this.tileID=new r.aO(K.tileID.overscaledZ,K.tileID.wrap,K.tileID.canonical.z,K.tileID.canonical.x,K.tileID.canonical.y),this.tileZoom=K.tileZoom,this.uid=K.uid,this.zoom=K.zoom,this.lut=K.lut,this.canonical=K.tileID.canonical,this.pixelRatio=K.pixelRatio,this.tileSize=K.tileSize,this.source=K.source,this.scope=K.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=K.showCollisionBoxes,this.collectResourceTiming=!!K.request&&K.request.collectResourceTiming,this.promoteId=K.promoteId,this.isSymbolTile=K.isSymbolTile,this.tileTransform=r.aZ(K.tileID.canonical,K.projection),this.projection=K.projection,this.worldview=K.worldview,this.localizableLayerIds=K.localizableLayerIds,this.brightness=K.brightness,this.extraShadowCaster=!!K.extraShadowCaster,this.tessellationStep=K.tessellationStep,this.scaleFactor=K.scaleFactor,this.worldview=K.worldview}parse(K,se,pe,Me,Ce,Ee){this.status="parsing",this.data=K,this.collisionBoxArray=new r.b3;const Ye=new r.fd(Object.keys(K.layers).sort()),De=new r.fe(this.tileID,this.promoteId);De.bucketLayerIDs=[];const Ze={},wt=new r.ff(256,256),lt={featureIndex:De,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:wt,availableImages:pe,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},Zt=[],ni=se.familiesBySource[this.source];for(const Ri in ni){const Li=K.layers[Ri];if(!Li)continue;let Bi=!1,fr=!1,Di=!1;for(const dr of ni[Ri])dr[0].type==="symbol"?Bi=!0:fr=!0,dr[0].is3D()&&dr[0].type!=="model"&&(Di=!0);if(this.extraShadowCaster&&!Di||this.isSymbolTile===!0&&!Bi||this.isSymbolTile===!1&&!fr)continue;Li.version===1&&r.w(`Vector tile source "${this.source}" layer "${Ri}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Yr=Ye.encode(Ri),os=[];let ls=!1;for(let dr=0,Ki=0;dr<Li.length;dr++){const Hr=Li.feature(dr),Wr=De.getId(Hr,Ri);if(this.localizableLayerIds&&this.localizableLayerIds.has(Ri)){const Sr=Hr.properties?Hr.properties.worldview:null;if(this.worldview&&typeof Sr=="string")if(Sr==="all")Hr.properties.$localized=!0;else{if(!Sr.split(",").includes(this.worldview))continue;Hr.properties.$localized=!0,Hr.properties.worldview=this.worldview}}!ls&&Hr.properties&&Hr.properties.hasOwnProperty(r.fg)&&(ls=!0),os.push({feature:Hr,id:Wr,index:Ki,sourceLayerIndex:Yr}),Ki++}ls&&!lt.elevationFeatures&&K.layers.hasOwnProperty(r.fh)&&(lt.elevationFeatures=r.fi.parseFrom(K.layers[r.fh],this.canonical));for(const dr of ni[Ri]){const Ki=dr[0];if(this.extraShadowCaster&&(!Ki.is3D()||Ki.type==="model")||this.isSymbolTile!==void 0&&Ki.type==="symbol"!==this.isSymbolTile||Ki.minzoom&&this.zoom<Math.floor(Ki.minzoom)||Ki.maxzoom&&this.zoom>=Ki.maxzoom||Ki.visibility==="none")continue;H(dr,this.zoom,lt.brightness,pe,this.worldview);const Hr=Ze[Ki.id]=Ki.createBucket({index:De.bucketLayerIDs.length,layers:dr,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Yr,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:Me,worldview:this.worldview});De.bucketLayerIDs.push(dr.map(Sr=>r.B(Sr.id,Sr.scope)));let Wr=Hr.prepare?Hr.prepare():null;Wr!=null?(Wr=Wr.then(()=>Hr.populate(os,lt,this.tileID.canonical,this.tileTransform)),Zt.push(Wr)):Hr.populate(os,lt,this.tileID.canonical,this.tileTransform)}}const ci=()=>{let Ri,Li,Bi,fr,Di,Yr;wt.trim();const os={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ls=()=>{if(Ri)return this.status="done",Ee(Ri);if(this.extraShadowCaster)this.status="done",Ee(null,{buckets:Object.values(Ze).filter(Ki=>!Ki.isEmpty()),featureIndex:De,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:lt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Li&&Bi&&fr){const Ki=new N(Li),Hr=new Map;for(const[Ms,js]of Bi.entries()){const{imagePosition:pn}=r.fl(Ms,js,r.fm);Hr.set(Ms,pn)}const Wr={};for(const Ms in Ze){const js=Ze[Ms];js instanceof r.b4&&(H(js.layers,this.zoom,lt.brightness,pe,this.worldview),Wr[Ms]=r.fn(js,Li,Ki.positions,Bi,Hr,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,Di,this.worldview))}const Sr={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(Ce,Bi,Di,()=>{Sr.iconsPending=!1,dr(Wr,Ki,Sr)}),this.rasterizeIfNeeded(Ce,fr,Yr,()=>{Sr.patternsPending=!1,dr(Wr,Ki,Sr)})}},dr=(Ki,Hr,Wr,Sr)=>{if(Wr.iconsPending||Wr.patternsPending)return;const Ms=new r.fo(Bi,fr,this.lut);for(const js in Ze){const pn=Ze[js];if(js in Ki)r.fp(pn,Ki[js],this.showCollisionBoxes,pe,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,Bi,Ms);else if(pn.hasPattern&&(pn instanceof r.ba||pn instanceof r.bb||pn instanceof r.e7)){H(pn.layers,this.zoom,lt.brightness,pe,this.worldview);const xa=Object.fromEntries(Ms.patternPositions);pn.addFeatures(lt,this.tileID.canonical,xa,pe,this.tileTransform,this.brightness)}}this.status="done",Ee(null,{buckets:Object.values(Ze).filter(js=>!js.isEmpty()),featureIndex:De,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Hr.image,lineAtlas:wt,imageAtlas:Ms,brightness:lt.brightness})};if(!this.extraShadowCaster){const Ki=r.fj(lt.glyphDependencies,Sr=>Object.keys(Sr).map(Number));Object.keys(Ki).length?Ce.send("getGlyphs",{uid:this.uid,stacks:Ki},(Sr,Ms)=>{Ri||(Ri=Sr,Li=Ms,ls())},void 0,!1,os):Li={};const Hr=Array.from(lt.iconDependencies.keys()).map(Sr=>r.I.parse(Sr));Hr.length?Ce.send("getImages",{images:Hr,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Sr,Ms)=>{Ri||(Ri=Sr,Bi=new Map,Di=this.updateImageMapAndGetImageTaskQueue(Bi,Ms,lt.iconDependencies),ls())},void 0,!1,os):(Bi=new Map,Di=new Map);const Wr=Array.from(lt.patternDependencies.keys()).map(Sr=>r.I.parse(Sr));Wr.length?Ce.send("getImages",{images:Wr,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Sr,Ms)=>{Ri||(Ri=Sr,fr=new Map,Yr=this.updateImageMapAndGetImageTaskQueue(fr,Ms,lt.patternDependencies),ls())},void 0,!1,os):(fr=new Map,Yr=new Map)}if(lt.elevationFeatures&&lt.elevationFeatures.length>0){const Ki=[];for(const Wr of Object.values(Ze))if(Wr instanceof r.bb){const Sr=Wr.getUnevaluatedPortalGraph();Sr&&Ki.push(Sr)}const Hr=r.fk.evaluate(Ki);for(const Wr of Object.values(Ze))if(Wr instanceof r.bb){const Sr=K.layers[Ye.decode(Wr.sourceLayerIndex)];Wr.setEvaluatedPortalGraph(Hr,Sr,this.tileID.canonical,lt.availableImages,lt.brightness)}}ls()};Zt.length>0?Promise.allSettled(Zt).then(ci).catch(Ee):ci()}rasterizeIfNeeded(K,se,pe,Me){Array.from(se.values()).some(Ce=>Ce.usvg)?this.rasterize(K,se,pe,Me):Me()}updateImageMapAndGetImageTaskQueue(K,se,pe){const Me=new Map;for(const Ce of se.keys()){const Ee=pe.get(Ce)||[];for(const Ye of Ee){const De=Ye.toString(),Ze=se.get(Ye.id.toString());Ze.usvg?Me.has(De)||(Me.set(De,Ye),K.set(De,Object.assign({},Ze))):K.set(De,Ze)}}return Me}rasterize(K,se,pe,Me){this.rasterizeTask=K.send("rasterizeImages",{scope:this.scope,tasks:pe},(Ce,Ee)=>{if(!Ce)for(const[Ye,De]of Ee.entries()){const Ze=Object.assign(se.get(Ye),{data:De});se.set(Ye,Ze)}Me()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function H(Oe,K,se,pe,Me){const Ce=new r.ac(K,{brightness:se,worldview:Me});for(const Ee of Oe)Ee.recalculate(Ce,pe)}class Q extends r.E{constructor(K,se,pe,Me,Ce,Ee,Ye){super(),this.actor=K,this.layerIndex=se,this.availableImages=pe,this.availableModels=Me,this.loadVectorData=Ee||r.aL,this.loading={},this.loaded={},this.deduped=new r.aK(K.scheduler),this.isSpriteLoaded=Ce,this.scheduler=K.scheduler,this.brightness=Ye}loadTile(K,se){const pe=K.uid,Me=K&&K.request,Ce=Me&&Me.collectResourceTiming,Ee=this.loading[pe]=new G(K);Ee.abort=this.loadVectorData(K,(Ye,De)=>{const Ze=!this.loading[pe];if(delete this.loading[pe],Ee.cancelRasterize(),Ze||Ye||!De)return Ee.status="done",Ze||(this.loaded[pe]=Ee),se(Ye);const wt=De.rawData,lt={};De.expires&&(lt.expires=De.expires),De.cacheControl&&(lt.cacheControl=De.cacheControl),Ee.vectorTile=De.vectorTile||new r.fq(new r.bt(wt));const Zt=()=>{Ee.parse(Ee.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(ni,ci)=>{if(ni||!ci)return se(ni);const Ri={};if(Ce){const Li=E(Me);Li.length>0&&(Ri.resourceTiming=JSON.parse(JSON.stringify(Li)))}se(null,Object.assign({rawTileData:wt.slice(0)},ci,lt,Ri))})};this.isSpriteLoaded?Zt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Zt,{type:"parseTile",isSymbolTile:K.isSymbolTile,zoom:K.tileZoom}):Zt()}),this.loaded=this.loaded||{},this.loaded[pe]=Ee})}reloadTile(K,se){const pe=this.loaded,Me=K.uid;if(pe&&pe[Me]){const Ce=pe[Me];Ce.scaleFactor=K.scaleFactor,Ce.showCollisionBoxes=K.showCollisionBoxes,Ce.projection=K.projection,Ce.brightness=K.brightness,Ce.tileTransform=r.aZ(K.tileID.canonical,K.projection),Ce.extraShadowCaster=K.extraShadowCaster,Ce.lut=K.lut,Ce.worldview=K.worldview;const Ee=(Ye,De)=>{const Ze=Ce.reloadCallback;Ze&&(delete Ce.reloadCallback,Ce.parse(Ce.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Ze)),se(Ye,De)};Ce.status==="parsing"?Ce.reloadCallback=Ee:Ce.status==="done"&&(Ce.vectorTile?Ce.parse(Ce.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Ee):Ee())}else se(null,void 0)}abortTile(K,se){const pe=K.uid,Me=this.loading[pe];Me&&(Me.abort&&Me.abort(),delete this.loading[pe]),se()}removeTile(K,se){const pe=this.loaded,Me=K.uid;pe&&pe[Me]&&delete pe[Me],se()}}class ee{loadTile(K,se){const{uid:pe,encoding:Me,rawImageData:Ce,padding:Ee}=K,Ye=ImageBitmap&&Ce instanceof ImageBitmap?this.getImageData(Ce,Ee):Ce;se(null,new r.fr(pe,Ye,Me,Ee<1))}reloadTile(K,se){se(null,null)}abortTile(K,se){se()}removeTile(K,se){se()}getImageData(K,se){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(K.width,K.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=K.width,this.offscreenCanvas.height=K.height,this.offscreenCanvasContext.drawImage(K,0,0,K.width,K.height);const pe=this.offscreenCanvasContext.getImageData(-se,-se,K.width+2*se,K.height+2*se);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),pe}}r.bs.setPbf(r.bt);class ie{constructor(K){this._mrt=new r.bs(K.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=K.uid,this.tileID=K.tileID,this.source=K.source}parse(K,se){const pe=this._mrt;this.status="parsing",this._entireBuffer=K;try{pe.parseHeader(K),this._isHeaderLoaded=!0;const Me=[];for(const Ce in pe.layers){const Ee=pe.getLayer(Ce),Ye=Ee.getDataRange(Ee.getBandList()),De=pe.createDecodingTask(Ye),Ze=K.slice(Ye.firstByte,Ye.lastByte+1),wt=r.bs.performDecoding(Ze,De).then(lt=>De.complete(null,lt)).catch(lt=>De.complete(lt,null));Me.push(wt)}Promise.allSettled(Me).then(()=>se(null,pe)).catch(Ce=>se(Ce))}catch(Me){se(Me)}}}class ue{constructor(K){this.actor=K,this.loading={},this.loaded={}}loadTile(K,se){const pe=K.uid,Me=K.request,Ce=this.loading[pe]=new ie(K),{cancel:Ee}=r.bu(Me,(Ye,De,Ze,wt)=>{const lt=!this.loading[pe];if(delete this.loading[pe],lt||Ye||!De)return Ce.status="done",lt||(this.loaded[pe]=Ce),se(Ye);Ce.parse(De,(Zt,ni)=>{if(Zt||!ni)return se(Zt);se(null,ni,Ze,wt)}),this.loaded[pe]=Ce});Ce.abort=Ee}reloadTile(K,se){se(null,void 0)}abortTile(K,se){const pe=K.uid,Me=this.loading[pe];Me&&(Me.abort&&Me.abort(),delete this.loading[pe]),se()}removeTile(K,se){const pe=K.uid;this.loaded[pe]&&delete this.loaded[pe],se()}decodeRasterArray(K,se){r.bs.performDecoding(K.buffer,K.task).then(pe=>se(null,pe)).catch(pe=>se(pe))}}const ve=r.fs.prototype.toGeoJSON;class ce{constructor(K){this._feature=K,this.extent=r.al,this.type=K.type,this.properties=K.tags,"id"in K&&!isNaN(K.id)&&(this.id=parseInt(K.id,10))}loadGeometry(){if(this._feature.type===1){const K=[];for(const se of this._feature.geometry)K.push([new r.P(se[0],se[1])]);return K}{const K=[];for(const se of this._feature.geometry){const pe=[];for(const Me of se)pe.push(new r.P(Me[0],Me[1]));K.push(pe)}return K}}toGeoJSON(K,se,pe){return ve.call(this,K,se,pe)}}class Te{constructor(K,se){this.name=K,this.extent=r.al,this.length=se.length,this._jsonFeatures=se}feature(K){return new ce(this._jsonFeatures[K])}}class Se{constructor(K){this.layers={},this.extent=r.al;for(const se of Object.keys(K))this.layers[se]=new Te(se,K[se])}}const Ie=64/4096,Ue=128;class Ke{constructor(){this.features=new Map}clear(){this.features.clear()}load(K=[],se){for(const pe of K){const Me=pe.id;if(Me==null)continue;let Ce=this.features.get(Me);Ce&&this.updateCache(Ce,se),pe.geometry?(Ce=ft(pe),this.updateCache(Ce,se),this.features.set(Me,Ce)):this.features.delete(Me),this.updateCache(Ce,se)}}updateCache(K,se){for(const{canonical:pe,uid:Me}of Object.values(se)){const{z:Ce,x:Ee,y:Ye}=pe;qe(K,Math.pow(2,Ce),Ee,Ye)&&delete se[Me]}}getTile(K,se,pe){const Me=Math.pow(2,K),Ce=[];for(const Ee of this.features.values())qe(Ee,Me,se,pe)&&Ce.push(Lt(Ee,Me,se,pe));return{features:Ce}}getFeatures(){return[...this.features.values()]}}function qe({minX:Oe,minY:K,maxX:se,maxY:pe},Me,Ce,Ee){return Oe<(Ce+1+Ie)/Me&&K<(Ee+1+Ie)/Me&&se>(Ce-Ie)/Me&&pe>(Ee-Ie)/Me}function ft(Oe){const{id:K,geometry:se,properties:pe}=Oe;if(!se)return;if(se.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Me,coordinates:Ce}=se,Ee={id:K,type:1,geometry:[],tags:pe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Ye=Ee.geometry;if(Me==="Point")bt(Ce,Ye,Ee);else if(Me==="MultiPoint")for(const De of Ce)bt(De,Ye,Ee);else if(Me==="LineString")Ee.type=2,Tt(Ce,Ye,Ee);else if(Me==="MultiLineString")Ee.type=2,Et(Ce,Ye,Ee);else if(Me==="Polygon")Ee.type=3,Et(Ce,Ye,Ee,!0);else{if(Me!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Ee.type=3;for(const De of Ce)Et(De,Ye,Ee,!0)}return Ee}function bt([Oe,K],se,pe){const Me=r.aF(Oe);let Ce=r.aJ(K);Ce=Ce<0?0:Ce>1?1:Ce,se.push(Me,Ce),pe.minX=Math.min(pe.minX,Me),pe.minY=Math.min(pe.minY,Ce),pe.maxX=Math.max(pe.maxX,Me),pe.maxY=Math.max(pe.maxY,Ce)}function Tt(Oe,K,se,pe=!1,Me=!1){const Ce=[];for(const Ee of Oe)bt(Ee,Ce,se);K.push(Ce),pe&&function(Ee,Ye){let De=0;for(let Ze=0,wt=Ee.length,lt=wt-2;Ze<wt;lt=Ze,Ze+=2)De+=(Ee[Ze]-Ee[lt])*(Ee[Ze+1]+Ee[lt+1]);if(De>0===Ye)for(let Ze=0,wt=Ee.length;Ze<wt/2;Ze+=2){const lt=Ee[Ze],Zt=Ee[Ze+1];Ee[Ze]=Ee[wt-2-Ze],Ee[Ze+1]=Ee[wt-1-Ze],Ee[wt-2-Ze]=lt,Ee[wt-1-Ze]=Zt}}(Ce,Me)}function Et(Oe,K,se,pe=!1){for(let Me=0;Me<Oe.length;Me++)Tt(Oe[Me],K,se,pe,Me===0)}function Lt(Oe,K,se,pe){const{id:Me,type:Ce,geometry:Ee,tags:Ye}=Oe,De=[];if(Ce===1)(function(Ze,wt,lt,Zt,ni){for(let ci=0;ci<Ze.length;ci+=2){const Ri=Math.round(r.al*(Ze[ci+0]*wt-lt)),Li=Math.round(r.al*(Ze[ci+1]*wt-Zt));ni.push([Ri,Li])}})(Ee,K,se,pe,De);else for(const Ze of Ee)qt(Ze,K,se,pe,De);return{id:Me,type:Ce,geometry:De,tags:Ye}}function qt(Oe,K,se,pe,Me){const Ee=r.al+Ue;let Ye;for(let De=0;De<Oe.length-2;De+=2){let Ze=Math.round(r.al*(Oe[De+0]*K-se)),wt=Math.round(r.al*(Oe[De+1]*K-pe)),lt=Math.round(r.al*(Oe[De+2]*K-se)),Zt=Math.round(r.al*(Oe[De+3]*K-pe));const ni=lt-Ze,ci=Zt-wt;Ze<-128&&lt<-128||(Ze<-128?(wt+=Math.round(ci*((-128-Ze)/ni)),Ze=-128):lt<-128&&(Zt=wt+Math.round(ci*((-128-Ze)/ni)),lt=-128),wt<-128&&Zt<-128||(wt<-128?(Ze+=Math.round(ni*((-128-wt)/ci)),wt=-128):Zt<-128&&(lt=Ze+Math.round(ni*((-128-wt)/ci)),Zt=-128),Ze>=Ee&&lt>=Ee||(Ze>=Ee?(wt+=Math.round(ci*((Ee-Ze)/ni)),Ze=Ee):lt>=Ee&&(Zt=wt+Math.round(ci*((Ee-Ze)/ni)),lt=Ee),wt>=Ee&&Zt>=Ee||(wt>=Ee?(Ze+=Math.round(ni*((Ee-wt)/ci)),wt=Ee):Zt>=Ee&&(lt=Ze+Math.round(ni*((Ee-wt)/ci)),Zt=Ee),Ye&&Ze===Ye[Ye.length-1][0]&&wt===Ye[Ye.length-1][1]||(Ye=[[Ze,wt]],Me.push(Ye)),Ye.push([lt,Zt])))))}}function ui({name:Oe,features:K},se){se.writeStringField(1,Oe),se.writeVarintField(5,r.al);const pe=new Map,Me=new Map,Ce={keys:pe,values:Me,feature:null};for(const Ee of K)Ce.feature=Ee,se.writeMessage(2,Ti,Ce);for(const Ee of pe.keys())se.writeStringField(3,Ee);for(const Ee of Me.keys())se.writeMessage(4,ar,Ee)}function Ti(Oe,K){const se=Oe.feature;se.id!==void 0&&Number.isSafeInteger(+se.id)&&K.writeVarintField(1,+se.id),se.tags&&K.writeMessage(2,vi,Oe),K.writeVarintField(3,se.type),K.writeMessage(4,Br,se)}function vi({keys:Oe,values:K,feature:se},pe){for(const Me of Object.keys(se.tags)){let Ce=se.tags[Me];if(Ce===null)continue;let Ee=Oe.get(Me);Ee===void 0&&(Ee=Oe.size,Oe.set(Me,Ee)),pe.writeVarint(Ee);const Ye=typeof Ce;Ye!=="string"&&Ye!=="boolean"&&Ye!=="number"&&(Ce=JSON.stringify(Ce));let De=K.get(Ce);De===void 0&&(De=K.size,K.set(Ce,De)),pe.writeVarint(De)}}function Kt(Oe,K){return(K<<3)+(7&Oe)}function Hi(Oe){return Oe<<1^Oe>>31}function Br(Oe,K){const{geometry:se,type:pe}=Oe;let Me=0,Ce=0;if(pe===1){K.writeVarint(Kt(1,se.length));for(const Ee of se){const Ye=Ee[0]-Me,De=Ee[1]-Ce;K.writeVarint(Hi(Ye)),K.writeVarint(Hi(De)),Me+=Ye,Ce+=De}}else for(const Ee of se){K.writeVarint(Kt(1,1));const Ye=Ee.length-(pe===3?1:0);for(let De=0;De<Ye;De++){De===1&&K.writeVarint(Kt(2,Ye-1));const Ze=Ee[De][0]-Me,wt=Ee[De][1]-Ce;K.writeVarint(Hi(Ze)),K.writeVarint(Hi(wt)),Me+=Ze,Ce+=wt}pe===3&&K.writeVarint(Kt(7,1))}}function ar(Oe,K){const se=typeof Oe;se==="string"?K.writeStringField(1,Oe):se==="boolean"?K.writeBooleanField(7,Oe):se==="number"&&(Oe%1!=0?K.writeDoubleField(3,Oe):Oe<0?K.writeSVarintField(6,Oe):K.writeVarintField(5,Oe))}const Xr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Oe=>Oe},mi=Math.fround||(Ci=new Float32Array(1),Oe=>(Ci[0]=+Oe,Ci[0]));var Ci;const zi=3,mr=5,Wi=6;class ns{constructor(K){this.options=Object.assign(Object.create(Xr),K),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(K){const{log:se,minZoom:pe,maxZoom:Me}=this.options;se&&console.time("total time");const Ce=`prepare ${K.length} points`;se&&console.time(Ce),this.points=K;const Ee=[];for(let De=0;De<K.length;De++){const Ze=K[De];if(!Ze.geometry)continue;const[wt,lt]=Ze.geometry.coordinates,Zt=mi(_s(wt)),ni=mi(jr(lt));Ee.push(Zt,ni,1/0,De,-1,1),this.options.reduce&&Ee.push(0)}let Ye=this.trees[Me+1]=this._createTree(Ee);se&&console.timeEnd(Ce);for(let De=Me;De>=pe;De--){const Ze=+Date.now();Ye=this.trees[De]=this._createTree(this._cluster(Ye,De)),se&&console.log("z%d: %d clusters in %dms",De,Ye.numItems,+Date.now()-Ze)}return se&&console.timeEnd("total time"),this}getClusters(K,se){let pe=((K[0]+180)%360+360)%360-180;const Me=Math.max(-90,Math.min(90,K[1]));let Ce=K[2]===180?180:((K[2]+180)%360+360)%360-180;const Ee=Math.max(-90,Math.min(90,K[3]));if(K[2]-K[0]>=360)pe=-180,Ce=180;else if(pe>Ce){const lt=this.getClusters([pe,Me,180,Ee],se),Zt=this.getClusters([-180,Me,Ce,Ee],se);return lt.concat(Zt)}const Ye=this.trees[this._limitZoom(se)],De=Ye.range(_s(pe),jr(Ee),_s(Ce),jr(Me)),Ze=Ye.data,wt=[];for(const lt of De){const Zt=this.stride*lt;wt.push(Ze[Zt+mr]>1?nn(Ze,Zt,this.clusterProps):this.points[Ze[Zt+zi]])}return wt}getChildren(K){const se=this._getOriginId(K),pe=this._getOriginZoom(K),Me="No cluster with the specified id.",Ce=this.trees[pe];if(!Ce)throw new Error(Me);const Ee=Ce.data;if(se*this.stride>=Ee.length)throw new Error(Me);const Ye=this.options.radius/(this.options.extent*Math.pow(2,pe-1)),De=Ce.within(Ee[se*this.stride],Ee[se*this.stride+1],Ye),Ze=[];for(const wt of De){const lt=wt*this.stride;Ee[lt+4]===K&&Ze.push(Ee[lt+mr]>1?nn(Ee,lt,this.clusterProps):this.points[Ee[lt+zi]])}if(Ze.length===0)throw new Error(Me);return Ze}getLeaves(K,se,pe){const Me=[];return this._appendLeaves(Me,K,se=se||10,pe=pe||0,0),Me}getTile(K,se,pe){const Me=this.trees[this._limitZoom(K)],Ce=Math.pow(2,K),{extent:Ee,radius:Ye}=this.options,De=Ye/Ee,Ze=(pe-De)/Ce,wt=(pe+1+De)/Ce,lt={features:[]};return this._addTileFeatures(Me.range((se-De)/Ce,Ze,(se+1+De)/Ce,wt),Me.data,se,pe,Ce,lt),se===0&&this._addTileFeatures(Me.range(1-De/Ce,Ze,1,wt),Me.data,Ce,pe,Ce,lt),se===Ce-1&&this._addTileFeatures(Me.range(0,Ze,De/Ce,wt),Me.data,-1,pe,Ce,lt),lt.features.length?lt:null}getClusterExpansionZoom(K){let se=this._getOriginZoom(K)-1;for(;se<=this.options.maxZoom;){const pe=this.getChildren(K);if(se++,pe.length!==1)break;K=pe[0].properties.cluster_id}return se}_appendLeaves(K,se,pe,Me,Ce){const Ee=this.getChildren(se);for(const Ye of Ee){const De=Ye.properties;if(De&&De.cluster?Ce+De.point_count<=Me?Ce+=De.point_count:Ce=this._appendLeaves(K,De.cluster_id,pe,Me,Ce):Ce<Me?Ce++:K.push(Ye),K.length===pe)break}return Ce}_createTree(K){const se=new r.c3(K.length/this.stride|0,this.options.nodeSize,Float32Array);for(let pe=0;pe<K.length;pe+=this.stride)se.add(K[pe],K[pe+1]);return se.finish(),se.data=K,se}_addTileFeatures(K,se,pe,Me,Ce,Ee){for(const Ye of K){const De=Ye*this.stride,Ze=se[De+mr]>1;let wt,lt,Zt;if(Ze)wt=ws(se,De,this.clusterProps),lt=se[De],Zt=se[De+1];else{const Ri=this.points[se[De+zi]];wt=Ri.properties;const[Li,Bi]=Ri.geometry.coordinates;lt=_s(Li),Zt=jr(Bi)}const ni={type:1,geometry:[[Math.round(this.options.extent*(lt*Ce-pe)),Math.round(this.options.extent*(Zt*Ce-Me))]],tags:wt};let ci;ci=Ze||this.options.generateId?se[De+zi]:this.points[se[De+zi]].id,ci!==void 0&&(ni.id=ci),Ee.features.push(ni)}}_limitZoom(K){return Math.max(this.options.minZoom,Math.min(Math.floor(+K),this.options.maxZoom+1))}_cluster(K,se){const{radius:pe,extent:Me,reduce:Ce,minPoints:Ee}=this.options,Ye=pe/(Me*Math.pow(2,se)),De=K.data,Ze=[],wt=this.stride;for(let lt=0;lt<De.length;lt+=wt){if(De[lt+2]<=se)continue;De[lt+2]=se;const Zt=De[lt],ni=De[lt+1],ci=K.within(De[lt],De[lt+1],Ye),Ri=De[lt+mr];let Li=Ri;for(const Bi of ci){const fr=Bi*wt;De[fr+2]>se&&(Li+=De[fr+mr])}if(Li>Ri&&Li>=Ee){let Bi,fr=Zt*Ri,Di=ni*Ri,Yr=-1;const os=(lt/wt<<5)+(se+1)+this.points.length;for(const ls of ci){const dr=ls*wt;if(De[dr+2]<=se)continue;De[dr+2]=se;const Ki=De[dr+mr];fr+=De[dr]*Ki,Di+=De[dr+1]*Ki,De[dr+4]=os,Ce&&(Bi||(Bi=this._map(De,lt,!0),Yr=this.clusterProps.length,this.clusterProps.push(Bi)),Ce(Bi,this._map(De,dr)))}De[lt+4]=os,Ze.push(fr/Li,Di/Li,1/0,os,-1,Li),Ce&&Ze.push(Yr)}else{for(let Bi=0;Bi<wt;Bi++)Ze.push(De[lt+Bi]);if(Li>1)for(const Bi of ci){const fr=Bi*wt;if(!(De[fr+2]<=se)){De[fr+2]=se;for(let Di=0;Di<wt;Di++)Ze.push(De[fr+Di])}}}}return Ze}_getOriginId(K){return K-this.points.length>>5}_getOriginZoom(K){return(K-this.points.length)%32}_map(K,se,pe){if(K[se+mr]>1){const Ee=this.clusterProps[K[se+Wi]];return pe?Object.assign({},Ee):Ee}const Me=this.points[K[se+zi]].properties,Ce=this.options.map(Me);return pe&&Ce===Me?Object.assign({},Ce):Ce}}function nn(Oe,K,se){return{type:"Feature",id:Oe[K+zi],properties:ws(Oe,K,se),geometry:{type:"Point",coordinates:[(pe=Oe[K],360*(pe-.5)),Gl(Oe[K+1])]}};var pe}function ws(Oe,K,se){const pe=Oe[K+mr],Me=pe>=1e4?`${Math.round(pe/1e3)}k`:pe>=1e3?Math.round(pe/100)/10+"k":pe,Ce=Oe[K+Wi],Ee=Ce===-1?{}:Object.assign({},se[Ce]);return Object.assign(Ee,{cluster:!0,cluster_id:Oe[K+zi],point_count:pe,point_count_abbreviated:Me})}function _s(Oe){return Oe/360+.5}function jr(Oe){const K=Math.sin(Oe*Math.PI/180),se=.5-.25*Math.log((1+K)/(1-K))/Math.PI;return se<0?0:se>1?1:se}function Gl(Oe){const K=(180-360*Oe)*Math.PI/180;return 360*Math.atan(Math.exp(K))/Math.PI-90}function Oa(Oe,K,se,pe){let Me=pe;const Ce=K+(se-K>>1);let Ee,Ye=se-K;const De=Oe[K],Ze=Oe[K+1],wt=Oe[se],lt=Oe[se+1];for(let Zt=K+3;Zt<se;Zt+=3){const ni=Xl(Oe[Zt],Oe[Zt+1],De,Ze,wt,lt);if(ni>Me)Ee=Zt,Me=ni;else if(ni===Me){const ci=Math.abs(Zt-Ce);ci<Ye&&(Ee=Zt,Ye=ci)}}Me>pe&&(Ee-K>3&&Oa(Oe,K,Ee,pe),Oe[Ee+2]=Me,se-Ee>3&&Oa(Oe,Ee,se,pe))}function Xl(Oe,K,se,pe,Me,Ce){let Ee=Me-se,Ye=Ce-pe;if(Ee!==0||Ye!==0){const De=((Oe-se)*Ee+(K-pe)*Ye)/(Ee*Ee+Ye*Ye);De>1?(se=Me,pe=Ce):De>0&&(se+=Ee*De,pe+=Ye*De)}return Ee=Oe-se,Ye=K-pe,Ee*Ee+Ye*Ye}function $s(Oe,K,se,pe){const Me={id:Oe!=null?Oe:null,type:K,geometry:se,tags:pe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(K==="Point"||K==="MultiPoint"||K==="LineString")Fa(Me,se);else if(K==="Polygon")Fa(Me,se[0]);else if(K==="MultiLineString")for(const Ce of se)Fa(Me,Ce);else if(K==="MultiPolygon")for(const Ce of se)Fa(Me,Ce[0]);return Me}function Fa(Oe,K){for(let se=0;se<K.length;se+=3)Oe.minX=Math.min(Oe.minX,K[se]),Oe.minY=Math.min(Oe.minY,K[se+1]),Oe.maxX=Math.max(Oe.maxX,K[se]),Oe.maxY=Math.max(Oe.maxY,K[se+1])}function an(Oe,K,se,pe){if(!K.geometry)return;const Me=K.geometry.coordinates;if(Me&&Me.length===0)return;const Ce=K.geometry.type,Ee=Math.pow(se.tolerance/((1<<se.maxZoom)*se.extent),2);let Ye=[],De=K.id;if(se.promoteId?De=K.properties[se.promoteId]:se.generateId&&(De=pe||0),Ce==="Point")pa(Me,Ye);else if(Ce==="MultiPoint")for(const Ze of Me)pa(Ze,Ye);else if(Ce==="LineString")ga(Me,Ye,Ee,!1);else if(Ce==="MultiLineString"){if(se.lineMetrics){for(const Ze of Me)Ye=[],ga(Ze,Ye,Ee,!1),Oe.push($s(De,"LineString",Ye,K.properties));return}fo(Me,Ye,Ee,!1)}else if(Ce==="Polygon")fo(Me,Ye,Ee,!0);else{if(Ce!=="MultiPolygon"){if(Ce==="GeometryCollection"){for(const Ze of K.geometry.geometries)an(Oe,{id:De,geometry:Ze,properties:K.properties},se,pe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Ze of Me){const wt=[];fo(Ze,wt,Ee,!0),Ye.push(wt)}}Oe.push($s(De,Ce,Ye,K.properties))}function pa(Oe,K){K.push(po(Oe[0]),Js(Oe[1]),0)}function ga(Oe,K,se,pe){let Me,Ce,Ee=0;for(let De=0;De<Oe.length;De++){const Ze=po(Oe[De][0]),wt=Js(Oe[De][1]);K.push(Ze,wt,0),De>0&&(Ee+=pe?(Me*wt-Ze*Ce)/2:Math.sqrt(Math.pow(Ze-Me,2)+Math.pow(wt-Ce,2))),Me=Ze,Ce=wt}const Ye=K.length-3;K[2]=1,Oa(K,0,Ye,se),K[Ye+2]=1,K.size=Math.abs(Ee),K.start=0,K.end=K.size}function fo(Oe,K,se,pe){for(let Me=0;Me<Oe.length;Me++){const Ce=[];ga(Oe[Me],Ce,se,pe),K.push(Ce)}}function po(Oe){return Oe/360+.5}function Js(Oe){const K=Math.sin(Oe*Math.PI/180),se=.5-.25*Math.log((1+K)/(1-K))/Math.PI;return se<0?0:se>1?1:se}function fn(Oe,K,se,pe,Me,Ce,Ee,Ye){if(pe/=K,Ce>=(se/=K)&&Ee<pe)return Oe;if(Ee<se||Ce>=pe)return null;const De=[];for(const Ze of Oe){const wt=Ze.geometry;let lt=Ze.type;const Zt=Me===0?Ze.minX:Ze.minY,ni=Me===0?Ze.maxX:Ze.maxY;if(Zt>=se&&ni<pe){De.push(Ze);continue}if(ni<se||Zt>=pe)continue;let ci=[];if(lt==="Point"||lt==="MultiPoint")Yl(wt,ci,se,pe,Me);else if(lt==="LineString")ma(wt,ci,se,pe,Me,!1,Ye.lineMetrics);else if(lt==="MultiLineString")ks(wt,ci,se,pe,Me,!1);else if(lt==="Polygon")ks(wt,ci,se,pe,Me,!0);else if(lt==="MultiPolygon")for(const Ri of wt){const Li=[];ks(Ri,Li,se,pe,Me,!0),Li.length&&ci.push(Li)}if(ci.length){if(Ye.lineMetrics&&lt==="LineString"){for(const Ri of ci)De.push($s(Ze.id,lt,Ri,Ze.tags));continue}lt!=="LineString"&&lt!=="MultiLineString"||(ci.length===1?(lt="LineString",ci=ci[0]):lt="MultiLineString"),lt!=="Point"&&lt!=="MultiPoint"||(lt=ci.length===3?"Point":"MultiPoint"),De.push($s(Ze.id,lt,ci,Ze.tags))}}return De.length?De:null}function Yl(Oe,K,se,pe,Me){for(let Ce=0;Ce<Oe.length;Ce+=3){const Ee=Oe[Ce+Me];Ee>=se&&Ee<=pe&&Dn(K,Oe[Ce],Oe[Ce+1],Oe[Ce+2])}}function ma(Oe,K,se,pe,Me,Ce,Ee){let Ye=Yo(Oe);const De=Me===0?ql:Ba;let Ze,wt,lt=Oe.start;for(let Li=0;Li<Oe.length-3;Li+=3){const Bi=Oe[Li],fr=Oe[Li+1],Di=Oe[Li+2],Yr=Oe[Li+3],os=Oe[Li+4],ls=Me===0?Bi:fr,dr=Me===0?Yr:os;let Ki=!1;Ee&&(Ze=Math.sqrt(Math.pow(Bi-Yr,2)+Math.pow(fr-os,2))),ls<se?dr>se&&(wt=De(Ye,Bi,fr,Yr,os,se),Ee&&(Ye.start=lt+Ze*wt)):ls>pe?dr<pe&&(wt=De(Ye,Bi,fr,Yr,os,pe),Ee&&(Ye.start=lt+Ze*wt)):Dn(Ye,Bi,fr,Di),dr<se&&ls>=se&&(wt=De(Ye,Bi,fr,Yr,os,se),Ki=!0),dr>pe&&ls<=pe&&(wt=De(Ye,Bi,fr,Yr,os,pe),Ki=!0),!Ce&&Ki&&(Ee&&(Ye.end=lt+Ze*wt),K.push(Ye),Ye=Yo(Oe)),Ee&&(lt+=Ze)}let Zt=Oe.length-3;const ni=Oe[Zt],ci=Oe[Zt+1],Ri=Me===0?ni:ci;Ri>=se&&Ri<=pe&&Dn(Ye,ni,ci,Oe[Zt+2]),Zt=Ye.length-3,Ce&&Zt>=3&&(Ye[Zt]!==Ye[0]||Ye[Zt+1]!==Ye[1])&&Dn(Ye,Ye[0],Ye[1],Ye[2]),Ye.length&&K.push(Ye)}function Yo(Oe){const K=[];return K.size=Oe.size,K.start=Oe.start,K.end=Oe.end,K}function ks(Oe,K,se,pe,Me,Ce){for(const Ee of Oe)ma(Ee,K,se,pe,Me,Ce,!1)}function Dn(Oe,K,se,pe){Oe.push(K,se,pe)}function ql(Oe,K,se,pe,Me,Ce){const Ee=(Ce-K)/(pe-K);return Dn(Oe,Ce,se+(Me-se)*Ee,1),Ee}function Ba(Oe,K,se,pe,Me,Ce){const Ee=(Ce-se)/(Me-se);return Dn(Oe,K+(pe-K)*Ee,Ce,1),Ee}function Jn(Oe,K){const se=[];for(let pe=0;pe<Oe.length;pe++){const Me=Oe[pe],Ce=Me.type;let Ee;if(Ce==="Point"||Ce==="MultiPoint"||Ce==="LineString")Ee=_a(Me.geometry,K);else if(Ce==="MultiLineString"||Ce==="Polygon"){Ee=[];for(const Ye of Me.geometry)Ee.push(_a(Ye,K))}else if(Ce==="MultiPolygon"){Ee=[];for(const Ye of Me.geometry){const De=[];for(const Ze of Ye)De.push(_a(Ze,K));Ee.push(De)}}se.push($s(Me.id,Ce,Ee,Me.tags))}return se}function _a(Oe,K){const se=[];se.size=Oe.size,Oe.start!==void 0&&(se.start=Oe.start,se.end=Oe.end);for(let pe=0;pe<Oe.length;pe+=3)se.push(Oe[pe]+K,Oe[pe+1],Oe[pe+2]);return se}function go(Oe,K){if(Oe.transformed)return Oe;const se=1<<Oe.z,pe=Oe.x,Me=Oe.y;for(const Ce of Oe.features){const Ee=Ce.geometry,Ye=Ce.type;if(Ce.geometry=[],Ye===1)for(let De=0;De<Ee.length;De+=2)Ce.geometry.push(Dr(Ee[De],Ee[De+1],K,se,pe,Me));else for(let De=0;De<Ee.length;De++){const Ze=[];for(let wt=0;wt<Ee[De].length;wt+=2)Ze.push(Dr(Ee[De][wt],Ee[De][wt+1],K,se,pe,Me));Ce.geometry.push(Ze)}}return Oe.transformed=!0,Oe}function Dr(Oe,K,se,pe,Me,Ce){return[Math.round(se*(Oe*pe-Me)),Math.round(se*(K*pe-Ce))]}function As(Oe,K,se,pe,Me){const Ce=K===Me.maxZoom?0:Me.tolerance/((1<<K)*Me.extent),Ee={features:[],numPoints:0,numSimplified:0,numFeatures:Oe.length,source:null,x:se,y:pe,z:K,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Ye of Oe)Zl(Ee,Ye,Ce,Me);return Ee}function Zl(Oe,K,se,pe){const Me=K.geometry,Ce=K.type,Ee=[];if(Oe.minX=Math.min(Oe.minX,K.minX),Oe.minY=Math.min(Oe.minY,K.minY),Oe.maxX=Math.max(Oe.maxX,K.maxX),Oe.maxY=Math.max(Oe.maxY,K.maxY),Ce==="Point"||Ce==="MultiPoint")for(let Ye=0;Ye<Me.length;Ye+=3)Ee.push(Me[Ye],Me[Ye+1]),Oe.numPoints++,Oe.numSimplified++;else if(Ce==="LineString")mo(Ee,Me,Oe,se,!1,!1);else if(Ce==="MultiLineString"||Ce==="Polygon")for(let Ye=0;Ye<Me.length;Ye++)mo(Ee,Me[Ye],Oe,se,Ce==="Polygon",Ye===0);else if(Ce==="MultiPolygon")for(let Ye=0;Ye<Me.length;Ye++){const De=Me[Ye];for(let Ze=0;Ze<De.length;Ze++)mo(Ee,De[Ze],Oe,se,!0,Ze===0)}if(Ee.length){let Ye=K.tags||null;if(Ce==="LineString"&&pe.lineMetrics){Ye={};for(const Ze in K.tags)Ye[Ze]=K.tags[Ze];Ye.mapbox_clip_start=Me.start/Me.size,Ye.mapbox_clip_end=Me.end/Me.size}const De={geometry:Ee,type:Ce==="Polygon"||Ce==="MultiPolygon"?3:Ce==="LineString"||Ce==="MultiLineString"?2:1,tags:Ye};K.id!==null&&(De.id=K.id),Oe.features.push(De)}}function mo(Oe,K,se,pe,Me,Ce){const Ee=pe*pe;if(pe>0&&K.size<(Me?Ee:pe))return void(se.numPoints+=K.length/3);const Ye=[];for(let De=0;De<K.length;De+=3)(pe===0||K[De+2]>Ee)&&(se.numSimplified++,Ye.push(K[De],K[De+1])),se.numPoints++;Me&&function(De,Ze){let wt=0;for(let lt=0,Zt=De.length,ni=Zt-2;lt<Zt;ni=lt,lt+=2)wt+=(De[lt]-De[ni])*(De[lt+1]+De[ni+1]);if(wt>0===Ze)for(let lt=0,Zt=De.length;lt<Zt/2;lt+=2){const ni=De[lt],ci=De[lt+1];De[lt]=De[Zt-2-lt],De[lt+1]=De[Zt-1-lt],De[Zt-2-lt]=ni,De[Zt-1-lt]=ci}}(Ye,Ce),Oe.push(Ye)}const On={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class $l{constructor(K,se){const pe=(se=this.options=function(Ce,Ee){for(const Ye in Ee)Ce[Ye]=Ee[Ye];return Ce}(Object.create(On),se)).debug;if(pe&&console.time("preprocess data"),se.maxZoom<0||se.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(se.promoteId&&se.generateId)throw new Error("promoteId and generateId cannot be used together.");let Me=function(Ce,Ee){const Ye=[];if(Ce.type==="FeatureCollection")for(let De=0;De<Ce.features.length;De++)an(Ye,Ce.features[De],Ee,De);else an(Ye,Ce.type==="Feature"?Ce:{geometry:Ce},Ee);return Ye}(K,se);this.tiles={},this.tileCoords=[],pe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",se.indexMaxZoom,se.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Me=function(Ce,Ee){const Ye=Ee.buffer/Ee.extent;let De=Ce;const Ze=fn(Ce,1,-1-Ye,Ye,0,-1,2,Ee),wt=fn(Ce,1,1-Ye,2+Ye,0,-1,2,Ee);return(Ze||wt)&&(De=fn(Ce,1,-Ye,1+Ye,0,-1,2,Ee)||[],Ze&&(De=Jn(Ze,1).concat(De)),wt&&(De=De.concat(Jn(wt,-1)))),De}(Me,se),Me.length&&this.splitTile(Me,0,0,0),pe&&(Me.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(K,se,pe,Me,Ce,Ee,Ye){const De=[K,se,pe,Me],Ze=this.options,wt=Ze.debug;for(;De.length;){Me=De.pop(),pe=De.pop(),se=De.pop(),K=De.pop();const lt=1<<se,Zt=Jl(se,pe,Me);let ni=this.tiles[Zt];if(!ni&&(wt>1&&console.time("creation"),ni=this.tiles[Zt]=As(K,se,pe,Me,Ze),this.tileCoords.push({z:se,x:pe,y:Me}),wt)){wt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",se,pe,Me,ni.numFeatures,ni.numPoints,ni.numSimplified),console.timeEnd("creation"));const Ki=`z${se}`;this.stats[Ki]=(this.stats[Ki]||0)+1,this.total++}if(ni.source=K,Ce==null){if(se===Ze.indexMaxZoom||ni.numPoints<=Ze.indexMaxPoints)continue}else{if(se===Ze.maxZoom||se===Ce)continue;if(Ce!=null){const Ki=Ce-se;if(pe!==Ee>>Ki||Me!==Ye>>Ki)continue}}if(ni.source=null,K.length===0)continue;wt>1&&console.time("clipping");const ci=.5*Ze.buffer/Ze.extent,Ri=.5-ci,Li=.5+ci,Bi=1+ci;let fr=null,Di=null,Yr=null,os=null,ls=fn(K,lt,pe-ci,pe+Li,0,ni.minX,ni.maxX,Ze),dr=fn(K,lt,pe+Ri,pe+Bi,0,ni.minX,ni.maxX,Ze);K=null,ls&&(fr=fn(ls,lt,Me-ci,Me+Li,1,ni.minY,ni.maxY,Ze),Di=fn(ls,lt,Me+Ri,Me+Bi,1,ni.minY,ni.maxY,Ze),ls=null),dr&&(Yr=fn(dr,lt,Me-ci,Me+Li,1,ni.minY,ni.maxY,Ze),os=fn(dr,lt,Me+Ri,Me+Bi,1,ni.minY,ni.maxY,Ze),dr=null),wt>1&&console.timeEnd("clipping"),De.push(fr||[],se+1,2*pe,2*Me),De.push(Di||[],se+1,2*pe,2*Me+1),De.push(Yr||[],se+1,2*pe+1,2*Me),De.push(os||[],se+1,2*pe+1,2*Me+1)}}getTile(K,se,pe){K=+K,se=+se,pe=+pe;const Me=this.options,{extent:Ce,debug:Ee}=Me;if(K<0||K>24)return null;const Ye=1<<K,De=Jl(K,se=se+Ye&Ye-1,pe);if(this.tiles[De])return go(this.tiles[De],Ce);Ee>1&&console.log("drilling down to z%d-%d-%d",K,se,pe);let Ze,wt=K,lt=se,Zt=pe;for(;!Ze&&wt>0;)wt--,lt>>=1,Zt>>=1,Ze=this.tiles[Jl(wt,lt,Zt)];return Ze&&Ze.source?(Ee>1&&(console.log("found parent tile z%d-%d-%d",wt,lt,Zt),console.time("drilling down")),this.splitTile(Ze.source,wt,lt,Zt,K,se,pe),Ee>1&&console.timeEnd("drilling down"),this.tiles[De]?go(this.tiles[De],Ce):null):null}}function Jl(Oe,K,se){return 32*((1<<Oe)*se+K)+Oe}function eh(Oe,K){const se=Oe.tileID.canonical;if(!this._geoJSONIndex)return void K(null,null);const pe=this._geoJSONIndex.getTile(se.z,se.x,se.y);if(!pe)return void K(null,null);const Me=Ze=>Ze.tags&&"3d_elevation_id"in Ze.tags&&"source"in Ze.tags&&Ze.tags.source==="elevation",Ce=pe.features.filter(Ze=>Me(Ze));let Ee={_geojsonTileLayer:pe.features};Ce.length>0&&(Ee={_geojsonTileLayer:pe.features.filter(Ze=>!Me(Ze)),hd_road_elevation:Ce});const Ye=new Se(Ee),De=function(Ze){const wt=new r.bt;for(const lt of Object.keys(Ze))wt.writeMessage(3,ui,{name:lt,features:Ze[lt]});return wt.finish()}(Ee).buffer;K(null,{vectorTile:Ye,rawData:De})}class mt extends Q{constructor(K,se,pe,Me,Ce,Ee,Ye){super(K,se,pe,Me,Ce,eh,Ye),Ee&&(this.loadGeoJSON=Ee),this._dynamicIndex=new Ke}loadData(K,se){const pe=K&&K.request,Me=pe&&pe.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(K,(Ce,Ee)=>{if(Ce||!Ee)return se(Ce);if(typeof Ee!="object")return se(new Error(`Input data given to '${K.source}' is not a valid GeoJSON object.`));{try{if(K.filter){const De=r.U(K.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(De.result==="error")throw new Error(De.value.map(Ze=>`${Ze.key}: ${Ze.message}`).join(", "));Ee.features=Ee.features.filter(Ze=>De.value.evaluate({zoom:0},Ze))}K.dynamic?(Ee.type==="Feature"&&(Ee={type:"FeatureCollection",features:[Ee]}),K.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Ee.features,this.loaded),K.cluster&&(Ee.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=K.cluster?new ns(function({superclusterOptions:De,clusterProperties:Ze}){if(!Ze||!De)return De;const wt={},lt={},Zt={accumulated:null,zoom:0},ni={properties:null},ci=Object.keys(Ze);for(const Ri of ci){const[Li,Bi]=Ze[Ri],fr=r.U(Bi),Di=r.U(typeof Li=="string"?[Li,["accumulated"],["get",Ri]]:Li);wt[Ri]=fr.value,lt[Ri]=Di.value}return De.map=Ri=>{ni.properties=Ri;const Li={};for(const Bi of ci)Li[Bi]=wt[Bi].evaluate(Zt,ni);return Li},De.reduce=(Ri,Li)=>{ni.properties=Li;for(const Bi of ci)Zt.accumulated=Ri[Bi],Ri[Bi]=lt[Bi].evaluate(Zt,ni)},De}(K)).load(Ee.features):K.dynamic?this._dynamicIndex:function(De,Ze){return new $l(De,Ze)}(Ee,K.geojsonVtOptions)}catch(De){return se(De)}const Ye={};if(Me){const De=E(pe);De&&(Ye.resourceTiming={},Ye.resourceTiming[K.source]=JSON.parse(JSON.stringify(De)))}se(null,Ye)}})}reloadTile(K,se){const pe=this.loaded;return pe&&pe[K.uid]?K.partial?se(null,void 0):super.reloadTile(K,se):this.loadTile(K,se)}loadGeoJSON(K,se){if(K.request)r.m(K.request,se);else{if(typeof K.data!="string")return se(new Error(`Input data given to '${K.source}' is not a valid GeoJSON object.`));setTimeout(()=>{try{return se(null,JSON.parse(K.data))}catch{return se(new Error(`Input data given to '${K.source}' is not a valid GeoJSON object.`))}},0)}}getClusterExpansionZoom(K,se){try{se(null,this._geoJSONIndex.getClusterExpansionZoom(K.clusterId))}catch(pe){se(pe)}}getClusterChildren(K,se){try{se(null,this._geoJSONIndex.getChildren(K.clusterId))}catch(pe){se(pe)}}getClusterLeaves(K,se){try{se(null,this._geoJSONIndex.getLeaves(K.clusterId,K.limit,K.offset))}catch(pe){se(pe)}}}class ya{constructor(K,se,pe){this.tileID=new r.aO(K.tileID.overscaledZ,K.tileID.wrap,K.tileID.canonical.z,K.tileID.canonical.x,K.tileID.canonical.y),this.tileZoom=K.tileZoom,this.uid=K.uid,this.zoom=K.zoom,this.canonical=K.tileID.canonical,this.pixelRatio=K.pixelRatio,this.tileSize=K.tileSize,this.source=K.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=K.projection,this.brightness=se,this.worldview=pe}parse(K,se,pe,Me){this.status="parsing";const Ce=new r.aO(pe.tileID.overscaledZ,pe.tileID.wrap,pe.tileID.canonical.z,pe.tileID.canonical.x,pe.tileID.canonical.y),Ee=[],Ye=se.familiesBySource[pe.source],De=new r.fe(Ce,pe.promoteId);De.bucketLayerIDs=[],De.is3DTile=!0,r.ft(K).then(Ze=>{if(!Ze)return Me(new Error("Could not parse tile"));const wt=Ze.json.extensionsUsed&&Ze.json.extensionsUsed.includes("MAPBOX_mesh_features")||Ze.json.asset.extras&&Ze.json.asset.extras.MAPBOX_mesh_features,lt=Ze.json.extensionsUsed&&Ze.json.extensionsUsed.includes("EXT_meshopt_compression"),Zt=new r.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const ni in Ye)for(const ci of Ye[ni]){const Ri=ci[0];De.bucketLayerIDs.push(ci.map(fr=>r.B(fr.id,fr.scope))),Ri.recalculate(Zt,[]);const Li=r.fu(Ze,1/r.d6(pe.tileID.canonical)),Bi=new r.fv(ci,Li,Ce,wt,lt,this.brightness,De,this.worldview);wt||(Bi.needsUpload=!0),Ee.push(Bi),Bi.evaluate(Ri)}this.status="done",Me(null,{buckets:Ee,featureIndex:De,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(Ze=>Me(new Error(Ze.message)))}}class Wu{constructor(K,se,pe,Me,Ce,Ee,Ye,De){this.actor=K,this.layerIndex=se,this.availableImages=pe,this.availableModels=Me,this.brightness=Ye,this.loading={},this.loaded={},this.worldview=De}loadTile(K,se){const pe=K.uid,Me=this.loading[pe]=new ya(K,this.brightness,this.worldview);r.bu(K.request,(Ce,Ee)=>{const Ye=!this.loading[pe];return delete this.loading[pe],Ye||Ce?(Me.status="done",Ye||(this.loaded[pe]=Me),se(Ce)):Ee&&Ee.byteLength!==0?void Me.parse(Ee,this.layerIndex,K,(De,Ze)=>{Me.status="done",this.loaded=this.loaded||{},this.loaded[pe]=Me,De||!Ze?se(De):se(null,Ze)}):(Me.status="done",this.loaded[pe]=Me,se())})}reloadTile(K,se){const pe=this.loaded,Me=K.uid;if(pe&&pe[Me]){const Ce=pe[Me];Ce.projection=K.projection,Ce.brightness=K.brightness;const Ee=(Ye,De)=>{Ce.reloadCallback&&(delete Ce.reloadCallback,this.loadTile(K,se)),se(Ye,De)};Ce.status==="parsing"?Ce.reloadCallback=Ee:Ce.status==="done"&&this.loadTile(K,se)}}abortTile(K,se){const pe=K.uid;this.loading[pe]&&delete this.loading[pe],se()}removeTile(K,se){const pe=this.loaded,Me=K.uid;pe&&pe[Me]&&delete pe[Me],se()}}class qo{constructor(K){this.self=K,this.actor=new r.fx(K,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new r.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=r.cl({name:"mercator"}),this.workerSourceTypes={vector:Q,geojson:mt,"raster-dem":ee,"raster-array":ue,"batched-model":Wu},this.workerSources={},this.self.registerWorkerSource=(se,pe)=>{if(this.workerSourceTypes[se])throw new Error(`Worker source with name "${se}" already registered.`);this.workerSourceTypes[se]=pe},this.self.registerRTLTextPlugin=se=>{if(r.fy.isParsed())throw new Error("RTL text plugin already registered.");r.fy.setState({pluginStatus:r.fz.parsed,pluginURL:r.fy.getPluginURL()}),r.fy.applyArabicShaping=se.applyArabicShaping,r.fy.processBidirectionalText=se.processBidirectionalText,r.fy.processStyledBidirectionalText=se.processStyledBidirectionalText;for(const pe of this.rtlPluginParsingListeners)pe(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(K,se,pe){delete this.layerIndexes[K],delete this.availableImages[K],delete this.availableModels[K],delete this.workerSources[K],pe()}checkIfReady(K,se,pe){pe()}setReferrer(K,se){this.referrer=se}spriteLoaded(K,se){this.isSpriteLoaded[K]||(this.isSpriteLoaded[K]={});const{scope:pe,isLoaded:Me}=se;if(this.isSpriteLoaded[K][pe]=Me,this.workerSources[K]&&this.workerSources[K][pe])for(const Ce in this.workerSources[K][pe]){const Ee=this.workerSources[K][pe][Ce];for(const Ye in Ee){const De=Ee[Ye];De instanceof Q&&(De.isSpriteLoaded=Me,De.fire(new r.z("isSpriteLoaded")))}}}setImages(K,se,pe){this.availableImages[K]||(this.availableImages[K]={});const{scope:Me,images:Ce}=se;if(this.availableImages[K][Me]=Ce,this.workerSources[K]&&this.workerSources[K][Me]){for(const Ee in this.workerSources[K][Me]){const Ye=this.workerSources[K][Me][Ee];for(const De in Ye)Ye[De].availableImages=Ce}pe()}else pe()}setModels(K,{scope:se,models:pe},Me){if(this.availableModels[K]||(this.availableModels[K]={}),this.availableModels[K][se]=pe,this.workerSources[K]&&this.workerSources[K][se]){for(const Ce in this.workerSources[K][se]){const Ee=this.workerSources[K][se][Ce];for(const Ye in Ee)Ee[Ye].availableModels=pe}Me()}else Me()}setProjection(K,se){this.projections[K]=r.cl(se)}setBrightness(K,se,pe){this.brightness=se,pe()}setWorldview(K,se,pe){this.worldview=se,pe()}setLayers(K,se,pe){this.getLayerIndex(K,se.scope).replace(se.layers,se.options),pe()}updateLayers(K,se,pe){this.getLayerIndex(K,se.scope).update(se.layers,se.removedIds,se.options),pe()}loadTile(K,se,pe){se.projection=this.projections[K]||this.defaultProjection,this.getWorkerSource(K,se.type,se.source,se.scope).loadTile(se,pe)}decodeRasterArray(K,se,pe){this.getWorkerSource(K,se.type,se.source,se.scope).decodeRasterArray(se,pe)}reloadTile(K,se,pe){se.projection=this.projections[K]||this.defaultProjection,this.getWorkerSource(K,se.type,se.source,se.scope).reloadTile(se,pe)}abortTile(K,se,pe){this.getWorkerSource(K,se.type,se.source,se.scope).abortTile(se,pe)}removeTile(K,se,pe){this.getWorkerSource(K,se.type,se.source,se.scope).removeTile(se,pe)}removeSource(K,se,pe){if(!(this.workerSources[K]&&this.workerSources[K][se.scope]&&this.workerSources[K][se.scope][se.type]&&this.workerSources[K][se.scope][se.type][se.source]))return;const Me=this.workerSources[K][se.scope][se.type][se.source];delete this.workerSources[K][se.scope][se.type][se.source],Me.removeSource!==void 0?Me.removeSource(se,pe):pe()}loadWorkerSource(K,se,pe){try{this.self.importScripts(se.url),pe()}catch(Me){pe(Me.toString())}}syncRTLPluginState(K,se,pe){if(r.fy.isParsed())pe(null,!0);else if(r.fy.isParsing())this.rtlPluginParsingListeners.push(pe);else try{r.fy.setState(se);const Me=r.fy.getPluginURL();!r.fy.isLoaded()||r.fy.isParsed()||r.fy.isParsing()||Me==null||(r.fy.setState({pluginStatus:r.fz.parsing,pluginURL:r.fy.getPluginURL()}),this.self.importScripts(Me),r.fy.isParsed()?pe(null,!0):this.rtlPluginParsingListeners.push(pe))}catch(Me){pe(Me.toString())}}setDracoUrl(K,se){this.dracoUrl=se}getAvailableImages(K,se){this.availableImages[K]||(this.availableImages[K]={});let pe=this.availableImages[K][se];return pe||(pe=[]),pe}getAvailableModels(K,se){this.availableModels[K]||(this.availableModels[K]={});let pe=this.availableModels[K][se];return pe||(pe={}),pe}getLayerIndex(K,se){this.layerIndexes[K]||(this.layerIndexes[K]={});let pe=this.layerIndexes[K][se];return pe||(pe=this.layerIndexes[K][se]=new L,pe.scope=se),pe}getWorkerSource(K,se,pe,Me){const Ce=this.workerSources;return Ce[K]||(Ce[K]={}),Ce[K][Me]||(Ce[K][Me]={}),Ce[K][Me][se]||(Ce[K][Me][se]={}),this.isSpriteLoaded[K]||(this.isSpriteLoaded[K]={}),Ce[K][Me][se][pe]||(Ce[K][Me][se][pe]=new this.workerSourceTypes[se]({send:(Ee,Ye,De,Ze,wt,lt)=>this.actor.send(Ee,Ye,De,K,wt,lt),scheduler:this.actor.scheduler},this.getLayerIndex(K,Me),this.getAvailableImages(K,Me),this.getAvailableModels(K,Me),this.isSpriteLoaded[K][Me],void 0,this.brightness,this.worldview)),Ce[K][Me][se][pe]}rasterizeImagesWorker(K,se,pe){const Me=new Map;for(const[Ce,{image:Ee,imageVariant:Ye}]of se.tasks.entries()){const De=this.imageRasterizer.rasterize(Ye,Ee,se.scope,K);Me.set(Ce,De)}pe(void 0,Me)}removeRasterizedImages(K,se,pe){this.imageRasterizer.removeImagesFromCacheByIds(se.imageIds,se.scope,K),pe()}enforceCacheSizeLimit(K,se){r.fA(se)}getWorkerPerformanceMetrics(K,se,pe){pe(void 0,void 0)}}return r.fw(self)&&(self.worker=new qo(self)),qo}),_(["./shared"],function(r){var E="3.15.0";const k={create:"create",load:"load",fullLoad:"fullLoad"},P={mark(d){performance.mark(d)},measure(d,i,o){performance.measure(d,i,o)}};function L(d){const i=d.name.split("?")[0];return r.a(i)&&i.includes("mapbox-gl.js")?"javascript":r.a(i)&&i.includes("mapbox-gl.css")?"css":r.b(i)?"fontRange":r.c(i)?"sprite":r.i(i)?"style":r.d(i)?"tilejson":"other"}var O,N={},G=function(){if(O)return N;function d(u){return!i(u)}function i(u){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var y,b,A=new Blob([""],{type:"text/javascript"}),C=URL.createObjectURL(A);try{b=new Worker(C),y=!0}catch{y=!1}return b&&b.terminate(),URL.revokeObjectURL(C),y}()?function(){var y=document.createElement("canvas");y.width=y.height=1;var b=y.getContext("2d");if(!b)return!1;var A=b.getImageData(0,0,1,1);return A&&A.width===y.width}()?(o[m=u&&u.failIfMajorPerformanceCaveat]===void 0&&(o[m]=function(y){var b,A=function(C){var z=document.createElement("canvas"),D=Object.create(d.webGLContextAttributes);return D.failIfMajorPerformanceCaveat=C,z.getContext("webgl2",D)}(y);if(!A)return!1;try{b=A.createShader(A.VERTEX_SHADER)}catch{return!1}return!(!b||A.isContextLost())&&(A.shaderSource(b,"void main() {}"),A.compileShader(b),A.getShaderParameter(b,A.COMPILE_STATUS)===!0)}(m)),o[m]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var m}O=1,N.supported=d,N.notSupportedReason=i;var o={};return d.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},N}();function H(d,i,o){const u=document.createElement(d);return i!=null&&(u.className=i),o&&o.appendChild(u),u}function Q(d,i,o){const u=document.createElementNS("http://www.w3.org/2000/svg",d);for(const m of Object.keys(i))u.setAttributeNS(null,m,String(i[m]));return o&&o.appendChild(u),u}const ee=typeof document<"u"?document.documentElement&&document.documentElement.style:null,ie=ee&&ee.userSelect!==void 0?"userSelect":"WebkitUserSelect";let ue;function ve(){ee&&ie&&(ue=ee[ie],ee[ie]="none")}function ce(){ee&&ie&&(ee[ie]=ue)}function Te(d){d.preventDefault(),d.stopPropagation(),window.removeEventListener("click",Te,!0)}function Se(){window.addEventListener("click",Te,!0),window.setTimeout(()=>{window.removeEventListener("click",Te,!0)},0)}function Ie(d,i){const o=d.getBoundingClientRect();return qe(d,o,i)}function Ue(d,i){const o=d.getBoundingClientRect(),u=[];for(let m=0;m<i.length;m++)u.push(qe(d,o,i[m]));return u}function Ke(d){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&d.button===2&&d.ctrlKey?0:d.button}function qe(d,i,o){const u=d.offsetWidth===i.width?1:d.offsetWidth/i.width;return new r.P((o.clientX-i.left)*u,(o.clientY-i.top)*u)}const ft="01",bt="NO_ACCESS_TOKEN";class Tt{constructor(i,o,u){this._transformRequestFn=i,this._customAccessToken=o,this._silenceAuthErrors=!!u,this._createSkuToken()}_createSkuToken(){const i=function(){let o="";for(let u=0;u<10;u++)o+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ft,o].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=i.token,this._skuTokenExpiresAt=i.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(i,o){return this._transformRequestFn&&this._transformRequestFn(i,o)||{url:i}}normalizeStyleURL(i,o){if(!r.h(i))return i;const u=Lt(i);return u.params.push(`sdk=js-${E}`),u.path=`/styles/v1${u.path}`,this._makeAPIURL(u,this._customAccessToken||o)}normalizeGlyphsURL(i,o){if(!r.h(i))return i;const u=Lt(i);return u.path=`/fonts/v1${u.path}`,this._makeAPIURL(u,this._customAccessToken||o)}normalizeModelURL(i,o){if(!r.h(i))return i;const u=Lt(i);return u.path=`/models/v1${u.path}`,this._makeAPIURL(u,this._customAccessToken||o)}normalizeSourceURL(i,o,u,m){if(!r.h(i))return i;const y=Lt(i);return y.path=`/v4/${y.authority}.json`,y.params.push("secure"),u&&y.params.push(`language=${u}`),m&&y.params.push(`worldview=${m}`),this._makeAPIURL(y,this._customAccessToken||o)}normalizeIconsetURL(i,o){const u=Lt(i);return r.h(i)?(u.path=`/styles/v1${u.path}/iconset.pbf`,this._makeAPIURL(u,this._customAccessToken||o)):qt(u)}normalizeSpriteURL(i,o,u,m){const y=Lt(i);return r.h(i)?(y.path=`/styles/v1${y.path}/sprite${o}${u}`,this._makeAPIURL(y,this._customAccessToken||m)):(y.path+=`${o}${u}`,qt(y))}normalizeTileURL(i,o,u){if(this._isSkuTokenExpired()&&this._createSkuToken(),i&&!r.h(i))return i;const m=Lt(i);m.path=m.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${o||u&&m.authority!=="raster"&&u===512?"@2x":""}${r.k.supported?".webp":"$1"}`),m.authority==="raster"?m.path=`/${r.e.RASTER_URL_PREFIX}${m.path}`:m.authority==="rasterarrays"?m.path=`/${r.e.RASTERARRAYS_URL_PREFIX}${m.path}`:m.authority==="3dtiles"?m.path=`/${r.e.TILES3D_URL_PREFIX}${m.path}`:(m.path=m.path.replace(/^.+\/v4\//,"/"),m.path=`/${r.e.TILE_URL_VERSION}${m.path}`);const y=this._customAccessToken||function(b){for(const A of b){const C=A.match(/^access_token=(.*)$/);if(C)return C[1]}return null}(m.params)||r.e.ACCESS_TOKEN;return r.e.REQUIRE_ACCESS_TOKEN&&y&&this._skuToken&&m.params.push(`sku=${this._skuToken}`),this._makeAPIURL(m,y)}canonicalizeTileURL(i,o){const u=Lt(i);if(!u.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!u.path.match(/\.[\w]+$/))return i;let m="mapbox://";u.path.match(/^\/raster\/v1\//)?m+=`raster/${u.path.replace(`/${r.e.RASTER_URL_PREFIX}/`,"")}`:u.path.match(/^\/rasterarrays\/v1\//)?m+=`rasterarrays/${u.path.replace(`/${r.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:m+=`tiles/${u.path.replace(`/${r.e.TILE_URL_VERSION}/`,"")}`;let y=u.params;return o&&(y=y.filter(b=>!b.match(/^access_token=/))),y.length&&(m+=`?${y.join("&")}`),m}canonicalizeTileset(i,o){const u=!!o&&r.h(o),m=[];for(const y of i.tiles||[])r.j(y)?m.push(this.canonicalizeTileURL(y,u)):m.push(y);return m}_makeAPIURL(i,o){const u="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",m=Lt(r.e.API_URL);if(i.protocol=m.protocol,i.authority=m.authority,i.protocol==="http"){const y=i.params.indexOf("secure");y>=0&&i.params.splice(y,1)}if(m.path!=="/"&&(i.path=`${m.path}${i.path}`),!r.e.REQUIRE_ACCESS_TOKEN)return qt(i);if(o=o||r.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!o)throw new Error(`An API access token is required to use Mapbox GL. ${u}`);if(o[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${u}`)}return i.params=i.params.filter(y=>y.indexOf("access_token")===-1),i.params.push(`access_token=${o||""}`),qt(i)}}const Et=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Lt(d){const i=d.match(Et);if(!i)throw new Error("Unable to parse URL object");return{protocol:i[1],authority:i[2],path:i[3]||"/",params:i[4]?i[4].split("&"):[]}}function qt(d){const i=d.params.length?`?${d.params.join("&")}`:"";return`${d.protocol}://${d.authority}${d.path}${i}`}const ui="mapbox.eventData";function Ti(d){if(!d)return null;const i=d.split(".");if(!i||i.length!==3)return null;try{return JSON.parse(r.l(i[1]))}catch{return null}}class vi{constructor(i){this.type=i,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(i){const o=Ti(r.e.ACCESS_TOKEN);let u="";return u=o&&o.u?r.f(o.u):r.e.ACCESS_TOKEN||"",i?`${ui}.${i}:${u}`:`${ui}:${u}`}fetchEventData(){const i=r.s("localStorage"),o=this.getStorageKey(),u=this.getStorageKey("uuid");if(i)try{const m=localStorage.getItem(o);m&&(this.eventData=JSON.parse(m));const y=localStorage.getItem(u);y&&(this.anonId=y)}catch{r.w("Unable to read from LocalStorage")}}saveEventData(){const i=r.s("localStorage"),o=this.getStorageKey(),u=this.getStorageKey("uuid"),m=this.anonId;if(i&&m)try{localStorage.setItem(u,m),Object.keys(this.eventData).length>=1&&localStorage.setItem(o,JSON.stringify(this.eventData))}catch{r.w("Unable to write to LocalStorage")}}processRequests(i){}postEvent(i,o,u,m){if(!r.e.EVENTS_URL)return;const y=Lt(r.e.EVENTS_URL);y.params.push(`access_token=${m||r.e.ACCESS_TOKEN||""}`);const b={event:this.type,created:new Date(i).toISOString()},A=o?Object.assign(b,o):b,C={url:qt(y),headers:{"Content-Type":"text/plain"},body:JSON.stringify([A])};this.pendingRequest=r.p(C,z=>{this.pendingRequest=null,u(z),this.saveEventData(),this.processRequests(m)})}queueRequest(i,o){this.queue.push(i),this.processRequests(o)}}const Kt=new class extends vi{constructor(d){super("appUserTurnstile"),this._customAccessToken=d}postTurnstileEvent(d,i){r.e.EVENTS_URL&&r.e.ACCESS_TOKEN&&Array.isArray(d)&&d.some(o=>r.h(o)||r.j(o))&&this.queueRequest(Date.now(),i)}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const i=Ti(r.e.ACCESS_TOKEN),o=i?i.u:r.e.ACCESS_TOKEN;let u=o!==this.eventData.tokenU;r.v(this.anonId)||(this.anonId=r.u(),u=!0);const m=this.queue.shift();if(this.eventData.lastSuccess){const y=new Date(this.eventData.lastSuccess),b=new Date(m),A=(m-this.eventData.lastSuccess)/864e5;u=u||A>=1||A<-1||y.getDate()!==b.getDate()}else u=!0;u?this.postEvent(m,{sdkIdentifier:"mapbox-gl-js",sdkVersion:E,skuId:ft,"enabled.telemetry":!1,userId:this.anonId},y=>{y||(this.eventData.lastSuccess=m,this.eventData.tokenU=o)},d):this.processRequests()}},Hi=Kt.postTurnstileEvent.bind(Kt),Br=new class extends vi{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(d,i,o,u){this.skuToken=i,this.errorCb=u,r.e.EVENTS_URL&&(o||r.e.ACCESS_TOKEN?this.queueRequest({id:d,timestamp:Date.now()},o):this.errorCb(new Error(bt)))}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;const{id:i,timestamp:o}=this.queue.shift();i&&this.success[i]||(this.anonId||this.fetchEventData(),r.v(this.anonId)||(this.anonId=r.u()),this.postEvent(o,{sdkIdentifier:"mapbox-gl-js",sdkVersion:E,skuId:ft,skuToken:this.skuToken,userId:this.anonId},u=>{u?this.errorCb(u):i&&(this.success[i]=!0)},d))}remove(){this.errorCb=null}},ar=Br.postMapLoadEvent.bind(Br),Xr=new class extends vi{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(d){let i=this.mapInstanceIdMap.get(d);return i||(i=r.u(),this.mapInstanceIdMap.set(d,i)),i}getEventId(d){const i=this.eventIdPerMapInstanceMap.get(d)||0;return this.eventIdPerMapInstanceMap.set(d,i+1),i}postStyleLoadEvent(d,i){const{map:o,style:u,importedStyles:m}=i;if(!r.e.EVENTS_URL||!d&&!r.e.ACCESS_TOKEN)return;const y=this.getMapInstanceId(o),b={mapInstanceId:y,eventId:this.getEventId(y),style:u};m.length&&(b.importedStyles=m),this.queueRequest({timestamp:Date.now(),payload:b},d)}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:i,payload:o}=this.queue.shift();this.postEvent(i,o,()=>{},d)}},mi=Xr.postStyleLoadEvent.bind(Xr),Ci=new class extends vi{constructor(){super("gljs.performance")}postPerformanceEvent(d,i){r.e.EVENTS_URL&&(d||r.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:i},d)}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:i,performanceData:o}=this.queue.shift(),u=function(m){const y=performance.getEntriesByType("resource"),b=performance.getEntriesByType("mark"),A=function(W){const X={};if(W){for(const Y in W)if(Y!=="other")for(const te of W[Y]){const J=`${Y}ResolveRangeMin`,re=`${Y}ResolveRangeMax`,oe=`${Y}RequestCount`,he=`${Y}RequestCachedCount`;X[J]=Math.min(X[J]||1/0,te.startTime),X[re]=Math.max(X[re]||-1/0,te.responseEnd);const ye=me=>{X[me]===void 0&&(X[me]=0),++X[me]};te.transferSize!==void 0&&te.transferSize===0&&ye(he),ye(oe)}}return X}(function(W,X){const Y={};if(W)for(const te of W){const J=X(te);Y[J]===void 0&&(Y[J]=[]),Y[J].push(te)}return Y}(y,L)),C=window.devicePixelRatio,z=navigator.connection||navigator.mozConnection||navigator.webkitConnection,D=z?z.effectiveType:void 0,U={counters:[],metadata:[],attributes:[]},F=(W,X,Y)=>{Y!=null&&W.push({name:X,value:Y.toString()})};for(const W in A)F(U.counters,W,A[W]);if(m.interactionRange[0]!==1/0&&m.interactionRange[1]!==-1/0&&(F(U.counters,"interactionRangeMin",m.interactionRange[0]),F(U.counters,"interactionRangeMax",m.interactionRange[1])),b)for(const W of Object.keys(k)){const X=k[W],Y=b.find(te=>te.name===X);Y&&F(U.counters,X,Y.startTime)}return F(U.counters,"visibilityHidden",m.visibilityHidden),F(U.attributes,"style",function(W){if(W)for(const X of W){const Y=X.name.split("?")[0];if(r.i(Y)){const te=Y.split("/").slice(-2);if(te.length===2)return`mapbox://styles/${te[0]}/${te[1]}`}}}(y)),F(U.attributes,"terrainEnabled",m.terrainEnabled?"true":"false"),F(U.attributes,"fogEnabled",m.fogEnabled?"true":"false"),F(U.attributes,"projection",m.projection),F(U.attributes,"zoom",m.zoom),F(U.metadata,"devicePixelRatio",C),F(U.metadata,"connectionEffectiveType",D),F(U.metadata,"navigatorUserAgent",navigator.userAgent),F(U.metadata,"screenWidth",window.screen.width),F(U.metadata,"screenHeight",window.screen.height),F(U.metadata,"windowWidth",window.innerWidth),F(U.metadata,"windowHeight",window.innerHeight),F(U.metadata,"mapWidth",m.width/C),F(U.metadata,"mapHeight",m.height/C),F(U.metadata,"webglRenderer",m.renderer),F(U.metadata,"webglVendor",m.vendor),F(U.metadata,"sdkVersion",E),F(U.metadata,"sdkIdentifier","mapbox-gl-js"),U}(o);for(const m of u.metadata);for(const m of u.counters);for(const m of u.attributes);this.postEvent(i,u,()=>{},d)}},zi=Ci.postPerformanceEvent.bind(Ci),mr=new class extends vi{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(d,i,o,u){if(!r.e.API_URL||!r.e.SESSION_PATH)return;const m=Lt(r.e.API_URL+r.e.SESSION_PATH);m.params.push(`sku=${i||""}`),m.params.push(`access_token=${u||r.e.ACCESS_TOKEN||""}`);const y={url:qt(m),headers:{"Content-Type":"text/plain"}};this.pendingRequest=r.g(y,b=>{this.pendingRequest=null,o(b),this.saveEventData(),this.processRequests(u)})}getSessionAPI(d,i,o,u){this.skuToken=i,this.errorCb=u,r.e.SESSION_PATH&&r.e.API_URL&&(o||r.e.ACCESS_TOKEN?this.queueRequest({id:d,timestamp:Date.now()},o):this.errorCb(new Error(bt)))}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;const{id:i,timestamp:o}=this.queue.shift();i&&this.success[i]||this.getSession(o,this.skuToken,u=>{u?this.errorCb(u):i&&(this.success[i]=!0)},d)}remove(){this.errorCb=null}},Wi=mr.getSessionAPI.bind(mr),ns=new Set;function nn(d,i){i?ns.add(d):ns.delete(d)}class ws{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(i,o){this._updatedSourceCaches[i]=o,this.setDirty()}discardSourceCacheUpdate(i){delete this._updatedSourceCaches[i]}updateLayer(i){const o=i.scope;this._updatedLayers[o]=this._updatedLayers[o]||new Set,this._updatedLayers[o].add(i.id),this.setDirty()}removeLayer(i){const o=i.scope;this._removedLayers[o]=this._removedLayers[o]||{},this._updatedLayers[o]=this._updatedLayers[o]||new Set,this._removedLayers[o][i.id]=i,this._updatedLayers[o].delete(i.id),this._updatedPaintProps.delete(i.fqid),this.setDirty()}getRemovedLayer(i){return this._removedLayers[i.scope]?this._removedLayers[i.scope][i.id]:null}discardLayerRemoval(i){this._removedLayers[i.scope]&&delete this._removedLayers[i.scope][i.id]}getLayerUpdatesByScope(){const i={};for(const o in this._updatedLayers)i[o]=i[o]||{},i[o].updatedIds=Array.from(this._updatedLayers[o].values());for(const o in this._removedLayers)i[o]=i[o]||{},i[o].removedIds=Object.keys(this._removedLayers[o]);return i}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(i){this._updatedPaintProps.add(i.fqid),this.setDirty()}getUpdatedImages(i){return this._updatedImages[i]?Array.from(this._updatedImages[i].values()):[]}updateImage(i,o){this._updatedImages[o]=this._updatedImages[o]||new Set,this._updatedImages[o].add(r.I.toString(i)),this.setDirty()}resetUpdatedImages(i){this._updatedImages[i]&&this._updatedImages[i].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function _s(d){const{userImage:i}=d;return!!(i&&i.render&&i.render())&&(d.data.replace(new Uint8Array(i.data.buffer)),!0)}class jr extends r.E{constructor(i){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=i,i!=="raster"&&r.r()&&(this.imageRasterizerDispatcher=new r.D(r.t(),this,"Image Rasterizer Worker",1))}addScope(i){this.loaded.set(i,!1),this.imageProviders.set(i,new Map),this.images.set(i,new Map),this.updatedImages.set(i,new Set),this.callbackDispatchedThisFrame.set(i,new Set),this.patterns.set(i,new Map),this.atlasImage.set(i,new r.q({width:1,height:1}))}removeScope(i){this.loaded.delete(i),this.imageProviders.delete(i),this.images.delete(i),this.updatedImages.delete(i),this.callbackDispatchedThisFrame.delete(i),this.patterns.delete(i),this.atlasImage.delete(i);const o=this.atlasTexture.get(i);o&&(o.destroy(),this.atlasTexture.delete(i))}addImageProvider(i,o){this.imageProviders.has(o)||this.imageProviders.set(o,new Map),this.imageProviders.get(o).set(i.id,i)}removeImageProvider(i,o){this.imageProviders.has(o)&&this.imageProviders.get(o).delete(i)}getPendingImageProviders(){const i=[];for(const o of this.imageProviders.values())for(const u of o.values())u.hasPendingRequests()&&i.push(u);return i}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new r.x),this._imageRasterizer}isLoaded(){for(const i of this.loaded.keys())if(!this.loaded.get(i))return!1;return!0}setLoaded(i,o){if(this.loaded.get(o)!==i&&(this.loaded.set(o,i),i)){for(const{ids:u,callback:m}of this.requestors)this._notify(u,o,m);this.requestors=[]}}hasImage(i,o){return!!this.getImage(i,o)}getImage(i,o){return this.images.get(o).get(i.toString())}addImage(i,o,u){this._validate(i,u)&&this.images.get(o).set(i.toString(),u)}_validate(i,o){let u=!0;return this._validateStretch(o.stretchX,o.data&&o.data.width)||(this.fire(new r.y(new Error(`Image "${i.name}" has invalid "stretchX" value`))),u=!1),this._validateStretch(o.stretchY,o.data&&o.data.height)||(this.fire(new r.y(new Error(`Image "${i.name}" has invalid "stretchY" value`))),u=!1),this._validateContent(o.content,o)||(this.fire(new r.y(new Error(`Image "${i.name}" has invalid "content" value`))),u=!1),u}_validateStretch(i,o){if(!i)return!0;let u=0;for(const m of i){if(m[0]<u||m[1]<m[0]||o<m[1])return!1;u=m[1]}return!0}_validateContent(i,o){return i?i.length!==4||!o.usvg&&(i[0]<0||o.data.width<i[0]||i[1]<0||o.data.height<i[1]||i[2]<0||o.data.width<i[2]||i[3]<0||o.data.height<i[3])?!1:!(i[2]<i[0]||i[3]<i[1]):!0}updateImage(i,o,u){const m=this.images.get(o).get(i.toString());u.version=m.version+1,this.images.get(o).set(i.toString(),u),this.updatedImages.get(o).add(i),this.removeFromImageRasterizerCache(i,o)}clearUpdatedImages(i){this.updatedImages.get(i).clear()}removeFromImageRasterizerCache(i,o){this.spriteFormat!=="raster"&&(r.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[i],scope:o}):this.imageRasterizer.removeImagesFromCacheByIds([i],o))}removeImage(i,o){const u=this.images.get(o),m=u.get(i.toString());u.delete(i.toString()),this.patterns.get(o).delete(i.toString()),this.removeFromImageRasterizerCache(i,o),m.userImage&&m.userImage.onRemove&&m.userImage.onRemove()}listImages(i){return Array.from(this.images.get(i).keys()).map(o=>r.I.from(o))}getImages(i,o,u){const m=[],y=[],b=this.imageProviders.get(o);for(const D of i){if(!D.iconsetId){m.push(D);continue}const U=b.get(D.iconsetId);U&&(this.getImage(D,o)?y.push(D):U.addPendingRequest(D))}if(m.length===0)return void this._notify(y,o,u);let A=!0;const C=!!this.loaded.get(o),z=this.images.get(o);if(!C)for(const D of m)z.has(D.toString())||(A=!1);C||A?this._notify(m,o,u):this.requestors.push({ids:m,scope:o,callback:u})}rasterizeImages(i,o){const u=new Map,{tasks:m,scope:y}=i;for(const[b,A]of m.entries()){const C=this.getImage(A.id,y);C&&u.set(b,{image:C,imageVariant:A})}this._rasterizeImages(y,u,o)}_rasterizeImages(i,o,u){if(r.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:o,scope:i},u);else{const m=new Map;for(const[y,{image:b,imageVariant:A}]of o.entries())m.set(y,this.imageRasterizer.rasterize(A,b,i,0));u(void 0,m)}}getUpdatedImages(i){return this.updatedImages.get(i)||new Set}_notify(i,o,u){const m=this.images.get(o),y=new Map;for(const b of i){if(!m.get(b.toString())){if(b.iconsetId)continue;this.fire(new r.z("styleimagemissing",{id:b.name}))}const A=m.get(b.toString());if(!A){r.w(`Image "${b.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const C={data:A.usvg?null:A.data.clone(),pixelRatio:A.pixelRatio,sdf:A.sdf,usvg:A.usvg,version:A.version,stretchX:A.stretchX,stretchY:A.stretchY,content:A.content,hasRenderCallback:!!(A.userImage&&A.userImage.render)};A.usvg&&Object.assign(C,{width:A.icon.usvg_tree.width,height:A.icon.usvg_tree.height}),y.set(r.I.toString(b),C)}u(null,y)}getPixelSize(i){const{width:o,height:u}=this.atlasImage.get(i);return{width:o,height:u}}getPattern(i,o,u){const m=i.toString(),y=this.patterns.get(o),b=y.get(m),A=this.getImage(i,o);if(!A)return null;if(b){if(b.position.version===A.version)return b.position;b.position.version=A.version}else{if(A.usvg&&!A.data){const C=this.getPatternInFlightId(m,o);if(this.patternsInFlight.has(C))return null;this.patternsInFlight.add(C);const z=new r.A(i).scaleSelf(r.o.devicePixelRatio),D=new Map([[z.toString(),{image:A,imageVariant:z}]]);return this._rasterizeImages(o,D,(U,F)=>this.storePatternImage(z,o,A,u,F)),null}this.storePattern(i,o,A)}return this._updatePatternAtlas(o,u),y.get(m).position}getPatternInFlightId(i,o){return r.B(i,o)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(i,o,u,m,y){const b=i.toString(),A=y?y.get(b):void 0;A&&(u.data=A,this.storePattern(i.id,o,u),this._updatePatternAtlas(o,m),this.patternsInFlight.delete(this.getPatternInFlightId(i.id.toString(),o)))}storePattern(i,o,u){const m={w:u.data.width+2*r.C,h:u.data.height+2*r.C,x:0,y:0},y=new r.F(m,u,r.C);this.patterns.get(o).set(i.toString(),{bin:m,position:y})}destroyAtlasTextures(){for(const i of this.atlasTexture.values())i&&i.destroy();this.atlasTexture.clear()}bind(i,o){const u=i.gl;let m=this.atlasTexture.get(o);m?this.dirty&&(m.update(this.atlasImage.get(o)),this.dirty=!1):(m=new r.T(i,this.atlasImage.get(o),u.RGBA8),this.atlasTexture.set(o,m)),m.bind(u.LINEAR,u.CLAMP_TO_EDGE)}_updatePatternAtlas(i,o){const u=this.patterns.get(i),m=Array.from(u.values()).map(({bin:z})=>z),{w:y,h:b}=r.G(m),A=this.atlasImage.get(i);A.resize({width:y||1,height:b||1});const C=this.images.get(i);for(const[z,{bin:D,position:U}]of u.entries()){let F=U.padding;const W=D.x+F,X=D.y+F,Y=C.get(z).data,te=Y.width,J=Y.height;F=F>1?F-1:F,r.q.copy(Y,A,{x:0,y:0},{x:W,y:X},{width:te,height:J},o),r.q.copy(Y,A,{x:0,y:J-F},{x:W,y:X-F},{width:te,height:F},o),r.q.copy(Y,A,{x:0,y:0},{x:W,y:X+J},{width:te,height:F},o),r.q.copy(Y,A,{x:te-F,y:0},{x:W-F,y:X},{width:F,height:J},o),r.q.copy(Y,A,{x:0,y:0},{x:W+te,y:X},{width:F,height:J},o),r.q.copy(Y,A,{x:te-F,y:J-F},{x:W-F,y:X-F},{width:F,height:F},o),r.q.copy(Y,A,{x:0,y:J-F},{x:W+te,y:X-F},{width:F,height:F},o),r.q.copy(Y,A,{x:0,y:0},{x:W+te,y:X+J},{width:F,height:F},o),r.q.copy(Y,A,{x:te-F,y:0},{x:W-F,y:X+J},{width:F,height:F},o)}this.dirty=!0}beginFrame(){for(const i of this.images.keys())this.callbackDispatchedThisFrame.set(i,new Set)}dispatchRenderCallbacks(i,o){const u=this.images.get(o);for(const m of i){if(this.callbackDispatchedThisFrame.get(o).has(m.toString()))continue;this.callbackDispatchedThisFrame.get(o).add(m.toString());const y=u.get(m.toString());_s(y)&&this.updateImage(m,o,y)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function Gl(d){const i=d.value,o=d.valueSpec,u=d.style,m=d.styleSpec,y=d.key,b=d.arrayElementValidator||Dr;if(!Array.isArray(i))return[new r.V(y,i,`array expected, ${r.K(i)} found`)];if(o.length&&i.length!==o.length)return[new r.V(y,i,`array length ${o.length} expected, length ${i.length} found`)];if(o["min-length"]&&i.length<o["min-length"])return[new r.V(y,i,`array length at least ${o["min-length"]} expected, length ${i.length} found`)];let A={type:o.value,values:o.values,minimum:o.minimum,maximum:o.maximum,function:void 0};m.$version<7&&(A.function=o.function),r.H(o.value)&&(A=o.value);let C=[];for(let z=0;z<i.length;z++)C=C.concat(b({array:i,arrayIndex:z,value:i[z],valueSpec:A,style:u,styleSpec:m,key:`${y}[${z}]`},!0));return C}function Oa(d){const i=d.key,o=d.value,u=d.valueSpec;if(!r.L(o))return[new r.V(i,o,`number expected, ${r.K(o)} found`)];if(o!=o)return[new r.V(i,o,"number expected, NaN found")];if("minimum"in u){let m=u.minimum;if(Array.isArray(u.minimum)&&(m=u.minimum[d.arrayIndex]),o<m)return[new r.V(i,o,`${o} is less than the minimum value ${m}`)]}if("maximum"in u){let m=u.maximum;if(Array.isArray(u.maximum)&&(m=u.maximum[d.arrayIndex]),o>m)return[new r.V(i,o,`${o} is greater than the maximum value ${m}`)]}return[]}function Xl(d){const i=d.key,o=d.value;if(!r.H(o))return[new r.V(i,o,`object expected, ${r.K(o)} found`)];const u=d.valueSpec,m=r.J(o.type);let y,b,A,C={};const z=m!=="categorical"&&o.property===void 0,D=!z,U=function(Y){const te=Y.stops;return Array.isArray(te)&&Array.isArray(te[0])&&r.H(te[0][0])}(o),F=As({key:d.key,value:d.value,valueSpec:d.styleSpec.function,style:d.style,styleSpec:d.styleSpec,objectElementValidators:{stops:function(Y){if(m==="identity")return[new r.V(Y.key,Y.value,'identity function may not have a "stops" property')];let te=[];const J=Y.value;return te=te.concat(Gl({key:Y.key,value:J,valueSpec:Y.valueSpec,style:Y.style,styleSpec:Y.styleSpec,arrayElementValidator:W})),Array.isArray(J)&&J.length===0&&te.push(new r.V(Y.key,J,"array must have at least one stop")),te},default:function(Y){return Dr({key:Y.key,value:Y.value,valueSpec:u,style:Y.style,styleSpec:Y.styleSpec})}}});return m==="identity"&&z&&F.push(new r.V(d.key,d.value,'missing required property "property"')),m==="identity"||o.stops||F.push(new r.V(d.key,d.value,'missing required property "stops"')),m==="exponential"&&u.expression&&!r.M(u)&&F.push(new r.V(d.key,d.value,"exponential functions not supported")),d.styleSpec.$version>=8&&(D&&!r.N(u)?F.push(new r.V(d.key,d.value,"property functions not supported")):z&&!r.O(u)&&F.push(new r.V(d.key,d.value,"zoom functions not supported"))),m!=="categorical"&&!U||o.property!==void 0||F.push(new r.V(d.key,d.value,'"property" property is required')),F;function W(Y){let te=[];const J=Y.value,re=Y.key;if(!Array.isArray(J))return[new r.V(re,J,`array expected, ${r.K(J)} found`)];if(J.length!==2)return[new r.V(re,J,`array length 2 expected, length ${J.length} found`)];if(U){if(!r.H(J[0]))return[new r.V(re,J,`object expected, ${r.K(J[0])} found`)];const oe=J[0];if(oe.zoom===void 0)return[new r.V(re,J,"object stop key must have zoom")];if(oe.value===void 0)return[new r.V(re,J,"object stop key must have value")];const he=r.J(oe.zoom);if(typeof he!="number")return[new r.V(re,oe.zoom,"stop zoom values must be numbers")];if(A&&A>he)return[new r.V(re,oe.zoom,"stop zoom values must appear in ascending order")];he!==A&&(A=he,b=void 0,C={}),te=te.concat(As({key:`${re}[0]`,value:J[0],valueSpec:{zoom:{}},style:Y.style,styleSpec:Y.styleSpec,objectElementValidators:{zoom:Oa,value:X}}))}else te=te.concat(X({key:`${re}[0]`,value:J[0],style:Y.style,styleSpec:Y.styleSpec},J));return r.Q(r.S(J[1]))?te.concat([new r.V(`${re}[1]`,J[1],"expressions are not allowed in function stops.")]):te.concat(Dr({key:`${re}[1]`,value:J[1],valueSpec:u,style:Y.style,styleSpec:Y.styleSpec}))}function X(Y,te){const J=r.K(Y.value),re=r.J(Y.value),oe=Y.value!==null?Y.value:te;if(y){if(J!==y)return[new r.V(Y.key,oe,`${J} stop domain type must match previous stop domain type ${y}`)]}else y=J;if(J!=="number"&&J!=="string"&&J!=="boolean"&&typeof re!="number"&&typeof re!="string"&&typeof re!="boolean")return[new r.V(Y.key,oe,"stop domain value must be a number, string, or boolean")];if(J!=="number"&&m!=="categorical"){let he=`number expected, ${J} found`;return r.N(u)&&m===void 0&&(he+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new r.V(Y.key,oe,he)]}return m!=="categorical"||J!=="number"||typeof re=="number"&&isFinite(re)&&Math.floor(re)===re?m!=="categorical"&&J==="number"&&typeof re=="number"&&typeof b=="number"&&b!==void 0&&re<b?[new r.V(Y.key,oe,"stop domain values must appear in ascending order")]:(b=re,m==="categorical"&&re in C?[new r.V(Y.key,oe,"stop domain values must be unique")]:(C[re]=!0,[])):[new r.V(Y.key,oe,`integer expected, found ${String(re)}`)]}}function $s(d){const i=(d.expressionContext==="property"?r.W:r.U)(r.S(d.value),d.valueSpec);if(i.result==="error")return i.value.map(u=>new r.V(`${d.key}${u.key}`,d.value,u.message));const o=i.value.expression||i.value._styleExpression.expression;if(d.expressionContext==="property"&&d.propertyKey==="text-font"&&!o.outputDefined())return[new r.V(d.key,d.value,`Invalid data expression for "${d.propertyKey}". Output values must be contained as literals within the expression.`)];if(d.expressionContext==="property"&&d.propertyType==="layout"&&!r.Z(o))return[new r.V(d.key,d.value,'"feature-state" data expressions are not supported with layout properties.')];if(d.expressionContext==="filter")return Fa(o,d);if(d.expressionContext==="appearance")return an(o,d);if(d.expressionContext&&d.expressionContext.indexOf("cluster")===0){if(!r.X(o,["zoom","feature-state"]))return[new r.V(d.key,d.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(d.expressionContext==="cluster-initial"&&!r.Y(o))return[new r.V(d.key,d.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Fa(d,i){const o=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(i.valueSpec&&i.valueSpec.expression)for(const m of i.valueSpec.expression.parameters)o.delete(m);if(o.size===0)return[];const u=[];return d instanceof r._&&o.has(d.name)?[new r.V(i.key,i.value,`["${d.name}"] expression is not supported in a filter for a ${i.object.type} layer with id: ${i.object.id}`)]:(d.eachChild(m=>{u.push(...Fa(m,i))}),u)}function an(d,i){const o=new Set;if(i.valueSpec&&i.valueSpec.expression)for(const m of i.valueSpec.expression.parameters)o.add(m);if(o.size===0)return[];const u=[];return d instanceof r._&&!o.has(d.name)?[new r.V(i.key,i.value,`["${d.name}"] is not an allowed parameter`)]:(d.eachChild(m=>{u.push(...an(m,i))}),u)}function pa(d){const i=d.key,o=d.value,u=d.valueSpec,m=[];return Array.isArray(u.values)?u.values.indexOf(r.J(o))===-1&&m.push(new r.V(i,o,`expected one of [${u.values.join(", ")}], ${JSON.stringify(o)} found`)):Object.keys(u.values).indexOf(r.J(o))===-1&&m.push(new r.V(i,o,`expected one of [${Object.keys(u.values).join(", ")}], ${JSON.stringify(o)} found`)),m}function ga(d){return r.a2(r.S(d.value))?$s(Object.assign({},d,{expressionContext:"filter",valueSpec:d.styleSpec[`filter_${d.layerType||"fill"}`]})):fo(d)}function fo(d){const i=d.value,o=d.key;if(!Array.isArray(i))return[new r.V(o,i,`array expected, ${r.K(i)} found`)];if(i.length<1)return[new r.V(o,i,"filter array must have at least 1 element")];const u=d.styleSpec;let m=pa({key:`${o}[0]`,value:i[0],valueSpec:u.filter_operator});switch(r.J(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&r.J(i[1])==="$type"&&m.push(new r.V(o,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":i.length!==3&&m.push(new r.V(o,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(r.a0(i[1])||m.push(new r.V(`${o}[1]`,i[1],`string expected, ${r.K(i[1])} found`)));for(let y=2;y<i.length;y++)r.J(i[1])==="$type"?m=m.concat(pa({key:`${o}[${y}]`,value:i[y],valueSpec:u.geometry_type})):r.a0(i[y])||r.L(i[y])||r.$(i[y])||m.push(new r.V(`${o}[${y}]`,i[y],`string, number, or boolean expected, ${r.K(i[y])} found.`));break;case"any":case"all":case"none":for(let y=1;y<i.length;y++)m=m.concat(fo({key:`${o}[${y}]`,value:i[y],style:d.style,styleSpec:d.styleSpec}));break;case"has":case"!has":i.length!==2?m.push(new r.V(o,i,`filter array for "${i[0]}" operator must have 2 elements`)):r.a0(i[1])||m.push(new r.V(`${o}[1]`,i[1],`string expected, ${r.K(i[1])} found`))}return m}function po(d,i){const o=d.key,u=d.style,m=d.layer,y=d.styleSpec,b=d.value,A=d.objectKey,C=y[`${i}_${d.layerType}`];if(!C)return[];const z=A.match(/^(.*)-use-theme$/);if(z&&C[z[1]])return r.Q(b)?[].concat(Dr({key:d.key,value:b,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:u,styleSpec:y,expressionContext:"property",propertyType:i,propertyKey:A})):Dr({key:o,value:b,valueSpec:{type:"string"},style:u,styleSpec:y});const D=A.match(/^(.*)-transition$/);if(i==="paint"&&D&&C[D[1]]&&C[D[1]].transition)return Dr({key:o,value:b,valueSpec:y.transition,style:u,styleSpec:y});const U=d.valueSpec||C[A];if(!U)return[new r.a3(o,b,`unknown property "${A}"`)];let F;if(r.a0(b)&&r.N(U)&&!U.tokens&&(F=/^{([^}]+)}$/.exec(b))){const X=`\`{ "type": "identity", "property": ${F?JSON.stringify(F[1]):'"_"'} }\``;return[new r.V(o,b,`"${A}" does not support interpolation syntax
Use an identity property function instead: ${X}.`)]}const W=[];if(d.layerType==="symbol")A!=="text-field"||!u||u.glyphs||u.imports||W.push(new r.V(o,b,'use of "text-field" requires a style "glyphs" property')),A==="text-font"&&r.a4(r.S(b))&&r.J(b.type)==="identity"&&W.push(new r.V(o,b,'"text-font" does not support identity functions'));else if(d.layerType==="model"&&i==="paint"&&m&&m.layout&&m.layout.hasOwnProperty("model-id")&&r.N(U)&&(r.a5(U)||r.O(U))){const X=r.W(r.S(b),U),Y=X.value.expression||X.value._styleExpression.expression;Y&&!r.X(Y,["measure-light"])&&(A==="model-emissive-strength"&&r.Y(Y)&&r.Z(Y)||W.push(new r.V(o,b,`${A} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return W.concat(Dr({key:d.key,value:b,valueSpec:U,style:u,styleSpec:y,expressionContext:"property",propertyType:i,propertyKey:A}))}function Js(d){return po(d,"paint")}function fn(d){return po(d,"layout")}function Yl(d){let i=[];const o=d.value,u=d.key,m=d.style,y=d.styleSpec;if(!r.H(o))return[new r.V(u,o,"object expected")];o.type||o.ref||i.push(new r.V(u,o,'either "type" or "ref" is required'));let b=r.J(o.type);const A=r.J(o.ref);if(o.id){const C=r.J(o.id);for(let z=0;z<d.arrayIndex;z++){const D=m.layers[z];r.J(D.id)===C&&i.push(new r.V(u,o.id,`duplicate layer id "${C}", previously used at line ${D.id.__line__}`))}}if("ref"in o){let C;["type","source","source-layer","filter","layout"].forEach(z=>{z in o&&i.push(new r.V(u,o[z],`"${z}" is prohibited for ref layers`))}),m.layers.forEach(z=>{r.J(z.id)===A&&(C=z)}),C?C.ref?i.push(new r.V(u,o.ref,"ref cannot reference another ref layer")):b=r.J(C.type):typeof A=="string"&&i.push(new r.V(u,o.ref,`ref layer "${A}" not found`))}else if(b!=="background"&&b!=="sky"&&b!=="slot")if(o.source)if(r.a0(o.source)){const C=m.sources&&m.sources[o.source],z=C&&r.J(C.type);C?z==="vector"&&b==="raster"?i.push(new r.V(u,o.source,`layer "${o.id}" requires a raster source`)):z==="raster"&&b!=="raster"?i.push(new r.V(u,o.source,`layer "${o.id}" requires a vector source`)):z!=="vector"||o["source-layer"]?z==="raster-dem"&&b!=="hillshade"?i.push(new r.V(u,o.source,"raster-dem source can only be used with layer type 'hillshade'.")):z!=="raster-array"||["raster","raster-particle"].includes(b)?b==="line"&&o.paint&&(o.paint["line-gradient"]||o.paint["line-trim-offset"])&&z==="geojson"&&!C.lineMetrics?i.push(new r.V(u,o,`layer "${o.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):b==="raster-particle"&&z!=="raster-array"&&i.push(new r.V(u,o.source,`layer "${o.id}" requires a 'raster-array' source.`)):i.push(new r.V(u,o.source,"raster-array source can only be used with layer type 'raster'.")):i.push(new r.V(u,o,`layer "${o.id}" must specify a "source-layer"`)):i.push(new r.V(u,o.source,`source "${o.source}" not found`))}else i.push(new r.V(`${u}.source`,o.source,'"source" must be a string'));else i.push(new r.V(u,o,'missing required property "source"'));return i=i.concat(As({key:u,value:o,valueSpec:y.layer,style:d.style,styleSpec:d.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Dr({key:`${u}.type`,value:o.type,valueSpec:y.layer.type,style:d.style,styleSpec:d.styleSpec,object:o,objectKey:"type"}),filter:C=>ga(Object.assign({layerType:b},C)),layout:C=>As({layer:o,key:C.key,value:C.value,valueSpec:{},style:C.style,styleSpec:C.styleSpec,objectElementValidators:{"*":z=>fn(Object.assign({layerType:b},z))}}),paint:C=>As({layer:o,key:C.key,value:C.value,valueSpec:{},style:C.style,styleSpec:C.styleSpec,objectElementValidators:{"*":z=>Js(Object.assign({layerType:b,layer:o},z))}}),appearances(C){const z=Gl({key:C.key,value:C.value,valueSpec:C.valueSpec,style:C.style,styleSpec:C.styleSpec,arrayElementValidator:F=>function(W){const{key:X,layer:Y,layerType:te}=W,J=r.J(W.value),re=r.J(J.name),oe=r.J(J.condition),he=As({key:X,value:J,valueSpec:W.styleSpec.appearance,style:W.style,styleSpec:W.styleSpec,objectElementValidators:{condition:ye=>function(me){const xe=[];return xe.push(...$s({key:me.key,value:me.object.condition,valueSpec:r.a6.appearance.condition,expressionContext:"appearance"})),xe}(Object.assign({layer:Y,layerType:te},ye)),properties:ye=>function(me){const xe=[],{styleSpec:_e,layer:ge,layerType:Ae}=me,je=_e[`paint_${Ae}`],Re=_e[`layout_${Ae}`],Je=me.object[me.objectKey];for(const Ne in Je){const $e=Ne in je?"paint":Ne in Re?"layout":void 0;if(!$e){xe.push(new r.V(me.key,Ne,`unknown property "${Ne}" for layer type "${Ae}"`));continue}const vt=Object.assign({},me,{key:`${me.key}.${Ne}`,object:Je,objectKey:Ne,layer:ge,layerType:Ae,value:Je[Ne],valueSpec:$e==="paint"?je[Ne]:Re[Ne]});xe.push(...po(vt,$e))}return xe}(Object.assign({layer:Y,layerType:te},ye))}});return re==="hidden"||oe||he.push(new r.V(W.key,"name",'Appearance with name different than "hidden" must have a condition')),he}(Object.assign({layerType:b,layer:o},F))}),D=Array.isArray(C.value)?C.value:[],U=new Set;return D.forEach((F,W)=>{const X=r.J(F.name);if(X)if(U.has(X)){const Y=r.J(o.id);z.push(new r.V(C.key,X,`Duplicated appearance name "${X}" for layer "${Y}"`))}else U.add(X)}),z}}})),i}function ma({key:d,value:i}){return r.a0(i)?[]:[new r.V(d,i,`string expected, ${r.K(i)} found`)]}const Yo={promoteId:function d({key:i,value:o}){if(r.a0(o))return ma({key:i,value:o});if(Array.isArray(o)){const m=[],y=r.S(o),b=r.U(y);return b.result==="error"&&b.value.forEach(A=>{m.push(new r.V(`${i}${A.key}`,null,`${A.message}`))}),r.X(b.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||m.push(new r.V(`${i}`,null,"promoteId expression should be only feature dependent")),m}if(!r.H(o))return[new r.V(i,o,`string, expression or object expected, "${r.K(o)}" found`)];const u=[];for(const m in o)u.push(...d({key:`${i}.${m}`,value:o[m]}));return u}};function ks(d){const i=d.value,o=d.key,u=d.styleSpec,m=d.style;if(!r.H(i))return[new r.V(o,i,`object expected, ${r.K(i)} found`)];if(!("type"in i))return[new r.V(o,i,'"type" is required')];const y=r.J(i.type);let b=[];switch(["vector","raster","raster-dem","raster-array"].includes(y)&&("url"in i||"tiles"in i||b.push(new r.a3(o,i,'Either "url" or "tiles" is required.'))),y){case"vector":case"raster":case"raster-dem":case"raster-array":return b=b.concat(As({key:o,value:i,valueSpec:u[`source_${y.replace("-","_")}`],style:d.style,styleSpec:u,objectElementValidators:Yo})),b;case"geojson":if(b=As({key:o,value:i,valueSpec:u.source_geojson,style:m,styleSpec:u,objectElementValidators:Yo}),"cluster"in i&&"clusterProperties"in i){if(!r.H(i.clusterProperties))return[new r.V(`${o}.clusterProperties`,i,`object expected, ${r.K(i)} found`)];for(const A in i.clusterProperties){const C=i.clusterProperties[A];if(!Array.isArray(C))return[new r.V(`${o}.clusterProperties.${A}`,C,"array expected")];const[z,D]=C,U=typeof z=="string"?[z,["accumulated"],["get",A]]:z;b.push(...$s({key:`${o}.${A}.map`,value:D,expressionContext:"cluster-map"})),b.push(...$s({key:`${o}.${A}.reduce`,value:U,expressionContext:"cluster-reduce"}))}}return b;case"video":return As({key:o,value:i,valueSpec:u.source_video,style:m,styleSpec:u});case"image":return As({key:o,value:i,valueSpec:u.source_image,style:m,styleSpec:u});case"canvas":return[new r.V(o,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return pa({key:`${o}.type`,value:i.type,valueSpec:{values:Dn(u)}})}}function Dn(d){return d.source.reduce((i,o)=>{const u=d[o];return u.type.type==="enum"&&(i=i.concat(Object.keys(u.type.values))),i},[])}function ql(d){const i=d.value,o=d.styleSpec,u=o.light,m=d.style;if(i===void 0)return[];if(!r.H(i))return[new r.V("light",i,`object expected, ${r.K(i)} found`)];let y=[];for(const b in i){const A=b.match(/^(.*)-transition$/),C=b.match(/^(.*)-use-theme$/);y=y.concat(C&&u[C[1]]?Dr({key:b,value:i[b],valueSpec:{type:"string"},style:m,styleSpec:o}):A&&u[A[1]]&&u[A[1]].transition?Dr({key:b,value:i[b],valueSpec:o.transition,style:m,styleSpec:o}):u[b]?Dr({key:b,value:i[b],valueSpec:u[b],style:m,styleSpec:o}):[new r.V(b,i[b],`unknown property "${b}"`)])}return y}function Ba(d){const i=d.value;if(!i)return[];const o=d.key;if(!r.H(i))return[new r.V(o,i,`object expected, ${r.K(i)} found`)];let u=[];const m=d.styleSpec,y=m["light-3d"],b=d.style,A=d.style.lights;for(const D of["type","id"])if(!(D in i))return u=u.concat([new r.V(o,i,`missing property "${D}"`)]),u;if(!r.a0(i.type))return u=u.concat([new r.V(`${o}.type`,i.type,"string expected")]),u;if(A)for(let D=0;D<d.arrayIndex;D++){const U=r.J(i.type),F=A[D];r.J(F.type)===U&&u.push(new r.V(o,i.id,`duplicate light type "${i.type}", previously defined at line ${F.id.__line__}`))}const C=`properties_light_${i.type}`;if(!(C in m))return u=u.concat([new r.V(`${o}.type`,i,`Invalid light type ${i.type}`)]),u;const z=m[C];for(const D in i)if(D==="properties"){const U=i[D];if(!r.H(U))return u=u.concat([new r.V("properties",U,`object expected, ${r.K(U)} found`)]),u;for(const F in U){const W=F.match(/^(.*)-transition$/),X=F.match(/^(.*)-use-theme$/);u=u.concat(X&&z[X[1]]?Dr({key:D,value:U[F],valueSpec:{type:"string"},style:b,styleSpec:m}):W&&z[W[1]]&&z[W[1]].transition?Dr({key:D,value:i[D],valueSpec:m.transition,style:b,styleSpec:m}):z[F]?Dr({key:F,value:U[F],valueSpec:z[F],style:b,styleSpec:m}):[new r.a3(d.key,U[F],`unknown property "${F}"`)])}}else u=u.concat(y[D]?Dr({key:D,value:i[D],valueSpec:y[D],style:b,styleSpec:m}):[new r.a3(D,i[D],`unknown property "${D}"`)]);return u}function Jn(d){const i=d.value,o=d.key,u=d.style,m=d.styleSpec,y=m.terrain;if(i==null)return[];if(!r.H(i))return[new r.V("terrain",i,`object expected, ${r.K(i)} found`)];let b=[];for(const A in i){const C=A.match(/^(.*)-transition$/),z=A.match(/^(.*)-use-theme$/);b=b.concat(z&&y[z[1]]?Dr({key:A,value:i[A],valueSpec:{type:"string"},style:u,styleSpec:m}):C&&y[C[1]]&&y[C[1]].transition?Dr({key:A,value:i[A],valueSpec:m.transition,style:u,styleSpec:m}):y[A]?Dr({key:A,value:i[A],valueSpec:y[A],style:u,styleSpec:m}):[new r.a3(A,i[A],`unknown property "${A}"`)])}if(i.source)if(r.a0(i.source)){const A=u.sources&&u.sources[i.source],C=A&&r.J(A.type);A?C!=="raster-dem"&&b.push(new r.V(`${o}.source`,i.source,`terrain cannot be used with a source of type ${C}, it only be used with a "raster-dem" source type`)):b.push(new r.V(`${o}.source`,i.source,`source "${i.source}" not found`))}else b.push(new r.V(`${o}.source`,i.source,"source must be a string"));else b.push(new r.V(o,i,'terrain is missing required property "source"'));return b}function _a(d){const i=d.value,o=d.style,u=d.styleSpec,m=u.fog;if(i===void 0)return[];if(!r.H(i))return[new r.V("fog",i,`object expected, ${r.K(i)} found`)];let y=[];for(const b in i){const A=b.match(/^(.*)-transition$/),C=b.match(/^(.*)-use-theme$/);y=y.concat(C&&m[C[1]]?Dr({key:b,value:i[b],valueSpec:{type:"string"},style:o,styleSpec:u}):A&&m[A[1]]&&m[A[1]].transition?Dr({key:b,value:i[b],valueSpec:u.transition,style:o,styleSpec:u}):m[b]?Dr({key:b,value:i[b],valueSpec:m[b],style:o,styleSpec:u}):[new r.a3(b,i[b],`unknown property "${b}"`)])}return y}const go={"*":()=>[],array:Gl,boolean:function(d){const i=d.value,o=d.key;return r.$(i)?[]:[new r.V(o,i,`boolean expected, ${r.K(i)} found`)]},number:Oa,color:function({key:d,value:i}){return r.a0(i)?r.a1.parseCSSColor(i)===null?[new r.V(d,i,`color expected, "${i}" found`)]:[]:[new r.V(d,i,`color expected, ${r.K(i)} found`)]},enum:pa,filter:ga,function:Xl,layer:Yl,object:As,source:ks,model:r.a7,light:ql,"light-3d":Ba,terrain:Jn,fog:_a,string:ma,formatted:function(d){return ma(d).length===0?[]:$s(d)},resolvedImage:function(d){return ma(d).length===0?[]:$s(d)},projection:function(d){const i=d.value,o=d.styleSpec,u=o.projection,m=d.style;if(r.H(i)){let y=[];for(const b in i)y=y.concat(Dr({key:b,value:i[b],valueSpec:u[b],style:m,styleSpec:o}));return y}return r.a0(i)?[]:[new r.V("projection",i,`object or string expected, ${r.K(i)} found`)]},import:function(d){const i=d.key,{value:o,styleSpec:u}=d;if(!r.H(o))return[new r.V(i,o,"import must be an object")];const{data:m,...y}=o;Object.defineProperty(y,"__line__",{value:o.__line__,enumerable:!1});let b=As(Object.assign({},d,{value:y,valueSpec:u.import}));return r.J(y.id)===""&&b.push(new r.V(`${d.key}.id`,y,"import id can't be an empty string")),m&&(b=b.concat(mo(m,u,{key:`${d.key}.data`}))),b},iconset:function(d){const i=d.value,o=d.key,u=d.styleSpec,m=d.style;if(!r.H(i))return[new r.V(o,i,"object expected")];if(!i.type)return[new r.V(o,i,'"type" is required')];const y=r.J(i.type);let b=[];if(b=b.concat(As({key:o,value:i,valueSpec:u[`iconset_${y}`],style:m,styleSpec:u})),function(A,C){return!(A!=="source"||!C.source)}(y,i)){const A=m.sources&&m.sources[i.source],C=A&&r.J(A.type);A?C!=="raster-array"&&b.push(new r.V(o,i.source,`iconset cannot be used with a source of type ${String(C)}, it only be used with a "raster-array" source type`)):b.push(new r.V(o,i.source,`source "${i.source}" not found`))}return b}};function Dr(d,i=!1){const o=d.value,u=d.valueSpec,m=d.styleSpec;if(u.expression){if(r.a4(r.J(o)))return Xl(d);if(r.Q(r.S(o)))return $s(d)}if(u.type&&go[u.type]){const y=go[u.type](d);return i===!0&&y.length>0&&Array.isArray(d.value)?$s(d):y}return As(Object.assign({},d,{valueSpec:u.type?m[u.type]:u}))}function As(d){const i=d.key,o=d.value,u=d.valueSpec||{},m=d.objectElementValidators||{},y=d.style,b=d.styleSpec;if(!r.H(o))return[new r.V(i,o,`object expected, ${r.K(o)} found`)];let A=[];for(const C in o){const z=C.split(".")[0];let D;m[z]?D=m[z]:u[z]?D=Dr:m["*"]?D=m["*"]:u["*"]&&(D=Dr),D?A=A.concat(D({key:(i&&`${i}.`)+C,value:o[C],valueSpec:u[z]||u["*"],style:y,styleSpec:b,object:o,objectKey:C},o)):A.push(new r.a3(i,o[C],`unknown property "${C}"`))}for(const C in u)m[C]||u[C].required&&u[C].default===void 0&&o[C]===void 0&&A.push(new r.V(i,o,`missing required property "${C}"`));return A}function Zl({key:d,value:i}){const o=ma({key:d,value:i});if(o.length)return o;const u=i;return u.indexOf("{fontstack}")===-1&&o.push(new r.V(d,i,'"glyphs" url must include a "{fontstack}" token')),u.indexOf("{range}")===-1&&o.push(new r.V(d,i,'"glyphs" url must include a "{range}" token')),o}function mo(d,i=r.a6,o={}){return As({key:o.key||"",value:d,valueSpec:Object.assign(i.$root,{"*":{type:"*"}}),styleSpec:i,style:d,objectElementValidators:{glyphs:Zl}})}function On(d,i=r.a6){return Ce(mo(d,i))}const $l=d=>Ce(ks(d)),Jl=d=>Ce(ql(d)),eh=d=>Ce(Ba(d)),mt=d=>Ce(Jn(d)),ya=d=>Ce(_a(d)),Wu=d=>Ce(function(i){const o=i.value,u=i.style,m=i.styleSpec,y=m.snow;if(o===void 0)return[];if(!r.H(o))return[new r.V("snow",o,`object expected, ${r.K(o)} found`)];let b=[];for(const A in o){const C=A.match(/^(.*)-transition$/);b=b.concat(C&&y[C[1]]&&y[C[1]].transition?Dr({key:A,value:o[A],valueSpec:m.transition,style:u,styleSpec:m}):y[A]?Dr({key:A,value:o[A],valueSpec:y[A],style:u,styleSpec:m}):[new r.a3(A,o[A],`unknown property "${A}"`)])}return b}(d)),qo=d=>Ce(function(i){const o=i.value,u=i.style,m=i.styleSpec,y=m.rain;if(o===void 0)return[];if(!r.H(o))return[new r.V("rain",o,`object expected, ${r.K(o)} found`)];let b=[];for(const A in o){const C=A.match(/^(.*)-transition$/);b=b.concat(C&&y[C[1]]&&y[C[1]].transition?Dr({key:A,value:o[A],valueSpec:m.transition,style:u,styleSpec:m}):y[A]?Dr({key:A,value:o[A],valueSpec:y[A],style:u,styleSpec:m}):[new r.a3(A,o[A],`unknown property "${A}"`)])}return b}(d)),Oe=d=>Ce(Yl(d)),K=d=>Ce(ga(d)),se=d=>Ce(Js(d)),pe=d=>Ce(fn(d)),Me=d=>Ce(r.a7(d));function Ce(d){return d.slice().sort((i,o)=>i.line&&o.line?i.line-o.line:0)}function Ee(d,i){let o=!1;if(i&&i.length)for(const u of i)u instanceof r.a3?r.w(u.message):(d.fire(new r.y(new Error(u.message))),o=!0);return o}let Ye;class De extends r.E{constructor(i,o="flat"){super(),this._transitionable=new r.a8(Ye||(Ye=new r.a9({anchor:new r.aa(r.a6.light.anchor),position:new r.ab(r.a6.light.position),color:new r.aa(r.a6.light.color),intensity:new r.aa(r.a6.light.intensity)}))),this.setLight(i,o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(i,o,u={}){this._validate(Jl,i,u)||(this._transitionable.setTransitionOrValue(i),this.id=o)}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,o,u){return(!u||u.validate!==!1)&&Ee(this,i.call(On,Object.assign({value:o,style:{glyphs:!0,sprite:!0},styleSpec:r.a6})))}}let Ze=class extends r.E{constructor(d,i,o,u,m){super(),this.scope=o,this._transitionable=new r.a8(new r.a9({source:new r.aa(r.a6.terrain.source),exaggeration:new r.aa(r.a6.terrain.exaggeration)}),o,u),this._transitionable.setTransitionOrValue(d,u),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=i,this.worldview=m}get(){return this._transitionable.serialize()}set(d,i){this._transitionable.setTransitionOrValue(d,i)}updateTransitions(d){this._transitioning=this._transitionable.transitioned(d,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(d){this.properties=this._transitioning.possiblyEvaluate(d)}getExaggeration(d){return this._transitioning.possiblyEvaluate(new r.ac(d,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const d=this._transitionable._values.exaggeration;if(!d)return null;const i=d.value.expression;if(!i)return null;let o=-1,u=-1,m=1;for(const y of i.zoomStops)m=i.evaluate(new r.ac(y,{worldview:this.worldview})),m>.01?(o=y,u=-1):u=y;return m<.01&&o>0&&u>o?[o,u]:null}isZoomDependent(){const d=this._transitionable._values.exaggeration;return d!=null&&d.value!=null&&d.value.expression!=null&&d.value.expression instanceof r.ad}};const wt=45,lt=65,Zt=.05;function ni(d,i,o,u){const m=r.ah(wt,lt,o),[y,b]=ci(d,u);let A=1-Math.min(1,Math.exp((i-y)/(b-y)*-6));return A*=A*A,A=Math.min(1,1.00747*A),A*m*d.alpha}function ci(d,i){const o=.5/Math.tan(.5*i);return[d.range[0]+o,d.range[1]+o]}function Ri(d,i,o,u,m){const y=r.af([],[i,o,u],m.mercatorFogMatrix);return ni(d,r.ag(y),m.pitch,m._fov)}function Li(d,i,o,u,m,y,b){const A=[[o,u,0],[m,u,0],[m,y,0],[o,y,0]];let C=Number.MAX_VALUE,z=-Number.MAX_VALUE;for(const D of A){const U=r.af([],D,i),F=r.ag(U);C=Math.min(C,F),z=Math.max(z,F)}return[ni(d,C,b.pitch,b._fov),ni(d,z,b.pitch,b._fov)]}class Bi extends r.E{constructor(i,o,u,m){super();const y=new r.a9({range:new r.aa(r.a6.fog.range),color:new r.aa(r.a6.fog.color),"color-use-theme":new r.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new r.aa(r.a6.fog["high-color"]),"high-color-use-theme":new r.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new r.aa(r.a6.fog["space-color"]),"space-color-use-theme":new r.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new r.aa(r.a6.fog["horizon-blend"]),"star-intensity":new r.aa(r.a6.fog["star-intensity"]),"vertical-range":new r.aa(r.a6.fog["vertical-range"])});this._transitionable=new r.a8(y,u,new Map(m)),this.set(i,m),this._transitioning=this._transitionable.untransitioned(),this._transform=o,this.properties=new r.ai(y),this.scope=u}get state(){const i=this._transform,o=i.projection.name==="globe",u=r.aj(i.zoom),m=this.properties.get("range"),y=[.5,3];return{range:o?[r.ak(y[0],m[0],u),r.ak(y[1],m[1],u)]:m,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(i,o,u={}){if(this._validate(ya,i,u))return;const m=Object.assign({},i);for(const y of Object.keys(r.a6.fog))m[y]===void 0&&(m[y]=r.a6.fog[y].default);this._options=m,this._transitionable.setTransitionOrValue(this._options,o)}getOpacity(i){if(!this._transform.projection.supportsFog)return 0;const o=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:r.ah(wt,lt,i))*o.a}getOpacityAtLatLng(i,o){return this._transform.projection.supportsFog?function(u,m,y){const b=r.ae.fromLngLat(m),A=y.elevation?y.elevation.getAtPointOrZero(b):0;return Ri(u,b.x,b.y,A,y)}(this.state,i,o):0}getOpacityForTile(i){if(!this._transform.projection.supportsFog)return[1,1];const o=this._transform.calculateFogTileMatrix(i.toUnwrapped());return Li(this.state,o,0,0,r.al,r.al,this._transform)}getOpacityForBounds(i,o,u,m,y){return this._transform.projection.supportsFog?Li(this.state,i,o,u,m,y,this._transform):[1,1]}getFovAdjustedRange(i){return this._transform.projection.supportsFog?ci(this.state,i):[0,1]}isVisibleOnFrustum(i){if(!this._transform.projection.supportsFog)return!1;const o=[4,5,6,7];for(const u of o){const m=i.points[u];let y;if(m[2]>=0)y=m;else{const b=i.points[u-4];y=r.am(b,m,b[2]/(b[2]-m[2]))}if(Ri(this.state,y[0],y[1],0,this._transform)>=Zt)return!0}return!1}updateConfig(i){this._transitionable.setTransitionOrValue(this._options,new Map(i))}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,o,u){return(!u||u.validate!==!1)&&Ee(this,i.call(On,Object.assign({value:o,style:{glyphs:!0,sprite:!0},styleSpec:r.a6})))}}let fr,Di,Yr,os,ls=class extends r.E{constructor(d,i,o,u){super();const m=fr||(fr=new r.a9({density:new r.aa(r.a6.snow.density),intensity:new r.aa(r.a6.snow.intensity),color:new r.aa(r.a6.snow.color),opacity:new r.aa(r.a6.snow.opacity),vignette:new r.aa(r.a6.snow.vignette),"vignette-color":new r.aa(r.a6.snow["vignette-color"]),"center-thinning":new r.aa(r.a6.snow["center-thinning"]),direction:new r.aa(r.a6.snow.direction),"flake-size":new r.aa(r.a6.snow["flake-size"])}));this._transitionable=new r.a8(m,o,new Map(u)),this.set(d,u),this._transitioning=this._transitionable.untransitioned(),this.properties=new r.ai(m),this.scope=o}get state(){const d=this.properties.get("opacity"),i=this.properties.get("color"),o=this.properties.get("direction"),u=r.an(o[0]),m=-Math.max(r.an(o[1]),.01),y=[Math.cos(u)*Math.cos(m),Math.sin(u)*Math.cos(m),Math.sin(m)],b=this.properties.get("vignette"),A=this.properties.get("vignette-color");return A.a=b,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new r.ao(i.r,i.g,i.b,i.a*d),direction:y,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:A}}get(){return this._transitionable.serialize()}set(d,i,o={}){if(this._validate(Wu,d,o))return;const u=Object.assign({},d);for(const m of Object.keys(r.a6.snow))u[m]===void 0&&(u[m]=r.a6.snow[m].default);this._options=u,this._transitionable.setTransitionOrValue(this._options,i)}updateConfig(d){this._transitionable.setTransitionOrValue(this._options,new Map(d))}updateTransitions(d){this._transitioning=this._transitionable.transitioned(d,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(d){this.properties=this._transitioning.possiblyEvaluate(d)}_validate(d,i,o){return(!o||o.validate!==!1)&&Ee(this,d.call(On,Object.assign({value:i,style:{glyphs:!0,sprite:!0},styleSpec:r.a6})))}},dr=class extends r.E{constructor(d,i,o,u){super();const m=Di||(Di=new r.a9({density:new r.aa(r.a6.rain.density),intensity:new r.aa(r.a6.rain.intensity),color:new r.aa(r.a6.rain.color),opacity:new r.aa(r.a6.rain.opacity),vignette:new r.aa(r.a6.rain.vignette),"vignette-color":new r.aa(r.a6.rain["vignette-color"]),"center-thinning":new r.aa(r.a6.rain["center-thinning"]),direction:new r.aa(r.a6.rain.direction),"droplet-size":new r.aa(r.a6.rain["droplet-size"]),"distortion-strength":new r.aa(r.a6.rain["distortion-strength"])}));this._transitionable=new r.a8(m,o,new Map(u)),this.set(d,u),this._transitioning=this._transitionable.untransitioned(),this.properties=new r.ai(m),this.scope=o}get state(){const d=this.properties.get("opacity"),i=this.properties.get("color"),o=this.properties.get("direction"),u=r.an(o[0]),m=-Math.max(r.an(o[1]),.01),y=[Math.cos(u)*Math.cos(m),Math.sin(u)*Math.cos(m),Math.sin(m)],b=this.properties.get("vignette-color");return b.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new r.ao(i.r,i.g,i.b,i.a*d),direction:y,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:b}}get(){return this._transitionable.serialize()}set(d,i,o={}){if(this._validate(qo,d,o))return;const u=Object.assign({},d);for(const m of Object.keys(r.a6.rain))u[m]===void 0&&(u[m]=r.a6.rain[m].default);this._options=u,this._transitionable.setTransitionOrValue(this._options,i)}updateConfig(d){this._transitionable.setTransitionOrValue(this._options,new Map(d))}updateTransitions(d){this._transitioning=this._transitionable.transitioned(d,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(d){this.properties=this._transitioning.possiblyEvaluate(d)}_validate(d,i,o){return(!o||o.validate!==!1)&&Ee(this,d.call(On,Object.assign({value:i,style:{glyphs:!0,sprite:!0},styleSpec:r.a6})))}};class Ki extends r.E{constructor(i,o,u,m){super(),this.scope=u,this._options=i,this.properties=new r.ai(o),this._transitionable=new r.a8(o,u,new Map(m)),this._transitionable.setTransitionOrValue(i.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(i){this._transitionable.setTransitionOrValue(this._options.properties,new Map(i))}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(i,o){this._options=i,this._transitionable.setTransitionOrValue(i.properties,o)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class Hr{constructor(i,o,u){this.screenBounds=i,this.cameraPoint=u.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=o,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,u)}static createFromScreenPoints(i,o){let u,m;if(i instanceof r.P||typeof i[0]=="number"){const y=r.P.convert(i);u=[y],m=o.isPointAboveHorizon(y)}else{const y=r.P.convert(i[0]),b=r.P.convert(i[1]),A=y.add(b)._div(2);u=[y,b],m=r.aq(y,b).every(C=>o.isPointAboveHorizon(C))&&o.isPointAboveHorizon(A)}return new Hr(u,m,o)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(i){return r.aq(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],i)}bufferedCameraGeometry(i){const o=this.screenBounds[0],u=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],m=r.aq(o,u,0,!1);return this.cameraPoint.y>u.y&&(this.cameraPoint.x>o.x&&this.cameraPoint.x<u.x?m.splice(3,0,this.cameraPoint):this.cameraPoint.x>=u.x?m[2]=this.cameraPoint:this.cameraPoint.x<=o.x&&(m[3]=this.cameraPoint)),r.ar(m,i)}bufferedCameraGeometryGlobe(i){const o=this.screenBounds[0],u=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],m=r.aq(o,u,i),y=this.cameraPoint.clone();switch(3*((y.y>o.y)+(y.y>u.y))+((y.x>o.x)+(y.x>u.x))){case 0:m[0]=y,m[4]=y.clone();break;case 1:m.splice(1,0,y);break;case 2:m[1]=y;break;case 3:m.splice(4,0,y);break;case 5:m.splice(2,0,y);break;case 6:m[3]=y;break;case 7:m.splice(3,0,y);break;case 8:m[2]=y}return m}containsTile(i,o,u,m=0){const y=i.queryPadding/o._pixelsPerMercatorPixel+1,b=u?this._bufferedCameraMercator(y,o):this._bufferedScreenMercator(y,o);let A=i.tileID.wrap+(b.unwrapped?m:0);const C=b.polygon.map(te=>r.as(i.tileTransform,te,A));if(!r.at(C,0,0,r.al,r.al))return;A=i.tileID.wrap+(this.screenGeometryMercator.unwrapped?m:0);const z=this.screenGeometryMercator.polygon.map(te=>r.au(i.tileTransform,te,A)),D=z.map(te=>new r.P(te[0],te[1])),U=o.getFreeCameraOptions().position||new r.ae(0,0,0),F=r.au(i.tileTransform,U,A),W=z.map(te=>{const J=r.av(te,te,F);return r.aw(J,J),new r.ax(F,J)}),X=r.ay(i,1,o.zoom)*o._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:D,tilespaceRays:W,bufferedTilespaceGeometry:C,bufferedTilespaceBounds:(Y=r.az(C),Y.min.x=r.aA(Y.min.x,0,r.al),Y.min.y=r.aA(Y.min.y,0,r.al),Y.max.x=r.aA(Y.max.x,0,r.al),Y.max.y=r.aA(Y.max.y,0,r.al),Y),tile:i,tileID:i.tileID,pixelToTileUnitsFactor:X};var Y}_bufferedScreenMercator(i,o){const u=Ms(i);if(this._screenRaycastCache[u])return this._screenRaycastCache[u];{let m;return m=o.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(i),o):{polygon:this.bufferedScreenGeometry(i).map(y=>o.pointCoordinate3D(y)),unwrapped:!0},this._screenRaycastCache[u]=m,m}}_bufferedCameraMercator(i,o){const u=Ms(i);if(this._cameraRaycastCache[u])return this._cameraRaycastCache[u];{let m;return m=o.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(i),o):{polygon:this.bufferedCameraGeometry(i).map(y=>o.pointCoordinate3D(y)),unwrapped:!0},this._cameraRaycastCache[u]=m,m}}_projectAndResample(i,o){const u=function(y,b){const A=r.aB([],b.pixelMatrix,b.globeMatrix),C=[0,-r.aD,0,1],z=[0,r.aD,0,1],D=[0,0,0,1];r.aC(C,C,A),r.aC(z,z,A),r.aC(D,D,A);const U=new r.P(C[0]/C[3],C[1]/C[3]),F=new r.P(z[0]/z[3],z[1]/z[3]),W=r.aE(y,U)&&C[3]<D[3],X=r.aE(y,F)&&z[3]<D[3];if(!W&&!X)return null;const Y=function(xe,_e,ge){for(let Ae=1;Ae<xe.length;Ae++){const je=Sr(_e.pointCoordinate3D(xe[Ae-1]).x),Re=Sr(_e.pointCoordinate3D(xe[Ae]).x);if(ge<0){if(je<Re)return{idx:Ae,t:-je/(Re-1-je)}}else if(Re<je)return{idx:Ae,t:(1-je)/(Re+1-je)}}return null}(y,b,W?-1:1);if(!Y)return null;const{idx:te,t:J}=Y;let re=te>1?Wr(y.slice(0,te),b):[],oe=te<y.length?Wr(y.slice(te),b):[];re=re.map(xe=>new r.P(Sr(xe.x),xe.y)),oe=oe.map(xe=>new r.P(Sr(xe.x),xe.y));const he=[...re];he.length===0&&he.push(oe[oe.length-1]);const ye=r.ak(he[he.length-1].y,(oe.length===0?re[0]:oe[0]).y,J);let me;return me=W?[new r.P(0,ye),new r.P(0,0),new r.P(1,0),new r.P(1,ye)]:[new r.P(1,ye),new r.P(1,1),new r.P(0,1),new r.P(0,ye)],he.push(...me),oe.length===0?he.push(re[0]):he.push(...oe),{polygon:he.map(xe=>new r.ae(xe.x,xe.y)),unwrapped:!1}}(i,o);if(u)return u;const m=function(y,b){let A=!1,C=-1/0,z=0;for(let U=0;U<y.length-1;U++)y[U].x>C&&(C=y[U].x,z=U);for(let U=0;U<y.length-1;U++){const F=(z+U)%(y.length-1),W=y[F],X=y[F+1];Math.abs(W.x-X.x)>.5&&(W.x<X.x?(W.x+=1,F===0&&(y[y.length-1].x+=1)):(X.x+=1,F+1===y.length-1&&(y[0].x+=1)),A=!0)}const D=r.aF(b.center.lng);return A&&D<Math.abs(D-1)&&y.forEach(U=>{U.x-=1}),{polygon:y,unwrapped:A}}(Wr(i,o).map(y=>new r.P(Sr(y.x),y.y)),o);return{polygon:m.polygon.map(y=>new r.ae(y.x,y.y)),unwrapped:m.unwrapped}}}function Wr(d,i){return r.aG(d,o=>{const u=i.pointCoordinate3D(o);o.x=u.x,o.y=u.y},1/256)}function Sr(d){return d<0?1+d%1:d%1}function Ms(d){return 100*d|0}function js(d,i,o,u,m){const y=function(A,C){if(A)return m(A);if(C){if(d.url&&C.tiles&&d.tiles&&delete d.tiles,C.variants){if(!Array.isArray(C.variants))return m(new Error("variants must be an array"));for(const D of C.variants){if(D==null||typeof D!="object"||D.constructor!==Object)return m(new Error("variant must be an object"));if(!Array.isArray(D.capabilities))return m(new Error("capabilities must be an array"));if(D.capabilities.length===1&&D.capabilities[0]==="meshopt"){C=Object.assign(C,D);break}}}const z=r.aH(Object.assign({},C,d),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);z.tiles=i.canonicalizeTileset(z,d.url),m(null,z)}},b=function(A,C,z){if(!A)return null;if(!C&&!z)return A;z=z||A.worldview_default;const D=Object.values(A.language||{});if(D.length===0)return null;const U=Object.values(A.worldview||{});if(U.length===0)return null;const F=D.every(X=>X===C),W=U.every(X=>X===z);return F&&W?A:C in(A.language_options||{})||z in(A.worldview_options||{})?null:A.language_options&&A.worldview_options?A:null}(d.data,o,u);return b?r.o.frame(()=>y(null,b)):d.url?r.m(i.transformRequest(i.normalizeSourceURL(d.url,null,o,u),r.R.Source),y):r.o.frame(()=>{const{data:A,...C}=d;y(null,C)})}function pn(d,i){const o=Math.pow(2,i.z),u=Math.floor(r.aF(d.getWest())*o),m=Math.floor(r.aJ(d.getNorth())*o),y=Math.ceil(r.aF(d.getEast())*o),b=Math.ceil(r.aJ(d.getSouth())*o);return i.x>=u&&i.x<y&&i.y>=m&&i.y<b}class xa{constructor(i,o,u){this.bounds=i?r.aI.convert(this.validateBounds(i)):null,this.minzoom=o||0,this.maxzoom=u||24}validateBounds(i){return Array.isArray(i)&&i.length===4?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]}addExtraBounds(i){if(i){this.extraBounds||(this.extraBounds=[]);for(const o of i)this.extraBounds.push(r.aI.convert(this.validateBounds(o)))}}contains(i){if(i.z>this.maxzoom||i.z<this.minzoom||this.bounds&&!pn(this.bounds,i))return!1;if(!this.extraBounds)return!0;for(const o of this.extraBounds)if(pn(o,i))return!0;return!1}static fromTileJSON(i){if(!i.bounds&&!i.extra_bounds)return null;const o=new xa(i.bounds,i.minzoom,i.maxzoom);return o.addExtraBounds(i.extra_bounds),o}}class Fs extends r.E{constructor(i,o,u,m){if(super(),this.id=i,this.dispatcher=u,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,r.aH(o,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},o),this._collectResourceTiming=!!o.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m),this._tileWorkers={},this._deduped=new r.aK}load(i){this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"}));const o=Array.isArray(this.map._language)?this.map._language.join():this.map._language,u=this.map.getWorldview();this._tileJSONRequest=js(this._options,this.map._requestManager,o,u,(m,y)=>{if(this._tileJSONRequest=null,this._loaded=!0,m)o&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${o}`),u&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${u}`),this.fire(new r.y(m));else if(y){if(Object.assign(this,y),this.hasWorldviews=!!y.worldview_options,y.worldview_default&&(this.worldviewDefault=y.worldview_default),y.vector_layers){this.vectorLayers=y.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const b of y.vector_layers)this.vectorLayerIds.push(b.id),y.worldview&&y.worldview[b.source]&&this.localizableLayerIds.add(b.id)}this.tileBounds=xa.fromTileJSON(y),Hi(y.tiles,this.map._requestManager._customAccessToken),this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))}i&&i(m)})}loaded(){return this._loaded}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}onAdd(i){this.map=i,this.load()}reload(){this.cancelTileJSONRequest();const i=r.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(i))}setTiles(i){return this._options.tiles=i,this.reload(),this}setUrl(i){return this.url=i,this._options.url=i,this.reload(),this}onRemove(i){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(i,o){const u=i.tileID.canonical.url(this.tiles,this.scheme),m=this.map._requestManager.normalizeTileURL(u),y=this.map._requestManager.transformRequest(m,r.R.Tile),b=this.map.style?this.map.style.getLut(this.scope):null,A=b?{image:b.image.clone()}:null,C={request:y,data:void 0,uid:i.uid,tileID:i.tileID,tileZoom:i.tileZoom,zoom:i.tileID.overscaledZ,maxZoom:this.maxzoom,lut:A,tileSize:this.tileSize*i.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:r.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:i.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:i.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault};if(this.hasWorldviews&&r.h(u)&&(C.localizableLayerIds=this.localizableLayerIds),C.request.collectResourceTiming=this._collectResourceTiming,i.actor&&i.state!=="expired")i.state==="loading"?i.reloadCallback=o:i.request=i.actor.send("reloadTile",C,z.bind(this));else if(i.actor=this._tileWorkers[m]=this._tileWorkers[m]||this.dispatcher.getActor(),this.dispatcher.ready)i.request=i.actor.send("loadTile",C,z.bind(this),void 0,!0);else{const D=r.aL.call({deduped:this._deduped},C,(U,F)=>{U||!F?z.call(this,U):(C.data={cacheControl:F.cacheControl,expires:F.expires,rawData:F.rawData.slice(0)},i.actor&&i.actor.send("loadTile",C,z.bind(this),void 0,!0))},!0);i.request={cancel:D}}function z(D,U){return delete i.request,i.aborted?o(null):D&&D.status!==404?o(D):(U&&U.resourceTiming&&(i.resourceTiming=U.resourceTiming),this.map._refreshExpiredTiles&&U&&i.setExpiryData(U),i.loadVectorData(U,this.map.painter),r.aM(this.dispatcher),o(null),void(i.reloadCallback&&(this.loadTile(i,i.reloadCallback),i.reloadCallback=null)))}}abortTile(i){i.request&&(i.request.cancel(),delete i.request),i.actor&&i.actor.send("abortTile",{uid:i.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(i,o){i.actor&&i.actor.send("removeTile",{uid:i.uid,type:this.type,source:this.id,scope:this.scope}),i.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Zo extends r.E{constructor(i,o,u,m){super(),this.id=i,this.dispatcher=u,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},o),Object.assign(this,r.aH(o,["url","scheme","tileSize"]))}load(i){this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"}));const o=this.map.getWorldview();this._tileJSONRequest=js(this._options,this.map._requestManager,null,o,(u,m)=>{this._tileJSONRequest=null,this._loaded=!0,u?this.fire(new r.y(u)):m&&(Object.assign(this,m),m.raster_layers&&(this.rasterLayers=m.raster_layers,this.rasterLayerIds=this.rasterLayers.map(y=>y.id)),this.tileBounds=xa.fromTileJSON(m),Hi(m.tiles),this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))),i&&i(u)})}loaded(){return this._loaded}onAdd(i){this.map=i,this.load()}reload(){this.cancelTileJSONRequest();const i=r.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(i))}setTiles(i){return this._options.tiles=i,this.reload(),this}setUrl(i){return this.url=i,this._options.url=i,this.reload(),this}onRemove(i){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}loadTile(i,o){const u=r.o.devicePixelRatio>=2,m=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),u,this.tileSize);i.request=r.n(this.map._requestManager.transformRequest(m,r.R.Tile),(y,b,A,C)=>(delete i.request,i.aborted?(i.state="unloaded",o(null)):y?(i.state="errored",o(y)):b?(this.map._refreshExpiredTiles&&i.setExpiryData({cacheControl:A,expires:C}),i.setTexture(b,this.map.painter),i.state="loaded",r.aM(this.dispatcher),void o(null)):o(null)))}abortTile(i,o){i.request&&(i.request.cancel(),delete i.request),o&&o()}unloadTile(i,o){i.texture&&i.texture instanceof r.T?(i.destroy(!0),i.texture&&i.texture instanceof r.T&&this.map.painter.saveTileTexture(i.texture)):i.destroy(),o&&o()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function ip([d,i],o,u,{scaled:m=!0}={}){const{tileSize:y,buffer:b}=u,{x:A,y:C,z}=o;if(!isFinite(A)||!isFinite(C)||!isFinite(z))throw new Error("Invalid MRT header");const D=2**z,U=D*r.aF(d),F=D*r.aJ(i);return function([W,X],Y,{scaled:te=!0}={}){if(!Y)throw new Error("bandView is undefined");const{data:J,tileSize:re,buffer:oe,offset:he,scale:ye,dimension:me}=Y;if(W<-oe||W>re+oe||X<-oe||X>re+oe)throw new Error(`Point (${W}, ${X}) out of bounds for tileSize=${re}, buffer=${oe}`);const xe=(X+oe)*(re+2*oe)+(W+oe);if(new Uint32Array(J.buffer)[xe]===4294967295)return null;let _e=[];_e=te?[]:new Y.data.constructor(me);for(let ge=0;ge<me;ge++)_e[ge]=Math.round(1e12*(J[me*xe+ge]*ye+he))/1e12;return _e}([Math.min(Math.max(-b,Math.floor((U-A)*y)),y-1+b),Math.min(Math.max(-b,Math.floor((F-C)*y)),y-1+b)],u,{scaled:m})}class Na extends Zo{constructor(i,o,u,m){super(i,o,u,m),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},o)}triggerRepaint(i){const o=this.map.painter._terrain,u=this.map.style.getSourceCache(this.id);o&&o.enabled&&u&&o._clearRenderCacheForTile(u.id,i.tileID),this.map.triggerRepaint()}loadTile(i,o){const u=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),m=this.map._requestManager.transformRequest(u,r.R.Tile),y={request:m,uid:i.uid,tileID:i.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};i.source=this.id,i.scope=this.scope,i.requestParams=m,i.actor||(i.actor=this.dispatcher.getActor());const b=(A,C,z,D)=>{if(delete i.request,i.aborted)return i.state="unloaded",o(null);if(A)return A.name==="AbortError"?void 0:(i.state="errored",o(A));if(this.map._refreshExpiredTiles&&C&&i.setExpiryData({cacheControl:z,expires:D}),this.partial&&i.state!=="expired")i.state="empty";else if(!this.partial){if(!C)return o(null);i.state="loaded",i._isHeaderLoaded=!0,i._mrt=C}o(null)};i.request=this.partial?i.fetchHeader(void 0,b.bind(this)):i.actor.send("loadTile",y,b.bind(this),void 0,!0)}abortTile(i){i.request&&(i.request.cancel(),delete i.request),i.actor&&i.actor.send("abortTile",{uid:i.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(i,o){const u=i.texturePerLayer;if(i.flushAllQueues(),u.size){i.destroy(!0);for(const m of u.values())this.map.painter.saveTileTexture(m)}else i.destroy()}prepareTile(i,o,u,m){i._isHeaderLoaded&&(i.state!=="empty"&&(i.state="reloading"),i.fetchBandForRender(o,u,m,(y,b)=>{if(y)return i.state="errored",this.fire(new r.y(y)),void this.triggerRepaint(i);b&&(i._isHeaderLoaded=!0,i.setTexturePerLayer(u,b,this.map.painter),i.state="loaded",this.triggerRepaint(i))}))}getInitialBand(i){if(!this.rasterLayers)return 0;const o=this.rasterLayers.find(({id:y})=>y===i),u=o&&o.fields,m=u&&u.bands&&u.bands;return m?m[0]:0}getTextureDescriptor(i,o,u){if(!i)return;const m=o.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!m)return;let y=null;o instanceof r.aP?y=o.paint.get("raster-array-band"):o instanceof r.aQ&&(y=o.paint.get("raster-particle-array-band"));const b=y||this.getInitialBand(m);if(b==null)return;if(!i.textureDescriptorPerLayer.get(o.id))return void this.prepareTile(i,m,o.id,b);if(i.updateNeeded(o.id,b)&&!u)return;const A=i.textureDescriptorPerLayer.get(o.id);return Object.assign({},A,{texture:i.texturePerLayer.get(o.id)})}getImages(i,o){const u=new Map;for(const m of i)for(const y of o){const[b,A]=y.split("/"),C=m.getLayer(b);if(!C||!C.hasBand(A)||!C.hasDataForBand(A))continue;const{bytes:z,tileSize:D,buffer:U}=C.getBandView(A),F=D+2*U,W={data:new r.q({width:F,height:F},z),pixelRatio:2,sdf:!1,usvg:!1,version:0};u.set(y,W)}return u}queryRasterArrayValueByBandId(i,o,u){const m=o._mrt;return new Promise(y=>{const b={},A=new Set;for(const[C,z]of Object.entries(m.layers)){if(u.layerName&&C!==u.layerName)continue;const D={};b[C]=D;for(const{bands:U}of z.dataIndex)for(const F of U)u.bands&&!u.bands.includes(F)||(A.add(r.B(C,F)),o.fetchBand(C,null,F,W=>{r.o.frame(()=>{D[F]=W?null:ip([i.lng,i.lat],m,z.getBandView(F)),A.delete(r.B(C,F)),A.size===0&&y(b)})},!1))}A.size===0&&y(b)})}_loadTileForQuery(i,o){if(this._loadTileLoaded[i.uid])return void o(null,i._mrt);if(this._loadTilePending[i.uid])return void this._loadTilePending[i.uid].push(o);this._loadTilePending[i.uid]=[o];const u=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),m=this.map._requestManager.transformRequest(u,r.R.Tile);i.actor.send("loadTile",{request:m,uid:i.uid,tileID:i.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},(y,b,A,C)=>y?(this._loadTilePending[i.uid].forEach(z=>z(y,null)),void delete this._loadTilePending[i.uid]):b?(this.map._refreshExpiredTiles&&b&&i.setExpiryData({cacheControl:A,expires:C}),i._mrt=b,i._isHeaderLoaded=!0,i.state="loaded",this._loadTilePending[i.uid].forEach(z=>z(null,b)),this._loadTileLoaded[i.uid]=!0,void delete this._loadTilePending[i.uid]):(this._loadTilePending[i.uid].forEach(z=>z(null,null)),void delete this._loadTilePending[i.uid]),void 0,!0)}queryRasterArrayValueByAllBands(i,o,u){return new Promise((m,y)=>{this._loadTileForQuery(o,(b,A)=>{b?y(b):m(A?this.queryRasterArrayValueByBandId(i,o,u):null)})})}queryRasterArrayValue(i,o){const u=r.aR.convert(i),m=this.findLoadedParent(u);return m&&m._mrt?o.bands||!this.partial?this.queryRasterArrayValueByBandId(u,m,o):this.queryRasterArrayValueByAllBands(u,m,o):Promise.resolve(null)}findLoadedParent(i){const o=r.ae.fromLngLat(i,this.map.transform.tileSize),u=this.maxzoom+1,m=1<<u,y=Math.floor(o.x),b=Math.floor((o.x-y)*m),A=Math.floor(o.y*m),C=this.map.style.getSourceCache(this.id),z=new r.aO(u,y,u,b,A);return C.findLoadedParent(z,this.minzoom)}}const $o={vector:Fs,raster:Zo,"raster-dem":class extends Zo{constructor(d,i,o,u){super(d,i,o,u),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox"}loadTile(d,i){const o=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function u(m,y){m&&(d.state="errored",i(m)),y&&(d.dem=y,d.dem.onDeserialize(),d.needsHillshadePrepare=!0,d.needsDEMTextureUpload=!0,d.state="loaded",i(null))}d.request=r.n(this.map._requestManager.transformRequest(o,r.R.Tile),(function(m,y,b,A){if(delete d.request,d.aborted)d.state="unloaded",i(null);else if(m)d.state="errored",i(m);else if(y){this.map._refreshExpiredTiles&&d.setExpiryData({cacheControl:b,expires:A});const C=ImageBitmap&&y instanceof ImageBitmap&&r.r(),z=1-(y.width-r.aN(y.width))/2;z<1||d.neighboringTiles||(d.neighboringTiles=this._getNeighboringTiles(d.tileID));const D=C?y:r.o.getImageData(y,z),U={uid:d.uid,tileID:d.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:D,encoding:this.encoding,padding:z};d.actor&&d.state!=="expired"||(d.actor=this.dispatcher.getActor(),d.actor.send("loadTile",U,u.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(d){const i=d.canonical,o=Math.pow(2,i.z),u=(i.x-1+o)%o,m=i.x===0?d.wrap-1:d.wrap,y=(i.x+1+o)%o,b=i.x+1===o?d.wrap+1:d.wrap,A={};return A[new r.aO(d.overscaledZ,m,i.z,u,i.y).key]={backfilled:!1},A[new r.aO(d.overscaledZ,b,i.z,y,i.y).key]={backfilled:!1},i.y>0&&(A[new r.aO(d.overscaledZ,m,i.z,u,i.y-1).key]={backfilled:!1},A[new r.aO(d.overscaledZ,d.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},A[new r.aO(d.overscaledZ,b,i.z,y,i.y-1).key]={backfilled:!1}),i.y+1<o&&(A[new r.aO(d.overscaledZ,m,i.z,u,i.y+1).key]={backfilled:!1},A[new r.aO(d.overscaledZ,d.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},A[new r.aO(d.overscaledZ,b,i.z,y,i.y+1).key]={backfilled:!1}),A}},"raster-array":Na,geojson:class extends r.E{constructor(d,i,o,u){super(),this.id=d,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=o.getActor(),this.setEventedParent(u),this._data=i.data,this._options=Object.assign({},i),this._collectResourceTiming=i.collectResourceTiming,i.maxzoom!==void 0&&(this.maxzoom=i.maxzoom),i.minzoom!==void 0&&(this.minzoom=i.minzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;const m=r.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(i.buffer!==void 0?i.buffer:128)*m,tolerance:(i.tolerance!==void 0?i.tolerance:.375)*m,extent:r.al,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:i.clusterMaxZoom!==void 0?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:r.al,radius:(i.clusterRadius!==void 0?i.clusterRadius:50)*m,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter,dynamic:i.dynamic},i.workerOptions)}onAdd(d){this.map=d,this.setData(this._data)}setData(d){return this._data=d,this._updateWorkerData(),this}updateData(d){if(!this._options.dynamic)return this.fire(new r.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof d!="string"&&(d.type==="Feature"&&(d={type:"FeatureCollection",features:[d]}),d.type!=="FeatureCollection"))return this.fire(new r.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof d!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const i=new Map;for(const o of this._data.features)i.set(o.id,o);for(const o of d.features)i.set(o.id,o);this._data.features=[...i.values()]}else this._data=d;return this._updateWorkerData(!0),this}getClusterExpansionZoom(d,i){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:d,source:this.id,scope:this.scope},i),this}getClusterChildren(d,i){return this.actor.send("geojson.getClusterChildren",{clusterId:d,source:this.id,scope:this.scope},i),this}getClusterLeaves(d,i,o,u){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:d,limit:i,offset:o},u),this}_updateWorkerData(d=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new r.z("dataloading",{dataType:"source"})),this._loaded=!1;const i=Object.assign({append:d},this.workerOptions);i.scope=this.scope;const o=this._data;typeof o=="string"?(i.request=this.map._requestManager.transformRequest(r.o.resolveURL(o),r.R.Source),i.request.collectResourceTiming=this._collectResourceTiming):i.data=JSON.stringify(o),this._pendingLoad=this.actor.send(`${this.type}.loadData`,i,(u,m)=>{if(this._loaded=!0,this._pendingLoad=null,u)this.fire(new r.y(u));else{const y={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&m&&m.resourceTiming&&m.resourceTiming[this.id]&&(y.resourceTiming=m.resourceTiming[this.id]),d&&(this._partialReload=!0),this.fire(new r.z("data",y)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(d),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const d=r.B(this.id,this.scope);this.map.style.clearSource(d),this._updateWorkerData()}loadTile(d,i){const o=d.actor?"reloadTile":"loadTile";d.actor=this.actor;const u=this.map.style?this.map.style.getLut(this.scope):null,m=u?{image:u.image.clone()}:null,y=this._partialReload,b={type:this.type,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:m,scope:this.scope,pixelRatio:r.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:d.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:y,worldview:this.map.getWorldview()};d.request=this.actor.send(o,b,(A,C)=>y&&!C?(d.state="loaded",i(null)):(delete d.request,d.destroy(),d.aborted?i(null):A?i(A):(d.loadVectorData(C,this.map.painter,o==="reloadTile"),i(null))),void 0,o==="loadTile")}abortTile(d){d.request&&(d.request.cancel(),delete d.request),d.aborted=!0}unloadTile(d,i){this.actor.send("removeTile",{uid:d.uid,type:this.type,source:this.id,scope:this.scope}),d.destroy()}onRemove(d){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends r.aS{constructor(d,i,o,u){super(d,i,o,u),this.roundZoom=!0,this.type="video",this.options=i}load(){this._loaded=!1;const d=this.options;this.urls=[];for(const i of d.urls)this.urls.push(this.map._requestManager.transformRequest(i,r.R.Source).url);r.aT(this.urls,(i,o)=>{this._loaded=!0,i?this.fire(new r.y(i)):o&&(this.video=o,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(d){if(this.video){const i=this.video.seekable;d<i.start(0)||d>i.end(0)?this.fire(new r.y(new r.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=d}}getVideo(){return this.video}onAdd(d){this.map||(this.map=d,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const d=this.map.painter.context,i=d.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new r.T(d,this.video,i.RGBA8),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(d)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:r.aS,model:class extends r.E{constructor(d,i,o,u){super(),this.id=d,this.type="model",this.models=[],this._loaded=!1,this._options=i}load(){const d=[];for(const i in this._options.models){const o=this._options.models[i],u=r.aV(this.map._requestManager.transformRequest(o.uri,r.R.Model).url).then(m=>{if(!m)return;const y=r.aW(m),b=new r.aX(i,o.position,o.orientation,y);b.computeBoundsAndApplyParent(),this.models.push(b)}).catch(m=>{this.fire(new r.y(new Error(`Could not load model ${i} from ${o.uri}: ${m.message}`)))});d.push(u)}Promise.allSettled(d).then(()=>{this._loaded=!0,this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(i=>{this._loaded=!0,this.fire(new r.y(new Error(`Could not load models: ${i.message}`)))})}onAdd(d){this.map=d,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(d,i){}serialize(){return this._options}},"batched-model":class extends r.E{constructor(d,i,o,u){super(),this.type="batched-model",this.id=d,this.tileSize=512,this._options=i,this.tiles=this._options.tiles,this.maxzoom=i.maxzoom||19,this.minzoom=i.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=o,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(u)}onAdd(d){this.map=d,this.load()}reload(){this.cancelTileJSONRequest();const d=r.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(d))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(d){this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"}));const i=Array.isArray(this.map._language)?this.map._language.join():this.map._language,o=this.map.getWorldview();this._tileJSONRequest=js(this._options,this.map._requestManager,i,o,(u,m)=>{this._tileJSONRequest=null,this._loaded=!0,u?(i&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${i}`),o&&o.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${o}`),this.fire(new r.y(u))):m&&(Object.assign(this,m),m.bounds&&(this.tileBounds=new xa(m.bounds,this.minzoom,this.maxzoom)),Hi(m.tiles,this.map._requestManager._customAccessToken),this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))),d&&d(u)})}hasTransition(){return!1}hasTile(d){return!this.tileBounds||this.tileBounds.contains(d.canonical)}loaded(){return this._loaded}loadTile(d,i){const o=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme)),u={request:this.map._requestManager.transformRequest(o,r.R.Tile),data:void 0,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,tileSize:this.tileSize*d.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:d.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:r.o.devicePixelRatio,promoteId:this.promoteId};if(d.actor&&d.state!=="expired")if(d.state==="loading")d.reloadCallback=i;else{if(d.buckets){const y=Object.values(d.buckets);for(const b of y)b.dirty=!0;return void(d.state="loaded")}d.request=d.actor.send("reloadTile",u,m.bind(this))}else d.actor=this.dispatcher.getActor(),d.request=d.actor.send("loadTile",u,m.bind(this),void 0,!0);function m(y,b){return d.aborted?i(null):y&&y.status!==404?i(y):(this.map._refreshExpiredTiles&&b&&d.setExpiryData(b),d.loadModelData(b,this.map.painter),d.state="loaded",void i(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends r.aS{constructor(d,i,o,u){super(d,i,o,u),i.coordinates?Array.isArray(i.coordinates)&&i.coordinates.length===4&&!i.coordinates.some(m=>!Array.isArray(m)||m.length!==2||m.some(y=>typeof y!="number"))||this.fire(new r.y(new r.V(`sources.${d}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new r.y(new r.V(`sources.${d}`,null,'missing required property "coordinates"'))),i.animate&&typeof i.animate!="boolean"&&this.fire(new r.y(new r.V(`sources.${d}`,null,'optional "animate" property must be a boolean value'))),i.canvas?typeof i.canvas=="string"||i.canvas instanceof HTMLCanvasElement||this.fire(new r.y(new r.V(`sources.${d}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new r.y(new r.V(`sources.${d}`,null,'missing required property "canvas"'))),this.options=i,this.animate=i.animate===void 0||i.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new r.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(d){this.map=d,this.load(),this.canvas&&this.animate&&this.play()}onRemove(d){this.pause()}prepare(){let d=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,d=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,d=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const i=this.map.painter.context;this.texture?!d&&!this._playing||this.texture instanceof r.aU||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new r.T(i,this.canvas,i.gl.RGBA8,{premultiply:!0}),this._prepareData(i)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const d of[this.canvas.width,this.canvas.height])if(isNaN(d)||d<=0)return!0;return!1}},custom:class extends r.E{constructor(d,i,o,u){super(),this.id=d,this.type="custom",this._dataType="raster",this._dispatcher=o,this._implementation=i,this.setEventedParent(u),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new r.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new r.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new xa(this._implementation.bounds,this.minzoom,this.maxzoom)),i.update=this._update.bind(this),i.clearTiles=this._clearTiles.bind(this),i.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,r.aH(i,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return r.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(d){this.map=d,this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(d),this.load()}onRemove(d){this._implementation.onRemove&&this._implementation.onRemove(d)}hasTile(d){if(this._implementation.hasTile){const{x:i,y:o,z:u}=d.canonical;return this._implementation.hasTile({x:i,y:o,z:u})}return!this.tileBounds||this.tileBounds.contains(d.canonical)}loadTile(d,i){const{x:o,y:u,z:m}=d.tileID.canonical,y=new AbortController;d.request=Promise.resolve(this._implementation.loadTile({x:o,y:u,z:m},{signal:y.signal})).then((function(b){return delete d.request,d.aborted?(d.state="unloaded",i(null)):b===void 0?(d.state="errored",i(null)):b===null?(this.loadTileData(d,{width:this.tileSize,height:this.tileSize,data:null}),d.state="loaded",i(null)):function(A){return A instanceof ImageData||A instanceof HTMLCanvasElement||A instanceof ImageBitmap||A instanceof HTMLImageElement}(b)?(this.loadTileData(d,b),d.state="loaded",void i(null)):(d.state="errored",i(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(b=>{b.name!=="AbortError"&&(d.state="errored",i(b))}),d.request.cancel=()=>y.abort()}loadTileData(d,i){d.setTexture(i,this.map.painter)}unloadTile(d,i){if(d.texture&&d.texture instanceof r.T?(d.destroy(!0),d.texture&&d.texture instanceof r.T&&this.map.painter.saveTileTexture(d.texture)):d.destroy(),this._implementation.unloadTile){const{x:o,y:u,z:m}=d.tileID.canonical;this._implementation.unloadTile({x:o,y:u,z:m})}i&&i()}abortTile(d,i){d.request&&d.request.cancel&&(d.request.cancel(),delete d.request),i&&i()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(d=>({x:d.canonical.x,y:d.canonical.y,z:d.canonical.z}))}_clearTiles(){const d=r.B(this.id,this.scope);this.map.style.clearSource(d)}_update(){this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))}}},Kl=function(d,i,o,u){const m=new $o[i.type](d,i,o,u);if(m.id!==d)throw new Error(`Expected Source id to be ${d} instead of ${m.id}`);return r.aY(["load","abort","unload","serialize","prepare"],m),m};function Ql(d,i,o=""){return`${o}:${i.id||""}:${i.layer.id}:${function(u){if("layerId"in u)return`layer:${u.layerId}`;{const{featuresetId:m,importId:y}=u;return`featureset:${m}${y?`:import:${y}`:""}`}}(d.target)}`}function Va(d,i,o,u=""){if(d.uniqueFeatureID){const m=Ql(d,i,u);if(o.has(m))return!0;o.add(m)}return!1}function ec(d,i,o,u,m=!1){const y=i.sourceCache.transform,b=i.sourceCache.tilesIn(d,i.has3DLayers,m);b.sort(Xu);const A=[];for(const C of b){const z=C.tile.queryRenderedFeatures(i,C,o,u,y,m);Object.keys(z).length&&A.push({wrappedTileID:C.tile.tileID.wrapped().key,queryResults:z})}return A.length===0?{}:function(C){const z={},D={};for(const U of C){const F=U.queryResults,W=U.wrappedTileID,X=D[W]=D[W]||{};for(const Y in F){const te=F[Y],J=X[Y]=X[Y]||{},re=z[Y]=z[Y]||[];for(const oe of te)J[oe.featureIndex]||(J[oe.featureIndex]=!0,re.push(oe))}}return z}(A)}function Gu(d,i,o,u,m,y){const b={},A=u.queryRenderedSymbols(d),C=[];for(const z of Object.keys(A).map(Number))C.push(m[z]);C.sort(Xu);for(const z of C){const D=z.featureIndex.lookupSymbolFeatures(A[z.bucketInstanceId],z.bucketIndex,z.sourceLayerIndex,i,o,y);for(const U in D){const F=b[U]=b[U]||[],W=D[U];W.sort((X,Y)=>{const te=z.featureSortOrder;if(te){const J=te.indexOf(X.featureIndex);return te.indexOf(Y.featureIndex)-J}return Y.featureIndex-X.featureIndex});for(const X of W)F.push(X)}}return b}function Kn(d,i){const o=d.getRenderableIds().map(y=>d.getTileByID(y)),u=[],m={};for(let y=0;y<o.length;y++){const b=o[y],A=b.tileID.canonical.key;m[A]||(m[A]=!0,b.querySourceFeatures(u,i))}return u}function Xu(d,i){const o=d.tileID,u=i.tileID;return o.overscaledZ-u.overscaledZ||o.canonical.y-u.canonical.y||o.wrap-u.wrap||o.canonical.x-u.canonical.x}function th(d,i){const o={};if(!i)return o;for(const u of d){const m=u.layerIds.map(y=>i.getLayer(y)).filter(Boolean);if(m.length!==0){u.layers=m,u.stateDependentLayerIds&&(u.stateDependentLayers=u.stateDependentLayerIds.map(y=>m.filter(b=>b.id===y)[0]));for(const y of m)o[y.fqid]=u}}return o}const gn=32,Fn=33,va=new Uint16Array(8184);for(let d=0;d<2046;d++){let i=d+2,o=0,u=0,m=0,y=0,b=0,A=0;for(1&i?m=y=b=gn:o=u=A=gn;(i>>=1)>1;){const z=o+m>>1,D=u+y>>1;1&i?(m=o,y=u,o=b,u=A):(o=m,u=y,m=b,y=A),b=z,A=D}const C=4*d;va[C+0]=o,va[C+1]=u,va[C+2]=m,va[C+3]=y}const Bn=new Uint16Array(2178),Hs=new Uint8Array(1089),_o=new Uint16Array(1089);function Yu(d){return d===0?-.03125:d===32?.03125:0}const tc={type:2,extent:r.al,loadGeometry:()=>[[new r.P(0,0),new r.P(r.al+1,0),new r.P(r.al+1,r.al+1),new r.P(0,r.al+1),new r.P(0,0)]]};class Ua{constructor(i,o,u,m,y,b){this.tileID=i,this.uid=r.b2(),this.uses=0,this.tileSize=o,this.tileZoom=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=y,m&&m.style&&(this._lastUpdatedBrightness=m.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",m&&m.transform&&(this.projection=m.transform.projection),this.worldview=b}registerFadeDuration(i){const o=i+this.timeAdded;o<r.o.now()||this.fadeEndTime&&o<this.fadeEndTime||(this.fadeEndTime=o)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=r.aZ(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(i,o,u){if(this.unloadVectorData(),this.state="loaded",i){i.featureIndex&&(this.latestFeatureIndex=i.featureIndex,i.rawTileData?(this.latestRawTileData=i.rawTileData,this.latestFeatureIndex.rawTileData=i.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=i.collisionBoxArray,this.buckets=th(i.buckets,o.style),this.hasSymbolBuckets=!1;for(const m in this.buckets){const y=this.buckets[m];if(y instanceof r.b4){if(this.hasSymbolBuckets=!0,!u)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const m in this.buckets){const y=this.buckets[m];if(y instanceof r.b4&&y.hasRTLText){this.hasRTLText=!0,r.b5();break}}this.queryPadding=0;for(const m in this.buckets){const y=this.buckets[m],b=o.style.getOwnLayer(m);if(!b)continue;const A=b.queryRadius(y);this.queryPadding=Math.max(this.queryPadding,A)}i.imageAtlas&&(this.imageAtlas=i.imageAtlas),i.glyphAtlasImage&&(this.glyphAtlasImage=i.glyphAtlasImage),i.lineAtlas&&(this.lineAtlas=i.lineAtlas),this._lastUpdatedBrightness=i.brightness}else this.collisionBoxArray=new r.b3}unloadVectorData(){if(this.hasData()){for(const i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(i,o,u){i&&(i.resourceTiming&&(this.resourceTiming=i.resourceTiming),this.buckets=Object.assign({},this.buckets,th(i.buckets,o.style)),i.featureIndex&&(this.latestFeatureIndex=i.featureIndex))}getBucket(i){return this.buckets[i.fqid]}upload(i){for(const m in this.buckets){const y=this.buckets[m];y.uploadPending()&&y.upload(i)}const o=i.gl,u=this.imageAtlas;u&&!u.uploaded&&(this.imageAtlasTexture=new r.T(i,u.image,o.RGBA8,{useMipmap:!!u.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new r.T(i,this.glyphAtlasImage,o.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new r.T(i,this.lineAtlas.image,o.R8),this.lineAtlas.uploaded=!0)}prepare(i,o,u){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(i,this.imageAtlasTexture,u),!o||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const m=o.style.getBrightness();(this._lastUpdatedBrightness||m)&&(this._lastUpdatedBrightness&&m&&Math.abs(this._lastUpdatedBrightness-m)<.001||(this.updateBuckets(o,this._lastUpdatedBrightness!==m),this._lastUpdatedBrightness=m))}queryRenderedFeatures(i,o,u,m,y,b){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const A=function(C,z){const D=r.bq([],[.5*C.width,.5*-C.height,1]);return r.br(D,D,[1,-1,0]),r.aB(D,D,C.calculateProjMatrix(z.toUnwrapped())),Float32Array.from(D)}(y,this.tileID);return this.latestFeatureIndex.query(i,{tilespaceGeometry:o,pixelPosMatrix:A,transform:m,availableImages:u,tileTransform:this.tileTransform,worldview:this.worldview})}querySourceFeatures(i,o){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const m=u.loadVTLayers(),y=o?o.sourceLayer:"",b=m._geojsonTileLayer||m[y];if(!b)return;const A=r.b6(o&&o.filter),{z:C,x:z,y:D}=this.tileID.canonical,U={z:C,x:z,y:D};for(let F=0;F<b.length;F++){const W=b.feature(F);if(A.needGeometry){const te=r.b7(W,!0);if(!A.filter(new r.ac(this.tileID.overscaledZ,{worldview:this.worldview}),te,this.tileID.canonical))continue}else if(!A.filter(new r.ac(this.tileID.overscaledZ,{worldview:this.worldview}),W))continue;const X=u.getId(W,y),Y=new r.b8(W,C,z,D,X);Y.tile=U,i.push(Y)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(i){const o=this.expirationTime;if(i.cacheControl){const u=r.b9(i.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else i.expires&&(this.expirationTime=new Date(i.expires).getTime());if(this.expirationTime){const u=Date.now();let m=!1;if(this.expirationTime>u)m=!1;else if(o)if(this.expirationTime<o)m=!0;else{const y=this.expirationTime-o;y?this.expirationTime=u+Math.max(y,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(i){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&i&&this.updateBuckets(i)}updateBuckets(i,o){if(!this.latestFeatureIndex||!i.style)return;const u=this.latestFeatureIndex.loadVTLayers(),m=i.style.listImages(),y=i.style.getBrightness();for(const b in this.buckets){if(!i.style.hasLayer(b))continue;const A=this.buckets[b],C=A.layers[0],z=C.sourceLayer||"_geojsonTileLayer",D=u[z],U=i.style.getLayerSourceCache(C);let F={};U&&(F=U._state.getState(z,void 0));const W=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},X=Object.keys(F).length>0&&!o;(X&&A.stateDependentLayers.length!==0||o)&&A.update(F,D,m,W,X?A.stateDependentLayers:A.layers,o,y),(A instanceof r.ba||A instanceof r.bb)&&i._terrain&&i._terrain.enabled&&U&&A.uploadPending()&&i._terrain._clearRenderCacheForTile(U.id,this.tileID);const Y=i&&i.style&&i.style.getOwnLayer(b);Y&&(this.queryPadding=Math.max(this.queryPadding,Y.queryRadius(A)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<r.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(i){this.symbolFadeHoldUntil=r.o.now()+i}setTexture(i,o){const u=o.context,m=u.gl;this.texture=this.texture||o.getTileTexture(i.width),this.texture&&this.texture instanceof r.T?this.texture.update(i):(this.texture=new r.T(u,i,m.RGBA8,{useMipmap:!0}),this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE))}setDependencies(i,o){const u={};for(const m of o)u[m]=!0;this.dependencies[i]=u}hasDependency(i,o){for(const u of i){const m=this.dependencies[u];if(m){for(const y of o)if(m[y])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(i,o){if(!o||o.name==="mercator"||this._tileDebugBuffer)return;const u=r.bc(tc,this.tileID.canonical,this.tileTransform)[0],m=new r.bd,y=new r.be;for(let b=0;b<u.length;b++){const{x:A,y:C}=u[b];m.emplaceBack(A,C),y.emplaceBack(b)}y.emplaceBack(0),this._tileDebugIndexBuffer=i.createIndexBuffer(y),this._tileDebugBuffer=i.createVertexBuffer(m,r.bf.members),this._tileDebugSegments=r.bg.simpleSegment(0,0,m.length,y.length)}_makeTileBoundsBuffers(i,o){if(this._tileBoundsBuffer||!o||o.name==="mercator")return;const u=r.bc(tc,this.tileID.canonical,this.tileTransform)[0];let m,y;if(this.isRaster){const b=function(A,C){const z=r.aZ(A,C),D=Math.pow(2,A.z);for(let te=0;te<Fn;te++)for(let J=0;J<Fn;J++){const re=r.a_((A.x+(J+Yu(J))/gn)/D),oe=r.a$((A.y+(te+Yu(te))/gn)/D),he=C.project(re,oe),ye=te*Fn+J;Bn[2*ye+0]=Math.round((he.x*z.scale-z.x)*r.al),Bn[2*ye+1]=Math.round((he.y*z.scale-z.y)*r.al)}Hs.fill(0),_o.fill(0);for(let te=2045;te>=0;te--){const J=4*te,re=va[J+0],oe=va[J+1],he=va[J+2],ye=va[J+3],me=re+he>>1,xe=oe+ye>>1,_e=me+xe-oe,ge=xe+re-me,Ae=oe*Fn+re,je=ye*Fn+he,Re=xe*Fn+me,Je=Math.hypot((Bn[2*Ae+0]+Bn[2*je+0])/2-Bn[2*Re+0],(Bn[2*Ae+1]+Bn[2*je+1])/2-Bn[2*Re+1])>=16;Hs[Re]=Hs[Re]||(Je?1:0),te<1022&&(Hs[Re]=Hs[Re]||Hs[(oe+ge>>1)*Fn+(re+_e>>1)]||Hs[(ye+ge>>1)*Fn+(he+_e>>1)])}const U=new r.b0,F=new r.b1;let W=0;function X(te,J){const re=J*Fn+te;return _o[re]===0&&(U.emplaceBack(Bn[2*re+0],Bn[2*re+1],te*r.al/gn,J*r.al/gn),_o[re]=++W),_o[re]-1}function Y(te,J,re,oe,he,ye){const me=te+re>>1,xe=J+oe>>1;if(Math.abs(te-he)+Math.abs(J-ye)>1&&Hs[xe*Fn+me])Y(he,ye,te,J,me,xe),Y(re,oe,he,ye,me,xe);else{const _e=X(te,J),ge=X(re,oe),Ae=X(he,ye);F.emplaceBack(_e,ge,Ae)}}return Y(0,0,gn,gn,gn,0),Y(gn,gn,0,0,0,gn),{vertices:U,indices:F}}(this.tileID.canonical,o);m=b.vertices,y=b.indices}else{m=new r.b0,y=new r.b1;for(const{x:A,y:C}of u)m.emplaceBack(A,C,0,0);const b=r.bh(m.int16.subarray(0,4*m.length),void 0,4);for(let A=0;A<b.length;A+=3)y.emplaceBack(b[A],b[A+1],b[A+2])}this._tileBoundsBuffer=i.createVertexBuffer(m,r.bi.members),this._tileBoundsIndexBuffer=i.createIndexBuffer(y),this._tileBoundsSegments=r.bg.simpleSegment(0,0,m.length,y.length)}_makeGlobeTileDebugBuffers(i,o){const u=o.projection;if(!u||u.name!=="globe"||o.freezeTileCoverage)return;const m=this.tileID.canonical,y=r.bj(m,o),b=r.bk(y),A=r.aj(o.zoom);let C;A>0&&(C=r.bl(new Float64Array(16),o.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(i,m,o,b,C,A),this._makeGlobeTileDebugTextBuffer(i,m,o,b,C,A)}_globePoint(i,o,u,m,y,b,A){let C=r.bm(i,o,u);if(b){const z=1<<u.z,D=r.aF(m.center.lng),U=r.aJ(m.center.lat),F=(u.x+.5)/z-D;let W=0;F>.5?W=-1:F<-.5&&(W=1);let X=(i/r.al+u.x)/z+W,Y=(o/r.al+u.y)/z;X=(X-D)*m._pixelsPerMercatorPixel+D,Y=(Y-U)*m._pixelsPerMercatorPixel+U;const te=[X*m.worldSize,Y*m.worldSize,0];r.af(te,te,b),C=r.bn(C,te,A)}return r.af(C,C,y)}_makeGlobeTileDebugBorderBuffer(i,o,u,m,y,b){const A=new r.bd,C=new r.be,z=new r.bo,D=(F,W,X,Y,te)=>{const J=(X-F)/(te-1),re=(Y-W)/(te-1),oe=A.length;for(let he=0;he<te;he++){const ye=F+he*J,me=W+he*re;A.emplaceBack(ye,me);const xe=this._globePoint(ye,me,o,u,m,y,b);z.emplaceBack(xe[0],xe[1],xe[2]),C.emplaceBack(oe+he)}},U=r.al;D(0,0,U,0,16),D(U,0,U,U,16),D(U,U,0,U,16),D(0,U,0,0,16),this._tileDebugIndexBuffer=i.createIndexBuffer(C),this._tileDebugBuffer=i.createVertexBuffer(A,r.bf.members),this._globeTileDebugBorderBuffer=i.createVertexBuffer(z,r.bp.members),this._tileDebugSegments=r.bg.simpleSegment(0,0,A.length,C.length)}_makeGlobeTileDebugTextBuffer(i,o,u,m,y,b){const A=r.al/4,C=new r.bd,z=new r.b1,D=new r.bo,U=25;z.reserve(32),C.reserve(U),D.reserve(U);const F=(W,X)=>U*W+X;for(let W=0;W<U;W++){const X=W*A;for(let Y=0;Y<U;Y++){const te=Y*A;C.emplaceBack(te,X);const J=this._globePoint(te,X,o,u,m,y,b);D.emplaceBack(J[0],J[1],J[2])}}for(let W=0;W<4;W++)for(let X=0;X<4;X++){const Y=F(W,X),te=F(W,X+1),J=F(W+1,X),re=F(W+1,X+1);z.emplaceBack(Y,te,J),z.emplaceBack(J,te,re)}this._tileDebugTextIndexBuffer=i.createIndexBuffer(z),this._tileDebugTextBuffer=i.createVertexBuffer(C,r.bf.members),this._globeTileDebugTextBuffer=i.createVertexBuffer(D,r.bp.members),this._tileDebugTextSegments=r.bg.simpleSegment(0,0,U,32)}destroy(i=!1){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!i&&this.texture&&this.texture instanceof r.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}r.bs.setPbf(r.bt);class ic extends Ua{constructor(i,o,u,m,y){super(i,o,u,m,y),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(i){return this._mrt&&this._mrt.getLayer(i)}setTexturePerLayer(i,o,u){const m=u.context,y=m.gl;let b=this.texturePerLayer.get(i)||u.getTileTexture(o.width);b&&b instanceof r.T?b.update(o,{premultiply:!1}):b=new r.T(m,o,y.RGBA8,{premultiply:!1}),this.texturePerLayer.has(i)||this.texturePerLayer.set(i,b)}flushQueues(i){const o=this._workQueuePerLayer.get(i)||[],u=this._fetchQueuePerLayer.get(i)||[];for(;o.length;)o.pop()();for(;u.length;)u.pop()()}flushAllQueues(){for(const i of this._workQueuePerLayer.keys()){const o=this._workQueuePerLayer.get(i)||[];for(;o.length;)o.pop()()}for(const i of this._fetchQueuePerLayer.keys()){const o=this._fetchQueuePerLayer.get(i)||[];for(;o.length;)o.pop()()}}fetchHeader(i=16384,o){const u=this._mrt=new r.bs(30),m=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(i-1)}});return this.entireBuffer=null,this.request=r.bu(m,(y,b,A,C)=>{if(y)o(y);else try{const z=u.getHeaderLength(b);if(z>i)return void(this.request=this.fetchHeader(z,o));u.parseHeader(b),this._isHeaderLoaded=!0;let D=0;for(const U of Object.values(u.layers))D=Math.max(D,U.dataIndex[U.dataIndex.length-1].lastByte);b.byteLength>=D&&(this.entireBuffer=b),o(null,this.entireBuffer||b,A,C)}catch(z){o(z)}}),this.request}fetchBandForRender(i,o,u,m){this.fetchBand(i,o,u,y=>{if(y)return void m(y);this.updateTextureDescriptor(i,o,u);const b=this.textureDescriptorPerLayer.get(o);m(null,b?b.img:null)})}fetchBand(i,o,u,m,y=!0){const b=this._mrt;if(!this._isHeaderLoaded||!b)return void m(new Error("Tile header is not ready"));const A=this.actor;if(!A)return void m(new Error("Can't fetch tile band without an actor"));let C;const z=r.B(String(u),r.B(this.tileID.key,i));let D=this._taskQueue.get(z);D?D.add(m):(D=new Set,D.add(m),this._taskQueue.set(z,D));const U=(Y,te)=>{C.complete(Y,te),Y?m(Y):(D.values().forEach(J=>J(null,te)),this._taskQueue.delete(z))},F=(Y,te)=>{if(Y)return m(Y);const J=A.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:te,task:C},U,void 0,!0);if(o!==null){const re=this._workQueuePerLayer.get(o)||[];re.push(()=>{J&&J.cancel(),C.cancel()}),this._workQueuePerLayer.has(o)||this._workQueuePerLayer.set(o,re)}};let W;try{W=b.getLayer(i)}catch(Y){if(this.state==="reloading")return;throw Y}if(!W)return void m(new Error(`Unknown sourceLayer "${i}"`));if(W.hasDataForBand(u))return D.values().forEach(Y=>Y(null,null)),void this._taskQueue.delete(z);const X=W.getDataRange([u]);if(C=b.createDecodingTask(X),!C||C.tasks.length)if(o!==null&&this.flushQueues(o),this.entireBuffer)F(null,this.entireBuffer.slice(X.firstByte,X.lastByte+1));else{const Y=Object.assign({},this.requestParams,{headers:{Range:`bytes=${X.firstByte}-${X.lastByte}`}}),te=r.bu(Y,F);if(o!==null){const J=this._fetchQueuePerLayer.get(o)||[];J.push(()=>{te.cancel(),C.cancel()}),this._fetchQueuePerLayer.has(o)||this._fetchQueuePerLayer.set(o,J)}}}updateNeeded(i,o){return(!this.textureDescriptorPerLayer.get(i)||this.textureDescriptorPerLayer.get(i).band!==o||this.refreshedUponExpiration)&&this.state!=="errored"}updateTextureDescriptor(i,o,u){if(!this._mrt)return;const m=this._mrt.getLayer(i);if(!m||!m.hasBand(u)||!m.hasDataForBand(u))return;const{bytes:y,tileSize:b,buffer:A,offset:C,scale:z}=m.getBandView(u),D=b+2*A,U=new r.q({width:D,height:D},y),F=this.texturePerLayer.get(o);F&&F instanceof r.T&&F.update(U,{premultiply:!1}),this.textureDescriptorPerLayer.set(o,{layer:i,band:u,img:U,buffer:A,offset:C,tileSize:b,format:m.pixelFormat,mix:[z,256*z,65536*z,16777216*z]})}destroy(i=!1){if(super.destroy(i),delete this._mrt,!i)for(const o of this.texturePerLayer.values())o&&o instanceof r.T&&o.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class rc{constructor(i,o){this.max=i,this.onRemove=o,this.reset()}reset(){for(const i in this.data)for(const o of this.data[i])o.timeout&&clearTimeout(o.timeout),this.onRemove(o.value);return this.data={},this.order=[],this}add(i,o,u){const m=i.wrapped().key;this.data[m]===void 0&&(this.data[m]=[]);const y={value:o,timeout:void 0};if(u!==void 0&&(y.timeout=setTimeout(()=>{this.remove(i,y)},u)),this.data[m].push(y),this.order.push(m),this.order.length>this.max){const b=this._getAndRemoveByKey(this.order[0]);b&&this.onRemove(b)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const o=this.data[i].shift();return o.timeout&&clearTimeout(o.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),o.value}getByKey(i){const o=this.data[i];return o?o[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,o){if(!this.has(i))return this;const u=i.wrapped().key,m=o===void 0?0:this.data[u].indexOf(o),y=this.data[u][m];return this.data[u].splice(m,1),y.timeout&&clearTimeout(y.timeout),this.data[u].length===0&&delete this.data[u],this.onRemove(y.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this}filter(i){const o=[];for(const u in this.data)for(const m of this.data[u])i(m.value)||o.push(m);for(const u of o)this.remove(u.value.tileID,u)}}class Jo{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(i,o,u){const m=String(o);if(this.stateChanges[i]=this.stateChanges[i]||{},this.stateChanges[i][m]=this.stateChanges[i][m]||{},Object.assign(this.stateChanges[i][m],u),this.deletedStates[i]===null){this.deletedStates[i]={};for(const y in this.state[i])y!==m&&(this.deletedStates[i][y]=null)}else if(this.deletedStates[i]&&this.deletedStates[i][m]===null){this.deletedStates[i][m]={};for(const y in this.state[i][m])u[y]||(this.deletedStates[i][m][y]=null)}else for(const y in u)this.deletedStates[i]&&this.deletedStates[i][m]&&this.deletedStates[i][m][y]===null&&delete this.deletedStates[i][m][y]}removeFeatureState(i,o,u){if(this.deletedStates[i]===null)return;const m=String(o);if(this.deletedStates[i]=this.deletedStates[i]||{},u&&o!==void 0)this.deletedStates[i][m]!==null&&(this.deletedStates[i][m]=this.deletedStates[i][m]||{},this.deletedStates[i][m][u]=null);else if(o!==void 0)if(this.stateChanges[i]&&this.stateChanges[i][m])for(u in this.deletedStates[i][m]={},this.stateChanges[i][m])this.deletedStates[i][m][u]=null;else this.deletedStates[i][m]=null;else this.deletedStates[i]=null}getState(i,o){const u=this.state[i]||{},m=this.stateChanges[i]||{},y=this.deletedStates[i];if(y===null)return{};if(o!==void 0){const A=String(o),C=Object.assign({},u[A],m[A]);if(y){const z=y[o];if(z===null)return{};for(const D in z)delete C[D]}return C}const b=Object.assign({},u,m);if(y)for(const A in y)delete b[A];return b}initializeTileState(i,o){i.refreshFeatureState(o)}coalesceChanges(i,o){const u={};for(const m in this.stateChanges){this.state[m]=this.state[m]||{};const y={};for(const b in this.stateChanges[m])this.state[m][b]||(this.state[m][b]={}),Object.assign(this.state[m][b],this.stateChanges[m][b]),y[b]=this.state[m][b];u[m]=y}for(const m in this.deletedStates){this.state[m]=this.state[m]||{};const y={};if(this.deletedStates[m]===null)for(const b in this.state[m])y[b]={},this.state[m][b]={};else for(const b in this.deletedStates[m]){if(this.deletedStates[m][b]===null)this.state[m][b]={};else if(this.state[m][b])for(const A of Object.keys(this.deletedStates[m][b]))delete this.state[m][b][A];y[b]=this.state[m][b]}u[m]=u[m]||{},Object.assign(u[m],y)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(const m in i)i[m].refreshFeatureState(o)}}class mn extends r.E{constructor(i,o,u){super(),this.id=i,this._onlySymbols=u,o.on("data",m=>{m.dataType==="source"&&m.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&m.dataType==="source"&&m.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),o.on("error",()=>{this._sourceErrored=!0}),this._source=o,this._tiles={},this._cache=new rc(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=o.minTileCacheSize,this._maxTileCacheSize=o.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Jo,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(i){this.map=i,this._minTileCacheSize=this._minTileCacheSize===void 0&&i?i._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&i?i._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const i in this._tiles)if(!this._tiles[i].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const i=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,i&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(i,o){return i.isSymbolTile=this._onlySymbols,i.isExtraShadowCaster=this._shadowCasterTiles[i.tileID.key],this._source.loadTile(i,o)}_unloadTile(i){if(this._source.unloadTile)return this._source.unloadTile(i)}_abortTile(i){if(this._source.abortTile)return this._source.abortTile(i)}serialize(){return this._source.serialize()}prepare(i){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const o in this._tiles){const u=this._tiles[o];u.upload(i),u.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(i=>i.tileID).sort(qu).map(i=>i.key)}getRenderableIds(i,o){const u=[];for(const m in this._tiles)this._isIdRenderable(+m,i,o)&&u.push(this._tiles[m]);return i?u.sort((m,y)=>{const b=m.tileID,A=y.tileID,C=new r.P(b.canonical.x,b.canonical.y)._rotate(this.transform.angle),z=new r.P(A.canonical.x,A.canonical.y)._rotate(this.transform.angle);return b.overscaledZ-A.overscaledZ||z.y-C.y||z.x-C.x}).map(m=>m.tileID.key):u.map(m=>m.tileID).sort(qu).map(m=>m.key)}hasRenderableParent(i){const o=this.findLoadedParent(i,0);return!!o&&this._isIdRenderable(o.tileID.key)}_isIdRenderable(i,o,u){return this._tiles[i]&&this._tiles[i].hasData()&&!this._coveredTiles[i]&&(o||!this._tiles[i].holdingForFade())&&(u||!this._shadowCasterTiles[i])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const i in this._tiles)this._tiles[i].state!=="errored"&&this._reloadTile(+i,"reloading")}}_reloadTile(i,o){const u=this._tiles[i];u&&(u.state!=="loading"&&(u.state=o),this._loadTile(u,this._tileLoaded.bind(this,u,i,o)))}_tileLoaded(i,o,u,m){if(m)if(i.state="errored",m.status!==404)this._source.fire(new r.y(m,{tile:i}));else{if(this._source.fire(new r.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:i})),!(i.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const y=this.map.painter.terrain;this.update(this.transform,y.getScaledDemTileSize(),!0),y.resetTileLookupCache(this.id)}else this.update(this.transform)}else i.timeAdded=r.o.now(),u==="expired"&&(i.refreshedUponExpiration=!0),this._setTileReloadTimer(o,i),this._source.type==="raster-dem"&&i.dem&&this._backfillDEM(i),this._state.initializeTileState(i,this.map?this.map.painter:null),this._source.fire(new r.z("data",{dataType:"source",tile:i,coord:i.tileID,sourceCacheId:this.id}))}_backfillDEM(i){const o=this.getRenderableIds();for(let m=0;m<o.length;m++){const y=o[m];if(i.neighboringTiles&&i.neighboringTiles[y]){const b=this.getTileByID(y);u(i,b),u(b,i)}}function u(m,y){if(!m.dem||m.dem.borderReady)return;m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0;let b=y.tileID.canonical.x-m.tileID.canonical.x;const A=y.tileID.canonical.y-m.tileID.canonical.y,C=Math.pow(2,m.tileID.canonical.z),z=y.tileID.key;b===0&&A===0||Math.abs(A)>1||(Math.abs(b)>1&&(Math.abs(b+C)===1?b+=C:Math.abs(b-C)===1&&(b-=C)),y.dem&&m.dem&&(m.dem.backfillBorder(y.dem,b,A),m.neighboringTiles&&m.neighboringTiles[z]&&(m.neighboringTiles[z].backfilled=!0)))}}getTile(i){return this.getTileByID(i.key)}getTileByID(i){return this._tiles[i]}_retainLoadedChildren(i,o,u,m){for(const y in this._tiles){let b=this._tiles[y];if(m[y]||!b.hasData()||b.tileID.overscaledZ<=o||b.tileID.overscaledZ>u)continue;let A=b.tileID;for(;b&&b.tileID.overscaledZ>o+1;){const z=b.tileID.scaledTo(b.tileID.overscaledZ-1);b=this._tiles[z.key],b&&b.hasData()&&(A=z)}let C=A;for(;C.overscaledZ>o;)if(C=C.scaledTo(C.overscaledZ-1),i[C.key]){m[A.key]=A;break}}}findLoadedParent(i,o){if(i.key in this._loadedParentTiles){const u=this._loadedParentTiles[i.key];return u&&u.tileID.overscaledZ>=o?u:null}for(let u=i.overscaledZ-1;u>=o;u--){const m=i.scaledTo(u),y=this._getLoadedTile(m);if(y)return y}}_getLoadedTile(i){const o=this._tiles[i.key];return o&&o.hasData()?o:this._cache.getByKey(this._source.reparseOverscaled?i.wrapped().key:i.canonical.key)}updateCacheSize(i,o){o=o||this._source.tileSize;const u=Math.ceil(i.width/o)+1,m=Math.ceil(i.height/o)+1,y=Math.floor(u*m*5),b=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,y):y,A=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,b):b;this._cache.setMaxSize(A)}handleWrapJump(i){const o=Math.round((i-(this._prevLng===void 0?i:this._prevLng))/360);if(this._prevLng=i,o){const u={};for(const m in this._tiles){const y=this._tiles[m];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+o),u[y.tileID.key]=y}this._tiles=u;for(const m in this._timers)clearTimeout(this._timers[m]),delete this._timers[m];for(const m in this._tiles)this._setTileReloadTimer(+m,this._tiles[m])}}update(i,o,u,m,y){if(this.transform=i,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!u)return;this.updateCacheSize(i,o),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const b=this._source.type==="batched-model";let A,C=this._source.maxzoom;const z=this.map&&this.map.painter?this.map.painter._terrain:null;if(z&&z.sourceCache===this&&z.attenuationRange()){const F=z.attenuationRange()[0],W=Math.floor(F)-Math.log2(z.getDemUpscale());C>W&&(C=W)}if(this.used||this.usedForTerrain){if(this._source.tileID)A=i.getVisibleUnwrappedCoordinates(this._source.tileID).map(F=>new r.aO(F.canonical.z,F.wrap,F.canonical.z,F.canonical.x,F.canonical.y));else if(this.tileCoverLift!==0){const F=i.clone();F.tileCoverLift=this.tileCoverLift,A=F.coveringTiles({tileSize:o||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:C,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:b}),this._source.minzoom<=1&&i.projection.name==="globe"&&(A.push(new r.aO(1,0,1,0,0)),A.push(new r.aO(1,0,1,1,0)),A.push(new r.aO(1,0,1,0,1)),A.push(new r.aO(1,0,1,1,1)))}else if(A=i.coveringTiles({tileSize:o||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:C,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:b}),this._source.hasTile){const F=this._source.hasTile.bind(this._source);A=A.filter(W=>F(W))}}else A=[];if(A.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!ih(this._source.type)){const F=i.coveringZoomLevel({tileSize:o||this._source.tileSize,roundZoom:this._source.roundZoom&&!u}),W=Math.min(F,this._source.maxzoom);if(b){const X=i.extendTileCover(A,W);for(const Y of X)A.push(Y)}else if(y){const X=i.extendTileCoverToNearPlane(A,this.transform.getFrustum(W),W);for(const Y of X)A.push(Y)}else if(this.castsShadows&&m){const X=i.extendTileCover(A,W,m);for(const Y of X)this._shadowCasterTiles[Y.key]=!0,A.push(Y)}}const D=this._updateRetainedTiles(A);if(ih(this._source.type)&&A.length!==0){const F={},W={},X=Object.keys(D);for(const te of X){const J=D[te],re=this._tiles[te];if(!re||re.fadeEndTime&&re.fadeEndTime<=r.o.now())continue;const oe=this.findLoadedParent(J,Math.max(J.overscaledZ-mn.maxOverzooming,this._source.minzoom));oe&&(this._addTile(oe.tileID),F[oe.tileID.key]=oe.tileID),W[te]=J}const Y=A[A.length-1].overscaledZ;for(const te in this._tiles){const J=this._tiles[te];if(D[te]||!J.hasData())continue;let re=J.tileID;for(;re.overscaledZ>Y;){re=re.scaledTo(re.overscaledZ-1);const oe=this._tiles[re.key];if(oe&&oe.hasData()&&W[re.key]){D[te]=J.tileID;break}}}for(const te in F)D[te]||(this._coveredTiles[te]=!0,D[te]=F[te])}for(const F in D)this._tiles[F].clearFadeHold();const U=r.bv(this._tiles,D);for(const F of U){const W=this._tiles[F];W.hasSymbolBuckets&&!W.holdingForFade()?W.setHoldDuration(this.map._fadeDuration):W.hasSymbolBuckets&&!W.symbolFadeFinished()||this._removeTile(+F)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const i in this._tiles)this._tiles[i].holdingForFade()&&this._removeTile(+i)}_updateRetainedTiles(i){const o={};if(i.length===0)return o;const u={},m=i.reduce((z,D)=>Math.min(z,D.overscaledZ),1/0),y=i[0].overscaledZ,b=Math.max(y-mn.maxOverzooming,this._source.minzoom),A=Math.max(y+mn.maxUnderzooming,this._source.minzoom),C={};for(const z of i){const D=this._addTile(z);o[z.key]=z,D.hasData()||m<this._source.maxzoom&&(C[z.key]=z)}this._retainLoadedChildren(C,m,A,o);for(const z of i){let D=this._tiles[z.key];if(D.hasData())continue;if(z.canonical.z>=this._source.maxzoom){const F=z.children(this._source.maxzoom)[0],W=this.getTile(F);if(W&&W.hasData()){o[F.key]=F;continue}}else{const F=z.children(this._source.maxzoom);if(o[F[0].key]&&o[F[1].key]&&o[F[2].key]&&o[F[3].key])continue}let U=D.wasRequested();for(let F=z.overscaledZ-1;F>=b;--F){const W=z.scaledTo(F);if(u[W.key]||(u[W.key]=!0,D=this.getTile(W),!D&&U&&(D=this._addTile(W)),D&&(o[W.key]=W,U=D.wasRequested(),D.hasData())))break}}return o}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const i in this._tiles){const o=[];let u,m=this._tiles[i].tileID;for(;m.overscaledZ>0;){if(m.key in this._loadedParentTiles){u=this._loadedParentTiles[m.key];break}o.push(m.key);const y=m.scaledTo(m.overscaledZ-1);if(u=this._getLoadedTile(y),u)break;m=y}for(const y of o)this._loadedParentTiles[y]=u}}_addTile(i){let o=this._tiles[i.key];if(o)return o.isExtraShadowCaster!==!0||this._shadowCasterTiles[i.key]||this._reloadTile(i.key,"reloading"),o;o=this._cache.getAndRemove(i),o&&(this._setTileReloadTimer(i.key,o),o.tileID=i,this._state.initializeTileState(o,this.map?this.map.painter:null),this._cacheTimers[i.key]&&(clearTimeout(this._cacheTimers[i.key]),delete this._cacheTimers[i.key],this._setTileReloadTimer(i.key,o)));const u=!!o;if(!u){const m=this.map?this.map.painter:null,y=this._source.tileSize*i.overscaleFactor();o=this._source.type==="raster-array"?new ic(i,y,this.transform.tileZoom,m,this._isRaster):new Ua(i,y,this.transform.tileZoom,m,this._isRaster,this._source.worldview),this._loadTile(o,this._tileLoaded.bind(this,o,i.key,o.state))}return o.uses++,this._tiles[i.key]=o,u||this._source.fire(new r.z("dataloading",{tile:o,coord:o.tileID,dataType:"source"})),o}_setTileReloadTimer(i,o){i in this._timers&&(clearTimeout(this._timers[i]),delete this._timers[i]);const u=o.getExpiryTimeout();u&&(this._timers[i]=setTimeout(()=>{this._reloadTile(i,"expired"),delete this._timers[i]},u))}_removeTile(i){const o=this._tiles[i];o&&(o.uses--,delete this._tiles[i],this._timers[i]&&(clearTimeout(this._timers[i]),delete this._timers[i]),o.uses>0||(o.hasData()&&o.state!=="reloading"||o.state==="empty"?this._cache.add(o.tileID,o,o.getExpiryTimeout()):(o.aborted=!0,this._abortTile(o),this._unloadTile(o))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const i in this._tiles)this._removeTile(+i);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(i,o,u){const m=[],y=this.transform;if(!y)return m;const b=y.projection.name==="globe",A=r.aF(y.center.lng);for(const C in this._tiles){const z=this._tiles[C];if(u&&z.clearQueryDebugViz(),z.holdingForFade())continue;let D;if(b){const U=z.tileID.canonical;if(U.z===0){const F=[Math.abs(r.aA(A,...Ko(U,-1))-A),Math.abs(r.aA(A,...Ko(U,1))-A)];D=[0,2*F.indexOf(Math.min(...F))-1]}else{const F=[Math.abs(r.aA(A,...Ko(U,-1))-A),Math.abs(r.aA(A,...Ko(U,0))-A),Math.abs(r.aA(A,...Ko(U,1))-A)];D=[F.indexOf(Math.min(...F))-1]}}else D=[0];for(const U of D){const F=i.containsTile(z,y,o,U);F&&m.push(F)}}return m}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(i){return this._getRenderableCoordinates(i)}_getRenderableCoordinates(i,o){const u=this.getRenderableIds(i,o).map(y=>this._tiles[y].tileID),m=this.transform.projection.name==="globe";for(const y of u)y.projMatrix=this.transform.calculateProjMatrix(y.toUnwrapped()),y.expandedProjMatrix=m?this.transform.calculateProjMatrix(y.toUnwrapped(),!1,!0):y.projMatrix;return u}sortCoordinatesByDistance(i){const o=i.slice(),u=this.transform._camera.position,m=this.transform._camera.forward(),y={};for(const b of o){const A=1/(1<<b.canonical.z);y[b.key]=((b.canonical.x+.5)*A+b.wrap-u[0])*m[0]+((b.canonical.y+.5)*A-u[1])*m[1]-u[2]*m[2]}return o.sort((b,A)=>y[b.key]-y[A.key]),o}hasTransition(){if(this._source.hasTransition())return!0;if(ih(this._source.type))for(const i in this._tiles){const o=this._tiles[i];if(o.fadeEndTime!==void 0&&o.fadeEndTime>=r.o.now())return!0}return!1}setFeatureState(i,o,u){this._state.updateState(i=i||"_geojsonTileLayer",o,u)}removeFeatureState(i,o,u){this._state.removeFeatureState(i=i||"_geojsonTileLayer",o,u)}getFeatureState(i,o){return this._state.getState(i=i||"_geojsonTileLayer",o)}setDependencies(i,o,u){const m=this._tiles[i];m&&m.setDependencies(o,u)}reloadTilesForDependencies(i,o){for(const u in this._tiles)this._tiles[u].hasDependency(i,o)&&this._reloadTile(+u,"reloading");this._cache.filter(u=>!u.hasDependency(i,o))}_preloadTiles(i,o){if(!this._sourceLoaded){const C=()=>{this._sourceLoaded&&(this._source.off("data",C),this._preloadTiles(i,o))};return void this._source.on("data",C)}const u=new Map,m=Array.isArray(i)?i:[i],y=this.map.painter.terrain,b=this.usedForTerrain&&y?y.getScaledDemTileSize():this._source.tileSize;for(const C of m){const z=C.coveringTiles({tileSize:b,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const D of z)u.set(D.key,D);this.usedForTerrain&&C.updateElevation(!1)}const A=Array.from(u.values());r.bw(A,(C,z)=>{const D=new Ua(C,this._source.tileSize*C.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(D,U=>{this._source.type==="raster-dem"&&D.dem&&this._backfillDEM(D),z(U,D)})},o)}}function qu(d,i){const o=Math.abs(2*d.wrap)-+(d.wrap<0),u=Math.abs(2*i.wrap)-+(i.wrap<0);return d.overscaledZ-i.overscaledZ||u-o||i.canonical.y-d.canonical.y||i.canonical.x-d.canonical.x}function ih(d){return d==="raster"||d==="image"||d==="video"||d==="custom"}function Ko(d,i){const o=1<<d.z;return[d.x/o+i,(d.x+1)/o+i]}mn.maxOverzooming=10,mn.maxUnderzooming=3;class rh{constructor(i){this.style=i,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const i=!1,o=!1;for(const u in this.style._mergedLayers){const m=this.style._mergedLayers[u];if(m.type==="fill-extrusion"||m.type==="building")this.layers.push({layer:m,visible:i,visibilityChanged:o});else if(m.type==="model"){const y=this.style.getLayerSource(m);y&&y.type==="batched-model"&&this.layers.push({layer:m,visible:i,visibilityChanged:o})}}}onNewFrame(i){this.layersGotHidden=!1;for(const o of this.layers){const u=o.layer;let m=!1;u.type==="fill-extrusion"?m=!u.isHidden(i)&&u.paint.get("fill-extrusion-opacity")>0:u.type==="building"?m=!u.isHidden(i)&&u.paint.get("building-opacity")>0:u.type==="model"&&(m=!u.isHidden(i)&&u.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!m&&o.visible,o.visible=m}}updateZOffset(i,o){this.currentBuildingBuckets=[];for(const m of this.layers){const y=m.layer,b=this.style.getLayerSourceCache(y);let A=1;y.type==="fill-extrusion"?A=m.visible?y.paint.get("fill-extrusion-vertical-scale"):0:y.type==="building"&&(A=m.visible?y.paint.get("building-vertical-scale"):0);let C=b?b.getTile(o):null;if(!C&&b)for(const z in b._tiles){const D=b._tiles[z];if(o.canonical.isChildOf(D.tileID.canonical)){C=D;break}}this.currentBuildingBuckets.push({bucket:C?C.getBucket(y):null,tileID:C?C.tileID:o,verticalScale:A})}i.hasAnyZOffset=!1;let u=!1;for(let m=0;m<i.symbolInstances.length;m++){const y=i.symbolInstances.get(m),b=y.zOffset,A=this._getHeightAtTileOffset(o,y.tileAnchorX,y.tileAnchorY);y.zOffset=A!==Number.NEGATIVE_INFINITY?A:b,u||b===y.zOffset||(u=!0),i.hasAnyZOffset||y.zOffset===0||(i.hasAnyZOffset=!0)}u&&(i.zOffsetBuffersNeedUpload=!0,i.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(i,o,u,m){let y=o,b=u;if(i.canonical.z!==m.canonical.z){const A=m.canonical,C=1/(1<<i.canonical.z-A.z);y=(o+i.canonical.x*r.al)*C-A.x*r.al|0,b=(u+i.canonical.y*r.al)*C-A.y*r.al|0}return{tileX:y,tileY:b}}_getHeightAtTileOffset(i,o,u){let m,y;for(let b=0;b<this.layers.length;++b){const A=this.layers[b].layer;if(A.type!=="fill-extrusion"&&A.type!=="building")continue;const{bucket:C,tileID:z,verticalScale:D}=this.currentBuildingBuckets[b];if(!C)continue;const{tileX:U,tileY:F}=this._mapCoordToOverlappingTile(i,o,u,z),W=C.getHeightAtTileCoord(U,F);W&&W.height!==void 0&&(W.hidden?m=W.height:y=Math.max(W.height*D,y||0))}if(y!==void 0)return y;for(let b=0;b<this.layers.length;++b){const A=this.layers[b];if(A.layer.type!=="model"||!A.visible)continue;const{bucket:C,tileID:z}=this.currentBuildingBuckets[b];if(!C)continue;const{tileX:D,tileY:U}=this._mapCoordToOverlappingTile(i,o,u,z),F=C.getHeightAtTileCoord(D,U);if(F&&!F.hidden)return F.height===void 0&&m!==void 0?Math.min(F.maxHeight,m)*F.verticalScale:F.height?F.height*F.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Zu(d,i){const o={};for(const u in d)u!=="ref"&&(o[u]=d[u]);return r.bx.forEach(u=>{u in i&&(o[u]=i[u])}),o}function sh(d){d=d.slice();const i=Object.create(null);for(let o=0;o<d.length;o++)i[d[o].id]=d[o];for(let o=0;o<d.length;o++)"ref"in d[o]&&(d[o]=Zu(d[o],i[d[o].ref]));return d}const Ui={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function Qo(d,i,o){o.push({command:Ui.addSource,args:[d,i[d]]})}function rp(d,i,o){i.push({command:Ui.removeSource,args:[d]}),o[d]=!0}function sp(d,i,o,u){rp(d,o,u),Qo(d,i,o)}function nh(d,i,o){let u;for(u in d[o])if(d[o].hasOwnProperty(u)&&u!=="data"&&!r.by(d[o][u],i[o][u]))return!1;for(u in i[o])if(i[o].hasOwnProperty(u)&&u!=="data"&&!r.by(d[o][u],i[o][u]))return!1;return!0}function ja(d,i,o,u,m,y){let b;for(b in i=i||{},d=d||{})d.hasOwnProperty(b)&&(r.by(d[b],i[b])||o.push({command:y,args:[u,b,i[b],m]}));for(b in i)i.hasOwnProperty(b)&&!d.hasOwnProperty(b)&&(r.by(d[b],i[b])||o.push({command:y,args:[u,b,i[b],m]}))}function el(d){return d.id}function sc(d,i){return d[i.id]=i,d}function ah(d,i,o){const u=i.createTileMatrix(d,d.worldSize,o.toUnwrapped());return r.aB(new Float32Array(16),d.projMatrix,u)}function np(d,i,o){if(i.projection.name===o.projection.name)return d.projMatrix;const u=o.clone();return u.setProjection(i.projection),ah(u,i.getProjection(),d)}function yo(d,i,o){return i.name===o.projection.name?d.projMatrix:ah(o,i,d)}class ap{constructor(i,o){this.reset(i,o)}reset(i,o){this.points=i||[],this._distances=[0];for(let u=1;u<this.points.length;u++)this._distances[u]=this._distances[u-1]+this.points[u].dist(this.points[u-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(o||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(i){if(this.points.length===1)return this.points[0];i=r.aA(i,0,1);let o=1,u=this._distances[o];const m=i*this.paddedLength+this.padding;for(;u<m&&o<this._distances.length;)u=this._distances[++o];const y=o-1,b=this._distances[y],A=u-b,C=A>0?(m-b)/A:0;return this.points[y].mult(1-C).add(this.points[o].mult(C))}}class $u{constructor(i,o,u){const m=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(i/u),this.yCellCount=Math.ceil(o/u);for(let b=0;b<this.xCellCount*this.yCellCount;b++)m.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=o,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/o,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(i,o,u,m,y){this._forEachCell(o,u,m,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(m),this.bboxes.push(y)}insertCircle(i,o,u,m){this._forEachCell(o-m,u-m,o+m,u+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(o),this.circles.push(u),this.circles.push(m)}_insertBoxCell(i,o,u,m,y,b){this.boxCells[y].push(b)}_insertCircleCell(i,o,u,m,y,b){this.circleCells[y].push(b)}_query(i,o,u,m,y,b){if(u<0||i>this.width||m<0||o>this.height)return!y&&[];const A=[];if(i<=0&&o<=0&&this.width<=u&&this.height<=m){if(y)return!0;for(let C=0;C<this.boxKeys.length;C++)A.push({key:this.boxKeys[C],x1:this.bboxes[4*C],y1:this.bboxes[4*C+1],x2:this.bboxes[4*C+2],y2:this.bboxes[4*C+3]});for(let C=0;C<this.circleKeys.length;C++){const z=this.circles[3*C],D=this.circles[3*C+1],U=this.circles[3*C+2];A.push({key:this.circleKeys[C],x1:z-U,y1:D-U,x2:z+U,y2:D+U})}return b?A.filter(b):A}return this._forEachCell(i,o,u,m,this._queryCell,A,{hitTest:y,seenUids:{box:{},circle:{}}},b),y?A.length>0:A}_queryCircle(i,o,u,m,y){const b=i-u,A=i+u,C=o-u,z=o+u;if(A<0||b>this.width||z<0||C>this.height)return!m&&[];const D=[];return this._forEachCell(b,C,A,z,this._queryCellCircle,D,{hitTest:m,circle:{x:i,y:o,radius:u},seenUids:{box:{},circle:{}}},y),m?D.length>0:D}query(i,o,u,m,y){return this._query(i,o,u,m,!1,y)}hitTest(i,o,u,m,y){return this._query(i,o,u,m,!0,y)}hitTestCircle(i,o,u,m){return this._queryCircle(i,o,u,!0,m)}_queryCell(i,o,u,m,y,b,A,C){const z=A.seenUids,D=this.boxCells[y];if(D!==null){const F=this.bboxes;for(const W of D)if(!z.box[W]){z.box[W]=!0;const X=4*W;if(i<=F[X+2]&&o<=F[X+3]&&u>=F[X+0]&&m>=F[X+1]&&(!C||C(this.boxKeys[W]))){if(A.hitTest)return b.push(!0),!0;b.push({key:this.boxKeys[W],x1:F[X],y1:F[X+1],x2:F[X+2],y2:F[X+3]})}}}const U=this.circleCells[y];if(U!==null){const F=this.circles;for(const W of U)if(!z.circle[W]){z.circle[W]=!0;const X=3*W;if(this._circleAndRectCollide(F[X],F[X+1],F[X+2],i,o,u,m)&&(!C||C(this.circleKeys[W]))){if(A.hitTest)return b.push(!0),!0;{const Y=F[X],te=F[X+1],J=F[X+2];b.push({key:this.circleKeys[W],x1:Y-J,y1:te-J,x2:Y+J,y2:te+J})}}}}}_queryCellCircle(i,o,u,m,y,b,A,C){const z=A.circle,D=A.seenUids,U=this.boxCells[y];if(U!==null){const W=this.bboxes;for(const X of U)if(!D.box[X]){D.box[X]=!0;const Y=4*X;if(this._circleAndRectCollide(z.x,z.y,z.radius,W[Y+0],W[Y+1],W[Y+2],W[Y+3])&&(!C||C(this.boxKeys[X])))return b.push(!0),!0}}const F=this.circleCells[y];if(F!==null){const W=this.circles;for(const X of F)if(!D.circle[X]){D.circle[X]=!0;const Y=3*X;if(this._circlesCollide(W[Y],W[Y+1],W[Y+2],z.x,z.y,z.radius)&&(!C||C(this.circleKeys[X])))return b.push(!0),!0}}}_forEachCell(i,o,u,m,y,b,A,C){const z=this._convertToXCellCoord(i),D=this._convertToYCellCoord(o),U=this._convertToXCellCoord(u),F=this._convertToYCellCoord(m);for(let W=z;W<=U;W++)for(let X=D;X<=F;X++)if(y.call(this,i,o,u,m,this.xCellCount*X+W,b,A,C))return}_convertToXCellCoord(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))}_convertToYCellCoord(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))}_circlesCollide(i,o,u,m,y,b){const A=m-i,C=y-o,z=u+b;return z*z>A*A+C*C}_circleAndRectCollide(i,o,u,m,y,b,A){const C=(b-m)/2,z=Math.abs(i-(m+C));if(z>C+u)return!1;const D=(A-y)/2,U=Math.abs(o-(y+D));if(U>D+u)return!1;if(z<=C||U<=D)return!0;const F=z-C,W=U-D;return F*F+W*W<=u*u}}const tl={unknown:0,flipRequired:1,flipNotRequired:2},oh=Math.tan(85*Math.PI/180);function Nn(d,i,o,u,m,y,b){const A=r.bC();if(o)if(y.name==="globe"){const C=r.bD(m,i);r.aB(A,A,C)}else{const C=r.bE([],b);A[0]=C[0],A[1]=C[1],A[4]=C[2],A[5]=C[3],u||r.bB(A,A,m.angle)}else r.aB(A,m.labelPlaneMatrix,d);return A}function nc(d,i,o,u,m,y,b){const A=Nn(d,i,o,u,m,y,b);return y.name==="globe"&&o||(A[2]=A[6]=A[10]=A[14]=0),A}function lh(d,i,o,u,m,y,b){if(o){if(y.name==="globe"){const A=Nn(d,i,o,u,m,y,b);return r.bl(A,A),r.aB(A,d,A),A}{const A=r.bz(d),C=r.bA([]);return C[0]=b[0],C[1]=b[1],C[4]=b[2],C[5]=b[3],r.aB(A,A,C),u||r.bB(A,A,-m.angle),A}}return m.glCoordMatrix}function _n(d,i,o,u){const m=[d,i,o,1];o?r.aC(m,m,u):ed(m,m,u);const y=m[3];return m[0]/=y,m[1]/=y,m[2]/=y,m}function xo(d,i){return Math.min(.5+d/i*.5,1.5)}function yn(d,i){const o=d[0]/d[3],u=d[1]/d[3];return o>=-i[0]&&o<=i[0]&&u>=-i[1]&&u<=i[1]}function Ju(d,i,o,u,m,y,b,A,C,z){const D=o.transform,U=u?d.textSizeData:d.iconSizeData,F=r.bK(U,o.transform.zoom),W=D.projection.name==="globe",X=[256/o.width*2+1,256/o.height*2+1],Y=u?d.text.dynamicLayoutVertexArray:d.icon.dynamicLayoutVertexArray;Y.clear();let te=null;W&&(te=u?d.text.globeExtVertexArray:d.icon.globeExtVertexArray);const J=d.lineVertexArray,re=u?d.text.placedSymbolArray:d.icon.placedSymbolArray,oe=o.transform.width/o.transform.height;let he,ye=!1;for(let me=0;me<re.length;me++){const xe=re.get(me),{numGlyphs:_e,writingMode:ge}=xe;if(ge!==r.bL.vertical||ye||he===r.bL.horizontal||(ye=!0),he=ge,(xe.hidden||ge===r.bL.vertical)&&!ye){ei(_e,Y);continue}ye=!1;const Ae=new r.P(xe.tileAnchorX,xe.tileAnchorY);let{x:je,y:Re,z:Je}=D.projection.projectTilePoint(Ae.x,Ae.y,z.canonical);if(C){const[ht,Wt,Ut]=C(Ae);je+=ht,Re+=Wt,Je+=Ut}const Ne=[je,Re,Je,1];if(r.aC(Ne,Ne,i),!yn(Ne,X)){ei(_e,Y);continue}const $e=Ne[3],vt=xo(o.transform.getCameraToCenterDistance(D.projection),$e),Ve=r.bM(U,F,xe),Pe=b?Ve/vt:Ve*vt,Qe=_n(je,Re,Je,m);if(Qe[3]<=0){ei(_e,Y);continue}let We={};const at=r.an(d.layers[0].layout.get("text-max-angle")),xt=Math.cos(at),Pt=b?null:C,pt=er(xe,Pe,!1,A,i,m,y,d.glyphOffsetArray,J,Y,te,Qe,Ae,We,oe,Pt,D.projection,z,b,xt);ye=pt.useVertical,Pt&&pt.needsFlipping&&(We={}),(pt.notEnoughRoom||ye||pt.needsFlipping&&er(xe,Pe,!0,A,i,m,y,d.glyphOffsetArray,J,Y,te,Qe,Ae,We,oe,Pt,D.projection,z,b,xt).notEnoughRoom)&&ei(_e,Y)}u?(d.text.dynamicLayoutVertexBuffer.updateData(Y),te&&d.text.globeExtVertexBuffer&&d.text.globeExtVertexBuffer.updateData(te)):(d.icon.dynamicLayoutVertexBuffer.updateData(Y),te&&d.icon.globeExtVertexBuffer&&d.icon.globeExtVertexBuffer.updateData(te))}function ch(d,i,o,u,m,y,b,A,C,z,D,U,F,W,X,Y,te){const{lineStartIndex:J,glyphStartIndex:re,segment:oe}=A,he=re+A.numGlyphs,ye=J+A.lineLength,me=i.getoffsetX(re),xe=i.getoffsetX(he-1),_e=hh(d*me,o,u,m,y,b,oe,J,ye,C,z,D,U,F,!0,W,X,Y,te);if(!_e)return null;const ge=hh(d*xe,o,u,m,y,b,oe,J,ye,C,z,D,U,F,!0,W,X,Y,te);return ge?{first:_e,last:ge}:null}function Ku(d,i,o,u){return d===r.bL.horizontal&&Math.abs(u)>Math.abs(o)?{useVertical:!0}:d===r.bL.vertical?u>0?{needsFlipping:!0}:null:i!==tl.unknown&&function(m,y){return m===0||Math.abs(y/m)>oh}(o,u)?i===tl.flipRequired?{needsFlipping:!0}:null:o<0?{needsFlipping:!0}:null}function er(d,i,o,u,m,y,b,A,C,z,D,U,F,W,X,Y,te,J,re,oe){const he=i/24,ye=d.lineOffsetX*he,me=d.lineOffsetY*he,{lineStartIndex:xe,glyphStartIndex:_e,numGlyphs:ge,segment:Ae,writingMode:je,flipState:Re}=d,Je=xe+d.lineLength,Ne=$e=>{if(D){const[Qe,We,at]=$e.up,xt=z.length;r.bN(D,xt+0,Qe,We,at),r.bN(D,xt+1,Qe,We,at),r.bN(D,xt+2,Qe,We,at),r.bN(D,xt+3,Qe,We,at)}const[vt,Ve,Pe]=$e.point;r.bO(z,vt,Ve,Pe,$e.angle)};if(ge>1){const $e=ch(he,A,ye,me,o,U,F,d,C,y,W,Y,!1,te,J,re,oe);if(!$e)return{notEnoughRoom:!0};if(u&&!o){let[vt,Ve,Pe]=$e.first.point,[Qe,We,at]=$e.last.point;[vt,Ve]=_n(vt,Ve,Pe,b),[Qe,We]=_n(Qe,We,at,b);const xt=Ku(je,Re,(Qe-vt)*X,We-Ve);if(d.flipState=xt&&xt.needsFlipping?tl.flipRequired:tl.flipNotRequired,xt)return xt}Ne($e.first);for(let vt=_e+1;vt<_e+ge-1;vt++){const Ve=hh(he*A.getoffsetX(vt),ye,me,o,U,F,Ae,xe,Je,C,y,W,Y,!1,!1,te,J,re,oe);if(!Ve)return z.length-=4*(vt-_e),{notEnoughRoom:!0};Ne(Ve)}Ne($e.last)}else{if(u&&!o){const vt=_n(F.x,F.y,0,m),Ve=xe+Ae+1,Pe=new r.P(C.getx(Ve),C.gety(Ve)),Qe=_n(Pe.x,Pe.y,0,m),We=Qe[3]>0?Qe:op(F,Pe,vt,1,m,void 0,te,J.canonical),at=Ku(je,Re,(We[0]-vt[0])*X,We[1]-vt[1]);if(d.flipState=at&&at.needsFlipping?tl.flipRequired:tl.flipNotRequired,at)return at}const $e=hh(he*A.getoffsetX(_e),ye,me,o,U,F,Ae,xe,Je,C,y,W,Y,!1,!1,te,J,re,oe);if(!$e)return{notEnoughRoom:!0};Ne($e)}return{}}function Qu(d,i,o,u,m){const{x:y,y:b,z:A}=u.projectTilePoint(d.x,d.y,i);if(!m)return _n(y,b,A,o);const[C,z,D]=m(d);return _n(y+C,b+z,A+D,o)}function op(d,i,o,u,m,y,b,A){const C=Qu(d.sub(i)._unit()._add(d),A,m,b,y);return r.av(C,o,C),r.aw(C,C),r.bH(C,o,C,u)}function hh(d,i,o,u,m,y,b,A,C,z,D,U,F,W,X,Y,te,J,re){const oe=u?d-i:d+i;let he=oe>0?1:-1,ye=0;u&&(he*=-1,ye=Math.PI),he<0&&(ye+=Math.PI);let me=A+b+(he>0?0:1)|0,xe=m,_e=m,ge=0,Ae=0;const je=Math.abs(oe),Re=[],Je=[];let Ne=y,$e=Ne,vt=r.bF([]);const Ve=()=>op($e,Ne,_e,je-ge+1,D,F,Y,te.canonical);for(;ge+Ae<=je;){if(me+=he,me<A||me>=C)return null;if(_e=xe,$e=Ne,Re.push(_e),W&&Je.push($e),Ne=new r.P(z.getx(me),z.gety(me)),xe=U[me],!xe){const Ut=Qu(Ne,te.canonical,D,Y,F);xe=Ut[3]>0?U[me]=Ut:Ve()}ge+=Ae;const ht=r.av([],xe,_e),Wt=r.bG(_e,xe);if(o&&Wt>0&&Ae>0&&r.bJ(vt,ht)/(Ae*Wt)<re)return null;Ae=Wt,vt=ht}X&&F&&(U[me]&&(xe=Ve(),Ae=r.bG(_e,xe),vt=r.av([],xe,_e)),U[me]=xe);const Pe=(je-ge)/Ae,Qe=Ne.sub($e)._mult(Pe)._add($e),We=r.bH([],_e,vt,Pe);let at=[0,0,1],xt=vt[0],Pt=vt[1];if(J&&(at=Y.upVector(te.canonical,Qe.x,Qe.y),at[0]!==0||at[1]!==0||at[2]!==1)){const ht=[at[2],0,-at[0]],Wt=r.bI([],at,ht);r.aw(ht,ht),r.aw(Wt,Wt),xt=r.bJ(vt,ht),Pt=r.bJ(vt,Wt)}if(o){const ht=r.bI([],at,vt);r.aw(ht,ht),r.bH(We,We,ht,o*he)}const pt=ye+Math.atan2(Pt,xt);return Re.push(We),W&&Je.push(Qe),{point:We,angle:pt,path:Re,tilePath:Je,up:at}}function ei(d,i){const o=i.length,u=o+4*d;i.resize(u),i.float32.fill(-1/0,4*o,4*u)}function ed(d,i,o){const u=i[0],m=i[1];return d[0]=o[0]*u+o[4]*m+o[12],d[1]=o[1]*u+o[5]*m+o[13],d[3]=o[3]*u+o[7]*m+o[15],d}const xn=100;class Vn{constructor(i,o,u=new $u(i.width+200,i.height+200,25),m=new $u(i.width+200,i.height+200,25)){this.transform=i,this.grid=u,this.ignoredGrid=m,this.pitchfactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+xn,this.screenBottomBoundary=i.height+xn,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200,this.fogState=o}placeCollisionBox(i,o,u,m,y,b,A,C,z,D,U){let F=u.projectedAnchorX,W=u.projectedAnchorY,X=u.projectedAnchorZ;const Y=u.tileAnchorX,te=u.tileAnchorY,J=u.elevation,re=u.tileID,oe=i.getProjection();if(J&&re){const[Je,Ne,$e]=oe.upVector(re.canonical,u.tileAnchorX,u.tileAnchorY),vt=oe.upVectorScale(re.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;F+=Je*J*vt,W+=Ne*J*vt,X+=$e*J*vt}const he=i.projection.name==="globe",ye=i.projection.name==="globe"?r.aj(this.transform.zoom):0;if(re&&he&&ye<1&&!b){const Je=1<<re.canonical.z,Ne=r.bP(Y,te);r.bQ(Ne,Ne,1/r.al),r.bR(Ne,Ne,r.bP(re.canonical.x,re.canonical.y)),r.bQ(Ne,Ne,1/Je),r.bS(Ne,Ne,r.bP(m[0],m[1])),Ne[0]=r.bT(Ne[0],-.5,.5),r.bQ(Ne,Ne,r.al);const $e=r.bU(Ne[0],Ne[1],r.al/(2*Math.PI),1);r.aC($e,$e,y),F=r.ak(F,$e[0],ye),W=r.ak(W,$e[1],ye),X=r.ak(X,$e[2],ye)}const me=this.projectAndGetPerspectiveRatio(D,F,W,X,u.tileID,oe.name==="globe"||!!J||this.transform.pitch>0,oe),xe=z*me.perspectiveRatio,_e=(u.x1*o+A.x-u.padding)*xe+me.point.x,ge=(u.y1*o+A.y-u.padding)*xe+me.point.y,Ae=(u.x2*o+A.x+u.padding)*xe+me.point.x,je=(u.y2*o+A.y+u.padding)*xe+me.point.y,Re=me.perspectiveRatio<=.55||me.occluded;return!this.isInsideGrid(_e,ge,Ae,je)||!C&&this.grid.hitTest(_e,ge,Ae,je,U)||Re?{box:[],offscreen:!1,occluded:me.occluded}:{box:[_e,ge,Ae,je],offscreen:this.isOffscreen(_e,ge,Ae,je),occluded:!1}}placeCollisionCircles(i,o,u,m,y,b,A,C,z,D,U,F,W,X,Y){const te=[],J=this.transform.elevation,re=i.getProjection(),oe=J?J.getAtTileOffsetFunc(Y,this.transform.center.lat,this.transform.worldSize,re):null,he=new r.P(u.tileAnchorX,u.tileAnchorY);let{x:ye,y:me,z:xe}=re.projectTilePoint(he.x,he.y,Y.canonical);if(oe){const[at,xt,Pt]=oe(he);ye+=at,me+=xt,xe+=Pt}const _e=re.name==="globe",ge=this.projectAndGetPerspectiveRatio(A,ye,me,xe,Y,_e||!!J||this.transform.pitch>0,re),{perspectiveRatio:Ae}=ge,je=(U?b/Ae:b*Ae)/r.bX,Re=_n(ye,me,xe,C),Je=u.lineOffsetX*je,Ne=u.lineOffsetY*je,$e=r.an(i.layers[0].layout.get("text-max-angle")),vt=Math.cos($e),Ve=ge.signedDistanceFromCamera>0?ch(je,y,Je,Ne,!1,Re,he,u,m,C,{},J&&!U?oe:null,U&&!!J,re,Y,U,vt):null;let Pe=!1,Qe=!1,We=!0;if(Ve&&!ge.occluded){const at=.5*W*Ae+X,xt=new r.P(-100,-100),Pt=new r.P(this.screenRightBoundary,this.screenBottomBoundary),pt=new ap,{first:ht,last:Wt}=Ve,Ut=ht.path.length;let Ht=[];for(let yi=Ut-1;yi>=1;yi--)Ht.push(ht.path[yi]);for(let yi=1;yi<Wt.path.length;yi++)Ht.push(Wt.path[yi]);const Vt=2.5*at;z&&(Ht=Ht.map(([yi,wi,ir],hi)=>(oe&&!_e&&(ir=oe(hi<Ut-1?ht.tilePath[Ut-1-hi]:Wt.tilePath[hi-Ut+2])[2]),_n(yi,wi,ir,z))),Ht.some(yi=>yi[3]<=0)&&(Ht=[]));let oi=[];if(Ht.length>0){let yi=1/0,wi=-1/0,ir=1/0,hi=-1/0;for(const Gi of Ht)yi=Math.min(yi,Gi[0]),ir=Math.min(ir,Gi[1]),wi=Math.max(wi,Gi[0]),hi=Math.max(hi,Gi[1]);wi>=xt.x&&yi<=Pt.x&&hi>=xt.y&&ir<=Pt.y&&(oi=[Ht.map(Gi=>new r.P(Gi[0],Gi[1]))],(yi<xt.x||wi>Pt.x||ir<xt.y||hi>Pt.y)&&(oi=r.bV(oi,xt.x,xt.y,Pt.x,Pt.y)))}for(const yi of oi){pt.reset(yi,.25*at);let wi=0;wi=pt.length<=.5*at?1:Math.ceil(pt.paddedLength/Vt)+1;for(let ir=0;ir<wi;ir++){const hi=ir/Math.max(wi-1,1),Gi=pt.lerp(hi),Qi=Gi.x+xn,Tr=Gi.y+xn;te.push(Qi,Tr,at,0);const xi=Qi-at,Zi=Tr-at,Yi=Qi+at,Ji=Tr+at;if(We=We&&this.isOffscreen(xi,Zi,Yi,Ji),Qe=Qe||this.isInsideGrid(xi,Zi,Yi,Ji),!o&&this.grid.hitTestCircle(Qi,Tr,at,F)&&(Pe=!0,!D))return{circles:[],offscreen:!1,collisionDetected:Pe,occluded:!1}}}}return{circles:!D&&Pe||!Qe?[]:te,offscreen:We,collisionDetected:Pe,occluded:ge.occluded}}queryRenderedSymbols(i){if(i.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const o=[];let u=1/0,m=1/0,y=-1/0,b=-1/0;for(const D of i){const U=new r.P(D.x+xn,D.y+xn);u=Math.min(u,U.x),m=Math.min(m,U.y),y=Math.max(y,U.x),b=Math.max(b,U.y),o.push(U)}const A=this.grid.query(u,m,y,b).concat(this.ignoredGrid.query(u,m,y,b)),C={},z={};for(const D of A){const U=D.key;if(C[U.bucketInstanceId]===void 0&&(C[U.bucketInstanceId]={}),C[U.bucketInstanceId][U.featureIndex])continue;const F=[new r.P(D.x1,D.y1),new r.P(D.x2,D.y1),new r.P(D.x2,D.y2),new r.P(D.x1,D.y2)];r.bW(o,F)&&(C[U.bucketInstanceId][U.featureIndex]=!0,z[U.bucketInstanceId]===void 0&&(z[U.bucketInstanceId]=[]),z[U.bucketInstanceId].push(U.featureIndex))}return z}insertCollisionBox(i,o,u,m,y){(o?this.ignoredGrid:this.grid).insert({bucketInstanceId:u,featureIndex:m,collisionGroupID:y},i[0],i[1],i[2],i[3])}insertCollisionCircles(i,o,u,m,y){const b=o?this.ignoredGrid:this.grid,A={bucketInstanceId:u,featureIndex:m,collisionGroupID:y};for(let C=0;C<i.length;C+=4)b.insertCircle(A,i[C],i[C+1],i[C+2])}projectAndGetPerspectiveRatio(i,o,u,m,y,b,A){const C=[o,u,m,1];let z=!1;m||this.transform.pitch>0?(r.aC(C,C,i),this.fogState&&y&&A.name!=="globe"&&(z=function(F,W,X,Y,te,J){const re=J.calculateFogTileMatrix(te),oe=[W,X,Y];return r.af(oe,oe,re),ni(F,r.ag(oe),J.pitch,J._fov)}(this.fogState,o,u,m,y.toUnwrapped(),this.transform)>.9)):ed(C,C,i);const D=C[3];return{point:new r.P((C[0]/D+1)/2*this.transform.width+xn,(-C[1]/D+1)/2*this.transform.height+xn),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(A)/D*.5,1.5),signedDistanceFromCamera:D,occluded:b&&C[2]>D||z}}isOffscreen(i,o,u,m){return u<xn||i>=this.screenRightBoundary||m<xn||o>this.screenBottomBoundary}isInsideGrid(i,o,u,m){return u>=0&&i<this.gridRightBoundary&&m>=0&&o<this.gridBottomBoundary}getViewportMatrix(){const i=r.bA([]);return r.br(i,i,[-100,-100,0]),i}}class uh{constructor(i,o,u,m){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?o:-o))):m&&u?1:0,this.placed=u}isHidden(){return this.opacity===0&&!this.placed}}class Qn{constructor(i,o,u,m,y,b=!1){this.text=new uh(i?i.text:null,o,u,y),this.icon=new uh(i?i.icon:null,o,m,y),this.clipped=b}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Xt{constructor(i,o,u,m=!1){this.text=i,this.icon=o,this.skipFade=u,this.clipped=m}}class tr{constructor(){this.invProjMatrix=r.bC(),this.viewportMatrix=r.bC(),this.circles=[]}}class nr{constructor(i,o,u,m,y){this.bucketInstanceId=i,this.featureIndex=o,this.sourceLayerIndex=u,this.bucketIndex=m,this.tileID=y}}class on{constructor(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}}get(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){const o=++this.maxGroupID;this.collisionGroups[i]={ID:o,predicate:u=>u.collisionGroupID===o}}return this.collisionGroups[i]}}function vo(d,i,o,u,m){const{horizontalAlign:y,verticalAlign:b}=r.c0(d),A=-(y-.5)*i,C=-(b-.5)*o,z=r.c1(d,u);return new r.P(A+z[0]*m,C+z[1]*m)}function $i(d,i,o,u,m){const y=new r.P(d,i);return o&&y._rotate(u?m:-m),y}class dh{constructor(i,o,u,m,y,b){this.transform=i.clone(),this.projection=i.projection.name,this.collisionIndex=new Vn(this.transform,y),this.buildingIndex=b,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=o,this.retainedQueryData={},this.collisionGroups=new on(u),this.collisionCircleArrays={},this.prevPlacement=m,m&&(m.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(i,o,u,m,y=1){const b=u.getBucket(o),A=u.latestFeatureIndex;if(!b||!A||o.fqid!==b.layerIds[0])return;const C=b.layers[0].layout,z=b.layers[0].paint,D=u.collisionBoxArray,U=Math.pow(2,this.transform.zoom-u.tileID.overscaledZ),F=u.tileSize/r.al,W=u.tileID.toUnwrapped();this.transform.setProjection(b.projection);const X=(Y=u.tileID,te=b.getProjection(),J=this.transform,te.name===this.projection?J.calculateProjMatrix(Y.toUnwrapped()):ah(J,te,Y));var Y,te,J;const re=C.get("text-pitch-alignment")==="map",oe=C.get("text-rotation-alignment")==="map";o.compileFilter(o.options);const he=o.dynamicFilter(),ye=o.dynamicFilterNeedsFeature(),me=this.transform.calculatePixelsToTileUnitsMatrix(u),xe=nc(X,u.tileID.canonical,re,oe,this.transform,b.getProjection(),me);let _e=null;const ge=b.getProjection().createInversionMatrix(this.transform,u.tileID.canonical);if(re){const Pe=lh(X,u.tileID.canonical,re,oe,this.transform,b.getProjection(),me);_e=r.aB([],this.transform.labelPlaneMatrix,Pe)}let Ae=null;he&&u.latestFeatureIndex&&(Ae={unwrappedTileID:W,dynamicFilter:he,dynamicFilterNeedsFeature:ye}),this.retainedQueryData[b.bucketInstanceId]=new nr(b.bucketInstanceId,A,b.sourceLayerIndex,b.index,u.tileID);const[je,Re]=b.layers[0].layout.get("text-size-scale-range"),Je=r.aA(y,je,Re),[Ne,$e]=C.get("icon-size-scale-range"),vt=r.aA(y,Ne,$e),Ve={bucket:b,layout:C,paint:z,posMatrix:X,invMatrix:ge,mercatorCenter:[r.aF(this.transform.center.lng),r.aJ(this.transform.center.lat)],textLabelPlaneMatrix:xe,labelToScreenMatrix:_e,clippingData:Ae,scale:U,textPixelRatio:F,holdingForFade:u.holdingForFade(),collisionBoxArray:D,partiallyEvaluatedTextSize:r.bK(b.textSizeData,this.transform.zoom,Je),partiallyEvaluatedIconSize:r.bK(b.iconSizeData,this.transform.zoom,vt),collisionGroup:this.collisionGroups.get(b.sourceID),latestFeatureIndex:u.latestFeatureIndex};if(m)for(const Pe of b.sortKeyRanges){const{sortKey:Qe,symbolInstanceStart:We,symbolInstanceEnd:at}=Pe;i.push({sortKey:Qe,symbolInstanceStart:We,symbolInstanceEnd:at,parameters:Ve})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:Ve})}attemptAnchorPlacement(i,o,u,m,y,b,A,C,z,D,U,F,W,X,Y,te,J,re,oe,he,ye){const{textOffset0:me,textOffset1:xe,crossTileID:_e}=Y,ge=[me,xe],Ae=vo(i,b,A,ge,C),je=this.collisionIndex.placeCollisionBox(J,C,o,u,m,y,$i(Ae.x,Ae.y,z,D,this.transform.angle),X,U,F,W.predicate);if(oe){const Re=J.getSymbolInstanceIconSize(ye,this.transform.zoom,Y.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(J,Re,oe,u,m,y,$i(Ae.x,Ae.y,z,D,this.transform.angle),X,U,F,W.predicate).box.length===0)return}if(je.box.length>0){let Re;return this.prevPlacement&&this.prevPlacement.variableOffsets[_e]&&this.prevPlacement.placements[_e]&&this.prevPlacement.placements[_e].text&&(Re=this.prevPlacement.variableOffsets[_e].anchor),this.variableOffsets[_e]={textOffset:ge,width:b,height:A,anchor:i,textScale:C,prevAnchor:Re},this.markUsedJustification(J,i,Y,re),J.allowVerticalPlacement&&(this.markUsedOrientation(J,re,Y),this.placedOrientations[_e]=re),{shift:Ae,placedGlyphBoxes:je}}}placeLayerBucketPart(i,o,u,m,y=1){const{bucket:b,layout:A,paint:C,posMatrix:z,textLabelPlaneMatrix:D,labelToScreenMatrix:U,clippingData:F,textPixelRatio:W,mercatorCenter:X,invMatrix:Y,holdingForFade:te,collisionBoxArray:J,partiallyEvaluatedTextSize:re,partiallyEvaluatedIconSize:oe,collisionGroup:he,latestFeatureIndex:ye}=i.parameters,me=A.get("text-optional"),xe=A.get("icon-optional"),_e=A.get("text-allow-overlap"),ge=A.get("icon-allow-overlap"),Ae=A.get("text-rotation-alignment")==="map",je=A.get("icon-rotation-alignment")==="map",Re=A.get("text-pitch-alignment")==="map",Je=C.get("symbol-z-offset"),Ne=A.get("symbol-elevation-reference")==="sea",$e=A.get("symbol-placement"),[vt,Ve]=A.get("text-size-scale-range"),[Pe,Qe]=A.get("icon-size-scale-range"),We=r.aA(y,vt,Ve),at=r.aA(y,Pe,Qe),xt=A.get("text-variable-anchor"),Pt=Ae&&$e!=="point",pt=je&&$e!=="point",ht=xt&&b.hasTextData(),Wt=b.hasIconTextFit()&&ht&&b.hasIconData();this.transform.setProjection(b.projection);const Ut=ht||Pt,Ht=pt||Wt;let Vt=_e&&(ge||!b.hasIconData()||xe),oi=ge&&(_e||!b.hasTextData()||me);const yi=!Je.isConstant();!b.collisionArrays&&J&&b.deserializeCollisionBoxes(J),u&&m&&b.updateCollisionDebugBuffers(this.transform.zoom,J,We,at);const wi=(hi,Gi,Qi)=>{const{crossTileID:Tr,numVerticalGlyphVertices:xi}=hi;let Zi=null;if(F&&F.dynamicFilterNeedsFeature||yi){const Gr=this.retainedQueryData[b.bucketInstanceId];Zi=ye.loadFeature({featureIndex:hi.featureIndex,bucketIndex:Gr.bucketIndex,sourceLayerIndex:Gr.sourceLayerIndex,layoutVertexArrayOffset:0})}if(F&&!(0,F.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},Zi,this.retainedQueryData[b.bucketInstanceId].tileID.canonical,new r.P(hi.tileAnchorX,hi.tileAnchorY),this.transform.calculateDistanceTileData(F.unwrappedTileID)))return this.placements[Tr]=new Xt(!1,!1,!1,!0),void o.add(Tr);const Yi=Je.evaluate(Zi,{});if(o.has(Tr))return;if(te)return void(this.placements[Tr]=new Xt(!1,!1,!1));let Ji=!1,Cr=!1,qr=!0,xs=!1,Ir=!1,Si=null,ri={box:null,offscreen:null,occluded:null},rr={box:null},Vr=null,Mr=null,is=null,Ts=0,Sn=0,An=0;Qi.textFeatureIndex?Ts=Qi.textFeatureIndex:hi.useRuntimeCollisionCircles&&(Ts=hi.featureIndex),Qi.verticalTextFeatureIndex&&(Sn=Qi.verticalTextFeatureIndex);const cn=Gr=>{Gr.tileID=this.retainedQueryData[b.bucketInstanceId].tileID;const Zr=this.transform.elevation;Gr.elevation=Ne?Yi:Yi+(Zr?Zr.getAtTileOffset(Gr.tileID,Gr.tileAnchorX,Gr.tileAnchorY):0),Gr.elevation+=hi.zOffset},hn=Qi.textBox;if(hn){cn(hn);const Gr=Pr=>{let us=r.bL.horizontal;if(b.allowVerticalPlacement&&!Pr&&this.prevPlacement){const vs=this.prevPlacement.placedOrientations[Tr];vs&&(this.placedOrientations[Tr]=vs,us=vs,this.markUsedOrientation(b,us,hi))}return us},Zr=(Pr,us)=>{if(b.allowVerticalPlacement&&xi>0&&Qi.verticalTextBox){for(const vs of b.writingModes)if(vs===r.bL.vertical?(ri=us(),rr=ri):ri=Pr(),ri&&ri.box&&ri.box.length)break}else ri=Pr()};if(xt){let Pr=xt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Tr]){const Qr=this.prevPlacement.variableOffsets[Tr];Pr.indexOf(Qr.anchor)>0&&(Pr=Pr.filter(zs=>zs!==Qr.anchor),Pr.unshift(Qr.anchor))}const us=(Qr,zs,na)=>{const Ea=b.getSymbolInstanceTextSize(re,hi,this.transform.zoom,Gi),Yn=(Qr.x2-Qr.x1)*Ea+2*Qr.padding,ao=(Qr.y2-Qr.y1)*Ea+2*Qr.padding,oo=hi.hasIconTextFit&&!ge?zs:null;oo&&cn(oo);let aa={box:[],offscreen:!1,occluded:!1};const Il=_e?2*Pr.length:Pr.length;for(let Ca=0;Ca<Il;++Ca){const oa=this.attemptAnchorPlacement(Pr[Ca%Pr.length],Qr,X,Y,Ut,Yn,ao,Ea,Ae,Re,W,z,he,Ca>=Pr.length,hi,Gi,b,na,oo,re,oe);if(oa&&(aa=oa.placedGlyphBoxes,aa&&aa.box&&aa.box.length)){Ji=!0,Si=oa.shift;break}}return aa};Zr(()=>us(hn,Qi.iconBox,r.bL.horizontal),()=>{const Qr=Qi.verticalTextBox;return Qr&&cn(Qr),b.allowVerticalPlacement&&!(ri&&ri.box&&ri.box.length)&&xi>0&&Qr?us(Qr,Qi.verticalIconBox,r.bL.vertical):{box:null,offscreen:null,occluded:null}}),ri&&(Ji=ri.box,qr=ri.offscreen,xs=ri.occluded);const vs=Gr(!(!ri||!ri.box));if(!Ji&&this.prevPlacement){const Qr=this.prevPlacement.variableOffsets[Tr];Qr&&(this.variableOffsets[Tr]=Qr,this.markUsedJustification(b,Qr.anchor,hi,vs))}}else{const Pr=(us,vs)=>{const Qr=b.getSymbolInstanceTextSize(re,hi,this.transform.zoom,Gi),zs=this.collisionIndex.placeCollisionBox(b,Qr,us,X,Y,Ut,new r.P(0,0),_e,W,z,he.predicate);return zs&&zs.box&&zs.box.length&&(this.markUsedOrientation(b,vs,hi),this.placedOrientations[Tr]=vs),zs};Zr(()=>Pr(hn,r.bL.horizontal),()=>{const us=Qi.verticalTextBox;return b.allowVerticalPlacement&&xi>0&&us?(cn(us),Pr(us,r.bL.vertical)):{box:null,offscreen:null,occluded:null}}),Gr(!!(ri&&ri.box&&ri.box.length))}}if(Vr=ri,Ji=Vr&&Vr.box&&Vr.box.length>0,qr=Vr&&Vr.offscreen,xs=Vr&&Vr.occluded,hi.useRuntimeCollisionCircles){const Gr=b.text.placedSymbolArray.get(hi.centerJustifiedTextSymbolIndex>=0?hi.centerJustifiedTextSymbolIndex:hi.verticalPlacedTextSymbolIndex),Zr=r.bM(b.textSizeData,re,Gr),Pr=A.get("text-padding");Mr=this.collisionIndex.placeCollisionCircles(b,_e,Gr,b.lineVertexArray,b.glyphOffsetArray,Zr,z,D,U,u,Re,he.predicate,hi.collisionCircleDiameter*Zr/r.bX,Pr,this.retainedQueryData[b.bucketInstanceId].tileID),Ji=_e||Mr.circles.length>0&&!Mr.collisionDetected,qr=qr&&Mr.offscreen,xs=Mr.occluded}if(Qi.iconFeatureIndex&&(An=Qi.iconFeatureIndex),Qi.iconBox){const Gr=Zr=>{cn(Zr);const Pr=hi.hasIconTextFit&&Si?$i(Si.x,Si.y,Ae,Re,this.transform.angle):new r.P(0,0),us=b.getSymbolInstanceIconSize(oe,this.transform.zoom,hi.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(b,us,Zr,X,Y,Ht,Pr,ge,W,z,he.predicate)};rr&&rr.box&&rr.box.length&&Qi.verticalIconBox?(is=Gr(Qi.verticalIconBox),Cr=is.box.length>0):(is=Gr(Qi.iconBox),Cr=is.box.length>0),qr=qr&&is.offscreen,Ir=is.occluded}const Ys=me||hi.numHorizontalGlyphVertices===0&&xi===0,Ln=xe||hi.numIconVertices===0;if(Ys||Ln?Ln?Ys||(Cr=Cr&&Ji):Ji=Cr&&Ji:Cr=Ji=Cr&&Ji,Ji&&Vr&&Vr.box&&this.collisionIndex.insertCollisionBox(Vr.box,A.get("text-ignore-placement"),b.bucketInstanceId,rr&&rr.box&&Sn?Sn:Ts,he.ID),Cr&&is&&this.collisionIndex.insertCollisionBox(is.box,A.get("icon-ignore-placement"),b.bucketInstanceId,An,he.ID),Mr&&(Ji&&this.collisionIndex.insertCollisionCircles(Mr.circles,A.get("text-ignore-placement"),b.bucketInstanceId,Ts,he.ID),u)){const Gr=b.bucketInstanceId;let Zr=this.collisionCircleArrays[Gr];Zr===void 0&&(Zr=this.collisionCircleArrays[Gr]=new tr);for(let Pr=0;Pr<Mr.circles.length;Pr+=4)Zr.circles.push(Mr.circles[Pr+0]),Zr.circles.push(Mr.circles[Pr+1]),Zr.circles.push(Mr.circles[Pr+2]),Zr.circles.push(Mr.collisionDetected?1:0)}const Xn=b.projection.name!=="globe";Vt=Vt&&(Xn||!xs),oi=oi&&(Xn||!Ir),this.placements[Tr]=new Xt(Ji||Vt,Cr||oi,qr||b.justReloaded),o.add(Tr)},ir=this.retainedQueryData[b.bucketInstanceId].tileID;if(b.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(b,ir),b.elevationType==="road"&&b.updateRoadElevation(ir.canonical),b.updateZOffset(),b.sortFeaturesByY){const hi=b.getSortedSymbolIndexes(this.transform.angle);for(let Gi=hi.length-1;Gi>=0;--Gi){const Qi=hi[Gi];wi(b.symbolInstances.get(Qi),Qi,b.collisionArrays[Qi])}b.hasAnyZOffset&&r.w(`${b.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(b.hasAnyZOffset){const hi=b.getSortedIndexesByZOffset();for(let Gi=0;Gi<hi.length;++Gi){const Qi=hi[Gi];wi(b.symbolInstances.get(Qi),Qi,b.collisionArrays[Qi])}}else for(let hi=i.symbolInstanceStart;hi<i.symbolInstanceEnd;hi++)wi(b.symbolInstances.get(hi),hi,b.collisionArrays[hi]);if(u&&b.bucketInstanceId in this.collisionCircleArrays){const hi=this.collisionCircleArrays[b.bucketInstanceId];r.bl(hi.invProjMatrix,z),hi.viewportMatrix=this.collisionIndex.getViewportMatrix()}b.justReloaded=!1}markUsedJustification(i,o,u,m){const{leftJustifiedTextSymbolIndex:y,centerJustifiedTextSymbolIndex:b,rightJustifiedTextSymbolIndex:A,verticalPlacedTextSymbolIndex:C,crossTileID:z}=u,D=r.c2(o),U=m===r.bL.vertical?C:D==="left"?y:D==="center"?b:D==="right"?A:-1;y>=0&&(i.text.placedSymbolArray.get(y).crossTileID=U>=0&&y!==U?0:z),b>=0&&(i.text.placedSymbolArray.get(b).crossTileID=U>=0&&b!==U?0:z),A>=0&&(i.text.placedSymbolArray.get(A).crossTileID=U>=0&&A!==U?0:z),C>=0&&(i.text.placedSymbolArray.get(C).crossTileID=U>=0&&C!==U?0:z)}markUsedOrientation(i,o,u){const m=o===r.bL.horizontal||o===r.bL.horizontalOnly?o:0,y=o===r.bL.vertical?o:0,{leftJustifiedTextSymbolIndex:b,centerJustifiedTextSymbolIndex:A,rightJustifiedTextSymbolIndex:C,verticalPlacedTextSymbolIndex:z}=u,D=i.text.placedSymbolArray;b>=0&&(D.get(b).placedOrientation=m),A>=0&&(D.get(A).placedOrientation=m),C>=0&&(D.get(C).placedOrientation=m),z>=0&&(D.get(z).placedOrientation=y)}commit(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;const o=this.prevPlacement;let u=!1;this.prevZoomAdjustment=o?o.zoomAdjustment(this.transform.zoom):0;const m=o?o.symbolFadeChange(i):1,y=o?o.opacities:{},b=o?o.variableOffsets:{},A=o?o.placedOrientations:{};for(const C in this.placements){const z=this.placements[C],D=y[C];D?(this.opacities[C]=new Qn(D,m,z.text,z.icon,null,z.clipped),u=u||z.text!==D.text.placed||z.icon!==D.icon.placed):(this.opacities[C]=new Qn(null,m,z.text,z.icon,z.skipFade,z.clipped),u=u||z.text||z.icon)}for(const C in y){const z=y[C];if(!this.opacities[C]){const D=new Qn(z,m,!1,!1);D.isHidden()||(this.opacities[C]=D,u=u||z.text.placed||z.icon.placed)}}for(const C in b)this.variableOffsets[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.variableOffsets[C]=b[C]);for(const C in A)this.placedOrientations[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.placedOrientations[C]=A[C]);u?this.lastPlacementChangeTime=i:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=o?o.lastPlacementChangeTime:i)}updateLayerOpacities(i,o,u,m){const y=new Set;for(const b of o){const A=b.getBucket(i);A&&b.latestFeatureIndex&&i.fqid===A.layerIds[0]&&(this.updateBucketOpacities(A,y,b,b.collisionBoxArray,u,m,b.tileID,i.scope),A.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(A,b.tileID),A.elevationType==="road"&&A.updateRoadElevation(b.tileID.canonical),A.updateZOffset())}}updateBucketOpacities(i,o,u,m,y,b,A,C){i.hasTextData()&&i.text.opacityVertexArray.clear(),i.hasIconData()&&i.icon.opacityVertexArray.clear(),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();const z=i.layers[0].layout,D=i.layers[0].paint,U=!!i.layers[0].dynamicFilter(),F=new Qn(null,0,!1,!1,!0),W=z.get("text-allow-overlap"),X=z.get("icon-allow-overlap"),Y=z.get("text-variable-anchor"),te=z.get("text-rotation-alignment")==="map",J=z.get("text-pitch-alignment")==="map",re=D.get("symbol-z-offset"),oe=z.get("symbol-elevation-reference")==="sea",he=!re.isConstant(),ye=new Qn(null,0,W&&(X||!i.hasIconData()||z.get("icon-optional")),X&&(W||!i.hasTextData()||z.get("text-optional")),!0);!i.collisionArrays&&m&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(m);const me=(_e,ge,Ae)=>{for(let je=0;je<ge/4;je++)_e.opacityVertexArray.emplaceBack(Ae)};let xe=0;b&&i.updateReplacement(A,b);for(let _e=0;_e<i.symbolInstances.length;_e++){const ge=i.symbolInstances.get(_e),{numHorizontalGlyphVertices:Ae,numVerticalGlyphVertices:je,crossTileID:Re,numIconVertices:Je,tileAnchorX:Ne,tileAnchorY:$e}=ge;let vt=null;const Ve=this.retainedQueryData[i.bucketInstanceId];he&&ge&&Ve&&(vt=u.latestFeatureIndex.loadFeature({featureIndex:ge.featureIndex,bucketIndex:Ve.bucketIndex,sourceLayerIndex:Ve.sourceLayerIndex,layoutVertexArrayOffset:0}));const Pe=re.evaluate(vt,{}),Qe=o.has(Re);let We=this.opacities[Re];Qe?We=F:We||(We=ye,this.opacities[Re]=We),o.add(Re);const at=Ae>0||je>0,xt=Je>0,Pt=this.placedOrientations[Re],pt=Pt===r.bL.vertical,ht=Pt===r.bL.horizontal||Pt===r.bL.horizontalOnly;!at&&!xt||We.isHidden()||xe++;let Wt=!1;if((at||xt)&&b)for(const Ut of i.activeReplacements){if(r.bY(Ut,y,r.bZ.Symbol,C)||Ut.min.x>Ne||Ne>Ut.max.x||Ut.min.y>$e||$e>Ut.max.y)continue;const Ht=r.b_(Ne,$e,A.canonical,Ut.footprintTileId.canonical);if(Wt=r.b$(Ht,Ut.footprint),Wt)break}if(at){const Ut=Wt?Wa:cc(We.text);me(i.text,Ae,pt?Wa:Ut),me(i.text,je,ht?Wa:Ut);const Ht=We.text.isHidden(),{leftJustifiedTextSymbolIndex:Vt,centerJustifiedTextSymbolIndex:oi,rightJustifiedTextSymbolIndex:yi,verticalPlacedTextSymbolIndex:wi}=ge,ir=i.text.placedSymbolArray,hi=Ht||pt?1:0;Vt>=0&&(ir.get(Vt).hidden=hi),oi>=0&&(ir.get(oi).hidden=hi),yi>=0&&(ir.get(yi).hidden=hi),wi>=0&&(ir.get(wi).hidden=Ht||ht?1:0);const Gi=this.variableOffsets[Re];Gi&&this.markUsedJustification(i,Gi.anchor,ge,Pt);const Qi=this.placedOrientations[Re];Qi&&(this.markUsedJustification(i,"left",ge,Qi),this.markUsedOrientation(i,Qi,ge))}if(xt){const Ut=Wt?Wa:cc(We.icon),{placedIconSymbolIndex:Ht,verticalPlacedIconSymbolIndex:Vt}=ge,oi=i.icon.placedSymbolArray,yi=We.icon.isHidden()?1:0;Ht>=0&&(me(i.icon,Je,pt?Wa:Ut),oi.get(Ht).hidden=yi),Vt>=0&&(me(i.icon,ge.numVerticalIconVertices,ht?Wa:Ut),oi.get(Vt).hidden=yi)}if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){const Ut=i.collisionArrays[_e];if(Ut){let Ht=new r.P(0,0),Vt=!0;if(Ut.textBox||Ut.verticalTextBox){if(Y){const yi=this.variableOffsets[Re];yi?(Ht=vo(yi.anchor,yi.width,yi.height,yi.textOffset,yi.textScale),te&&Ht._rotate(J?this.transform.angle:-this.transform.angle)):Vt=!1}U&&(Vt=!We.clipped),Ut.textBox&&Ha(i.textCollisionBox.collisionVertexArray,We.text.placed,!Vt||pt,Pe,oe,Ht.x,Ht.y),Ut.verticalTextBox&&Ha(i.textCollisionBox.collisionVertexArray,We.text.placed,!Vt||ht,Pe,oe,Ht.x,Ht.y)}const oi=Vt&&!!(!ht&&Ut.verticalIconBox);Ut.iconBox&&Ha(i.iconCollisionBox.collisionVertexArray,We.icon.placed,oi,Pe,oe,ge.hasIconTextFit?Ht.x:0,ge.hasIconTextFit?Ht.y:0),Ut.verticalIconBox&&Ha(i.iconCollisionBox.collisionVertexArray,We.icon.placed,!oi,Pe,oe,ge.hasIconTextFit?Ht.x:0,ge.hasIconTextFit?Ht.y:0)}}}if(i.fullyClipped=xe===0,i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.bucketInstanceId in this.collisionCircleArrays){const _e=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=_e.invProjMatrix,i.placementViewportMatrix=_e.viewportMatrix,i.collisionCircleArray=_e.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}}symbolFadeChange(i){return this.fadeDuration===0?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(i){return Math.max(0,(this.transform.zoom-i)/1.5)}hasTransitions(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(i,o){const u=this.zoomAtLastRecencyCheck===o?1-this.zoomAdjustment(o):1;return this.zoomAtLastRecencyCheck=o,this.commitTime+this.fadeDuration*u>i}setStale(){this.stale=!0}}function Ha(d,i,o,u,m,y,b){d.emplaceBack(i?1:0,o?1:0,y||0,b||0,u,m?1:0),d.emplaceBack(i?1:0,o?1:0,y||0,b||0,u,m?1:0),d.emplaceBack(i?1:0,o?1:0,y||0,b||0,u,m?1:0),d.emplaceBack(i?1:0,o?1:0,y||0,b||0,u,m?1:0)}const ac=Math.pow(2,25),Bs=Math.pow(2,24),cs=Math.pow(2,17),pm=Math.pow(2,16),oc=Math.pow(2,9),td=Math.pow(2,8),lc=Math.pow(2,1);function cc(d){if(d.opacity===0&&!d.placed)return 0;if(d.opacity===1&&d.placed)return 4294967295;const i=d.placed?1:0,o=Math.floor(127*d.opacity);return o*ac+i*Bs+o*cs+i*pm+o*oc+i*td+o*lc+i}const Wa=0;class fh{constructor(i){this._sortAcrossTiles=i.layout.get("symbol-z-order")!=="viewport-y"&&i.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(i,o,u,m,y,b){const A=this._bucketParts;for(;this._currentTileIndex<i.length;)if(o.getBucketParts(A,m,i[this._currentTileIndex],this._sortAcrossTiles,b),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,A.sort((C,z)=>C.sortKey-z.sortKey));this._currentPartIndex<A.length;){const C=A[this._currentPartIndex];if(o.placeLayerBucketPart(C,this._seenCrossTileIDs,u,C.symbolInstanceStart===0,b),this._currentPartIndex++,y())return!0}return!1}}class Ws{constructor(i,o,u,m,y,b,A,C,z){this.placement=new dh(i,y,b,A,C,z),this._currentPlacementIndex=o.length-1,this._forceFullPlacement=u,this._showCollisionBoxes=m,this._done=!1}isDone(){return this._done}continuePlacement(i,o,u,m,y){const b=r.o.now(),A=()=>{const C=r.o.now()-b;return!this._forceFullPlacement&&C>2};for(;this._currentPlacementIndex>=0;){const C=o[i[this._currentPlacementIndex]],z=this.placement.collisionIndex.transform.zoom;if(C.type==="symbol"&&(!C.minzoom||C.minzoom<=z)&&(!C.maxzoom||C.maxzoom>z)){const D=C,U=D.layout.get("symbol-z-elevate"),F=D.layout.get("symbol-sort-key").constantOr(1)!==void 0,W=D.layout.get("symbol-z-order"),X=W==="viewport-y"||W==="auto"&&!(W!=="viewport-y"&&F),Y=D.layout.get("text-allow-overlap")||D.layout.get("icon-allow-overlap")||D.layout.get("text-ignore-placement")||D.layout.get("icon-ignore-placement"),te=X&&Y,J=this._inProgressLayer=this._inProgressLayer||new fh(D),re=r.B(C.source,C.scope);if(J.continuePlacement(U||te?m[re]:u[re],this.placement,this._showCollisionBoxes,C,A,y))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(i){return this.placement.commit(i),this.placement}}const Un=512/r.al/2;class Ks{constructor(i,o,u){this.tileID=i,this.bucketInstanceId=u,this.index=new r.c3(o.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const m=i.canonical.x*r.al,y=i.canonical.y*r.al;for(let b=0;b<o.length;b++){const{key:A,crossTileID:C,tileAnchorX:z,tileAnchorY:D}=o.get(b),U=Math.floor((m+z)*Un),F=Math.floor((y+D)*Un);this.index.add(U,F),this.keys.push(A),this.crossTileIDs.push(C)}this.index.finish()}findMatches(i,o,u){const m=this.tileID.canonical.z<o.canonical.z?1:Math.pow(2,this.tileID.canonical.z-o.canonical.z),y=Un/Math.pow(2,o.canonical.z-this.tileID.canonical.z),b=o.canonical.x*r.al,A=o.canonical.y*r.al;for(let C=0;C<i.length;C++){const z=i.get(C);if(z.crossTileID)continue;const{key:D,tileAnchorX:U,tileAnchorY:F}=z,W=Math.floor((b+U)*y),X=Math.floor((A+F)*y),Y=this.index.range(W-m,X-m,W+m,X+m).sort((te,J)=>te-J);for(const te of Y){const J=this.crossTileIDs[te];if(this.keys[te]===D&&!u.has(J)){u.add(J),z.crossTileID=J;break}}}}}class lp{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class il{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(i){const o=Math.round((i-this.lng)/360);if(o!==0)for(const u in this.indexes){const m=this.indexes[u],y={};for(const b in m){const A=m[b];A.tileID=A.tileID.unwrapTo(A.tileID.wrap+o),y[A.tileID.key]=A}this.indexes[u]=y}this.lng=i}addBucket(i,o,u){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===o.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(let y=0;y<o.symbolInstances.length;y++)o.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]=new Set);const m=this.usedCrossTileIDs[i.overscaledZ];for(const y in this.indexes){const b=this.indexes[y];if(Number(y)>i.overscaledZ)for(const A in b){const C=b[A];C.tileID.isChildOf(i)&&C.findMatches(o.symbolInstances,i,m)}else{const A=b[i.scaledTo(Number(y)).key];A&&A.findMatches(o.symbolInstances,i,m)}}for(let y=0;y<o.symbolInstances.length;y++){const b=o.symbolInstances.get(y);b.crossTileID||(b.crossTileID=u.generate(),m.add(b.crossTileID))}return this.indexes[i.overscaledZ]===void 0&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new Ks(i,o.symbolInstances,o.bucketInstanceId),!0}removeBucketCrossTileIDs(i,o){for(const u of o.crossTileIDs)this.usedCrossTileIDs[i].delete(u)}removeStaleBuckets(i){let o=!1;for(const u in this.indexes){const m=this.indexes[u];for(const y in m)i[m[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(u,m[y]),delete m[y],o=!0)}return o}}class ys{constructor(){this.layerIndexes={},this.crossTileIDs=new lp,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(i,o,u,m){let y=this.layerIndexes[i.fqid];y===void 0&&(y=this.layerIndexes[i.fqid]=new il);let b=!1;const A={};m.name!=="globe"&&y.handleWrapJump(u);for(const C of o){const z=C.getBucket(i);z&&i.fqid===z.layerIds[0]&&(z.bucketInstanceId||(z.bucketInstanceId=++this.maxBucketInstanceId),y.addBucket(C.tileID,z,this.crossTileIDs)&&(b=!0),A[z.bucketInstanceId]=!0)}return y.removeStaleBuckets(A)&&(b=!0),b}pruneUnusedLayers(i){const o={};i.forEach(u=>{o[u]=!0});for(const u in this.layerIndexes)o[u]||delete this.layerIndexes[u]}}const Qs=771;class bi{constructor(i,o,u,m){this.blendFunction=i,this.blendColor=o.toNonPremultipliedRenderColor(null),this.mask=u,this.blendEquation=m}}bi.Replace=[1,0,1,0],bi.disabled=new bi(bi.Replace,r.ao.transparent,[!1,!1,!1,!1]),bi.unblended=new bi(bi.Replace,r.ao.transparent,[!0,!0,!0,!0]),bi.alphaBlended=new bi([1,Qs,1,Qs],r.ao.transparent,[!0,!0,!0,!0]),bi.alphaBlendedNonPremultiplied=new bi([770,Qs,770,Qs],r.ao.transparent,[!0,!0,!0,!0]),bi.multiply=new bi([774,0,774,0],r.ao.transparent,[!0,!0,!0,!0]);class Rt{constructor(i,o,u){this.func=i,this.mask=o,this.range=u}}Rt.ReadOnly=!1,Rt.ReadWrite=!0,Rt.disabled=new Rt(519,Rt.ReadOnly,[0,1]);const hc=7680;class ii{constructor(i,o,u,m,y,b){this.test=i,this.ref=o,this.mask=u,this.fail=m,this.depthFail=y,this.pass=b}}ii.disabled=new ii({func:519,mask:0},0,0,hc,hc,hc);const bo=1029,rl=2305;class ai{constructor(i,o,u){this.enable=i,this.mode=o,this.frontFace=u}}function id(d,i){const o=r.c9(d,3);r.cb(d,i),r.cf(d,3,o)}function uc(d,i){const o=r.c6([]);return r.c7(o,o,-i),r.c8(o,o,-d),o}function dc(d,i){const o=[d[0],d[1],0],u=[i[0],i[1],0];if(r.ag(o)>=1e-15){const b=r.aw([],o);r.c4(u,b,r.bJ(u,b)),i[0]=u[0],i[1]=u[1]}const m=r.bI([],i,d);if(r.c5(m)<1e-15)return null;const y=Math.atan2(-m[1],m[0]);return uc(Math.atan2(Math.sqrt(d[0]*d[0]+d[1]*d[1]),-d[2]),y)}ai.disabled=new ai(!1,bo,rl),ai.backCCW=new ai(!0,bo,rl),ai.backCW=new ai(!0,bo,2304),ai.frontCW=new ai(!0,1028,2304),ai.frontCCW=new ai(!0,1028,rl);class rd{constructor(i,o){this.position=i,this.orientation=o}get position(){return this._position}set position(i){if(i){const o=i instanceof r.ae?i:new r.ae(i[0],i[1],i[2]);this._renderWorldCopies&&(o.x=r.bT(o.x,0,1)),this._position=o}else this._position=null}lookAtPoint(i,o){if(this.orientation=null,!this.position)return;const u=this.position,m=this._elevation?this._elevation.getAtPointOrZero(r.ae.fromLngLat(i)):0,y=r.ae.fromLngLat(i,m),b=[y.x-u.x,y.y-u.y,y.z-u.z];o||(o=[0,0,1]),o[2]=Math.abs(o[2]),this.orientation=dc(b,o)}setPitchBearing(i,o){this.orientation=uc(r.an(i),r.an(-o))}}class ph{constructor(i,o){this._transform=r.bA([]),this.orientation=o,this.position=i}get mercatorPosition(){const i=this.position;return new r.ae(i[0],i[1],i[2])}get position(){const i=r.c9(this._transform,3);return[i[0],i[1],i[2]]}set position(i){var o;i&&r.cf(this._transform,3,[(o=i)[0],o[1],o[2],1])}get orientation(){return this._orientation}set orientation(i){this._orientation=i||r.c6([]),i&&id(this._transform,this._orientation)}getPitchBearing(){const i=this.forward(),o=this.right();return{bearing:Math.atan2(-o[1],o[0]),pitch:Math.atan2(Math.sqrt(i[0]*i[0]+i[1]*i[1]),-i[2])}}setPitchBearing(i,o){this._orientation=uc(i,o),id(this._transform,this._orientation)}forward(){const i=r.c9(this._transform,2);return[-i[0],-i[1],-i[2]]}up(){const i=r.c9(this._transform,1);return[-i[0],-i[1],-i[2]]}right(){const i=r.c9(this._transform,0);return[i[0],i[1],i[2]]}getCameraToWorld(i,o){const u=new Float64Array(16);return r.bl(u,this.getWorldToCamera(i,o)),u}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(i,o,u){const m=this.position;r.c4(m,m,-i);const y=new Float64Array(16);return r.bq(y,[u,u,u]),r.br(y,y,m),y[10]*=o,y}getWorldToCamera(i,o){const u=new Float64Array(16),m=new Float64Array(4),y=this.position;return r.ca(m,this._orientation),r.c4(y,y,-i),r.cb(u,m),r.br(u,u,y),u[1]*=-1,u[5]*=-1,u[9]*=-1,u[13]*=-1,u[8]*=o,u[9]*=o,u[10]*=o,u[11]*=o,u}getCameraToClipPerspective(i,o,u,m){const y=new Float64Array(16);return r.cc(y,i,o,u,m),y}getCameraToClipOrthographic(i,o,u,m,y,b){const A=new Float64Array(16);return r.cd(A,i,o,u,m,y,b),A}getDistanceToElevation(i,o=!1){const u=i===0?0:r.ce(i,o?r.a$(this.position[1]):this.position[1]),m=this.forward();return(u-this.position[2])/m[2]}clone(){return new ph([...this.position],[...this.orientation])}}const ts={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class sd{constructor(i=0,o=0,u=0,m=0){if(isNaN(i)||i<0||isNaN(o)||o<0||isNaN(u)||u<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=o,this.left=u,this.right=m}interpolate(i,o,u){return o.top!=null&&i.top!=null&&(this.top=r.ak(i.top,o.top,u)),o.bottom!=null&&i.bottom!=null&&(this.bottom=r.ak(i.bottom,o.bottom,u)),o.left!=null&&i.left!=null&&(this.left=r.ak(i.left,o.left,u)),o.right!=null&&i.right!=null&&(this.right=r.ak(i.right,o.right,u)),this}getCenter(i,o){const u=r.aA((this.left+i-this.right)/2,0,i),m=r.aA((this.top+o-this.bottom)/2,0,o);return new r.P(u,m)}equals(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right}clone(){return new sd(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const ba=15;class Gs{constructor(i,o,u,m,y,b,A){this.tileSize=512,this._renderWorldCopies=y===void 0||y,this._minZoom=i||0,this._maxZoom=o||22,this._minPitch=u!=null?u:0,this._maxPitch=m!=null?m:60,this.setProjection(b),this.setMaxBounds(A),this.width=0,this.height=0,this._center=new r.aR(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new sd,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new ph,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const i=new Gs(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return i._elevation=this._elevation,i._centerAltitude=this._centerAltitude,i._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,i.tileSize=this.tileSize,i.mercatorFromTransition=this.mercatorFromTransition,i.width=this.width,i.height=this.height,i.cameraElevationReference=this.cameraElevationReference,i._center=this._center,i._setZoom(this.zoom),i._seaLevelZoom=this._seaLevelZoom,i.angle=this.angle,i._fov=this._fov,i._pitch=this._pitch,i._nearZ=this._nearZ,i._farZ=this._farZ,i._averageElevation=this._averageElevation,i._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,i._unmodified=this._unmodified,i._edgeInsets=this._edgeInsets.clone(),i._camera=this._camera.clone(),i._calcMatrices(),i.freezeTileCoverage=this.freezeTileCoverage,i.frustumCorners=this.frustumCorners,i._allowWorldUnderZoom=this._allowWorldUnderZoom,i}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<ba}get elevation(){return this._elevation}set elevation(i){this._elevation!==i&&(this._elevation=i,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(i,o=!1){const u=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||u)&&this._updateCameraOnTerrain(),(i||u)&&this._constrainCamera(o),this._calcMatrices()}getProjection(){return r.aH(this.projection,["name","center","parallels"])}setProjection(i){this.projectionOptions=i||{name:"mercator"};const o=this.projection?this.getProjection():void 0;this.projection=r.cl(this.projectionOptions);const u=this.getProjection(),m=!r.by(o,u);return m&&this._calcMatrices(),this.mercatorFromTransition=!1,m}setOrthographicProjectionAtLowPitch(i){return this._orthographicProjectionAtLowPitch!==i&&(this._orthographicProjectionAtLowPitch=i,this._calcMatrices(),!0)}setMercatorFromTransition(){const i=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=r.cl({name:"mercator"});const o=i!==this.projection.name;return o&&this._calcMatrices(),o}get minZoom(){return this._minZoom}set minZoom(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))}get maxZoom(){return this._maxZoom}set maxZoom(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))}get minPitch(){return this._minPitch}set minPitch(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))}get maxPitch(){return this._maxPitch}set maxPitch(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(i){i===void 0?i=!0:i===null&&(i=!1),this._renderWorldCopies=i}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get cameraWorldSize(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return r.ce(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new r.P(this.width,this.height)}get bearing(){return r.bT(this.rotation,-180,180)}set bearing(i){this.rotation=i}get rotation(){return-this.angle/Math.PI*180}set rotation(i){const o=-i*Math.PI/180;this.angle!==o&&(this._unmodified=!1,this.angle=o,this._calcMatrices(),this.rotationMatrix=r.cm(),r.cn(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(i){const o=r.aA(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==o&&(this._unmodified=!1,this._pitch=o,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=r.an(i),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const i=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/i)}get averageElevation(){return this._averageElevation}set averageElevation(i){this._averageElevation=i,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(i){const o=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==o&&(this._unmodified=!1,this._setZoom(o),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(i){this._zoom=i,this.scale=this.zoomScale(i),this.tileZoom=Math.floor(i),this.zoomFraction=i-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(i){this._tileCoverLift!==i&&(this._tileCoverLift=i)}_updateCameraOnTerrain(){const i=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,o=this.elevation&&i===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||i===Number.NEGATIVE_INFINITY&&(!o||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const u=this._elevation;o||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&u.exaggeration()&&this._centerAltitudeValidForExaggeration!==u.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*u.exaggeration(),this._centerAltitudeValidForExaggeration=u.exaggeration()):(this._centerAltitude=i||0,this._centerAltitudeValidForExaggeration=u.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const i=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(i)}sampleAverageElevation(){if(!this._elevation)return 0;const i=this._elevation,o=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],u=this.horizonLineFromTop();let m=0,y=0;for(let b=0;b<o.length;b++){const A=new r.P(o[b][0]*this.width,u+o[b][1]*(this.height-u)),C=i.pointCoordinate(A);if(!C)continue;const z=1/Math.hypot(C[0]-this._camera.position[0],C[1]-this._camera.position[1]);m+=C[3]*z,y+=z}return y===0?NaN:m/y}get center(){return this._center}set center(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const i=this._seaLevelZoom,o=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),u=this.pixelsPerMeter/this.worldSize*o,m=this._mercatorZfromZoom(i),y=this._mercatorZfromZoom(this._maxZoom),b=Math.max(m-u,y);this._setZoom(this._zoomFromMercatorZ(b))}get padding(){return this._edgeInsets.toJSON()}set padding(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())}computeZoomRelativeTo(i){const o=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,i.toAltitude()));let u;u=i.z<this._camera.position[2]?[o.x,o.y,o.z]:[i.x,i.y,i.z];const m=r.ag(r.av([],this._camera.position,u));return r.aA(this._zoomFromMercatorZ(m),this._minZoom,this._maxZoom)}setFreeCameraOptions(i){if(!this.height||!i.position&&!i.orientation)return;this._updateCameraState();let o=!1;if(i.orientation&&!r.co(i.orientation,this._camera.orientation)&&(o=this._setCameraOrientation(i.orientation)),i.position){const u=[i.position.x,i.position.y,i.position.z];r.cp(u,this._camera.position)||(this._setCameraPosition(u),o=!0)}o&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const i=this._camera.position,o=new rd;return o.position=new r.ae(i[0],i[1],i[2]),o.orientation=this._camera.orientation,o._elevation=this.elevation,o._renderWorldCopies=this.renderWorldCopies,o}_setCameraOrientation(i){if(!r.cq(i))return!1;r.cr(i,i);const o=r.cs([],[0,0,-1],i),u=r.cs([],[0,-1,0],i);if(u[2]<0)return!1;const m=dc(o,u);return!!m&&(this._camera.orientation=m,!0)}_setCameraPosition(i){const o=this.zoomScale(this.minZoom)*this.tileSize,u=this.zoomScale(this.maxZoom)*this.tileSize,m=this.cameraToCenterDistance;i[2]=r.aA(i[2],m/u,m/o),this._camera.position=i}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(i){return this._edgeInsets.equals(i)}interpolatePadding(i,o,u){this._unmodified=!1,this._edgeInsets.interpolate(i,o,u),this._constrain(),this._calcMatrices()}coveringZoomLevel(i){const o=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,o)}getVisibleUnwrappedCoordinates(i){const o=[new r.ct(0,i)];if(this.renderWorldCopies){const u=this.pointCoordinate(new r.P(0,0)),m=this.pointCoordinate(new r.P(this.width,0)),y=this.pointCoordinate(new r.P(this.width,this.height)),b=this.pointCoordinate(new r.P(0,this.height)),A=Math.floor(Math.min(u.x,m.x,y.x,b.x)),C=Math.floor(Math.max(u.x,m.x,y.x,b.x)),z=1;for(let D=A-z;D<=C+z;D++)D!==0&&o.push(new r.ct(D,i))}return o}isLODDisabled(i){return(!i||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(i,o,u){let m=[];const y=u!=null,b=!y;if(b&&this.zoom<o||y&&u[0]===0&&u[1]===0)return m;const A=new Set,C=(D,U,F,W,X)=>{const Y=r.cX(U,D,F,W,X);A.has(Y)||(m.push(new r.aO(D,U,F,W,X)),A.add(Y))};for(let D=0;D<i.length;D++){const U=i[D];if(b&&U.canonical.z!==o)continue;const F=U.canonical,W=U.overscaledZ,X=U.wrap,Y=1<<F.z,te=F.x+1<Y,J=F.x>0,re=F.y+1<Y,oe=F.y>0,he=U.wrap-(J?0:1),ye=U.wrap+(te?0:1),me=J?F.x-1:Y-1,xe=te?F.x+1:0;if(y)u[0]<0?(C(W,ye,F.z,xe,F.y),u[1]<0&&re&&(C(W,X,F.z,F.x,F.y+1),C(W,ye,F.z,xe,F.y+1)),u[1]>0&&oe&&(C(W,X,F.z,F.x,F.y-1),C(W,ye,F.z,xe,F.y-1))):u[0]>0?(C(W,he,F.z,me,F.y),u[1]<0&&re&&(C(W,X,F.z,F.x,F.y+1),C(W,he,F.z,me,F.y+1)),u[1]>0&&oe&&(C(W,X,F.z,F.x,F.y-1),C(W,he,F.z,me,F.y-1))):u[1]<0&&re?C(W,X,F.z,F.x,F.y+1):oe&&C(W,X,F.z,F.x,F.y-1);else{const _e=U.visibleQuadrants;1&_e&&(C(W,he,F.z,me,F.y),oe&&(C(W,X,F.z,F.x,F.y-1),C(W,he,F.z,me,F.y-1))),2&_e&&(C(W,ye,F.z,xe,F.y),oe&&(C(W,X,F.z,F.x,F.y-1),C(W,ye,F.z,xe,F.y-1))),4&_e&&(C(W,he,F.z,me,F.y),re&&(C(W,X,F.z,F.x,F.y+1),C(W,he,F.z,me,F.y+1))),8&_e&&(C(W,ye,F.z,xe,F.y),re&&(C(W,X,F.z,F.x,F.y+1),C(W,ye,F.z,xe,F.y+1)))}}const z=[];for(const D of m)m.some(U=>D.isChildOf(U))||z.push(D);if(m=z.filter(D=>!i.some(U=>!!(D.overscaledZ<o&&U.isChildOf(D))||D.equals(U)||D.isChildOf(U))),b){const D=1<<o,U=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),F=[D*U.x,D*U.y],W=4,X=W*W;m=m.filter(Y=>{const te=Y.canonical.x+.5-F[0],J=Y.canonical.y+.5-F[1];return te*te+J*J<X})}return m}extendTileCoverToNearPlane(i,o,u){const m=[],y=new Set;for(const re of i)y.add(re.key);const b=(re,oe,he,ye,me)=>{const xe=r.cX(oe,re,he,ye,me);y.has(xe)||(m.push(new r.aO(re,oe,he,ye,me)),y.add(xe))},A=i.reduce((re,oe)=>Math.max(re,oe.overscaledZ),u),C=1<<u,z=[new r.P(0,0),new r.P(r.al,0),new r.P(r.al,r.al),new r.P(0,r.al)],D=new r.P(0,0),U=new r.P(0,0),F=(re,oe)=>{const he=Math.floor(re[0]),ye=Math.floor(re[1]),me=(re[0]-he)*r.al,xe=(re[1]-ye)*r.al,_e=Math.floor(oe[0]),ge=Math.floor(oe[1]),Ae=(oe[0]-_e)*r.al,je=(oe[1]-ge)*r.al;for(let Re=-1;Re<=1;Re++){const Je=he+Re;if(!(Je<0||Je>=C)){D.x=me-Re*r.al,U.x=Ae-(Je-_e)*r.al;for(let Ne=-1;Ne<=1;Ne++){const $e=ye+Ne;D.y=xe-Ne*r.al,U.y=je-($e-ge)*r.al,r.cY(D,U,z)&&b(A,0,u,Je,$e)}}}},W=o.points,X=W[r.cu],Y=W[r.cv],te=this._projectToGround(X,W[r.cw]),J=this._projectToGround(Y,W[r.cx]);return F(X,te),F(Y,J),m}_projectToGround(i,o){return r.cy(r.cz(),i,o,i[2]/(i[2]-o[2]))}coveringTiles(i){let o=this.coveringZoomLevel(i);const u=o,m=this.elevation&&this.elevation.exaggeration(),y=m&&!i.isTerrainDEM,b=this.projection.name==="mercator";if(i.minzoom!==void 0&&o<i.minzoom)return[];i.maxzoom!==void 0&&o>i.maxzoom&&(o=i.maxzoom);const A=this.locationCoordinate(this.center),C=this.center.lat,z=1<<o,D=[z*A.x,z*A.y,0],U=this.projection.name==="globe",F=!U,W=r.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,o,F),X=U?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Y=z*r.ce(1,this.center.lat),te=this._camera.position[2]/r.ce(1,this.center.lat),J=[z*X.x,z*X.y,te*(F?1:Y)],re=U||m,oe=this.cameraToCenterDistance/i.tileSize*(i.roundZoom?1:.502),he=this.isLODDisabled(!0)?o:0;let ye;if(this._elevation&&i.isTerrainDEM)ye=1e4*this._elevation.exaggeration();else if(this._elevation){const Pe=this._elevation.getMinMaxForVisibleTiles();ye=Pe?Pe.max:this._centerAltitude}else ye=this._centerAltitude;const me=i.isTerrainDEM?-ye:this._elevation?this._elevation.getMinElevationBelowMSL():0,xe=this.projection.isReprojectedInTileSpace?r.cB(this):1,_e=Pe=>{const We=new r.ae(Pe.x+25e-6,Pe.y,Pe.z),at=new r.ae(Pe.x,Pe.y+25e-6,Pe.z),xt=Pe.toLngLat(),Pt=We.toLngLat(),pt=at.toLngLat(),ht=this.locationCoordinate(xt),Wt=this.locationCoordinate(Pt),Ut=this.locationCoordinate(pt),Ht=Math.hypot(Wt.x-ht.x,Wt.y-ht.y),Vt=Math.hypot(Ut.x-ht.x,Ut.y-ht.y);return Math.sqrt(Ht*Vt)*xe/25e-6},ge=Pe=>{const Qe=ye,We=me;return{aabb:r.cE(this,z,0,0,0,Pe,We,Qe,this.projection),zoom:0,x:0,y:0,minZ:We,maxZ:Qe,wrap:Pe,fullyVisible:!1}},Ae=[];let je=[];const Re=o,Je=i.reparseOverscaled?u:o,Ne=(te-this._centerAltitude)*Y,$e=Pe=>{if(!this._elevation||!Pe.tileID||!b)return;const Qe=this._elevation.getMinMaxForTile(Pe.tileID),We=Pe.aabb;Qe?(We.min[2]=Qe.min,We.max[2]=Qe.max,We.center[2]=(We.min[2]+We.max[2])/2):(Pe.shouldSplit=Ve(Pe),Pe.shouldSplit||(We.min[2]=We.max[2]=We.center[2]=this._centerAltitude))},vt=(Pe,Qe)=>{if(.707*Qe<Pe)return 1;const We=Qe/Pe;return We/(1.4144271570014144+(Math.pow(1.1,We-1.4144271570014144+1)-1)/(1.1-1)-1)},Ve=Pe=>{if(Pe.zoom<he)return!0;if(Pe.zoom===Re)return!1;if(Pe.shouldSplit!=null)return Pe.shouldSplit;const Qe=Pe.aabb.distanceX(J),We=Pe.aabb.distanceY(J);let at=Ne,xt=1;if(U){at=Pe.aabb.distanceZ(J);const Vt=Math.pow(2,Pe.zoom),oi=r.a$((Pe.y+1)/Vt),yi=r.a$(Pe.y/Vt),wi=Math.min(Math.max(C,oi),yi),ir=r.d0(wi)/r.d0(C);if(xt=wi===C?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,ir/this._mercatorScaleRatio),this.zoom<=r.cZ&&Pe.zoom===Re-1&&ir>=.9)return!0}else if(y&&(at=Pe.aabb.distanceZ(J)*Y),this.projection.isReprojectedInTileSpace&&u<=5){const Vt=Math.pow(2,Pe.zoom),oi=_e(new r.ae((Pe.x+.5)/Vt,(Pe.y+.5)/Vt));xt=oi>.85?1:oi}if(!b){const Vt=Math.sqrt(Qe*Qe+We*We+at*at);let oi=(1<<Re-Pe.zoom)*oe*xt;return oi*=vt(Math.max(at,Ne),Vt),Vt<oi}let Pt=Number.MAX_VALUE,pt=0;const ht=Pe.aabb.getCorners(),Wt=[];for(const Vt of ht){r.av(Wt,Vt,J),U||(y?Wt[2]*=Y:Wt[2]=Ne);const oi=r.bJ(Wt,this._camera.forward());oi<Pt&&(Pt=oi,pt=Math.abs(Wt[2]))}let Ut=(1<<Re-Pe.zoom)*oe*xt;if(Ut*=vt(Math.max(pt,Ne),Pt),Pt<Ut)return!0;const Ht=Pe.aabb.closestPoint(D);return Ht[0]===D[0]&&Ht[1]===D[1]};if(this.renderWorldCopies)for(let Pe=1;Pe<=3;Pe++)Ae.push(ge(-Pe)),Ae.push(ge(Pe));for(Ae.push(ge(0));Ae.length>0;){const Pe=Ae.pop(),Qe=Pe.x,We=Pe.y;let at=Pe.fullyVisible;const xt=()=>this.projection.name==="globe"&&(Pe.y===0||Pe.y===(1<<Pe.zoom)-1);if(!at){let Pt=re?Pe.aabb.intersects(W):Pe.aabb.intersectsFlat(W);if(Pt===0&&xt()){const pt=new r.cC(Pe.zoom,Qe,We);Pt=r.cD(this,z,pt,!0).intersects(W)}if(Pt===0)continue;at=Pt===2}if(Pe.zoom!==Re&&Ve(Pe))for(let Pt=0;Pt<4;Pt++){const pt=(Qe<<1)+Pt%2,ht=(We<<1)+(Pt>>1),Wt={aabb:b?Pe.aabb.quadrant(Pt):r.cE(this,z,Pe.zoom+1,pt,ht,Pe.wrap,Pe.minZ,Pe.maxZ,this.projection),zoom:Pe.zoom+1,x:pt,y:ht,wrap:Pe.wrap,fullyVisible:at,tileID:void 0,shouldSplit:void 0,minZ:Pe.minZ,maxZ:Pe.maxZ};y&&!U&&(Wt.tileID=new r.aO(Pe.zoom+1===Re?Je:Pe.zoom+1,Pe.wrap,Pe.zoom+1,pt,ht),$e(Wt)),Ae.push(Wt)}else{const Pt=Pe.zoom===Re?Je:Pe.zoom;if(i.minzoom&&i.minzoom>Pt)continue;let pt=0;if(!at){let Ht=re?Pe.aabb.intersectsPrecise(W):Pe.aabb.intersectsPreciseFlat(W);if(Ht===0&&xt()){const Vt=new r.cC(Pe.zoom,Qe,We);Ht=r.cD(this,z,Vt,!0).intersectsPrecise(W)}if(Ht===0)continue;if(i.calculateQuadrantVisibility)if(W.containsPoint(Pe.aabb.center))pt=15;else for(let Vt=0;Vt<4;Vt++)Pe.aabb.quadrant(Vt).intersects(W)!==0&&(pt|=1<<Vt)}const ht=D[0]-(.5+Qe+(Pe.wrap<<Pe.zoom))*(1<<o-Pe.zoom),Wt=D[1]-.5-We,Ut=Pe.tileID?Pe.tileID:new r.aO(Pt,Pe.wrap,Pe.zoom,Qe,We);i.calculateQuadrantVisibility&&(Ut.visibleQuadrants=pt),je.push({tileID:Ut,distanceSq:ht*ht+Wt*Wt})}}if(this.fogCullDistSq){const Pe=this.fogCullDistSq,Qe=this.horizonLineFromTop();je=je.filter(We=>{const at=[0,0,0,1],xt=[r.al,r.al,0,1],Pt=this.calculateFogTileMatrix(We.tileID.toUnwrapped());r.aC(at,at,Pt),r.aC(xt,xt,Pt);const pt=r.cF([],at,xt),ht=r.cG([],at,xt),Wt=r.c_(pt,ht);if(Wt===0)return!0;let Ut=!1;const Ht=this._elevation;if(Ht&&Wt>Pe&&Qe!==0){const Vt=this.calculateProjMatrix(We.tileID.toUnwrapped());let oi;i.isTerrainDEM||(oi=Ht.getMinMaxForTile(We.tileID)),oi||(oi={min:me,max:ye});const yi=r.cH(this.rotation),wi=[yi[0]*r.al,yi[1]*r.al,oi.max];r.af(wi,wi,Vt),Ut=(1-wi[1])*this.height*.5<Qe}return Wt<Pe||Ut})}return je.sort((Pe,Qe)=>Pe.distanceSq-Qe.distanceSq).map(Pe=>Pe.tileID)}resize(i,o){this.width=i,this.height=o,this.pixelsToGLUnits=[2/i,-2/o],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(i){return Math.pow(2,i)}scaleZoom(i){return Math.log2(i)}project(i){const o=r.aA(i.lat,-r.cI,r.cI),u=this.projection.project(i.lng,o);return new r.P(u.x*this.worldSize,u.y*this.worldSize)}unproject(i){return this.projection.unproject(i.x/this.worldSize,i.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/r.ce(1,this.center.lat)/this.worldSize}setLocationAtPoint(i,o){let u,m;const y=this.centerPoint;if(this.projection.name==="globe"){const A=this.worldSize;u=(o.x-y.x)/A,m=(o.y-y.y)/A}else{const A=this.pointCoordinate(o),C=this.pointCoordinate(y);u=A.x-C.x,m=A.y-C.y}const b=this.locationCoordinate(i);this.setLocation(new r.ae(b.x-u,b.y-m))}setLocation(i){this.center=this.coordinateLocation(i),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(i,o){return this.projection.locationPoint(this,i,o)}locationPoint3D(i,o){return this.projection.locationPoint(this,i,o,!0)}pointLocation(i){return this.coordinateLocation(this.pointCoordinate(i))}pointLocation3D(i,o){return this.coordinateLocation(this.pointCoordinate3D(i,o))}locationCoordinate(i,o){const u=o?r.ce(o,i.lat):void 0,m=this.projection.project(i.lng,i.lat);return new r.ae(m.x,m.y,u)}coordinateLocation(i){return this.projection.unproject(i.x,i.y)}pointRayIntersection(i,o){const u=o!=null?o:this._centerAltitude,m=[i.x,i.y,0,1],y=[i.x,i.y,1,1];r.aC(m,m,this.pixelMatrixInverse),r.aC(y,y,this.pixelMatrixInverse);const b=y[3];r.cJ(m,m,1/m[3]),r.cJ(y,y,1/b);const A=m[2],C=y[2];return{p0:m,p1:y,t:A===C?0:(u-A)/(C-A)}}screenPointToMercatorRay(i){const o=[i.x,i.y,0,1],u=[i.x,i.y,1,1];return r.aC(o,o,this.pixelMatrixInverse),r.aC(u,u,this.pixelMatrixInverse),r.cJ(o,o,1/o[3]),r.cJ(u,u,1/u[3]),o[2]=r.ce(o[2],this._center.lat)*this.worldSize,u[2]=r.ce(u[2],this._center.lat)*this.worldSize,r.cJ(o,o,1/this.worldSize),r.cJ(u,u,1/this.worldSize),new r.ax([o[0],o[1],o[2]],r.aw([],r.av([],u,o)))}rayIntersectionCoordinate(i){const{p0:o,p1:u,t:m}=i,y=r.ce(o[2],this._center.lat),b=r.ce(u[2],this._center.lat);return new r.ae(r.ak(o[0],u[0],m)/this.worldSize,r.ak(o[1],u[1],m)/this.worldSize,r.ak(y,b,m))}pointCoordinate(i,o=this._centerAltitude){return this.projection.pointCoordinate(this,i.x,i.y,o)}pointCoordinate3D(i,o){if(!this.elevation)return this.pointCoordinate(i,o);let u=this.projection.pointCoordinate3D(this,i.x,i.y);if(u)return new r.ae(u[0],u[1],u[2]);let m=0,y=this.horizonLineFromTop();if(i.y>y)return this.pointCoordinate(i,o);const b=.02*y,A=i.clone();for(let C=0;C<10&&y-m>b;C++){A.y=r.ak(m,y,.66);const z=this.projection.pointCoordinate3D(this,A.x,A.y);z?(y=A.y,u=z):m=A.y}return u?new r.ae(u[0],u[1],u[2]):this.pointCoordinate(i)}isPointAboveHorizon(i){return this.projection.isPointAboveHorizon(this,i)}isPointOnSurface(i){if(i.y<0||i.y>this.height||i.x<0||i.x>this.width)return!1;if(this.elevation||this.zoom>=r.cK)return!this.isPointAboveHorizon(i);const o=this.pointCoordinate(i);return o.y>=0&&o.y<=1}_coordinatePoint(i,o){const u=o&&this.elevation?this.elevation.getAtPointOrZero(i,this._centerAltitude):this._centerAltitude,m=[i.x*this.worldSize,i.y*this.worldSize,u+i.toAltitude(),1];return r.aC(m,m,this.pixelMatrix),m[3]>0?new r.P(m[0]/m[3],m[1]/m[3]):new r.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:i,left:o}=this._edgeInsets,u=this.height-this._edgeInsets.bottom,m=this.width-this._edgeInsets.right,y=this.pointLocation3D(new r.P(o,i)),b=this.pointLocation3D(new r.P(m,i)),A=this.pointLocation3D(new r.P(m,u)),C=this.pointLocation3D(new r.P(o,u));let z=Math.min(y.lng,b.lng,A.lng,C.lng),D=Math.max(y.lng,b.lng,A.lng,C.lng),U=Math.min(y.lat,b.lat,A.lat,C.lat),F=Math.max(y.lat,b.lat,A.lat,C.lat);const W=Math.pow(2,-this.zoom)/16*270,X=this.projection.name==="globe"?1:4,Y=(te,J,re,oe,he)=>{const ye=(te+re)/2,me=(J+oe)/2,xe=new r.P(ye,me),{lng:_e,lat:ge}=this.pointLocation3D(xe),Ae=Math.max(0,z-_e,U-ge,_e-D,ge-F);z=Math.min(z,_e),D=Math.max(D,_e),U=Math.min(U,ge),F=Math.max(F,ge),(he<X||Ae>W)&&(Y(te,J,ye,me,he+1),Y(ye,me,re,oe,he+1))};if(Y(o,i,m,i,1),Y(m,i,m,u,1),Y(m,u,o,u,1),Y(o,u,o,i,1),this.projection.name==="globe"){const[te,J]=r.cL(this);te?(F=90,D=180,z=-180):J&&(U=-90,D=180,z=-180)}return new r.aI(new r.aR(z,U),new r.aR(D,F))}_getBoundsRectangular(i,o){const{top:u,left:m}=this._edgeInsets,y=this.height-this._edgeInsets.bottom,b=this.width-this._edgeInsets.right,A=new r.P(m,u),C=new r.P(b,u),z=new r.P(b,y),D=new r.P(m,y);let U=this.pointCoordinate(A,i),F=this.pointCoordinate(C,i);const W=this.pointCoordinate(z,o),X=this.pointCoordinate(D,o),Y=(te,J)=>(J.y-te.y)/(J.x-te.x);return U.y>1&&F.y>=0?U=new r.ae((1-X.y)/Y(X,U)+X.x,1):U.y<0&&F.y<=1&&(U=new r.ae(-X.y/Y(X,U)+X.x,0)),F.y>1&&U.y>=0?F=new r.ae((1-W.y)/Y(W,F)+W.x,1):F.y<0&&U.y<=1&&(F=new r.ae(-W.y/Y(W,F)+W.x,0)),new r.aI().extend(this.coordinateLocation(U)).extend(this.coordinateLocation(F)).extend(this.coordinateLocation(X)).extend(this.coordinateLocation(W))}_getBoundsRectangularTerrain(){const i=this.elevation;if(!i.visibleDemTiles.length||i.isUsingMockSource())return this._getBoundsRectangular(0,0);const o=i.visibleDemTiles.reduce((u,m)=>{if(m.dem){const y=m.dem.tree;u.min=Math.min(u.min,y.minimums[0]),u.max=Math.max(u.max,y.maximums[0])}return u},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(o.min*i.exaggeration(),o.max*i.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(i=!0){const o=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,u=this.height/2-o*(1-this._horizonShift);return i?Math.max(0,u):u}getMaxBounds(){return this.maxBounds}setMaxBounds(i){this.maxBounds=i,this.minLat=-r.cI,this.maxLat=r.cI,this.minLng=-180,this.maxLng=180,i&&(this.minLat=i.getSouth(),this.maxLat=i.getNorth(),this.minLng=i.getWest(),this.maxLng=i.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=r.aF(this.minLng)*this.tileSize,this.worldMaxX=r.aF(this.maxLng)*this.tileSize,this.worldMinY=r.aJ(this.maxLat)*this.tileSize,this.worldMaxY=r.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(i,o){return this.projection.createTileMatrix(this,o,i)}calculateDistanceTileData(i){const o=i.key,u=this._distanceTileDataCache;if(u[o])return u[o];const m=i.canonical,y=1/this.height,b=this.cameraWorldSize,A=b/this.zoomScale(m.z),C=(m.x+Math.pow(2,m.z)*i.wrap)*A,z=m.y*A,D=this.point;D.x*=b/this.worldSize,D.y*=b/this.worldSize;const U=this.angle,F=Math.sin(-U),W=-Math.cos(-U);return u[o]={bearing:[F,W],center:[(D.x-C)*y,(D.y-z)*y],scale:A/r.al*y},u[o]}calculateFogTileMatrix(i){const o=i.key,u=this._fogTileMatrixCache;if(u[o])return u[o];const m=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,i);return r.aB(m,this.worldToFogMatrix,m),u[o]=new Float32Array(m),u[o]}calculateProjMatrix(i,o=!1,u=!1){const m=i.key;let y;if(y=u?this._expandedProjMatrixCache:o?this._alignedProjMatrixCache:this._projMatrixCache,y[m])return y[m];const b=this.calculatePosMatrix(i,this.worldSize);let A;return A=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:u?this.expandedFarZProjMatrix:o?this.alignedProjMatrix:this.projMatrix,r.aB(b,A,b),y[m]=new Float32Array(b),y[m]}calculatePixelsToTileUnitsMatrix(i){const o=i.tileID.key,u=this._pixelsToTileUnitsCache;if(u[o])return u[o];const m=r.cM(i,this);return u[o]=m,u[o]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const i=1/this.worldSize,o=r.bq([],[i,i,i]);return r.aB(o,o,this.globeMatrix),o}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const i=this._elevation;this._updateCameraState();const o=r.ce(1,this._center.lat)*this.worldSize,u=this._computeCameraPosition(o),m=this._camera.forward(),y=r.ce(1,this._center.lat);u[2]/=y,m[2]/=y,r.aw(m,m);const b=i.raycast(u,m,i.exaggeration());if(b){const A=r.bH([],u,m,b),C=new r.ae(A[0],A[1],r.ce(A[2],r.a$(A[1]))),z=(C.z+r.ag([C.x-u[0],C.y-u[1],C.z-u[2]*y]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(z),this._centerAltitude=C.toAltitude(),this._center=this.coordinateLocation(C),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(i=!1){if(!this._elevation)return;const o=this._elevation,u=r.ce(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(u),y=o.getAtPointOrZero(new r.ae(...m)),b=this.pixelsPerMeter/this.worldSize*y,A=this._minimumHeightOverTerrain(),C=m[2]-b;if(C<=A)if(C<0||i){const z=this.locationCoordinate(this._center,this._centerAltitude),D=[m[0],m[1],z.z-m[2]],U=r.ag(D);D[2]-=(A-C)/this._pixelsPerMercatorPixel;const F=r.ag(D);if(F===0)return;r.c4(D,D,U/F*this._pixelsPerMercatorPixel),this._camera.position=[m[0],m[1],z.z*this._pixelsPerMercatorPixel-D[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const i=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||i){const F=this.center;return F.lat=r.aA(F.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!i)&&(F.lng=r.aA(F.lng,this.minLng,this.maxLng)),this.center=F,void(this._constraining=!1)}const o=this._unmodified,{x:u,y:m}=this.point;let y=0,b=u,A=m;const C=this.width/2,z=this.height/2,D=this.worldMinY*this.scale,U=this.worldMaxY*this.scale;if(m-z<D&&(A=D+z),m+z>U&&(A=U-z),U-D<this.height&&(y=Math.max(y,this.height/(U-D)),A=(U+D)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const F=this.worldMinX*this.scale,W=this.worldMaxX*this.scale,X=this.worldSize/2-(F+W)/2;b=(u+X+this.worldSize)%this.worldSize-X,b-C<F&&(b=F+C),b+C>W&&(b=W-C),W-F<this.width&&(y=Math.max(y,this.width/(W-F)),b=(W+F)/2)}b===u&&A===m||this._allowWorldUnderZoom||(this.center=this.unproject(new r.P(b,A))),y&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(y)),this._constrainCamera(),this._unmodified=o,this._constraining=!1}_minZoomForBounds(){let i=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(i=Math.max(i,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),i}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const i=this.centerOffset,o=this.projection.name==="globe",u=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=r.ce(1,this.center.lat)/r.ce(1,r.d1));const m=r.cN(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,m),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const y=this.projection.zAxisUnit==="meters"?u:1,b=this._camera.getWorldToCamera(this.worldSize,y);let A;const C=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(C[8]=2*-i.x/this.width,C[9]=2*i.y/this.height,this.isOrthographic){let ge=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Ae=ge*this.aspect,je=-Ae,Re=-ge;Ae-=i.x,je-=i.x,ge+=i.y,Re+=i.y,A=this._camera.getCameraToClipOrthographic(je,Ae,Re,ge,this._nearZ,this._farZ),((Je,Ne,$e,vt)=>{for(let Ve=0;Ve<16;Ve++)Je[Ve]=r.ak(Ne[Ve],$e[Ve],vt)})(A,A,C,r.c$(this.pitch>=ba?1:this.pitch/ba))}else A=C;const z=r.cO([],C,b);let D=r.cO([],A,b);if(this.projection.isReprojectedInTileSpace){const ge=this.locationCoordinate(this.center),Ae=r.bA([]);r.br(Ae,Ae,[ge.x*this.worldSize,ge.y*this.worldSize,0]),r.aB(Ae,Ae,r.cP(this)),r.br(Ae,Ae,[-ge.x*this.worldSize,-ge.y*this.worldSize,0]),r.aB(D,D,Ae),r.aB(z,z,Ae),this.inverseAdjustmentMatrix=r.cQ(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=r.cR([],D,[this.worldSize,this.worldSize,this.worldSize/y,1]),this.projMatrix=D,this.invProjMatrix=r.bl(new Float64Array(16),this.projMatrix),o){const ge=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);ge[8]=2*-i.x/this.width,ge[9]=2*i.y/this.height,this.expandedFarZProjMatrix=r.cO([],ge,b)}else this.expandedFarZProjMatrix=this.projMatrix;const U=r.bl([],A);this.frustumCorners=r.cS.fromInvProjectionMatrix(U,this.horizonLineFromTop(),this.height),this.cameraFrustum=r.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!o);const F=new Float32Array(16);r.bA(F),r.cR(F,F,[1,-1,1]),r.cT(F,F,this._pitch),r.bB(F,F,this.angle);const W=r.cc(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=r.bz(W);const X=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;W[8]=2*-i.x/this.width,W[9]=2*(i.y+X)/this.height,this.skyboxMatrix=r.aB(F,W,F);const Y=this.point,te=Y.x,J=Y.y,re=this.width%2/2,oe=this.height%2/2,he=Math.cos(this.angle),ye=Math.sin(this.angle),me=te-Math.round(te)+he*re+ye*oe,xe=J-Math.round(J)+he*oe+ye*re,_e=new Float64Array(D);if(r.br(_e,_e,[me>.5?me-1:me,xe>.5?xe-1:xe,0]),this.alignedProjMatrix=_e,D=r.bC(),r.cR(D,D,[this.width/2,-this.height/2,1]),r.br(D,D,[1,-1,0]),this.labelPlaneMatrix=D,D=r.bC(),r.cR(D,D,[1,-1,1]),r.br(D,D,[-1,-1,0]),r.cR(D,D,[2/this.width,2/this.height,1]),this.glCoordMatrix=D,this.pixelMatrix=r.aB(new Float64Array(16),this.labelPlaneMatrix,z),this._calcFogMatrices(),this._distanceTileDataCache={},D=r.bl(new Float64Array(16),this.pixelMatrix),!D)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=D,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=r.cU(this);const ge=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=r.af(ge,ge,b),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=D;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const i=this.cameraWorldSizeForFog,o=this.cameraPixelsPerMeter,u=this._camera.position,m=1/this.height/this._pixelsPerMercatorPixel,y=[i,i,o];r.c4(y,y,m),r.c4(u,u,-1),r.cV(u,u,y);const b=r.bC();r.br(b,b,u),r.cR(b,b,y),this.mercatorFogMatrix=b,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(i,o,m)}_computeCameraPosition(i){const o=(i=i||this.pixelsPerMeter)/this.pixelsPerMeter,u=this._camera.forward(),m=this.point,y=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*o-i/this.worldSize*this._centerAltitude;return[m.x/this.worldSize-u[0]*y,m.y/this.worldSize-u[1]*y,i/this.worldSize*this._centerAltitude-u[2]*y]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(i){const o=this._maxCameraBoundsDistance()*Math.cos(this._pitch),u=this._camera.position[2],m=i[2];let y=1;this.projection.wrap&&(this.center=this.center.wrap()),m>0&&(y=Math.min((o-u)/m,1)),this._camera.position=r.bH([],this._camera.position,i,y),this._updateStateFromCamera()}_updateStateFromCamera(){const i=this._camera.position,o=this._camera.forward(),{pitch:u,bearing:m}=this._camera.getPitchBearing(),y=r.ce(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,b=this._mercatorZfromZoom(this._maxZoom)*Math.cos(r.an(this._maxPitch)),A=Math.max((i[2]-y)/Math.cos(u),b),C=this._zoomFromMercatorZ(A);r.bH(i,i,o,A),this._pitch=r.aA(u,r.an(this.minPitch),r.an(this.maxPitch)),this.angle=r.bT(m,-Math.PI,Math.PI),this._setZoom(r.aA(C,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new r.ae(i[0],i[1],i[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(i){return Math.pow(2,i)*this.tileSize}_mercatorZfromZoom(i){return this.cameraToCenterDistance/this._worldSizeFromZoom(i)}_minimumHeightOverTerrain(){const i=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(i)}_zoomFromMercatorZ(i){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,i)*this.tileSize))}zoomFromMercatorZAdjusted(i){let o=0,u=r.cK,m=0,y=1/0;for(;u-o>1e-6&&u>o;){const b=o+.5*(u-o),A=this.tileSize*Math.pow(2,b),C=this.getCameraToCenterDistance(this.projection,b,A),z=this.scaleZoom(C/(Math.max(0,i)*this.tileSize)),D=Math.abs(b-z);D<y&&(y=D,m=b),b<z?o=b:u=b}return m}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(r.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(i,o){const u=Math.min(i.x,o.x),m=Math.max(i.x,o.x),y=Math.min(i.y,o.y),b=Math.max(i.y,o.y);if(y<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const A=[new r.P(u,y),new r.P(m,b),new r.P(u,b),new r.P(m,y)],C=this.renderWorldCopies?-3:0,z=this.renderWorldCopies?4:1;for(const D of A){const U=this.pointRayIntersection(D);if(U.t<0)return!0;const F=this.rayIntersectionCoordinate(U);if(F.x<C||F.y<0||F.x>z||F.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+r.cW(this.fovAboveCenter)>88||this.anyCornerOffEdge(new r.P(0,0),new r.P(this.width,this.height))}zoomDeltaToMovement(i,o){const u=r.ag(r.av([],this._camera.position,i)),m=this._zoomFromMercatorZ(u)+o;return u-this._mercatorZfromZoom(m)}getCameraPoint(){if(this.projection.name==="globe"){const i=function([o,u,m],y){const b=[o,u,m,1];r.aC(b,b,y);const A=b[3]=Math.max(b[3],1e-6);return b[0]/=A,b[1]/=A,b[2]/=A,b}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new r.P(i[0],i[1])}{const i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new r.P(0,i))}}getCameraToCenterDistance(i,o=this.zoom,u=this.worldSize){const m=r.cN(i,o,this.width,this.height,1024),y=i.pixelSpaceConversion(this.center.lat,u,m);let b=.5/Math.tan(.5*this._fov)*this.height*y;return this.isOrthographic&&(b=r.ak(1,b,r.c$(this.pitch>=ba?1:this.pitch/ba))),b}getWorldToCameraMatrix(){const i=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&r.aB(i,i,this.globeMatrix),i}getFrustum(i){return r.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,i,this.projection.zAxisUnit==="meters")}}const Ga=(d,i)=>{if(i>0&&d.terrain&&r.w("Cutoff is currently disabled on terrain"),i<=0||d.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const o=d.transform,u=Math.max(Math.abs(o._zoom-(d.minCutoffZoom-1)),1),m=o.isLODDisabled(!1)?r.ah(60,45,o.pitch):r.ah(30,15,o.pitch),y=o._farZ-o._nearZ,b=i*o.height,A=((1-(C=m))*o.cameraToCenterDistance+C*(o._farZ+b))*u;var C;return{shouldRenderCutoff:m<1,uniformValues:{u_cutoff_params:[o._nearZ,o._farZ,(A-o._nearZ)/y,(A-b-o._nearZ)/y]}}},Ps={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class cp{constructor(i,o){this.aabb=i,this.lastCascade=o}}class fc{add(i,o){const u=this.receivers[i.key];u!==void 0?(u.aabb.min[0]=Math.min(u.aabb.min[0],o.min[0]),u.aabb.min[1]=Math.min(u.aabb.min[1],o.min[1]),u.aabb.min[2]=Math.min(u.aabb.min[2],o.min[2]),u.aabb.max[0]=Math.max(u.aabb.max[0],o.max[0]),u.aabb.max[1]=Math.max(u.aabb.max[1],o.max[1]),u.aabb.max[2]=Math.max(u.aabb.max[2],o.max[2])):this.receivers[i.key]=new cp(o,null)}clear(){this.receivers={}}get(i){return this.receivers[i.key]}computeRequiredCascades(i,o,u){const m=r.d8.fromPoints(i.points);let y=0;for(const b in this.receivers){const A=this.receivers[b];if(!A||!m.intersectsAabb(A.aabb))continue;A.aabb.min=m.closestPoint(A.aabb.min),A.aabb.max=m.closestPoint(A.aabb.max);const C=A.aabb.getCorners();for(let z=0;z<u.length;z++){let D=!0;for(const U of C){const F=[U[0]*o,U[1]*o,U[2]];if(r.af(F,F,u[z].matrix),F[0]<-1||F[0]>1||F[1]<-1||F[1]>1){D=!1;break}}if(A.lastCascade=z,y=Math.max(y,z),D)break}}return y+1}}class gm{constructor(i){this.painter=i,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new fc,this._depthMode=new Rt(i.context.gl.LEQUAL,Rt.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,i.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),i.tp.registerParameter(Ps,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),i.tp.registerParameter(Ps,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),i.tp.registerParameter(Ps,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),i.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const i of this._cascades)i.texture.destroy(),i.framebuffer.destroy();this._cascades=[]}updateShadowParameters(i,o){const u=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!o||!o.properties)return;const m=o.properties.get("shadow-intensity");if(!o.shadowsEnabled()||m<=0||(this._shadowLayerCount=u.style.order.reduce((X,Y)=>{const te=u.style._mergedLayers[Y];return X+(te.hasShadowPass()&&!te.isHidden(i.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const y=u.context,b=Ps.shadowMapResolution,A=Ps.shadowMapResolution;if(this._cascades.length===0||Ps.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let X=0;X<Ps.cascadeCount;++X){const Y=u._shadowMapDebug,te=y.gl,J=y.createFramebuffer(b,A,Y,"texture"),re=new r.T(y,{width:b,height:A,data:null},te.DEPTH_COMPONENT16);if(J.depthAttachment.set(re.texture),Y){const oe=new r.T(y,{width:b,height:A,data:null},te.RGBA8);J.colorAttachment.set(oe.texture)}this._cascades.push({framebuffer:J,texture:re,matrix:[],far:0,boundingSphereRadius:0,frustum:new r.cA,scale:0})}}this.shadowDirection=sl(o);let C=0;if(i.elevation){const X=i.elevation,Y=[1e4,-1e4];X.visibleDemTiles.filter(te=>te.dem).forEach(te=>{const J=te.dem.tree;Y[0]=Math.min(Y[0],J.minimums[0]),Y[1]=Math.max(Y[1],J.maximums[0])}),Y[0]!==1e4&&(C=(Y[1]-Y[0])*X.exaggeration())}const z=1.5*i.cameraToCenterDistance,D=3*z,U=new Float64Array(16);for(let X=0;X<this._cascades.length;++X){const Y=this._cascades[X];let te=i.height/50,J=1;Ps.cascadeCount===1?J=D:X===0?J=z:(te=z,J=D);const[re,oe]=mm(i,this.shadowDirection,te,J,Ps.shadowMapResolution,C);Y.scale=i.scale,Y.matrix=re,Y.boundingSphereRadius=oe,r.bl(U,Y.matrix),Y.frustum=r.cA.fromInvProjectionMatrix(U,1,0,!0),Y.far=J}const F=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[F].far,this._cascades[F].far],this._uniformValues.u_shadow_intensity=m,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Ps.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Ps.shadowMapResolution,this._uniformValues.u_shadowmap_0=ts.ShadowMap0,this._uniformValues.u_shadowmap_1=ts.ShadowMap0+1,this._groundShadowTiles=u.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const W=u.transform.elevation;for(const X of this._groundShadowTiles){let Y={min:0,max:0};if(W){const te=W.getMinMaxForTile(X);te&&(Y=te)}this.addShadowReceiver(X.toUnwrapped(),Y.min,Y.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(i){this._enabled=i}drawShadowPass(i,o){if(!this.enabled)return;const u=this.painter,m=u.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(u.transform.getFrustum(0),u.transform.worldSize,this._cascades),m.viewport.set([0,0,Ps.shadowMapResolution,Ps.shadowMapResolution]);for(let y=0;y<this._numCascadesToRender;++y){u.currentShadowCascade=y,m.bindFramebuffer.set(this._cascades[y].framebuffer.framebuffer),m.clear({color:r.ao.white,depth:1});for(const b of i.order){const A=i._mergedLayers[b];if(!A.hasShadowPass()||A.isHidden(u.transform.zoom))continue;const C=i.getLayerSourceCache(A),z=C?o[C.id]:void 0;(A.type==="model"||z&&z.length)&&u.renderLayer(u,C,A,z)}}u.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const i=this.painter,o=i.style,u=i.context,m=u.gl,y=o.directionalLight,b=o.ambientLight;if(!y||!b)return;const A=[],C=Ga(i,i.longestCutoffRange);C.shouldRenderCutoff&&A.push("RENDER_CUTOFF"),A.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&A.push("NORMAL_OFFSET");const z=jn(o,y,b),D=new Rt(m.LEQUAL,Rt.ReadOnly,i.depthRangeFor3D),U=new ii({func:m.EQUAL,mask:255},0,255,m.KEEP,m.KEEP,m.KEEP);for(const F of this._groundShadowTiles){const W=F.toUnwrapped(),X=i.isTileAffectedByFog(F),Y=i.getOrCreateProgram("groundShadow",{defines:A,overrideFog:X});this.setupShadows(W,Y),i.uploadCommonUniforms(u,Y,W,null,C);const te={u_matrix:i.transform.calculateProjMatrix(W),u_ground_shadow_factor:z};Y.draw(i,m.TRIANGLES,D,U,bi.multiply,ai.disabled,te,"ground_shadow",i.tileExtentBuffer,i.quadTriangleIndexBuffer,i.tileExtentSegments,null,i.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?bi.unblended:bi.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(i){const o=this.painter.transform,u=o.calculatePosMatrix(i,o.worldSize);return r.aB(u,this._cascades[this.painter.currentShadowCascade].matrix,u),Float32Array.from(u)}calculateShadowPassMatrixFromMatrix(i){return r.aB(i,this._cascades[this.painter.currentShadowCascade].matrix,i),Float32Array.from(i)}setupShadows(i,o,u){if(!this.enabled)return;const m=this.painter.transform,y=this.painter.context,b=y.gl,A=this._uniformValues,C=new Float64Array(16),z=m.calculatePosMatrix(i,m.worldSize);for(let D=0;D<this._cascades.length;D++)r.aB(C,this._cascades[D].matrix,z),A[D===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(C),y.activeTexture.set(b.TEXTURE0+ts.ShadowMap0+D),this._cascades[D].texture.bindExtraParam(b.LINEAR,b.LINEAR,b.CLAMP_TO_EDGE,b.CLAMP_TO_EDGE,b.GREATER);if(this.useNormalOffset=!!u,this.useNormalOffset){const D=r.d6(i.canonical),U=2/m.tileSize*r.al/Ps.shadowMapResolution,F=U*this._cascades[0].boundingSphereRadius,W=U*this._cascades[this._cascades.length-1].boundingSphereRadius,X=(u==="vector-tile"?1:3)*function(Y,te,J,re,oe){const he=r.aA((Y-22)/-22,0,1);return .125*(1-he)+4*he}(m.zoom);A.u_shadow_normal_offset=[D,F*X,W*X],A.u_shadow_bias=[1e-4,.0012,.012]}else A.u_shadow_bias=[36e-5,.0012,.012];o.setShadowUniformValues(y,A)}setupShadowsFromMatrix(i,o,u=!1){if(!this.enabled)return;const m=this.painter.context,y=m.gl,b=this._uniformValues,A=new Float64Array(16);for(let C=0;C<Ps.cascadeCount;C++)r.aB(A,this._cascades[C].matrix,i),b[C===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(A),m.activeTexture.set(y.TEXTURE0+ts.ShadowMap0+C),this._cascades[C].texture.bindExtraParam(y.LINEAR,y.LINEAR,y.CLAMP_TO_EDGE,y.CLAMP_TO_EDGE,y.GREATER);if(this.useNormalOffset=u,u){const C=Ps.normalOffset;b.u_shadow_normal_offset=[1,C,C],b.u_shadow_bias=[6e-5,.0012,.012]}else b.u_shadow_bias=[36e-5,.0012,.012];o.setShadowUniformValues(m,b)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(i,o,u,m){if(m[2]>=0)return{};const y=function(C,z,D){const U=D/(1<<C.canonical.z);return new r.d8([C.canonical.x*U+C.wrap*D,C.canonical.y*U+C.wrap*D,0],[(C.canonical.x+1)*U+C.wrap*D,(C.canonical.y+1)*U+C.wrap*D,z])}(i,o,u).getCorners(),b=o/-m[2];m[0]<0?(r.d7(y[0],y[0],[m[0]*b,0,0]),r.d7(y[3],y[3],[m[0]*b,0,0])):m[0]>0&&(r.d7(y[1],y[1],[m[0]*b,0,0]),r.d7(y[2],y[2],[m[0]*b,0,0])),m[1]<0?(r.d7(y[0],y[0],[0,m[1]*b,0]),r.d7(y[1],y[1],[0,m[1]*b,0])):m[1]>0&&(r.d7(y[2],y[2],[0,m[1]*b,0]),r.d7(y[3],y[3],[0,m[1]*b,0]));const A={};return A.vertices=y,A.planes=[gh(y[1],y[0],y[4]),gh(y[2],y[1],y[5]),gh(y[3],y[2],y[6]),gh(y[0],y[3],y[7])],A}addShadowReceiver(i,o,u){this._receivers.add(i,r.d8.fromTileIdAndHeight(i,o,u))}getMaxCascadeForTile(i){const o=this._receivers.get(i);return o&&o.lastCascade?o.lastCascade:0}}function gh(d,i,o){const u=r.av([],o,i),m=r.av([],d,i),y=r.bI([],u,m),b=r.ag(y);return b===0?[0,0,1,0]:(r.c4(y,y,1/b),[y[0],y[1],y[2],-r.bJ(y,i)])}function sl(d){const i=d.properties.get("direction"),o=r.d3(i.x,i.y,i.z);o[2]=r.aA(o[2],0,75);const u=r.d5([o[0],o[1],o[2]]);return r.d4(u.x,u.y,u.z)}function jn(d,i,o){const u=i.properties.get("color-use-theme")==="none",m=i.properties.get("color"),y=i.properties.get("intensity"),b=i.properties.get("direction"),A=[b.x,b.y,b.z],C=o.properties.get("color-use-theme")==="none",z=o.properties.get("color"),D=o.properties.get("intensity"),U=Math.max(r.bJ([0,0,1],A),0),F=[0,0,0];r.c4(F,z.toPremultipliedRenderColor(C?null:d.getLut(i.scope)).toArray01Linear().slice(0,3),D);const W=[0,0,0];return r.c4(W,m.toPremultipliedRenderColor(u?null:d.getLut(o.scope)).toArray01Linear().slice(0,3),U*y),r.da([F[0]>0?F[0]/(F[0]+W[0]):0,F[1]>0?F[1]/(F[1]+W[1]):0,F[2]>0?F[2]/(F[2]+W[2]):0])}function mm(d,i,o,u,m,y){const b=d.zoom,A=d.scale,C=d.worldSize,z=1/C,D=d.aspect,U=Math.sqrt(1+D*D)*Math.tan(.5*d.fovX),F=U*U,W=u-o,X=u+o;let Y,te;F>W/X?(Y=u,te=u*U):(Y=.5*X*(1+F),te=.5*Math.sqrt(W*W+2*(u*u+o*o)*F+X*X*F*F));const J=d.projection.pixelsPerMeter(d.center.lat,C),re=d._camera.getCameraToWorldMercator(),oe=[0,0,-Y*z];r.af(oe,oe,re);let he=te*z;const ye=d._edgeInsets;if(!(ye.left===0&&ye.top===0&&ye.right===0&&ye.bottom===0||ye.left===ye.right&&ye.top===ye.bottom)){const at=d._camera.getWorldToCamera(d.worldSize,d.projection.zAxisUnit==="meters"?J:1),xt=d._camera.getCameraToClipPerspective(d._fov,d.width/d.height,o,u);xt[8]=2*-d.centerOffset.x/d.width,xt[9]=2*d.centerOffset.y/d.height;const Pt=new Float64Array(16);r.cO(Pt,xt,at);const pt=new Float64Array(16);r.bl(pt,Pt);const ht=r.cA.fromInvProjectionMatrix(pt,C,b,!0);for(const Wt of ht.points){const Ut=((me=Wt)[0]/=A,me[1]/=A,me[2]=r.ce(me[2],d._center.lat),me);he=Math.max(he,r.c5(r.d9([],oe,Ut)))}}var me;he*=m/(m-1);const xe=Math.acos(i[2]),_e=Math.atan2(-i[0],-i[1]),ge=new ph;ge.position=oe,ge.setPitchBearing(xe,_e);const Ae=ge.getWorldToCamera(C,J),je=he*C,Re=Math.min(d._mercatorZfromZoom(17)*C*-2,-2*je),Je=ge.getCameraToClipOrthographic(-je,je,-je,je,Re,(je+y*J)/i[2]),Ne=new Float64Array(16);r.aB(Ne,Je,Ae);const $e=r.d4(Math.floor(1e6*oe[0])/1e6*C,Math.floor(1e6*oe[1])/1e6*C,0),vt=.5*m,Ve=[0,0,0];r.af(Ve,$e,Ne),r.c4(Ve,Ve,vt);const Pe=[Math.floor(Ve[0]),Math.floor(Ve[1]),Math.floor(Ve[2])],Qe=[0,0,0];r.av(Qe,Ve,Pe),r.c4(Qe,Qe,-1/vt);const We=new Float64Array(16);return r.bA(We),r.br(We,We,Qe),r.aB(Ne,We,Ne),[Ne,je]}class nl extends r.E{constructor(i){super(),this.requestManager=i,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(i,o){return r.aV(this.requestManager.transformRequest(o,r.R.Model).url).then(u=>{if(!u)return;const m=r.aW(u),y=new r.aX(i,void 0,void 0,m);return y.computeBoundsAndApplyParent(),y}).catch(u=>{if(u&&u.status===404)return null;this.fire(new r.y(new Error(`Could not load model ${i} from ${o}: ${u.message}`)))})}load(i,o,u={forceReload:!1}){this.models[o]||(this.models[o]={});const m=Object.keys(i),y=[],b=[];for(const A of m){const C=i[A];this.hasURLBeenRequested(C)&&!u.forceReload||(this.modelByURL[C]={modelId:A,scope:o},y.push(this.loadModel(A,C)),b.push(A)),this.models[o][A]||(this.models[o][A]={model:null,numReferences:1})}this.numModelsLoading[o]=(this.numModelsLoading[o]||0)+b.length,Promise.allSettled(y).then(A=>{for(let C=0;C<A.length;C++){const{status:z}=A[C];if(z==="rejected")continue;const{value:D}=A[C];this.models[o][b[C]]||(this.models[o][b[C]]={model:null,numReferences:1}),this.models[o][b[C]].model=D}this.numModelsLoading[o]-=b.length,this.fire(new r.z("data",{dataType:"style"}))}).catch(A=>{this.fire(new r.y(new Error(`Could not load models: ${A.message}`)))})}isLoaded(){for(const i in this.numModelsLoading)if(this.numModelsLoading[i]>0)return!1;return!0}hasModel(i,o,u={exactIdMatch:!1}){return!!(u.exactIdMatch?this.getModel(i,o):this.getModelByURL(this.modelUris[o][i]))}getModel(i,o){return this.models[o]||(this.models[o]={}),this.models[o][i]?this.models[o][i].model:void 0}getModelByURL(i){if(!i)return null;const o=this.modelByURL[i];return o?this.models[o.scope][o.modelId].model:null}hasModelBeenAdded(i,o){return this.models[o]&&this.models[o][i]!==void 0}getModelURIs(i){return this.modelUris[i]||{}}addModel(i,o,u){this.models[u]||(this.models[u]={}),this.modelUris[u]||(this.modelUris[u]={});const m=this.requestManager.normalizeModelURL(o);if((this.hasModel(i,u,{exactIdMatch:!0})||this.hasModelBeenAdded(i,u))&&this.modelUris[u][i]===m)this.models[u][i].numReferences++;else if(this.hasURLBeenRequested(m)){const{scope:y,modelId:b}=this.modelByURL[m];this.models[y][b].numReferences++}else this.modelUris[u][i]=m,this.load({[i]:this.modelUris[u][i]},u)}addModelURLs(i,o){this.models[o]||(this.models[o]={}),this.modelUris[o]||(this.modelUris[o]={});const u=this.modelUris[o];for(const m in i)u[m]=this.requestManager.normalizeModelURL(i[m])}reloadModels(i){this.load(this.modelUris[i],i,{forceReload:!0})}addModelsFromBucket(i,o){this.models[o]||(this.models[o]={}),this.modelUris[o]||(this.modelUris[o]={});const u={};for(const m of i)this.hasModel(m,o,{exactIdMatch:!0})||this.hasURLBeenRequested(m)?this.models[o][m].numReferences++:this.modelUris[o][m]&&!this.hasURLBeenRequested(m)?u[m]=this.modelUris[o][m]:!this.hasURLBeenRequested(m)&&r.db(m,!1)&&(this.modelUris[o][m]=this.requestManager.normalizeModelURL(m),u[m]=this.modelUris[o][m]);this.load(u,o)}hasURLBeenRequested(i){return this.modelByURL[i]!==void 0}removeModel(i,o,u=!1,m=!1){if(this.models[o]&&this.models[o][i]&&(this.models[o][i].numReferences--,this.models[o][i].numReferences===0||m)){const y=this.modelUris[o][i];u||delete this.modelUris[o][i],delete this.modelByURL[y];const b=this.models[o][i].model;if(!b)return;delete this.models[o][i],b.destroy()}}destroy(){for(const i of Object.keys(this.models))for(const o of Object.keys(this.models[i])){const u=this.models[i][o].model;delete this.models[i][o],u&&u.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(i){return this.models[i]||(this.models[i]={}),Object.keys(this.models[i])}upload(i,o){this.models[o]||(this.models[o]={});for(const u in this.models[o])this.models[o][u].model&&this.models[o][u].model.upload(i.context)}}const hp=new r.a9({data:new r.aa(r.a6.colorTheme.data)});function mh(d){if(!d.metadata||!d.metadata.content_area)return;const i=r.o.devicePixelRatio,{left:o,top:u,width:m,height:y}=d.metadata.content_area,b=o*i,A=u*i;return[b,A,b+m*i,A+y*i]}function _h(d){if(d)return d.map(([i,o])=>[i*r.o.devicePixelRatio,o*r.o.devicePixelRatio])}class Xa{constructor(i,o,u){this.id=i,this.scope=o,this.sourceCache=u,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(i){this.missingRequests.has(i.name)||this.pendingRequests.has(i.name)||this.pendingRequests.add(i.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const i=new Map;if(!this.sourceCache.loaded())return i;const o=this.sourceCache.getVisibleCoordinates();if(o.length===0)return i;const u=this.sourceCache.getSource();if(!(u instanceof Na))return i;const m=o.map(b=>this.sourceCache.getTile(b)),y=u.getImages(m,Array.from(this.pendingRequests));for(const[b,A]of y)i.set(r.I.from({name:b,iconsetId:this.id}),A),this.pendingRequests.delete(b);for(const b of this.pendingRequests)this.missingRequests.add(b);return this.pendingRequests.clear(),i}}const wo=(d,i)=>Ee(d,i&&i.filter(o=>o.identifier!=="source.canvas")),_m=r.aH(Ui,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),ym=r.aH(Ui,["setCenter","setZoom","setBearing","setPitch"]),yh=new Set(["background","sky","slot","custom"]),up={version:8,layers:[],sources:{}},xh={duration:300,delay:0};class Mn extends r.E{constructor(i,o={}){super(),this.map=i,this.scope=o.scope||"",this.globalId=null,this.fragments=[],this.importDepth=o.importDepth||0,this.importsCache=o.importsCache||new Map,this.resolvedImports=o.resolvedImports||new Set,this.transition=Object.assign({},xh),this._buildingIndex=new rh(this),this.crossTileSymbolIndex=new ys,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=o.styleChanges||new ws,this.dispatcher=o.dispatcher?o.dispatcher:new r.D(r.dd(),this),o.imageManager?this.imageManager=o.imageManager:(this.imageManager=new jr(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=o.glyphManager?o.glyphManager:new r.de(i._requestManager,o.localFontFamily?r.df.all:o.localIdeographFontFamily?r.df.ideographs:r.df.none,o.localFontFamily||o.localIdeographFontFamily),o.modelManager?this.modelManager=o.modelManager:(this.modelManager=new nl(i._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=o.configOptions?o.configOptions:new Map,this._configDependentLayers=o.configDependentLayers?o.configDependentLayers:new Set,this._config=o.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:o.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=o.initialConfig,this.dispatcher.broadcast("setReferrer",r.dg());const u=this;this._rtlTextPluginCallback=Mn.registerForPluginStateChange(m=>{u.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:m.pluginStatus,pluginURL:m.pluginURL},(y,b)=>{if(r.dh(y),b&&b.every(A=>A))for(const A in u._sourceCaches){const C=u._sourceCaches[A],z=C.getSource().type;z!=="vector"&&z!=="geojson"||C.reload()}})}),this.on("data",m=>{if(m.dataType!=="source"||m.sourceDataType!=="metadata")return;const y=this.getOwnSource(m.sourceId);if(y&&y.vectorLayerIds)for(const b in this._layers){const A=this._layers[b];A.source===y.id&&this._validateLayer(A)}})}load(i){return i?(typeof i=="string"?this.loadURL(i):this.loadJSON(i),this):this}_getGlobalId(i){if(!i)return null;if(typeof i=="string"){if(r.h(i))return i;const o=r.di(i);if(!o.startsWith("http"))try{return new URL(o,location.href).toString()}catch{return o}return o}return`json://${r.dj(JSON.stringify(i))}`}_diffStyle(i,o,u){this.globalId=this._getGlobalId(i);const m=(y,b)=>{try{b(null,this.setState(y,u))}catch(A){b(A,!1)}};if(typeof i=="string"){const y=this.map._requestManager.normalizeStyleURL(i),b=this.map._requestManager.transformRequest(y,r.R.Style);r.m(b,(A,C)=>{A?this.fire(new r.y(A)):C&&m(C,o)})}else typeof i=="object"&&m(i,o)}loadURL(i,o={}){this.fire(new r.z("dataloading",{dataType:"style"}));const u=typeof o.validate=="boolean"?o.validate:!r.h(i);this.globalId=this._getGlobalId(i),i=this.map._requestManager.normalizeStyleURL(i,o.accessToken),this.resolvedImports.add(i);const m=this.importsCache.get(i);if(m)return this._load(m,u);const y=this.map._requestManager.transformRequest(i,r.R.Style);this._request=r.m(y,(b,A)=>{if(this._request=null,b)this.fire(new r.y(b));else if(A)return this.importsCache.set(i,A),this._load(A,u)})}loadJSON(i,o={}){this.fire(new r.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(i),this._request=r.o.frame(()=>{this._request=null,this._load(i,o.validate!==!1)})}loadEmpty(){this.fire(new r.z("dataloading",{dataType:"style"})),this._load(up,!1)}_loadImports(i,o,u){if(this.importDepth>=4)return r.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const m=[];for(const y of i){const b=this._createFragmentStyle(y),A=new Promise(D=>{b.once("style.import.load",D),b.once("error",D)}).then(()=>this.mergeAll());if(m.push(A),this.resolvedImports.has(y.url)){b.loadEmpty();continue}const C=y.data||this.importsCache.get(y.url);C?(b.loadJSON(C,{validate:o}),this._isInternalStyle(C)&&(b.globalId=null)):y.url?b.loadURL(y.url,{validate:o}):b.loadEmpty();const z={style:b,id:y.id,config:y.config};if(u){const D=this.fragments.findIndex(({id:U})=>U===u);this.fragments=this.fragments.slice(0,D).concat(z).concat(this.fragments.slice(D))}else this.fragments.push(z)}return Promise.allSettled(m)}getImportGlobalIds(i=this,o=new Set){for(const u of i.fragments)u.style.globalId&&o.add(u.style.globalId),this.getImportGlobalIds(u.style,o);return[...o.values()]}_createFragmentStyle(i){const o=this.scope?r.B(i.id,this.scope):i.id;let u;const m=this._initialConfig&&this._initialConfig[o];(i.config||m)&&(u=Object.assign({},i.config,m));const y=new Mn(this.map,{scope:o,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:u,configOptions:this.options,colorThemeOverride:i["color-theme"],configDependentLayers:this._configDependentLayers});return y.setEventedParent(this.map,{style:y}),y}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(i){return this.isRootStyle()&&(i.fragment||!!i.schema&&i.fragment!==!1)}_load(i,o){if(this._isInternalStyle(i)){const y=Object.assign({},up,{imports:[{id:"basemap",data:i,url:""}]});return void this._load(y,o)}if(this.updateConfig(this._config,i.schema),o&&wo(this,On(i)))return;this._loaded=!0,this.stylesheet=r.dk(i);const u=()=>{for(const C in i.sources)this.addSource(C,i.sources[C],{validate:!1,isInitialLoad:!0});if(i.iconsets)for(const C in i.iconsets)this.addIconset(C,i.iconsets[C]);i.sprite?this._loadIconset(i.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&i.glyphs&&this.glyphManager.setURL(i.glyphs);const y=sh(this.stylesheet.layers);if(this._order=y.map(C=>C.id),this.stylesheet.light&&r.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const C=this.stylesheet.lights[0];this.light=new De(C.properties,C.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new De(this.stylesheet.light)),this._layers={};for(const C of y){const z=r.dq(C,this.scope,this._styleColorTheme.lut,this.options);z.configDependencies.size!==0&&this._configDependentLayers.add(z.fqid),z.setEventedParent(this,{layer:{id:z.id}}),this._layers[z.id]=z;const D=this.getOwnLayerSourceCache(z),U=!!this.directionalLight&&this.directionalLight.shadowsEnabled();D&&z.canCastShadows()&&U&&(D.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const b=this.stylesheet.terrain;b&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(b,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new r.z("data",{dataType:"style"}));const A=this.isRootStyle();i.imports?this._loadImports(i.imports,o).then(()=>{this._reloadImports(),this.fire(new r.z(A?"style.load":"style.import.load"))}).catch(C=>{this.fire(new r.y(new Error("Failed to load imports",C))),this.fire(new r.z(A?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new r.z(A?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const m=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(m){const y=this._evaluateColorThemeData(m);this._loadColorTheme(y).then(()=>{u()}).catch(b=>{r.w(`Couldn't load color theme from the stylesheet: ${b}`),u()})}else this._styleColorTheme.lut=null,u()}isRootStyle(){return this.importDepth===0}mergeAll(){let i,o,u,m,y,b,A,C,z,D;const U={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(F=>{if(F.stylesheet){if(F.light!=null&&(i=F.light),F.stylesheet.lights)for(const W of F.stylesheet.lights)W.type==="ambient"&&F.ambientLight!=null&&(o=F.ambientLight),W.type==="directional"&&F.directionalLight!=null&&(u=F.directionalLight);m=this._prioritizeTerrain(m,F.terrain,F.stylesheet.terrain),F.stylesheet.fog&&F.fog!=null&&(y=F.fog),F.stylesheet.snow&&F.snow!=null&&(b=F.snow),F.stylesheet.rain&&F.rain!=null&&(A=F.rain),F.stylesheet.camera!=null&&(D=F.stylesheet.camera),F.stylesheet.projection!=null&&(C=F.stylesheet.projection),F.stylesheet.transition!=null&&(z=F.stylesheet.transition),U[F.scope]=F._styleColorTheme}}),this.light=i,this.ambientLight=o,this.directionalLight=u,this.fog=y,this.snow=b,this.rain=A,this._styleColorThemeForScope=U,m===null?delete this.terrain:this.terrain=m,this.camera=D||{"camera-projection":"perspective"},this.projection=C||{name:"mercator"},this.transition=Object.assign({},xh,z),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(i){const o=u=>{for(const m of u.fragments)o(m.style);i(u)};o(this)}_prioritizeTerrain(i,o,u){const m=i&&i.drapeRenderMode===0;return u===null?o&&o.drapeRenderMode===0?o:m?i:null:o!=null&&(!i||m||o&&o.drapeRenderMode===1)?o:i}mergeTerrain(){let i;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(o=>{i=this._prioritizeTerrain(i,o.terrain,o.stylesheet.terrain)}),i===null?delete this.terrain:this.terrain=i}mergeProjection(){let i;this.forEachFragmentStyle(o=>{o.stylesheet.projection!=null&&(i=o.stylesheet.projection)}),this.projection=i||{name:"mercator"}}mergeSources(){const i={},o={},u={};this.forEachFragmentStyle(m=>{for(const y in m._sourceCaches){const b=r.B(y,m.scope);i[b]=m._sourceCaches[y]}for(const y in m._otherSourceCaches){const b=r.B(y,m.scope);o[b]=m._otherSourceCaches[y]}for(const y in m._symbolSourceCaches){const b=r.B(y,m.scope);u[b]=m._symbolSourceCaches[y]}}),this._mergedSourceCaches=i,this._mergedOtherSourceCaches=o,this._mergedSymbolSourceCaches=u}mergeLayers(){const i={},o=[],u={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(b=>{for(const A of b._order){const C=b._layers[A];if(C.type==="slot"){const z=r.dl(A);if(i[z])continue;i[z]=[]}C.slot&&i[C.slot]?i[C.slot].push(C):o.push(C)}}),this._mergedOrder=[];let m=-1;const y=(b=[])=>{for(const A of b)if(A.type==="slot"){const C=r.dl(A.id);i[C]&&y(i[C]),this._mergedSlots.push(C)}else{const C=r.B(A.id,A.scope);this._mergedOrder.push(C),u[C]=A,A.is3D(!!this.terrain)&&(this._has3DLayers=!0,m=this._mergedOrder.length-1),A.type==="circle"&&(this._hasCircleLayers=!0),A.type==="symbol"&&(this._hasSymbolLayers=!0),A.type==="clip"&&(this._clipLayerPresent=!0)}};if(y(o),this._has3DLayers){const b={};for(let A=0;A<this._mergedOrder.length;++A){const C=this._mergedOrder[A];b[C]=A===m?1:A<m?u[C].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort((A,C)=>b[A]-b[C])}this._mergedLayers=u,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(i){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,i),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(i){return i.data?function(o,u,m,y){const b=Object.assign({},u);for(const C of Object.keys(r.a6.colorTheme))b[C]===void 0&&(b[C]=r.a6.colorTheme[C].default);const A=new r.a8(hp,o,new Map(m));return A.setTransitionOrValue(b,m),A.untransitioned().possiblyEvaluate(new r.ac(0,{worldview:void 0}))}(this.scope,i,this.options).get("data"):null}_loadColorTheme(i){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const o=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((u,m)=>{const y="data:image/png;base64,";if(!i||i.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void u();let b=i;b.startsWith(y)||(b=y+b);const A=r.I.from("mapbox-reserved-lut"),C=new Image;C.src=b,C.onerror=()=>{this._styleColorTheme.lutLoading=!1,m(new Error("Failed to load image data"))},C.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==o)return void u();this._styleColorTheme.lutLoading=!1;const{width:z,height:D,data:U}=r.o.getImageData(C);if(D>32)return void m(new Error("The height of the image must be less than or equal to 32 pixels."));if(z!==D*D)return void m(new Error("The width of the image must be equal to the height squared."));this.getImage(A)&&this.removeImage(A),this.addImage(A,{data:new r.q({width:z,height:D},U),pixelRatio:1,sdf:!1,usvg:!1,version:0});const F=this.imageManager.getImage(A,this.scope);F?(this._styleColorTheme.lut={image:F.data,data:i},u()):m(new Error("Missing LUT image."))}})}getLut(i){const o=this._styleColorThemeForScope[i];return o?o.lut:null}setProjection(i){i?this.stylesheet.projection=i:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(i){this._spriteRequest=function(o,u,m){let y,b,A;const C=r.o.devicePixelRatio>1?"@2x":"";let z=r.m(u.transformRequest(u.normalizeSpriteURL(o,C,".json"),r.R.SpriteJSON),(F,W)=>{z=null,A||(A=F,y=W,U())}),D=r.n(u.transformRequest(u.normalizeSpriteURL(o,C,".png"),r.R.SpriteImage),(F,W)=>{D=null,A||(A=F,b=W,U())});function U(){if(A)m(A);else if(y&&b){const F=r.o.getImageData(b),W={};for(const X in y){const{width:Y,height:te,x:J,y:re,sdf:oe,pixelRatio:he,stretchX:ye,stretchY:me,content:xe}=y[X],_e=new r.q({width:Y,height:te});r.q.copy(F,_e,{x:J,y:re},{x:0,y:0},{width:Y,height:te},null),W[X]={data:_e,pixelRatio:he!==void 0?he:1,sdf:oe!==void 0&&oe,stretchX:ye,stretchY:me,content:xe,usvg:!1,version:0}}m(null,W)}}return{cancel(){z&&(z.cancel(),z=null),D&&(D.cancel(),D=null)}}}(i,this.map._requestManager,(o,u)=>{if(this._spriteRequest=null,o)this.fire(new r.y(o));else if(u){const m=new Map;for(const y in u)m.set(r.I.from(y),u[y]);this.addImages(m)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new r.z("data",{dataType:"style"}))})}addIconset(i,o){if(o.type==="sprite")return void this._loadSprite(o.url);const u=this.getOwnSourceCache(o.source);if(!u)return void this.fire(new r.y(new Error(`Source "${o.source}" as specified by iconset "${i}" does not exist and cannot be used as an iconset source`)));const m=u.getSource();if(m.type!=="raster-array")return void this.fire(new r.y(new Error(`Source "${o.source}" as specified by iconset "${i}" is not a "raster-array" source and cannot be used as an iconset source`)));m.partial=!1;const y=new Xa(i,this.scope,u);this.imageManager.addImageProvider(y,this.scope)}removeIconset(i){this.imageManager.removeImageProvider(i,this.scope)}_loadIconset(i){if(!r.h(i)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(i);const o=this.map._spriteFormat==="auto";var u,m;this._spriteRequest=(m=(y,b)=>{if(this._spriteRequest=null,y)o?this._loadSprite(i):this.fire(new r.y(y));else if(b){const A=new Map;for(const C in b)A.set(r.I.from(C),b[C]);this.addImages(A)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new r.z("data",{dataType:"style"}))},r.bu((u=this.map._requestManager).transformRequest(u.normalizeIconsetURL(i),r.R.Iconset),(y,b)=>{if(y)return void m(y);const A={},C=r.dc(new r.bt(b));for(const z of C.icons){const D={version:1,pixelRatio:r.o.devicePixelRatio,content:mh(z),stretchX:z.metadata?_h(z.metadata.stretch_x_areas):void 0,stretchY:z.metadata?_h(z.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:z};A[z.name]=D}m(null,A)}))}_validateLayer(i){const o=this.getOwnSource(i.source);if(!o)return;const u=i.sourceLayer;u&&(o.type==="geojson"||o.vectorLayerIds&&o.vectorLayerIds.indexOf(u)===-1)&&this.fire(new r.y(new Error(`Source layer "${u}" does not exist on source "${o.id}" as specified by style layer "${i.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const i in this._sourceCaches)if(!this._sourceCaches[i].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:i}of this.fragments)if(!i.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((i,o)=>{const u=this.fragments[o];return u&&u.style&&(i.data=u.style.serialize()),i})}_serializeSources(){const i={};for(const o in this._sourceCaches){const u=this._sourceCaches[o].getSource();i[u.id]||(i[u.id]=u.serialize())}return i}_serializeLayers(i){const o=[];for(const u of i){const m=this._layers[u];m&&m.type!=="custom"&&o.push(m.serialize())}return o}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const i in this._sourceCaches)if(this._sourceCaches[i].hasTransition())return!0;for(const i in this._layers)if(this._layers[i].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(i){return i?this.order:this._mergedOrder}isLayerDraped(i){return!!this.terrain&&i.isDraped(this.getLayerSourceCache(i))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(i){const o=this.getOwnLayer(i);if(o)return o;this.fire(new r.y(new Error(`The layer '${i}' does not exist in the map's style.`)))}_checkSource(i){const o=this.getOwnSource(i);if(o)return o;this.fire(new r.y(new Error(`The source '${i}' does not exist in the map's style.`)))}precompilePrograms(i,o){const u=this.map.painter;if(u)for(let m=i.minzoom||0;m<(i.maxzoom||25.5);m++){const y=i.getProgramIds();if(y)for(const b of y){const A=i.getDefaultProgramParams(b,o.zoom,this._styleColorTheme.lut);A&&(u.style=this,this.fog&&(u._fogVisible=!0,A.overrideFog=!0,u.getOrCreateProgram(b,A)),u._fogVisible=!1,A.overrideFog=!1,u.getOrCreateProgram(b,A),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(A.overrideRtt=!0,u.getOrCreateProgram(b,A)))}}}update(i){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(i),this.directionalLight&&this.directionalLight.recalculate(i);const o=this.calculateLightsBrightness();i.brightness=o||0,o!==this._brightness&&(this._brightness=o,this.dispatcher.broadcast("setBrightness",o)),i.worldview!==this._worldview&&(this._worldview=i.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const u=this._changes.isDirty();let m=!1;if(this._changes.isDirty()){const A=this._changes.getLayerUpdatesByScope();for(const C in A){const{updatedIds:z,removedIds:D}=A[C];(z||D)&&(this._updateWorkerLayers(C,z,D),m=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(i),this.light&&this.light.updateTransitions(i),this.ambientLight&&this.ambientLight.updateTransitions(i),this.directionalLight&&this.directionalLight.updateTransitions(i),this.fog&&this.fog.updateTransitions(i),this.snow&&this.snow.updateTransitions(i),this.rain&&this.rain.updateTransitions(i),this._changes.reset()}const y={};for(const A in this._mergedSourceCaches){const C=this._mergedSourceCaches[A];y[A]=C.used,C.used=!1,C.tileCoverLift=0}for(const A of this._mergedOrder){const C=this._mergedLayers[A];if(C.recalculate(i,this._availableImages),!C.isHidden(i.zoom)){const z=this.getLayerSourceCache(C);z&&(z.used=!0,z.tileCoverLift=Math.max(z.tileCoverLift,C.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(C,i)}):this.precompilePrograms(C,i))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&m&&this.mergeLayers();const b=this.imageManager.getPendingImageProviders();for(const A of b)A.sourceCache.used=!0;for(const A in y){const C=this._mergedSourceCaches[A];y[A]!==C.used&&C.getSource().fire(new r.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:C.getSource().id}))}this.light&&this.light.recalculate(i),this.terrain&&this.terrain.recalculate(i),this.fog&&this.fog.recalculate(i),this.snow&&this.snow.recalculate(i),this.rain&&this.rain.recalculate(i),this.z=i.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),u&&this.fire(new r.z("data",{dataType:"style"}))}updateImageProviders(){const i=this.imageManager.getPendingImageProviders();for(const o of i){const u=o.resolvePendingRequests(),m=this.getFragmentStyle(o.scope);m&&m.addImages(u)}}_updateTilesForChangedImages(){const i={};for(const o in this._mergedSourceCaches){const u=this._mergedSourceCaches[o].getSource().scope;i[u]=i[u]||this._changes.getUpdatedImages(u),i[u].length!==0&&this._mergedSourceCaches[o].reloadTilesForDependencies(["icons","patterns"],i[u])}for(const o in i)this._changes.resetUpdatedImages(o)}_updateWorkerLayers(i,o,u){const m=this.getFragmentStyle(i);m&&this.dispatcher.broadcast("updateLayers",{layers:o?m._serializeLayers(o):[],scope:i,removedIds:u||[],options:m.options})}setState(i,o){if(this._checkLoaded(),wo(this,On(i)))return!1;(i=r.dk(i)).layers=sh(i.layers);const u=function(b,A){if(!b)return[{command:Ui.setStyle,args:[A]}];let C=[];try{if(!r.by(b.version,A.version))return[{command:Ui.setStyle,args:[A]}];if(r.by(b.center,A.center)||C.push({command:Ui.setCenter,args:[A.center]}),r.by(b.zoom,A.zoom)||C.push({command:Ui.setZoom,args:[A.zoom]}),r.by(b.bearing,A.bearing)||C.push({command:Ui.setBearing,args:[A.bearing]}),r.by(b.pitch,A.pitch)||C.push({command:Ui.setPitch,args:[A.pitch]}),r.by(b.sprite,A.sprite)||C.push({command:Ui.setSprite,args:[A.sprite]}),r.by(b.glyphs,A.glyphs)||C.push({command:Ui.setGlyphs,args:[A.glyphs]}),r.by(b.imports,A.imports)||function(W=[],X=[],Y){X=X||[];const te=(W=W||[]).map(el),J=X.map(el),re=W.reduce(sc,{}),oe=X.reduce(sc,{}),he=te.slice();let ye,me,xe,_e;for(ye=0,me=0;ye<te.length;ye++)xe=te[ye],oe.hasOwnProperty(xe)?me++:(Y.push({command:Ui.removeImport,args:[xe]}),he.splice(he.indexOf(xe,me),1));for(ye=0,me=0;ye<J.length;ye++)xe=J[J.length-1-ye],he[he.length-1-ye]!==xe&&(re.hasOwnProperty(xe)?(Y.push({command:Ui.removeImport,args:[xe]}),he.splice(he.lastIndexOf(xe,he.length-me),1)):me++,_e=he[he.length-ye],Y.push({command:Ui.addImport,args:[oe[xe],_e]}),he.splice(he.length-ye,0,xe));for(const ge of X){const Ae=re[ge.id];Ae&&(delete Ae.data,r.by(Ae,ge)||Y.push({command:Ui.updateImport,args:[ge.id,ge]}))}}(b.imports,A.imports,C),r.by(b.transition,A.transition)||C.push({command:Ui.setTransition,args:[A.transition]}),r.by(b.light,A.light)||C.push({command:Ui.setLight,args:[A.light]}),r.by(b.fog,A.fog)||C.push({command:Ui.setFog,args:[A.fog]}),r.by(b.snow,A.snow)||C.push({command:Ui.setSnow,args:[A.snow]}),r.by(b.rain,A.rain)||C.push({command:Ui.setRain,args:[A.rain]}),r.by(b.projection,A.projection)||C.push({command:Ui.setProjection,args:[A.projection]}),r.by(b.lights,A.lights)||C.push({command:Ui.setLights,args:[A.lights]}),r.by(b.camera,A.camera)||C.push({command:Ui.setCamera,args:[A.camera]}),r.by(b.iconsets,A.iconsets)||function(W,X,Y){let te;for(te in X=X||{},W=W||{})W.hasOwnProperty(te)&&(X.hasOwnProperty(te)||Y.push({command:Ui.removeIconset,args:[te]}));for(te in X){if(!X.hasOwnProperty(te))continue;const J=X[te];W.hasOwnProperty(te)?r.by(W[te],J)||(Y.push({command:Ui.removeIconset,args:[te]}),Y.push({command:Ui.addIconset,args:[te,J]})):Y.push({command:Ui.addIconset,args:[te,J]})}}(b.iconsets,A.iconsets,C),!r.by(b["color-theme"],A["color-theme"]))return[{command:Ui.setStyle,args:[A]}];const z={},D=[];(function(W,X,Y,te){let J;for(J in X=X||{},W=W||{})W.hasOwnProperty(J)&&(X.hasOwnProperty(J)||rp(J,Y,te));for(J in X){if(!X.hasOwnProperty(J))continue;const re=X[J];W.hasOwnProperty(J)?r.by(W[J],re)||(W[J].type==="geojson"&&re.type==="geojson"&&nh(W,X,J)?Y.push({command:Ui.setGeoJSONSourceData,args:[J,re.data]}):sp(J,X,Y,te)):Qo(J,X,Y)}})(b.sources,A.sources,D,z);const U=[];b.layers&&b.layers.forEach(W=>{W.source&&z[W.source]?C.push({command:Ui.removeLayer,args:[W.id]}):U.push(W)});let F=b.terrain;F&&z[F.source]&&(C.push({command:Ui.setTerrain,args:[void 0]}),F=void 0),C=C.concat(D),r.by(F,A.terrain)||C.push({command:Ui.setTerrain,args:[A.terrain]}),function(W,X,Y){X=X||[];const te=(W=W||[]).map(el),J=X.map(el),re=W.reduce(sc,{}),oe=X.reduce(sc,{}),he=te.slice(),ye=Object.create(null);let me,xe,_e,ge,Ae,je,Re;for(me=0,xe=0;me<te.length;me++)_e=te[me],oe.hasOwnProperty(_e)?xe++:(Y.push({command:Ui.removeLayer,args:[_e]}),he.splice(he.indexOf(_e,xe),1));for(me=0,xe=0;me<J.length;me++)_e=J[J.length-1-me],he[he.length-1-me]!==_e&&(re.hasOwnProperty(_e)?(Y.push({command:Ui.removeLayer,args:[_e]}),he.splice(he.lastIndexOf(_e,he.length-xe),1)):xe++,je=he[he.length-me],Y.push({command:Ui.addLayer,args:[oe[_e],je]}),he.splice(he.length-me,0,_e),ye[_e]=!0);for(me=0;me<J.length;me++)if(_e=J[me],ge=re[_e],Ae=oe[_e],!ye[_e]&&!r.by(ge,Ae))if(r.by(ge.source,Ae.source)&&r.by(ge["source-layer"],Ae["source-layer"])&&r.by(ge.type,Ae.type)){for(Re in ja(ge.layout,Ae.layout,Y,_e,null,Ui.setLayoutProperty),ja(ge.paint,Ae.paint,Y,_e,null,Ui.setPaintProperty),r.by(ge.slot,Ae.slot)||Y.push({command:Ui.setSlot,args:[_e,Ae.slot]}),r.by(ge.filter,Ae.filter)||Y.push({command:Ui.setFilter,args:[_e,Ae.filter]}),r.by(ge.minzoom,Ae.minzoom)&&r.by(ge.maxzoom,Ae.maxzoom)||Y.push({command:Ui.setLayerZoomRange,args:[_e,Ae.minzoom,Ae.maxzoom]}),ge)ge.hasOwnProperty(Re)&&Re!=="layout"&&Re!=="paint"&&Re!=="filter"&&Re!=="metadata"&&Re!=="minzoom"&&Re!=="maxzoom"&&Re!=="slot"&&(Re.indexOf("paint.")===0?ja(ge[Re],Ae[Re],Y,_e,Re.slice(6),Ui.setPaintProperty):r.by(ge[Re],Ae[Re])||Y.push({command:Ui.setLayerProperty,args:[_e,Re,Ae[Re]]}));for(Re in Ae)Ae.hasOwnProperty(Re)&&!ge.hasOwnProperty(Re)&&Re!=="layout"&&Re!=="paint"&&Re!=="filter"&&Re!=="metadata"&&Re!=="minzoom"&&Re!=="maxzoom"&&Re!=="slot"&&(Re.indexOf("paint.")===0?ja(ge[Re],Ae[Re],Y,_e,Re.slice(6),Ui.setPaintProperty):r.by(ge[Re],Ae[Re])||Y.push({command:Ui.setLayerProperty,args:[_e,Re,Ae[Re]]}))}else Y.push({command:Ui.removeLayer,args:[_e]}),je=he[he.lastIndexOf(_e)+1],Y.push({command:Ui.addLayer,args:[Ae,je]})}(U,A.layers,C)}catch(z){console.warn("Unable to compute style diff:",z),C=[{command:Ui.setStyle,args:[A]}]}return C}(this.serialize(),i).filter(b=>!(b.command in ym));if(u.length===0)return!1;const m=u.filter(b=>!(b.command in _m));if(m.length>0)throw new Error(`Unimplemented: ${m.map(b=>b.command).join(", ")}.`);const y=[];return u.forEach(b=>{y.push(this[b.command](...b.args))}),o&&Promise.all(y).then(o).catch(o),this.stylesheet=i,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(i){if(i.size===0)return this;for(const[o,u]of i.entries()){if(this.getImage(o))return this.fire(new r.y(new Error(`An image with the name "${o.name}" already exists.`)));this.imageManager.addImage(o,this.scope,u),this._changes.updateImage(o,this.scope)}return this._updateWorkerImages(),this.fire(new r.z("data",{dataType:"style"})),this}addImage(i,o){return this.getImage(i)?this.fire(new r.y(new Error(`An image with the name "${i.name}" already exists.`))):(this.imageManager.addImage(i,this.scope,o),this._changes.updateImage(i,this.scope),this._updateWorkerImages(),this.fire(new r.z("data",{dataType:"style"})),this)}updateImage(i,o,u=!1){this.imageManager.updateImage(i,this.scope,o),u&&(this._changes.updateImage(i,this.scope),this._updateWorkerImages(),this.fire(new r.z("data",{dataType:"style"})))}getImage(i){return this.imageManager.getImage(i,this.scope)}removeImage(i){return this.getImage(i)?(this.imageManager.removeImage(i,this.scope),this._changes.updateImage(i,this.scope),this._updateWorkerImages(),this.fire(new r.z("data",{dataType:"style"})),this):this.fire(new r.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(i){return this.modelManager.addModelURLs(i,this.scope),this._updateWorkerModels(),this.fire(new r.z("data",{dataType:"style"})),this}addModel(i,o,u={}){return this._checkLoaded(),this._validate(Me,`models.${i}`,o,null,u)||(this.modelManager.addModel(i,o,this.scope),this.fire(new r.z("data",{dataType:"style"}))),this}hasModel(i){return this.modelManager.hasModel(i,this.scope)}removeModel(i){return this.hasModel(i)?(this.modelManager.removeModel(i,this.scope,!1,!0),this.fire(new r.z("data",{dataType:"style"})),this):this.fire(new r.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(i,o,u={}){if(this._checkLoaded(),this.getOwnSource(i)!==void 0)throw new Error(`There is already a source with ID "${i}".`);if(!o.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(o).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(o.type)>=0&&this._validate($l,`sources.${i}`,o,null,u))return;this.map&&this.map._collectResourceTiming&&(o.collectResourceTiming=!0);const m=Kl(i,o,this.dispatcher,this);m.scope=this.scope,m.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(m.id),source:m.serialize(),sourceId:m.id}));const y=b=>{const A=(b?"symbol:":"other:")+m.id,C=r.B(A,this.scope),z=this._sourceCaches[A]=new mn(C,m,b);(b?this._symbolSourceCaches:this._otherSourceCaches)[m.id]=z,z.onAdd(this.map)};y(!1),o.type!=="vector"&&o.type!=="geojson"||y(!0),m.onAdd&&m.onAdd(this.map),u.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(i){this._checkLoaded();const o=this.getOwnSource(i);if(!o)throw new Error("There is no source with this ID");for(const m in this._layers)if(this._layers[m].source===i)return this.fire(new r.y(new Error(`Source "${i}" cannot be removed while layer "${m}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===i)return this.fire(new r.y(new Error(`Source "${i}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const m=Object.entries(this.stylesheet.iconsets).find(([y,b])=>b.type==="source"&&b.source===i);if(m)return this.fire(new r.y(new Error(`Source "${i}" cannot be removed while iconset "${m[0]}" is using it.`)))}const u=this.getOwnSourceCaches(i);for(const m of u){const y=r.dl(m.id);delete this._sourceCaches[y],this._changes.discardSourceCacheUpdate(m.id),m.fire(new r.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:m.getSource().id})),m.setEventedParent(null),m.clearTiles()}return delete this._otherSourceCaches[i],delete this._symbolSourceCaches[i],this.mergeSources(),o.setEventedParent(null),o.onRemove&&o.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(i,o){this._checkLoaded(),this.getOwnSource(i).setData(o),this._changes.setDirty()}getOwnSource(i){const o=this.getOwnSourceCache(i);return o&&o.getSource()}getOwnSources(){const i=[];for(const o in this._otherSourceCaches){const u=this.getOwnSourceCache(o);u&&i.push(u.getSource())}return i}areTilesLoaded(){const i=this._mergedSourceCaches;for(const o in i){const u=i[o]._tiles;for(const m in u){const y=u[m];if(y.state!=="loaded"&&y.state!=="errored")return!1}}return!0}setLights(i){if(this._checkLoaded(),!i)return delete this.ambientLight,void delete this.directionalLight;const o=this._getTransitionParameters();for(const y of i){if(this._validate(eh,"lights",y))return;switch(y.type){case"ambient":if(this.ambientLight){const b=this.ambientLight;b.set(y),b.updateTransitions(o)}else this.ambientLight=new Ki(y,Yr||(Yr=new r.a9({color:new r.aa(r.a6.properties_light_ambient.color),"color-use-theme":new r.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new r.aa(r.a6.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const b=this.directionalLight;b.set(y),b.updateTransitions(o)}else this.directionalLight=new Ki(y,os||(os=new r.a9({direction:new r.ap(r.a6.properties_light_directional.direction),color:new r.aa(r.a6.properties_light_directional.color),"color-use-theme":new r.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new r.aa(r.a6.properties_light_directional.intensity),"cast-shadows":new r.aa(r.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new r.aa(r.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new r.aa(r.a6.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const u=Object.assign(o,{worldview:this.map.getWorldview()}),m=new r.ac(this.z||0,u);this.ambientLight&&this.ambientLight.recalculate(m),this.directionalLight&&this.directionalLight.recalculate(m),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const i=this.directionalLight,o=this.ambientLight;if(!i||!o)return;const u=F=>.2126*(F[0]<=.03928?F[0]/12.92:Math.pow((F[0]+.055)/1.055,2.4))+.7152*(F[1]<=.03928?F[1]/12.92:Math.pow((F[1]+.055)/1.055,2.4))+.0722*(F[2]<=.03928?F[2]/12.92:Math.pow((F[2]+.055)/1.055,2.4)),m=i.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),y=i.properties.get("intensity"),b=i.properties.get("direction"),A=1-r.d3(b.x,b.y,b.z)[2]/90,C=u(m)*y*A,z=o.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),D=o.properties.get("intensity"),U=u(z)*D;return Number(((C+U)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const i=[];return this.directionalLight&&i.push(this.directionalLight.get()),this.ambientLight&&i.push(this.ambientLight.get()),i}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(i){if(i==null||i===""&&this.isRootStyle())return this;if(r.dm(i)){const o=r.dn(i),u=this.fragments.find(({id:y})=>y===o);if(!u)return;const m=r.dl(i);return u.style.getFragmentStyle(m)}{const o=this.fragments.find(({id:u})=>u===i);return o?o.style:void 0}}setFeaturesetSelectors(i){if(!i)return;const o={},u=(m,y="")=>`${m}::${y}`;this._featuresetSelectors={};for(const m in i){const y=this._featuresetSelectors[m]=[];for(const b of i[m].selectors){if(b.featureNamespace){const C=this.getOwnLayer(b.layer);if(!C){r.w(`Layer is undefined for selector: ${b.layer}`);continue}const z=u(C.source,C.sourceLayer);if(z in o&&o[z]!==b.featureNamespace){r.w(`"featureNamespace ${b.featureNamespace} of featureset ${m}'s selector is not associated to the same source, skip this selector`);continue}o[z]=b.featureNamespace}let A;if(b.properties)for(const C in b.properties){const z=r.U(b.properties[C]);z.result==="success"&&(A=A||{},A[C]=z.value)}y.push({layerId:b.layer,namespace:b.featureNamespace,properties:A,uniqueFeatureID:b._uniqueFeatureID})}}}getFeaturesetDescriptors(i){const o=this.getFragmentStyle(i);if(!o||!o.stylesheet.featuresets)return[];const u=[];for(const m in o.stylesheet.featuresets)u.push({featuresetId:m,importId:o.scope?o.scope:void 0});return u}getFeaturesetLayers(i,o){const u=this.getFragmentStyle(o),m=u.stylesheet.featuresets;if(!m||!m[i])return this.fire(new r.y(new Error(`The featureset '${i}' does not exist in the map's style and cannot be queried.`))),[];const y=[];for(const b of m[i].selectors){const A=u.getOwnLayer(b.layer);A&&y.push(A)}return y}getConfigProperty(i,o){const u=this.getFragmentStyle(i);if(!u)return null;const m=r.B(o,u.scope),y=u.options.get(m),b=y?y.value||y.default:null;return b?b.serialize():null}setConfigProperty(i,o,u){const m=this.getFragmentStyle(i);if(!m)return;const y=m.stylesheet.schema;if(!y||!y[o])return;const b=r.U(u);if(b.result!=="success")return void wo(this,b.value);const A=b.value.expression,C=r.B(o,m.scope),z=m.options.get(C);if(!z)return;let D;const{minValue:U,maxValue:F,stepValue:W,type:X,values:Y}=y[o],te=r.U(y[o].default);te.result==="success"&&(D=te.value.expression),D?(this.options.set(C,Object.assign({},z,{value:A,default:D,minValue:U,maxValue:F,stepValue:W,type:X,values:Y})),this.updateConfigDependencies(o)):this.fire(new r.y(new Error(`No schema defined for the config option "${o}" in the "${i}" fragment.`)))}getConfig(i){const o=this.getFragmentStyle(i);if(!o)return null;const u=o.stylesheet.schema;if(!u)return null;const m={};for(const y in u){const b=r.B(y,o.scope),A=o.options.get(b),C=A?A.value||A.default:null;m[y]=C?C.serialize():null}return m}setConfig(i,o){const u=this.getFragmentStyle(i);u&&(u.updateConfig(o,u.stylesheet.schema),this.updateConfigDependencies())}getSchema(i){const o=this.getFragmentStyle(i);return o?o.stylesheet.schema:null}setSchema(i,o){const u=this.getFragmentStyle(i);u&&(u.stylesheet.schema=o,u.updateConfig(u._config,o),this.updateConfigDependencies())}updateConfig(i,o){if(this._config=i,i||o)if(o)for(const u in o){let m,y;const b=r.U(o[u].default);if(b.result==="success"&&(m=b.value.expression),i&&i[u]!==void 0){const F=r.U(i[u]);F.result==="success"&&(y=F.value.expression)}const{minValue:A,maxValue:C,stepValue:z,type:D,values:U}=o[u];if(m){const F=r.B(u,this.scope);this.options.set(F,{default:m,value:y,minValue:A,maxValue:C,stepValue:z,type:D,values:U})}else this.fire(new r.y(new Error(`No schema defined for config option "${u}".`)))}else this.fire(new r.y(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(i){for(const o of this._configDependentLayers){const u=this.getLayer(o);if(u){if(i&&!u.configDependencies.has(i))continue;u.possiblyEvaluateVisibility(),this._updateLayer(u)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(o=>{const u=o._styleColorTheme.colorThemeOverride?o._styleColorTheme.colorThemeOverride:o._styleColorTheme.colorTheme;if(u){const m=o._evaluateColorThemeData(u);(!o._styleColorTheme.lut&&m!==""||o._styleColorTheme.lut&&m!==o._styleColorTheme.lut.data)&&o.setColorTheme(u)}}),this._changes.setDirty()}addLayer(i,o,u={}){this._checkLoaded();const m=i.id;if(this._layers[m])return void this.fire(new r.y(new Error(`Layer with id "${m}" already exists on this map`)));let y;if(i.type==="custom"){if(wo(this,r.dp(i)))return;y=r.dq(i,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof i.source=="object"&&(this.addSource(m,i.source),i=r.dk(i),i=Object.assign(i,{source:m})),this._validate(Oe,`layers.${m}`,i,{arrayIndex:-1},u))return;y=r.dq(i,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(y),y.setEventedParent(this,{layer:{id:m}})}y.configDependencies.size!==0&&this._configDependentLayers.add(y.fqid);let b=this._order.length;if(o){const D=this._order.indexOf(o);if(D===-1)return void this.fire(new r.y(new Error(`Layer with id "${o}" does not exist on this map.`)));y.slot===this._layers[o].slot?b=D:r.w(`Layer with id "${o}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(b,0,m),this._layerOrderChanged=!0,this._layers[m]=y;const A=this.getOwnLayerSourceCache(y),C=!!this.directionalLight&&this.directionalLight.shadowsEnabled();A&&y.canCastShadows()&&C&&(A.castsShadows=!0);const z=this._changes.getRemovedLayer(y);if(z&&y.source&&A&&y.type!=="custom"){this._changes.discardLayerRemoval(y);const D=r.B(y.source,y.scope);z.type!==y.type?this._changes.updateSourceCache(D,"clear"):(this._changes.updateSourceCache(D,"reload"),A.pause())}this._updateLayer(y),y.onAdd&&y.onAdd(this.map),y.scope=this.scope,this.mergeLayers()}moveLayer(i,o){this._checkLoaded();const u=this._checkLayer(i);if(!u||i===o)return;const m=this._order.indexOf(i);this._order.splice(m,1);let y=this._order.length;if(o){const b=this._order.indexOf(o);if(b===-1)return void this.fire(new r.y(new Error(`Layer with id "${o}" does not exist on this map.`)));u.slot===this._layers[o].slot?y=b:r.w(`Layer with id "${o}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(y,0,i),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(i){this._checkLoaded();const o=this._checkLayer(i);if(!o)return;o.setEventedParent(null);const u=this._order.indexOf(i);this._order.splice(u,1),delete this._layers[i],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(o.fqid),this._changes.removeLayer(o);const m=this.getOwnLayerSourceCache(o);if(m&&m.castsShadows){let y=!1;for(const b in this._layers)if(this._layers[b].source===o.source&&this._layers[b].canCastShadows()){y=!0;break}m.castsShadows=y}o.onRemove&&o.onRemove(this.map),this.mergeLayers()}getOwnLayer(i){return this._layers[i]}hasLayer(i){return i in this._mergedLayers}hasLayerType(i){for(const o in this._layers)if(this._layers[o].type===i)return!0;return!1}setLayerZoomRange(i,o,u){this._checkLoaded();const m=this._checkLayer(i);m&&(m.minzoom===o&&m.maxzoom===u||(o!=null&&(m.minzoom=o),u!=null&&(m.maxzoom=u),this._updateLayer(m)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(i,o){this._checkLoaded();const u=this._checkLayer(i);u&&u.slot!==o&&(u.slot=o,this._updateLayer(u))}setFilter(i,o,u={}){this._checkLoaded();const m=this._checkLayer(i);if(m&&!r.by(m.filter,o))return o==null?(m.filter=void 0,void this._updateLayer(m)):void(this._validate(K,`layers.${m.id}.filter`,o,{layerType:m.type},u)||(m.filter=r.dk(o),this._updateLayer(m)))}getFilter(i){const o=this._checkLayer(i);if(o)return r.dk(o.filter)}setLayoutProperty(i,o,u,m={}){this._checkLoaded();const y=this._checkLayer(i);if(y&&!r.by(y.getLayoutProperty(o),u)){if(u!=null&&(!m||m.validate!==!1)&&wo(y,pe.call(On,{key:`layers.${i}.layout.${o}`,layerType:y.type,objectKey:o,value:u,styleSpec:r.a6,style:{glyphs:!0,sprite:!0}})))return;y.setLayoutProperty(o,u),y.configDependencies.size!==0&&this._configDependentLayers.add(y.fqid),this._updateLayer(y)}}getLayoutProperty(i,o){const u=this._checkLayer(i);if(u)return u.getLayoutProperty(o)}setPaintProperty(i,o,u,m={}){this._checkLoaded();const y=this._checkLayer(i);if(!y||r.by(y.getPaintProperty(o),u)||u!=null&&(!m||m.validate!==!1)&&wo(y,se.call(On,{key:`layers.${i}.paint.${o}`,layerType:y.type,objectKey:o,value:u,styleSpec:r.a6})))return;const b=y.setPaintProperty(o,u);y.configDependencies.size!==0&&this._configDependentLayers.add(y.fqid),b&&this._updateLayer(y),this._changes.updatePaintProperties(y)}getPaintProperty(i,o){const u=this._checkLayer(i);if(u)return u.getPaintProperty(o)}setFeatureState(i,o){if(this._checkLoaded(),"target"in i){if("featuresetId"in i.target){const{featuresetId:C,importId:z}=i.target,D=this.getFragmentStyle(z),U=D.getFeaturesetLayers(C);for(const{source:F,sourceLayer:W}of U)D.setFeatureState({id:i.id,source:F,sourceLayer:W},o)}else if("layerId"in i.target){const{layerId:C}=i.target,z=this.getLayer(C);this.setFeatureState({id:i.id,source:z.source,sourceLayer:z.sourceLayer},o)}return}const u=i.source,m=i.sourceLayer,y=this._checkSource(u);if(!y)return;const b=y.type;if(b==="geojson"&&m)return void this.fire(new r.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(b==="vector"&&!m)return void this.fire(new r.y(new Error("The sourceLayer parameter must be provided for vector source types.")));i.id===void 0&&this.fire(new r.y(new Error("The feature id parameter must be provided.")));const A=this.getOwnSourceCaches(u);for(const C of A)C.setFeatureState(m,i.id,o)}removeFeatureState(i,o){if(this._checkLoaded(),"target"in i){if("featuresetId"in i.target){const{featuresetId:C,importId:z}=i.target,D=this.getFragmentStyle(z),U=D.getFeaturesetLayers(C);for(const{source:F,sourceLayer:W}of U)D.removeFeatureState({id:i.id,source:F,sourceLayer:W},o)}else if("layerId"in i.target){const{layerId:C}=i.target,z=this.getLayer(C);this.removeFeatureState({id:i.id,source:z.source,sourceLayer:z.sourceLayer},o)}return}const u=i.source,m=this._checkSource(u);if(!m)return;const y=m.type,b=y==="vector"?i.sourceLayer:void 0;if(y==="vector"&&!b)return void this.fire(new r.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(o&&typeof i.id!="string"&&typeof i.id!="number")return void this.fire(new r.y(new Error("A feature id is required to remove its specific state property.")));const A=this.getOwnSourceCaches(u);for(const C of A)C.removeFeatureState(b,i.id,o)}getFeatureState(i){if(this._checkLoaded(),"target"in i){let y;if("featuresetId"in i.target){const{featuresetId:b,importId:A}=i.target,C=this.getFragmentStyle(A),z=C.getFeaturesetLayers(b);for(const{source:D,sourceLayer:U}of z){const F=C.getFeatureState({id:i.id,source:D,sourceLayer:U});if(F&&!y)y=F;else if(!r.by(y,F))return void this.fire(new r.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in i.target){const{layerId:b}=i.target,A=this.getLayer(b);y=this.getFeatureState({id:i.id,source:A.source,sourceLayer:A.sourceLayer})}return y}const o=i.source,u=i.sourceLayer,m=this._checkSource(o);if(m){if(m.type!=="vector"||u)return i.id===void 0&&this.fire(new r.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(o)[0].getFeatureState(u,i.id);this.fire(new r.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(i){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,i),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();const i=this.getTerrain(),o=i&&this.terrain&&this.terrain.scope===this.scope?i:this.stylesheet.terrain;return r.dr({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:o,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},u=>u!==void 0)}_updateFilteredLayers(i){for(const o of Object.values(this._mergedLayers))i(o)&&this._updateLayer(o)}_updateLayer(i){this._changes.updateLayer(i);const o=this.getLayerSourceCache(i),u=r.B(i.source,i.scope),m=this._changes.getUpdatedSourceCaches();i.source&&!m[u]&&o&&o.getSource().type!=="raster"&&(this._changes.updateSourceCache(u,"reload"),o.pause()),i.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(i){const o=A=>this._mergedLayers[A].is3D(!!this.terrain),u=this.order,m={},y=[];for(let A=u.length-1;A>=0;A--){const C=u[A];if(o(C)){m[C]=A;for(const z of i){const D=z[C];if(D)for(const U of D)y.push(U)}}}y.sort((A,C)=>C.intersectionZ-A.intersectionZ);const b=[];for(let A=u.length-1;A>=0;A--){const C=u[A];if(o(C))for(let z=y.length-1;z>=0;z--){const D=y[z].feature;if(D.layer&&m[D.layer.id]<A)break;b.push(D),y.pop()}else for(const z of i){const D=z[C];if(D)for(const U of D)b.push(U.feature)}}return b}queryRasterValue(i,o,u){const m=this.getOwnSource(i);return m?m.type!=="raster-array"?(this.fire(new r.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):m.queryRasterArrayValue(o,u):(this.fire(new r.y(new Error(`Source with id "${i}" does not exist in the style.`))),Promise.resolve(null))}queryRenderedFeatures(i,o,u){let m;o&&!Array.isArray(o)&&o.filter&&(this._validate(K,"queryRenderedFeatures.filter",o.filter,null,o),m=r.b6(o.filter));const y={},b=D=>{if(yh.has(D.type))return;const U=this.getOwnLayerSourceCache(D),F=y[U.id]=y[U.id]||{sourceCache:U,layers:{},has3DLayers:!1};D.is3D(!!this.terrain)&&(F.has3DLayers=!0),F.layers[D.fqid]=F.layers[D.fqid]||{styleLayer:D,targets:[]},F.layers[D.fqid].targets.push({filter:m})};if(o&&o.layers){if(!Array.isArray(o.layers))return this.fire(new r.y(new Error("parameters.layers must be an Array."))),[];for(const D of o.layers){const U=this._layers[D];if(!U)return this.fire(new r.y(new Error(`The layer '${D}' does not exist in the map's style and cannot be queried for features.`))),[];b(U)}}else for(const D in this._layers)b(this._layers[D]);const A=this._queryRenderedFeatures(i,y,u),C=this._flattenAndSortRenderedFeatures(A),z=[];for(const D of C)r.ds(D.layer.id)===this.scope&&z.push(D);return z}queryRenderedFeatureset(i,o,u){let m;o&&!Array.isArray(o)&&o.filter&&(this._validate(K,"queryRenderedFeatures.filter",o.filter,null,o),m=r.b6(o.filter));const y="mock",b=[];if(o&&o.target)b.push(Object.assign({},o,{targetId:y,filter:m}));else{const D=this.getFeaturesetDescriptors();for(const U of D)b.push({targetId:y,filter:m,target:U});for(const{style:U}of this.fragments){const F=U.getFeaturesetDescriptors();for(const W of F)b.push({targetId:y,filter:m,target:W})}}const A=this.queryRenderedTargets(i,b,u),C=[],z=new Set;for(const D of A)for(const U of D.variants[y])Va(U,D,z)||C.push(new r.dt(D,U));return C}queryRenderedTargets(i,o,u){const m={},y=(A,C,z,D)=>{const U=m[C.id]=m[C.id]||{sourceCache:C,layers:{},has3DLayers:!1};if(U.layers[A.fqid]=U.layers[A.fqid]||{styleLayer:A,targets:[]},A.is3D(!!this.terrain)&&(U.has3DLayers=!0),!D)return z.uniqueFeatureID=!1,void U.layers[A.fqid].targets.push(z);U.layers[A.fqid].targets.push(Object.assign({},z,{namespace:D.namespace,properties:D.properties,uniqueFeatureID:D.uniqueFeatureID}))};for(const A of o)if("featuresetId"in A.target){const{featuresetId:C,importId:z}=A.target,D=this.getFragmentStyle(z);if(!D||!D._featuresetSelectors)continue;const U=D._featuresetSelectors[C];if(!U){this.fire(new r.y(new Error(`The featureset '${C}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const F of U){const W=D.getOwnLayer(F.layerId);W&&!yh.has(W.type)&&y(W,D.getOwnLayerSourceCache(W),A,F)}}else if("layerId"in A.target){const{layerId:C}=A.target,z=this.getLayer(C);if(!z||yh.has(z.type))continue;y(z,this.getLayerSourceCache(z),A)}const b=this._queryRenderedFeatures(i,m,u);return this._flattenAndSortRenderedFeatures(b)}_queryRenderedFeatures(i,o,u){const m=[],y=!!this.map._showQueryGeometry,b=Hr.createFromScreenPoints(i,u);for(const A in o){const C=ec(b,o[A],this._availableImages,u,y);Object.keys(C).length&&m.push(C)}if(this.placement)for(const A in o){if(!o[A].sourceCache._onlySymbols)continue;const C=Gu(b.screenGeometry,o[A],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(C).length&&m.push(C)}return m}querySourceFeatures(i,o){const u=o&&o.filter;u&&this._validate(K,"querySourceFeatures.filter",u,null,o);let m=[];const y=this.getOwnSourceCaches(i);for(const b of y)m=m.concat(Kn(b,o));return m}addSourceType(i,o,u){return Mn.getSourceType(i)?u(new Error(`A source type called "${i}" already exists.`)):(Mn.setSourceType(i,o),o.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:i,url:o.workerSourceURL},u):u(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(i,o,u={}){this._checkLoaded();const m=this.light.getLight();let y=!1;for(const A in i)if(!r.by(i[A],m[A])){y=!0;break}if(!y)return;const b=this._getTransitionParameters();this.light.setLight(i,o,u),this.light.updateTransitions(b)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=r.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&r.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(i,o=1){if(this._checkLoaded(),!i)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),o===0&&delete this.terrain,i===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let u=i;const m=i.source==null;if(o===1){if(this.disableElevatedTerrain)return;if(typeof u.source=="object"){const A="terrain-dem-src";this.addSource(A,u.source),u=r.dk(u),u=Object.assign(u,{source:A})}const y=Object.assign({},u),b={};if(this.terrain&&m){y.source=this.terrain.get().source;const A=this.terrain?this.getFragmentStyle(this.terrain.scope):null;A&&(b.style=A.serialize())}if(this._validate(mt,"terrain",y,b))return}if(!this.terrain||this.terrain.scope!==this.scope&&!m||this.terrain&&o!==this.terrain.drapeRenderMode){if(!u)return;this._createTerrain(u,o),this.fire(new r.z("data",{dataType:"style"}))}else{const y=this.terrain,b=y.get();for(const A of Object.keys(r.a6.terrain))!u.hasOwnProperty(A)&&r.a6.terrain[A].default&&(u[A]=r.a6.terrain[A].default);for(const A in i)if(!r.by(i[A],b[A])){y.set(i,this.options),this.stylesheet.terrain=i;const C=this._getTransitionParameters({duration:0});y.updateTransitions(C),this.fire(new r.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(i){const o=this.fog=new Bi(i,this.map.transform,this.scope,this.options);this.stylesheet.fog=o.get();const u=this._getTransitionParameters({duration:0});o.updateTransitions(u)}_createSnow(i){const o=this.snow=new ls(i,this.map.transform,this.scope,this.options);this.stylesheet.snow=o.get();const u=this._getTransitionParameters({duration:0});o.updateTransitions(u)}_createRain(i){const o=this.rain=new dr(i,this.map.transform,this.scope,this.options);this.stylesheet.rain=o.get();const u=this._getTransitionParameters({duration:0});o.updateTransitions(u)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const i of this.map._markers)i._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(i){if(this._checkLoaded(),!i)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const o=this.fog;if(!r.by(o.get(),i)){o.set(i,this.options),this.stylesheet.fog=o.get();const u=this._getTransitionParameters({duration:0});o.updateTransitions(u)}}else this._createFog(i);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(i){if(this._checkLoaded(),!i)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const o=this.snow;if(!r.by(o.get(),i)){o.set(i,this.options),this.stylesheet.snow=o.get();const u=this._getTransitionParameters({duration:0});o.updateTransitions(u)}}else this._createSnow(i);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(i){if(this._checkLoaded(),!i)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const o=this.rain;if(!r.by(o.get(),i)){o.set(i,this.options),this.stylesheet.rain=o.get();const u=this._getTransitionParameters({duration:0});o.updateTransitions(u)}}else this._createRain(i);this._markersNeedUpdate=!0}_reloadColorTheme(){const i=()=>{for(const m in this._layers)this._layers[m].lut=this._styleColorTheme.lut;for(const m in this._sourceCaches)this._sourceCaches[m].clearTiles()},o=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!o)return this._styleColorTheme.lut=null,void i();const u=this._evaluateColorThemeData(o);this._loadColorTheme(u).then(()=>{this.fire(new r.z("colorthemeset")),i()}).catch(m=>{r.w(`Couldn't set color theme: ${m}`)})}setColorTheme(i){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&r.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=i,this._reloadColorTheme()}setImportColorTheme(i,o){const u=this.getFragmentStyle(i);u&&(u._styleColorTheme.colorThemeOverride=o,u._reloadColorTheme())}_getTransitionParameters(i){return{now:r.o.now(),transition:Object.assign(this.transition,i)}}updateDrapeFirstLayers(){if(!this.terrain)return;const i=[],o=[];for(const u of this._mergedOrder)this.isLayerDraped(this._mergedLayers[u])?i.push(u):o.push(u);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...i),this._drapedFirstOrder.push(...o)}_createTerrain(i,o){const u=this.terrain=new Ze(i,o,this.scope,this.options,this.map.getWorldview());o===1&&(this.stylesheet.terrain=i),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const m=this._getTransitionParameters({duration:0});u.updateTransitions(m)}_force3DLayerUpdate(){for(const i in this._layers){const o=this._layers[i];o.type==="fill-extrusion"&&this._updateLayer(o)}}_forceSymbolLayerUpdate(){for(const i in this._layers){const o=this._layers[i];o.type==="symbol"&&this._updateLayer(o)}}_validate(i,o,u,m,y={}){if(y&&y.validate===!1)return!1;const b=Object.assign({},this.serialize());return wo(this,i.call(On,Object.assign({key:o,style:b,value:u,styleSpec:r.a6},m)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),r.du.off("pluginStateChange",this._rtlTextPluginCallback);for(const i in this._mergedLayers)this._mergedLayers[i].setEventedParent(null);for(const i in this._mergedSourceCaches)this._mergedSourceCaches[i].clearTiles(),this._mergedSourceCaches[i].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(i){const o=this.getSourceCaches(i);for(const u of o)u.clearTiles()}clearSources(){for(const i in this._mergedSourceCaches)this._mergedSourceCaches[i].clearTiles()}clearLayers(){for(const i in this._mergedLayers){const o=this._mergedLayers[i];o._clear&&o._clear()}}reloadSource(i){const o=this.getSourceCaches(i);for(const u of o)u.resume(),u.reload()}reloadSources(){for(const i of this.getSources())i.reload&&i.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(i=>{i.modelManager.reloadModels(i.scope)})}updateSources(i){let o;this.directionalLight&&(o=sl(this.directionalLight));const u=new Set;for(const m in this._mergedLayers){const y=this._mergedLayers[m];y.hasElevation()&&!u.has(y.source)&&u.add(y.source)}for(const m in this._mergedSourceCaches){const y=this._mergedSourceCaches[m],b=u.has(y._source.id);y.update(i,void 0,void 0,o,b)}}_generateCollisionBoxes(){for(const i in this._sourceCaches){const o=this._sourceCaches[i];o.resume(),o.reload()}}_updatePlacement(i,o,u,m,y,b,A=!1){let C=!1,z=!1;const D={},U={};for(const F of this._mergedOrder){const W=this._mergedLayers[F];if(W.type!=="symbol")continue;const X=r.B(W.source,W.scope);let Y=D[X];if(!Y){const J=this.getLayerSourceCache(W);if(!J)continue;const re=J.getRenderableIds(!0).map(oe=>J.getTileByID(oe));U[X]=re.slice(),Y=D[X]=re.sort((oe,he)=>he.tileID.overscaledZ-oe.tileID.overscaledZ||(oe.tileID.isLessThan(he.tileID)?-1:1))}const te=this.crossTileSymbolIndex.addLayer(W,Y,o.center.lng,o.projection);C=C||te}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),A=A||this._layerOrderChanged||m===0,this._layerOrderChanged&&this.fire(new r.z("neworder")),(A||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(r.o.now(),o.zoom))&&(this.pauseablePlacement=new Ws(o,this._mergedOrder,A,u,m,y,this.placement,this.fog&&o.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,D,U,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(r.o.now()),z=!0),C&&this.pauseablePlacement.placement.setStale()),z||C){this._buildingIndex.onNewFrame(o.zoom);for(let F=0;F<this._mergedOrder.length;F++){const W=this._mergedLayers[this._mergedOrder[F]];if(W.type!=="symbol")continue;const X=this.isLayerClipped(W);this.placement.updateLayerOpacities(W,D[r.B(W.source,W.scope)],F,X?b:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(r.o.now())}}_releaseSymbolFadeTiles(){for(const i in this._sourceCaches)this._sourceCaches[i].releaseSymbolFadeTiles()}addImport(i,o){this._checkLoaded();const u=this.stylesheet.imports=this.stylesheet.imports||[];if(u.findIndex(({id:y})=>y===i.id)!==-1)return void this.fire(new r.y(new Error(`Import with id '${i.id}' already exists in the map's style.`)));if(!o)return u.push(i),this._loadImports([i],!0);const m=u.findIndex(({id:y})=>y===o);return m===-1&&this.fire(new r.y(new Error(`Import with id "${o}" does not exist on this map.`))),this.stylesheet.imports=u.slice(0,m).concat(i).concat(u.slice(m)),this._loadImports([i],!0,o)}updateImport(i,o){this._checkLoaded();const u=this.stylesheet.imports||[],m=this.getImportIndex(i);return m===-1?this:typeof o=="string"?(this.setImportUrl(i,o),this):(o.url&&o.url!==u[m].url&&this.setImportUrl(i,o.url),r.by(o.config,u[m].config)||this.setImportConfig(i,o.config,o.data.schema),r.by(o.data,u[m].data)||this.setImportData(i,o.data),this)}moveImport(i,o){this._checkLoaded();let u=this.stylesheet.imports||[];const m=this.getImportIndex(i);if(m===-1)return this;const y=this.getImportIndex(o);if(y===-1)return this;const b=u[m],A=this.fragments[m];return u=u.filter(({id:C})=>C!==i),this.fragments=this.fragments.filter(({id:C})=>C!==i),this.stylesheet.imports=u.slice(0,y).concat(b).concat(u.slice(y)),this.fragments=this.fragments.slice(0,y).concat(A).concat(this.fragments.slice(y)),this.mergeLayers(),this}setImportUrl(i,o){this._checkLoaded();const u=this.stylesheet.imports||[],m=this.getImportIndex(i);if(m===-1)return this;u[m].url=o;const y=this.fragments[m];return y.style=this._createFragmentStyle(u[m]),y.style.on("style.import.load",()=>this.mergeAll()),y.style.loadURL(o),this}setImportData(i,o){this._checkLoaded();const u=this.getImportIndex(i),m=this.stylesheet.imports||[];return u===-1?this:o?(this.fragments[u].style.setState(o),this._reloadImports(),this):(delete m[u].data,this.setImportUrl(i,m[u].url))}setImportConfig(i,o,u){this._checkLoaded();const m=this.getImportIndex(i),y=this.stylesheet.imports||[];if(m===-1)return this;o?y[m].config=o:delete y[m].config;const b=this.fragments[m];u&&b.style.stylesheet&&(b.style.stylesheet.schema=u);const A=b.style.stylesheet&&b.style.stylesheet.schema;return b.config=o,b.style.updateConfig(o,A),this.updateConfigDependencies(),this}removeImport(i){this._checkLoaded();const o=this.stylesheet.imports||[],u=this.getImportIndex(i);u!==-1&&(o.splice(u,1),this.fragments[u].style._remove(),this.fragments.splice(u,1),this._reloadImports())}getImportIndex(i){const o=(this.stylesheet.imports||[]).findIndex(u=>u.id===i);return o===-1&&this.fire(new r.y(new Error(`Import '${i}' does not exist in the map's style and cannot be updated.`))),o}getLayer(i){return this._mergedLayers[i]}getSources(){const i=[];for(const o in this._mergedOtherSourceCaches){const u=this._mergedOtherSourceCaches[o];u&&i.push(u.getSource())}return i}getSource(i,o){const u=this.getSourceCache(i,o);return u&&u.getSource()}getLayerSource(i){const o=this.getLayerSourceCache(i);return o&&o.getSource()}getSourceCache(i,o){const u=r.B(i,o);return this._mergedOtherSourceCaches[u]}getLayerSourceCache(i){const o=r.B(i.source,i.scope);return i.type==="symbol"?this._mergedSymbolSourceCaches[o]:this._mergedOtherSourceCaches[o]}getSourceCaches(i){if(i==null)return Object.values(this._mergedSourceCaches);const o=[];return this._mergedOtherSourceCaches[i]&&o.push(this._mergedOtherSourceCaches[i]),this._mergedSymbolSourceCaches[i]&&o.push(this._mergedSymbolSourceCaches[i]),o}updateSourceCaches(){const i=this._changes.getUpdatedSourceCaches();for(const o in i){const u=i[o];u==="reload"?this.reloadSource(o):u==="clear"&&this.clearSource(o)}}updateLayers(i){const o=this._changes.getUpdatedPaintProperties();for(const u of o){const m=this.getLayer(u);m&&m.updateTransitions(i)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(i){this.stylesheet.glyphs=i,this.glyphManager.setURL(i)}getImages(i,o,u){this.imageManager.getImages(o.images,o.scope,u),this._updateTilesForChangedImages();const m=b=>{if(b){const A=o.images.map(C=>r.I.toString(C));b.setDependencies(o.tileID.key,o.type,A)}},y=r.B(o.source,o.scope);m(this._mergedOtherSourceCaches[y]),m(this._mergedSymbolSourceCaches[y]),o.images.some(b=>b.iconsetId)&&this.fire(new r.z("data",{dataType:"style"}))}rasterizeImages(i,o,u){this.imageManager.rasterizeImages(o,u)}getGlyphs(i,o,u){this.glyphManager.getGlyphs(o.stacks,u)}getResource(i,o,u){return r.dv(o,u)}getOwnSourceCache(i){return this._otherSourceCaches[i]}getOwnLayerSourceCache(i){return i.type==="symbol"?this._symbolSourceCaches[i.source]:this._otherSourceCaches[i.source]}getOwnSourceCaches(i){const o=[];return this._otherSourceCaches[i]&&o.push(this._otherSourceCaches[i]),this._symbolSourceCaches[i]&&o.push(this._symbolSourceCaches[i]),o}_isSourceCacheLoaded(i){const o=this.getOwnSourceCaches(i);return o.length===0?(this.fire(new r.y(new Error(`There is no source with ID '${i}'`))),!1):o.every(u=>u.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(i,o){if(!this._clipLayerPresent&&i.type!=="fill-extrusion"&&i.type!=="building")return!1;const u=i.type==="fill-extrusion"&&(i.sourceLayer==="building"||i.sourceLayer==="procedural_buildings"),m=i.type==="building";if(i.is3D(!!this.terrain)){if(u||m||o&&o.type==="batched-model"||i.type==="model")return!0}else if(i.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(i=>{i.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Mn.getSourceType=function(d){return $o[d]},Mn.setSourceType=function(d,i){$o[d]=i},Mn.registerForPluginStateChange=r.dw;class dp{execute(i){const o=this._makeBuildingsQueryArea(i),u=this._makeFloorsQueryArea(i),m=i.queryRenderedFeatures(o).reduce((z,D)=>{const U=D.properties.id;return D.properties.type!=="building"||z.some(F=>F.properties.id===U)||z.push(D),z},[]),y=i.queryRenderedFeatures(u).reduce((z,D)=>{const U=D.properties.id;return D.properties.type!=="floor"||z.some(F=>F.properties.id===U)||z.push(D),z},[]),b=[i.getCenter().lng,i.getCenter().lat],A=this._findBuildingAtCenter(b,m),C=m.length>0?m[0]:null;return{floors:y.map(z=>({id:z.properties.id,name:z.properties.name,isDefault:z.properties.is_default,zIndex:z.properties.z_index,connectedFloorIds:z.properties.connected_floor_ids,conflictedFloorIds:z.properties.conflicted_floor_ids,buildingIds:z.properties.building_ids})),building:A?{id:A.properties.id,name:A.properties.name}:{id:C.properties.id,name:C.properties.name}}}_makeBuildingsQueryArea(i){const o=i.transform.width,u=i.transform.height,m=Math.min(o,u)*(1/8),y=.5*(o-m),b=.5*(u-m);return[new r.P(y,b),new r.P(y+m,b+m)]}_makeFloorsQueryArea(i){const o=i.transform.width,u=i.transform.height;return[new r.P(0,0),new r.P(o,u)]}_findBuildingAtCenter(i,o){for(const u of o)if(u.geometry.type==="Polygon"&&this._pointInPolygon(i,u.geometry.coordinates[0]))return u;return null}_pointInPolygon(i,o){let u=!1;for(let m=0,y=o.length-1;m<o.length;y=m++){const b=o[m][0],A=o[m][1],C=o[y][1];A>i[1]!=C>i[1]&&i[0]<(o[y][0]-b)*(i[1]-A)/(C-A)+b&&(u=!u)}return u}}class fp{constructor(){this._floors=new Map,this._buildings=new Map}append(i){const o=i.building;let u=!1;if(o){const m=o.id;m&&(this._buildings.set(m,o),u||this._buildings.has(m)||(u=!0))}return i.floors.forEach(m=>{const y=m.id;u||this._floors.has(y)||(u=!0),this._floors.set(y,m)}),u}clear(){this._floors.clear(),this._buildings.clear()}getFloors(i=null){const o=Array.from(this._floors.values());return i?o.filter(u=>{const m=u.buildingIds;return!!m&&m.split(";").includes(i)}):o}}class pp{constructor(){this._selectedFloorId=null,this._selectedBuildingId=null,this._lastActiveFloors=[],this._featuresStorage=new fp}setIndoorData(i){const o=this._featuresStorage.append(i);return this._selectedBuildingId=i.building?i.building.id:null,o}setFloorId(i){const o=this._selectedFloorId!==i;return o&&(this._selectedFloorId=i),o}getCurrentBuildingSelection(){if(!this._selectedBuildingId)return{selectedFloorId:null,floors:[]};const i=this._featuresStorage.getFloors(this._selectedBuildingId),o=this.getActiveFloors().find(u=>{const m=u.buildingIds;if(!m)return!1;const y=m.split(";");return!!this._selectedBuildingId&&y.includes(this._selectedBuildingId)});return{selectedFloorId:o?o.id:null,floors:i}}getActiveFloors(i=!1){const o=this._featuresStorage.getFloors(),u=o.find(C=>C.id===this._selectedFloorId),m=o.filter(C=>C.isDefault===!0);let y=[];if(u)return y=this._calculateCurrentActiveFloors(o,u,m,i),y;if(m.length===0){const C=this._featuresStorage.getFloors(this._selectedBuildingId);y=C.length>0?[C[0]]:[]}else y=m;const b=this._getNonConflictingLastActiveFloors(y),A=[...y,...b];return this._lastActiveFloors=A,A}hasBuildingChanged(i){return this._selectedBuildingId!==(i.building?i.building.id:null)}hasActiveBuilding(){return this._selectedBuildingId!==null}isEmpty(){return this._selectedFloorId===null&&this._selectedBuildingId===null&&this._lastActiveFloors.length===0}_calculateCurrentActiveFloors(i,o,u,m){if(!o)return this._getNonConflictingDefaultFloors(this._lastActiveFloors,u);const y=this._getConnectedFloors(o,i);return m?this._buildExplicitSelectionFloors(o,y,u):this._buildImplicitSelectionFloors(y,u)}_getConnectedFloors(i,o){const u=i.connectedFloorIds;if(!u)return[];const m=new Set(u.split(";"));return o.filter(y=>m.has(y.id))}_buildExplicitSelectionFloors(i,o,u){const m=[i,...o],y=this._getNonConflictingLastActiveFloors(m),b=[...m,...y],A=this._deduplicateFloors(b),C=this._getConflictingFloorIdsFrom(A),z=u.filter(U=>!C.has(U.id)),D=[...A,...z];return this._lastActiveFloors=D,D}_buildImplicitSelectionFloors(i,o){const u=this._getConflictingFloorIdsFrom(this._lastActiveFloors),m=o.filter(b=>!u.has(b.id)),y=this._deduplicateFloors([...this._lastActiveFloors,...m]);return this._lastActiveFloors=y,y}_getNonConflictingDefaultFloors(i,o){const u=this._getConflictingFloorIdsFrom(i),m=o.filter(b=>!u.has(b.id)),y=this._deduplicateFloors([...i,...m]);return this._lastActiveFloors=y,y}_deduplicateFloors(i){const o=new Set;return i.filter(u=>{const m=u.id;return!o.has(m)&&(o.add(m),!0)})}_getConflictingFloorIdsFrom(i){const o=new Set;return i.forEach(u=>{const m=u.conflictedFloorIds;m&&m.split(";").forEach(y=>o.add(y))}),o}_getNonConflictingLastActiveFloors(i){if(!this._lastActiveFloors||this._lastActiveFloors.length===0)return[];const o=new Set(i.map(m=>m.id)),u=this._getConflictingFloorIdsFrom(i);return this._lastActiveFloors.filter(m=>{const y=m.id;return!o.has(y)&&!u.has(y)})}_isFloorConflicted(i,o){const u=i.id;return o.some(m=>{const y=m.conflictedFloorIds;return!!y&&y.split(";").includes(u)})}reset(){this._selectedFloorId=null,this._selectedBuildingId=null,this._lastActiveFloors=[],this._featuresStorage.clear()}}class So extends r.E{constructor(i){super(),r.aY(["_onLoad","_onMove"],this),this._map=i,this._floorSelectionState=new pp,this._queryIndoor(),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.off("load",this._onLoad),this._map.off("move",this._onMove),this._map=null,this._floorSelectionState=null}selectFloor(i){this._floorSelectionState.setFloorId(i)&&this._updateIndoorConfig(!0)}_onLoad(){this._map.style.forEachFragmentStyle(i=>{i.stylesheet.indoor&&(this._indoorDataQuery?this.fire(new r.y(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._scope=i.scope,this._indoorDataQuery=new dp))}),this._map._addIndoorControl(),this._queryIndoor()}_onMove(){this._queryIndoor()}_queryIndoor(){if(!this._indoorDataQuery||!this._map.isStyleLoaded())return;if(this._map.transform.zoom<15)return void this._clearIndoorData();const i=this._indoorDataQuery.execute(this._map);if(!i||i.floors.length===0||this._map.transform.zoom<16)this._clearIndoorData();else if(this._floorSelectionState.hasBuildingChanged(i)){if(!i.building&&this._floorSelectionState.getActiveFloors().length<=0)return void this._clearIndoorData();this._setIndoorData(i),i.building&&this._updateIndoorSelector()}else this._setIndoorData(i)}_setIndoorData(i){this._floorSelectionState.setIndoorData(i)&&this._updateIndoorConfig()}_clearIndoorData(){this._floorSelectionState.isEmpty()||(this._floorSelectionState.reset(),this._updateIndoorSelector(),this._map.setConfigProperty(this._scope,"activeFloors",["literal",[]]))}_updateIndoorSelector(){const i=this._floorSelectionState.getCurrentBuildingSelection(),o=i.floors.map(u=>({id:u.id,name:u.name,shortName:u.zIndex.toString(),levelOrder:u.zIndex}));this.fire(new r.z("indoorupdate",{selectedFloorId:i.selectedFloorId,floors:o}))}_updateIndoorConfig(i=!1){const o=this._floorSelectionState.getActiveFloors(i).map(u=>u.id)||[];this._map.setConfigProperty(this._scope,"activeFloors",["literal",o])}}var pc=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,nd=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,ad=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,al="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",ol=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,od=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,vh=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,vn=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,bh=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,At=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,ld=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const ll=[];Pn(pc,ll),Pn(ad,ll),Pn(nd,ll);const cl={"_prelude_fog.vertex.glsl":od,"_prelude_terrain.vertex.glsl":ol,"_prelude_shadow.vertex.glsl":At,"_prelude_fog.fragment.glsl":vh,"_prelude_shadow.fragment.glsl":ld,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":vn,"_prelude_raster_particle.glsl":bh},gc={};Oi("",ol),Oi(vh,od),Oi(ld,At),Oi(vn,""),Oi(bh,"");const mc=Oi(nd,ad),ea=pc;var wh={background:Oi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Oi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:Oi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
shadowed_lighting_factor=dot(normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=mix(color.rgb,base_color.rgb,emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color.rgb=linearTosRGB(color.rgb);color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);}`),buildingBloom:Oi(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);}`),buildingDepth:Oi(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:Oi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Oi("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Oi(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Oi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Oi("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Oi("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Oi("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:Oi(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:Oi(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#else
#ifdef FEATURE_CUTOUT
apply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);
#endif
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:Oi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:Oi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:Oi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Oi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Oi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Oi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Oi(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Oi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Oi(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Oi(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Oi(`precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Oi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Oi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:Oi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:Oi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Oi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Oi("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Oi("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Oi(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:Oi(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:Oi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Oi("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Oi(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,al),skyboxGradient:Oi(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,al),skyboxCapture:Oi(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Oi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Oi(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Oi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Oi(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Oi(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:Oi("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:Oi("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:Oi("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:Oi("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Pn(d,i){const o=d.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let u of o)if(u=u.trim(),u[0]==="#"&&u.includes("if")&&!u.includes("endif")){u=u.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const m=u.split(" ");for(const y of m)i.includes(y)||i.push(y)}}function Oi(d,i){const o=/#include\s+"([^"]+)"/g,u=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,m={},y=[],b=[];if(d=d.replace(o,(C,z)=>(b.push(z),"")),(i=i.replace(o,(C,z)=>(y.push(z),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let A=[...ll];Pn(d,A),Pn(i,A);for(const C of[...y,...b])cl[C]||console.error(`Undefined include: ${C}`),gc[C]||(gc[C]=[],Pn(cl[C],gc[C])),A=[...A,...gc[C]];return{fragmentSource:d=d.replace(u,(C,z,D,U,F)=>(m[F]=!0,z==="define"?`
#ifndef HAS_UNIFORM_u_${F}
in ${D} ${U} ${F};
#else
uniform ${D} ${U} u_${F};
#endif
`:z==="initialize"?`
#ifdef HAS_UNIFORM_u_${F}
    ${D} ${U} ${F} = u_${F};
#endif
`:z==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${F}
    in ${D} ${U} ${F};
#endif
`:z==="initialize-attribute"?"":void 0)),vertexSource:i=i.replace(u,(C,z,D,U,F)=>{const W=U==="float"?"vec2":U,X=F.match(/color/)?"color":W;return z==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${F}
in ${D} ${U} a_${F};
#endif
`:m[F]?z==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
in ${D} ${W} a_${F};
out ${D} ${U} ${F};
#else
uniform ${D} ${U} u_${F};
#endif
`:z==="initialize"?X==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = a_${F};
#else
    ${D} ${U} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = unpack_mix_${X}(a_${F}, u_${F}_t);
#else
    ${D} ${U} ${F} = u_${F};
#endif
`:z==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${F}
    in ${D} ${U} a_${F};
    out ${D} ${U} ${F};
#endif
`:z==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${F}
    ${F} = a_${F};
#endif
`:void 0:z==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
in ${D} ${W} a_${F};
#else
uniform ${D} ${U} u_${F};
#endif
`:z==="define-instanced"?X==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${F}0;
in vec4 a_${F}1;
in vec4 a_${F}2;
in vec4 a_${F}3;
#else
uniform ${D} ${U} u_${F};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${D} ${W} a_${F};
#else
uniform ${D} ${U} u_${F};
#endif
`:z==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${F}
    ${D} ${U} ${F} = a_${F};
#endif
`:X==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${D} ${U} ${F} = a_${F};
#else
    ${D} ${U} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${D} ${U} ${F} = unpack_mix_${X}(a_${F}, u_${F}_t);
#else
    ${D} ${U} ${F} = u_${F};
#endif
`}),usedDefines:A,vertexIncludes:y,fragmentIncludes:b}}class hl{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(i,o,u,m,y,b,A,C){this.context=i;let z=this.boundPaintVertexBuffers.length!==m.length;for(let U=0;!z&&U<m.length;U++)this.boundPaintVertexBuffers[U]!==m[U]&&(z=!0);let D=this.boundDynamicVertexBuffers.length!==A.length;for(let U=0;!D&&U<A.length;U++)this.boundDynamicVertexBuffers[U]!==A[U]&&(D=!0);if(!this.vao||this.boundProgram!==o||this.boundLayoutVertexBuffer!==u||z||D||this.boundIndexBuffer!==y||this.boundVertexOffset!==b)this.freshBind(o,u,m,y,b,A,C);else{i.bindVertexArrayOES.set(this.vao);for(const U of A)U&&(U.bind(),C&&U.instanceCount&&U.setVertexAttribDivisor(i.gl,o,C));y&&y.dynamicDraw&&y.bind()}}freshBind(i,o,u,m,y,b,A){const C=this.context,z=C.gl;this.vao&&this.destroy(),this.vao=C.gl.createVertexArray(),C.bindVertexArrayOES.set(this.vao),this.boundProgram=i,this.boundLayoutVertexBuffer=o,this.boundPaintVertexBuffers=u,this.boundIndexBuffer=m,this.boundVertexOffset=y,this.boundDynamicVertexBuffers=b,o.enableAttributes(z,i),o.bind(),o.setVertexAttribPointers(z,i,y);for(const D of u)D.enableAttributes(z,i),D.bind(),D.setVertexAttribPointers(z,i,y);for(const D of b)D&&(D.enableAttributes(z,i),D.bind(),D.setVertexAttribPointers(z,i,y),A&&D.instanceCount&&D.setVertexAttribDivisor(z,i,A));m&&m.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function xm(d,i){const o=Math.pow(2,i.canonical.z),u=i.canonical.y;return[new r.ae(0,u/o).toLngLat().lat,new r.ae(0,(u+1)/o).toLngLat().lat]}function vm(d,i,o,u,m,y,b){const A=d.context,C=A.gl,z=o.hillshadeFBO;if(!z)return;d.prepareDrawTile();const D=d.isTileAffectedByFog(i),U=d.getOrCreateProgram("hillshade",{overrideFog:D});A.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,z.colorAttachment.get());const F=((te,J,re,oe)=>{const he=re.paint.get("hillshade-shadow-color"),ye=re.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",me=re.paint.get("hillshade-highlight-color"),xe=re.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",_e=re.paint.get("hillshade-accent-color"),ge=re.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Ae=re.paint.get("hillshade-emissive-strength");let je=r.an(re.paint.get("hillshade-illumination-direction"));if(re.paint.get("hillshade-illumination-anchor")==="viewport")je-=te.transform.angle;else if(te.style&&te.style.enable3dLights()&&te.style.directionalLight){const Je=te.style.directionalLight.properties.get("direction"),Ne=r.d3(Je.x,Je.y,Je.z);je=r.an(Ne[1])}const Re=!te.options.moving;return{u_matrix:oe||te.transform.calculateProjMatrix(J.tileID.toUnwrapped(),Re),u_image:0,u_latrange:xm(0,J.tileID),u_light:[re.paint.get("hillshade-exaggeration"),je],u_shadow:he.toPremultipliedRenderColor(ye?null:re.lut),u_highlight:me.toPremultipliedRenderColor(xe?null:re.lut),u_emissive_strength:Ae,u_accent:_e.toPremultipliedRenderColor(ge?null:re.lut)}})(d,o,u,d.terrain?i.projMatrix:null);d.uploadCommonUniforms(A,U,i.toUnwrapped());const{tileBoundsBuffer:W,tileBoundsIndexBuffer:X,tileBoundsSegments:Y}=d.getTileBoundsBuffers(o);U.draw(d,C.TRIANGLES,m,y,b,ai.disabled,F,u.id,W,X,Y)}function Sh(d,i,o){if(!i.needsDEMTextureUpload)return;const u=d.context,m=u.gl;u.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||d.getTileTexture(o.stride);const y=o.getPixels();i.demTexture?i.demTexture.update(y,{premultiply:!1}):i.demTexture=new r.T(u,y,m.R32F,{premultiply:!1}),i.needsDEMTextureUpload=!1}function bm(d,i,o){const u=d.context,m=u.gl;if(!i.dem)return;const y=i.dem;if(u.activeTexture.set(m.TEXTURE1),Sh(d,i,y),!i.demTexture)return;i.demTexture.bind(m.NEAREST,m.CLAMP_TO_EDGE);const b=y.dim;u.activeTexture.set(m.TEXTURE0);let A=i.hillshadeFBO;if(!A){const F=new r.T(u,{width:b,height:b,data:null},m.RGBA8);F.bind(m.LINEAR,m.CLAMP_TO_EDGE),A=i.hillshadeFBO=u.createFramebuffer(b,b,!0,"renderbuffer"),A.colorAttachment.set(F.texture)}u.bindFramebuffer.set(A.framebuffer),u.viewport.set([0,0,b,b]);const{tileBoundsBuffer:C,tileBoundsIndexBuffer:z,tileBoundsSegments:D}=d.getMercatorTileBoundsBuffers(),U=[];d.linearFloatFilteringSupported()&&U.push("TERRAIN_DEM_FLOAT_FORMAT"),d.getOrCreateProgram("hillshadePrepare",{defines:U}).draw(d,m.TRIANGLES,Rt.disabled,ii.disabled,bi.unblended,ai.disabled,((F,W)=>{const X=W.stride,Y=r.bC();return r.cd(Y,0,r.al,-r.al,0,0,1),r.br(Y,Y,[0,-r.al,0]),{u_matrix:Y,u_image:1,u_dimension:[X,X],u_zoom:F.overscaledZ}})(i.tileID,y),o.id,C,z,D),i.needsHillshadePrepare=!1}class Lr{constructor(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(i){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class gp extends Lr{getDefault(){return r.ao.transparent.toNonPremultipliedRenderColor(null)}set(i){const o=this.current;(i.r!==o.r||i.g!==o.g||i.b!==o.b||i.a!==o.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class cd extends Lr{getDefault(){return 1}set(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)}}class wm extends Lr{getDefault(){return 0}set(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)}}class Sm extends Lr{getDefault(){return[!0,!0,!0,!0]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||i[2]!==o[2]||i[3]!==o[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Am extends Lr{getDefault(){return!0}set(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)}}class Tm extends Lr{getDefault(){return 255}set(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)}}class mp extends Lr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(i){const o=this.current;(i.func!==o.func||i.ref!==o.ref||i.mask!==o.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)}}class Em extends Lr{getDefault(){const i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||i[2]!==o[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)}}class Ah extends Lr{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;i?o.enable(o.STENCIL_TEST):o.disable(o.STENCIL_TEST),this.current=i,this.dirty=!1}}class Cm extends Lr{getDefault(){return[0,1]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)}}class _p extends Lr{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;i?o.enable(o.DEPTH_TEST):o.disable(o.DEPTH_TEST),this.current=i,this.dirty=!1}}class hd extends Lr{getDefault(){return this.gl.LESS}set(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)}}class Th extends Lr{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;i?o.enable(o.BLEND):o.disable(o.BLEND),this.current=i,this.dirty=!1}}class ud extends Lr{getDefault(){const i=this.gl;return[i.ONE,i.ZERO,i.ONE,i.ZERO]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||i[2]!==o[2]||i[3]!==o[3]||this.dirty)&&(this.gl.blendFuncSeparate(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Ao extends Lr{getDefault(){return r.ao.transparent.toNonPremultipliedRenderColor(null)}set(i){const o=this.current;(i.r!==o.r||i.g!==o.g||i.b!==o.b||i.a!==o.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class ul extends Lr{getDefault(){return this.gl.FUNC_ADD}set(i){(i!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(i,i),this.current=i,this.dirty=!1)}}class Eh extends Lr{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;i?o.enable(o.CULL_FACE):o.disable(o.CULL_FACE),this.current=i,this.dirty=!1}}class Ch extends Lr{getDefault(){return this.gl.BACK}set(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)}}class dl extends Lr{getDefault(){return this.gl.CCW}set(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)}}let yp=class extends Lr{getDefault(){return null}set(d){(d!==this.current||this.dirty)&&(this.gl.useProgram(d),this.current=d,this.dirty=!1)}};class dd extends Lr{getDefault(){return this.gl.TEXTURE0}set(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)}}class xp extends Lr{getDefault(){const i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||i[2]!==o[2]||i[3]!==o[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class fl extends Lr{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.bindFramebuffer(o.FRAMEBUFFER,i),this.current=i,this.dirty=!1}}class Ih extends Lr{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.bindRenderbuffer(o.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class kh extends Lr{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.bindTexture(o.TEXTURE_2D,i),this.current=i,this.dirty=!1}}class fd extends Lr{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.bindBuffer(o.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class Mh extends Lr{getDefault(){return null}set(i){const o=this.gl;o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class _c extends Lr{getDefault(){return null}set(i){this.gl&&(i!==this.current||this.dirty)&&(this.gl.bindVertexArray(i),this.current=i,this.dirty=!1)}}class vp extends Lr{getDefault(){return 4}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}}class bp extends Lr{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}}class wp extends Lr{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}}class Ya extends Lr{constructor(i,o){super(i),this.context=i,this.parent=o}getDefault(){return null}}class Sp extends Ya{setDirty(){this.dirty=!0}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class Ap extends Ya{attachment(){return this.gl.DEPTH_ATTACHMENT}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,this.attachment(),o.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class Im extends Ya{attachment(){return this.gl.DEPTH_ATTACHMENT}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,this.attachment(),o.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class km extends Ap{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const pd=(d,i,o)=>({u_matrix:d,u_image0:0,u_skirt_height:i,u_ground_shadow_factor:o}),Ph=(d,i,o,u,m,y,b,A,C,z,D,U,F,W,X,Y)=>({u_proj_matrix:Float32Array.from(d),u_globe_matrix:i,u_normalize_matrix:Float32Array.from(u),u_merc_matrix:o,u_zoom_transition:m,u_merc_center:y,u_image0:0,u_frustum_tl:b,u_frustum_tr:A,u_frustum_br:C,u_frustum_bl:z,u_globe_pos:D,u_globe_radius:U,u_viewport:F,u_grid_matrix:Y?Float32Array.from(Y):new Float32Array(9),u_skirt_height:W,u_far_z_cutoff:X});function Lh(d,i){return d!=null&&i!=null&&!(!d.hasData()||!i.hasData())&&d.demTexture!=null&&i.demTexture!=null&&d.tileID.key!==i.tileID.key}const qa=new class{constructor(){this.operations={}}newMorphing(d,i,o,u,m){if(d in this.operations){const y=this.operations[d];y.to.tileID.key!==o.tileID.key&&(y.queued=o)}else this.operations[d]={startTime:u,phase:0,duration:m,from:i,to:o,queued:null}}getMorphValuesForProxy(d){if(!(d in this.operations))return null;const i=this.operations[d];return{from:i.from,to:i.to,phase:i.phase}}update(d){for(const i in this.operations){const o=this.operations[i];for(o.phase=(d-o.startTime)/o.duration;o.phase>=1||!this._validOp(o);)if(!this._nextOp(o,d)){delete this.operations[i];break}}}_nextOp(d,i){return!!d.queued&&(d.from=d.to,d.to=d.queued,d.queued=null,d.phase=0,d.startTime=i,!0)}_validOp(d){return d.from.hasData()&&d.to.hasData()}},gd={0:null,1:"TERRAIN_VERTEX_MORPHING"};function md(d,i,o){if(i===0)return 0;const u=i<1&&o===514?.25/i:1;return 6*Math.pow(1.5,22-d)*Math.max(i,1)*u}function Mm(d,i){const o=1<<d.z;return!i&&(d.x===0||d.x===o-1)||d.y===0||d.y===o-1}const To=d=>({u_matrix:d});function Eo(d,i,o,u,m){if(m>0){const y=r.o.now(),b=(y-d.timeAdded)/m,A=i?(y-i.timeAdded)/m:-1,C=o.getSource(),z=u.coveringZoomLevel({tileSize:C.tileSize,roundZoom:C.roundZoom}),D=!i||Math.abs(i.tileID.overscaledZ-z)>Math.abs(d.tileID.overscaledZ-z),U=D&&d.refreshedUponExpiration?1:r.aA(D?b:1-A,0,1);return i?{opacity:1,mix:1-U,isFading:b<1}:{opacity:U,mix:0,isFading:b<1}}return{opacity:1,mix:0,isFading:!1}}class Tp extends mn{constructor(i){const o=Kl("mock-dem",{type:"raster-dem",maxzoom:i.transform.maxZoom},i.style.dispatcher,i.style);super("mock-dem",o,!1),o.setEventedParent(this),this._sourceLoaded=!0}_loadTile(i,o){i.state="loaded",o(null)}}class bn extends mn{constructor(i){const o=Kl("proxy",{type:"geojson",maxzoom:i.transform.maxZoom},i.style.dispatcher,i.style);super("proxy",o,!1),o.setEventedParent(this),this.map=this.getSource().map=i,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(i,o,u){if(i.freezeTileCoverage)return;this.transform=i;const m=i.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((y,b)=>{if(y[b.key]="",!this._tiles[b.key]){const A=new Ua(b,this._source.tileSize*b.overscaleFactor(),i.tileZoom,void 0,void 0,this._source.worldview);A.state="loaded",this._tiles[b.key]=A}return y},{});for(const y in this._tiles)y in m||(this.freeFBO(y),this._tiles[y].unloadVectorData(),delete this._tiles[y])}freeFBO(i){const o=this.proxyCachedFBO[i];if(o!==void 0){const u=Object.values(o);this.renderCachePool.push(...u),delete this.proxyCachedFBO[i]}}deallocRenderCache(){this.renderCache.forEach(i=>i.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class zh extends r.aO{constructor(i,o,u){super(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,i.canonical.y),this.proxyTileKey=o,this.projMatrix=u}}class yc extends r.dH{constructor(i,o){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},i.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),i.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),i.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=i,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[u,m,y]=function(C){const z=new r.bd,D=new r.b1,U=131;z.reserve(17161),D.reserve(33800);const F=r.al/128,W=r.al+F/2,X=W+F;for(let te=-F;te<X;te+=F)for(let J=-F;J<X;J+=F){const re=J<0||J>W||te<0||te>W?24575:0,oe=r.aA(Math.round(J),0,r.al),he=r.aA(Math.round(te),0,r.al);z.emplaceBack(oe+re,he)}const Y=(te,J)=>{const re=J*U+te;D.emplaceBack(re+1,re,re+U),D.emplaceBack(re+U,re+U+1,re+1)};for(let te=1;te<129;te++)for(let J=1;J<129;J++)Y(J,te);return[0,129].forEach(te=>{for(let J=0;J<130;J++)Y(J,te),Y(te,J)}),[z,D,32768]}(),b=i.context;this.gridBuffer=b.createVertexBuffer(u,r.bf.members),this.gridIndexBuffer=b.createIndexBuffer(m),this.gridSegments=r.bg.simpleSegment(0,0,u.length,m.length),this.gridNoSkirtSegments=r.bg.simpleSegment(0,0,u.length,y),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new bn(o.map),this.orthoMatrix=r.bC(),r.cd(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,r.al,0,r.al,0,1);const A=b.gl;this._overlapStencilMode=new ii({func:A.GEQUAL,mask:255},0,255,A.KEEP,A.KEEP,A.REPLACE),this._previousZoom=i.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=o,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Tp(o.map),this._pendingGroundEffectLayers=[]}set style(i){i.on("data",this._onStyleDataEvent.bind(this)),this._style=i,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(i,o,u){if(i&&i.terrain){this._style!==i&&(this.style=i,this._evaluationZoom=void 0);const m=i.terrain.properties,y=i.terrain.drapeRenderMode===0,b=i.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=r.o.now();const A=i.terrain&&i.terrain.scope,C=m.get("source"),z=y?this._mockSourceCache:i.getSourceCache(C,A);if(!z)return void r.w(`Couldn't find terrain source "${C}".`);if(this.sourceCache=z,this._attenuationRange=i.terrain.getAttenuationRange(),this._exaggeration=b?this.calculateExaggeration(o):m.get("exaggeration"),!o.projection.requiresDraping&&b&&this._exaggeration===0)return void this._disable();this.enabled=!0;const D=()=>{this.sourceCache.used&&r.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const U=this.getScaledDemTileSize();this.sourceCache.update(o,U,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,D(),this._initializing=!0),D(),o.updateElevation(!0,u),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(o),this._emptyDEMTextureDirty=!0,this._previousZoom=o.zoom}else this._disable()}calculateExaggeration(i){if(this._attenuationRange&&i.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(i.zoom);const o=this._previousCameraAltitude,u=i.getFreeCameraOptions().position.z/i.pixelsPerMeter*i.worldSize;this._previousCameraAltitude=u;const m=o!=null?u-o:Number.MAX_VALUE;if(Math.abs(m)<2)return this._exaggeration;const y=i.zoom,b=this._style.terrain;if(!this._previousUpdateTimestamp)return b.getExaggeration(y);let A=y-this._previousZoom;const C=this._previousUpdateTimestamp;let z=y;this._evaluationZoom!=null&&(z=this._evaluationZoom,Math.abs(y-z)>.5&&(A=.5*(y-z+A)),A*m<0&&(z+=A)),this._evaluationZoom=z;const D=b.getExaggeration(z),U=D===b.getExaggeration(Math.max(0,z-.1));if(U&&Math.abs(D-this._exaggeration)<.01)return D;let F=Math.min(.1,.00375*(this._updateTimestamp-C));return(U||D<.1||Math.abs(A)<1e-4)&&(F=Math.min(.2,4*F)),r.ak(this._exaggeration,D,F)}resetTileLookupCache(i){this._findCoveringTileCache[i]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(i){i.dataType==="source"&&i.coord?this._clearRenderCacheForTile(i.sourceCacheId,i.coord):i.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const i in this._style._mergedSourceCaches)this._style._mergedSourceCaches[i].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(i=>i.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const i=2*this.proxySourceCache.getSource().tileSize;return[i,i]}set useVertexMorphing(i){this._useVertexMorphing=i}updateTileBinding(i){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const o=this.proxySourceCache,u=this.painter.transform;this._initializing&&(this._initializing=u._centerAltitude===0&&this.getAtPointOrZero(r.ae.fromLngLat(u.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const m=this.proxyCoords=o.getIds().map(C=>{const z=o.getTileByID(C).tileID;return z.projMatrix=u.calculateProjMatrix(z.toUnwrapped()),z});(function(C,z){const D=z.transform.pointCoordinate(z.transform.getCameraPoint()),U=new r.P(D.x,D.y);C.sort((F,W)=>{if(W.overscaledZ-F.overscaledZ)return W.overscaledZ-F.overscaledZ;const X=new r.P(F.canonical.x+(1<<F.canonical.z)*F.wrap,F.canonical.y),Y=new r.P(W.canonical.x+(1<<W.canonical.z)*W.wrap,W.canonical.y),te=U.mult(1<<F.canonical.z);return te.x-=.5,te.y-=.5,te.distSqr(X)-te.distSqr(Y)})})(m,this.painter);const y=this.proxyToSource||{};this.proxyToSource={},m.forEach(C=>{this.proxyToSource[C.key]={}}),this.terrainTileForTile={};const b=this._style._mergedSourceCaches;for(const C in b){const z=b[C];if(!z.used||(z!==this.sourceCache&&this.resetTileLookupCache(z.id),this._setupProxiedCoordsForOrtho(z,i[C],y),z.usedForTerrain))continue;const D=i[C];z.getSource().reparseOverscaled&&this._assignTerrainTiles(D)}this.proxiedCoords[o.id]=m.map(C=>new zh(C,C.key,this.orthoMatrix)),this._assignTerrainTiles(m),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(y),this.renderingToTexture=!1;const A={};this._visibleDemTiles=[];for(const C of this.proxyCoords){const z=this.terrainTileForTile[C.key];if(!z)continue;const D=z.tileID.key;D in A||(this._visibleDemTiles.push(z),A[D]=D)}}_assignTerrainTiles(i){this._initializing||i.forEach(o=>{if(this.terrainTileForTile[o.key])return;const u=this._findTileCoveringTileID(o,this.sourceCache);u&&(this.terrainTileForTile[o.key]=u)})}_prepareDEMTextures(){const i=this.painter.context,o=i.gl;for(const u in this.terrainTileForTile){const m=this.terrainTileForTile[u],y=m.dem;!y||m.demTexture&&!m.needsDEMTextureUpload||(i.activeTexture.set(o.TEXTURE1),Sh(this.painter,m,y))}}_prepareDemTileUniforms(i,o,u,m){if(!o||o.demTexture==null)return!1;const y=i.tileID.canonical,b=Math.pow(2,o.tileID.canonical.z-y.z),A=m||"";return u[`u_dem_tl${A}`]=[y.x*b%1,y.y*b%1],u[`u_dem_scale${A}`]=b,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let i=0;const o=this._visibleDemTiles.reduce((u,m)=>{if(!m.dem)return u;const y=m.dem.tree.minimums[0];return y>0&&i++,u+y},0);return i?o/i:0}_updateEmptyDEMTexture(){const i=this.painter.context,o=i.gl;i.activeTexture.set(o.TEXTURE2);const u=this._getLoadedAreaMinimum(),m=new r.dI({width:1,height:1},new Float32Array([u]));this._emptyDEMTextureDirty=!1;let y=this._emptyDEMTexture;return y?y.update(m,{premultiply:!1}):y=this._emptyDEMTexture=new r.T(i,m,o.R32F,{premultiply:!1}),y}setupElevationDraw(i,o,u){const m=this.painter.context,y=m.gl,b={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};b.u_exaggeration=this.exaggeration();let A=null,C=null,z=1;if(u&&u.morphing&&this._useVertexMorphing){const W=u.morphing.srcDemTile,X=u.morphing.dstDemTile;z=u.morphing.phase,W&&X&&(this._prepareDemTileUniforms(i,W,b,"_prev")&&(C=W),this._prepareDemTileUniforms(i,X,b)&&(A=X))}const D=W=>W&&W.demTexture&&this.painter.linearFloatFilteringSupported()?y.LINEAR:y.NEAREST;let U=null;var F;if(this.enabled?C&&A?(U=A.demTexture,m.activeTexture.set(y.TEXTURE4),C.demTexture.bind(D(C),y.CLAMP_TO_EDGE),b.u_dem_lerp=z):(A=this.terrainTileForTile[i.tileID.key],U=this._prepareDemTileUniforms(i,A,b)?A.demTexture:this.emptyDEMTexture):U=this.emptyDEMTexture,m.activeTexture.set(y.TEXTURE2),U&&(b.u_dem_size=(F=U).size[0]===1?1:F.size[0]-2,U.bind(D(A),y.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(u&&u.useDepthForOcclusion,o,b),u&&u.useMeterToDem&&A){const W=(1<<A.tileID.canonical.z)*r.ce(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;b.u_meter_to_dem=W}if(u&&u.labelPlaneMatrixInv&&(b.u_label_plane_matrix_inv=u.labelPlaneMatrixInv),o.setTerrainUniformValues(m,b),this.painter.transform.projection.name==="globe"){const W=this.globeUniformValues(this.painter.transform,i.tileID.canonical,u&&u.useDenormalizedUpVectorScale);o.setGlobeUniformValues(m,W)}}globeUniformValues(i,o,u){const m=i.projection;return{u_tile_tl_up:m.upVector(o,0,0),u_tile_tr_up:m.upVector(o,r.al,0),u_tile_br_up:m.upVector(o,r.al,r.al),u_tile_bl_up:m.upVector(o,0,r.al),u_tile_up_scale:u?r.dJ(1):m.upVectorScale(o,i.center.lat,i.worldSize).metersToTile}}renderToBackBuffer(i){const o=this.painter,u=this.painter.context;i.length!==0&&(u.bindFramebuffer.set(null),u.viewport.set([0,0,o.width,o.height]),o.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(m,y,b,A,C){if(m.transform.projection.name==="globe")(function(z,D,U,F,W){const X=z.context,Y=X.gl;let te,J;const re=z.transform,oe=r.dA(z,X,re),he=(Je,Ne)=>{if(J===Ne)return;const $e=[gd[Ne],"PROJECTION_GLOBE_VIEW"];oe&&$e.push("CUSTOM_ANTIALIASING");const vt=z.isTileAffectedByFog(Je);te=z.getOrCreateProgram("globeRaster",{defines:$e,overrideFog:vt}),J=Ne},ye=z.colorModeForRenderPass(),me=new Rt(Y.LEQUAL,Rt.ReadWrite,z.depthRangeFor3D);qa.update(W);const xe=r.dB(re),_e=[r.aF(re.center.lng),r.aJ(re.center.lat)],ge=z.globeSharedBuffers,Ae=[re.width*r.o.devicePixelRatio,re.height*r.o.devicePixelRatio],je=Float32Array.from(re.globeMatrix),Re={useDenormalizedUpVectorScale:!0};{const Je=z.transform,Ne=md(Je.zoom,D.exaggeration(),D.sourceCache._source.tileSize);J=-1;const $e=Y.TRIANGLES;for(const vt of F){const Ve=U.getTile(vt),Pe=ii.disabled,Qe=D.prevTerrainTileForTile[vt.key],We=D.terrainTileForTile[vt.key];Lh(Qe,We)&&qa.newMorphing(vt.key,Qe,We,W,250),X.activeTexture.set(Y.TEXTURE0),Ve.texture&&Ve.texture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE);const at=qa.getMorphValuesForProxy(vt.key),xt=at?1:0;at&&Object.assign(Re,{morphing:{srcDemTile:at.from,dstDemTile:at.to,phase:r.dz(at.phase)}});const Pt=r.dC(vt.canonical),pt=r.dD(Pt.getCenter().lat),ht=r.dE(vt.canonical,Pt,pt,Je.worldSize/Je._pixelsPerMercatorPixel),Wt=r.bk(r.dF(vt.canonical)),Ut=Ph(Je.expandedFarZProjMatrix,je,xe,Wt,r.aj(Je.zoom),_e,Je.frustumCorners.TL,Je.frustumCorners.TR,Je.frustumCorners.BR,Je.frustumCorners.BL,Je.globeCenterInViewSpace,Je.globeRadius,Ae,Ne,Je._farZ,ht);if(he(vt,xt),te&&(D.setupElevationDraw(Ve,te,Re),z.uploadCommonUniforms(X,te,vt.toUnwrapped()),ge)){const[Ht,Vt,oi]=ge.getGridBuffers(pt,Ne!==0);te.draw(z,$e,me,Pe,ye,ai.backCCW,Ut,"globe_raster",Ht,Vt,oi)}}}if(ge&&(z.renderDefaultNorthPole||z.renderDefaultSouthPole)){const Je=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];oe&&Je.push("CUSTOM_ANTIALIASING"),te=z.getOrCreateProgram("globeRaster",{defines:Je});for(const Ne of F){const{x:$e,y:vt,z:Ve}=Ne.canonical,Pe=vt===0,Qe=vt===(1<<Ve)-1,[We,at,xt,Pt]=ge.getPoleBuffers(Ve,!1);if(Pt&&(Pe||Qe)){const pt=U.getTile(Ne);X.activeTexture.set(Y.TEXTURE0),pt.texture&&pt.texture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE);let ht=r.dG(Ve,$e,re);const Wt=r.bk(r.dF(Ne.canonical)),Ut=(Ht,Vt)=>Ht.draw(z,Y.TRIANGLES,me,ii.disabled,ye,ai.disabled,Ph(re.expandedFarZProjMatrix,ht,ht,Wt,0,_e,re.frustumCorners.TL,re.frustumCorners.TR,re.frustumCorners.BR,re.frustumCorners.BL,re.globeCenterInViewSpace,re.globeRadius,Ae,0,re._farZ),"globe_pole_raster",Vt,xt,Pt);D.setupElevationDraw(pt,te,Re),z.uploadCommonUniforms(X,te,Ne.toUnwrapped()),Pe&&z.renderDefaultNorthPole&&Ut(te,We),Qe&&z.renderDefaultSouthPole&&(ht=r.cR(r.bC(),ht,[1,-1,1]),Ut(te,at))}}}})(m,y,b,A,C);else{const z=m.context,D=z.gl;let U,F;const W=m.shadowRenderer,X=Ga(m,m.longestCutoffRange),Y=ye=>{if(F===ye)return;const me=[];me.push(gd[ye]),X.shouldRenderCutoff&&me.push("RENDER_CUTOFF"),W&&(me.push("RENDER_SHADOWS","DEPTH_TEXTURE"),W.useNormalOffset&&me.push("NORMAL_OFFSET")),U=m.getOrCreateProgram("terrainRaster",{defines:me}),F=ye},te=m.colorModeForRenderPass(),J=new Rt(D.LEQUAL,Rt.ReadWrite,m.depthRangeFor3D);qa.update(C);const re=m.transform,oe=md(re.zoom,y.exaggeration(),y.sourceCache._source.tileSize);let he=[0,0,0];if(W){const ye=m.style.directionalLight,me=m.style.ambientLight;ye&&me&&(he=jn(m.style,ye,me))}{F=-1;const ye=D.TRIANGLES,[me,xe]=[y.gridIndexBuffer,y.gridSegments];for(const _e of A){const ge=b.getTile(_e),Ae=ii.disabled,je=y.prevTerrainTileForTile[_e.key],Re=y.terrainTileForTile[_e.key];Lh(je,Re)&&qa.newMorphing(_e.key,je,Re,C,250),z.activeTexture.set(D.TEXTURE0),ge.texture&&ge.texture.bind(D.LINEAR,D.CLAMP_TO_EDGE);const Je=qa.getMorphValuesForProxy(_e.key),Ne=Je?1:0;let $e;Je&&($e={morphing:{srcDemTile:Je.from,dstDemTile:Je.to,phase:r.dz(Je.phase)}});const vt=pd(_e.projMatrix,Mm(_e.canonical,re.renderWorldCopies)?oe/10:oe,he);if(Y(Ne),!U)continue;y.setupElevationDraw(ge,U,$e);const Ve=_e.toUnwrapped();W&&W.setupShadows(Ve,U),m.uploadCommonUniforms(z,U,Ve,null,X),U.draw(m,ye,J,Ae,te,ai.backCCW,vt,"terrain_raster",y.gridBuffer,me,xe)}}}}(o,this,this.proxySourceCache,i,this._updateTimestamp),this.renderingToTexture=!0,o.gpuTimingDeferredRenderEnd(),i.splice(0,i.length))}renderBatch(i){if(this._drapedRenderBatches.length===0)return i+1;this.renderingToTexture=!0;const o=this.painter,u=this.painter.context,m=this.proxySourceCache,y=this.proxiedCoords[m.id],b=this._drapedRenderBatches.shift(),A=o.style.order,C=[];let z=0;for(const D of y){const U=m.getTileByID(D.proxyTileKey),F=m.proxyCachedFBO[D.key]?m.proxyCachedFBO[D.key][i]:void 0,W=F!==void 0?m.renderCache[F]:this.pool[z++],X=F!==void 0;if(U.texture=W.tex,X&&!W.dirty){C.push(U.tileID);continue}let Y;u.bindFramebuffer.set(W.fb.framebuffer),this.renderedToTile=!1,W.dirty&&(u.clear({color:r.ao.transparent,stencil:0}),W.dirty=!1);for(let te=b.start;te<=b.end;++te){const J=o.style._mergedLayers[A[te]];if(J.isHidden(o.transform.zoom))continue;const re=o.style.getLayerSourceCache(J),oe=re?this.proxyToSource[D.key][re.id]:[D];if(!oe)continue;const he=oe;u.viewport.set([0,0,W.fb.width,W.fb.height]),Y!==(re?re.id:null)&&(this._setupStencil(W,oe,J,re),Y=re?re.id:null),o.renderLayer(o,re,J,he)}if(this._drapedRenderBatches.length===0)for(const te of this._pendingGroundEffectLayers){const J=o.style._mergedLayers[A[te]];if(J.isHidden(o.transform.zoom))continue;const re=o.style.getLayerSourceCache(J),oe=re?this.proxyToSource[D.key][re.id]:[D];if(!oe)continue;const he=oe;u.viewport.set([0,0,W.fb.width,W.fb.height]),Y!==(re?re.id:null)&&(this._setupStencil(W,oe,J,re),Y=re?re.id:null),o.renderLayer(o,re,J,he)}this.renderedToTile?(W.dirty=!0,C.push(U.tileID)):X||--z,z===5&&(z=0,this.renderToBackBuffer(C))}return this.renderToBackBuffer(C),this.renderingToTexture=!1,u.bindFramebuffer.set(null),u.viewport.set([0,0,o.width,o.height]),b.end+1}postRender(){}isLayerOrderingCorrect(i){const o=i.order.length;let u=-1,m=o;for(let y=0;y<o;++y)this._style.isLayerDraped(i._mergedLayers[i.order[y]])?u=Math.max(u,y):m=Math.min(m,y);return m>u}getMinElevationBelowMSL(){let i=0;return this._visibleDemTiles.filter(o=>o.dem).forEach(o=>{i=Math.min(i,o.dem.tree.minimums[0])}),i===0?i:(i-30)*this._exaggeration}raycast(i,o,u){if(!this._visibleDemTiles)return null;const m=this._visibleDemTiles.filter(y=>y.dem).map(y=>{const b=y.tileID,A=1<<b.overscaledZ,{x:C,y:z}=b.canonical,D=C/A,U=(C+1)/A,F=z/A,W=(z+1)/A;return{minx:D,miny:F,maxx:U,maxy:W,t:y.dem.tree.raycastRoot(D,F,U,W,i,o,u),tile:y}});m.sort((y,b)=>(y.t!==null?y.t:Number.MAX_VALUE)-(b.t!==null?b.t:Number.MAX_VALUE));for(const y of m){if(y.t==null)return null;const b=y.tile.dem.tree.raycast(y.minx,y.miny,y.maxx,y.maxy,i,o,u);if(b!=null)return b}return null}_createFBO(){const i=this.painter.context,o=i.gl,u=this.drapeBufferSize;i.activeTexture.set(o.TEXTURE0);const m=new r.T(i,{width:u[0],height:u[1],data:null},o.RGBA8);m.bind(o.LINEAR,o.CLAMP_TO_EDGE);const y=i.createFramebuffer(u[0],u[1],!0,null);return y.colorAttachment.set(m.texture),y.depthAttachment=new km(i,y.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=i.createRenderbuffer(i.gl.DEPTH_STENCIL,u[0],u[1]),this._stencilRef=0,y.depthAttachment.set(this._sharedDepthStencil),i.clear({stencil:0})):y.depthAttachment.set(this._sharedDepthStencil),i.extTextureFilterAnisotropic&&o.texParameterf(o.TEXTURE_2D,i.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,i.extTextureFilterAnisotropicMax),{fb:y,tex:m,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const i in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[i].hasTransition())return!0;return this._style.order.some(i=>{const o=this._style._mergedLayers[i],u=o.isHidden(this.painter.transform.zoom);return o.type==="hillshade"||o.type==="custom"?!u&&o.shouldRedrape():!u&&o.hasTransition()})}_clearLineLayersFromRenderCache(){let i=!1;for(const u of this._style.getSources())if(u instanceof Fs){i=!0;break}if(!i)return;const o={};for(let u=0;u<this._style.order.length;++u){const m=this._style._mergedLayers[this._style.order[u]],y=this._style.getLayerSourceCache(m);if(y&&!o[y.id]&&!m.isHidden(this.painter.transform.zoom)&&m.type==="line"&&m.widthExpression()instanceof r.ad){o[y.id]=!0;for(const b of this.proxyCoords){const A=this.proxyToSource[b.key][y.id];if(A)for(const C of A)this._clearRenderCacheForTile(y.id,C)}}}}_clearRasterLayersFromRenderCache(){let i=!1;for(const u in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[u]._source instanceof Zo){i=!0;break}if(!i)return;const o={};for(let u=0;u<this._style.order.length;++u){const m=this._style._mergedLayers[this._style.order[u]],y=this._style.getLayerSourceCache(m);if(!y||o[y.id]||m.isHidden(this.painter.transform.zoom)||m.type!=="raster")continue;const b=m.paint.get("raster-fade-duration");for(const A of this.proxyCoords){const C=this.proxyToSource[A.key][y.id];if(C)for(const z of C){const D=Eo(y.getTile(z),y.findLoadedParent(z,0),y,this.painter.transform,b);(D.opacity!==1||D.mix!==0)&&this._clearRenderCacheForTile(y.id,z)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const i=this._style.order,o=i.length;if(o===0)return;const u=[];this._pendingGroundEffectLayers=[];let m,y=0,b=this._style._mergedLayers[i[y]];for(;!this._style.isLayerDraped(b)&&b.isHidden(this.painter.transform.zoom)&&++y<o;)b=this._style._mergedLayers[i[y]];for(;y<o;++y){const A=this._style._mergedLayers[i[y]];A.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(A)?m===void 0&&(m=y):(A.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(y),m!==void 0&&(u.push({start:m,end:y-1}),m=void 0)))}if(m!==void 0&&u.push({start:m,end:y-1}),u.length!==0){const A=u[u.length-1];this._pendingGroundEffectLayers.every(C=>C>A.end)||r.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=u}_setupRenderCache(i){const o=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,o.renderCache.length>o.renderCachePool.length){const b=Object.values(o.proxyCachedFBO);o.proxyCachedFBO={};for(let A=0;A<b.length;++A){const C=Object.values(b[A]);o.renderCachePool.push(...C)}}return}this._clearRasterLayersFromRenderCache();const u=this.proxyCoords,m=this._tilesDirty;for(let b=u.length-1;b>=0;b--){const A=u[b];if(o.getTileByID(A.key),o.proxyCachedFBO[A.key]!==void 0){const C=i[A.key],z=this.proxyToSource[A.key];let D=0;for(const U in z){const F=z[U],W=C[U];if(!W||W.length!==F.length||F.some((X,Y)=>X!==W[Y]||m[U]&&m[U].hasOwnProperty(X.key))){D=-1;break}++D}for(const U in o.proxyCachedFBO[A.key])o.renderCache[o.proxyCachedFBO[A.key][U]].dirty=D<0||D!==Object.values(C).length}}const y=[...this._drapedRenderBatches];y.sort((b,A)=>A.end-A.start-(b.end-b.start));for(const b of y)for(const A of u){if(o.proxyCachedFBO[A.key])continue;let C=o.renderCachePool.pop();C===void 0&&o.renderCache.length<50&&(C=o.renderCache.length,o.renderCache.push(this._createFBO())),C!==void 0&&(o.proxyCachedFBO[A.key]={},o.proxyCachedFBO[A.key][b.start]=C,o.renderCache[C].dirty=!0)}this._tilesDirty={}}_setupStencil(i,o,u,m){if(!m||!this._sourceTilesOverlap[m.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const y=this.painter.context,b=y.gl;if(o.length<=1)return void(this._overlapStencilType=!1);let A;if(u.isTileClipped())A=o.length,this._overlapStencilMode.test={func:b.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(o[0].overscaledZ>o[o.length-1].overscaledZ))return void(this._overlapStencilType=!1);A=1,this._overlapStencilMode.test={func:b.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+A>255&&(y.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=A,this._overlapStencilMode.ref=this._stencilRef,u.isTileClipped()&&this._renderTileClippingMasks(o,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(i){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[i.key]),this._overlapStencilMode):ii.disabled}_renderTileClippingMasks(i,o){const u=this.painter,m=this.painter.context,y=m.gl;u._tileClippingMaskIDs={},m.setColorMode(bi.disabled),m.setDepthMode(Rt.disabled);const b=u.getOrCreateProgram("clippingMask");for(const A of i){const C=u._tileClippingMaskIDs[A.key]=--o;b.draw(u,y.TRIANGLES,Rt.disabled,new ii({func:y.ALWAYS,mask:0},C,255,y.KEEP,y.KEEP,y.REPLACE),bi.disabled,ai.disabled,To(A.projMatrix),"$clipping",u.tileExtentBuffer,u.quadTriangleIndexBuffer,u.tileExtentSegments)}}pointCoordinate(i){const o=this.painter.transform;if(i.x<0||i.x>o.width||i.y<0||i.y>o.height)return null;const u=[i.x,i.y,1,1];r.aC(u,u,o.pixelMatrixInverse),r.cJ(u,u,1/u[3]),u[0]/=o.worldSize,u[1]/=o.worldSize;const m=o._camera.position,y=r.ce(1,o.center.lat),b=[m[0],m[1],m[2]/y,0],A=r.d9([],u.slice(0,3),b);r.aw(A,A);const C=this.raycast(b,A,this._exaggeration);return C!==null&&C?(r.bH(b,b,A,C),b[3]=b[2],b[2]*=y,b):null}_setupProxiedCoordsForOrtho(i,o,u){if(i.getSource()instanceof r.aS)return this._setupProxiedCoordsForImageSource(i,o,u);this._findCoveringTileCache[i.id]=this._findCoveringTileCache[i.id]||{};const m=this.proxiedCoords[i.id]=[],y=this.proxyCoords;for(let C=0;C<y.length;C++){const z=y[C],D=this._findTileCoveringTileID(z,i);if(D){const U=this._createProxiedId(z,D,u[z.key]&&u[z.key][i.id]);m.push(U),this.proxyToSource[z.key][i.id]=[U]}}let b=!1;const A=new Set;for(let C=0;C<o.length;C++){const z=i.getTile(o[C]);if(!z||!z.hasData())continue;const D=this._findTileCoveringTileID(z.tileID,this.proxySourceCache);if(D&&D.tileID.canonical.z!==z.tileID.canonical.z){const U=this.proxyToSource[D.tileID.key][i.id],F=this._createProxiedId(D.tileID,z,u[D.tileID.key]&&u[D.tileID.key][i.id]);U?U.splice(U.length-1,0,F):this.proxyToSource[D.tileID.key][i.id]=[F];const W=this.proxyToSource[D.tileID.key][i.id];A.has(W)||A.add(W),m.push(F),b=!0}}if(this._sourceTilesOverlap[i.id]=b,b&&this._debugParams.sortTilesHiZFirst)for(const C of A)C.sort((z,D)=>D.overscaledZ-z.overscaledZ)}_setupProxiedCoordsForImageSource(i,o,u){if(!i.getSource().loaded())return;const m=this.proxiedCoords[i.id]=[],y=this.proxyCoords,b=i.getSource(),A=b.tileID;if(!A)return;const C=new r.P(A.x,A.y)._div(1<<A.z),z=b.coordinates.map(r.ae.fromLngLat).reduce((U,F)=>(U.min.x=Math.min(U.min.x,F.x-C.x),U.min.y=Math.min(U.min.y,F.y-C.y),U.max.x=Math.max(U.max.x,F.x-C.x),U.max.y=Math.max(U.max.y,F.y-C.y),U),{min:new r.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new r.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),D=(U,F)=>{const W=U.wrap+U.canonical.x/(1<<U.canonical.z),X=U.canonical.y/(1<<U.canonical.z),Y=r.al/(1<<U.canonical.z),te=F.wrap+F.canonical.x/(1<<F.canonical.z),J=F.canonical.y/(1<<F.canonical.z);return W+Y<te+z.min.x||W>te+z.max.x||X+Y<J+z.min.y||X>J+z.max.y};for(let U=0;U<y.length;U++){const F=y[U];for(let W=0;W<o.length;W++){const X=i.getTile(o[W]);if(!X||!X.hasData()||D(F,X.tileID))continue;const Y=this._createProxiedId(F,X,u[F.key]&&u[F.key][i.id]),te=this.proxyToSource[F.key][i.id];te?te.push(Y):this.proxyToSource[F.key][i.id]=[Y],m.push(Y)}}}_createProxiedId(i,o,u){let m=this.orthoMatrix;if(u){const y=u.find(b=>b.key===o.tileID.key);if(y)return y}if(o.tileID.key!==i.key){const y=i.canonical.z-o.tileID.canonical.z;let b,A,C;m=r.bC();const z=o.tileID.wrap-i.wrap<<i.overscaledZ;y>0?(b=r.al>>y,A=b*((o.tileID.canonical.x<<y)-i.canonical.x+z),C=b*((o.tileID.canonical.y<<y)-i.canonical.y)):(b=r.al<<-y,A=r.al*(o.tileID.canonical.x-(i.canonical.x+z<<-y)),C=r.al*(o.tileID.canonical.y-(i.canonical.y<<-y))),r.cd(m,0,b,0,b,0,1),r.br(m,m,[A,C,0])}return new zh(o.tileID,i.key,m)}_findTileCoveringTileID(i,o){let u=o.getTile(i);if(u&&u.hasData())return u;const m=this._findCoveringTileCache[o.id],y=m[i.key];if(u=y?o.getTileByID(y):null,u&&u.hasData()||y===null)return u;let b=u?u.tileID:i,A=b.overscaledZ;const C=o.getSource().minzoom,z=[];if(!y){const U=o.getSource().maxzoom;if(i.canonical.z>=U){const F=i.canonical.z-U;o.getSource().reparseOverscaled?(A=Math.max(i.canonical.z+2,o.transform.tileZoom),b=new r.aO(A,i.wrap,U,i.canonical.x>>F,i.canonical.y>>F)):F!==0&&(A=U,b=new r.aO(A,i.wrap,U,i.canonical.x>>F,i.canonical.y>>F))}b.key!==i.key&&(z.push(b.key),u=o.getTile(b))}const D=U=>{z.forEach(F=>{m[F]=U}),z.length=0};for(A-=1;A>=C&&(!u||!u.hasData());A--){u&&D(u.tileID.key);const U=b.calculateScaledKey(A);if(u=o.getTileByID(U),u&&u.hasData())break;const F=m[U];if(F===null)break;F===void 0?z.push(U):u=o.getTileByID(F)}return D(u?u.tileID.key:null),u&&u.hasData()?u:null}findDEMTileFor(i){return this.enabled?this._findTileCoveringTileID(i,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(i,o){let u=this._tilesDirty[i];u||(u=this._tilesDirty[i]={}),u[o.key]=!0}}function Rh(d,i,o){const u=function(A,C,z){const D=r.bJ(C,A),U=r.bJ(z,[.2126,.7152,.0722]),F=(X,Y,te)=>(1-te)*X+te*Y,W=F(1-.3*Math.min(U,1),1,Math.min(D+1,1));return F(.92,1,Math.asin(r.aA(C[2],-1,1))/Math.PI+.5)*W}(d,[0,0,1],i),m=[0,0,0];r.c4(m,o.slice(0,3),u);const y=[0,0,0];r.c4(y,i.slice(0,3),d[2]);const b=[0,0,0];return r.d7(b,m,y),r.da(b)}const _d=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],yd=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class Dh{static cacheKey(i,o,u,m){let y=`${o}${m?m.cacheKey:""}`;for(const b of u)i.usedDefines.includes(b)&&(y+=`/${b}`);return y}constructor(i,o,u,m,y,b){const A=i.gl;this.program=A.createProgram(),this.configuration=m,this.name=o,this.fixedDefines=[...b];let C=m?m.defines():[];C=C.concat(b.map(X=>`#define ${X}`));const z=`#version 300 es
`;let D=z+C.concat("precision mediump float;",ea,mc.fragmentSource).join(`
`);for(const X of u.fragmentIncludes)D+=`
${cl[X]}`;D+=`
${u.fragmentSource}`;let U=z+C.concat("precision highp float;",ea,mc.vertexSource).join(`
`);for(const X of u.vertexIncludes)U+=`
${cl[X]}`;this.forceManualRenderingForInstanceIDShaders=i.forceManualRenderingForInstanceIDShaders&&u.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(U+=`
uniform int u_instanceID;
`),U+=`
${u.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(U=U.replaceAll("gl_InstanceID","u_instanceID"));const F=A.createShader(A.FRAGMENT_SHADER);if(A.isContextLost())return void(this.failedToCreate=!0);A.shaderSource(F,D),A.compileShader(F),A.attachShader(this.program,F);const W=A.createShader(A.VERTEX_SHADER);A.isContextLost()?this.failedToCreate=!0:(A.shaderSource(W,U),A.compileShader(W),A.attachShader(this.program,W),this.attributes={},A.linkProgram(this.program),A.deleteShader(W),A.deleteShader(F),this.fixedUniforms=y(i),this.binderUniforms=m?m.getUniforms(i):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(X=>({u_instanceID:new r.cg(X)}))(i)),(b.includes("TERRAIN")||o.indexOf("symbol")!==-1||o.indexOf("circle")!==-1)&&(this.terrainUniforms=(X=>({u_dem:new r.cg(X),u_dem_prev:new r.cg(X),u_dem_tl:new r.cj(X),u_dem_scale:new r.ci(X),u_dem_tl_prev:new r.cj(X),u_dem_scale_prev:new r.ci(X),u_dem_size:new r.ci(X),u_dem_lerp:new r.ci(X),u_exaggeration:new r.ci(X),u_depth:new r.cg(X),u_depth_size_inv:new r.cj(X),u_depth_range_unpack:new r.cj(X),u_occluder_half_size:new r.ci(X),u_occlusion_depth_offset:new r.ci(X),u_meter_to_dem:new r.ci(X),u_label_plane_matrix_inv:new r.ck(X)}))(i)),b.includes("GLOBE")&&(this.globeUniforms=(X=>({u_tile_tl_up:new r.ch(X),u_tile_tr_up:new r.ch(X),u_tile_br_up:new r.ch(X),u_tile_bl_up:new r.ch(X),u_tile_up_scale:new r.ci(X)}))(i)),b.includes("FOG")&&(this.fogUniforms=(X=>({u_fog_matrix:new r.ck(X),u_fog_range:new r.cj(X),u_fog_color:new r.d2(X),u_fog_horizon_blend:new r.ci(X),u_fog_vertical_limit:new r.cj(X),u_fog_temporal_offset:new r.ci(X),u_frustum_tl:new r.ch(X),u_frustum_tr:new r.ch(X),u_frustum_br:new r.ch(X),u_frustum_bl:new r.ch(X),u_globe_pos:new r.ch(X),u_globe_radius:new r.ci(X),u_globe_transition:new r.ci(X),u_is_globe:new r.cg(X),u_viewport:new r.cj(X)}))(i)),b.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(X=>({u_cutoff_params:new r.d2(X)}))(i)),b.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(X=>({u_lighting_ambient_color:new r.ch(X),u_lighting_directional_dir:new r.ch(X),u_lighting_directional_color:new r.ch(X),u_ground_radiance:new r.ch(X)}))(i)),b.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(X=>({u_light_matrix_0:new r.ck(X),u_light_matrix_1:new r.ck(X),u_fade_range:new r.cj(X),u_shadow_normal_offset:new r.ch(X),u_shadow_intensity:new r.ci(X),u_shadow_texel_size:new r.ci(X),u_shadow_map_resolution:new r.ci(X),u_shadow_direction:new r.ch(X),u_shadow_bias:new r.ch(X),u_shadowmap_0:new r.cg(X),u_shadowmap_1:new r.cg(X)}))(i)))}getAttributeLocation(i,o){let u=this.attributes[o];return u===void 0&&(u=this.attributes[o]=i.getAttribLocation(this.program,o)),u}setTerrainUniformValues(i,o){if(!this.terrainUniforms)return;const u=this.terrainUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const m in o)u[m]&&u[m].set(this.program,m,o[m])}}setGlobeUniformValues(i,o){if(!this.globeUniforms)return;const u=this.globeUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const m in o)u[m]&&u[m].set(this.program,m,o[m])}}setFogUniformValues(i,o){if(!this.fogUniforms)return;const u=this.fogUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const m in o)u[m].set(this.program,m,o[m])}}setCutoffUniformValues(i,o){if(!this.cutoffUniforms)return;const u=this.cutoffUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const m in o)u[m].set(this.program,m,o[m])}}setLightsUniformValues(i,o){if(!this.lightsUniforms)return;const u=this.lightsUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const m in o)u[m].set(this.program,m,o[m])}}setShadowUniformValues(i,o){if(this.failedToCreate||!this.shadowUniforms)return;const u=this.shadowUniforms;i.program.set(this.program);for(const m in o)u[m].set(this.program,m,o[m])}_drawDebugWireframe(i,o,u,m,y,b,A,C,z,D){const U=i.options.wireframe;if(U.terrain===!1&&U.layers2D===!1&&U.layers3D===!1)return;const F=i.context;if(!(!(!U.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!U.layers2D||i._terrain&&i._terrain.renderingToTexture||!_d.includes(this.name))||!(!U.layers3D||!yd.includes(this.name))))return;const W=F.gl,X=i.wireframeDebugCache.getLinesFromTrianglesBuffer(i.frameCounter,y,F);if(!X)return;const Y=[...this.fixedDefines];Y.push("DEBUG_WIREFRAME");const te=i.getOrCreateProgram(this.name,{config:this.configuration,defines:Y});F.program.set(te.program);const J=(he,ye,me)=>{if(ye[he]&&me[he])for(const xe in ye[he])me[he][xe]&&me[he][xe].set(me.program,xe,ye[he][xe].current)};z&&z.setUniforms(te.program,F,te.binderUniforms,A,{zoom:C}),J("fixedUniforms",this,te),J("terrainUniforms",this,te),J("globeUniforms",this,te),J("fogUniforms",this,te),J("lightsUniforms",this,te),J("shadowUniforms",this,te),X.bind(),F.setColorMode(new bi([W.ONE,W.ONE_MINUS_SRC_ALPHA,W.ZERO,W.ONE],r.ao.transparent,[!0,!0,!0,!1])),F.setDepthMode(new Rt(o.func===W.LESS?W.LEQUAL:o.func,Rt.ReadOnly,o.range)),F.setStencilMode(ii.disabled);const re=3*b.primitiveLength*2,oe=3*b.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const he=D||1;for(let ye=0;ye<he;++ye)te.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",ye),W.drawElements(W.LINES,re,W.UNSIGNED_SHORT,oe)}else D&&D>1?W.drawElementsInstanced(W.LINES,re,W.UNSIGNED_SHORT,oe,D):W.drawElements(W.LINES,re,W.UNSIGNED_SHORT,oe);y.bind(),F.program.set(this.program),F.setDepthMode(o),F.setStencilMode(u),F.setColorMode(m)}checkUniforms(i,o,u){if(this.fixedDefines.includes(o)){for(const m of Object.keys(u))if(!u[m].initialized)throw new Error(`Program '${this.name}', from draw '${i}': uniform ${m} not set but required by ${o} being defined`)}}draw(i,o,u,m,y,b,A,C,z,D,U,F,W,X,Y,te){const J=i.context,re=J.gl;if(this.failedToCreate)return;J.program.set(this.program),J.setDepthMode(u),J.setStencilMode(m),J.setColorMode(y),J.setCullFace(b);for(const ye of Object.keys(this.fixedUniforms))this.fixedUniforms[ye].set(this.program,ye,A[ye]);X&&X.setUniforms(this.program,J,this.binderUniforms,F,{zoom:W});const oe={[re.POINTS]:1,[re.LINES]:2,[re.TRIANGLES]:3,[re.LINE_STRIP]:1}[o];this.checkUniforms(C,"RENDER_SHADOWS",this.shadowUniforms);const he=te&&te>0?1:void 0;for(const ye of U.get()){const me=ye.vaos||(ye.vaos={});if((me[C]||(me[C]=new hl)).bind(J,this,z,X?X.getPaintVertexBuffers():[],D,ye.vertexOffset,Y||[],he),this.forceManualRenderingForInstanceIDShaders){const xe=te||1;for(let _e=0;_e<xe;++_e)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",_e),D?re.drawElements(o,ye.primitiveLength*oe,re.UNSIGNED_SHORT,ye.primitiveOffset*oe*2):re.drawArrays(o,ye.vertexOffset,ye.vertexLength)}else te&&te>1?re.drawElementsInstanced(o,ye.primitiveLength*oe,re.UNSIGNED_SHORT,ye.primitiveOffset*oe*2,te):D?re.drawElements(o,ye.primitiveLength*oe,re.UNSIGNED_SHORT,ye.primitiveOffset*oe*2):re.drawArrays(o,ye.vertexOffset,ye.vertexLength);o===re.TRIANGLES&&D&&this._drawDebugWireframe(i,u,m,y,D,ye,F,W,X,te)}}}function xc(d,i,o=0){const u=Math.pow(2,i.tileID.overscaledZ),m=i.tileSize*Math.pow(2,d.transform.tileZoom)/u,y=m*(i.tileID.canonical.x+i.tileID.wrap*u),b=m*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture?i.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/r.ay(i,1,d.transform.tileZoom),u_pixel_coord_upper:[y>>16,b>>16],u_pixel_coord_lower:[65535&y,65535&b],u_pattern_transition:o}}const pl={terrain:0,flat:1},xd=r.bC(),vc=(d,i,o,u,m,y,b,A,C,z,D,U,F,W,X,Y,te,J)=>{const re=i.style.light,oe=re.properties.get("position"),he=[oe.x,oe.y,oe.z],ye=r.dL();re.properties.get("anchor")==="viewport"&&(r.dM(ye,-i.transform.angle),r.dN(he,he,ye));const me=re.properties.get("color").toPremultipliedRenderColor(null),xe=i.transform,_e={u_matrix:d,u_lightpos:he,u_lightintensity:re.properties.get("intensity"),u_lightcolor:[me.r,me.g,me.b],u_vertical_gradient:+o,u_opacity:u,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:xd,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:pl[z],u_base_type:pl[D],u_ao:m,u_edge_radius:y,u_width_scale:b,u_flood_light_color:X,u_vertical_scale:Y,u_flood_light_intensity:te,u_ground_shadow_factor:J};return xe.projection.name==="globe"&&(_e.u_tile_id=[A.canonical.x,A.canonical.y,1<<A.canonical.z],_e.u_zoom_transition=U,_e.u_inv_rot_matrix=W,_e.u_merc_center=F,_e.u_up_dir=xe.projection.upVector(new r.cC(0,0,0),F[0]*r.al,F[1]*r.al),_e.u_height_lift=C),_e},vd=(d,i,o,u,m,y)=>({u_matrix:d,u_edge_radius:i,u_width_scale:o,u_vertical_scale:u,u_height_type:pl[m],u_base_type:pl[y]}),Ep=(d,i,o,u,m,y,b,A,C,z,D,U,F,W,X,Y,te,J)=>{const re=vc(d,i,o,u,m,y,b,A,z,D,U,F,W,X,Y,te,1,[0,0,0]),oe={u_height_factor:-Math.pow(2,A.overscaledZ)/C.tileSize/8};return Object.assign(re,xc(i,C,J),oe)},bd=(d,i,o)=>({u_matrix:d,u_emissive_strength:i,u_ground_shadow_factor:o}),Co=(d,i,o,u,m,y=0)=>Object.assign(bd(d,i,m),xc(o,u,y)),Pm=(d,i,o,u)=>({u_matrix:d,u_world:o,u_emissive_strength:i,u_ground_shadow_factor:u}),Lm=(d,i,o,u,m,y,b=0)=>Object.assign(Co(d,i,o,u,y,b),{u_world:m}),zm=(d,i)=>({u_matrix:d,u_ground_shadow_factor:i}),Oh=(d,i,o,u,m)=>({u_matrix:d,u_camera_pos:[i[0],i[1],i[2]],u_depth_bias:o,u_height_scale:u,u_reset_depth:m}),Rm=(d,i,o,u,m,y,b)=>({u_matrix:d,u_normal_matrix:i,u_opacity:o,u_faux_facade_ao_intensity:u,u_camera_pos:m,u_tile_to_meter:y,u_facade_emissive_chance:b}),Dm=d=>({u_matrix:d}),wd=d=>({u_matrix:d}),Sd=(d,i,o,u,m,y,b,A)=>{const C=r.al/y.tileSize;return{u_matrix:d,u_inv_rot_matrix:i,u_camera_to_center_distance:o.getCameraToCenterDistance(A),u_extrude_scale:[o.pixelsToGLUnits[0]/C,o.pixelsToGLUnits[1]/C],u_zoom_transition:u,u_tile_id:b,u_merc_center:m}},Ad=(d,i,o=1)=>({u_matrix:d,u_color:i,u_overlay:0,u_overlay_scale:o}),gl=r.bC(),Cp=(d,i,o,u,m,y,b)=>{const A=d.transform,C=A.projection.name==="globe",z=C?r.dO(A.zoom,i.canonical)*A._pixelsPerMercatorPixel:r.ay(o,1,y),D={u_matrix:i.projMatrix,u_extrude_scale:z,u_intensity:b,u_inv_rot_matrix:gl,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(C){D.u_inv_rot_matrix=u,D.u_merc_center=m,D.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],D.u_zoom_transition=r.aj(A.zoom);const U=m[0]*r.al,F=m[1]*r.al;D.u_up_dir=A.projection.upVector(new r.cC(0,0,0),U,F)}return D};function Td(d,[i,o,u,m],[y,b]){if(y===b)return[0,0,0,0];const A=255*(d-1)/(d*(b-y));return[i*A,o*A,u*A,m*A]}function Ed(d,i,[o,u]){return o===u?0:.5/d+(i-o)*(d-1)/(d*(u-o))}const Fh=(d,i,o,u,m,y,b,A,C,z,D,U,F,W,X,Y,te,J,re,oe,he)=>({u_matrix:d,u_normalize_matrix:i,u_globe_matrix:o,u_merc_matrix:u,u_grid_matrix:m,u_tl_parent:y,u_scale_parent:z,u_fade_t:D.mix,u_opacity:D.opacity*U.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:U.paint.get("raster-brightness-min"),u_brightness_high:U.paint.get("raster-brightness-max"),u_saturation_factor:r.dQ(U.paint.get("raster-saturation")),u_contrast_factor:r.dP(U.paint.get("raster-contrast")),u_spin_weights:Io(U.paint.get("raster-hue-rotate")),u_perspective_transform:F,u_raster_elevation:W,u_zoom_transition:b,u_merc_center:A,u_cutoff_params:C,u_colorization_mix:Td(r.dR,Y,J),u_colorization_offset:Ed(r.dR,te,J),u_color_ramp:X,u_texture_offset:[oe/(re+2*oe),re/(re+2*oe)],u_texture_res:[re+2*oe,re+2*oe],u_emissive_strength:he});function Io(d){d*=Math.PI/180;const i=Math.sin(d),o=Math.cos(d);return[(2*o+1)/3,(-Math.sqrt(3)*i-o+1)/3,(Math.sqrt(3)*i-o+1)/3]}const ko=.05,Za=(d,i,o,u,m,y,b,A,C,z,D,U)=>({u_matrix:d,u_normalize_matrix:i,u_globe_matrix:o,u_merc_matrix:u,u_grid_matrix:m,u_tl_parent:y,u_scale_parent:z,u_fade_t:D.mix,u_opacity:D.opacity,u_image0:0,u_image1:1,u_raster_elevation:U,u_zoom_transition:b,u_merc_center:A,u_cutoff_params:C}),Cd=(d,i,o,u,m,y,b,A,C,z)=>({u_particle_texture:d,u_particle_texture_side_len:i,u_tile_offset:o,u_velocity:u,u_color_ramp:y,u_velocity_res:m,u_max_speed:b,u_uv_offset:A,u_data_scale:[255*C[0],255*C[1]],u_data_offset:z,u_particle_pos_scale:1.1,u_particle_pos_offset:[ko,ko]}),Bh=(d,i,o,u,m,y,b,A,C,z)=>({u_particle_texture:d,u_particle_texture_side_len:i,u_velocity:o,u_velocity_res:u,u_max_speed:m,u_speed_factor:y,u_reset_rate:b,u_rand_seed:Math.random(),u_uv_offset:A,u_data_scale:[255*C[0],255*C[1]],u_data_offset:z,u_particle_pos_scale:1.1,u_particle_pos_offset:[ko,ko]}),Id=r.bC(),kd=(d,i,o,u,m,y,b,A,C,z,D,U,F,W,X,Y,te,J,re,oe,he,ye,me,xe)=>{const _e=m.transform,ge={u_is_size_zoom_constant:+(d==="constant"||d==="source"),u_is_size_feature_constant:+(d==="constant"||d==="camera"),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:_e.getCameraToCenterDistance(re),u_rotate_symbol:+o,u_aspect_ratio:_e.width/_e.height,u_fade_change:m.options.fadeDuration?m.symbolFadeChange:1,u_matrix:y,u_label_plane_matrix:b,u_coord_matrix:A,u_is_text:+z,u_elevation_from_sea:C?1:0,u_pitch_with_map:+u,u_texsize:D,u_texsize_icon:U,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Id,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Id,u_up_vector:[0,-1,0],u_color_adj_mat:ye,u_icon_transition:me||0,u_gamma_scale:u?m.transform.getCameraToCenterDistance(re)*Math.cos(m.terrain?0:m.transform._pitch):1,u_device_pixel_ratio:r.o.devicePixelRatio,u_is_halo:1,u_scale_factor:xe||1,u_ground_shadow_factor:oe,u_inv_matrix:r.bl(r.bC(),b),u_normal_scale:he,u_lutTexture:ts.LUT};return re.name==="globe"&&(ge.u_tile_id=[W.canonical.x,W.canonical.y,1<<W.canonical.z],ge.u_zoom_transition=X,ge.u_inv_rot_matrix=te,ge.u_merc_center=Y,ge.u_camera_forward=_e._camera.forward(),ge.u_ecef_origin=r.dS(_e.globeMatrix,W.toUnwrapped()),ge.u_tile_matrix=Float32Array.from(_e.globeMatrix),ge.u_up_vector=J),ge},Nh=(d,i,o,u)=>({u_matrix:d,u_emissive_strength:i,u_opacity:o,u_color:u}),Vh=(d,i,o,u,m,y,b,A,C)=>Object.assign(function(z,D,U,F,W,X){const{width:Y,height:te}=F.imageManager.getPixelSize(D),J=Math.pow(2,X.tileID.overscaledZ),re=X.tileSize*Math.pow(2,F.transform.tileZoom)/J,oe=re*(X.tileID.canonical.x+X.tileID.wrap*J),he=re*X.tileID.canonical.y;return{u_image:0,u_pattern_tl:U.tl,u_pattern_br:U.br,u_texsize:[Y,te],u_pattern_size:U.displaySize,u_pattern_units_to_pixels:W?[F.transform.width,-1*F.transform.height]:[1/r.ay(X,1,F.transform.tileZoom),1/r.ay(X,1,F.transform.tileZoom)],u_pixel_coord_upper:[oe>>16,he>>16],u_pixel_coord_lower:[65535&oe,65535&he]}}(0,y,b,u,A,C),{u_matrix:d,u_emissive_strength:i,u_opacity:o}),Md=new Float32Array(r.bA([])),Uh=(d,i,o,u,m,y,b,A,C,z,D,U,F,W=[0,0,0],X)=>{const Y=m.style.light,te=Y.properties.get("position"),J=[-te.x,-te.y,te.z],re=r.dL();Y.properties.get("anchor")==="viewport"&&(r.dM(re,-m.transform.angle),r.dN(J,J,re));const oe=D.alphaMode==="MASK",he=Y.properties.get("color").toNonPremultipliedRenderColor(null),ye=F.paint.get("model-ambient-occlusion-intensity"),me=F.paint.get("model-color").constantOr(r.ao.white).toNonPremultipliedRenderColor(null);return me.a=F.paint.get("model-color-mix-intensity").constantOr(0),{u_matrix:d,u_lighting_matrix:i,u_normal_matrix:o,u_node_matrix:u||Md,u_lightpos:J,u_lightintensity:Y.properties.get("intensity"),u_lightcolor:[he.r,he.g,he.b],u_camera_pos:W,u_opacity:y,u_baseTextureIsAlpha:0,u_alphaMask:+oe,u_alphaCutoff:D.alphaCutoff,u_baseColorFactor:b.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:A.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:C,u_roughnessFactor:z,u_baseColorTexture:ts.BaseColor,u_metallicRoughnessTexture:ts.MetallicRoughness,u_normalTexture:ts.Normal,u_occlusionTexture:ts.Occlusion,u_emissionTexture:ts.Emission,u_lutTexture:ts.LUT,u_color_mix:me.toArray01(),u_aoIntensity:ye,u_emissive_strength:U,u_occlusionTextureTransform:X||[0,0,0,0]}},ml=(d,i=Md,o=Md)=>({u_matrix:d,u_instance:i,u_node_matrix:o}),Om={fillExtrusion:d=>({u_matrix:new r.ck(d),u_lightpos:new r.ch(d),u_lightintensity:new r.ci(d),u_lightcolor:new r.ch(d),u_vertical_gradient:new r.ci(d),u_opacity:new r.ci(d),u_edge_radius:new r.ci(d),u_width_scale:new r.ci(d),u_ao:new r.cj(d),u_height_type:new r.cg(d),u_base_type:new r.cg(d),u_tile_id:new r.ch(d),u_zoom_transition:new r.ci(d),u_inv_rot_matrix:new r.ck(d),u_merc_center:new r.cj(d),u_up_dir:new r.ch(d),u_height_lift:new r.ci(d),u_flood_light_color:new r.ch(d),u_vertical_scale:new r.ci(d),u_flood_light_intensity:new r.ci(d),u_ground_shadow_factor:new r.ch(d)}),fillExtrusionDepth:d=>({u_matrix:new r.ck(d),u_edge_radius:new r.ci(d),u_width_scale:new r.ci(d),u_vertical_scale:new r.ci(d),u_height_type:new r.cg(d),u_base_type:new r.cg(d)}),fillExtrusionPattern:d=>({u_matrix:new r.ck(d),u_lightpos:new r.ch(d),u_lightintensity:new r.ci(d),u_lightcolor:new r.ch(d),u_vertical_gradient:new r.ci(d),u_height_factor:new r.ci(d),u_edge_radius:new r.ci(d),u_width_scale:new r.ci(d),u_ao:new r.cj(d),u_height_type:new r.cg(d),u_base_type:new r.cg(d),u_tile_id:new r.ch(d),u_zoom_transition:new r.ci(d),u_inv_rot_matrix:new r.ck(d),u_merc_center:new r.cj(d),u_up_dir:new r.ch(d),u_height_lift:new r.ci(d),u_image:new r.cg(d),u_texsize:new r.cj(d),u_pixel_coord_upper:new r.cj(d),u_pixel_coord_lower:new r.cj(d),u_tile_units_to_pixels:new r.ci(d),u_opacity:new r.ci(d),u_pattern_transition:new r.ci(d)}),fillExtrusionGroundEffect:d=>({u_matrix:new r.ck(d),u_opacity:new r.ci(d),u_ao_pass:new r.ci(d),u_meter_to_tile:new r.ci(d),u_ao:new r.cj(d),u_flood_light_intensity:new r.ci(d),u_flood_light_color:new r.ch(d),u_attenuation:new r.ci(d),u_edge_radius:new r.ci(d),u_fb:new r.cg(d),u_fb_size:new r.ci(d),u_dynamic_offset:new r.ci(d)}),fill:d=>({u_matrix:new r.ck(d),u_emissive_strength:new r.ci(d),u_ground_shadow_factor:new r.ch(d)}),fillPattern:d=>({u_matrix:new r.ck(d),u_emissive_strength:new r.ci(d),u_image:new r.cg(d),u_texsize:new r.cj(d),u_pixel_coord_upper:new r.cj(d),u_pixel_coord_lower:new r.cj(d),u_tile_units_to_pixels:new r.ci(d),u_ground_shadow_factor:new r.ch(d),u_pattern_transition:new r.ci(d)}),fillOutline:d=>({u_matrix:new r.ck(d),u_emissive_strength:new r.ci(d),u_world:new r.cj(d),u_ground_shadow_factor:new r.ch(d)}),fillOutlinePattern:d=>({u_matrix:new r.ck(d),u_emissive_strength:new r.ci(d),u_world:new r.cj(d),u_image:new r.cg(d),u_texsize:new r.cj(d),u_pixel_coord_upper:new r.cj(d),u_pixel_coord_lower:new r.cj(d),u_tile_units_to_pixels:new r.ci(d),u_ground_shadow_factor:new r.ch(d),u_pattern_transition:new r.ci(d)}),building:d=>({u_matrix:new r.ck(d),u_normal_matrix:new r.ck(d),u_opacity:new r.ci(d),u_faux_facade_ao_intensity:new r.ci(d),u_camera_pos:new r.ch(d),u_tile_to_meter:new r.ci(d),u_facade_emissive_chance:new r.ci(d)}),buildingBloom:d=>({u_matrix:new r.ck(d)}),buildingDepth:d=>({u_matrix:new r.ck(d)}),elevatedStructuresDepth:d=>({u_matrix:new r.ck(d),u_depth_bias:new r.ci(d)}),elevatedStructures:d=>({u_matrix:new r.ck(d),u_ground_shadow_factor:new r.ch(d)}),elevatedStructuresDepthReconstruct:d=>({u_matrix:new r.ck(d),u_camera_pos:new r.ch(d),u_depth_bias:new r.ci(d),u_height_scale:new r.ci(d),u_reset_depth:new r.ci(d)}),circle:r.dV,collisionBox:d=>({u_matrix:new r.ck(d),u_inv_rot_matrix:new r.ck(d),u_camera_to_center_distance:new r.ci(d),u_extrude_scale:new r.cj(d),u_zoom_transition:new r.ci(d),u_merc_center:new r.cj(d),u_tile_id:new r.ch(d)}),collisionCircle:d=>({u_matrix:new r.ck(d),u_inv_matrix:new r.ck(d),u_camera_to_center_distance:new r.ci(d),u_viewport_size:new r.cj(d)}),debug:d=>({u_color:new r.dx(d),u_matrix:new r.ck(d),u_overlay:new r.cg(d),u_overlay_scale:new r.ci(d)}),clippingMask:d=>({u_matrix:new r.ck(d)}),heatmap:d=>({u_extrude_scale:new r.ci(d),u_intensity:new r.ci(d),u_matrix:new r.ck(d),u_inv_rot_matrix:new r.ck(d),u_merc_center:new r.cj(d),u_tile_id:new r.ch(d),u_zoom_transition:new r.ci(d),u_up_dir:new r.ch(d)}),heatmapTexture:d=>({u_image:new r.cg(d),u_color_ramp:new r.cg(d),u_opacity:new r.ci(d)}),hillshade:d=>({u_matrix:new r.ck(d),u_image:new r.cg(d),u_latrange:new r.cj(d),u_light:new r.cj(d),u_shadow:new r.dx(d),u_highlight:new r.dx(d),u_emissive_strength:new r.ci(d),u_accent:new r.dx(d)}),hillshadePrepare:d=>({u_matrix:new r.ck(d),u_image:new r.cg(d),u_dimension:new r.cj(d),u_zoom:new r.ci(d)}),line:r.dU,linePattern:r.dT,raster:d=>({u_matrix:new r.ck(d),u_normalize_matrix:new r.ck(d),u_globe_matrix:new r.ck(d),u_merc_matrix:new r.ck(d),u_grid_matrix:new r.dy(d),u_tl_parent:new r.cj(d),u_scale_parent:new r.ci(d),u_fade_t:new r.ci(d),u_opacity:new r.ci(d),u_image0:new r.cg(d),u_image1:new r.cg(d),u_brightness_low:new r.ci(d),u_brightness_high:new r.ci(d),u_saturation_factor:new r.ci(d),u_contrast_factor:new r.ci(d),u_spin_weights:new r.ch(d),u_perspective_transform:new r.cj(d),u_raster_elevation:new r.ci(d),u_zoom_transition:new r.ci(d),u_merc_center:new r.cj(d),u_cutoff_params:new r.d2(d),u_colorization_mix:new r.d2(d),u_colorization_offset:new r.ci(d),u_color_ramp:new r.cg(d),u_texture_offset:new r.cj(d),u_texture_res:new r.cj(d),u_emissive_strength:new r.ci(d)}),rasterParticle:d=>({u_matrix:new r.ck(d),u_normalize_matrix:new r.ck(d),u_globe_matrix:new r.ck(d),u_merc_matrix:new r.ck(d),u_grid_matrix:new r.dy(d),u_tl_parent:new r.cj(d),u_scale_parent:new r.ci(d),u_fade_t:new r.ci(d),u_opacity:new r.ci(d),u_image0:new r.cg(d),u_image1:new r.cg(d),u_raster_elevation:new r.ci(d),u_zoom_transition:new r.ci(d),u_merc_center:new r.cj(d),u_cutoff_params:new r.d2(d)}),rasterParticleTexture:d=>({u_texture:new r.cg(d),u_opacity:new r.ci(d)}),rasterParticleDraw:d=>({u_particle_texture:new r.cg(d),u_particle_texture_side_len:new r.ci(d),u_tile_offset:new r.cj(d),u_velocity:new r.cg(d),u_color_ramp:new r.cg(d),u_velocity_res:new r.cj(d),u_max_speed:new r.ci(d),u_uv_offset:new r.cj(d),u_data_scale:new r.cj(d),u_data_offset:new r.ci(d),u_particle_pos_scale:new r.ci(d),u_particle_pos_offset:new r.cj(d)}),rasterParticleUpdate:d=>({u_particle_texture:new r.cg(d),u_particle_texture_side_len:new r.ci(d),u_velocity:new r.cg(d),u_velocity_res:new r.cj(d),u_max_speed:new r.ci(d),u_speed_factor:new r.ci(d),u_reset_rate:new r.ci(d),u_rand_seed:new r.ci(d),u_uv_offset:new r.cj(d),u_data_scale:new r.cj(d),u_data_offset:new r.ci(d),u_particle_pos_scale:new r.ci(d),u_particle_pos_offset:new r.cj(d)}),symbol:d=>({u_is_size_zoom_constant:new r.cg(d),u_is_size_feature_constant:new r.cg(d),u_size_t:new r.ci(d),u_size:new r.ci(d),u_camera_to_center_distance:new r.ci(d),u_rotate_symbol:new r.cg(d),u_aspect_ratio:new r.ci(d),u_fade_change:new r.ci(d),u_matrix:new r.ck(d),u_label_plane_matrix:new r.ck(d),u_coord_matrix:new r.ck(d),u_is_text:new r.cg(d),u_elevation_from_sea:new r.cg(d),u_pitch_with_map:new r.cg(d),u_texsize:new r.cj(d),u_texsize_icon:new r.cj(d),u_texture:new r.cg(d),u_texture_icon:new r.cg(d),u_gamma_scale:new r.ci(d),u_device_pixel_ratio:new r.ci(d),u_tile_id:new r.ch(d),u_zoom_transition:new r.ci(d),u_inv_rot_matrix:new r.ck(d),u_merc_center:new r.cj(d),u_camera_forward:new r.ch(d),u_tile_matrix:new r.ck(d),u_up_vector:new r.ch(d),u_ecef_origin:new r.ch(d),u_is_halo:new r.cg(d),u_icon_transition:new r.ci(d),u_color_adj_mat:new r.ck(d),u_scale_factor:new r.ci(d),u_ground_shadow_factor:new r.ch(d),u_inv_matrix:new r.ck(d),u_normal_scale:new r.ci(d),u_lutTexture:new r.cg(d)}),background:d=>({u_matrix:new r.ck(d),u_emissive_strength:new r.ci(d),u_opacity:new r.ci(d),u_color:new r.dx(d)}),backgroundPattern:d=>({u_matrix:new r.ck(d),u_emissive_strength:new r.ci(d),u_opacity:new r.ci(d),u_image:new r.cg(d),u_pattern_tl:new r.cj(d),u_pattern_br:new r.cj(d),u_texsize:new r.cj(d),u_pattern_size:new r.cj(d),u_pixel_coord_upper:new r.cj(d),u_pixel_coord_lower:new r.cj(d),u_pattern_units_to_pixels:new r.cj(d)}),terrainRaster:d=>({u_matrix:new r.ck(d),u_image0:new r.cg(d),u_skirt_height:new r.ci(d),u_ground_shadow_factor:new r.ch(d)}),skybox:d=>({u_matrix:new r.ck(d),u_sun_direction:new r.ch(d),u_cubemap:new r.cg(d),u_opacity:new r.ci(d),u_temporal_offset:new r.ci(d)}),skyboxGradient:d=>({u_matrix:new r.ck(d),u_color_ramp:new r.cg(d),u_center_direction:new r.ch(d),u_radius:new r.ci(d),u_opacity:new r.ci(d),u_temporal_offset:new r.ci(d)}),skyboxCapture:d=>({u_matrix_3f:new r.dy(d),u_sun_direction:new r.ch(d),u_sun_intensity:new r.ci(d),u_color_tint_r:new r.d2(d),u_color_tint_m:new r.d2(d),u_luminance:new r.ci(d)}),globeRaster:d=>({u_proj_matrix:new r.ck(d),u_globe_matrix:new r.ck(d),u_normalize_matrix:new r.ck(d),u_merc_matrix:new r.ck(d),u_zoom_transition:new r.ci(d),u_merc_center:new r.cj(d),u_image0:new r.cg(d),u_grid_matrix:new r.dy(d),u_skirt_height:new r.ci(d),u_far_z_cutoff:new r.ci(d),u_frustum_tl:new r.ch(d),u_frustum_tr:new r.ch(d),u_frustum_br:new r.ch(d),u_frustum_bl:new r.ch(d),u_globe_pos:new r.ch(d),u_globe_radius:new r.ci(d),u_viewport:new r.cj(d)}),globeAtmosphere:d=>({u_frustum_tl:new r.ch(d),u_frustum_tr:new r.ch(d),u_frustum_br:new r.ch(d),u_frustum_bl:new r.ch(d),u_horizon:new r.ci(d),u_transition:new r.ci(d),u_fadeout_range:new r.ci(d),u_atmosphere_fog_color:new r.d2(d),u_high_color:new r.d2(d),u_space_color:new r.d2(d),u_temporal_offset:new r.ci(d),u_horizon_angle:new r.ci(d)}),model:d=>({u_matrix:new r.ck(d),u_lighting_matrix:new r.ck(d),u_normal_matrix:new r.ck(d),u_node_matrix:new r.ck(d),u_lightpos:new r.ch(d),u_lightintensity:new r.ci(d),u_lightcolor:new r.ch(d),u_camera_pos:new r.ch(d),u_opacity:new r.ci(d),u_baseColorFactor:new r.d2(d),u_emissiveFactor:new r.d2(d),u_metallicFactor:new r.ci(d),u_roughnessFactor:new r.ci(d),u_baseTextureIsAlpha:new r.cg(d),u_alphaMask:new r.cg(d),u_alphaCutoff:new r.ci(d),u_baseColorTexture:new r.cg(d),u_metallicRoughnessTexture:new r.cg(d),u_normalTexture:new r.cg(d),u_occlusionTexture:new r.cg(d),u_emissionTexture:new r.cg(d),u_lutTexture:new r.cg(d),u_color_mix:new r.d2(d),u_aoIntensity:new r.ci(d),u_emissive_strength:new r.ci(d),u_occlusionTextureTransform:new r.d2(d)}),modelDepth:d=>({u_matrix:new r.ck(d),u_instance:new r.ck(d),u_node_matrix:new r.ck(d)}),groundShadow:d=>({u_matrix:new r.ck(d),u_ground_shadow_factor:new r.ch(d)}),stars:d=>({u_matrix:new r.ck(d),u_up:new r.ch(d),u_right:new r.ch(d),u_intensity_multiplier:new r.ci(d)}),snowParticle:d=>({u_modelview:new r.ck(d),u_projection:new r.ck(d),u_time:new r.ci(d),u_cam_pos:new r.ch(d),u_velocityConeAperture:new r.ci(d),u_velocity:new r.ci(d),u_horizontalOscillationRadius:new r.ci(d),u_horizontalOscillationRate:new r.ci(d),u_boxSize:new r.ci(d),u_billboardSize:new r.ci(d),u_simpleShapeParameters:new r.cj(d),u_screenSize:new r.cj(d),u_thinningCenterPos:new r.cj(d),u_thinningShape:new r.ch(d),u_thinningAffectedRatio:new r.ci(d),u_thinningParticleOffset:new r.ci(d),u_particleColor:new r.d2(d),u_direction:new r.ch(d)}),rainParticle:d=>({u_modelview:new r.ck(d),u_projection:new r.ck(d),u_time:new r.ci(d),u_cam_pos:new r.ch(d),u_texScreen:new r.cg(d),u_velocityConeAperture:new r.ci(d),u_velocity:new r.ci(d),u_boxSize:new r.ci(d),u_rainDropletSize:new r.cj(d),u_distortionStrength:new r.ci(d),u_rainDirection:new r.ch(d),u_color:new r.d2(d),u_screenSize:new r.cj(d),u_thinningCenterPos:new r.cj(d),u_thinningShape:new r.ch(d),u_thinningAffectedRatio:new r.ci(d),u_thinningParticleOffset:new r.ci(d),u_shapeDirectionalPower:new r.ci(d),u_shapeNormalPower:new r.ci(d),u_mode:new r.ci(d)}),vignette:d=>({u_vignetteShape:new r.ch(d),u_vignetteColor:new r.d2(d)}),occlusion:d=>({u_matrix:new r.ck(d),u_anchorPos:new r.ch(d),u_screenSizePx:new r.cj(d),u_occluderSizePx:new r.cj(d),u_color:new r.d2(d)})};class $a{constructor(i,o,u,m){this.id=$a.uniqueIdxCounter,$a.uniqueIdxCounter++,this.context=i;const y=i.gl;this.buffer=y.createBuffer(),this.dynamicDraw=!!u,this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),y.bufferData(y.ELEMENT_ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||m||o.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(i){this.id=$a.uniqueIdxCounter,$a.uniqueIdxCounter++;const o=this.context.gl;this.context.unbindVAO(),this.bind(),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}$a.uniqueIdxCounter=0;const Ip={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Fm{constructor(i,o,u,m,y,b){this.length=o.length,this.attributes=u,this.itemSize=o.bytesPerElement,this.dynamicDraw=m,this.instanceCount=b,this.context=i;const A=i.gl;this.buffer=A.createBuffer(),i.bindVertexBuffer.set(this.buffer),A.bufferData(A.ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?A.DYNAMIC_DRAW:A.STATIC_DRAW),this.dynamicDraw||y||o.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(i){const o=this.context.gl;this.bind(),o.bufferSubData(o.ARRAY_BUFFER,0,i.arrayBuffer)}enableAttributes(i,o){for(let u=0;u<this.attributes.length;u++){const m=o.getAttributeLocation(i,this.attributes[u].name);m!==-1&&i.enableVertexAttribArray(m)}}setVertexAttribPointers(i,o,u){for(let m=0;m<this.attributes.length;m++){const y=this.attributes[m],b=o.getAttributeLocation(i,y.name);b!==-1&&i.vertexAttribPointer(b,y.components,i[Ip[y.type]],!1,this.itemSize,y.offset+this.itemSize*(u||0))}}setVertexAttribDivisor(i,o,u){for(let m=0;m<this.attributes.length;m++){const y=o.getAttributeLocation(i,this.attributes[m].name);y!==-1&&this.instanceCount&&this.instanceCount>0&&i.vertexAttribDivisor(y,u)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class jh{constructor(i,o,u,m,y){this.context=i,this.width=o,this.height=u;const b=this.framebuffer=i.gl.createFramebuffer();m&&(this.colorAttachment=new Sp(i,b)),y&&(this.depthAttachmentType=y,this.depthAttachment=y==="renderbuffer"?new Ap(i,b):new Im(i,b))}destroy(){const i=this.context.gl;if(this.colorAttachment){const o=this.colorAttachment.get();o&&i.deleteTexture(o)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const o=this.depthAttachment.get();o&&i.deleteRenderbuffer(o)}else{const o=this.depthAttachment.get();o&&i.deleteTexture(o)}i.deleteFramebuffer(this.framebuffer)}}class Pd{constructor(i,o){this.gl=i,this.clearColor=new gp(this),this.clearDepth=new cd(this),this.clearStencil=new wm(this),this.colorMask=new Sm(this),this.depthMask=new Am(this),this.stencilMask=new Tm(this),this.stencilFunc=new mp(this),this.stencilOp=new Em(this),this.stencilTest=new Ah(this),this.depthRange=new Cm(this),this.depthTest=new _p(this),this.depthFunc=new hd(this),this.blend=new Th(this),this.blendFunc=new ud(this),this.blendColor=new Ao(this),this.blendEquation=new ul(this),this.cullFace=new Eh(this),this.cullFaceSide=new Ch(this),this.frontFace=new dl(this),this.program=new yp(this),this.activeTexture=new dd(this),this.viewport=new xp(this),this.bindFramebuffer=new fl(this),this.bindRenderbuffer=new Ih(this),this.bindTexture=new kh(this),this.bindVertexBuffer=new fd(this),this.bindElementBuffer=new Mh(this),this.bindVertexArrayOES=new _c(this),this.pixelStoreUnpack=new vp(this),this.pixelStoreUnpackPremultiplyAlpha=new bp(this),this.pixelStoreUnpackFlipY=new wp(this),this.options=o?Object.assign({},o):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=i.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=i.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=i.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=o&&!!o.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=i.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=i.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=i.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),this.maxPointSize=i.getParameter(i.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(i,o,u){return new $a(this,i,o,u)}createVertexBuffer(i,o,u,m,y){return new Fm(this,i,o,u,m,y)}createRenderbuffer(i,o,u){const m=this.gl,y=m.createRenderbuffer();return this.bindRenderbuffer.set(y),m.renderbufferStorage(m.RENDERBUFFER,i,o,u),this.bindRenderbuffer.set(null),y}createFramebuffer(i,o,u,m){return new jh(this,i,o,u,m)}clear({color:i,depth:o,stencil:u,colorMask:m}){const y=this.gl;let b=0;i&&(b|=y.COLOR_BUFFER_BIT,this.clearColor.set(i.toNonPremultipliedRenderColor(null)),this.colorMask.set(m||[!0,!0,!0,!0])),o!==void 0&&(b|=y.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(o),this.depthMask.set(!0)),u!==void 0&&(b|=y.STENCIL_BUFFER_BIT,this.clearStencil.set(u),this.stencilMask.set(255)),y.clear(b)}setCullFace(i){i.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))}setDepthMode(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)}setStencilMode(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)}setColorMode(i){r.by(i.blendFunction,bi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor),i.blendEquation?this.blendEquation.set(i.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(i.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let ta;function bc(d,i,o,u,m,y,b){const A=d.context,C=A.gl,z=d.transform,D=[r.aF(z.center.lng),r.aJ(z.center.lat)],U=o.layout.get("symbol-placement"),F=o.layout.get("text-variable-anchor"),W=o.layout.get("icon-rotation-alignment")==="map",X=o.layout.get("text-rotation-alignment")==="map",Y=U!=="point",te=[];let J=0,re=0;for(let ge=0;ge<u.length;ge++){const Ae=u[ge],je=i.getTile(Ae),Re=je.getBucket(o);if(!Re)continue;const Je=Re.getProjection().createInversionMatrix(z,Ae.canonical),Ne=[],$e=np(Ae,Re,z),vt=!b&&W&&Y,Ve=b&&X&&Y,Pe=F&&Re.hasTextData(),Qe=Re.hasIconTextFit()&&Pe&&Re.hasIconData(),We=vt||Ve||b&&Pe||Qe,at=Re.projection.name==="globe",xt=at?r.aj(z.zoom):0;at&&(Ne.push("PROJECTION_GLOBE_VIEW"),We&&Ne.push("PROJECTED_POS_ON_VIEWPORT"));const Pt=d.getOrCreateProgram("collisionBox",{defines:Ne});let pt=$e;m[0]===0&&m[1]===0||(pt=d.translatePosMatrix($e,je,m,y));const ht=b?Re.textCollisionBox:Re.iconCollisionBox,Wt=Re.collisionCircleArray;if(Wt.length>0){const Ht=r.bC(),Vt=pt;r.cO(Ht,Re.placementInvProjMatrix,z.glCoordMatrix),r.cO(Ht,Ht,Re.placementViewportMatrix),te.push({circleArray:Wt,circleOffset:re,transform:Vt,invTransform:Ht,projection:Re.getProjection()}),J+=Wt.length/4,re=J}if(!ht)continue;d.terrain&&d.terrain.setupElevationDraw(je,Pt);const Ut=at?[Ae.canonical.x,Ae.canonical.y,1<<Ae.canonical.z]:[0,0,0];Pt.draw(d,C.LINES,Rt.disabled,ii.disabled,d.colorModeForRenderPass(),ai.disabled,Sd(pt,Je,z,xt,D,je,Ut,Re.getProjection()),o.id,ht.layoutVertexBuffer,ht.indexBuffer,ht.segments,null,z.zoom,null,[ht.collisionVertexBuffer,ht.collisionVertexBufferExt])}if(!b||!te.length)return;const oe=d.getOrCreateProgram("collisionCircle"),he=new r.dW;he.resize(4*J),he._trim();let ye=0;for(const ge of te)for(let Ae=0;Ae<ge.circleArray.length/4;Ae++){const je=4*Ae,Re=ge.circleArray[je+0],Je=ge.circleArray[je+1],Ne=ge.circleArray[je+2],$e=ge.circleArray[je+3];he.emplace(ye++,Re,Je,Ne,$e,0),he.emplace(ye++,Re,Je,Ne,$e,1),he.emplace(ye++,Re,Je,Ne,$e,2),he.emplace(ye++,Re,Je,Ne,$e,3)}(!ta||ta.length<2*J)&&(ta=function(ge){const Ae=2*ge,je=new r.b1;je.resize(Ae),je._trim();for(let Re=0;Re<Ae;Re++){const Je=6*Re;je.uint16[Je+0]=4*Re+0,je.uint16[Je+1]=4*Re+1,je.uint16[Je+2]=4*Re+2,je.uint16[Je+3]=4*Re+2,je.uint16[Je+4]=4*Re+3,je.uint16[Je+5]=4*Re+0}return je}(J));const me=A.createIndexBuffer(ta,!0),xe=A.createVertexBuffer(he,r.dX.members,!0);for(const ge of te){const Ae={u_matrix:ge.transform,u_inv_matrix:ge.invTransform,u_camera_to_center_distance:(_e=z).getCameraToCenterDistance(ge.projection),u_viewport_size:[_e.width,_e.height]};oe.draw(d,C.TRIANGLES,Rt.disabled,ii.disabled,d.colorModeForRenderPass(),ai.disabled,Ae,o.id,xe,me,r.bg.simpleSegment(0,2*ge.circleOffset,ge.circleArray.length,ge.circleArray.length/2),null,z.zoom)}var _e;xe.destroy(),me.destroy()}const Ja=r.bC();function Ld(d){const i=d._camera.getWorldToCamera(d.worldSize,1),o=r.aB([],i,d.globeMatrix);r.bl(o,o);const u=[0,0,0],m=[0,1,0,0];return r.aC(m,m,o),u[0]=m[0],u[1]=m[1],u[2]=m[2],r.aw(u,u),u}function Hh({width:d,height:i,anchor:o,textOffset:u,textScale:m},y){const{horizontalAlign:b,verticalAlign:A}=r.c0(o),C=-(b-.5)*d,z=-(A-.5)*i,D=r.c1(o,u);return new r.P((C/m+D[0])*y,(z/m+D[1])*y)}function Wh(d,i,o,u,m,y,b,A,C,z){const D=d.text.placedSymbolArray,U=d.text.dynamicLayoutVertexArray,F=d.icon.dynamicLayoutVertexArray,W={},X=d.getProjection(),Y=yo(b,X,m),te=m.elevation,J=X.upVectorScale(b.canonical,m.center.lat,m.worldSize).metersToTile;U.clear();for(let re=0;re<D.length;re++){const oe=D.get(re),{tileAnchorX:he,tileAnchorY:ye,numGlyphs:me}=oe,xe=oe.hidden||!oe.crossTileID||d.allowVerticalPlacement&&!oe.placedOrientation?null:u[oe.crossTileID];if(xe){let _e=0,ge=0,Ae=0;if(te){const Qe=te?te.getAtTileOffset(b,he,ye):0,[We,at,xt]=X.upVector(b.canonical,he,ye);_e=Qe*We*J,ge=Qe*at*J,Ae=Qe*xt*J}let[je,Re,Je,Ne]=_n(oe.projectedAnchorX+_e,oe.projectedAnchorY+ge,oe.projectedAnchorZ+Ae,o?Y:y);const $e=xo(m.getCameraToCenterDistance(X),Ne);let vt=r.bM(d.textSizeData,C,oe)*$e/r.bX;o&&(vt*=d.tilePixelRatio/A);const Ve=Hh(xe,vt);o?({x:je,y:Re,z:Je}=X.projectTilePoint(he+Ve.x,ye+Ve.y,b.canonical),[je,Re,Je]=_n(je+_e,Re+ge,Je+Ae,y)):(i&&Ve._rotate(-m.angle),je+=Ve.x,Re+=Ve.y,Je=0);const Pe=d.allowVerticalPlacement&&oe.placedOrientation===r.bL.vertical?Math.PI/2:0;for(let Qe=0;Qe<me;Qe++)r.bO(U,je,Re,Je,Pe);z&&oe.associatedIconIndex>=0&&(W[oe.associatedIconIndex]={x:je,y:Re,z:Je,angle:Pe})}else ei(me,U)}if(z){F.clear();const re=d.icon.placedSymbolArray;for(let oe=0;oe<re.length;oe++){const he=re.get(oe),{numGlyphs:ye}=he,me=W[oe];if(he.hidden||!me)ei(ye,F);else{const{x:xe,y:_e,z:ge,angle:Ae}=me;for(let je=0;je<ye;je++)r.bO(F,xe,_e,ge,Ae)}}d.icon.dynamicLayoutVertexBuffer.updateData(F)}d.text.dynamicLayoutVertexBuffer.updateData(U)}function wc(d,i,o,u,m,y,b={}){const A=o.paint.get("icon-translate"),C=o.paint.get("text-translate"),z=o.paint.get("icon-translate-anchor"),D=o.paint.get("text-translate-anchor"),U=o.layout.get("icon-rotation-alignment"),F=o.layout.get("text-rotation-alignment"),W=o.layout.get("icon-pitch-alignment"),X=o.layout.get("text-pitch-alignment"),Y=o.layout.get("icon-keep-upright"),te=o.layout.get("text-keep-upright"),J=o.paint.get("icon-color-saturation"),re=o.paint.get("icon-color-contrast"),oe=o.paint.get("icon-color-brightness-min"),he=o.paint.get("icon-color-brightness-max"),ye=o.layout.get("symbol-elevation-reference")==="sea",me=o.layout.get("icon-image-use-theme")==="none",xe=d.context,_e=xe.gl,ge=d.transform,Ae=U==="map",je=F==="map",Re=W==="map",Je=X==="map",Ne=o.layout.get("symbol-sort-key").constantOr(1)!==void 0;let $e=!1;const vt=d.depthModeForSublayer(0,Rt.ReadOnly),Ve=new Rt(d.context.gl.LEQUAL,Rt.ReadOnly,d.depthRangeFor3D),Pe=[r.aF(ge.center.lng),r.aJ(ge.center.lat)],Qe=o.layout.get("text-variable-anchor"),We=ge.projection.name==="globe",at=[],xt=[0,-1,0];for(const Pt of u){const pt=i.getTile(Pt),ht=pt.getBucket(o);if(!ht||ht.projection.name==="mercator"&&We||ht.fullyClipped)continue;const Wt=ht.projection.name==="globe",Ut=Wt?r.aj(ge.zoom):0,Ht=yo(Pt,ht.getProjection(),ge),Vt=ge.calculatePixelsToTileUnitsMatrix(pt),oi=Qe&&ht.hasTextData(),yi=ht.hasIconTextFit()&&oi&&ht.hasIconData(),wi=ht.getProjection().createInversionMatrix(ge,Pt.canonical),ir=(1<<pt.tileID.canonical.z)*r.al/d.transform.worldSize,hi=Ir=>{let Si=[0,0,0];if(Ir){const ri=d.style.directionalLight,rr=d.style.ambientLight;ri&&rr&&(Si=jn(d.style,ri,rr))}return Si},Gi=Ir=>{ge.depthOcclusionForSymbolsAndCircles&&(o.hasOcclusionOpacityProperties||d.terrain)&&(Ir.push("DEPTH_D24"),Ir.push("DEPTH_OCCLUSION"))},Qi=Ir=>{o.lut&&!me&&(o.lut.texture||(o.lut.texture=new r.dY(d.context,o.lut.image,[o.lut.image.height,o.lut.image.height,o.lut.image.height],xe.gl.RGBA8)),xe.activeTexture.set(xe.gl.TEXTURE0+ts.LUT),o.lut.texture&&o.lut.texture.bind(xe.gl.LINEAR,xe.gl.CLAMP_TO_EDGE),Ir.push("APPLY_LUT_ON_GPU"))},Tr=()=>{const Ir=Ae&&o.layout.get("symbol-placement")!=="point",Si=[];Gi(Si),Qi(Si);const ri=Ir||yi,rr=ht.elevationType==="road",Vr=d.shadowRenderer,Mr=rr&&Re&&!!Vr&&Vr.enabled,is=hi(Mr),Ts=rr&&Re&&!d.terrain?Ve:vt,Sn=o.paint.get("icon-image-cross-fade");d.terrainRenderModeElevated()&&Re&&Si.push("PITCH_WITH_MAP_TERRAIN"),Wt&&(Si.push("PROJECTION_GLOBE_VIEW"),ri&&Si.push("PROJECTED_POS_ON_VIEWPORT")),Sn>0&&ht.hasAnySecondaryIcon&&Si.push("ICON_TRANSITION"),!ht.icon.zOffsetVertexBuffer||rr&&d.terrain||Si.push("Z_OFFSET"),J===0&&re===0&&oe===0&&he===1||Si.push("COLOR_ADJUSTMENT"),ht.sdfIcons&&Si.push("RENDER_SDF"),Mr&&Si.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),rr&&Re&&!d.terrain&&ht.icon.orientationVertexBuffer&&Si.push("ELEVATED_ROADS");const An=ht.icon.programConfigurations.get(o.id),cn=d.getOrCreateProgram("symbol",{config:An,defines:Si}),hn=pt.imageAtlasTexture?pt.imageAtlasTexture.size:[0,0],Ys=ht.iconSizeData,Ln=r.bK(Ys,ge.zoom),Xn=Re||!ge.isOrthographic,Gr=Nn(Ht,pt.tileID.canonical,Re,Ae,ge,ht.getProjection(),Vt),Zr=lh(Ht,pt.tileID.canonical,Re,Ae,ge,ht.getProjection(),Vt),Pr=d.translatePosMatrix(Zr,pt,A,z,!0),us=d.translatePosMatrix(Ht,pt,A,z),vs=ri?Ja:Gr,Qr=Ae&&!Re&&!Ir;let zs=xt;!We&&!ge.mercatorFromTransition||Ae||(zs=Ld(ge));const na=Wt?zs:xt,Ea=o.getColorAdjustmentMatrix(J,re,oe,he),Yn=kd(Ys.kind,Ln,Qr,Re,d,us,vs,Pr,ye,!1,hn,[0,0],0,Pt,Ut,Pe,wi,na,ht.getProjection(),is,ir,Ea,Sn,null),ao=pt.imageAtlasTexture?pt.imageAtlasTexture:null,oo=o.layout.get("icon-size").constantOr(0)!==1||ht.iconsNeedLinear,aa=ht.sdfIcons||d.options.rotating||d.options.zooming||oo||Xn?_e.LINEAR:_e.NEAREST,Il=ht.sdfIcons&&o.paint.get("icon-halo-width").constantOr(1)!==0,Ca=d.terrain&&Re&&Ir?r.bl(r.bC(),Gr):Ja;if(Ir&&ht.icon){const oa=ge.elevation,Ia=oa?oa.getAtTileOffsetFunc(Pt,ge.center.lat,ge.worldSize,ht.getProjection()):null,uu=nc(Ht,pt.tileID.canonical,Re,Ae,ge,ht.getProjection(),Vt);Ju(ht,Ht,d,!1,uu,Zr,Re,Y,Ia,Pt)}return{program:cn,buffers:ht.icon,uniformValues:Yn,atlasTexture:ao,atlasTextureIcon:null,atlasInterpolation:aa,atlasInterpolationIcon:null,isSDF:ht.sdfIcons,hasHalo:Il,depthMode:Ts,tile:pt,renderWithShadows:Mr,labelPlaneMatrixInv:Ca}},xi=()=>{const Ir=je&&o.layout.get("symbol-placement")!=="point",Si=[],ri=Ir||Qe||yi,rr=ht.elevationType==="road",Vr=d.shadowRenderer,Mr=rr&&Je&&!!Vr&&Vr.enabled,is=hi(Mr),Ts=rr&&Je&&!d.terrain?Ve:vt;d.terrainRenderModeElevated()&&Je&&Si.push("PITCH_WITH_MAP_TERRAIN"),Wt&&(Si.push("PROJECTION_GLOBE_VIEW"),ri&&Si.push("PROJECTED_POS_ON_VIEWPORT")),!ht.text.zOffsetVertexBuffer||rr&&d.terrain||Si.push("Z_OFFSET"),ht.iconsInText&&Si.push("RENDER_TEXT_AND_SYMBOL"),Si.push("RENDER_SDF"),Mr&&Si.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),rr&&Je&&!d.terrain&&ht.text.orientationVertexBuffer&&Si.push("ELEVATED_ROADS"),Gi(Si);const Sn=ht.text.programConfigurations.get(o.id),An=d.getOrCreateProgram("symbol",{config:Sn,defines:Si});let cn,hn=[0,0],Ys=null;const Ln=ht.textSizeData;ht.iconsInText&&(hn=pt.imageAtlasTexture?pt.imageAtlasTexture.size:[0,0],Ys=pt.imageAtlasTexture?pt.imageAtlasTexture:null,cn=Je||!ge.isOrthographic||d.options.rotating||d.options.zooming||Ln.kind==="composite"||Ln.kind==="camera"?_e.LINEAR:_e.NEAREST);const Xn=pt.glyphAtlasTexture?pt.glyphAtlasTexture.size:[0,0],Gr=o.layout.get("text-size-scale-range"),Zr=r.aA(d.scaleFactor,Gr[0],Gr[1]),Pr=r.bK(Ln,ge.zoom,Zr),us=Nn(Ht,pt.tileID.canonical,Je,je,ge,ht.getProjection(),Vt),vs=lh(Ht,pt.tileID.canonical,Je,je,ge,ht.getProjection(),Vt),Qr=d.translatePosMatrix(vs,pt,C,D,!0),zs=d.translatePosMatrix(Ht,pt,C,D),na=ri?Ja:us,Ea=je&&!Je&&!Ir;let Yn=xt;!We&&!ge.mercatorFromTransition||je||(Yn=Ld(ge));const ao=kd(Ln.kind,Pr,Ea,Je,d,zs,na,Qr,ye,!0,Xn,hn,0,Pt,Ut,Pe,wi,Wt?Yn:xt,ht.getProjection(),is,ir,null,null,Zr),oo=pt.glyphAtlasTexture?pt.glyphAtlasTexture:null,aa=_e.LINEAR,Il=o.paint.get("text-halo-width").constantOr(1)!==0,Ca=d.terrain&&Je&&Ir?r.bl(r.bC(),us):Ja;if(Ir&&ht.text){const oa=ge.elevation,Ia=oa?oa.getAtTileOffsetFunc(Pt,ge.center.lat,ge.worldSize,ht.getProjection()):null,uu=nc(Ht,pt.tileID.canonical,Je,je,ge,ht.getProjection(),Vt);Ju(ht,Ht,d,!0,uu,vs,Je,te,Ia,Pt)}return{program:An,buffers:ht.text,uniformValues:ao,atlasTexture:oo,atlasTextureIcon:Ys,atlasInterpolation:aa,atlasInterpolationIcon:cn,isSDF:!0,hasHalo:Il,depthMode:Ts,tile:pt,renderWithShadows:Mr,labelPlaneMatrixInv:Ca}},Zi=ht.icon.segments.get().length,Yi=ht.text.segments.get().length,Ji=Zi&&!b.onlyText?Tr():null,Cr=Yi&&!b.onlyIcons?xi():null,qr=o.paint.get("icon-opacity").constantOr(1),xs=o.paint.get("text-opacity").constantOr(1);if(Ne&&ht.canOverlap){$e=!0;const Ir=qr&&!b.onlyText?ht.icon.segments.get():[],Si=xs&&!b.onlyIcons?ht.text.segments.get():[];for(const ri of Ir)at.push({segments:new r.bg([ri]),sortKey:ri.sortKey,state:Ji});for(const ri of Si)at.push({segments:new r.bg([ri]),sortKey:ri.sortKey,state:Cr})}else b.onlyText||at.push({segments:qr?ht.icon.segments:new r.bg([]),sortKey:0,state:Ji}),b.onlyIcons||at.push({segments:xs?ht.text.segments:new r.bg([]),sortKey:0,state:Cr})}$e&&at.sort((Pt,pt)=>Pt.sortKey-pt.sortKey);for(const Pt of at){const pt=Pt.state;if(pt)if(d.terrain?d.terrain.setupElevationDraw(pt.tile,pt.program,{useDepthForOcclusion:ge.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:pt.labelPlaneMatrixInv}):d.setupDepthForOcclusion(ge.depthOcclusionForSymbolsAndCircles,pt.program),xe.activeTexture.set(_e.TEXTURE0),pt.atlasTexture&&pt.atlasTexture.bind(pt.atlasInterpolation,_e.CLAMP_TO_EDGE,!0),pt.atlasTextureIcon&&(xe.activeTexture.set(_e.TEXTURE1),pt.atlasTextureIcon&&pt.atlasTextureIcon.bind(pt.atlasInterpolationIcon,_e.CLAMP_TO_EDGE,!0)),pt.renderWithShadows&&d.shadowRenderer.setupShadows(pt.tile.tileID.toUnwrapped(),pt.program,"vector-tile"),d.uploadCommonLightUniforms(d.context,pt.program),pt.hasHalo){const ht=pt.uniformValues;ht.u_is_halo=1,Gh(pt.buffers,Pt.segments,o,d,pt.program,pt.depthMode,m,y,ht,2),ht.u_is_halo=0}else{if(pt.isSDF){const ht=pt.uniformValues;pt.hasHalo&&(ht.u_is_halo=1,Gh(pt.buffers,Pt.segments,o,d,pt.program,pt.depthMode,m,y,ht,1)),ht.u_is_halo=0}Gh(pt.buffers,Pt.segments,o,d,pt.program,pt.depthMode,m,y,pt.uniformValues,1)}}}function Gh(d,i,o,u,m,y,b,A,C,z){const D=[d.dynamicLayoutVertexBuffer,d.opacityVertexBuffer,d.iconTransitioningVertexBuffer,d.globeExtVertexBuffer,d.zOffsetVertexBuffer,d.orientationVertexBuffer];m.draw(u,u.context.gl.TRIANGLES,y,b,A,ai.disabled,C,o.id,d.layoutVertexBuffer,d.indexBuffer,i,o.paint,u.transform.zoom,d.programConfigurations.get(o.id),D,z)}function kp(d,i){const o=1<<d.canonical.z,u=(i.x*o-d.canonical.x-d.wrap*o)*r.al,m=(i.y*o-d.canonical.y)*r.al,y=r.e5(i.z,i.y);return r.d4(u,m,y)}function Mo(d,i,o,u,m){if(!o.layout||o.layout.get("fill-elevation-reference")==="none")return;const y=d.context.gl,b=new Rt(d.context.gl.LEQUAL,Rt.ReadWrite,d.depthRangeFor3D),A=new Rt(d.context.gl.GREATER,Rt.ReadWrite,d.depthRangeFor3D),C=function(W){let X=.01;return W.isOrthographic&&(X=r.ak(1e-4,X,r.c$(W.pitch>=ba?1:W.pitch/ba))),2*X}(d.transform),z=d.transform.getFreeCameraOptions().position,D="elevatedStructuresDepthReconstruct",U=d.getOrCreateProgram(D,{defines:["DEPTH_RECONSTRUCTION"]}),F=d.getOrCreateProgram(D);for(const W of u){const X=i.getTile(W),Y=X.getBucket(o);if(!Y)continue;const te=Y.elevatedStructures;if(!te)continue;const J=Y.elevationBufferData.heightRange,re=kp(W.toUnwrapped(),z),oe=d.translatePosMatrix(W.projMatrix,X,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor"));let he,ye,me,xe;if(m==="initialize"){if(!J||J.min>=1||te.depthSegments.segments[0].primitiveLength===0)continue;he=Oh(oe,re,C,1,0),ye=b,me=te.depthSegments,xe=U}else if(m==="reset"){if(!J||J.min>=0||te.maskSegments.segments[0].primitiveLength===0)continue;he=Oh(oe,re,0,0,1),ye=A,me=te.maskSegments,xe=U}else if(m==="geometry"){if(te.depthSegments.segments[0].primitiveLength===0)continue;he=Oh(oe,re,C,1,0),ye=b,me=te.depthSegments,xe=F}xe.draw(d,y.TRIANGLES,ye,ii.disabled,bi.disabled,ai.disabled,he,o.id,te.vertexBuffer,te.indexBuffer,me,o.paint,d.transform.zoom)}}function _l(d,i,o){const{painter:u,sourceCache:m,layer:y,coords:b,colorMode:A,elevationType:C,terrainEnabled:z,pass:D}=d,U=u.context.gl,F=y.paint.get("fill-pattern"),W=y.paint.get("fill-pattern-cross-fade"),X=F.constantOr(null);let Y=C;C!=="road"||i&&!z||(Y="none");const te=Y==="road",J=d.painter.shadowRenderer,re=te&&!!J&&J.enabled,oe=new Rt(u.context.gl.LEQUAL,Rt.ReadOnly,u.depthRangeFor3D);let he=[0,0,0];if(re){const xe=u.style.directionalLight,_e=u.style.ambientLight;xe&&_e&&(he=jn(u.style,xe,_e))}const ye=F&&F.constantOr(1),me=(xe,_e)=>{let ge,Ae,je,Re,Je;_e?(ge=ye&&!y.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",je=U.LINES):(ge=ye?"fillPattern":"fill",je=U.TRIANGLES);for(const Ne of b){const $e=m.getTile(Ne);if(ye&&!$e.patternsLoaded())continue;const vt=$e.getBucket(y);if(!vt)continue;const Ve=i?vt.elevationBufferData:vt.bufferData;if(Ve.isEmpty())continue;u.prepareDrawTile();const Pe=Ve.programConfigurations.get(y.id),Qe=u.isTileAffectedByFog(Ne),We=[],at=[];te&&(We.push("ELEVATED_ROADS"),at.push(Ve.elevatedLayoutVertexBuffer)),re&&We.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),ye&&(u.context.activeTexture.set(U.TEXTURE0),$e.imageAtlasTexture&&$e.imageAtlasTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),Pe.updatePaintBuffers());let xt=!1;if(X&&$e.imageAtlas){const Ut=$e.imageAtlas,Ht=r.e0.from(X),Vt=Ht.getPrimary().scaleSelf(r.o.devicePixelRatio).toString(),oi=Ht.getSecondary(),yi=Ut.patternPositions.get(Vt),wi=oi?Ut.patternPositions.get(oi.scaleSelf(r.o.devicePixelRatio).toString()):null;xt=!!yi&&!!wi,yi&&Pe.setConstantPatternPositions(yi,wi)}W>0&&(xt||Pe.getPatternTransitionVertexBuffer("fill-pattern"))&&We.push("FILL_PATTERN_TRANSITION");const Pt=u.getOrCreateProgram(ge,{config:Pe,overrideFog:Qe,defines:We}),pt=u.translatePosMatrix(Ne.projMatrix,$e,y.paint.get("fill-translate"),y.paint.get("fill-translate-anchor"));re&&J.setupShadows($e.tileID.toUnwrapped(),Pt,"vector-tile");const ht=y.paint.get("fill-emissive-strength");if(_e){Re=Ve.lineIndexBuffer,Je=Ve.lineSegments;const Ut=u.terrain&&u.terrain.renderingToTexture?u.terrain.drapeBufferSize:[U.drawingBufferWidth,U.drawingBufferHeight];Ae=ge==="fillOutlinePattern"&&ye?Lm(pt,ht,u,$e,Ut,he,W):Pm(pt,ht,Ut,he)}else Re=Ve.indexBuffer,Je=Ve.triangleSegments,Ae=ye?Co(pt,ht,u,$e,he,W):bd(pt,ht,he);u.uploadCommonUniforms(u.context,Pt,Ne.toUnwrapped());let Wt=xe;(C==="road"&&!z||C==="offset")&&(Wt=oe),Pt.draw(u,je,Wt,o||u.stencilModeForClipping(Ne),A,ai.disabled,Ae,y.id,Ve.layoutVertexBuffer,Re,Je,y.paint,u.transform.zoom,Pe,at)}};u.renderPass===D&&me(u.depthModeForSublayer(1,u.renderPass==="opaque"?Rt.ReadWrite:Rt.ReadOnly),!1),Y==="none"&&u.renderPass==="translucent"&&y.paint.get("fill-antialias")&&me(u.depthModeForSublayer(y.getPaintProperty("fill-outline-color")?2:0,Rt.ReadOnly),!0)}function Dt(d,i,o,u,m,y,b,A){o.resetLayerRenderingStats(d);const C=d.context,z=C.gl,D=d.transform,U=o.paint.get("fill-extrusion-pattern"),F=o.paint.get("fill-extrusion-pattern-cross-fade"),W=U.constantOr(null),X=U.constantOr(1),Y=o.paint.get("fill-extrusion-opacity"),te=d.style.enable3dLights(),J=o.paint.get(te&&!X?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),re=[o.paint.get("fill-extrusion-ambient-occlusion-intensity"),J],oe=o.layout.get("fill-extrusion-edge-radius"),he=oe>0&&!o.paint.get("fill-extrusion-rounded-roof"),ye=he?0:oe,me=D.projection.name==="globe"?r.e8():0,xe=D.projection.name==="globe",_e=xe?r.aj(D.zoom):0,ge=[r.aF(D.center.lng),r.aJ(D.center.lat)],Ae=o.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",je=o.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(Ae?null:o.lut).toArray01().slice(0,3),Re=o.paint.get("fill-extrusion-flood-light-intensity"),Je=o.paint.get("fill-extrusion-vertical-scale"),Ne=o.paint.get("fill-extrusion-line-width").constantOr(1)!==0,$e=o.paint.get("fill-extrusion-height-alignment"),vt=o.paint.get("fill-extrusion-base-alignment"),Ve=Ga(d,o.paint.get("fill-extrusion-cutoff-fade-range")),Pe=[];let Qe;xe&&Pe.push("PROJECTION_GLOBE_VIEW"),re[0]>0&&Pe.push("FAUX_AO"),he&&Pe.push("ZERO_ROOF_RADIUS"),A&&Pe.push("HAS_CENTROID"),Re>0&&Pe.push("FLOOD_LIGHT"),Ve.shouldRenderCutoff&&Pe.push("RENDER_CUTOFF"),Ne&&Pe.push("RENDER_WALL_MODE");const We=d.renderPass==="shadow",at=d.shadowRenderer,xt=We&&!!at,Pt=We?ai.disabled:ai.backCCW;d.shadowRenderer&&(d.shadowRenderer.useNormalOffset=!0);let pt=[0,0,0];if(at){const Ut=d.style.directionalLight,Ht=d.style.ambientLight;Ut&&Ht&&(pt=jn(d.style,Ut,Ht)),We||(Pe.push("RENDER_SHADOWS","DEPTH_TEXTURE"),at.useNormalOffset&&Pe.push("NORMAL_OFFSET")),Qe=Pe.concat(["SHADOWS_SINGLE_CASCADE"])}const ht=xt?"fillExtrusionDepth":X?"fillExtrusionPattern":"fillExtrusion",Wt=o.getLayerRenderingStats();for(const Ut of u){const Ht=i.getTile(Ut),Vt=Ht.getBucket(o);if(!Vt||Vt.projection.name!==D.projection.name)continue;let oi=!1;at&&(oi=at.getMaxCascadeForTile(Ut.toUnwrapped())===0);const yi=d.isTileAffectedByFog(Ut),wi=Vt.programConfigurations.get(o.id);let ir=!1;if(W&&Ht.imageAtlas){const Yi=Ht.imageAtlas,Ji=r.e0.from(W),Cr=Ji.getPrimary().scaleSelf(r.o.devicePixelRatio).toString(),qr=Ji.getSecondary(),xs=Yi.patternPositions.get(Cr),Ir=qr?Yi.patternPositions.get(qr.scaleSelf(r.o.devicePixelRatio).toString()):null;ir=!!xs&&!!Ir,xs&&wi.setConstantPatternPositions(xs,Ir)}F>0&&(ir||wi.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&Pe.push("FILL_EXTRUSION_PATTERN_TRANSITION");const hi=d.getOrCreateProgram(ht,{config:wi,defines:oi?Qe:Pe,overrideFog:yi});if(d.terrain&&d.terrain.setupElevationDraw(Ht,hi,{useMeterToDem:!0}),!Vt.centroidVertexBuffer){const Yi=hi.getAttributeLocation(z,"a_centroid_pos");Yi!==-1&&z.vertexAttrib2f(Yi,0,0)}!We&&at&&at.setupShadows(Ht.tileID.toUnwrapped(),hi,"vector-tile"),X&&(d.context.activeTexture.set(z.TEXTURE0),Ht.imageAtlasTexture&&Ht.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),wi.updatePaintBuffers());const Gi=o.paint.get("fill-extrusion-vertical-gradient"),Qi=1/Vt.tileToMeter;let Tr;if(We&&at){if(Mp(Ht.tileID,Vt.maxHeight,d))continue;const Yi=at.calculateShadowPassMatrixFromTile(Ht.tileID.toUnwrapped());Tr=vd(Yi,ye,Qi,Je,$e,vt)}else{const Yi=d.translatePosMatrix(Ut.expandedProjMatrix,Ht,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),Ji=D.projection.createInversionMatrix(D,Ut.canonical);Tr=X?Ep(Yi,d,Gi,Y,re,ye,Qi,Ut,Ht,me,$e,vt,_e,ge,Ji,je,Je,F):vc(Yi,d,Gi,Y,re,ye,Qi,Ut,me,$e,vt,_e,ge,Ji,je,Je,Re,pt)}d.uploadCommonUniforms(C,hi,Ut.toUnwrapped(),null,Ve);let xi=Vt.segments;if(D.projection.name==="mercator"&&!We&&(xi=Vt.getVisibleSegments(Ht.tileID,d.terrain,d.transform.getFrustum(0)),!xi.get().length))continue;if(Wt)if(We)for(const Yi of xi.get())Wt.numRenderedVerticesInShadowPass+=Yi.primitiveLength;else for(const Yi of xi.get())Wt.numRenderedVerticesInTransparentPass+=Yi.primitiveLength;const Zi=[];(d.terrain||A)&&Zi.push(Vt.centroidVertexBuffer),xe&&Zi.push(Vt.layoutVertexExtBuffer),Ne&&Zi.push(Vt.wallVertexBuffer),hi.draw(d,C.gl.TRIANGLES,m,y,b,Pt,Tr,o.id,Vt.layoutVertexBuffer,Vt.indexBuffer,xi,o.paint,d.transform.zoom,wi,Zi)}d.shadowRenderer&&(d.shadowRenderer.useNormalOffset=!1)}class zd{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function wa(d,i,o,u,m,y,b,A,C,z,D,U,F,W,X,Y,te,J,re,oe){const he=i.context,ye=he.gl,me=i.transform,xe=i.transform.zoom,_e=[],ge=d.translate,Ae=d.translateAnchor,je=d.edgeRadius,Re=Ga(i,d.cutoffFadeRange);D==="clear"?(_e.push("CLEAR_SUBPASS"),oe&&(_e.push("CLEAR_FROM_TEXTURE"),he.activeTexture.set(ye.TEXTURE0),oe.bind(ye.LINEAR,ye.CLAMP_TO_EDGE))):D==="sdf"&&_e.push("SDF_SUBPASS"),J&&_e.push("HAS_CENTROID"),Re.shouldRenderCutoff&&_e.push("RENDER_CUTOFF");const Je=(Ne,$e,vt,Ve,Pe)=>{const Qe=$e.programConfigurations.get(u.id),We=i.isTileAffectedByFog(Ne),at=i.getOrCreateProgram("fillExtrusionGroundEffect",{config:Qe,defines:_e,overrideFog:We}),xt=((pt,ht,Wt,Ut,Ht,Vt,oi,yi,wi,ir,hi)=>({u_matrix:ht,u_opacity:Wt,u_ao_pass:Ut?1:0,u_meter_to_tile:Ht,u_ao:Vt,u_flood_light_intensity:oi,u_flood_light_color:yi,u_attenuation:wi,u_edge_radius:ir,u_fb:0,u_fb_size:hi,u_dynamic_offset:1}))(0,Ve,U,z,Pe,[F,W*Pe],X,Y,te,xe>=17?0:je*Pe,oe?oe.size[0]:0),Pt=[];J&&Pt.push($e.hiddenByLandmarkVertexBuffer),i.uploadCommonUniforms(he,at,Ne.toUnwrapped(),null,Re),at.draw(i,he.gl.TRIANGLES,y,b,A,C,xt,u.id,$e.vertexBuffer,$e.indexBuffer,vt,u.paint,xe,Qe,Pt)};for(const Ne of m){const $e=o.getTile(Ne),vt=$e.getBucket(u);if(!vt||vt.projection.name!==me.projection.name||!vt.groundEffect||vt.groundEffect&&!vt.groundEffect.hasData())continue;const Ve=vt.groundEffect,Pe=1/vt.tileToMeter;{const Qe=i.translatePosMatrix(Ne.projMatrix,$e,ge,Ae),We=Ve.getDefaultSegment();Je(Ne,Ve,We,Qe,Pe)}if(re)for(let Qe=0;Qe<4;Qe++){const We=r.e6[Qe](Ne),at=o.getTile(We);if(!at)continue;const xt=at.getBucket(u);if(!xt||xt.projection.name!==me.projection.name||!xt.groundEffect||xt.groundEffect&&!xt.groundEffect.hasData())continue;const Pt=xt.groundEffect;let pt,ht;Qe===0?(pt=[-r.al,0,0],ht=1):Qe===1?(pt=[r.al,0,0],ht=0):Qe===2?(pt=[0,-r.al,0],ht=3):(pt=[0,r.al,0],ht=2);const Wt=Pt.regionSegments[ht];if(!Wt)continue;const Ut=new Float32Array(16);r.br(Ut,Ne.projMatrix,pt),Je(Ne,Pt,Wt,i.translatePosMatrix(Ut,$e,ge,Ae),Pe)}}}function Ka(d,i,o,u,m,y,b){u.centroidVertexArray.length===0&&u.createCentroidsBuffer();const A=y?y.findDEMTileFor(o):null;if(!(A&&A.dem||b))return;y&&A&&A.dem&&u.selfDEMTileTimestamp!==A.dem._timestamp&&(u.borderDoneWithNeighborZ=[-1,-1,-1,-1],u.selfDEMTileTimestamp=A.dem._timestamp);const C=J=>new r.P(Math.ceil((J+r.ea)*r.eb),0),z=J=>{const re=i.getSource().minzoom,oe=ye=>{const me=i.getTileByID(ye);if(me&&me.hasData())return me.getBucket(m)},he=[0,-1,1];for(const ye of he){if(J.overscaledZ+ye<re)continue;const me=oe(J.calculateScaledKey(J.overscaledZ+ye));if(me)return me}},D=[0,0,0],U=(J,re)=>(D[0]=Math.min(J.min.y,re.min.y),D[1]=Math.max(J.max.y,re.max.y),D[2]=r.al-re.min.x>J.max.x?re.min.x-r.al:J.max.x,D),F=(J,re)=>(D[0]=Math.min(J.min.x,re.min.x),D[1]=Math.max(J.max.x,re.max.x),D[2]=r.al-re.min.y>J.max.y?re.min.y-r.al:J.max.y,D),W=[(J,re)=>U(J,re),(J,re)=>U(re,J),(J,re)=>F(J,re),(J,re)=>F(re,J)],X=(J,re,oe,he,ye,me,xe)=>{if(!y)return 0;const _e=[[me?oe:J,me?J:oe,0],[me?oe:re,me?re:oe,0]],ge=xe<0?r.al+xe:xe,Ae=[me?ge:(J+re)/2,me?(J+re)/2:ge,0];return oe===0&&xe<0||oe!==0&&xe>0?y.getForTilePoints(ye,[Ae],!0,he):_e.push(Ae),y.getForTilePoints(o,_e,!0,A),Math.max(_e[0][2],_e[1][2],Ae[2])/y.exaggeration()};for(let J=0;J<4;J++){const re=u.borderFeatureIndices[J];if(re.length===0)continue;const oe=r.e6[J](o),he=z(oe);if(!(he&&he instanceof r.e7))continue;const ye=y?y.findDEMTileFor(oe):null;if(!(ye&&ye.dem||b)||(y&&ye&&ye.dem&&u.borderDEMTileTimestamp[J]!==ye.dem._timestamp&&(u.borderDoneWithNeighborZ[J]=-1,u.borderDEMTileTimestamp[J]=ye.dem._timestamp),u.borderDoneWithNeighborZ[J]===he.canonical.z))continue;he.centroidVertexArray.length===0&&he.createCentroidsBuffer();const me=(J<2?1:5)-J,xe=he.borderDoneWithNeighborZ[me]!==u.canonical.z,_e=he.borderFeatureIndices[me];let ge=0;if(u.canonical.z!==he.canonical.z){for(const Ae of re)u.showCentroid(u.featuresOnBorder[Ae]);if(xe)for(const Ae of _e)he.showCentroid(he.featuresOnBorder[Ae]);u.borderDoneWithNeighborZ[J]=he.canonical.z,he.borderDoneWithNeighborZ[me]=u.canonical.z}for(const Ae of re){const je=u.featuresOnBorder[Ae],Re=u.centroidData[je.centroidDataIndex],Je=je.borders[J];let Ne;for(;ge<_e.length;){Ne=he.featuresOnBorder[_e[ge]];const $e=Ne.borders[me];if($e[1]>Je[0]+3||$e[0]>Je[0]-3)break;he.showCentroid(Ne),ge++}if(Ne&&ge<_e.length){const $e=ge;let vt=0;for(;!(Ne.borders[me][0]>Je[1]-3)&&(vt++,++ge!==_e.length);)Ne=he.featuresOnBorder[_e[ge]];Ne=he.featuresOnBorder[_e[$e]];let Ve=!1;if(vt>=1){const We=Ne.borders[me];Math.abs(Je[0]-We[0])<3&&Math.abs(Je[1]-We[1])<3&&(vt=1,Ve=!0,ge=$e+1)}else if(vt===0){u.showCentroid(je);continue}const Pe=he.centroidData[Ne.centroidDataIndex];b&&Ve&&(((Y=Re).flags|(te=Pe).flags)&r.e9?(Y.flags|=r.e9,te.flags|=r.e9):(Y.flags&=~r.e9,te.flags&=~r.e9));const Qe=je.intersectsCount()>1||Ne.intersectsCount()>1;if(vt>1)ge=$e,Re.centroidXY=Pe.centroidXY=new r.P(0,0);else if(ye&&ye.dem&&!Qe){const We=W[J](Re,Pe),at=J%2?r.al-1:0,xt=X(We[0],Math.min(r.al-1,We[1]),at,ye,oe,J<2,We[2]);Re.centroidXY=Pe.centroidXY=C(xt)}else Qe?Re.centroidXY=Pe.centroidXY=new r.P(0,0):(Re.centroidXY=u.encodeBorderCentroid(je),Pe.centroidXY=he.encodeBorderCentroid(Ne));u.writeCentroidToBuffer(Re),he.writeCentroidToBuffer(Pe)}else u.showCentroid(je)}u.borderDoneWithNeighborZ[J]=he.canonical.z,he.borderDoneWithNeighborZ[me]=u.canonical.z}var Y,te;(u.needsCentroidUpdate||!u.centroidVertexBuffer&&u.centroidVertexArray.length!==0)&&u.uploadCentroid(d)}const Qa=[1,0,0],Qt=[0,1,0],Rd=[0,0,1];function Mp(d,i,o){const u=o.transform,m=o.shadowRenderer;if(!m)return!0;const y=d.toUnwrapped(),b=u.tileSize*m._cascades[o.currentShadowCascade].scale;let A=i;if(u.elevation){const Y=u.elevation.getMinMaxForTile(d);Y&&(A+=Y.max)}const C=[...m.shadowDirection];C[2]=-C[2];const z=m.computeSimplifiedTileShadowVolume(y,A,b,C);if(!z)return!1;const D=[Qa,Qt,Rd,C,[C[0],0,C[2]],[0,C[1],C[2]]],U=u.projection.name==="globe",F=u.scaleZoom(b),W=r.cA.fromInvProjectionMatrix(u.invProjMatrix,u.worldSize,F,!U),X=m.getCurrentCascadeFrustum();return W.intersectsPrecise(z.vertices,z.planes,D)===0||X.intersectsPrecise(z.vertices,z.planes,D)===0}function Xh(d){const{painter:i,source:o,layer:u,coords:m}=d;let y=d.defines;const b=i.context,A=i.renderPass==="shadow",C=i.renderPass==="light-beam",z=i.shadowRenderer,D=r.ec(i.transform.center.lat,i.transform.zoom),U=Ga(i,u.paint.get("building-cutoff-fade-range"));U.shouldRenderCutoff&&(y=y.concat("RENDER_CUTOFF"));for(const F of m){const W=o.getTile(F),X=W.getBucket(u);if(!X)continue;z&&z.getMaxCascadeForTile(F.toUnwrapped())===0&&(y=y.concat("SHADOWS_SINGLE_CASCADE"));const Y=X.programConfigurations.get(u.id);let te,J,re,oe=i.translatePosMatrix(F.expandedProjMatrix,W,[0,0],"map");if(oe=r.cR(r.bC(),oe,[1,1,d.verticalScale]),A&&z){if(Mp(W.tileID,X.maxHeight*D,i))continue;let ye=z.calculateShadowPassMatrixFromTile(W.tileID.toUnwrapped());ye=r.cR(r.bC(),ye,[1,1,d.verticalScale]),re=wd(ye),te=J=i.getOrCreateProgram("buildingDepth",{config:Y,defines:y,overrideFog:!1})}else if(C)te=J=i.getOrCreateProgram("buildingBloom",{config:Y,defines:y,overrideFog:!1}),re=Dm(oe);else{const ye=i.transform.calculatePosMatrix(F.toUnwrapped(),i.transform.worldSize);r.cR(ye,ye,[1,1,d.verticalScale]);const me=r.bC();r.cR(me,ye,[1,-1,1/D]),r.bl(me,me),r.ed(me,me);const xe=i.transform.getFreeCameraOptions().position,_e=1<<F.canonical.z;re=Rm(oe,me,d.opacity,d.facadeAOIntensity,[((xe.x-F.wrap)*_e-F.canonical.x)*r.al,(xe.y*_e-F.canonical.y)*r.al,xe.z*_e*r.al],X.tileToMeter,d.facadeEmissiveChance),J=i.getOrCreateProgram("building",{config:Y,defines:y,overrideFog:!1});const ge=y.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);te=i.getOrCreateProgram("building",{config:Y,defines:ge,overrideFog:!1}),z&&(z.setupShadowsFromMatrix(ye,J,!0),z.setupShadowsFromMatrix(ye,te,!0))}const he=(ye,me)=>{if(C){const xe=ye.entranceBloom;me.draw(i,b.gl.TRIANGLES,d.depthMode,ii.disabled,d.blendMode,ai.disabled,re,u.id,xe.layoutVertexBuffer,xe.indexBuffer,xe.segmentsBucket,u.paint,i.transform.zoom,Y,[xe.layoutAttenuationBuffer,xe.layoutColorBuffer])}else{const xe=ye.segmentsBucket;let _e=[ye.layoutNormalBuffer,ye.layoutCentroidBuffer,ye.layoutColorBuffer];ye.layoutFacadePaintBuffer&&(_e=_e.concat([ye.layoutFacadeDataBuffer,ye.layoutFacadeVerticalRangeBuffer,ye.layoutFacadePaintBuffer])),me.draw(i,b.gl.TRIANGLES,d.depthMode,ii.disabled,d.blendMode,A?ai.disabled:ai.backCW,re,u.id,ye.layoutVertexBuffer,ye.indexBuffer,xe,u.paint,i.transform.zoom,Y,_e)}};i.uploadCommonUniforms(b,J,F.toUnwrapped(),null,U),X.buildingWithoutFacade&&he(X.buildingWithoutFacade,J),te!==J&&i.uploadCommonUniforms(b,te,F.toUnwrapped(),null,U),X.buildingWithFacade&&he(X.buildingWithFacade,te)}}function Yh(d){return[d[0]*r.ee,d[1]*r.ee,d[2]*r.ee,0]}function qh(d,i,o,u,m,y,b,A,C){const z=u.getSource(),D=o.globeSharedBuffers;if(!D)return;let U,F,W;if(i&&(U=u.getTile(i)),z instanceof r.aS?(F=z.texture,W=r.dG(0,0,o.transform)):U&&i&&(F=U.texture,W=r.dG(i.canonical.z,i.canonical.x,o.transform)),!F||!W)return;d||(W=r.cR(r.bC(),W,[1,-1,1]));const X=o.context,Y=X.gl,te=m.paint.get("raster-resampling")==="nearest"?Y.NEAREST:Y.LINEAR,J=o.colorModeForDrapableLayerRenderPass(y),re=b.defines;re.push("GLOBE_POLES");const oe=new Rt(Y.LEQUAL,Rt.ReadWrite,o.depthRangeFor3D),he=Float32Array.from(o.transform.expandedFarZProjMatrix),ye=Float32Array.from(r.bk(r.dF(new r.cC(0,0,0))));o.terrain&&o.terrain.prepareDrawTile(),X.activeTexture.set(Y.TEXTURE0),F.bind(te,Y.CLAMP_TO_EDGE),X.activeTexture.set(Y.TEXTURE1),F.bind(te,Y.CLAMP_TO_EDGE),"useMipmap"in F&&X.extTextureFilterAnisotropic&&o.transform.pitch>20&&Y.texParameterf(Y.TEXTURE_2D,X.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,X.extTextureFilterAnisotropicMax);const[me,xe,_e,ge]=i?D.getPoleBuffers(i.canonical.z,!1):D.getPoleBuffers(0,!0),Ae=m.paint.get("raster-elevation");let je;d?(je=me,o.renderDefaultNorthPole=Ae!==0):(je=xe,o.renderDefaultSouthPole=Ae!==0);const Re=Yh(b.mix),Je=(($e,vt,Ve,Pe,Qe,We,at,xt,Pt,pt,ht,Wt,Ut)=>Fh($e,vt,Ve,new Float32Array(16),new Float32Array(9),[0,0],Pe,[0,0],[0,0,0,0],1,{opacity:1,mix:0},We,[0,0],xt,2,pt,ht,Wt,1,0,Ut))(he,ye,W,r.aj(o.transform.zoom),0,m,0,Ae,0,Re,b.offset,b.range,y),Ne=o.getOrCreateProgram("raster",{defines:re});o.uploadCommonUniforms(X,Ne,null),Ne.draw(o,Y.TRIANGLES,oe,C,J,A,Je,m.id,je,_e,ge)}function Bm(d){const i=d._nearZ,o=d.projection.farthestPixelDistance(d),u=o-i,m=.2*d.height,y=i+m;return[i,o,(y-m-i)/u,(y-i)/u]}function Pp(d,i,o,u){if(d)return i instanceof Na&&d instanceof ic?i.getTextureDescriptor(d,o,!0):{texture:d.texture,mix:Yh(u.mix),offset:u.offset,buffer:0,tileSize:1}}var Nm=r.ef([{name:"a_index",type:"Int16",components:1}]);class Vm{constructor(i,o,u,m){const y={width:u[0],height:u[1],data:null},b=i.gl;this.targetColorTexture=new r.T(i,y,b.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new r.T(i,y,b.RGBA8,{useMipmap:!1}),this.context=i,this.updateParticleTexture(o,m),this.lastInvalidatedAt=0}updateParticleTexture(i,o){if(this.particleTextureDimension===o.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const u=this.context.gl,m=o.width*o.height;this.particleTexture0=new r.T(this.context,o,u.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new r.T(this.context,o,u.RGBA8,{premultiply:!1,useMipmap:!1});const y=new r.eg;y.reserve(m);for(let b=0;b<m;b++)y.emplaceBack(b);this.particleIndexBuffer=this.context.createVertexBuffer(y,Nm.members,!0),this.particleSegment=r.bg.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=o.width}update(i){return!(this.lastInvalidatedAt<i&&(this.lastInvalidatedAt=r.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function ln(d,i,o){if(!d)return null;const u=i.getTextureDescriptor(d,o,!0);if(!u)return null;let{texture:m,mix:y,offset:b,tileSize:A,buffer:C,format:z}=u;if(!m||!z)return null;let D=!1;return z==="uint32"&&(D=!0,y[3]=0,y=Td(r.eh,y,[0,o.paint.get("raster-particle-max-speed")]),b=Ed(r.eh,b,[0,o.paint.get("raster-particle-max-speed")])),{texture:m,textureOffset:[C/(A+2*C),A/(A+2*C)],tileSize:A,scalarData:D,scale:y,offset:b,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[z]]}}function Dd(d){const i=d._nearZ,o=d.projection.farthestPixelDistance(d),u=o-i,m=.2*d.height,y=i+m;return[i,o,(y-m-i)/u,(y-i)/u]}const Xs=new r.ao(1,0,0,1),eo=new r.ao(0,1,0,1),Lp=new r.ao(0,0,1,1),Od=new r.ao(1,0,1,1),Fd=new r.ao(0,1,1,1);function Zh(d,i,o,u,m,y){for(let b=0;b<o.length;b++)if(m){const z=new r.ao(u.r*.8,u.g*.8,u.b*.8,1);Po(d,i,o[b],u,-1,-1,y),Po(d,i,o[b],u,-1,1,y),Po(d,i,o[b],u,1,1,y),Po(d,i,o[b],u,1,-1,y),Po(d,i,o[b],z,0,0,y)}else Po(d,i,o[b],u,0,0,y)}function Po(d,i,o,u,m,y,b){const A=d.context,C=d.transform,z=A.gl,D=C.projection.name==="globe",U=D?["PROJECTION_GLOBE_VIEW"]:[];let F=r.bz(o.projMatrix);if(D&&r.aj(C.zoom)>0){const Re=r.bj(o.canonical,C),Je=r.ei(Re);F=r.aB(new Float32Array(16),C.globeMatrix,Je),r.aB(F,C.projMatrix,F)}const W=r.bC();W[12]+=2*m/(r.o.devicePixelRatio*C.width),W[13]+=2*y/(r.o.devicePixelRatio*C.height),r.aB(F,W,F);const X=d.getOrCreateProgram("debug",{defines:U}),Y=i.getTileByID(o.key);d.terrain&&d.terrain.setupElevationDraw(Y,X);const te=Rt.disabled,J=ii.disabled,re=d.colorModeForRenderPass(),oe="$debug";A.activeTexture.set(z.TEXTURE0),d.emptyTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),D?Y._makeGlobeTileDebugBuffers(d.context,C):Y._makeDebugTileBoundsBuffers(d.context,C.projection);const he=Y._tileDebugBuffer||d.debugBuffer,ye=Y._tileDebugIndexBuffer||d.debugIndexBuffer,me=Y._tileDebugSegments||d.debugSegments;if(X.draw(d,z.LINE_STRIP,te,J,re,ai.disabled,Ad(F,u.toPremultipliedRenderColor(null)),oe,he,ye,me,null,null,null,[Y._globeTileDebugBorderBuffer]),b){const Re=Y.latestRawTileData,Je=Math.floor((Re&&Re.byteLength||0)/1024);let Ne=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(Ne+=` => ${o.overscaledZ}`),Ne+=` ${Y.state}`,Ne+=` ${Je}kb`,function($e,vt){$e.initDebugOverlayCanvas();const Ve=$e.debugOverlayCanvas,Pe=$e.context.gl,Qe=$e.debugOverlayCanvas.getContext("2d");Qe.clearRect(0,0,Ve.width,Ve.height),Qe.shadowColor="white",Qe.shadowBlur=2,Qe.lineWidth=1.5,Qe.strokeStyle="white",Qe.textBaseline="top",Qe.font="bold 36px Open Sans, sans-serif",Qe.fillText(vt,5,5),Qe.strokeText(vt,5,5),$e.debugOverlayTexture.update(Ve),$e.debugOverlayTexture.bind(Pe.LINEAR,Pe.CLAMP_TO_EDGE)}(d,Ne)}const xe=i.getTile(o).tileSize,_e=512/Math.min(xe,512)*(o.overscaledZ/C.zoom)*.5,ge=Y._tileDebugTextBuffer||d.debugBuffer,Ae=Y._tileDebugTextIndexBuffer||d.quadTriangleIndexBuffer,je=Y._tileDebugTextSegments||d.debugSegments;X.draw(d,z.TRIANGLES,te,J,bi.alphaBlended,ai.disabled,Ad(F,r.ao.transparent.toPremultipliedRenderColor(null),_e),oe,ge,Ae,je,null,null,null,[Y._globeTileDebugTextBuffer])}function ia(d,i,o,u){Lo(d,0,i+o/2,d.transform.width,o,u)}function _r(d,i,o,u){Lo(d,i-o/2,0,o,d.transform.height,u)}function Lo(d,i,o,u,m,y){const b=d.context,A=b.gl;A.enable(A.SCISSOR_TEST),A.scissor(i*r.o.devicePixelRatio,o*r.o.devicePixelRatio,u*r.o.devicePixelRatio,m*r.o.devicePixelRatio),b.clear({color:y}),A.disable(A.SCISSOR_TEST)}const Bd=r.ef([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:zp}=Bd;function Sa(d,i,o,u){d.emplaceBack(i,o,u)}class Nd{constructor(i){this.vertexArray=new r.ej,this.indices=new r.b1,Sa(this.vertexArray,-1,-1,1),Sa(this.vertexArray,1,-1,1),Sa(this.vertexArray,-1,1,1),Sa(this.vertexArray,1,1,1),Sa(this.vertexArray,-1,-1,-1),Sa(this.vertexArray,1,-1,-1),Sa(this.vertexArray,-1,1,-1),Sa(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=i.createVertexBuffer(this.vertexArray,zp),this.indexBuffer=i.createIndexBuffer(this.indices),this.segment=r.bg.simpleSegment(0,0,36,12)}}function zo(d,i,o,u,m,y){const b=d.context.gl,A=i.paint.get("sky-atmosphere-color"),C=i.paint.get("sky-atmosphere-halo-color"),z=i.paint.get("sky-atmosphere-sun-intensity"),D=((U,F,W,X,Y)=>({u_matrix_3f:U,u_sun_direction:F,u_sun_intensity:W,u_color_tint_r:[X.r,X.g,X.b,X.a],u_color_tint_m:[Y.r,Y.g,Y.b,Y.a],u_luminance:5e-5}))(r.el(r.dL(),u),m,z,A.toPremultipliedRenderColor(null),C.toPremultipliedRenderColor(null));b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_CUBE_MAP_POSITIVE_X+y,i.skyboxTexture,0),o.draw(d,b.TRIANGLES,Rt.disabled,ii.disabled,bi.unblended,ai.frontCW,D,"skyboxCapture",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}const Ro=r.ef([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Do{constructor(i){const o=new r.em;o.emplaceBack(-1,1,1,0,0),o.emplaceBack(1,1,1,1,0),o.emplaceBack(1,-1,1,1,1),o.emplaceBack(-1,-1,1,0,1);const u=new r.b1;u.emplaceBack(0,1,2),u.emplaceBack(2,3,0),this.vertexBuffer=i.createVertexBuffer(o,Ro.members),this.indexBuffer=i.createIndexBuffer(u),this.segments=r.bg.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const yt=r.ef([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Mt{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class yl{constructor(i){this.colorModeAlphaBlendedWriteRGB=new bi([1,Qs,1,Qs],r.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new bi([1,0,1,0],r.ao.transparent,[!1,!1,!1,!0]),this.params=new Mt,this.updateNeeded=!0,i.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),i.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),i.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),i.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(i){const o=i.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Do(o);const u=this.params.sizeRange,m=this.params.intensityRange,y=function(D){const U=r.eo(30),F=[];for(let W=0;W<D;++W){const X=2*Math.PI*U(),Y=Math.acos(1-2*U())-.5*Math.PI;F.push(r.d4(Math.cos(Y)*Math.cos(X),Math.cos(Y)*Math.sin(X),Math.sin(Y)))}return F}(this.params.starsCount),b=r.eo(300),A=new r.en,C=new r.b1;let z=0;for(let D=0;D<y.length;++D){const U=r.c4([],y[D],200),F=Math.max(0,1+.01*u*(1*b()-.5)),W=Math.max(0,1+.01*m*(1*b()-.5));A.emplaceBack(U[0],U[1],U[2],-1,-1,F,W),A.emplaceBack(U[0],U[1],U[2],1,-1,F,W),A.emplaceBack(U[0],U[1],U[2],1,1,F,W),A.emplaceBack(U[0],U[1],U[2],-1,1,F,W),C.emplaceBack(z+0,z+1,z+2),C.emplaceBack(z+0,z+2,z+3),z+=4}this.starsVx=o.createVertexBuffer(A,yt.members),this.starsIdx=o.createIndexBuffer(C),this.starsSegments=r.bg.simpleSegment(0,0,A.length,C.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(i,o){const u=i.context,m=u.gl,y=i.transform,b=new Rt(m.LEQUAL,Rt.ReadOnly,[0,1]),A=r.aj(y.zoom),C=i.style.getLut(o.scope),z=o.properties.get("color-use-theme")==="none",D=o.properties.get("color").toNonPremultipliedRenderColor(z?null:C),U=o.properties.get("high-color-use-theme")==="none",F=o.properties.get("high-color").toNonPremultipliedRenderColor(U?null:C),W=o.properties.get("space-color-use-theme")==="none",X=o.properties.get("space-color").toNonPremultipliedRenderColor(W?null:C),Y=5e-4,te=r.ep(o.properties.get("horizon-blend"),0,1,Y,.25),J=r.dA(i,u,y)&&te===Y?y.worldSize/(2*Math.PI*1.025)-1:y.globeRadius,re=i.frameCounter/1e3%1,oe=r.ag(y.globeCenterInViewSpace),he=Math.sqrt(Math.pow(oe,2)-Math.pow(J,2)),ye=Math.acos(he/oe),me=xe=>{const _e=y.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];xe&&_e.push("ALPHA_PASS");const ge=i.getOrCreateProgram("globeAtmosphere",{defines:_e}),Ae=((Re,Je,Ne,$e,vt,Ve,Pe,Qe,We,at,xt,Pt)=>({u_frustum_tl:Re,u_frustum_tr:Je,u_frustum_br:Ne,u_frustum_bl:$e,u_horizon:vt,u_transition:Ve,u_fadeout_range:Pe,u_atmosphere_fog_color:Qe.toArray01(),u_high_color:We.toArray01(),u_space_color:at.toArray01(),u_temporal_offset:xt,u_horizon_angle:Pt}))(y.frustumCorners.TL,y.frustumCorners.TR,y.frustumCorners.BR,y.frustumCorners.BL,y.frustumCorners.horizon,A,te,D,F,X,re,ye);i.uploadCommonUniforms(u,ge);const je=this.atmosphereBuffer;je&&ge.draw(i,m.TRIANGLES,b,ii.disabled,xe?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,ai.backCW,Ae,xe?"atmosphere_glow_alpha":"atmosphere_glow",je.vertexBuffer,je.indexBuffer,je.segments)};me(!1),me(!0)}drawStars(i,o){const u=r.aA(o.properties.get("star-intensity"),0,1);if(u===0)return;const m=i.context,y=m.gl,b=i.transform,A=i.getOrCreateProgram("stars"),C=r.c6([]);r.c8(C,C,-b._pitch),r.c7(C,C,-b.angle),r.c8(C,C,r.an(b._center.lat)),r.eq(C,C,-r.an(b._center.lng));const z=r.cb(new Float32Array(16),C),D=r.aB([],b.starsProjMatrix,z),U=r.el([],z),F=r.er([],U),W=[0,1,0];r.dN(W,W,F),r.c4(W,W,this.params.sizeMultiplier);const X=[1,0,0];r.dN(X,X,F),r.c4(X,X,this.params.sizeMultiplier);const Y=(te=W,J=X,re=u,{u_matrix:Float32Array.from(D),u_up:te,u_right:J,u_intensity_multiplier:re});var te,J,re;i.uploadCommonUniforms(m,A),this.starsVx&&this.starsIdx&&A.draw(i,y.TRIANGLES,Rt.disabled,ii.disabled,this.colorModeAlphaBlendedWriteRGB,ai.disabled,Y,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class Nr{constructor(){this.visibleTiles=[]}updateBorders(i,o){const u=[],m=[],y=i._getRenderableCoordinates(!1,!0);for(const C of y){const z=i.getTile(C);if(!z.hasData())continue;const D=z.getBucket(o);D&&(D.isEmpty()||(u.push(C.key),m.push({bucket:D,tileID:C.canonical})))}let b=u.length!==this.visibleTiles.length;if(!b){u.sort();for(let C=0;C<u.length;C++)if(u[C]!==this.visibleTiles[C]){b=!0;break}}if(!b)return;const A=new Set;this.visibleTiles=u,m.sort((C,z)=>C.tileID.z-z.tileID.z||C.tileID.x-z.tileID.x||C.tileID.y-z.tileID.y);for(const C of m){const z=new Array,D=new Array,U=C.bucket;for(const F of U.featuresOnBorder)A.has(F.featureId)?D.push(F.footprintIndex):(A.add(F.featureId),z.push(F.footprintIndex));U.updateFootprintHiddenFlags(z,r.es,!1),U.updateFootprintHiddenFlags(D,r.es,!0)}}}function Fe(d,i){const o=[...d],u=i.cameraWorldSizeForFog/i.worldSize,m=r.bA([]);return r.cR(m,m,[u,u,1]),r.aB(o,m,o),r.aB(o,i.worldToFogMatrix,o),o}function $h(d,i,o,u,m){const y=o.material,b=u.context,{baseColorTexture:A,metallicRoughnessTexture:C}=y.pbrMetallicRoughness,{normalTexture:z,occlusionTexture:D,emissionTexture:U}=y;function F(X,Y,te){if(X&&(d.push(Y),b.activeTexture.set(b.gl.TEXTURE0+te),X.gfxTexture)){const{minFilter:J,magFilter:re,wrapS:oe,wrapT:he}=X.sampler;X.gfxTexture.bindExtraParam(J,re,oe,he)}}F(A,"HAS_TEXTURE_u_baseColorTexture",ts.BaseColor),F(C,"HAS_TEXTURE_u_metallicRoughnessTexture",ts.MetallicRoughness),F(z,"HAS_TEXTURE_u_normalTexture",ts.Normal),F(D,"HAS_TEXTURE_u_occlusionTexture",ts.Occlusion),F(U,"HAS_TEXTURE_u_emissionTexture",ts.Emission),m&&(m.texture||(m.texture=new r.dY(u.context,m.image,[m.image.height,m.image.height,m.image.height],b.gl.RGBA8)),b.activeTexture.set(b.gl.TEXTURE0+ts.LUT),m.texture&&m.texture.bind(b.gl.LINEAR,b.gl.CLAMP_TO_EDGE),d.push("APPLY_LUT_ON_GPU")),o.texcoordBuffer&&(d.push("HAS_ATTRIBUTE_a_uv_2f"),i.push(o.texcoordBuffer)),o.colorBuffer&&(d.push(o.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),i.push(o.colorBuffer)),o.normalBuffer&&(d.push("HAS_ATTRIBUTE_a_normal_3f"),i.push(o.normalBuffer)),o.pbrBuffer&&(d.push("HAS_ATTRIBUTE_a_pbr"),d.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),i.push(o.pbrBuffer)),y.alphaMode!=="OPAQUE"&&y.alphaMode!=="MASK"||d.push("UNPREMULT_TEXTURE_IN_SHADER"),y.defined||d.push("DIFFUSE_SHADED");const W=u.shadowRenderer;W&&(d.push("RENDER_SHADOWS","DEPTH_TEXTURE"),W.useNormalOffset&&d.push("NORMAL_OFFSET"))}function Oo(d,i,o,u,m,y){const b=o.paint.get("model-opacity").constantOr(1),A=i.context,C=new Rt(i.context.gl.LEQUAL,Rt.ReadWrite,i.depthRangeFor3D),z=i.transform,D=d.mesh,U=D.material,F=U.pbrMetallicRoughness,W=i.style.fog;let X;X=i.transform.projection.zAxisUnit==="pixels"?[...d.nodeModelMatrix]:r.aB([],u.zScaleMatrix,d.nodeModelMatrix),r.aB(X,u.negCameraPosMatrix,X);const Y=r.bl([],X);r.ed(Y,Y);const te=o.paint.get("model-color-use-theme").constantOr("default")==="none",J=o.paint.get("model-emissive-strength").constantOr(0),re=Uh(new Float32Array(d.worldViewProjection),new Float32Array(X),new Float32Array(Y),null,i,b,F.baseColorFactor,U.emissiveFactor,F.metallicFactor,F.roughnessFactor,U,J,o),oe={defines:[]},he=[],ye=i.shadowRenderer;ye&&(ye.useNormalOffset=!1),$h(oe.defines,he,D,i,te?null:o.lut);let me=null;if(W){const ge=Fe(d.nodeModelMatrix,i.transform);if(me=new Float32Array(ge),z.projection.name!=="globe"){const Ae=D.aabb.min,je=D.aabb.max,[Re,Je]=W.getOpacityForBounds(ge,Ae[0],Ae[1],je[0],je[1]);oe.overrideFog=Re>=Zt||Je>=Zt}}const xe=Ga(i,o.paint.get("model-cutoff-fade-range"));xe.shouldRenderCutoff&&oe.defines.push("RENDER_CUTOFF");const _e=i.getOrCreateProgram("model",oe);i.uploadCommonUniforms(A,_e,null,me,xe),i.renderPass!=="shadow"&&ye&&ye.setupShadowsFromMatrix(d.nodeModelMatrix,_e),_e.draw(i,A.gl.TRIANGLES,C,m,y,D.material.doubleSided?ai.disabled:ai.backCCW,re,o.id,D.vertexBuffer,D.indexBuffer,D.segments,o.paint,i.transform.zoom,void 0,he)}function Jh(d,i,o,u,m,y,b){let A;A=d.projection.name==="globe"?r.eu(o,d):[...o],r.aB(A,A,i.matrix);const C=r.aB([],u,A);if(i.meshes)for(const z of i.meshes){if(z.material.alphaMode!=="BLEND"){b.push({mesh:z,depth:0,modelIndex:m,worldViewProjection:C,nodeModelMatrix:A});continue}const D=r.af([],z.centroid,C);!d.isOrthographic&&D[2]<=0||y.push({mesh:z,depth:D[2],modelIndex:m,worldViewProjection:C,nodeModelMatrix:A})}if(i.children)for(const z of i.children)Jh(d,z,o,u,m,y,b)}function Sc(d,i,o,u){const m=o.shadowRenderer;if(!m)return;const y=m.getShadowPassDepthMode(),b=m.getShadowPassColorMode(),A=m.calculateShadowPassMatrixFromMatrix(i),C=ml(A);o.getOrCreateProgram("modelDepth",{defines:o._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(o,o.context.gl.TRIANGLES,y,ii.disabled,b,ai.backCCW,C,u.id,d.vertexBuffer,d.indexBuffer,d.segments,u.paint,o.transform.zoom,void 0,void 0)}function Rp(d,i,o){const u=i.updateZoomBasedPaintProperties(),m=function(y,b,A){let C,z,D,U=y.terrain?y.terrain.exaggeration():0;if(y.terrain&&U>0){const F=y.terrain,W=F.findDEMTileFor(A);W&&W.dem?C=r.ew.create(F,A,W):U=0}if(U===0&&(b.terrainElevationMin=0,b.terrainElevationMax=0),U===b.validForExaggeration&&(U===0||C&&C._demTile&&C._demTile.tileID===b.validForDEMTile.id&&C._dem._timestamp===b.validForDEMTile.timestamp))return!1;for(const F in b.instancesPerModel){const W=b.instancesPerModel[F];for(let X=0;X<W.instancedDataArray.length;++X){const Y=(C?U*C.getElevationAt(0|W.instancedDataArray.float32[16*X],0|W.instancedDataArray.float32[16*X+1],!0,!0):0)+W.instancesEvaluatedElevation[X];W.instancedDataArray.float32[16*X+6]=Y,z=z?Math.min(b.terrainElevationMin,Y):Y,D=D?Math.max(b.terrainElevationMax,Y):Y}}return b.terrainElevationMin=z||0,b.terrainElevationMax=D||0,b.validForExaggeration=U,b.validForDEMTile=C&&C._demTile?{id:C._demTile.tileID,timestamp:C._dem._timestamp}:{id:void 0,timestamp:0},!0}(d,i,o);(u||m)&&(i.uploaded=!1,i.upload(d.context))}const Hn={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new r.d8([0,0,0],[r.al,r.al,0])};function xl(d,i){const o=1<<d.canonical.z,u=i.getFreeCameraOptions().position,m=i.elevation,y=d.canonical.x/o,b=(d.canonical.x+1)/o,A=d.canonical.y/o,C=(d.canonical.y+1)/o;let z=i._centerAltitude;if(m){const W=m.getMinMaxForTile(d);W&&W.max>z&&(z=W.max)}const D=r.aA(u.x,y,b)-u.x,U=r.aA(u.y,A,C)-u.y,F=r.ce(z,i.center.lat)-u.z;return i._zoomFromMercatorZ(Math.sqrt(D*D+U*U+F*F))}function Dp(d,i,o,u,m,y,b){const A=d.context,C=d.renderPass==="shadow",z=d.shadowRenderer,D=C&&z?z.getShadowPassDepthMode():new Rt(A.gl.LEQUAL,Rt.ReadWrite,d.depthRangeFor3D),U=d.isTileAffectedByFog(y);if(o.meshes)for(const F of o.meshes){const W=["MODEL_POSITION_ON_GPU"],X=[];let Y,te,J;u.instancedDataArray.length>20&&W.push("INSTANCED_ARRAYS");const re=Ga(d,i.paint.get("model-cutoff-fade-range"));if(re.shouldRenderCutoff&&W.push("RENDER_CUTOFF"),C&&z)Y=d.getOrCreateProgram("modelDepth",{defines:W}),te=ml(b.shadowTileMatrix,b.shadowTileMatrix,Float32Array.from(o.matrix)),J=z.getShadowPassColorMode();else{$h(W,X,F,d,i.paint.get("model-color-use-theme").constantOr("default")==="none"?null:i.lut),Y=d.getOrCreateProgram("model",{defines:W,overrideFog:U});const he=F.material,ye=he.pbrMetallicRoughness,me=i.paint.get("model-opacity").constantOr(1),xe=i.paint.get("model-emissive-strength").constantOr(0);te=Uh(y.expandedProjMatrix,Float32Array.from(o.matrix),new Float32Array(16),null,d,me,ye.baseColorFactor,he.emissiveFactor,ye.metallicFactor,ye.roughnessFactor,he,xe,i,m),z&&(b.shadowUniformsInitialized?Y.setShadowUniformValues(A,z.getShadowUniformValues()):(z.setupShadows(y.toUnwrapped(),Y,"model-tile"),b.shadowUniformsInitialized=!0)),J=re.shouldRenderCutoff||me<1||he.alphaMode!=="OPAQUE"?bi.alphaBlended:bi.unblended}d.uploadCommonUniforms(A,Y,y.toUnwrapped(),null,re);const oe=F.material.doubleSided?ai.disabled:ai.backCCW;if(u.instancedDataArray.length>20)X.push(u.instancedDataBuffer),Y.draw(d,A.gl.TRIANGLES,D,ii.disabled,J,oe,te,i.id,F.vertexBuffer,F.indexBuffer,F.segments,i.paint,d.transform.zoom,void 0,X,u.instancedDataArray.length);else{const he=C?"u_instance":"u_normal_matrix";for(let ye=0;ye<u.instancedDataArray.length;++ye)te[he]=new Float32Array(u.instancedDataArray.arrayBuffer,64*ye,16),Y.draw(d,A.gl.TRIANGLES,D,ii.disabled,J,oe,te,i.id,F.vertexBuffer,F.indexBuffer,F.segments,i.paint,d.transform.zoom,void 0,X)}}if(o.children)for(const F of o.children)Dp(d,i,F,u,m,y,b)}const Um=[1,-1,1];function Op(d,i,o,u){if(!o.modelManager)return!0;const m=o.modelManager;if(!o.shadowRenderer)return!0;const y=o.shadowRenderer,b=i.aabb;let A=!0,C=d.maxHeight;if(C===0){let D=0;for(const U in d.instancesPerModel){const F=m.getModel(U,u);F?D=Math.max(D,Math.max(Math.max(F.aabb.max[0],F.aabb.max[1]),F.aabb.max[2])):A=!1}C=d.maxScale*D*1.41+d.maxVerticalOffset,A&&(d.maxHeight=C)}b.max[2]=C,b.min[2]+=d.terrainElevationMin,b.max[2]+=d.terrainElevationMax,r.af(b.min,b.min,i.tileMatrix),r.af(b.max,b.max,i.tileMatrix);const z=b.intersects(y.getCurrentCascadeFrustum());return o.currentShadowCascade===0&&(d.isInsideFirstShadowMapFrustum=z===2),z===0}function Kh(d,i){const o=d.uniformValues.u_cutoff_params[0],u=d.uniformValues.u_cutoff_params[1],m=d.uniformValues.u_cutoff_params[2],y=d.uniformValues.u_cutoff_params[3];return u===o||y===m?1:r.aA(((i-o)/(u-o)-m)/(y-m),0,1)}function Vd(d,i,o,u){if(i.pitch<20)return 1;const m=i.getWorldToCameraMatrix();r.aB(m,m,d);const y=r.bU(o.min[0],o.min[1],o.min[2],1);let b=r.aC(r.ex(),y,m),A=b,C=b;y[1]=o.max[1],b=r.aC(r.ex(),y,m),A=b[1]<A[1]?b:A,C=b[1]>C[1]?b:C,y[0]=o.max[0],b=r.aC(r.ex(),y,m),A=b[1]<A[1]?b:A,C=b[1]>C[1]?b:C,y[1]=o.min[1],b=r.aC(r.ex(),y,m),A=b[1]<A[1]?b:A,C=b[1]>C[1]?b:C;const z=r.aA(u[0],0,1),D=100*i.pixelsPerMeter*r.aA(u[1],0,1),U=r.aA(u[2],0,1),F=r.ey(r.ex(),A,C,z),W=Math.tan(.5*i.fovX),X=-F[2]*W;if(D===0)return F[1]<-Math.abs(X)?U:1;const Y=(-Math.abs(X)-F[1])/D,te=(re,oe,he)=>(1-he)*re+he*oe,J=r.aA(te(1,U,Y),U,1);return te(1,J,r.aA((i.pitch-20)/20,0,1))}class Fp{}class Bp{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(i,o,u){{const U=this._storage.get(o.id);if(U)return U.lastUsedFrameIdx=i,U.buf}const m=u.gl,y=m.getBufferParameter(m.ELEMENT_ARRAY_BUFFER,m.BUFFER_SIZE),b=new ArrayBuffer(y),A=new Int16Array(b);m.getBufferSubData(m.ELEMENT_ARRAY_BUFFER,0,new Int16Array(b));const C=new r.eA;for(let U=0;U<y/2;U+=3){const F=A[U],W=A[U+1],X=A[U+2];C.emplaceBack(F,W),C.emplaceBack(W,X),C.emplaceBack(X,F)}const z=u.bindVertexArrayOES.current,D=new Fp;return D.buf=new $a(u,C),D.lastUsedFrameIdx=i,this._storage.set(o.id,D),u.bindVertexArrayOES.set(z),D.buf}update(i){for(const[o,u]of this._storage)i-u.lastUsedFrameIdx>30&&(u.buf.destroy(),this._storage.delete(o))}destroy(){for(const[i,o]of this._storage)o.buf.destroy(),this._storage.delete(i)}}class Qh{constructor(i){this.occluderSize=30,this.depthOffset=-1e-4,i.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),i.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const Ac=r.ef([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class vl{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class Ud{constructor(i,o){this.revealStart=11,this.revealRange=2,i.registerParameter(this,[...o,"Reveal"],"revealStart",{min:0,max:17,step:.05}),i.registerParameter(this,[...o,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const Np=r.ef([{type:"Float32",name:"a_pos_2f",components:2}]);class jm{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(i,o){const u=i.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const b=new r.eB,A=new r.b1;b.emplaceBack(-1,-1),b.emplaceBack(1,-1),b.emplaceBack(1,1),b.emplaceBack(-1,1),A.emplaceBack(0,1,2),A.emplaceBack(0,2,3),this.vignetteVx=i.context.createVertexBuffer(b,Np.members),this.vignetteIdx=i.context.createIndexBuffer(A)}const m=r.bg.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){i.uploadCommonUniforms(i.context,u);const b={u_vignetteShape:(y={vignetteShape:[o.start,o.range,Math.pow(10,o.fadePower)],vignetteColor:[o.color.r,o.color.g,o.color.b,o.color.a*o.strength]}).vignetteShape,u_vignetteColor:y.vignetteColor};u.draw(i,i.context.gl.TRIANGLES,Rt.disabled,ii.disabled,bi.alphaBlended,ai.disabled,b,"vignette",this.vignetteVx,this.vignetteIdx,m)}var y}}class Vp{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(i,o){const u=i.getFreeCameraOptions().position,m=u.toAltitude(),y=u.toLngLat(),b=r.an(y.lng),A=r.an(y.lat),C=i.pixelsPerMeter/o,z=b*r.eD,D=r.eD*Math.log(Math.tan(Math.PI/4+A/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const U=-this._offsetYPrev+D,F=-this._elevationPrev+m;this._accumulatedOffsetX+=(-this._offsetXPrev+z)*C,this._accumulatedOffsetY+=U*C,this._accumulatedElevation+=F*C,this._offsetXPrev=z,this._offsetYPrev=D,this._elevationPrev=m}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function Up(d,i){return[-(d[0]-Math.floor(d[0]/i)*i),-(d[1]-Math.floor(d[1]/i)*i),-(d[2]-Math.floor(d[2]/i)*i)]}function Ns(d){const i=r.eo(1323123451230),o=[];for(let u=0;u<d;++u){const m=2*i()-1,y=2*i()-1,b=2*i()-1;o.push(r.d4(m,y,b))}return o}function to(d,i,o,u,m){const y=r.aA((m-o)/(u-o),0,1);return(1-y)*d+y*i}class bl{constructor(i){this._movement=new Vp,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new jm,this._ppmScaleFactor=i}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(i,o){const u=i.transform;this._movement.update(u,this._ppmScaleFactor);const m=u.starsProjMatrix,y=r.c6([]);r.c8(y,y,r.an(90)-u._pitch),r.c7(y,y,-u.angle);const b=r.cb(new Float32Array(16),y),A=r.eC(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),C=r.ed([],A),z=r.aB([],C,b),D=Date.now()/1e3;return this._accumulatedTimeFromStart+=(D-this._prevTime)*o,this._prevTime=D,{projectionMatrix:m,modelviewMatrix:z}}}class Ar extends bl{constructor(i){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new Ud(i.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(i){const o=i.context;if(!this.particlesVx){const u=Ns(this.particlesCount),m=new r.eE,y=new r.b1;let b=0;const A=r.eo(1323123451230);for(let C=0;C<u.length;++C){const z=u[C],D=[2*A()-1,A(),A(),A()];m.emplaceBack(z[0],z[1],z[2],-1,-1,...D),m.emplaceBack(z[0],z[1],z[2],1,-1,...D),m.emplaceBack(z[0],z[1],z[2],1,1,...D),m.emplaceBack(z[0],z[1],z[2],-1,1,...D),y.emplaceBack(b+0,b+1,b+2),y.emplaceBack(b+0,b+2,b+3),b+=4}this.particlesVx=o.createVertexBuffer(m,Ac.members),this.particlesIdx=o.createIndexBuffer(y)}}draw(i){if(!this._params.overrideStyleParameters&&!i.style.rain)return;const o=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},u=i.transform.zoom;if(o.revealStart>u)return;const m=to(0,1,o.revealStart,o.revealStart+o.revealRange,u);if(!this.particlesVx||!this.particlesIdx)return;const y=structuredClone(this._params);let b=[-y.direction.x,y.direction.y,-100];r.aw(b,b);const A=structuredClone(this._vignetteParams);A.strength*=m,y.overrideStyleParameters||(y.intensity=i.style.rain.state.density,y.timeFactor=i.style.rain.state.intensity,y.color=structuredClone(i.style.rain.state.color),b=structuredClone(i.style.rain.state.direction),y.screenThinning.intensity=i.style.rain.state.centerThinning,y.dropletSizeX=i.style.rain.state.dropletSize[0],y.dropletSizeYScale=i.style.rain.state.dropletSize[1]/i.style.rain.state.dropletSize[0],y.distortionStrength=100*i.style.rain.state.distortionStrength,A.strength=1,A.color=structuredClone(i.style.rain.state.vignetteColor));const C=this.updateOnRender(i,y.timeFactor),z=i.context,D=z.gl,U=i.transform;this.screenTexture&&this.screenTexture.size[0]===i.width&&this.screenTexture.size[1]===i.height||(this.screenTexture=new r.T(z,{width:i.width,height:i.height,data:null},D.RGBA8)),y.distortionStrength>0&&(z.activeTexture.set(D.TEXTURE0),this.screenTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),D.copyTexSubImage2D(D.TEXTURE_2D,0,0,0,0,0,i.width,i.height));const F=i.getOrCreateProgram("rainParticle");i.uploadCommonUniforms(z,F),z.activeTexture.set(D.TEXTURE0),this.screenTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE);const W=[y.color.r,y.color.g,y.color.b,y.color.a],X=(Y,te)=>{const J=Up(this._movement.getPosition(),Y),re=y.dropletSizeX,oe=y.dropletSizeX*y.dropletSizeYScale,he=i.width/2,ye=i.height/2,me=to(0,y.screenThinning.start,0,1,y.screenThinning.intensity),xe=to(.001,y.screenThinning.range,0,1,y.screenThinning.intensity),_e=to(0,y.screenThinning.particleOffset,0,1,y.screenThinning.intensity),ge=(Ae={modelview:C.modelviewMatrix,projection:C.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:J,velocityConeAperture:y.velocityConeAperture,velocity:y.velocity,boxSize:Y,rainDropletSize:[re,oe],distortionStrength:y.distortionStrength,rainDirection:b,color:W,screenSize:[U.width,U.height],thinningCenterPos:[he,ye],thinningShape:[me,xe,Math.pow(10,y.screenThinning.fadePower)],thinningAffectedRatio:y.screenThinning.affectedRatio,thinningParticleOffset:_e,shapeDirectionalPower:y.shapeDirPower,shapeNormalPower:y.shapeNormalPower,mode:te?0:1},{u_modelview:Float32Array.from(Ae.modelview),u_projection:Float32Array.from(Ae.projection),u_time:Ae.time,u_cam_pos:Ae.camPos,u_texScreen:0,u_velocityConeAperture:Ae.velocityConeAperture,u_velocity:Ae.velocity,u_boxSize:Ae.boxSize,u_rainDropletSize:Ae.rainDropletSize,u_distortionStrength:Ae.distortionStrength,u_rainDirection:Ae.rainDirection,u_color:Ae.color,u_screenSize:Ae.screenSize,u_thinningCenterPos:Ae.thinningCenterPos,u_thinningShape:Ae.thinningShape,u_thinningAffectedRatio:Ae.thinningAffectedRatio,u_thinningParticleOffset:Ae.thinningParticleOffset,u_shapeDirectionalPower:Ae.shapeDirectionalPower,u_shapeNormalPower:Ae.shapeNormalPower,u_mode:Ae.mode});var Ae;const je=Math.round(y.intensity*this.particlesCount),Re=r.bg.simpleSegment(0,0,4*je,2*je);F.draw(i,D.TRIANGLES,Rt.disabled,ii.disabled,bi.alphaBlended,ai.disabled,ge,"rain_particles",this.particlesVx,this.particlesIdx,Re)};y.distortionStrength>0&&X(y.boxSize,!0),X(y.boxSize,!1),this._vignette.draw(i,A)}}const Fi=r.ef([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class jp extends bl{constructor(i){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new Ud(i.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(i){const o=i.context;if(!this.particlesVx){const u=Ns(this.particlesCount),m=new r.eF,y=new r.b1;let b=0;const A=r.eo(1323123451230);for(let C=0;C<u.length;++C){const z=u[C],D=A(),U=A(),F=A(),W=[C/u.length,D,U,F],X=[A(),A()];m.emplaceBack(z[0],z[1],z[2],-1,-1,...W,...X),m.emplaceBack(z[0],z[1],z[2],1,-1,...W,...X),m.emplaceBack(z[0],z[1],z[2],1,1,...W,...X),m.emplaceBack(z[0],z[1],z[2],-1,1,...W,...X),y.emplaceBack(b+0,b+1,b+2),y.emplaceBack(b+0,b+2,b+3),b+=4}this.particlesVx=o.createVertexBuffer(m,Fi.members),this.particlesIdx=o.createIndexBuffer(y)}}draw(i){if(!this._params.overrideStyleParameters&&!i.style.snow)return;const o=structuredClone(this._params);let u=[-o.direction.x,o.direction.y,-100];r.aw(u,u);const m=structuredClone(this._vignetteParams),y=o.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},b=i.transform.zoom;if(y.revealStart>b)return;const A=to(0,1,y.revealStart,y.revealStart+y.revealRange,b);m.strength*=A,o.overrideStyleParameters||(o.intensity=i.style.snow.state.density,o.timeFactor=i.style.snow.state.intensity,o.color=structuredClone(i.style.snow.state.color),u=structuredClone(i.style.snow.state.direction),o.screenThinning.intensity=i.style.snow.state.centerThinning,o.billboardSize=2.79*i.style.snow.state.flakeSize,m.strength=1,m.color=structuredClone(i.style.snow.state.vignetteColor));const C=this.updateOnRender(i,o.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const z=i.context,D=z.gl,U=i.transform,F=i.getOrCreateProgram("snowParticle");i.uploadCommonUniforms(z,F),((W,X,Y)=>{const te=Up(this._movement.getPosition(),W),J=U.width/2,re=U.height/2,oe=to(0,Y.screenThinning.start,0,1,Y.screenThinning.intensity),he=to(.001,Y.screenThinning.range,0,1,Y.screenThinning.intensity),ye=to(0,Y.screenThinning.particleOffset,0,1,Y.screenThinning.intensity),me=(xe={modelview:C.modelviewMatrix,projection:C.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:te,velocityConeAperture:Y.velocityConeAperture,velocity:Y.velocity,horizontalOscillationRadius:Y.horizontalOscillationRadius,horizontalOscillationRate:Y.horizontalOscillationRate,boxSize:W,billboardSize:1*Y.billboardSize,simpleShapeParameters:[Y.shapeFadeStart,Y.shapeFadePower],screenSize:[U.width,U.height],thinningCenterPos:[J,re],thinningShape:[oe,he,Math.pow(10,Y.screenThinning.fadePower)],thinningAffectedRatio:Y.screenThinning.affectedRatio,thinningParticleOffset:ye,color:[Y.color.r,Y.color.g,Y.color.b,Y.color.a],direction:u},{u_modelview:Float32Array.from(xe.modelview),u_projection:Float32Array.from(xe.projection),u_time:xe.time,u_cam_pos:xe.camPos,u_velocityConeAperture:xe.velocityConeAperture,u_velocity:xe.velocity,u_horizontalOscillationRadius:xe.horizontalOscillationRadius,u_horizontalOscillationRate:xe.horizontalOscillationRate,u_boxSize:xe.boxSize,u_billboardSize:xe.billboardSize,u_simpleShapeParameters:xe.simpleShapeParameters,u_screenSize:xe.screenSize,u_thinningCenterPos:xe.thinningCenterPos,u_thinningShape:xe.thinningShape,u_thinningAffectedRatio:xe.thinningAffectedRatio,u_thinningParticleOffset:xe.thinningParticleOffset,u_particleColor:xe.color,u_direction:xe.direction});var xe;const _e=Math.round(Y.intensity*this.particlesCount),ge=r.bg.simpleSegment(0,0,4*_e,2*_e);this.particlesVx&&this.particlesIdx&&F.draw(i,D.TRIANGLES,Rt.disabled,ii.disabled,bi.alphaBlended,ai.disabled,me,"snow_particles",this.particlesVx,this.particlesIdx,ge)})(o.boxSize,0,o),this._vignette.draw(i,m)}}const io={symbol:function(d,i,o,u,m){if(d.renderPass!=="translucent")return;const y=ii.disabled,b=d.colorModeForRenderPass(),A=o.layout.get("text-variable-anchor"),C=o.layout.get("text-size-scale-range"),z=r.aA(d.scaleFactor,C[0],C[1]);A&&function(F,W,X,Y,te,J,re,oe){const he=W.transform,ye=te==="map",me=J==="map";for(const xe of F){const _e=Y.getTile(xe),ge=_e.getBucket(X);if(!ge||!ge.text||!ge.text.segments.get().length)continue;const Ae=r.bK(ge.textSizeData,he.zoom,oe),je=yo(xe,ge.getProjection(),he),Re=he.calculatePixelsToTileUnitsMatrix(_e),Je=Nn(je,_e.tileID.canonical,me,ye,he,ge.getProjection(),Re),Ne=ge.hasIconTextFit()&&ge.hasIconData();Ae&&Wh(ge,ye,me,re,he,Je,xe,Math.pow(2,he.zoom-_e.tileID.overscaledZ),Ae,Ne)}}(u,d,o,i,o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),m,z);const D=o.paint.get("icon-opacity").constantOr(1)!==0,U=o.paint.get("text-opacity").constantOr(1)!==0;o.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(D||U)?wc(d,i,o,u,y,b):(D&&wc(d,i,o,u,y,b,{onlyIcons:!0}),U&&wc(d,i,o,u,y,b,{onlyText:!0})),i.map.showCollisionBoxes&&(bc(d,i,o,u,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),!0),bc(d,i,o,u,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),!1))},circle:function(d,i,o,u){if(d.renderPass!=="translucent")return;const m=o.paint.get("circle-opacity"),y=o.paint.get("circle-stroke-width"),b=o.paint.get("circle-stroke-opacity"),A=o.layout.get("circle-sort-key").constantOr(1)!==void 0,C=o.paint.get("circle-emissive-strength");if(m.constantOr(1)===0&&(y.constantOr(1)===0||b.constantOr(1)===0))return;const z=d.context,D=z.gl,U=d.transform,F=!(!d.terrain||!d.terrain.enabled),W=o.layout.get("circle-elevation-reference"),X=d.depthModeForSublayer(0,Rt.ReadOnly),Y=new Rt(d.context.gl.LEQUAL,Rt.ReadOnly,d.depthRangeFor3D),te=W==="none"||F?X:Y,J=ii.disabled,re=d.colorModeForDrapableLayerRenderPass(C),oe=U.projection.name==="globe",he=[r.aF(U.center.lng),r.aJ(U.center.lat)],ye=[];for(let xe=0;xe<u.length;xe++){const _e=u[xe],ge=i.getTile(_e),Ae=ge.getBucket(o);if(!Ae||Ae.projection.name!==U.projection.name)continue;const je=Ae.programConfigurations.get(o.id),Re=Ae.layoutVertexBuffer,Je=Ae.globeExtVertexBuffer,Ne=Ae.indexBuffer,$e=r.dZ(o),vt=[Je],Ve=d.isTileAffectedByFog(_e);oe&&$e.push("PROJECTION_GLOBE_VIEW"),$e.push("DEPTH_D24"),d.terrain&&U.depthOcclusionForSymbolsAndCircles&&$e.push("DEPTH_OCCLUSION"),Ae.hasElevation&&!d.terrain&&($e.push("ELEVATED_ROADS"),vt.push(Ae.elevatedLayoutVertexBuffer));const Pe=d.getOrCreateProgram("circle",{config:je,defines:$e,overrideFog:Ve}),Qe=U.projection.createInversionMatrix(U,_e.canonical),We={programConfiguration:je,program:Pe,layoutVertexBuffer:Re,dynamicBuffers:vt,indexBuffer:Ne,uniformValues:r.d_(d,_e,ge,Qe,he,o),tile:ge};if(A){const at=Ae.segments.get();for(const xt of at)ye.push({segments:new r.bg([xt]),sortKey:xt.sortKey,state:We})}else ye.push({segments:Ae.segments,sortKey:0,state:We})}A&&ye.sort((xe,_e)=>xe.sortKey-_e.sortKey);const me={useDepthForOcclusion:U.depthOcclusionForSymbolsAndCircles};for(const xe of ye){const{programConfiguration:_e,program:ge,layoutVertexBuffer:Ae,dynamicBuffers:je,indexBuffer:Re,uniformValues:Je,tile:Ne}=xe.state,$e=xe.segments;d.terrain&&d.terrain.setupElevationDraw(Ne,ge,me),d.uploadCommonUniforms(z,ge,Ne.tileID.toUnwrapped()),ge.draw(d,D.TRIANGLES,te,J,re,ai.disabled,Je,o.id,Ae,Re,$e,o.paint,U.zoom,_e,je)}},heatmap:function(d,i,o,u){if(o.paint.get("heatmap-opacity")!==0)if(d.renderPass==="offscreen"){const m=d.context,y=m.gl,b=ii.disabled,A=new bi([y.ONE,y.ONE,y.ONE,y.ONE],r.ao.transparent,[!0,!0,!0,!0]);(function(W,X,Y,te){const J=W.gl,re=X.width*te,oe=X.height*te;W.activeTexture.set(J.TEXTURE1),W.viewport.set([0,0,re,oe]);let he=Y.heatmapFbo;if(!he||he&&(he.width!==re||he.height!==oe)){he&&he.destroy();const ye=J.createTexture();J.bindTexture(J.TEXTURE_2D,ye),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_WRAP_S,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_WRAP_T,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_MIN_FILTER,J.LINEAR),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_MAG_FILTER,J.LINEAR),he=Y.heatmapFbo=W.createFramebuffer(re,oe,!0,null),function(me,xe,_e,ge,Ae,je){const Re=me.gl;Re.texImage2D(Re.TEXTURE_2D,0,me.extRenderToTextureHalfFloat?Re.RGBA16F:Re.RGBA,Ae,je,0,Re.RGBA,me.extRenderToTextureHalfFloat?Re.HALF_FLOAT:Re.UNSIGNED_BYTE,null),ge.colorAttachment.set(_e)}(W,0,ye,he,re,oe)}else J.bindTexture(J.TEXTURE_2D,he.colorAttachment.get()),W.bindFramebuffer.set(he.framebuffer)})(m,d,o,d.transform.projection.name==="globe"?.5:.25),m.clear({color:r.ao.transparent});const C=d.transform,z=C.projection.name==="globe",D=z?["PROJECTION_GLOBE_VIEW"]:[],U=z?ai.frontCCW:ai.disabled,F=[r.aF(C.center.lng),r.aJ(C.center.lat)];for(let W=0;W<u.length;W++){const X=u[W];if(i.hasRenderableParent(X))continue;const Y=i.getTile(X),te=Y.getBucket(o);if(!te||te.projection.name!==C.projection.name)continue;const J=d.isTileAffectedByFog(X),re=te.programConfigurations.get(o.id),oe=d.getOrCreateProgram("heatmap",{config:re,defines:D,overrideFog:J}),{zoom:he}=d.transform;d.terrain&&d.terrain.setupElevationDraw(Y,oe),d.uploadCommonUniforms(m,oe,X.toUnwrapped());const ye=C.projection.createInversionMatrix(C,X.canonical);oe.draw(d,y.TRIANGLES,Rt.disabled,b,A,U,Cp(d,X,Y,ye,F,he,o.paint.get("heatmap-intensity")),o.id,te.layoutVertexBuffer,te.indexBuffer,te.segments,o.paint,d.transform.zoom,re,z?[te.globeExtVertexBuffer]:null)}m.viewport.set([0,0,d.width,d.height])}else d.renderPass==="translucent"&&(d.context.setColorMode(d.colorModeForRenderPass()),function(m,y){const b=m.context,A=b.gl,C=y.heatmapFbo;if(!C)return;b.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,C.colorAttachment.get()),b.activeTexture.set(A.TEXTURE1);let z=y.colorRampTexture;z||(z=y.colorRampTexture=new r.T(b,y.colorRamp,A.RGBA8)),z.bind(A.LINEAR,A.CLAMP_TO_EDGE),m.getOrCreateProgram("heatmapTexture").draw(m,A.TRIANGLES,Rt.disabled,ii.disabled,m.colorModeForRenderPass(),ai.disabled,((D,U,F,W)=>({u_image:0,u_color_ramp:1,u_opacity:U.paint.get("heatmap-opacity")}))(0,y),y.id,m.viewportBuffer,m.quadTriangleIndexBuffer,m.viewportSegments,y.paint,m.transform.zoom)}(d,o))},line:function(d,i,o,u){if(d.renderPass!=="translucent")return;const m=o.paint.get("line-opacity"),y=o.paint.get("line-width");if(m.constantOr(1)===0||y.constantOr(1)===0)return;const b=o.paint.get("line-emissive-strength"),A=o.paint.get("line-occlusion-opacity"),C=o.layout.get("line-elevation-reference"),z=o.layout.get("line-width-unit")==="meters",D=C==="sea",U=!(!d.terrain||!d.terrain.enabled),F=d.context,W=F.gl;if(o.hasElevatedBuckets&&d.transform.projection.name==="globe")return;const X=o.layout.get("line-cross-slope"),Y=X!==void 0,te=X<1,J=d.colorModeForDrapableLayerRenderPass(b),re=d.terrain&&d.terrain.renderingToTexture,oe=re?1:r.o.devicePixelRatio,he=o.paint.get("line-dasharray"),ye=he.constantOr(1),me=o.layout.get("line-cap"),xe=he.constantOr(null),_e=me.constantOr(null),ge=o.paint.get("line-pattern"),Ae=ge.constantOr(1),je=o.paint.get("line-pattern-cross-fade"),Re=ge.constantOr(null),Je=o.paint.get("line-opacity").constantOr(1);let Ne=!Ae&&Je!==1||d.depthOcclusion&&A>0&&A<1;const $e=o.paint.get("line-gradient"),vt=Ae?"linePattern":"line",Ve=r.d$(o);let Pe;if(re&&d.terrain&&d.terrain.clipOrMaskOverlapStencilType()&&(Ne=!1),A!==0&&d.depthOcclusion){const xt=o.paint._values["line-opacity"];xt&&xt.value&&xt.value.kind==="constant"?Pe=xt.value:r.w(`Occlusion opacity for layer ${o.id} is supported only when line-opacity isn't data-driven.`)}y.value.kind!=="constant"&&y.value.isLineProgressConstant===!1&&Ve.push("VARIABLE_LINE_WIDTH");const Qe=(xt,Pt,pt,ht,Wt,Ut)=>{for(const Ht of xt){const Vt=i.getTile(Ht);if(Ae&&!Vt.patternsLoaded())continue;const oi=Vt.getBucket(o);if(!oi||oi.elevationType!=="none"&&!Wt||oi.elevationType==="none"&&Wt)continue;d.prepareDrawTile();const yi=[...Pt],wi=d.shadowRenderer,ir=oi.elevationType==="road"&&!!wi&&wi.enabled;let hi=[0,0,0];if(ir){const Si=d.style.directionalLight,ri=d.style.ambientLight;Si&&ri&&(hi=jn(d.style,Si,ri)),yi.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const Gi=oi.programConfigurations.get(o.id);let Qi=!1;if(Re&&Vt.imageAtlas){const Si=r.e0.from(Re),ri=Si.getPrimary().scaleSelf(oe).toString(),rr=Vt.imageAtlas.patternPositions.get(ri),Vr=Si.getSecondary(),Mr=Vr?Vt.imageAtlas.patternPositions.get(Vr.scaleSelf(oe).toString()):null;Qi=!!rr&&!!Mr,rr&&Gi.setConstantPatternPositions(rr,Mr)}je>0&&(Qi||Gi.getPatternTransitionVertexBuffer("line-pattern"))&&yi.push("LINE_PATTERN_TRANSITION");const Tr=d.isTileAffectedByFog(Ht),xi=d.getOrCreateProgram(vt,{config:Gi,defines:yi,overrideFog:Tr});if(!Ae&&xe&&_e&&Vt.lineAtlas){const Si=Vt.lineAtlas.getDash(xe,_e);Si&&Gi.setConstantPatternPositions(Si)}ir&&wi.setupShadows(Vt.tileID.toUnwrapped(),xi,"vector-tile");let[Zi,Yi]=o.paint.get("line-trim-offset");(_e==="round"||_e==="square")&&Zi!==Yi&&(Zi===0&&(Zi-=1),Yi===1&&(Yi+=1));const Ji=re?Ht.projMatrix:null,Cr=z?1/oi.tileToMeter/r.ay(Vt,1,d.transform.zoom):1,qr=z?1/oi.tileToMeter/r.ay(Vt,1,Math.floor(d.transform.zoom)):1,xs=Ae?r.e1(d,Vt,o,Ji,oe,Cr,qr,[Zi,Yi],hi,je):r.e2(d,Vt,o,Ji,oi.lineClipsArray.length,oe,Cr,qr,[Zi,Yi],hi);if($e){const Si=oi.gradients[o.id];let ri=Si.texture;if(o.gradientVersion!==Si.version){let rr=256;if(o.stepInterpolant){const Vr=i.getSource().maxzoom,Mr=Ht.canonical.z===Vr?Math.ceil(1<<d.transform.maxZoom-Ht.canonical.z):1;rr=r.aA(r.e3(oi.maxLineLength/r.al*1024*Mr),256,F.maxTextureSize)}Si.gradient=r.e4({expression:o.gradientExpression(),evaluationKey:"lineProgress",resolution:rr,image:Si.gradient||void 0,clips:oi.lineClipsArray}),Si.texture?Si.texture.update(Si.gradient):Si.texture=new r.T(F,Si.gradient,W.RGBA8),Si.version=o.gradientVersion,ri=Si.texture}F.activeTexture.set(W.TEXTURE1),ri.bind(o.stepInterpolant?W.NEAREST:W.LINEAR,W.CLAMP_TO_EDGE)}ye&&(F.activeTexture.set(W.TEXTURE0),Vt.lineAtlasTexture&&Vt.lineAtlasTexture.bind(W.LINEAR,W.REPEAT),Gi.updatePaintBuffers()),Ae&&(F.activeTexture.set(W.TEXTURE0),Vt.imageAtlasTexture&&Vt.imageAtlasTexture.bind(W.LINEAR,W.CLAMP_TO_EDGE),Gi.updatePaintBuffers()),Wt&&!D&&d.terrain.setupElevationDraw(Vt,xi),d.uploadCommonUniforms(F,xi,Ht.toUnwrapped());const Ir=Si=>{Pe!=null&&(Pe.value=Je*A),xi.draw(d,W.TRIANGLES,pt,Si,J,ai.disabled,xs,o.id,oi.layoutVertexBuffer,oi.indexBuffer,oi.segments,o.paint,d.transform.zoom,Gi,[oi.layoutVertexBuffer2,oi.patternVertexBuffer,oi.zOffsetVertexBuffer]),Pe!=null&&(Pe.value=Je)};if(Ne&&!Wt){const Si=d.stencilModeForClipping(Ht).ref;Si===0&&re&&F.clear({stencil:0});const ri={func:W.EQUAL,mask:255};xs.u_alpha_discard_threshold=.8,Ir(new ii(ri,Si,255,W.KEEP,W.KEEP,W.INVERT)),xs.u_alpha_discard_threshold=0,Ir(new ii(ri,Si,255,W.KEEP,W.KEEP,W.KEEP))}else xs.u_alpha_discard_threshold=Ne&&Wt&&Ut?.8:0,Ir(Wt?ht:d.stencilModeForClipping(Ht))}};let We=d.depthModeForSublayer(0,Rt.ReadOnly);const at=new Rt(d.depthOcclusion?W.GREATER:W.LEQUAL,Rt.ReadOnly,d.depthRangeFor3D);if(o.hasNonElevatedBuckets){const xt=!re&&d.terrain;A!==0&&xt?r.w(`Occlusion opacity for layer ${o.id} is supported on terrain only if the layer has line-z-offset enabled.`):xt?r.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${o.id}.`):Qe(u,Ve,We,ii.disabled,!1,!0)}if(o.hasElevatedBuckets){C==="hd-road-markup"?U||(We=at,Ve.push("ELEVATED_ROADS")):(Ve.push("ELEVATED"),We=at,Y&&Ve.push(te?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),D&&Ve.push("ELEVATION_REFERENCE_SEA"));const xt=Ne?d.stencilModeFor3D():ii.disabled;d.forceTerrainMode=!0,Qe(u,Ve,We,xt,!0,!0),Ne&&Qe(u,Ve,We,xt,!0,!1),d.forceTerrainMode=!1}Ne&&(d.resetStencilClippingMasks(),re&&F.clear({stencil:0})),A===0||d.depthOcclusion||re||d.layersWithOcclusionOpacity.push(d.currentLayer)},fill:function(d,i,o,u){const m=o.paint.get("fill-color"),y=o.paint.get("fill-opacity");if(y.constantOr(1)===0)return;const b=o.paint.get("fill-emissive-strength"),A=d.colorModeForDrapableLayerRenderPass(b),C=o.paint.get("fill-pattern"),z=d.opaquePassEnabledForLayer()&&!C.constantOr(1)&&m.constantOr(r.ao.transparent).a===1&&y.constantOr(0)===1?"opaque":"translucent";let D="none";o.layout.get("fill-elevation-reference")!=="none"?D="road":o.paint.get("fill-z-offset").constantOr(1)!==0&&(D="offset");const U=!(!d.terrain||!d.terrain.enabled),F={painter:d,sourceCache:i,layer:o,coords:u,colorMode:A,elevationType:D,terrainEnabled:U,pass:z};if(d.renderPass!=="shadow")if(D!=="offset"){if(_l(F,!1),D==="road"){const W=!U&&d.renderPass==="translucent";W&&Mo(d,i,o,u,"geometry"),_l(F,!0,ii.disabled),W&&function(X){const{painter:Y,sourceCache:te,layer:J,coords:re,colorMode:oe}=X,he=Y.context.gl,ye=X.painter.shadowRenderer,me=!!ye&&ye.enabled,xe=new Rt(Y.context.gl.LEQUAL,Rt.ReadOnly,Y.depthRangeFor3D);let _e=[0,0,0];if(me){const Ae=Y.style.directionalLight,je=Y.style.ambientLight;Ae&&je&&(_e=jn(Y.style,Ae,je))}const ge=Ae=>{for(const je of re){const Re=te.getTile(je),Je=Re.getBucket(J);if(!Je)continue;const Ne=Je.elevatedStructures;if(!Ne)continue;let $e,vt;if(Ae?($e=Ne.renderableBridgeSegments,vt=Ne.bridgeProgramConfigurations.get(J.id)):($e=Ne.renderableTunnelSegments,vt=Ne.tunnelProgramConfigurations.get(J.id)),!$e||$e.segments[0].primitiveLength===0)continue;vt.updatePaintBuffers(),Y.prepareDrawTile();const Ve=Y.isTileAffectedByFog(je),Pe=[];me&&Pe.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const Qe=Y.getOrCreateProgram("elevatedStructures",{config:vt,overrideFog:Ve,defines:Pe}),We=Y.translatePosMatrix(je.projMatrix,Re,J.paint.get("fill-translate"),J.paint.get("fill-translate-anchor"));me&&ye.setupShadows(Re.tileID.toUnwrapped(),Qe,"vector-tile");const at=zm(We,_e);Y.uploadCommonUniforms(Y.context,Qe,je.toUnwrapped()),Qe.draw(Y,he.TRIANGLES,xe,ii.disabled,oe,ai.backCCW,at,J.id,Ne.vertexBuffer,Ne.indexBuffer,$e,J.paint,Y.transform.zoom,vt,[Ne.vertexBufferNormal])}};ge(!0),ge(!1)}(F)}}else _l(F,!1,d.stencilModeFor3D());else d.shadowRenderer&&D==="road"&&!U&&function(W){const{painter:X,sourceCache:Y,layer:te,coords:J}=W,re=X.context.gl,oe=W.painter.shadowRenderer;for(const he of J){const ye=Y.getTile(he),me=ye.getBucket(te);if(!me)continue;const xe=me.elevatedStructures;if(!xe||!xe.shadowCasterSegments||xe.shadowCasterSegments.segments[0].primitiveLength===0)continue;X.prepareDrawTile();const _e=me.bufferData.programConfigurations.get(te.id),ge=X.isTileAffectedByFog(he),Ae=X.getOrCreateProgram("elevatedStructuresDepth",{config:_e,overrideFog:ge}),je=oe.calculateShadowPassMatrixFromTile(ye.tileID.toUnwrapped());X.uploadCommonUniforms(X.context,Ae,he.toUnwrapped());const Re={u_matrix:je,u_depth_bias:0};Ae.draw(X,re.TRIANGLES,oe.getShadowPassDepthMode(),ii.disabled,oe.getShadowPassColorMode(),ai.disabled,Re,te.id,xe.vertexBuffer,xe.indexBuffer,xe.shadowCasterSegments,te.paint,X.transform.zoom,_e)}}(F)},"fill-extrusion":function(d,i,o,u){const m=o.paint.get("fill-extrusion-opacity"),y=d.context,b=y.gl,A=d.terrain,C=A&&A.renderingToTexture;if(m===0)return;const z=d.conflationActive&&d.style.isLayerClipped(o,i.getSource()),D=d.style.order.indexOf(o.fqid);if(z&&function(U,F,W,X,Y){for(const te of X){const J=F.getTile(te).getBucket(W);J&&(J.updateReplacement(te,U.replacementSource,Y),J.uploadCentroid(U.context))}}(d,i,o,u,D),A||z)for(const U of u){const F=i.getTile(U).getBucket(o);F&&Ka(d.context,i,U,F,o,A,z)}if(d.renderPass==="shadow"&&d.shadowRenderer){const U=d.shadowRenderer;if(A&&m<.65&&o._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof r.ad)return;const F=U.getShadowPassDepthMode(),W=U.getShadowPassColorMode();Dt(d,i,o,u,F,ii.disabled,W,z)}else if(d.renderPass==="translucent"){const U=!o.paint.get("fill-extrusion-pattern").constantOr(1),F=o.paint.get("fill-extrusion-color").constantOr(r.ao.white);if(!C&&F.a!==0){const W=new Rt(d.context.gl.LEQUAL,Rt.ReadWrite,d.depthRangeFor3D);m===1&&U?Dt(d,i,o,u,W,ii.disabled,bi.unblended,z):(Dt(d,i,o,u,W,ii.disabled,bi.disabled,z),Dt(d,i,o,u,W,d.stencilModeFor3D(),d.colorModeForRenderPass(),z),d.resetStencilClippingMasks())}if(d.style.enable3dLights()&&U&&(!A&&d.transform.projection.name!=="globe"||C)){const W=o.paint.get("fill-extrusion-opacity"),X=o.paint.get("fill-extrusion-ambient-occlusion-intensity"),Y=o.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),te=o.paint.get("fill-extrusion-flood-light-intensity"),J=o.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",re=o.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(J?null:o.lut).toArray01().slice(0,3),oe=X>0&&Y>0,he=te>0,ye=(_e,ge,Ae)=>(1-Ae)*_e+Ae*ge,me=new zd;me.translate=o.paint.get("fill-extrusion-translate"),me.translateAnchor=o.paint.get("fill-extrusion-translate-anchor"),me.edgeRadius=o.layout.get("fill-extrusion-edge-radius"),me.cutoffFadeRange=o.paint.get("fill-extrusion-cutoff-fade-range");const xe=_e=>{const ge=d.depthModeForSublayer(1,Rt.ReadOnly,b.LEQUAL,!0),Ae=o.paint.get(_e?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),je=ye(.1,3,Ae),Re=d._showOverdrawInspector;if(!Re){const Je=new ii({func:b.ALWAYS,mask:255},255,255,b.KEEP,b.KEEP,b.REPLACE),Ne=new bi([b.ONE,b.ONE,b.ONE,b.ONE],r.ao.transparent,[!1,!1,!1,!0],b.MIN);wa(me,d,i,o,u,ge,Je,Ne,ai.disabled,_e,"sdf",W,X,Y,te,re,je,z,!1)}{const Je=Re?ii.disabled:new ii({func:b.EQUAL,mask:255},255,255,b.KEEP,b.DECR,b.DECR),Ne=Re?d.colorModeForRenderPass():new bi([b.ONE_MINUS_DST_ALPHA,b.DST_ALPHA,b.ONE,b.ONE],r.ao.transparent,[!0,!0,!0,!0]);wa(me,d,i,o,u,ge,Je,Ne,ai.disabled,_e,"color",W,X,Y,te,re,je,z,!1)}};if(C){const _e=(ge,Ae,je)=>{const Re=d.depthModeForSublayer(1,Rt.ReadOnly,b.LEQUAL,!1),Je=o.paint.get(ge?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ne=ye(.1,3,Je);{const $e=new bi([b.ONE,b.ONE,b.ONE,b.ONE],r.ao.transparent,[!1,!1,!1,!0]);wa(me,d,i,o,u,Re,ii.disabled,$e,ai.disabled,ge,"clear",W,X,Y,te,re,Ne,z,Ae)}{const $e=new ii({func:b.ALWAYS,mask:255},255,255,b.KEEP,b.KEEP,b.REPLACE),vt=new bi([b.ONE,b.ONE,b.ONE,b.ONE],r.ao.transparent,[!1,!1,!1,!0],b.MIN);wa(me,d,i,o,u,Re,$e,vt,ai.disabled,ge,"sdf",W,X,Y,te,re,Ne,z,Ae)}{const $e=ge?b.ZERO:b.ONE_MINUS_DST_ALPHA,vt=new ii({func:b.EQUAL,mask:255},255,255,b.KEEP,b.DECR,b.DECR),Ve=new bi([$e,b.DST_ALPHA,b.ONE_MINUS_DST_ALPHA,b.ZERO],r.ao.transparent,[!0,!0,!0,!0]);wa(me,d,i,o,u,Re,vt,Ve,ai.disabled,ge,"color",W,X,Y,te,re,Ne,z,Ae)}{const $e=new bi([b.ONE,b.ONE,b.ONE,ge?b.ZERO:b.ONE],r.ao.transparent,[!1,!1,!1,!0],ge?b.FUNC_ADD:b.MAX);wa(me,d,i,o,u,Re,ii.disabled,$e,ai.disabled,ge,"clear",W,X,Y,te,re,Ne,z,Ae,je)}};if(oe||he){let ge;if(d.prepareDrawTile(),A){const Ae=A.drapeBufferSize[0],je=A.drapeBufferSize[1];ge=A.framebufferCopyTexture,ge&&(!ge||ge.size[0]===Ae&&ge.size[1]===je)||(ge&&ge.destroy(),ge=A.framebufferCopyTexture=new r.T(y,new r.q({width:Ae,height:je}),b.RGBA8)),ge.bind(b.LINEAR,b.CLAMP_TO_EDGE),b.copyTexSubImage2D(b.TEXTURE_2D,0,0,0,0,0,Ae,je)}oe&&_e(!0,!1,ge),he&&_e(!1,!0,ge)}}else oe&&xe(!0),he&&xe(!1),(oe||he)&&d.resetStencilClippingMasks()}}},building:function(d,i,o,u){d.currentLayer<d.firstLightBeamLayer&&(d.firstLightBeamLayer=d.currentLayer);const m=o.paint.get("building-ambient-occlusion-ground-intensity"),y=o.paint.get("building-ambient-occlusion-ground-radius"),b=o.paint.get("building-ambient-occlusion-ground-attenuation"),A=o.paint.get("building-opacity");if(A<=0)return;let C=m>0&&y>0,z=!0;const D=o.paint.get("building-vertical-scale");(!d.shadowRenderer||D<1)&&(z=!1);const U=d.conflationActive&&d.style.isLayerClipped(o,i.getSource()),F=d.style.order.indexOf(o.fqid);if(function(W,X,Y,te,J,re){for(const oe of re){const he=X.getTile(oe).getBucket(Y);he&&(J&&he.updateReplacement(oe,W.replacementSource,te),he.uploadUpdatedIndexBuffer(W.context))}}(d,i,o,F,U,u),function(W,X,Y,te){for(const J of te){const re=X.getTile(J).getBucket(Y);re&&re.needsEvaluation()&&re.uploadUpdatedColorBuffer(W.context)}}(d,i,o,u),o.resetLayerRenderingStats(d),d.shadowRenderer&&(d.shadowRenderer.useNormalOffset=!0),d.renderPass==="shadow"&&d.shadowRenderer){const W=d.shadowRenderer,X=[],Y=W.getShadowPassDepthMode();Xh({painter:d,source:i,layer:o,coords:u,defines:X,blendMode:W.getShadowPassColorMode(),depthMode:Y,opacity:A,verticalScale:D,facadeEmissiveChance:0,facadeAOIntensity:0})}else if(d.renderPass==="translucent"){let W=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];z&&(W=W.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),d.shadowRenderer&&d.shadowRenderer.useNormalOffset&&(W=W.concat("NORMAL_OFFSET"));const X=o.paint.get("building-facade-emissive-chance"),Y=o.paint.get("building-ambient-occlusion-intensity"),te=new Rt(d.context.gl.LEQUAL,Rt.ReadWrite,d.depthRangeFor3D);A<1&&Xh({painter:d,source:i,layer:o,coords:u,defines:W,blendMode:bi.disabled,depthMode:te,opacity:A,verticalScale:D,facadeEmissiveChance:X,facadeAOIntensity:Y});const J=d.colorModeForRenderPass();Xh({painter:d,source:i,layer:o,coords:u,defines:W,blendMode:J,depthMode:te,opacity:A,verticalScale:D,facadeEmissiveChance:X,facadeAOIntensity:Y}),C&&function(re,oe,he,ye,me,xe,_e,ge,Ae,je,Re,Je,Ne){const $e=re.context.gl,vt=re.depthModeForSublayer(1,Rt.ReadOnly,$e.LEQUAL,!0),Ve=.1*(1-(Pe=Re))+3*Pe;var Pe;const Qe=re._showOverdrawInspector,We=Je,at=new zd;Qe||wa(at,re,oe,he,ye,vt,new ii({func:$e.ALWAYS,mask:255},255,255,$e.KEEP,$e.KEEP,$e.REPLACE),new bi([$e.ONE,$e.ONE,$e.ONE,$e.ONE],r.ao.transparent,[!1,!1,!1,!0],$e.MIN),ai.disabled,me,"sdf",xe,_e,ge,0,je,Ve,We,!1);{const xt=Qe?ii.disabled:new ii({func:$e.EQUAL,mask:255},255,255,$e.KEEP,$e.DECR,$e.DECR),Pt=Qe?re.colorModeForRenderPass():new bi([$e.ONE_MINUS_DST_ALPHA,$e.DST_ALPHA,$e.ONE,$e.ONE],r.ao.transparent,[!0,!0,!0,!0]);wa(at,re,oe,he,ye,vt,xt,Pt,ai.disabled,me,"color",xe,_e,ge,0,je,Ve,We,!1)}}(d,i,o,u,!0,A,m,y,0,[0,0,0],b,U)}else if(d.renderPass==="light-beam"){const W=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],X=new Rt(d.context.gl.LEQUAL,Rt.ReadOnly,d.depthRangeFor3D);Xh({painter:d,source:i,layer:o,coords:u,defines:W,blendMode:bi.alphaBlended,depthMode:X,opacity:A,verticalScale:D,facadeEmissiveChance:0,facadeAOIntensity:0})}d.shadowRenderer&&(d.shadowRenderer.useNormalOffset=!1),d.resetStencilClippingMasks()},hillshade:function(d,i,o,u){if(d.renderPass!=="offscreen"&&d.renderPass!=="translucent"||d.style.disableElevatedTerrain)return;const m=d.context,y=d.terrain&&d.terrain.renderingToTexture,[b,A]=d.renderPass!=="translucent"||y?[{},u]:d.stencilConfigForOverlap(u);for(const C of A){const z=i.getTile(C);if(z.needsHillshadePrepare&&d.renderPass==="offscreen")bm(d,z,o);else if(d.renderPass==="translucent"){const D=d.depthModeForSublayer(0,Rt.ReadOnly),U=o.paint.get("hillshade-emissive-strength"),F=d.colorModeForDrapableLayerRenderPass(U),W=y&&d.terrain?d.terrain.stencilModeForRTTOverlap(C):b[C.overscaledZ];vm(d,C,z,o,D,W,F)}}m.viewport.set([0,0,d.width,d.height]),d.resetStencilClippingMasks()},raster:function(d,i,o,u,m,y){if(d.renderPass!=="translucent"||o.paint.get("raster-opacity")===0)return;const b=d.transform.projection.name==="globe",A=o.paint.get("raster-elevation")!==0,C=A&&b;if(d.renderElevatedRasterBackface&&!C)return;const z=d.context,D=z.gl,U=i.getSource(),F=function(me,xe,_e,ge){const Ae=xe.paint.get("raster-color"),je=me.type==="raster-array",Re=[],Je=xe.paint.get("raster-resampling"),Ne=xe.paint.get("raster-color-mix");let $e=xe.paint.get("raster-color-range");const vt=[Ne[0],Ne[1],Ne[2],0],Ve=Ne[3];let Pe=Je==="nearest"?ge.NEAREST:ge.LINEAR;if(je&&(Re.push("RASTER_ARRAY"),Ae||Re.push("RASTER_COLOR"),Je==="linear"&&Re.push("RASTER_ARRAY_LINEAR"),Pe=ge.NEAREST,!$e&&me.rasterLayers)){const Qe=me.rasterLayers.find(({id:We})=>We===xe.sourceLayer);Qe&&Qe.fields&&Qe.fields.range&&($e=Qe.fields.range)}if($e=$e||[0,1],Ae){Re.push("RASTER_COLOR"),_e.activeTexture.set(ge.TEXTURE2),xe.updateColorRamp($e);let Qe=xe.colorRampTexture;Qe||(Qe=xe.colorRampTexture=new r.T(_e,xe.colorRamp,ge.RGBA8)),Qe.bind(ge.LINEAR,ge.CLAMP_TO_EDGE)}return{mix:vt,range:$e,offset:Ve,defines:Re,resampling:Pe}}(U,o,z,D);if(U instanceof r.aS&&!u.length&&!b)return;const W=o.paint.get("raster-emissive-strength"),X=d.colorModeForDrapableLayerRenderPass(W),Y=d.terrain&&d.terrain.renderingToTexture,te=!d.options.moving,J=o.paint.get("raster-resampling")==="nearest"?D.NEAREST:D.LINEAR;if(U instanceof r.aS&&!u.length&&(U.onNorthPole||U.onSouthPole)){const me=A?d.stencilModeFor3D():ii.disabled;return void qh(!!U.onNorthPole,null,d,i,o,W,F,ai.disabled,me)}if(!u.length)return;const[re,oe]=U instanceof r.aS||Y?[{},u]:d.stencilConfigForOverlap(u),he=oe[oe.length-1].overscaledZ;C&&F.defines.push("PROJECTION_GLOBE_VIEW"),A&&F.defines.push("RENDER_CUTOFF");const ye=(me,xe,_e)=>{for(const ge of me){const Ae=ge.toUnwrapped(),je=i.getTile(ge);if(Y&&(!je||!je.hasData()))continue;z.activeTexture.set(D.TEXTURE0);const Re=Pp(je,U,o,F);if(!Re||!Re.texture)continue;const{texture:Je,mix:Ne,offset:$e,tileSize:vt,buffer:Ve}=Re;let Pe,Qe;Y?(Pe=Rt.disabled,Qe=ge.projMatrix):A?(Pe=new Rt(D.LEQUAL,Rt.ReadWrite,d.depthRangeFor3D),Qe=b?Float32Array.from(d.transform.expandedFarZProjMatrix):d.transform.calculateProjMatrix(Ae,te)):(Pe=d.depthModeForSublayer(ge.overscaledZ-he,o.paint.get("raster-opacity")===1?Rt.ReadWrite:Rt.ReadOnly,D.LESS),Qe=d.transform.calculateProjMatrix(Ae,te));const We=d.terrain&&Y?d.terrain.stencilModeForRTTOverlap(ge):re[ge.overscaledZ],at=y?0:o.paint.get("raster-fade-duration");je.registerFadeDuration(at);const xt=i.findLoadedParent(ge,0),Pt=Eo(je,xt,i,d.transform,at);let pt,ht;!Pt.isFading&&je.refreshedUponExpiration&&(je.refreshedUponExpiration=!1),d.terrain&&d.terrain.prepareDrawTile(),z.activeTexture.set(D.TEXTURE0),Je.bind(J,D.CLAMP_TO_EDGE),z.activeTexture.set(D.TEXTURE1),xt?(xt.texture&&xt.texture.bind(J,D.CLAMP_TO_EDGE),pt=Math.pow(2,xt.tileID.overscaledZ-je.tileID.overscaledZ),ht=[je.tileID.canonical.x*pt%1,je.tileID.canonical.y*pt%1]):Je.bind(J,D.CLAMP_TO_EDGE),"useMipmap"in Je&&z.extTextureFilterAnisotropic&&d.transform.pitch>20&&D.texParameterf(D.TEXTURE_2D,z.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,z.extTextureFilterAnisotropicMax);const Wt=d.transform;let Ut;const Ht=A?Bm(Wt):[0,0,0,0];let Vt,oi,yi,wi,ir,hi=0;if(C&&U instanceof r.aS&&U.coordinates.length>3)Vt=Float32Array.from(r.bk(r.dF(new r.cC(0,0,0)))),oi=Float32Array.from(Wt.globeMatrix),yi=Float32Array.from(r.dB(Wt)),wi=[r.aF(Wt.center.lng),r.aJ(Wt.center.lat)],Ut=U.elevatedGlobePerspectiveTransform,ir=U.elevatedGlobeGridMatrix||new Float32Array(9);else if(C){const xi=r.dC(ge.canonical);hi=r.dD(xi.getCenter().lat),Vt=Float32Array.from(r.bk(r.dF(ge.canonical))),oi=Float32Array.from(Wt.globeMatrix),yi=Float32Array.from(r.dB(Wt)),wi=[r.aF(Wt.center.lng),r.aJ(Wt.center.lat)],Ut=[0,0],ir=Float32Array.from(r.dE(ge.canonical,xi,hi,Wt.worldSize/Wt._pixelsPerMercatorPixel))}else Ut=U instanceof r.aS?U.perspectiveTransform:[0,0],Vt=new Float32Array(16),oi=new Float32Array(9),yi=new Float32Array(16),wi=[0,0],ir=new Float32Array(9);const Gi=Fh(Qe,Vt,oi,yi,ir,ht||[0,0],r.aj(d.transform.zoom),wi,Ht,pt||1,Pt,o,Ut,A?o.paint.get("raster-elevation"):0,2,Ne,$e,F.range,vt,Ve,W),Qi=d.isTileAffectedByFog(ge),Tr=d.getOrCreateProgram("raster",{defines:F.defines,overrideFog:Qi});if(d.uploadCommonUniforms(z,Tr,Ae),U instanceof r.aS){const xi=U.elevatedGlobeVertexBuffer,Zi=U.elevatedGlobeIndexBuffer;if(Y||!b)U.boundsBuffer&&U.boundsSegments&&Tr.draw(d,D.TRIANGLES,Pe,ii.disabled,X,ai.disabled,Gi,o.id,U.boundsBuffer,d.quadTriangleIndexBuffer,U.boundsSegments);else if(xi&&Zi){const Yi=Wt.zoom<=r.cZ?U.elevatedGlobeSegments:U.getSegmentsForLongitude(Wt.center.lng);Yi&&Tr.draw(d,D.TRIANGLES,Pe,ii.disabled,X,xe,Gi,o.id,xi,Zi,Yi)}}else if(C){Pe=new Rt(D.LEQUAL,Rt.ReadOnly,d.depthRangeFor3D);const xi=d.globeSharedBuffers;if(xi){const[Zi,Yi,Ji]=xi.getGridBuffers(hi,!1);Tr.draw(d,D.TRIANGLES,Pe,_e||We,d.colorModeForRenderPass(),xe,Gi,o.id,Zi,Yi,Ji)}}else{const{tileBoundsBuffer:xi,tileBoundsIndexBuffer:Zi,tileBoundsSegments:Yi}=d.getTileBoundsBuffers(je);Tr.draw(d,D.TRIANGLES,Pe,We,X,ai.disabled,Gi,o.id,xi,Zi,Yi)}}if(!(U instanceof r.aS)&&C)for(const ge of me){const Ae=ge.canonical.y===(1<<ge.canonical.z)-1;ge.canonical.y===0&&qh(!0,ge,d,i,o,W,F,xe,_e||ii.disabled),Ae&&qh(!1,ge,d,i,o,W,F,xe===ai.frontCW?ai.backCW:ai.frontCW,_e||ii.disabled)}};C?ye(oe,d.renderElevatedRasterBackface?ai.backCW:ai.frontCW,d.stencilModeFor3D()):ye(oe,ai.disabled,void 0),d.resetStencilClippingMasks()},"raster-particle":function(d,i,o,u,m,y){d.renderPass==="offscreen"&&function(b,A,C,z){if(!z.length)return;const D=b.context,U=D.gl,F=A.getSource();if(!(F instanceof Na))return;const W=Math.ceil(Math.sqrt(C.paint.get("raster-particle-count")));let X=C.particlePositionRGBAImage;if(!X||X.width!==W){const oe=function(he){const ye=he*he,me=new Uint8Array(4*ye),xe=function(ge){return ge|=0,ge=Math.imul(2747636419^ge,2654435769),ge=Math.imul(ge^ge>>>16,2654435769),((ge=Math.imul(ge^ge>>>16,2654435769))>>>0)/4294967296},_e=1/1.1;for(let ge=0;ge<ye;ge++){const Ae=_e*(xe(2*ge+0)+ko),je=_e*(xe(2*ge+1)+ko),Re=255*Ae%1,Je=255*je%1,Ne=Re,$e=je-Je/255,vt=Je;me[4*ge+0]=255*(Ae-Re/255),me[4*ge+1]=255*Ne,me[4*ge+2]=255*$e,me[4*ge+3]=255*vt}return me}(W);X=C.particlePositionRGBAImage=new r.q({width:W,height:W},oe)}let Y=C.particleFramebuffer;Y?Y.width!==W&&(Y.destroy(),Y=C.particleFramebuffer=D.createFramebuffer(W,W,!0,null)):Y=C.particleFramebuffer=D.createFramebuffer(W,W,!0,null);const te=[];for(const oe of z){const he=A.getTile(oe);if(!(he instanceof ic))continue;const ye=ln(he,F,C);if(!ye)continue;const me=[he.tileSize,he.tileSize];let xe=C.tileFramebuffer;xe||(xe=C.tileFramebuffer=D.createFramebuffer(me[0],me[1],!0,null));let _e=he.rasterParticleState;_e||(_e=he.rasterParticleState=new Vm(D,oe,me,X));const ge=_e.update(C.lastInvalidatedAt);_e.particleTextureDimension!==W&&_e.updateParticleTexture(oe,X);const Ae=_e.targetColorTexture;_e.targetColorTexture=_e.backgroundColorTexture,_e.backgroundColorTexture=Ae;const je=_e.particleTexture0;_e.particleTexture0=_e.particleTexture1,_e.particleTexture1=je,te.push([oe,ye,_e,ge])}if(te.length===0)return;const J=r.o.now(),re=C.previousDrawTimestamp?.001*(J-C.previousDrawTimestamp):.0167;if(C.previousDrawTimestamp=J,C.hasColorMap()){D.activeTexture.set(U.TEXTURE0+2);let oe=C.colorRampTexture;oe||(oe=C.colorRampTexture=new r.T(D,C.colorRamp,U.RGBA8)),oe.bind(U.LINEAR,U.CLAMP_TO_EDGE)}D.bindFramebuffer.set(C.tileFramebuffer.framebuffer),function(oe,he,ye){const me=oe.context,xe=me.gl,_e=he.tileFramebuffer;me.activeTexture.set(xe.TEXTURE0);const ge={u_texture:0,u_opacity:1.05*(je=he.paint.get("raster-particle-fade-opacity-factor"))/(je+.05)},Ae=oe.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var je;for(const Re of ye){const[,,Je,Ne]=Re;_e.colorAttachment.set(Je.targetColorTexture.texture),me.viewport.set([0,0,_e.width,_e.height]),me.clear({color:r.ao.transparent}),Ne&&(Je.backgroundColorTexture.bind(xe.NEAREST,xe.CLAMP_TO_EDGE),Ae.draw(oe,xe.TRIANGLES,Rt.disabled,ii.disabled,bi.alphaBlended,ai.disabled,ge,he.id,oe.viewportBuffer,oe.quadTriangleIndexBuffer,oe.viewportSegments))}}(b,C,te),function(oe,he,ye,me){const xe=oe.context,_e=xe.gl,ge=ye.tileFramebuffer,Ae=oe.transform.projection.name==="globe",je=ye.paint.get("raster-particle-max-speed");for(const Re of me){const[Je,Ne,$e]=Re;xe.activeTexture.set(_e.TEXTURE0+0),Ne.texture.bind(_e.LINEAR,_e.CLAMP_TO_EDGE),ge.colorAttachment.set($e.targetColorTexture.texture);const vt=oe.getOrCreateProgram("rasterParticleDraw",{defines:Ne.defines,overrideFog:!1});xe.activeTexture.set(_e.TEXTURE0+1);const Ve=Ne.scalarData?[]:[0,1,2,3].map(We=>r.e6[We](Je));Ve.push(Je);const Pe=Je.canonical.x,Qe=Je.canonical.y;for(const We of Ve){const at=he.getTile(Ae?We.wrapped():We);if(!at)continue;const xt=at.rasterParticleState;if(!xt)continue;const Pt=We.canonical.x+(1<<We.canonical.z)*(We.wrap-Je.wrap),pt=We.canonical.y;xt.particleTexture0.bind(_e.NEAREST,_e.CLAMP_TO_EDGE);const ht=Cd(1,xt.particleTexture0.size[0],[Pt-Pe,pt-Qe],0,Ne.texture.size,2,je,Ne.textureOffset,Ne.scale,Ne.offset);vt.draw(oe,_e.POINTS,Rt.disabled,ii.disabled,bi.alphaBlended,ai.disabled,ht,ye.id,xt.particleIndexBuffer,void 0,xt.particleSegment)}}}(b,A,C,te),D.bindFramebuffer.set(C.particleFramebuffer.framebuffer),function(oe,he,ye,me){const xe=oe.context,_e=xe.gl,ge=he.paint.get("raster-particle-max-speed"),Ae=me*he.paint.get("raster-particle-speed-factor")*.15,je=function(Je){return Math.pow(Je,6)}(.01+1*he.paint.get("raster-particle-reset-rate-factor")),Re=he.particleFramebuffer;xe.viewport.set([0,0,Re.width,Re.height]);for(const Je of ye){const[,Ne,$e]=Je;xe.activeTexture.set(_e.TEXTURE0+0),Ne.texture.bind(_e.LINEAR,_e.CLAMP_TO_EDGE),xe.activeTexture.set(_e.TEXTURE0+1);const vt=$e.particleTexture0;vt.bind(_e.NEAREST,_e.CLAMP_TO_EDGE);const Ve=Bh(1,vt.size[0],0,Ne.texture.size,ge,Ae,je,Ne.textureOffset,Ne.scale,Ne.offset);Re.colorAttachment.set($e.particleTexture1.texture),xe.clear({color:r.ao.transparent}),oe.getOrCreateProgram("rasterParticleUpdate",{defines:Ne.defines}).draw(oe,_e.TRIANGLES,Rt.disabled,ii.disabled,bi.unblended,ai.disabled,Ve,he.id,oe.viewportBuffer,oe.quadTriangleIndexBuffer,oe.viewportSegments)}}(b,C,te,re)}(d,i,o,u),d.renderPass==="translucent"&&(function(b,A,C,z,D){const U=b.context,F=U.gl,W=A.getSource().tileSize,X=5*(1-r.ah(r.cK,r.cK+1,b.transform.zoom))*W+C.paint.get("raster-particle-elevation"),Y=!b.options.moving,te=b.transform.projection.name==="globe";if(!z.length)return;const[J,re]=b.stencilConfigForOverlap(z),oe=[];te&&oe.push("PROJECTION_GLOBE_VIEW");const he=b.stencilModeFor3D();for(const ye of re){const me=ye.toUnwrapped(),xe=A.getTile(ye);if(!xe.rasterParticleState)continue;const _e=xe.rasterParticleState,ge=100;xe.registerFadeDuration(ge);const Ae=A.findLoadedParent(ye,0),je=Eo(xe,Ae,A,b.transform,ge);let Re,Je;b.terrain&&b.terrain.prepareDrawTile(),U.activeTexture.set(F.TEXTURE0),_e.targetColorTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),U.activeTexture.set(F.TEXTURE1),Ae&&Ae.rasterParticleState?(Ae.rasterParticleState.targetColorTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),Re=Math.pow(2,Ae.tileID.overscaledZ-xe.tileID.overscaledZ),Je=[xe.tileID.canonical.x*Re%1,xe.tileID.canonical.y*Re%1]):_e.targetColorTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE);const Ne=te?Float32Array.from(b.transform.expandedFarZProjMatrix):b.transform.calculateProjMatrix(me,Y),$e=b.transform,vt=Dd($e),Ve=r.dC(ye.canonical),Pe=r.dD(Ve.getCenter().lat);let Qe,We,at,xt,Pt;te?(Qe=Float32Array.from(r.bk(r.dF(ye.canonical))),We=Float32Array.from($e.globeMatrix),at=Float32Array.from(r.dB($e)),xt=[r.aF($e.center.lng),r.aJ($e.center.lat)],Pt=Float32Array.from(r.dE(ye.canonical,Ve,Pe,$e.worldSize/$e._pixelsPerMercatorPixel))):(Qe=new Float32Array(16),We=new Float32Array(9),at=new Float32Array(16),xt=[0,0],Pt=new Float32Array(9));const pt=Za(Ne,Qe,We,at,Pt,Je||[0,0],r.aj(b.transform.zoom),xt,vt,Re||1,je,X),ht=b.isTileAffectedByFog(ye),Wt=b.getOrCreateProgram("rasterParticle",{defines:oe,overrideFog:ht});if(b.uploadCommonUniforms(U,Wt,me),te){const Ut=new Rt(F.LEQUAL,Rt.ReadOnly,b.depthRangeFor3D),Ht=0,Vt=b.globeSharedBuffers;if(Vt){const[oi,yi,wi]=Vt.getGridBuffers(Pe,Ht!==0);Wt.draw(b,F.TRIANGLES,Ut,he,bi.alphaBlended,b.renderElevatedRasterBackface?ai.frontCCW:ai.backCCW,pt,C.id,oi,yi,wi)}}else{const Ut=b.depthModeForSublayer(0,Rt.ReadOnly),Ht=J[ye.overscaledZ],{tileBoundsBuffer:Vt,tileBoundsIndexBuffer:oi,tileBoundsSegments:yi}=b.getTileBoundsBuffers(xe);Wt.draw(b,F.TRIANGLES,Ut,Ht,bi.alphaBlended,ai.disabled,pt,C.id,Vt,oi,yi)}}b.resetStencilClippingMasks()}(d,i,o,u),d.style.map.triggerRepaint())},background:function(d,i,o,u){const m=o.paint.get("background-color"),y=o.paint.get("background-color-use-theme").constantOr("default")==="none",b=o.paint.get("background-opacity"),A=o.paint.get("background-emissive-strength"),C=o.paint.get("background-pitch-alignment")==="viewport";if(b===0)return;const z=d.context,D=z.gl,U=d.transform,F=U.tileSize,W=o.paint.get("background-pattern");let X;if(W!==void 0&&(W===null||(X=d.imageManager.getPattern(r.I.from(W.toString()),o.scope,d.style.getLut(o.scope)),!X)))return;const Y=!W&&m.a===1&&b===1&&d.opaquePassEnabledForLayer()?"opaque":"translucent";if(d.renderPass!==Y)return;const te=ii.disabled,J=d.depthModeForSublayer(0,Y==="opaque"?Rt.ReadWrite:Rt.ReadOnly),re=d.colorModeForDrapableLayerRenderPass(A),oe=W?"backgroundPattern":"background";let he,ye=u;if(ye||(he=d.getBackgroundTiles(),ye=Object.values(he).map(me=>me.tileID)),W&&(z.activeTexture.set(D.TEXTURE0),d.imageManager.bind(d.context,o.scope)),C){const me=d.getOrCreateProgram(oe,{overrideFog:!1,overrideRtt:!0}),xe=new Float32Array(r.bA([])),_e=new r.aO(0,0,0,0,0),ge=W?Vh(xe,A,b,d,0,o.scope,X,C,{tileID:_e,tileSize:F}):Nh(xe,A,b,m.toPremultipliedRenderColor(y?null:o.lut));me.draw(d,D.TRIANGLES,J,te,re,ai.disabled,ge,o.id,d.viewportBuffer,d.quadTriangleIndexBuffer,d.viewportSegments)}else for(const me of ye){const xe=d.isTileAffectedByFog(me),_e=d.getOrCreateProgram(oe,{overrideFog:xe}),ge=me.toUnwrapped(),Ae=u?me.projMatrix:d.transform.calculateProjMatrix(ge);d.prepareDrawTile();const je=i?i.getTile(me):he?he[me.key]:new Ua(me,F,U.zoom,d),Re=W?Vh(Ae,A,b,d,0,o.scope,X,C,{tileID:me,tileSize:F}):Nh(Ae,A,b,m.toPremultipliedRenderColor(y?null:o.lut));d.uploadCommonUniforms(z,_e,ge);const{tileBoundsBuffer:Je,tileBoundsIndexBuffer:Ne,tileBoundsSegments:$e}=d.getTileBoundsBuffers(je);_e.draw(d,D.TRIANGLES,J,te,re,ai.disabled,Re,o.id,Je,Ne,$e)}},sky:function(d,i,o){const u=d._atmosphere?r.aj(d.transform.zoom):1,m=o.paint.get("sky-opacity")*u;if(m===0)return;const y=d.context,b=o.paint.get("sky-type"),A=new Rt(y.gl.LEQUAL,Rt.ReadOnly,[0,1]),C=d.frameCounter/1e3%1;b==="atmosphere"?d.renderPass==="offscreen"?o.needsSkyboxCapture(d)&&(function(z,D,U,F){const W=z.context,X=W.gl;let Y=D.skyboxFbo;if(!Y){Y=D.skyboxFbo=W.createFramebuffer(32,32,!0,null),D.skyboxGeometry=new Nd(W),D.skyboxTexture=W.gl.createTexture(),X.bindTexture(X.TEXTURE_CUBE_MAP,D.skyboxTexture),X.texParameteri(X.TEXTURE_CUBE_MAP,X.TEXTURE_WRAP_S,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_CUBE_MAP,X.TEXTURE_WRAP_T,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_CUBE_MAP,X.TEXTURE_MIN_FILTER,X.LINEAR),X.texParameteri(X.TEXTURE_CUBE_MAP,X.TEXTURE_MAG_FILTER,X.LINEAR);for(let oe=0;oe<6;++oe)X.texImage2D(X.TEXTURE_CUBE_MAP_POSITIVE_X+oe,0,X.RGBA,32,32,0,X.RGBA,X.UNSIGNED_BYTE,null)}W.bindFramebuffer.set(Y.framebuffer),W.viewport.set([0,0,32,32]);const te=D.getCenter(z,!0),J=z.getOrCreateProgram("skyboxCapture"),re=new Float64Array(16);r.bA(re),r.ek(re,re,.5*-Math.PI),zo(z,D,J,re,te,0),r.bA(re),r.ek(re,re,.5*Math.PI),zo(z,D,J,re,te,1),r.bA(re),r.cT(re,re,.5*-Math.PI),zo(z,D,J,re,te,2),r.bA(re),r.cT(re,re,.5*Math.PI),zo(z,D,J,re,te,3),r.bA(re),zo(z,D,J,re,te,4),r.bA(re),r.ek(re,re,Math.PI),zo(z,D,J,re,te,5),W.viewport.set([0,0,z.width,z.height])}(d,o),o.markSkyboxValid(d)):d.renderPass==="sky"&&function(z,D,U,F,W){const X=z.context,Y=X.gl,te=z.transform,J=z.getOrCreateProgram("skybox");X.activeTexture.set(Y.TEXTURE0),Y.bindTexture(Y.TEXTURE_CUBE_MAP,D.skyboxTexture);const re=((oe,he,ye,me,xe)=>({u_matrix:oe,u_sun_direction:he,u_cubemap:0,u_opacity:me,u_temporal_offset:xe}))(te.skyboxMatrix,D.getCenter(z,!1),0,F,W);z.uploadCommonUniforms(X,J),J.draw(z,Y.TRIANGLES,U,ii.disabled,z.colorModeForRenderPass(),ai.backCW,re,"skybox",D.skyboxGeometry.vertexBuffer,D.skyboxGeometry.indexBuffer,D.skyboxGeometry.segment)}(d,o,A,m,C):b==="gradient"&&d.renderPass==="sky"&&function(z,D,U,F,W){const X=z.context,Y=X.gl,te=z.transform,J=z.getOrCreateProgram("skyboxGradient");D.skyboxGeometry||(D.skyboxGeometry=new Nd(X)),X.activeTexture.set(Y.TEXTURE0);let re=D.colorRampTexture;re||(re=D.colorRampTexture=new r.T(X,D.colorRamp,Y.RGBA8)),re.bind(Y.LINEAR,Y.CLAMP_TO_EDGE);const oe=((he,ye,me,xe,_e)=>({u_matrix:he,u_color_ramp:0,u_center_direction:ye,u_radius:r.an(me),u_opacity:xe,u_temporal_offset:_e}))(te.skyboxMatrix,D.getCenter(z,!1),D.paint.get("sky-gradient-radius"),F,W);z.uploadCommonUniforms(X,J),J.draw(z,Y.TRIANGLES,U,ii.disabled,z.colorModeForRenderPass(),ai.backCW,oe,"skyboxGradient",D.skyboxGeometry.vertexBuffer,D.skyboxGeometry.indexBuffer,D.skyboxGeometry.segment)}(d,o,A,m,C)},custom:function(d,i,o,u){const m=d.context,y=o.implementation;if(!d.transform.projection.unsupportedLayers||!d.transform.projection.unsupportedLayers.includes("custom")||d.terrain&&(d.terrain.renderingToTexture||d.renderPass==="offscreen")&&o.isDraped(i)){if(d.renderPass==="offscreen"){const b=y.prerender;if(b){if(d.setCustomLayerDefaults(),m.setColorMode(d.colorModeForRenderPass()),d.transform.projection.name==="globe"){const A=d.transform.pointMerc;b.call(y,m.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),r.aj(d.transform.zoom),[A.x,A.y],d.transform.pixelsPerMeterRatio)}else b.call(y,m.gl,d.transform.customLayerMatrix());m.setDirty(),d.setBaseState()}}else if(d.renderPass==="translucent"){if(d.terrain&&d.terrain.renderingToTexture){const A=y.renderToTile;if(A){const C=u[0].canonical,z={x:C.x+u[0].wrap*(y.wrapTileId?0:1<<C.z),y:C.y,z:C.z};m.setDepthMode(Rt.disabled),m.setStencilMode(ii.disabled),m.setColorMode(d.colorModeForRenderPass()),d.setCustomLayerDefaults(),A.call(y,m.gl,z),m.setDirty(),d.setBaseState()}return}d.setCustomLayerDefaults(),m.setColorMode(d.colorModeForRenderPass()),m.setStencilMode(ii.disabled);const b=y.renderingMode==="3d"?new Rt(d.context.gl.LEQUAL,Rt.ReadWrite,d.depthRangeFor3D):d.depthModeForSublayer(0,Rt.ReadOnly);if(m.setDepthMode(b),d.transform.projection.name==="globe"){const A=d.transform.pointMerc;y.render(m.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),r.aj(d.transform.zoom),[A.x,A.y],d.transform.pixelsPerMeterRatio)}else y.render(m.gl,d.transform.customLayerMatrix());m.setDirty(),d.setBaseState(),m.bindFramebuffer.set(null)}}else r.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(d,i,o,u){if(d.renderPass==="opaque")return;const m=o.paint.get("model-opacity").constantOr(1);if(m===0)return;const y=o.paint.get("model-cast-shadows");if(d.renderPass==="shadow"&&(!y||d.terrain&&m<.65&&o._transitionablePaint._values["model-opacity"].value.expression instanceof r.ad))return;const b=d.shadowRenderer,A=o.paint.get("model-receive-shadows");b&&(b.useNormalOffset=!0,A||(b.enabled=!1));const C=()=>{b&&(b.useNormalOffset=!0,A||(b.enabled=!0))},z=i.getSource();if(d.renderPass==="light-beam"&&z.type!=="batched-model")return;if(z.type==="vector"||z.type==="geojson")return function(J,re,oe,he,ye){const me=J.transform;if(me.projection.name!=="mercator")return void r.w(`Drawing 3D models for ${me.projection.name} projection is not yet implemented`);const xe=me.getFreeCameraOptions().position;if(!J.modelManager)return;const _e=J.modelManager;oe.modelManager=_e;const ge=J.shadowRenderer;if(!oe._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Ae=oe._unevaluatedLayout._values["model-id"],je=Object.assign({},oe.layout.get("model-id").parameters),Re=J.style.order.indexOf(oe.fqid);for(const Je of he){const Ne=re.getTile(Je).getBucket(oe);if(!Ne||Ne.projection.name!==me.projection.name)continue;const $e=Ne.getModelUris();$e&&!Ne.modelsRequested&&(_e.addModelsFromBucket($e,ye),Ne.modelsRequested=!0);const vt=xl(Je,me);je.zoom=vt;const Ve=Ae.possiblyEvaluate(je);if(Rp(J,Ne,Je),Hn.shadowUniformsInitialized=!1,Hn.useSingleShadowCascade=!!ge&&ge.getMaxCascadeForTile(Je.toUnwrapped())===0,J.renderPass==="shadow"&&ge){if(J.currentShadowCascade===1&&Ne.isInsideFirstShadowMapFrustum)continue;const We=me.calculatePosMatrix(Je.toUnwrapped(),me.worldSize);if(Hn.tileMatrix.set(We),Hn.shadowTileMatrix=Float32Array.from(ge.calculateShadowPassMatrixFromMatrix(We)),Hn.aabb.min=[0,0,0],Hn.aabb.max[0]=Hn.aabb.max[1]=r.al,Hn.aabb.max[2]=0,Op(Ne,Hn,J,oe.scope))continue}const Pe=1<<Je.canonical.z,Qe=[((xe.x-Je.wrap)*Pe-Je.canonical.x)*r.al,(xe.y*Pe-Je.canonical.y)*r.al,xe.z*Pe*r.al];J.conflationActive&&Object.keys(Ne.instancesPerModel).length>0&&J.style.isLayerClipped(oe,re.getSource())&&Ne.updateReplacement(Je,J.replacementSource,Re,ye)&&(Ne.uploaded=!1,Ne.upload(J.context));for(let We in Ne.instancesPerModel){const at=Ne.instancesPerModel[We];at.features.length>0&&(We=Ve.evaluate(at.features[0].feature,{}));const xt=_e.getModel(We,ye);if(xt||_e.hasURLBeenRequested(We)||Ne.modelUris.includes(We)||(Ne.modelUris.push(We),Ne.modelsRequested=!1),xt&&xt.uploaded)for(const Pt of xt.nodes)Dp(J,oe,Pt,at,Qe,Je,Hn)}}}(d,i,o,u,z.type==="vector"?o.scope:""),void C();if(!z.loaded())return;if(z.type==="batched-model")return function(J,re,oe,he){oe.resetLayerRenderingStats(J);const ye=J.context,me=J.transform,xe=J.style.fog,_e=J.shadowRenderer;if(me.projection.name!=="mercator")return void r.w(`Drawing 3D landmark models for ${me.projection.name} projection is not yet implemented`);const ge=J.transform.getFreeCameraOptions().position,Ae=r.c4([],[ge.x,ge.y,ge.z],J.transform.worldSize),je=r.et([],Ae),Re=r.bA([]),Je=r.ec(me.center.lat,me.zoom),Ne=r.bq([],[1,1,1/Je]);r.br(Re,Re,je);const $e=oe.paint.get("model-opacity").constantOr(1),vt=new Rt(ye.gl.LEQUAL,Rt.ReadWrite,J.depthRangeFor3D),Ve=new Rt(ye.gl.LEQUAL,Rt.ReadOnly,J.depthRangeFor3D),Pe=new r.d8([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),Qe=J.renderPass==="shadow",We=Qe&&_e?_e.getCurrentCascadeFrustum():me.getFrustum(me.scaleZoom(me.worldSize)),at=oe.paint.get("model-front-cutoff"),xt=at[2]<1,Pt=Ga(J,oe.paint.get("model-cutoff-fade-range")),pt=oe.getLayerRenderingStats();(function(ht,Wt,Ut,Ht){const Vt=ht.terrain?ht.terrain.exaggeration():0,oi=ht.transform.zoom;for(const yi of Ht){const wi=Wt.getTile(yi).getBucket(Ut);wi&&(wi.setFilter(Ut.filter),ht.conflationActive&&wi.updateReplacement(yi,ht.replacementSource),wi.evaluateTransform(ht,Ut),ht.terrain&&Vt>0&&wi.elevationUpdate(ht.terrain,Vt,yi,Ut.source),wi.needsReEvaluation(ht,oi,Ut)&&wi.evaluate(Ut))}})(J,re,oe,he),function(){let ht,Wt,Ut;xt?(ht=he.length-1,Wt=-1,Ut=-1):(ht=0,Wt=he.length,Ut=1);const Ht=new Float64Array(16),Vt=r.cz(),oi=new r.P(0,0);for(let yi=ht;yi!==Wt;yi+=Ut){const wi=he[yi],ir=re.getTile(wi).getBucket(oe);if(!ir||!ir.uploaded)continue;let hi=!1;_e&&(hi=_e.getMaxCascadeForTile(wi.toUnwrapped())===0);const Gi=me.calculatePosMatrix(wi.toUnwrapped(),me.worldSize),Qi=ir.modelTraits;!Qe&&xt&&(r.bl(Ht,Gi),r.af(Vt,Ae,Ht),oi.x=Vt[0],oi.y=Vt[1]);const Tr=[];ir.setFilter(oe.filter);for(const xi of ir.getNodesInfo()){if(xi.hiddenByReplacement||!xi.node.meshes)continue;const Zi=xi.node;let Yi=0;J.terrain&&Zi.elevation&&(Yi=Zi.elevation*J.terrain.exaggeration());const Ji=(()=>{const Ts=xi.aabb;return Pe.min=[...Ts.min],Pe.max=[...Ts.max],Pe.min[2]+=Yi,Pe.max[2]+=Yi,r.af(Pe.min,Pe.min,Gi),r.af(Pe.max,Pe.max,Gi),Pe})(),Cr=xi.evaluatedScale;if(Cr[0]<=1&&Cr[1]<=1&&Cr[2]<=1&&Ji.intersects(We)===0)continue;if(!Qe&&xt){const Ts=.16666666666666666;xi.cameraCollisionOpacity=Ae[0]>Ji.min[0]&&Ae[0]<Ji.max[0]&&Ae[1]>Ji.min[1]&&Ae[1]<Ji.max[1]&&Ae[2]*Je<Ji.max[2]&&Zi.footprint&&r.b$(oi,Zi.footprint)?Math.max(xi.cameraCollisionOpacity-Ts,0):Math.min(1,xi.cameraCollisionOpacity+Ts)}const qr=[...Gi],xs=1/r.d6(wi.canonical),Ir=Zi.anchor?Zi.anchor[0]:0,Si=Zi.anchor?Zi.anchor[1]:0;r.br(qr,qr,[Ir*(Cr[0]-1)+xi.evaluatedTranslation[0]*xs,Si*(Cr[1]-1)+xi.evaluatedTranslation[1]*xs,Yi+xi.evaluatedTranslation[2]]),r.cp(Cr,r.ev)||r.cR(qr,qr,Cr);const ri=r.aB([],qr,Zi.matrix),rr=r.aB([],me.expandedFarZProjMatrix,ri),Vr=r.aB([],me.expandedFarZProjMatrix,qr),Mr=r.aC([],[Ir,Si,Yi,1],rr)[2];Zi.hidden=!1;let is=$e;Qe||(xt&&(is*=xi.cameraCollisionOpacity,is*=Vd(qr,me,xi.aabb,at)),is*=Kh(Pt,Mr)),is!==0?Tr.push({nodeInfo:xi,depth:Mr,opacity:is,wvpForNode:rr,wvpForTile:Vr,nodeModelMatrix:ri,tileModelMatrix:qr}):Zi.hidden=!0}Qe||Tr.sort((xi,Zi)=>!xt||xi.opacity===1&&Zi.opacity===1?xi.depth<Zi.depth?-1:1:xi.opacity===1?-1:Zi.opacity===1?1:xi.depth>Zi.depth?-1:1);for(const xi of Tr){const Zi=xi.nodeInfo,Yi=Zi.node;let Ji=r.aB([],Ne,xi.tileModelMatrix);r.aB(Ji,Re,Ji);const Cr=r.bl([],Ji);r.ed(Cr,Cr),r.cR(Cr,Cr,Um),Ji=r.aB(Ji,Ji,Yi.matrix);const qr=J.renderPass==="light-beam",xs=oe.paint.get("model-color-use-theme").constantOr("default")==="none",Ir=Qi&r.ez.HasMapboxMeshFeatures,Si=Ir?0:Zi.evaluatedRMEA[0][2];for(let ri=0;ri<Yi.meshes.length;++ri){const rr=Yi.meshes[ri],Vr=ri===Yi.lightMeshIndex;let Mr=xi.wvpForNode;if(Vr){if(!qr&&!J.terrain&&J.shadowRenderer){J.currentLayer<J.firstLightBeamLayer&&(J.firstLightBeamLayer=J.currentLayer);continue}Mr=xi.wvpForTile}else if(qr)continue;const is={defines:[]},Ts=[];if(!Qe&&_e&&(_e.useNormalOffset=!!rr.normalBuffer),$h(is.defines,Ts,rr,J,xs?null:oe.lut),Ir||is.defines.push("DIFFUSE_SHADED"),hi&&is.defines.push("SHADOWS_SINGLE_CASCADE"),pt&&(Qe?pt.numRenderedVerticesInShadowPass+=rr.vertexArray.length:pt.numRenderedVerticesInTransparentPass+=rr.vertexArray.length),Qe){Sc(rr,xi.nodeModelMatrix,J,oe);continue}let Sn=null;if(xe){const Xn=Fe(xi.nodeModelMatrix,J.transform);if(Sn=new Float32Array(Xn),me.projection.name!=="globe"){const Gr=rr.aabb.min,Zr=rr.aabb.max,[Pr,us]=xe.getOpacityForBounds(Xn,Gr[0],Gr[1],Zr[0],Zr[1]);is.overrideFog=Pr>=Zt||us>=Zt}}const An=rr.material;let cn;An.occlusionTexture&&An.occlusionTexture.offsetScale&&(cn=An.occlusionTexture.offsetScale,is.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const hn=J.getOrCreateProgram("model",is);!Qe&&_e&&_e.setupShadowsFromMatrix(xi.tileModelMatrix,hn,_e.useNormalOffset),J.uploadCommonUniforms(ye,hn,null,Sn);const Ys=An.pbrMetallicRoughness;Ys.metallicFactor=.9,Ys.roughnessFactor=.5;const Ln=Uh(new Float32Array(Mr),new Float32Array(Ji),new Float32Array(Cr),new Float32Array(Yi.matrix),J,xi.opacity,Ys.baseColorFactor,An.emissiveFactor,Ys.metallicFactor,Ys.roughnessFactor,An,Si,oe,[0,0,0],cn);!Vr&&(Zi.hasTranslucentParts||xi.opacity<1)&&hn.draw(J,ye.gl.TRIANGLES,vt,ii.disabled,bi.disabled,ai.backCCW,Ln,oe.id,rr.vertexBuffer,rr.indexBuffer,rr.segments,oe.paint,J.transform.zoom,void 0,Ts),hn.draw(J,ye.gl.TRIANGLES,Vr?Ve:vt,ii.disabled,Vr||xi.opacity<1||Zi.hasTranslucentParts?bi.alphaBlended:bi.unblended,ai.backCCW,Ln,oe.id,rr.vertexBuffer,rr.indexBuffer,rr.segments,oe.paint,J.transform.zoom,void 0,Ts)}}}}()}(d,i,o,u),void C();if(z.type!=="model")return;const D=z.getModels(),U=[],F=d.transform.getFreeCameraOptions().position,W=r.c4([],[F.x,F.y,F.z],d.transform.worldSize);r.et(W,W);const X=[],Y=[];let te=0;for(const J of D){const re=o.paint.get("model-rotation").constantOr(null),oe=o.paint.get("model-scale").constantOr(null),he=o.paint.get("model-translation").constantOr(null);J.computeModelMatrix(d,re,oe,he,!0,!0,!1);const ye=r.bA([]),me=r.ec(J.position.lat,d.transform.zoom),xe=r.bq([],[1,1,1/me]);r.br(ye,ye,W),U.push({zScaleMatrix:xe,negCameraPosMatrix:ye});for(const _e of J.nodes)Jh(d.transform,_e,J.matrix,d.transform.expandedFarZProjMatrix,te,X,Y);te++}if(X.sort((J,re)=>re.depth-J.depth),d.renderPass!=="shadow"){if(m===1)for(const J of Y)Oo(J,d,o,U[J.modelIndex],ii.disabled,d.colorModeForRenderPass());else{for(const J of Y)Oo(J,d,o,U[J.modelIndex],ii.disabled,bi.disabled);for(const J of Y)Oo(J,d,o,U[J.modelIndex],d.stencilModeFor3D(),d.colorModeForRenderPass());d.resetStencilClippingMasks()}for(const J of X)Oo(J,d,o,U[J.modelIndex],ii.disabled,d.colorModeForRenderPass());C()}else{for(const J of Y)Sc(J.mesh,J.nodeModelMatrix,d,o);for(const J of X)Sc(J.mesh,J.nodeModelMatrix,d,o);C()}}},Fo={line:function(d,i,o){if(d.hasElevatedBuckets=!1,d.hasNonElevatedBuckets=!1,d._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||d._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(i){const u=i.getVisibleCoordinates();for(const m of u){const y=i.getTile(m).getBucket(d);if(y&&(y.elevationType!=="none"?d.hasElevatedBuckets=!0:d.hasNonElevatedBuckets=!0,d.hasElevatedBuckets&&d.hasNonElevatedBuckets))break}}}else d.hasNonElevatedBuckets=!0},model:function(d,i,o){const u=i.getSource();if(!u.loaded())return;if(u.type==="vector"||u.type==="geojson")return void(o.modelManager&&o.modelManager.upload(o,u.type==="vector"?d.scope:""));if(u.type==="batched-model"||u.type!=="model")return;const m=u.getModels();for(const y of m)y.upload(o.context)},raster:function(d,i,o){const u=i.getSource();if(!(u instanceof Na&&u.loaded()))return;const m=d.sourceLayer||u.rasterLayerIds&&u.rasterLayerIds[0];if(!m)return;const y=d.paint.get("raster-array-band")||u.getInitialBand(m);if(y==null)return;const b=i.getIds().map(A=>i.getTileByID(A));for(const A of b)A.updateNeeded(d.id,y)&&u.prepareTile(A,m,d.id,y)},"raster-particle":function(d,i,o){const u=i.getSource();if(!(u instanceof Na&&u.loaded()))return;const m=d.sourceLayer||u.rasterLayerIds&&u.rasterLayerIds[0];if(!m)return;const y=d.paint.get("raster-particle-array-band")||u.getInitialBand(m);if(y==null)return;const b=i.getIds().map(A=>i.getTileByID(A));for(const A of b)A.updateNeeded(d.id,y)&&u.prepareTile(A,m,d.id,y)}},Bo={fill:Mo},ro={fill:function(d,i,o,u){if(!o.layout||o.layout.get("fill-elevation-reference")==="none")return;const m=d.context.gl,y=new Rt(m.LEQUAL,Rt.ReadOnly,d.depthRangeFor3D),b=new ii({func:m.ALWAYS,mask:255},255,255,m.KEEP,m.KEEP,m.REPLACE),A=d.transform.getFreeCameraOptions().position,C=d.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const z of u){const D=i.getTile(z),U=D.getBucket(o);if(!U)continue;const F=U.elevatedStructures;if(!F||F.depthSegments.segments[0].primitiveLength===0)continue;const W=kp(z.toUnwrapped(),A),X=d.translatePosMatrix(z.projMatrix,D,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor")),Y=Oh(X,W,0,1,0);C.draw(d,m.TRIANGLES,y,b,bi.disabled,ai.disabled,Y,o.id,F.vertexBuffer,F.indexBuffer,F.depthSegments,o.paint,d.transform.zoom)}}};class jd{constructor(i,o,u,m,y,b){this.context=new Pd(i,o),this.transform=u,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=y,this._timeStamp=r.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const A=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const z of A)this._debugParams.enabledLayers[z]=!0;y.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),y.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),y.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),y.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),y.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),y.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const z of A)y.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],z);this.occlusionParams=new Qh(y),this.setup(),this.numSublayers=mn.maxUnderzooming+mn.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new r.eG,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new gm(this),this._wireframeDebugCache=new Bp,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const C=new r.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new r.T(this.context,C,i.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=m,this.worldview=b}updateTerrain(i,o){const u=!!i&&!!i.terrain&&this.transform.projection.supportsTerrain;if(!(u||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new yc(this,i));const m=this._terrain;this.transform.elevation=u?m:null,m.update(i,this.transform,o),this.transform.elevation&&!m.enabled&&(this.transform.elevation=null)}_updateFog(i){const o=i.fog;if(!o||this.transform.projection.name==="globe"||o.getOpacity(this.transform.pitch)<1||o.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[u,m]=o.getFovAdjustedRange(this.transform._fov);if(u>m)return void(this.transform.fogCullDistSq=null);const y=u+.78*(m-u);this.transform.fogCullDistSq=y*y}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(i){i&&!this._terrain&&(this._terrain=new yc(this,this.style)),this._forceTerrainMode=i}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(i,o){if(this.width=i*r.o.devicePixelRatio,this.height=o*r.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const u of this.style.order)this.style._mergedLayers[u].resize()}setup(){const i=this.context,o=new r.bd;o.emplaceBack(0,0),o.emplaceBack(r.al,0),o.emplaceBack(0,r.al),o.emplaceBack(r.al,r.al),this.tileExtentBuffer=i.createVertexBuffer(o,r.bf.members),this.tileExtentSegments=r.bg.simpleSegment(0,0,4,2);const u=new r.bd;u.emplaceBack(0,0),u.emplaceBack(r.al,0),u.emplaceBack(0,r.al),u.emplaceBack(r.al,r.al),this.debugBuffer=i.createVertexBuffer(u,r.bf.members),this.debugSegments=r.bg.simpleSegment(0,0,4,5);const m=new r.bd;m.emplaceBack(-1,-1),m.emplaceBack(1,-1),m.emplaceBack(-1,1),m.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(m,r.bf.members),this.viewportSegments=r.bg.simpleSegment(0,0,4,2);const y=new r.b0;y.emplaceBack(0,0,0,0),y.emplaceBack(r.al,0,r.al,0),y.emplaceBack(0,r.al,0,r.al),y.emplaceBack(r.al,r.al,r.al,r.al),this.mercatorBoundsBuffer=i.createVertexBuffer(y,r.bi.members),this.mercatorBoundsSegments=r.bg.simpleSegment(0,0,4,2);const b=new r.b1;b.emplaceBack(0,1,2),b.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(b);const A=new r.be;for(const z of[0,1,3,2,0])A.emplaceBack(z);this.debugIndexBuffer=i.createIndexBuffer(A),this.emptyTexture=new r.T(i,new r.q({width:1,height:1},Uint8Array.of(0,0,0,0)),i.gl.RGBA8),this.identityMat=r.bC();const C=this.context.gl;this.stencilClearMode=new ii({func:C.ALWAYS,mask:0},0,255,C.ZERO,C.ZERO,C.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(i){return i._makeTileBoundsBuffers(this.context,this.transform.projection),i._tileBoundsBuffer?{tileBoundsBuffer:i._tileBoundsBuffer,tileBoundsIndexBuffer:i._tileBoundsIndexBuffer,tileBoundsSegments:i._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const i=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,i.TRIANGLES,Rt.disabled,this.stencilClearMode,bi.disabled,ai.disabled,To(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(i,o,u){if(!o||this.currentStencilSource===o.id||!i.isTileClipped()||!u||u.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let A=!1;for(const C of u)if(this._tileClippingMaskIDs[C.key]===void 0){A=!0;break}if(!A)return}this.currentStencilSource=o.id;const m=this.context,y=m.gl;this.nextStencilID+u.length>256&&this.clearStencil(),m.setColorMode(bi.disabled),m.setDepthMode(Rt.disabled);const b=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const A of u){const C=o.getTile(A),z=this._tileClippingMaskIDs[A.key]=this.nextStencilID++,{tileBoundsBuffer:D,tileBoundsIndexBuffer:U,tileBoundsSegments:F}=this.getTileBoundsBuffers(C);b.draw(this,y.TRIANGLES,Rt.disabled,new ii({func:y.ALWAYS,mask:0},z,255,y.KEEP,y.KEEP,y.REPLACE),bi.disabled,ai.disabled,To(A.projMatrix),"$clipping",D,U,F)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const i=this.nextStencilID++,o=this.context.gl;return new ii({func:o.NOTEQUAL,mask:255},i,255,o.KEEP,o.KEEP,o.REPLACE)}stencilModeForClipping(i){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(i);const o=this.context.gl;return new ii({func:o.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,o.KEEP,o.KEEP,o.REPLACE)}stencilConfigForOverlap(i){const o=this.context.gl,u=i.sort((b,A)=>A.overscaledZ-b.overscaledZ),m=u[u.length-1].overscaledZ,y=u[0].overscaledZ-m+1;if(y>1){this.currentStencilSource=void 0,this.nextStencilID+y>256&&this.clearStencil();const b={};for(let A=0;A<y;A++)b[A+m]=new ii({func:o.GEQUAL,mask:255},A+this.nextStencilID,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID+=y,[b,u]}return[{[m]:ii.disabled},u]}colorModeForRenderPass(){const i=this.context.gl;return this._showOverdrawInspector?new bi([i.CONSTANT_COLOR,i.ONE,i.CONSTANT_COLOR,i.ONE],new r.ao(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?bi.unblended:bi.alphaBlended}colorModeForDrapableLayerRenderPass(i){const o=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new bi([o.ONE,o.ONE_MINUS_SRC_ALPHA,o.CONSTANT_ALPHA,o.ONE_MINUS_SRC_ALPHA],new r.ao(0,0,0,i===void 0?0:i),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(i,o,u,m=!1){if(this.depthOcclusion)return new Rt(this.context.gl.GREATER,Rt.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!m)return Rt.disabled;const y=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new Rt(u||this.context.gl.LEQUAL,o,[y,y])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const i=this.context.gl,o=Math.ceil(this.width),u=Math.ceil(this.height),m=this.context.bindFramebuffer.get(),y=i.getParameter(i.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===o&&this.depthFBO.height===u||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),o!==0&&u!==0&&(this.depthFBO=new jh(this.context,o,u,!1,"texture"),this.depthTexture=new r.T(this.context,{width:o,height:u,data:null},i.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(m),i.bindTexture(i.TEXTURE_2D,y),this.depthFBO&&(i.bindFramebuffer(i.READ_FRAMEBUFFER,null),i.bindFramebuffer(i.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),i.blitFramebuffer(0,0,o,u,0,0,o,u,i.DEPTH_BUFFER_BIT,i.NEAREST),i.bindFramebuffer(i.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((i,o)=>i+o/this._fpsHistory.length,0))}render(i,o){const u=r.o.now();this._dt=u-this._timeStamp,this._timeStamp=u,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=i.map.repaint,this.style=i,this.options=o;const m=this.style._mergedLayers,y=!(!this.terrain||!this.terrain.enabled),b=()=>this.style._getOrder(y).filter(Ve=>{const Pe=m[Ve];return!(Pe.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Pe.type]});let A=b(),C=!1,z=!1,D=null;for(const Ve of A){const Pe=m[Ve];Pe.type==="circle"?C=!0:Pe.type==="building"?D=Pe:Pe.type==="symbol"&&(Pe.hasOcclusionOpacityProperties?z=!0:C=!0)}let U=A.map(Ve=>m[Ve]);const F=this.style._mergedSourceCaches;this.imageManager=i.imageManager,this.modelManager=i.modelManager,this.symbolFadeChange=i.placement.symbolFadeChange(r.o.now()),this.imageManager.beginFrame();let W=0,X=!1;for(const Ve in F){const Pe=F[Ve];Pe.used&&(Pe.prepare(this.context),Pe.getSource().usedInConflation&&++W)}let Y=!1;for(const Ve of U)Ve.isHidden(this.transform.zoom)||(Ve.type==="clip"&&(Y=!0),this.prepareLayer(Ve));const te={},J={},re={},oe={},he={};for(const Ve in F){const Pe=F[Ve];te[Ve]=Pe.getVisibleCoordinates(),J[Ve]=te[Ve].slice().reverse(),re[Ve]=Pe.getVisibleCoordinates(!0).reverse(),oe[Ve]=Pe.getShadowCasterCoordinates(),he[Ve]=Pe.sortCoordinatesByDistance(te[Ve])}const ye=Ve=>{const Pe=this.style.getLayerSourceCache(Ve);return Pe&&Pe.used?Pe.getSource():null};if(W||Y||this._clippingActiveLastFrame){const Ve=[],Pe=[];let Qe=0;for(const We of U)this.isSourceForClippingOrConflation(We,ye(We))&&(Ve.push(We),Pe.push(Qe)),Qe++;if(Ve&&(Y||Ve.length>1)||this._clippingActiveLastFrame){Y=!1;const We=[];for(let at=0;at<Ve.length;at++){const xt=Ve[at],Pt=Pe[at],pt=this.style.getLayerSourceCache(xt);if(!pt||!pt.used||!pt.getSource().usedInConflation&&xt.type!=="clip"&&xt.type!=="building")continue;let ht=r.eH,Wt=r.bZ.None;const Ut=[];let Ht=!0;if(xt.type==="building")ht=r.eJ;else if(xt.type==="clip"){ht=Pt;for(const Vt of xt.layout.get("clip-layer-types"))Wt|=Vt==="model"?r.bZ.Model:Vt==="symbol"?r.bZ.Symbol:r.bZ.FillExtrusion;for(const Vt of xt.layout.get("clip-layer-scope"))Ut.push(Vt);xt.isHidden(this.transform.zoom)?Ht=!1:Y=!0}Ht&&We.push({layer:xt.fqid,cache:pt,order:ht,clipMask:Wt,clipScope:Ut})}this.replacementSource.setSources(We),X=!0}}this._clippingActiveLastFrame=Y,X||this.replacementSource.clear(),this.conflationActive=X,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Ve=0;Ve<U.length;Ve++){const Pe=U[Ve],Qe=Pe.cutoffRange();if(this.longestCutoffRange=Math.max(Qe,this.longestCutoffRange),Qe>0){const We=ye(Pe);We&&(this.minCutoffZoom=Math.max(We.minzoom,this.minCutoffZoom)),Pe.minzoom&&(this.minCutoffZoom=Math.max(Pe.minzoom,this.minCutoffZoom))}Pe.is3D(y)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Ve),this._lastOcclusionLayer=Ve)}const me=this.style&&this.style.fog;me?(this._fogVisible=me.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=me.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(re),this.opaquePassCutoff=0,A=b(),U=A.map(Ve=>m[Ve]));const xe=this._shadowRenderer;if(xe){xe.updateShadowParameters(this.transform,this.style.directionalLight);for(const Ve in F)for(const Pe of te[Ve]){let Qe={min:0,max:0};this.terrain&&(Qe=this.terrain.getMinMaxForTile(Pe)||Qe),xe.addShadowReceiver(Pe.toUnwrapped(),Qe.min,Qe.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new r.eI(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new yl(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const _e=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),ge=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(_e&&!this._snow&&(this._snow=new jp(this)),!_e&&this._snow&&(this._snow.destroy(),delete this._snow),ge&&!this._rain&&(this._rain=new Ar(this)),!ge&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),D){this.buildingTileBorderManager||(this.buildingTileBorderManager=new Nr);const Ve=this.style.getLayerSourceCache(D);this.buildingTileBorderManager.updateBorders(Ve,D)}if(!ns.has(this.context.gl))return;this.renderPass="offscreen";for(const Ve of U){const Pe=i.getLayerSourceCache(Ve);if(!Ve.hasOffscreenPass()||Ve.isHidden(this.transform.zoom))continue;const Qe=Pe?J[Pe.id]:void 0;(Ve.type==="custom"||Ve.type==="raster"||Ve.type==="raster-particle"||Ve.isSky()||Qe&&Qe.length)&&this.renderLayer(this,Pe,Ve,Qe)}this.depthRangeFor3D=[0,1-(U.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,oe)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Ae=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),je=(()=>{if(o.showOverdrawInspector)return r.ao.black;const Ve=this.style.fog;if(Ve&&this.transform.projection.supportsFog){const Pe=this.style.getLut(Ve.scope);if(!Ae){const Qe=Ve.properties.get("color-use-theme")==="none",We=Ve.properties.get("color").toNonPremultipliedRenderColor(Qe?null:Pe).toArray01();return new r.ao(...We)}if(Ae){const Qe=Ve.properties.get("space-color-use-theme")==="none",We=Ve.properties.get("space-color").toNonPremultipliedRenderColor(Qe?null:Pe).toArray01();return new r.ao(...We)}}return r.ao.transparent})();if(this.context.clear({color:je,depth:1}),this.clearStencil(),this._showOverdrawInspector=o.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ae&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=A.length-1;this.currentLayer>=0;this.currentLayer--){const Ve=U[this.currentLayer],Pe=i.getLayerSourceCache(Ve);if(Ve.isSky())continue;const Qe=Pe?(Ve.is3D(y)?he:J)[Pe.id]:void 0;this._renderTileClippingMasks(Ve,Pe,Qe),this.renderLayer(this,Pe,Ve,Qe)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ae&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||r.aj(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<A.length;this.currentLayer++){const Ve=U[this.currentLayer],Pe=i.getLayerSourceCache(Ve);Ve.isSky()&&this.renderLayer(this,Pe,Ve,Pe?J[Pe.id]:void 0)}function Re(Ve,Pe){let Qe;return Pe&&(Qe=(Ve.type==="symbol"?re:Ve.is3D(y)?he:J)[Pe.id]),Qe}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<A.length;){const Ve=U[this.currentLayer];if(Ve.type==="raster"||Ve.type==="raster-particle"){const Pe=i.getLayerSourceCache(Ve);this.renderLayer(this,Pe,Ve,Re(Ve,Pe))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let Je=0;xe&&(Je=xe.getShadowCastingLayerCount());let Ne=!1,$e=-1;for(let Ve=0;Ve<A.length;++Ve){const Pe=U[Ve];Pe.isHidden(this.transform.zoom)||Pe.is3D(y)&&($e=Ve)}z&&$e===-1&&(C=!0);let vt=!1;for(;this.currentLayer<A.length;){const Ve=U[this.currentLayer],Pe=i.getLayerSourceCache(Ve);if(Ve.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Ve)){if(Ve.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!vt&&Ve.is3D(y)&&!y){const Qe=this.currentLayer,We=at=>{for(this.currentLayer=0;this.currentLayer<U.length;this.currentLayer++){const xt=U[this.currentLayer];if(Bo[xt.type]){const Pt=this.style.getLayerSourceCache(xt);Bo[xt.type](this,Pt,xt,Re(xt,Pt),at)}}};We("initialize"),We("reset"),this.currentLayer=Qe,vt=!0}if(C&&!Ne&&this.terrain&&!this.transform.isOrthographic&&(Ne=!0,this.blitDepth()),z&&$e!==-1&&this.currentLayer===$e+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(Ve,Pe,Pe?te[Pe.id]:void 0),this.renderLayer(this,Pe,Ve,Re(Ve,Pe)),!this.terrain&&xe&&Je>0&&Ve.hasShadowPass()&&--Je==0){{this.clearStencil(),this.resetStencilClippingMasks();const Qe=this.currentLayer;for(this.currentLayer=0;this.currentLayer<U.length;this.currentLayer++){const We=U[this.currentLayer];if(ro[We.type]){const at=this.style.getLayerSourceCache(We);ro[We.type](this,at,We,Re(We,at))}}this.currentLayer=Qe}if(xe.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const Qe=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Qe;this.currentLayer++){const We=U[this.currentLayer];if(!We.hasLightBeamPass())continue;const at=i.getLayerSourceCache(We);this.renderLayer(this,at,We,at?J[at.id]:void 0)}this.currentLayer=Qe,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const Qe=this.currentLayer;this.depthOcclusion=!0;for(const We of this.layersWithOcclusionOpacity){this.currentLayer=We;const at=U[this.currentLayer],xt=i.getLayerSourceCache(at),Pt=xt?J[xt.id]:void 0;this.terrain||this._renderTileClippingMasks(at,xt,xt?te[xt.id]:void 0),this.renderLayer(this,xt,at,Pt)}this.depthOcclusion=!1,this.currentLayer=Qe,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Ve=null;U.forEach(Pe=>{const Qe=i.getLayerSourceCache(Pe);Qe&&!Pe.isHidden(this.transform.zoom)&&Qe.getVisibleCoordinates().length&&(!Ve||Ve.getSource().maxzoom<Qe.getSource().maxzoom)&&(Ve=Qe)}),Ve&&this.options.showTileBoundaries&&Zh(this,Ve,Ve.getVisibleCoordinates(),r.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Zh(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new r.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Ve){const Pe=Ve.transform.padding;ia(Ve,Ve.transform.height-(Pe.top||0),3,Xs),ia(Ve,Pe.bottom||0,3,eo),_r(Ve,Pe.left||0,3,Lp),_r(Ve,Ve.transform.width-(Pe.right||0),3,Od);const Qe=Ve.transform.centerPoint;(function(We,at,xt,Pt){Lo(We,at-1,xt-10,2,20,Pt),Lo(We,at-10,xt-1,20,2,Pt)})(Ve,Qe.x,Ve.transform.height-Qe.y,Fd)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),X||(this.conflationActive=!1)}prepareLayer(i){this.gpuTimingStart(i);const{unsupportedLayers:o}=this.transform.projection,u=!o||!o.includes(i.type);if(Fo[i.type]&&(u||this.terrain&&i.type==="custom")){const m=this.style.getLayerSourceCache(i);Fo[i.type](i,m,this)}this.gpuTimingEnd()}renderLayer(i,o,u,m){u.isHidden(this.transform.zoom)||(u.type==="background"||u.type==="sky"||u.type==="custom"||u.type==="model"||u.type==="raster"||u.type==="raster-particle"||m&&m.length)&&(this.id=u.id,this.gpuTimingStart(u),i.transform.projection.unsupportedLayers&&i.transform.projection.unsupportedLayers.includes(u.type)&&(!i.terrain||u.type!=="custom")||u.type==="clip"||io[u.type](i,o,u,m,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(i){if(!this.options.gpuTiming)return;const o=this.context.extTimerQuery,u=this.context.gl;let m=this.gpuTimers[i.id];m||(m=this.gpuTimers[i.id]={calls:0,cpuTime:0,query:u.createQuery()}),m.calls++,u.beginQuery(o.TIME_ELAPSED_EXT,m.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const i=this.context.extTimerQuery,o=this.context.gl,u=o.createQuery();this.deferredRenderGpuTimeQueries.push(u),o.beginQuery(i.TIME_ELAPSED_EXT,u)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const i=this.gpuTimers;return this.gpuTimers={},i}collectDeferredRenderGpuQueries(){const i=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],i}queryGpuTimers(i){const o={};for(const u in i){const m=i[u],y=this.context.extTimerQuery,b=y.getQueryParameter(m.query,this.context.gl.QUERY_RESULT)/1e6;y.deleteQueryEXT(m.query),o[u]=b}return o}queryGpuTimeDeferredRender(i){if(!this.options.gpuTimingDeferredRender)return 0;const o=this.context.gl;let u=0;for(const m of i)u+=o.getQueryParameter(m,o.QUERY_RESULT)/1e6,o.deleteQuery(m);return u}translatePosMatrix(i,o,u,m,y){if(!u[0]&&!u[1])return i;const b=y?m==="map"?this.transform.angle:0:m==="viewport"?-this.transform.angle:0;if(b){const z=Math.sin(b),D=Math.cos(b);u=[u[0]*D-u[1]*z,u[0]*z+u[1]*D]}const A=[y?u[0]:r.ay(o,u[0],this.transform.zoom),y?u[1]:r.ay(o,u[1],this.transform.zoom),0],C=new Float32Array(16);return r.br(C,i,A),C}saveTileTexture(i){if(i.context!==this.context)return;const o=i.size[0],u=this._tileTextures[o];u?u.push(i):this._tileTextures[o]=[i]}getTileTexture(i){const o=this._tileTextures[i];return o&&o.length>0?o.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(i,o,u){const m=u===void 0?this.terrain&&this.terrain.renderingToTexture:u,y=[];return this.style&&this.style.enable3dLights()&&(i==="globeRaster"||i==="terrainRaster"?(y.push("LIGHTING_3D_MODE"),y.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):m||y.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||y.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(y.push("TERRAIN"),this.linearFloatFilteringSupported()&&y.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&y.push("GLOBE"),!this._fogVisible||m||o!==void 0&&!o||y.push("FOG","FOG_DITHERING"),m&&y.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&y.push("OVERDRAW_INSPECTOR"),y}getOrCreateProgram(i,o){this.cache=this.cache||{};const u=o&&o.defines||[],m=o&&o.config,y=this.currentGlobalDefines(i,o&&o.overrideFog,o&&o.overrideRtt).concat(u),b=Dh.cacheKey(wh[i],i,y,m);return this.cache[b]||(this.cache[b]=new Dh(this.context,i,wh[i],m,Om[i],y)),this.cache[b]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new r.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(i,o){if(this.style.enable3dLights()){const u=this.style.directionalLight,m=this.style.ambientLight;if(u&&m){const y=((b,A,C)=>{const z=b.properties.get("direction"),D=b.properties.get("color-use-theme")==="none",U=b.properties.get("color").toNonPremultipliedRenderColor(D?null:C.getLut(b.scope)).toArray01(),F=b.properties.get("intensity"),W=A.properties.get("color-use-theme")==="none",X=A.properties.get("color").toNonPremultipliedRenderColor(W?null:C.getLut(A.scope)).toArray01(),Y=A.properties.get("intensity"),te=[z.x,z.y,z.z],J=r.dK(X,Y),re=r.dK(U,F);return{u_lighting_ambient_color:J,u_lighting_directional_dir:te,u_lighting_directional_color:re,u_ground_radiance:Rh(te,re,J)}})(u,m,this.style);o.setLightsUniformValues(i,y)}}}uploadCommonUniforms(i,o,u,m,y){if(this.uploadCommonLightUniforms(i,o),this.terrain&&this.terrain.renderingToTexture)return;const b=this.style.fog;if(b){const A=b.getOpacity(this.transform.pitch),C=((z,D,U,F,W,X,Y,te,J,re,oe,he)=>{const ye=z.transform,me=D.properties.get("color-use-theme")==="none",xe=D.properties.get("color").toNonPremultipliedRenderColor(me?null:z.style.getLut(D.scope)).toArray01();xe[3]=F;const _e=z.frameCounter/1e3%1,[ge,Ae]=D.properties.get("vertical-range");return{u_fog_matrix:U?ye.calculateFogTileMatrix(U):he||z.identityMat,u_fog_range:D.getFovAdjustedRange(ye._fov),u_fog_color:xe,u_fog_horizon_blend:D.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(ge,Ae),Ae],u_fog_temporal_offset:_e,u_frustum_tl:W,u_frustum_tr:X,u_frustum_br:Y,u_frustum_bl:te,u_globe_pos:J,u_globe_radius:re,u_viewport:oe,u_globe_transition:r.aj(ye.zoom),u_is_globe:+(ye.projection.name==="globe")}})(this,b,u,A,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*r.o.devicePixelRatio,this.transform.height*r.o.devicePixelRatio],m);o.setFogUniformValues(i,C)}y&&o.setCutoffUniformValues(i,y.uniformValues)}setTileLoadedFlag(i){this.tileLoaded=i}saveCanvasCopy(){const i=this.canvasCopy();i&&(this.frameCopies.push(i),this.tileLoaded=!1)}canvasCopy(){const i=this.context.gl,o=i.createTexture();return i.bindTexture(i.TEXTURE_2D,o),i.copyTexImage2D(i.TEXTURE_2D,0,i.RGBA,0,0,i.drawingBufferWidth,i.drawingBufferHeight,0),o}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const i=this.style&&this.style.fog;return!!i&&i.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const i=this._backgroundTiles,o=this._backgroundTiles={},u=this.transform.coveringTiles({tileSize:512});for(const m of u)o[m.key]=i[m.key]||new Ua(m,512,this.transform.tileZoom,this,void 0,this.worldview);return o}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(i,o){return!(!i.is3D(!(!this.terrain||!this.terrain.enabled))||i.type!=="clip"&&i.type!=="building"&&(i.minzoom&&i.minzoom>this.transform.zoom||(this.style._clipLayerPresent||i.sourceLayer!=="building"&&i.sourceLayer!=="procedural_buildings")&&(!o||o.type!=="batched-model")))}isTileAffectedByFog(i){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let o=this._cachedTileFogOpacities[i.key];return o||(this._cachedTileFogOpacities[i.key]=o=this.style.fog.getOpacityForTile(i)),o[0]>=Zt||o[1]>=Zt}setupDepthForOcclusion(i,o,u){const m=this.context,y=m.gl,b=!!u;var A;u||(u={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),m.activeTexture.set(y.TEXTURE3),i&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE),u.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],u.u_depth_range_unpack=[2/((A=this.depthRangeFor3D)[1]-A[0]),-1-2*A[0]/(A[1]-A[0])],u.u_occluder_half_size=.5*this.occlusionParams.occluderSize,u.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE),m.activeTexture.set(y.TEXTURE0),b||o.setTerrainUniformValues(m,u)}}function eu(d,i){let o=!1,u=null;const m=()=>{u=null,o&&(d(),u=setTimeout(m,i),o=!1)};return()=>(o=!0,u||m(),u)}class Hd{constructor(i){this._hashName=i&&encodeURIComponent(i),r.aY(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=eu(this._updateHashUnthrottled.bind(this),300)}addTo(i){return this._map=i,window.addEventListener("hashchange",this._onHashChange,!1),i.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const i=this._map;if(!i)return"";const o=tu(i);if(this._hashName){const u=this._hashName;let m=!1;const y=location.hash.slice(1).split("&").map(b=>{const A=b.split("=")[0];return A===u?(m=!0,`${A}=${o}`):b}).filter(b=>b);return m||y.push(`${u}=${o}`),`#${y.join("&")}`}return`#${o}`}_getCurrentHash(){const i=location.hash.replace("#","");if(this._hashName){let o;return i.split("&").map(u=>u.split("=")).forEach(u=>{u[0]===this._hashName&&(o=u)}),(o&&o[1]||"").split("/")}return i.split("/")}_onHashChange(){const i=this._map;if(!i)return!1;const o=this._getCurrentHash();if(o.length>=3&&!o.some(u=>isNaN(Number(u)))){const u=i.dragRotate.isEnabled()&&i.touchZoomRotate.isEnabled()?+(o[3]||0):i.getBearing();return i.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:u,pitch:+(o[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function tu(d,i){const o=d.getCenter(),u=Math.round(100*d.getZoom())/100,m=Math.ceil((u*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,m),b=Math.round(o.lng*y)/y,A=Math.round(o.lat*y)/y,C=d.getBearing(),z=d.getPitch();let D=i?`/${b}/${A}/${u}`:`${u}/${A}/${b}`;return(C||z)&&(D+="/"+Math.round(10*C)/10),z&&(D+=`/${Math.round(z)}`),D}const en={linearity:.3,easing:r.eK(0,0,.3,1)},so=Object.assign({deceleration:2500,maxSpeed:1400},en),wl=Object.assign({deceleration:20,maxSpeed:1400},en),iu=Object.assign({deceleration:1e3,maxSpeed:360},en),Wd=Object.assign({deceleration:1e3,maxSpeed:90},en);class Gd{constructor(i){this._map=i,this.clear()}clear(){this._inertiaBuffer=[]}record(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:r.o.now(),settings:i})}_drainInertiaBuffer(){const i=this._inertiaBuffer,o=r.o.now();for(;i.length>0&&o-i[0].time>160;)i.shift()}_onMoveEnd(i){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const o={zoom:0,bearing:0,pitch:0,pan:new r.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:y}of this._inertiaBuffer)o.zoom+=y.zoomDelta||0,o.bearing+=y.bearingDelta||0,o.pitch+=y.pitchDelta||0,y.panDelta&&o.pan._add(y.panDelta),y.around&&(o.around=y.around),y.pinchAround&&(o.pinchAround=y.pinchAround);const u=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(o.pan.mag()){const y=Sl(o.pan.mag(),u,Object.assign({},so,i||{}));m.offset=o.pan.mult(y.amount/o.pan.mag()),m.center=this._map.transform.center,Wn(m,y)}if(o.zoom){const y=Sl(o.zoom,u,wl);m.zoom=this._map.transform.zoom+y.amount,Wn(m,y)}if(o.bearing){const y=Sl(o.bearing,u,iu);m.bearing=this._map.transform.bearing+r.aA(y.amount,-179,179),Wn(m,y)}if(o.pitch){const y=Sl(o.pitch,u,Wd);m.pitch=this._map.transform.pitch+y.amount,Wn(m,y)}if(m.zoom||m.bearing){const y=o.pinchAround===void 0?o.around:o.pinchAround;m.around=y?this._map.unproject(y):this._map.getCenter()}return this.clear(),m.noMoveStart=!0,m}}function Wn(d,i){(!d.duration||d.duration<i.duration)&&(d.duration=i.duration,d.easing=i.easing)}function Sl(d,i,o){const{maxSpeed:u,linearity:m,deceleration:y}=o,b=r.aA(d*m/(i/1e3),-u,u),A=Math.abs(b)/(y*m);return{easing:o.easing,duration:1e3*A,amount:b*(A/2)}}class hs extends r.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,o,u,m={}){const y=Ie(o.getCanvasContainer(),u),b=o.unproject(y);super(i,Object.assign({point:y,lngLat:b,originalEvent:u},m)),this._defaultPrevented=!1,this.target=o}}class Al extends r.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,o,u){const m=i==="touchend"?u.changedTouches:u.touches,y=Ue(o.getCanvasContainer(),m),b=y.map(C=>o.unproject(C)),A=y.reduce((C,z,D,U)=>C.add(z.div(U.length)),new r.P(0,0));super(i,{points:y,point:A,lngLats:b,lngLat:o.unproject(A),originalEvent:u}),this._defaultPrevented=!1}}class ru extends r.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,o){super("wheel",{originalEvent:o}),this._defaultPrevented=!1}}class Xd{constructor(i,o){this._map=i,this._clickTolerance=o.clickTolerance}reset(){this._mousedownPos=void 0}wheel(i){return this._firePreventable(new ru(this._map,i))}mousedown(i,o){return this._mousedownPos=o,this._firePreventable(new hs(i.type,this._map,i))}mouseup(i){this._map.fire(new hs(i.type,this._map,i))}preclick(i){const o=new MouseEvent("preclick",i);this._map.fire(new hs(o.type,this._map,o))}click(i,o){this._mousedownPos&&this._mousedownPos.dist(o)>=this._clickTolerance||(this.preclick(i),this._map.fire(new hs(i.type,this._map,i)))}dblclick(i){return this._firePreventable(new hs(i.type,this._map,i))}mouseover(i){this._map.fire(new hs(i.type,this._map,i))}mouseout(i){this._map.fire(new hs(i.type,this._map,i))}touchstart(i){return this._firePreventable(new Al(i.type,this._map,i))}touchmove(i){this._map.fire(new Al(i.type,this._map,i))}touchend(i){this._map.fire(new Al(i.type,this._map,i))}touchcancel(i){this._map.fire(new Al(i.type,this._map,i))}_firePreventable(i){if(this._map.fire(i),i.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Yd{constructor(i){this._map=i}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(i){this._map.fire(new hs(i.type,this._map,i))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new hs("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(i){this._delayContextMenu?this._contextMenuEvent=i:this._map.fire(new hs(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class gs{constructor(i,o){this._map=i,this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=o.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(i,o){this.isEnabled()&&i.shiftKey&&i.button===0&&(ve(),this._startPos=this._lastPos=o,this._active=!0)}mousemoveWindow(i,o){if(!this._active)return;const u=o,m=this._startPos,y=this._lastPos;if(!m||!y||y.equals(u)||!this._box&&u.dist(m)<this._clickTolerance)return;this._lastPos=u,this._box||(this._box=H("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",i));const b=Math.min(m.x,u.x),A=Math.max(m.x,u.x),C=Math.min(m.y,u.y),z=Math.max(m.y,u.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${b}px,${C}px)`,this._box.style.width=A-b+"px",this._box.style.height=z-C+"px")})}mouseupWindow(i,o){if(!this._active)return;const u=this._startPos,m=o;if(u&&i.button===0){if(this.reset(),Se(),u.x!==m.x||u.y!==m.y)return this._map.fire(new r.z("boxzoomend",{originalEvent:i})),{cameraAnimation:y=>y.fitScreenCoordinates(u,m,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",i)}}keydown(i){this._active&&i.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",i))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),ce(),delete this._startPos,delete this._lastPos}_fireEvent(i,o){return this._map.fire(new r.z(i,{originalEvent:o}))}}function Tc(d,i){const o={};for(let u=0;u<d.length;u++)o[d[u].identifier]=i[u];return o}class qd{constructor(i){this.reset(),this.numTouches=i.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(i,o,u){(this.centroid||u.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=i.timeStamp),u.length===this.numTouches&&(this.centroid=function(m){const y=new r.P(0,0);for(const b of m)y._add(b);return y.div(m.length)}(o),this.touches=Tc(u,o)))}touchmove(i,o,u){if(this.aborted||!this.centroid)return;const m=Tc(u,o);for(const y in this.touches){const b=m[y];(!b||b.dist(this.touches[y])>30)&&(this.aborted=!0)}}touchend(i,o,u){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),u.length===0){const m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class Ec{constructor(i){this.singleTap=new qd(i),this.numTaps=i.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(i,o,u){this.singleTap.touchstart(i,o,u)}touchmove(i,o,u){this.singleTap.touchmove(i,o,u)}touchend(i,o,u){const m=this.singleTap.touchend(i,o,u);if(m){const y=i.timeStamp-this.lastTime<500,b=!this.lastTap||this.lastTap.dist(m)<30;if(y&&b||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class No{constructor(){this._zoomIn=new Ec({numTouches:1,numTaps:2}),this._zoomOut=new Ec({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(i,o,u){this._zoomIn.touchstart(i,o,u),this._zoomOut.touchstart(i,o,u)}touchmove(i,o,u){this._zoomIn.touchmove(i,o,u),this._zoomOut.touchmove(i,o,u)}touchend(i,o,u){const m=this._zoomIn.touchend(i,o,u),y=this._zoomOut.touchend(i,o,u);return m?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:b.getZoom()+1,around:b.unproject(m)},{originalEvent:i})}):y?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:b.getZoom()-1,around:b.unproject(y)},{originalEvent:i})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Zd={0:1,2:2},su={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class Cc{constructor(i){this.reset(),this._clickTolerance=i.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(i,o){return!1}_move(i,o){return{}}mousedown(i,o){if(this._lastPoint)return;const u=Ke(i);this._correctButton(i,u)&&(this._lastPoint=o,this._eventButton=u)}mousemoveWindow(i,o){const u=this._lastPoint;if(u){if(i.preventDefault(),this._eventButton!=null&&function(m,y){const b=Zd[y];return m.buttons===void 0||(m.buttons&b)!==b}(i,this._eventButton))this.reset();else if(this._moved||!(o.dist(u)<this._clickTolerance))return this._moved=!0,this._lastPoint=o,this._move(u,o)}}mouseupWindow(i){this._lastPoint&&Ke(i)===this._eventButton&&(this._moved&&Se(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Tl extends Cc{mousedown(i,o){super.mousedown(i,o),this._lastPoint&&(this._active=!0)}_correctButton(i,o){return o===0&&!i.ctrlKey}_move(i,o){return{around:o,panDelta:o.sub(i)}}}class nu extends Cc{constructor(i){super(i),this._pitchRotateKey=i.pitchRotateKey?su[i.pitchRotateKey]:void 0}_correctButton(i,o){return this._pitchRotateKey?o===0&&i[this._pitchRotateKey]:o===0&&i.ctrlKey||o===2}_move(i,o){const u=.8*(o.x-i.x);if(u)return this._active=!0,{bearingDelta:u}}contextmenu(i){this._pitchRotateKey||i.preventDefault()}}class au extends Cc{constructor(i){super(i),this._pitchRotateKey=i.pitchRotateKey?su[i.pitchRotateKey]:void 0}_correctButton(i,o){return this._pitchRotateKey?o===0&&i[this._pitchRotateKey]:o===0&&i.ctrlKey||o===2}_move(i,o){const u=-.5*(o.y-i.y);if(u)return this._active=!0,{pitchDelta:u}}contextmenu(i){this._pitchRotateKey||i.preventDefault()}}class $d{constructor(i,o){this._map=i,this._el=i.getCanvasContainer(),this._minTouches=1,this._clickTolerance=o.clickTolerance||1,this.reset(),r.aY(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new r.P(0,0)}touchstart(i,o,u){return this._calculateTransform(i,o,u)}touchmove(i,o,u){if(this._active&&!(u.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(u.length===1&&!r.eL())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return i.cancelable&&i.preventDefault(),this._calculateTransform(i,o,u)}}touchend(i,o,u){this._calculateTransform(i,o,u),this._active&&u.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(i,o,u){u.length>0&&(this._active=!0);const m=Tc(u,o),y=new r.P(0,0),b=new r.P(0,0);let A=0;for(const z in m){const D=m[z],U=this._touches[z];U&&(y._add(D),b._add(D.sub(U)),A++,m[z]=D)}if(this._touches=m,A<this._minTouches||!b.mag())return;const C=b.div(A);return this._sum._add(C),this._sum.mag()<this._clickTolerance?void 0:{around:y.div(A),panDelta:C}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=H("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class El{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(i){}_move(i,o,u){return{}}touchstart(i,o,u){this._firstTwoTouches||u.length<2||(this._firstTwoTouches=[u[0].identifier,u[1].identifier],this._start([o[0],o[1]]))}touchmove(i,o,u){const m=this._firstTwoTouches;if(!m)return;i.preventDefault();const[y,b]=m,A=Cl(u,o,y),C=Cl(u,o,b);if(!A||!C)return;const z=this._aroundCenter?null:A.add(C).div(2);return this._move([A,C],z,i)}touchend(i,o,u){if(!this._firstTwoTouches)return;const[m,y]=this._firstTwoTouches,b=Cl(u,o,m),A=Cl(u,o,y);b&&A||(this._active&&Se(),this.reset())}touchcancel(){this.reset()}enable(i){this._enabled=!0,this._aroundCenter=!!i&&i.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Cl(d,i,o){for(let u=0;u<d.length;u++)if(d[u].identifier===o)return i[u]}function ou(d,i){return Math.log2(d/i)}class Hp extends El{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(i){this._startDistance=this._distance=i[0].dist(i[1])}_move(i,o){const u=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(ou(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ou(this._distance,u),pinchAround:o}}}function Jd(d,i){return 180*d.angleWith(i)/Math.PI}class Wp extends El{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])}_move(i,o){const u=this._vector;if(this._vector=i[0].sub(i[1]),u&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Jd(this._vector,u),pinchAround:o}}_isBelowThreshold(i){this._minDiameter=Math.min(this._minDiameter,i.mag());const o=25/(Math.PI*this._minDiameter)*360,u=this._startVector;if(!u)return!1;const m=Jd(i,u);return Math.abs(m)<o}}function lu(d){return Math.abs(d.y)>Math.abs(d.x)}class Gp extends El{constructor(i){super(),this._map=i}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(i){this._lastPoints=i,lu(i[0].sub(i[1]))&&(this._valid=!1)}_move(i,o,u){const m=this._lastPoints;if(!m)return;const y=i[0].sub(m[0]),b=i[1].sub(m[1]);return this._map._cooperativeGestures&&!r.eL()&&u.touches.length<3||(this._valid=this.gestureBeginsVertically(y,b,u.timeStamp),!this._valid)?void 0:(this._lastPoints=i,this._active=!0,{pitchDelta:(y.y+b.y)/2*-.5})}gestureBeginsVertically(i,o,u){if(this._valid!==void 0)return this._valid;const m=i.mag()>=2,y=o.mag()>=2;if(!m&&!y)return;if(!m||!y)return this._firstMove==null&&(this._firstMove=u),u-this._firstMove<100&&void 0;const b=i.y>0==o.y>0;return lu(i)&&lu(o)&&b}}const Xp={panStep:100,bearingStep:15,pitchStep:10};class Yp{constructor(){const i=Xp;this._panStep=i.panStep,this._bearingStep=i.bearingStep,this._pitchStep=i.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(i){if(i.altKey||i.ctrlKey||i.metaKey)return;let o=0,u=0,m=0,y=0,b=0;switch(i.keyCode){case 61:case 107:case 171:case 187:o=1;break;case 189:case 109:case 173:o=-1;break;case 37:i.shiftKey?u=-1:(i.preventDefault(),y=-1);break;case 39:i.shiftKey?u=1:(i.preventDefault(),y=1);break;case 38:i.shiftKey?m=1:(i.preventDefault(),b=-1);break;case 40:i.shiftKey?m=-1:(i.preventDefault(),b=1);break;default:return}return this._rotationDisabled&&(u=0,m=0),{cameraAnimation:A=>{const C=A.getZoom();A.easeTo({duration:300,easeId:"keyboardHandler",easing:qp,zoom:o?Math.round(C)+o*(i.shiftKey?2:1):C,bearing:A.getBearing()+u*this._bearingStep,pitch:A.getPitch()+m*this._pitchStep,offset:[-y*this._panStep,-b*this._panStep],center:A.getCenter()},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function qp(d){return d*(2-d)}const Kd=4.000244140625,Zp=1/450;class $p{constructor(i,o){this._map=i,this._el=i.getCanvasContainer(),this._handler=o,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Zp,r.aY(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(i){this._defaultZoomRate=i}setWheelZoomRate(i){this._wheelZoomRate=i}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!i&&i.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(i){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(i.ctrlKey||i.metaKey||this.isZooming()||r.eL()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let o=i.deltaMode===WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY;const u=r.o.now(),m=u-(this._lastWheelEventTime||0);this._lastWheelEventTime=u,o!==0&&o%Kd==0?this._type="wheel":o!==0&&Math.abs(o)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=o,this._timeout=window.setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(m*o)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,o+=this._lastValue)),i.shiftKey&&o&&(o/=4),this._type&&(this._lastWheelEvent=i,this._delta-=o,this._active||this._start(i)),i.preventDefault()}_onTimeout(i){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(i)}_start(i){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const o=Ie(this._el,i);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:o,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const i=this._map.transform;this._type==="wheel"&&i.projection.wrap&&(i._center.lng>=180||i._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const o=()=>i._terrainEnabled()&&this._aroundCoord?i.computeZoomRelativeTo(this._aroundCoord):i.zoom;if(this._delta!==0){const z=this._type==="wheel"&&Math.abs(this._delta)>Kd?this._wheelZoomRate:this._defaultZoomRate;let D=2/(1+Math.exp(-Math.abs(this._delta*z)));this._delta<0&&D!==0&&(D=1/D);const U=o(),F=Math.pow(2,U),W=typeof this._targetZoom=="number"?i.zoomScale(this._targetZoom):F;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(W*D))),this._type==="wheel"&&(this._startZoom=U,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const u=typeof this._targetZoom=="number"?this._targetZoom:o(),m=this._startZoom,y=this._easing;let b,A=!1;if(this._type==="wheel"&&m&&y){const z=Math.min((r.o.now()-this._lastWheelEventTime)/200,1),D=y(z);b=r.ak(m,u,D),z<1?this._frameId||(this._frameId=!0):A=!0}else b=u,A=!0;this._active=!0,A&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let C=b-o();return C*this._lastDelta<0&&(C=0),{noInertia:!0,needsRenderFrame:!A,zoomDelta:C,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(i){let o=r.eM;if(this._prevEase){const u=this._prevEase,m=(r.o.now()-u.start)/u.duration,y=u.easing(m+.01)-u.easing(m),b=.27/Math.sqrt(y*y+1e-4)*.01,A=Math.sqrt(.0729-b*b);o=r.eK(b,A,.25,1)}return this._prevEase={start:r.o.now(),duration:i,easing:o},o}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=H("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Jp{constructor(i,o){this._clickZoom=i,this._tapZoom=o}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Kp{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(i,o){return i.preventDefault(),{cameraAnimation:u=>{u.easeTo({duration:300,zoom:u.getZoom()+(i.shiftKey?-1:1),around:u.unproject(o)},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Hm{constructor(){this._tap=new Ec({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(i,o,u){this._swipePoint||(this._tapTime&&i.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?u.length>0&&(this._swipePoint=o[0],this._swipeTouch=u[0].identifier):this._tap.touchstart(i,o,u))}touchmove(i,o,u){if(this._tapTime){if(this._swipePoint){if(u[0].identifier!==this._swipeTouch)return;const m=o[0],y=m.y-this._swipePoint.y;return this._swipePoint=m,i.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(i,o,u)}touchend(i,o,u){this._tapTime?this._swipePoint&&u.length===0&&this.reset():this._tap.touchend(i,o,u)&&(this._tapTime=i.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Wm{constructor(i,o,u){this._el=i,this._mousePan=o,this._touchPan=u}enable(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Gm{constructor(i,o,u){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=o,this._mousePitch=u}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class zr{constructor(i,o,u,m){this._el=i,this._touchZoom=o,this._touchRotate=u,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Ic=d=>d.zoom||d.drag||d.pitch||d.rotate;class Xm extends r.z{}class Ym{constructor(){this.constants=[1,1,.01],this.radius=0}setup(i,o){const u=r.av([],o,i);this.radius=r.ag(u[2]<0?r.eO([],u,this.constants):[u[0],u[1],0])}projectRay(i){r.eO(i,i,this.constants),r.aw(i,i),r.eP(i,i,this.constants);const o=r.c4([],i,this.radius);if(o[2]>0){const u=r.c4([],[0,0,1],r.bJ(o,[0,0,1])),m=r.c4([],r.aw([],[o[0],o[1],0]),this.radius),y=r.d7([],o,r.c4([],r.av([],r.d7([],m,u),o),2));o[0]=y[0],o[1]=y[1]}return o}}function cu(d){return d.panDelta&&d.panDelta.mag()||d.zoomDelta||d.bearingDelta||d.pitchDelta}class kc{constructor(i,o){this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Gd(i),this._bearingSnap=o.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Ym,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(o),r.aY(["handleEvent","handleWindowEvent"],this);const u=this._el;this._listeners=[[u,"touchstart",{passive:!0}],[u,"touchmove",{passive:!1}],[u,"touchend",void 0],[u,"touchcancel",void 0],[u,"mousedown",void 0],[u,"mousemove",void 0],[u,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[u,"mouseover",void 0],[u,"mouseout",void 0],[u,"dblclick",void 0],[u,"click",void 0],[u,"keydown",{capture:!1}],[u,"keyup",void 0],[u,"wheel",{passive:!1}],[u,"contextmenu",void 0],[window,"blur",void 0]];for(const[m,y,b]of this._listeners){const A=m===document?this.handleWindowEvent:this.handleEvent;m.addEventListener(y,A,b)}}destroy(){for(const[i,o,u]of this._listeners){const m=i===document?this.handleWindowEvent:this.handleEvent;i.removeEventListener(o,m,u)}}_addDefaultHandlers(i){const o=this._map,u=o.getCanvasContainer();this._add("mapEvent",new Xd(o,i));const m=o.boxZoom=new gs(o,i);this._add("boxZoom",m);const y=new No,b=new Kp;o.doubleClickZoom=new Jp(b,y),this._add("tapZoom",y),this._add("clickZoom",b);const A=new Hm;this._add("tapDragZoom",A);const C=o.touchPitch=new Gp(o);this._add("touchPitch",C);const z=new nu(i),D=new au(i);o.dragRotate=new Gm(i,z,D),this._add("mouseRotate",z,["mousePitch"]),this._add("mousePitch",D,["mouseRotate"]);const U=new Tl(i),F=new $d(o,i);o.dragPan=new Wm(u,U,F),this._add("mousePan",U),this._add("touchPan",F,["touchZoom","touchRotate"]);const W=new Wp,X=new Hp;o.touchZoomRotate=new zr(u,X,W,A),this._add("touchRotate",W,["touchPan","touchZoom"]),this._add("touchZoom",X,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Yd(o));const Y=o.scrollZoom=new $p(o,this);this._add("scrollZoom",Y,["mousePan"]);const te=o.keyboard=new Yp;this._add("keyboard",te);for(const J of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])i.interactive&&i[J]&&o[J].enable(i[J])}_add(i,o,u){this._handlers.push({handlerName:i,handler:o,allowed:u}),this._handlersById[i]=o}stop(i){if(!this._updatingCamera){for(const{handler:o}of this._handlers)o.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:i}of this._handlers)if(i.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ic(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(i,o,u){for(const m in i)if(m!==u&&(!o||o.indexOf(m)<0))return!0;return!1}handleWindowEvent(i){this.handleEvent(i,`${i.type}Window`)}_getMapTouches(i){const o=[];for(const u of i)this._el.contains(u.target)&&o.push(u);return o}handleEvent(i,o){this._updatingCamera=!0;const u=i.type==="renderFrame",m=u?void 0:i,y={needsRenderFrame:!1},b={},A={},C=i.touches?this._getMapTouches(i.touches):void 0,z=C?Ue(this._el,C):u?void 0:Ie(this._el,i);for(const{handlerName:F,handler:W,allowed:X}of this._handlers){if(!W.isEnabled())continue;let Y;this._blockedByActive(A,X,F)?W.reset():W[o||i.type]&&(Y=W[o||i.type](i,z,C),this.mergeHandlerResult(y,b,Y,F,m),Y&&Y.needsRenderFrame&&this._triggerRenderFrame()),(Y||W.isActive())&&(A[F]=W)}const D={};for(const F in this._previousActiveHandlers)A[F]||(D[F]=m);this._previousActiveHandlers=A,(Object.keys(D).length||cu(y))&&(this._changes.push([y,b,D]),this._triggerRenderFrame()),(Object.keys(A).length||cu(y))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:U}=y;U&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],U(this._map))}mergeHandlerResult(i,o,u,m,y){if(!u)return;Object.assign(i,u);const b={handlerName:m,originalEvent:u.originalEvent||y};u.zoomDelta!==void 0&&(o.zoom=b),u.panDelta!==void 0&&(o.drag=b),u.pitchDelta!==void 0&&(o.pitch=b),u.bearingDelta!==void 0&&(o.rotate=b)}_applyChanges(){const i={},o={},u={};for(const[m,y,b]of this._changes)m.panDelta&&(i.panDelta=(i.panDelta||new r.P(0,0))._add(m.panDelta)),m.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+m.pitchDelta),m.around!==void 0&&(i.around=m.around),m.aroundCoord!==void 0&&(i.aroundCoord=m.aroundCoord),m.pinchAround!==void 0&&(i.pinchAround=m.pinchAround),m.noInertia&&(i.noInertia=m.noInertia),Object.assign(o,y),Object.assign(u,b);this._updateMapTransform(i,o,u),this._changes=[]}_updateMapTransform(i,o,u){const m=this._map,y=m.transform,b=re=>[re.x,re.y,re.z];if((re=>{const oe=this._eventsInProgress.drag;return oe&&!this._handlersById[oe.handlerName].isActive()})()&&!cu(i)){const re=y.zoom;y.cameraElevationReference="sea",this._originalZoom!=null&&y._orthographicProjectionAtLowPitch&&y.projection.name!=="globe"&&y.pitch===0?(y.cameraElevationReference="ground",y.zoom=this._originalZoom):(y.recenterOnTerrain(),y.cameraElevationReference="ground"),re!==y.zoom&&this._map._update(!0)}if(y._isCameraConstrained&&m._stop(!0),!cu(i))return void this._fireEvents(o,u,!0);let{panDelta:A,zoomDelta:C,bearingDelta:z,pitchDelta:D,around:U,aroundCoord:F,pinchAround:W}=i;y._isCameraConstrained&&(C>0&&(C=0),y._isCameraConstrained=!1),W!==void 0&&(U=W),(C||(re=>o[re]&&!this._eventsInProgress[re])("drag"))&&U&&(this._dragOrigin=b(y.pointCoordinate3D(U)),this._originalZoom=y.zoom,this._trackingEllipsoid.setup(y._camera.position,this._dragOrigin)),y.cameraElevationReference="sea",m._stop(!0),U=U||m.transform.centerPoint,z&&(y.bearing+=z),D&&(y.pitch+=D),y._updateCameraState();const X=[0,0,0];if(A)if(y.projection.name==="mercator"){const re=this._trackingEllipsoid.projectRay(y.screenPointToMercatorRay(U).dir),oe=this._trackingEllipsoid.projectRay(y.screenPointToMercatorRay(U.sub(A)).dir);X[0]=oe[0]-re[0],X[1]=oe[1]-re[1]}else{const re=y.pointCoordinate(U);if(y.projection.name==="globe"){A=A.rotate(-y.angle);const oe=y._pixelsPerMercatorPixel/y.worldSize;X[0]=-A.x*r.eN(r.a$(re.y))*oe,X[1]=-A.y*r.eN(y.center.lat)*oe}else{const oe=y.pointCoordinate(U.sub(A));re&&oe&&(X[0]=oe.x-re.x,X[1]=oe.y-re.y)}}const Y=y.zoom,te=[0,0,0];if(C){const re=b(F||y.pointCoordinate3D(U)),oe={dir:r.aw([],r.av([],re,y._camera.position))};if(oe.dir[2]<0){const he=y.zoomDeltaToMovement(re,C);r.c4(te,oe.dir,he)}}const J=r.d7(X,X,te);y._translateCameraConstrained(J),C&&Math.abs(y.zoom-Y)>1e-4&&y.recenterOnTerrain(),y.cameraElevationReference="ground",this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(o,u,!0)}_fireEvents(i,o,u){const m=Ic(this._eventsInProgress),y=Ic(i),b={};for(const D in i){const{originalEvent:U}=i[D];this._eventsInProgress[D]||(b[`${D}start`]=U),this._eventsInProgress[D]=i[D]}!m&&y&&this._fireEvent("movestart",y.originalEvent);for(const D in b)this._fireEvent(D,b[D]);y&&this._fireEvent("move",y.originalEvent);for(const D in i){const{originalEvent:U}=i[D];this._fireEvent(D,U)}const A={};let C;for(const D in this._eventsInProgress){const{handlerName:U,originalEvent:F}=this._eventsInProgress[D];this._handlersById[U].isActive()||(delete this._eventsInProgress[D],C=o[U]||F,A[`${D}end`]=C)}for(const D in A)this._fireEvent(D,A[D]);const z=Ic(this._eventsInProgress);if(u&&(m||y)&&!z){this._updatingCamera=!0;const D=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),U=F=>F!==0&&-this._bearingSnap<F&&F<this._bearingSnap;D?(U(D.bearing||this._map.getBearing())&&(D.bearing=0),this._map.easeTo(D,{originalEvent:C})):(this._map.fire(new r.z("moveend",{originalEvent:C})),U(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(i,o){this._map.fire(new r.z(i,o?{originalEvent:o}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(i=>{this._frameId=void 0,this.handleEvent(new Xm("renderFrame",{timeStamp:i})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Qd="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class ef extends r.E{constructor(i,o){super(),this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=o.bearingSnap,this._respectPrefersReducedMotion=o.respectPrefersReducedMotion!==!1,r.aY(["_renderFrameCallback"],this)}getCenter(){return new r.aR(this.transform.center.lng,this.transform.center.lat)}setCenter(i,o){return this.jumpTo({center:i},o)}panBy(i,o,u){return i=r.P.convert(i).mult(-1),this.panTo(this.transform.center,Object.assign({offset:i},o),u)}panTo(i,o,u){return this.easeTo(Object.assign({center:i},o),u)}getZoom(){return this.transform.zoom}setZoom(i,o){return this.jumpTo({zoom:i},o),this}zoomTo(i,o,u){return this.easeTo(Object.assign({zoom:i},o),u)}zoomIn(i,o){return this.zoomTo(this.getZoom()+1,i,o),this}zoomOut(i,o){return this.zoomTo(this.getZoom()-1,i,o),this}getBearing(){return this.transform.bearing}setBearing(i,o){return this.jumpTo({bearing:i},o),this}getPadding(){return this.transform.padding}setPadding(i,o){return this.jumpTo({padding:i},o),this}rotateTo(i,o,u){return this.easeTo(Object.assign({bearing:i},o),u)}resetNorth(i,o){return this.rotateTo(0,Object.assign({duration:1e3},i),o),this}resetNorthPitch(i,o){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},i),o),this}snapToNorth(i,o){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,o):this}getPitch(){return this.transform.pitch}setPitch(i,o){return this.jumpTo({pitch:i},o),this}cameraForBounds(i,o){i=r.aI.convert(i);const u=o&&o.bearing||0,m=o&&o.pitch||0,y=i.getNorthWest(),b=i.getSouthEast();return this._cameraForBounds(this.transform,y,b,u,m,o)}_extendPadding(i){const o={top:0,right:0,bottom:0,left:0};return i==null?Object.assign({},o,this.transform.padding):typeof i=="number"?{top:i,bottom:i,right:i,left:i}:Object.assign({},o,i)}_extendCameraOptions(i){return(i=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},i)).padding=this._extendPadding(i.padding),i}_minimumAABBFrustumDistance(i,o){const u=o.max[0]-o.min[0],m=o.max[1]-o.min[1];return u/m>i.aspect?u/(2*Math.tan(.5*i.fovX)*i.aspect):m/(2*Math.tan(.5*i.fovY)*i.aspect)}_cameraForBoundsOnGlobe(i,o,u,m,y,b){const A=i.clone(),C=this._extendCameraOptions(b);A.bearing=m,A.pitch=y;const z=r.aR.convert(o),D=r.aR.convert(u),U=.5*(z.lat+D.lat),F=.5*(z.lng+D.lng),W=r.eQ(U,F),X=r.aw([],W),Y=r.aw([],r.bI([],X,[0,1,0])),te=r.bI([],Y,X),J=[Y[0],Y[1],Y[2],0,te[0],te[1],te[2],0,X[0],X[1],X[2],0,0,0,0,1],re=[W,r.eQ(z.lat,z.lng),r.eQ(D.lat,z.lng),r.eQ(D.lat,D.lng),r.eQ(z.lat,D.lng),r.eQ(U,z.lng),r.eQ(U,D.lng),r.eQ(z.lat,F),r.eQ(D.lat,F)];let oe=r.d8.fromPoints(re.map(We=>[r.bJ(Y,We),r.bJ(te,We),r.bJ(X,We)]));const he=r.af([],oe.center,J);r.eR(he)===0&&r.eS(he,0,0,1),r.aw(he,he),r.c4(he,he,r.aD),A.center=r.eT(he);const ye=A.getWorldToCameraMatrix(),me=r.bl(new Float64Array(16),ye);oe=r.d8.applyTransform(oe,r.aB([],ye,J));const xe=this._extendAABB(oe,A,C,m);if(!xe)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");oe=xe,r.af(he,he,ye);const _e=.5*(oe.max[2]-oe.min[2]),ge=this._minimumAABBFrustumDistance(A,oe),Ae=r.c4([],[0,0,1],_e),je=r.d7(Ae,he,Ae),Re=ge+(A.pitch===0?0:r.bG(he,je)),Je=A.globeCenterInViewSpace,Ne=r.av([],he,[Je[0],Je[1],Je[2]]);r.aw(Ne,Ne),r.c4(Ne,Ne,Re);const $e=r.d7([],he,Ne);r.af($e,$e,me);const vt=r.eD/r.aD,Ve=r.ag($e),Pe=r.ce(Math.max(Ve*vt-r.eD,Number.EPSILON),0),Qe=Math.min(A.zoomFromMercatorZAdjusted(Pe),C.maxZoom);return Qe>.5*(r.cZ+r.cK)?(A.setProjection({name:"mercator"}),A.zoom=Qe,this._cameraForBounds(A,o,u,m,y,b)):{center:A.center,zoom:Qe,bearing:m,pitch:y}}_extendAABB(i,o,u,m){const y=.5*((u.padding.left||0)+(u.padding.right||0)),b=.5*((u.padding.top||0)+(u.padding.bottom||0)),A=b,C=y,z=y,D=b,U=o.width-(C+z),F=o.height-(A+D),W=r.av([],i.max,i.min),X=Math.min(U/W[0],F/W[1]),Y=Math.min(o.scaleZoom(o.scale*X),u.maxZoom);if(isNaN(Y))return null;const te=o.scale/o.zoomScale(Y),J=new r.d8([i.min[0]-C*te,i.min[1]-D*te,i.min[2]],[i.max[0]+z*te,i.max[1]+A*te,i.max[2]]),re=(typeof u.offset.x=="number"&&typeof u.offset.y=="number"?new r.P(u.offset.x,u.offset.y):r.P.convert(u.offset)).rotate(-r.an(m));return J.center[0]-=re.x*te,J.center[1]+=re.y*te,J}queryTerrainElevation(i,o){const u=this.transform.elevation;return u?(o=Object.assign({},{exaggerated:!0},o),u.getAtPoint(r.ae.fromLngLat(i),null,o.exaggerated)):null}_cameraForBounds(i,o,u,m,y,b){if(i.projection.name==="globe")return this._cameraForBoundsOnGlobe(i,o,u,m,y,b);const A=i.clone(),C=this._extendCameraOptions(b);A.bearing=m,A.pitch=y;const z=r.aR.convert(o),D=r.aR.convert(u),U=new r.aR(z.lng,D.lat),F=new r.aR(D.lng,z.lat),W=A.project(z),X=A.project(D),Y=this.queryTerrainElevation(z),te=this.queryTerrainElevation(D),J=this.queryTerrainElevation(U),re=this.queryTerrainElevation(F),oe=[[W.x,W.y,Math.min(Y||0,te||0,J||0,re||0)],[X.x,X.y,Math.max(Y||0,te||0,J||0,re||0)]];let he=r.d8.fromPoints(oe);const ye=A.getWorldToCameraMatrix(),me=r.bl(new Float64Array(16),ye);he=r.d8.applyTransform(he,ye);const xe=this._extendAABB(he,A,C,m);if(!xe)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");he=xe;const _e=.5*r.av([],he.max,he.min)[2],ge=this._minimumAABBFrustumDistance(A,he),Ae=[0,0,1,0];r.aC(Ae,Ae,ye),r.eU(Ae,Ae);const je=r.c4([],Ae,ge+_e),Re=r.d7([],he.center,je);r.af(he.center,he.center,me),r.af(Re,Re,me);const Je=A.unproject(new r.P(he.center[0],he.center[1])),Ne=r.eV(A.projection,Je),$e=Math.pow(2,Ne),vt=Math.min(A._zoomFromMercatorZ(Re[2]*A.pixelsPerMeter*$e/A.worldSize),C.maxZoom);return A.mercatorFromTransition&&vt<.5*(r.cZ+r.cK)?(A.setProjection({name:"globe"}),A.zoom=vt,this._cameraForBounds(A,o,u,m,y,b)):{center:Je,zoom:vt,bearing:m,pitch:y}}fitBounds(i,o,u){const m=this.cameraForBounds(i,o);return this._fitInternal(m,o,u)}fitScreenCoordinates(i,o,u,m,y){const b=r.P.convert(i),A=r.P.convert(o),C=new r.P(Math.min(b.x,A.x),Math.min(b.y,A.y)),z=new r.P(Math.max(b.x,A.x),Math.max(b.y,A.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(b,A))return this;const D=this.transform.pointLocation3D(C),U=this.transform.pointLocation3D(z),F=this.transform.pointLocation3D(new r.P(C.x,z.y)),W=this.transform.pointLocation3D(new r.P(z.x,C.y)),X=[Math.min(D.lng,U.lng,F.lng,W.lng),Math.min(D.lat,U.lat,F.lat,W.lat)],Y=[Math.max(D.lng,U.lng,F.lng,W.lng),Math.max(D.lat,U.lat,F.lat,W.lat)],te=m&&m.pitch?m.pitch:this.getPitch(),J=this._cameraForBounds(this.transform,X,Y,u,te,m);return this._fitInternal(J,m,y)}_fitInternal(i,o,u){return i?(o=Object.assign(i,o)).linear?this.easeTo(o,u):this.flyTo(o,u):this}jumpTo(i,o){this.stop();const u=i.preloadOnly?this.transform.clone():this.transform;let m=!1,y=!1,b=!1;"zoom"in i&&u.zoom!==+i.zoom&&(m=!0,u.zoom=+i.zoom),i.center!==void 0&&(u.center=r.aR.convert(i.center)),"bearing"in i&&u.bearing!==+i.bearing&&(y=!0,u.bearing=+i.bearing),"pitch"in i&&u.pitch!==+i.pitch&&(b=!0,u.pitch=+i.pitch);const A=typeof i.padding=="number"?this._extendPadding(i.padding):i.padding;if(i.padding!=null&&!u.isPaddingEqual(A))if(i.retainPadding===!1){const C=u.clone();C.padding=A,u.setLocationAtPoint(u.center,C.centerPoint)}else u.padding=A;return i.preloadOnly?(this._preloadTiles(u),this):(this.fire(new r.z("movestart",o)).fire(new r.z("move",o)),m&&this.fire(new r.z("zoomstart",o)).fire(new r.z("zoom",o)).fire(new r.z("zoomend",o)),y&&this.fire(new r.z("rotatestart",o)).fire(new r.z("rotate",o)).fire(new r.z("rotateend",o)),b&&this.fire(new r.z("pitchstart",o)).fire(new r.z("pitch",o)).fire(new r.z("pitchend",o)),this.fire(new r.z("moveend",o)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||r.w(Qd),this.transform.getFreeCameraOptions()}setFreeCameraOptions(i,o){const u=this.transform;if(!u.projection.supportsFreeCamera)return r.w(Qd),this;this.stop();const m=u.zoom,y=u.pitch,b=u.bearing;u.setFreeCameraOptions(i);const A=m!==u.zoom,C=y!==u.pitch,z=b!==u.bearing;return this.fire(new r.z("movestart",o)).fire(new r.z("move",o)),A&&this.fire(new r.z("zoomstart",o)).fire(new r.z("zoom",o)).fire(new r.z("zoomend",o)),z&&this.fire(new r.z("rotatestart",o)).fire(new r.z("rotate",o)).fire(new r.z("rotateend",o)),C&&this.fire(new r.z("pitchstart",o)).fire(new r.z("pitch",o)).fire(new r.z("pitchend",o)),this.fire(new r.z("moveend",o)),this}easeTo(i,o){this._stop(!1,i.easeId),((i=Object.assign({offset:[0,0],duration:500,easing:r.eM},i)).animate===!1||this._prefersReducedMotion(i))&&(i.duration=0);const u=this.transform,m=this.getZoom(),y=this.getBearing(),b=this.getPitch(),A=this.getPadding(),C="zoom"in i?+i.zoom:m,z="bearing"in i?this._normalizeBearing(i.bearing,y):y,D="pitch"in i?+i.pitch:b,U=this._extendPadding(i.padding),F=r.P.convert(i.offset);let W,X,Y;if(u.projection.name==="globe"){const Ae=r.ae.fromLngLat(u.center),je=F.rotate(-u.angle);Ae.x+=je.x/u.worldSize,Ae.y+=je.y/u.worldSize;const Re=Ae.toLngLat(),Je=r.aR.convert(i.center||Re);this._normalizeCenter(Je),W=u.centerPoint.add(je),X=new r.P(Ae.x,Ae.y).mult(u.worldSize),Y=new r.P(r.aF(Je.lng),r.aJ(Je.lat)).mult(u.worldSize).sub(X)}else{W=u.centerPoint.add(F);const Ae=u.pointLocation(W),je=r.aR.convert(i.center||Ae);this._normalizeCenter(je),X=u.project(Ae),Y=u.project(je).sub(X)}const te=u.zoomScale(C-m);let J,re;i.around&&(J=r.aR.convert(i.around),re=u.locationPoint(J));const oe=this._zooming||C!==m,he=this._rotating||y!==z,ye=this._pitching||D!==b,me=!u.isPaddingEqual(U),xe=i.retainPadding===!1?u.clone():u,_e=Ae=>je=>{if(oe&&(Ae.zoom=r.ak(m,C,je)),he&&(Ae.bearing=r.ak(y,z,je)),ye&&(Ae.pitch=r.ak(b,D,je)),me&&(xe.interpolatePadding(A,U,je),W=xe.centerPoint.add(F)),J)Ae.setLocationAtPoint(J,re);else{const Re=Ae.zoomScale(Ae.zoom-m),Je=C>m?Math.min(2,te):Math.max(.5,te),Ne=Math.pow(Je,1-je),$e=Ae.unproject(X.add(Y.mult(je*Ne)).mult(Re));Ae.setLocationAtPoint(Ae.renderWorldCopies?$e.wrap():$e,W)}return i.preloadOnly||this._fireMoveEvents(o),Ae};if(i.preloadOnly){const Ae=this._emulate(_e,i.duration,u);return this._preloadTiles(Ae),this}const ge={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=oe,this._rotating=he,this._pitching=ye,this._padding=me,this._easeId=i.easeId,this._prepareEase(o,i.noMoveStart,ge),this._ease(_e(u),Ae=>{u.cameraElevationReference==="sea"&&u.recenterOnTerrain(),this._afterEase(o,Ae)},i),this}_prepareEase(i,o,u={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),o||u.moving||this.fire(new r.z("movestart",i)),this._zooming&&!u.zooming&&this.fire(new r.z("zoomstart",i)),this._rotating&&!u.rotating&&this.fire(new r.z("rotatestart",i)),this._pitching&&!u.pitching&&this.fire(new r.z("pitchstart",i))}_fireMoveEvents(i){this.fire(new r.z("move",i)),this._zooming&&this.fire(new r.z("zoom",i)),this._rotating&&this.fire(new r.z("rotate",i)),this._pitching&&this.fire(new r.z("pitch",i))}_afterEase(i,o){if(this._easeId&&o&&this._easeId===o)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const u=this._zooming,m=this._rotating,y=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,u&&this.fire(new r.z("zoomend",i)),m&&this.fire(new r.z("rotateend",i)),y&&this.fire(new r.z("pitchend",i)),this.fire(new r.z("moveend",i))}flyTo(i,o){if(this._prefersReducedMotion(i)){const We=r.aH(i,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(We,o)}this.stop(),i=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:r.eM},i);const u=this.transform,m=this.getZoom(),y=this.getBearing(),b=this.getPitch(),A=this.getPadding(),C="zoom"in i?r.aA(+i.zoom,u.minZoom,u.maxZoom):m,z="bearing"in i?this._normalizeBearing(i.bearing,y):y,D="pitch"in i?+i.pitch:b,U=this._extendPadding(i.padding),F=u.zoomScale(C-m),W=r.P.convert(i.offset);let X=u.centerPoint.add(W);const Y=u.pointLocation(X),te=r.aR.convert(i.center||Y);this._normalizeCenter(te);const J=u.project(Y),re=u.project(te).sub(J);let oe=i.curve;const he=Math.max(u.width,u.height),ye=he/F,me=re.mag();if("minZoom"in i){const We=r.aA(Math.min(i.minZoom,m,C),u.minZoom,u.maxZoom),at=he/u.zoomScale(We-m);oe=Math.sqrt(at/me*2)}const xe=oe*oe;function _e(We){const at=(ye*ye-he*he+(We?-1:1)*xe*xe*me*me)/(2*(We?ye:he)*xe*me);return Math.log(Math.sqrt(at*at+1)-at)}function ge(We){return(Math.exp(We)-Math.exp(-We))/2}function Ae(We){return(Math.exp(We)+Math.exp(-We))/2}const je=_e(0);let Re=function(We){return Ae(je)/Ae(je+oe*We)},Je=function(We){return he*((Ae(je)*(ge(at=je+oe*We)/Ae(at))-ge(je))/xe)/me;var at},Ne=(_e(1)-je)/oe;if(Math.abs(me)<1e-6||!isFinite(Ne)){if(Math.abs(he-ye)<1e-6)return this.easeTo(i,o);const We=ye<he?-1:1;Ne=Math.abs(Math.log(ye/he))/oe,Je=function(){return 0},Re=function(at){return Math.exp(We*oe*at)}}i.duration="duration"in i?+i.duration:1e3*Ne/("screenSpeed"in i?+i.screenSpeed/oe:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0);const $e=y!==z,vt=D!==b,Ve=!u.isPaddingEqual(U),Pe=i.retainPadding===!1?u.clone():u,Qe=We=>at=>{const xt=at*Ne,Pt=1/Re(xt);We.zoom=at===1?C:m+We.scaleZoom(Pt),$e&&(We.bearing=r.ak(y,z,at)),vt&&(We.pitch=r.ak(b,D,at)),Ve&&(Pe.interpolatePadding(A,U,at),X=Pe.centerPoint.add(W));const pt=at===1?te:We.unproject(J.add(re.mult(Je(xt))).mult(Pt));return We.setLocationAtPoint(We.renderWorldCopies?pt.wrap():pt,X),We._updateCameraOnTerrain(),i.preloadOnly||this._fireMoveEvents(o),We};if(i.preloadOnly){const We=this._emulate(Qe,i.duration,u);return this._preloadTiles(We),this}return this._zooming=!0,this._rotating=$e,this._pitching=vt,this._padding=Ve,this._prepareEase(o,!1),this._ease(Qe(u),()=>this._afterEase(o),i),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(i){}_cancelRenderFrame(i){}_stop(i,o){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const u=this._onEaseEnd;this._onEaseEnd=void 0,u.call(this,o)}if(!i){const u=this.handlers;u&&u.stop(!1)}return this}_ease(i,o,u){u.animate===!1||u.duration===0?(i(1),o()):(this._easeStart=r.o.now(),this._easeOptions=u,this._onEaseFrame=i,this._onEaseEnd=o,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const i=Math.min((r.o.now()-this._easeStart)/this._easeOptions.duration,1),o=this._onEaseFrame;o&&o(this._easeOptions.easing(i)),i<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(i,o){i=r.bT(i,-180,180);const u=Math.abs(i-o);return Math.abs(i-360-o)<u&&(i-=360),Math.abs(i+360-o)<u&&(i+=360),i}_normalizeCenter(i){const o=this.transform;if(o.maxBounds||o.projection.name!=="globe"&&!o.renderWorldCopies)return;const u=i.lng-o.center.lng;i.lng+=u>180?-360:u<-180?360:0}_prefersReducedMotion(i){return this._respectPrefersReducedMotion&&r.o.prefersReducedMotion&&!(i&&i.essential)}_emulate(i,o,u){const m=Math.ceil(15*o/1e3),y=[],b=i(u.clone());for(let A=0;A<=m;A++){const C=b(A/m);y.push(C.clone())}return y}_preloadTiles(i,o){}}class Mc{constructor(i={}){this.options=i,r.aY(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(i){const o=this.options&&this.options.compact,u=i._getUIString("AttributionControl.ToggleAttribution");this._map=i,this._container=H("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=H("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",u);const m=H("span","mapboxgl-ctrl-icon",this._compactButton);return m.setAttribute("aria-hidden","true"),m.setAttribute("title",u),this._innerContainer=H("div","mapboxgl-ctrl-attrib-inner",this._container),o&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),o===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let i=this._editLink;i||(i=this._editLink=this._container.querySelector(".mapbox-improve-map"));const o=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||r.e.ACCESS_TOKEN}];if(i){const u=o.reduce((m,y,b)=>(y.value&&(m+=`${y.key}=${y.value}${b<o.length-1?"&":""}`),m),"?");i.href=`${r.e.FEEDBACK_URL}/${u}#${tu(this._map,!0)}`,i.rel="noopener nofollow"}}_updateData(i){!i||(i.dataType!=="source"||i.sourceDataType!=="metadata"&&i.sourceDataType!=="visibility")&&i.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let i=[];if(this._map.style.stylesheet){const m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}const o=this._map.style._mergedSourceCaches;for(const m in o){const y=o[m];if(y.used){const b=y.getSource();b.attribution&&i.indexOf(b.attribution)<0&&i.push(b.attribution)}}i.sort((m,y)=>m.length-y.length),i=i.filter((m,y)=>{for(let b=y+1;b<i.length;b++)if(i[b].indexOf(m)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=[...this.options.customAttribution,...i]:i.unshift(this.options.customAttribution));const u=i.join(" | ");u!==this._attribHTML&&(this._attribHTML=u,i.length?(this._innerContainer.innerHTML=u,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class ra{constructor(){r.aY(["_updateLogo","_updateCompact"],this)}onAdd(i){this._map=i,this._container=H("div","mapboxgl-ctrl");const o=H("a","mapboxgl-ctrl-logo");return o.target="_blank",o.rel="noopener nofollow",o.href="https://www.mapbox.com/",o.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),o.setAttribute("rel","noopener nofollow"),this._container.appendChild(o),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(i){i&&i.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const i=this._map.style._sourceCaches;if(Object.entries(i).length===0)return!0;for(const o in i){const u=i[o].getSource();if(u.hasOwnProperty("mapbox_logo")&&!u.mapbox_logo)return!1}return!0}_updateCompact(){const i=this._container.children;if(i.length){const o=i[0];this._map.getCanvasContainer().offsetWidth<250?o.classList.add("mapboxgl-compact"):o.classList.remove("mapboxgl-compact")}}}class Pc{constructor(){r.aY(["_onIndoorUpdate"],this)}onAdd(i){return this._map=i,this._container=H("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("indoorupdate",o=>this._onIndoorUpdate({selectedFloorId:o.selectedFloorId,floors:o.floors})),this._container}_createButton(i,o){const u=H("button",i,this._container);return u.type="button",u.addEventListener("click",o),u}_createSeparator(){return H("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(i,o){this._map&&(i.setAttribute("aria-label",o),i.textContent=o)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("indoorupdate",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(i){if(!i||!i.floors)return void(this._container.style.display="none");const o=this._model;this._model=i,this._container.style.display="inline-block",this._container.style.borderRadius="8px";const u=i.floors.sort((m,y)=>y.levelOrder-m.levelOrder);o?(Array.from(this._container.children).forEach(m=>m.remove()),this.addCurrentFloors(u)):this.addCurrentFloors(u)}addCurrentFloors(i){for(let o=0;o<i.length;o++){const u=i[o],m=this._createButton("mapboxgl-ctrl-level-button",()=>{this._map._selectIndoorFloor(u.id),this._model&&(this._model.selectedFloorId=u.id),Array.from(this._container.children).forEach(y=>{y.classList.contains("mapboxgl-ctrl-level-button")&&y.classList.remove("mapboxgl-ctrl-level-button-selected")}),m.classList.add("mapboxgl-ctrl-level-button-selected")});this._setButtonTitle(m,u.shortName),this._model&&u.id===this._model.selectedFloorId&&m.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(m),o<i.length-1&&this._createSeparator()}}}class Kr{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(i){const o=++this._id;return this._queue.push({callback:i,id:o,cancelled:!1}),o}remove(i){const o=this._currentlyRunning,u=o?this._queue.concat(o):this._queue;for(const m of u)if(m.id===i)return void(m.cancelled=!0)}run(i=0){const o=this._currentlyRunning=this._queue;this._queue=[];for(const u of o)if(!u.cancelled&&(u.callback(i),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class sa{constructor(i){this.jumpTo(i)}getValue(i){if(i<=this._startTime)return this._start;if(i>=this._endTime)return this._end;const o=r.dz((i-this._startTime)/(this._endTime-this._startTime));return this._start*(1-o)+this._end*o}isEasing(i){return i>=this._startTime&&i<=this._endTime}jumpTo(i){this._startTime=-1/0,this._endTime=-1/0,this._start=i,this._end=i}easeTo(i,o,u){this._start=this.getValue(o),this._end=i,this._startTime=o,this._endTime=o+u}}const Lc={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class zc extends r.z{constructor(i,o,u,m){const{point:y,lngLat:b,originalEvent:A,target:C}=i;super(i.type,{point:y,lngLat:b,originalEvent:A,target:C}),this.preventDefault=()=>{i.preventDefault()},this.id=o,this.interaction=u,this.feature=m}}class Qp{constructor(i){this.map=i,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(i,o){if(this.typeById.has(i))throw new Error(`Interaction id "${i}" already exists.`);const u=o.filter;let m=o.type;u&&this.filters.set(i,r.b6(u)),m==="mouseover"&&(m="mouseenter"),m==="mouseout"&&(m="mouseleave");const y=this.interactionsByType.get(m)||new Map;m==="mouseenter"||m==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(i,o)):y.size===0&&this.map.on(m,this.handleType),y.size===0&&this.interactionsByType.set(m,y),y.set(i,o),this.typeById.set(i,m)}get(i){const o=this.typeById.get(i);if(!o)return;const u=this.interactionsByType.get(o);return u?u.get(i):void 0}remove(i){const o=this.typeById.get(i);if(!o)return;this.typeById.delete(i),this.filters.delete(i);const u=this.interactionsByType.get(o);u&&(u.delete(i),o==="mouseenter"||o==="mouseleave"?(this.delegatedInteractions.delete(i),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):u.size===0&&this.map.off(o,this.handleType))}queryTargets(i,o){const u=[];for(const[m,y]of o)y.target&&u.push({targetId:m,target:y.target,filter:this.filters.get(m)});return this.map.style.queryRenderedTargets(i,u,this.map.transform)}handleMove(i){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const o=this.queryTargets(i.point,Array.from(this.delegatedInteractions).reverse());o.length&&(i.type="mouseenter",this.handleType(i,o));const u=new Map;for(const[m,{feature:y}]of this.prevHoveredFeatures)this.hoveredFeatures.has(m)||u.set(y.id,y);u.size&&(i.type="mouseleave",this.handleType(i,Array.from(u.values())))}handleOut(i){const o=Array.from(this.hoveredFeatures.values()).map(({feature:u})=>u);o.length&&(i.type="mouseleave",this.handleType(i,o)),this.hoveredFeatures.clear()}handleType(i,o){const u=i.type==="mouseenter";if(u&&!this.interactionsByType.has(i.type))return void r.w("mouseenter interaction required for mouseleave to work.");const m=Array.from(this.interactionsByType.get(i.type)).reverse(),y=!!o;o=o||this.queryTargets(i.point,m);let b=!1;const A=new Set;for(const C of o){for(const[z,D]of m){if(!D.target)continue;const U=C.variants?C.variants[z]:null;if(U){for(const F of U){if(Va(F,C,A,z))continue;const W=new r.dt(C,F),X=Ql(F,C,z);y&&(W.state=this.map.getFeatureState(W));const Y=u?this.prevHoveredFeatures.get(X):null,te=new zc(i,z,D,W),J=Y?Y.stop:D.handler(te);if(u&&this.hoveredFeatures.set(X,{feature:C,stop:J}),J!==!1){b=!0;break}}if(b)break}}if(b)break}if(!b)for(const[C,z]of m){const{handler:D,target:U}=z;if(!U&&D(new zc(i,C,z,null))!==!1)break}}}function qm(d,i){if(Array.isArray(d)&&Array.isArray(i)){const o=new Set(d),u=new Set(i);return o.size===u.size&&d.every(m=>u.has(m))}return r.by(d,i)}const Rc={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},Zm={showCompass:!0,showZoom:!0,visualizePitch:!1};class $m{constructor(i,o,u=!1){this._clickTolerance=10,this.element=o,this.mouseRotate=new nu({clickTolerance:i.dragRotate._mouseRotate._clickTolerance}),this.map=i,u&&(this.mousePitch=new au({clickTolerance:i.dragRotate._mousePitch._clickTolerance})),r.aY(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),o.addEventListener("mousedown",this.mousedown),o.addEventListener("touchstart",this.touchstart,{passive:!1}),o.addEventListener("touchmove",this.touchmove),o.addEventListener("touchend",this.touchend),o.addEventListener("touchcancel",this.reset)}down(i,o){this.mouseRotate.mousedown(i,o),this.mousePitch&&this.mousePitch.mousedown(i,o),ve()}move(i,o){const u=this.map,m=this.mouseRotate.mousemoveWindow(i,o),y=m&&m.bearingDelta;if(y&&u.setBearing(u.getBearing()+y),this.mousePitch){const b=this.mousePitch.mousemoveWindow(i,o),A=b&&b.pitchDelta;A&&u.setPitch(u.getPitch()+A)}}off(){const i=this.element;i.removeEventListener("mousedown",this.mousedown),i.removeEventListener("touchstart",this.touchstart),i.removeEventListener("touchmove",this.touchmove),i.removeEventListener("touchend",this.touchend),i.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){ce(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(i){this.down(Object.assign({},i,{ctrlKey:!0,preventDefault:()=>i.preventDefault()}),Ie(this.element,i)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(i){this.move(i,Ie(this.element,i))}mouseup(i){this.mouseRotate.mouseupWindow(i),this.mousePitch&&this.mousePitch.mouseupWindow(i),this.offTemp()}touchstart(i){i.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Ue(this.element,i.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>i.preventDefault()},this._startPos))}touchmove(i){i.targetTouches.length!==1?this.reset():(this._lastPos=Ue(this.element,i.targetTouches)[0],this.move({preventDefault:()=>i.preventDefault()},this._lastPos))}touchend(i){i.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function hu(d,i,o){if(d=new r.aR(d.lng,d.lat),i){const u=new r.aR(d.lng-360,d.lat),m=new r.aR(d.lng+360,d.lat),y=360*Math.ceil(Math.abs(d.lng-o.center.lng)/360),b=o.locationPoint3D(d).distSqr(i),A=i.x<0||i.y<0||i.x>o.width||i.y>o.height;o.locationPoint3D(u).distSqr(i)<b&&(A||Math.abs(u.lng-o.center.lng)<y)?d=u:o.locationPoint3D(m).distSqr(i)<b&&(A||Math.abs(m.lng-o.center.lng)<y)&&(d=m)}for(;Math.abs(d.lng-o.center.lng)>180;){const u=o.locationPoint3D(d);if(u.x>=0&&u.y>=0&&u.x<=o.width&&u.y<=o.height)break;d.lng>o.center.lng?d.lng-=360:d.lng+=360}return d}const Dc={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},wn={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class Vo extends r.E{constructor(i,o){super(),(i instanceof HTMLElement||o)&&(i=Object.assign({element:i},o)),r.aY(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:u="center",color:m="#3FB1CE",scale:y=1,draggable:b=!1,clickTolerance:A=0,rotation:C=wn.rotation,rotationAlignment:z=wn.rotationAlignment,pitchAlignment:D=wn.pitchAlignment,occludedOpacity:U=wn.occludedOpacity,altitude:F=wn.altitude}=i||{};this._anchor=u,this._color=m,this._scale=y,this._draggable=b,this._clickTolerance=A,this._rotation=C,this._rotationAlignment=z,this._pitchAlignment=D,this._occludedOpacity=U,this._altitude=F,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),i&&i.element?(this._element=i.element,this._offset=r.P.convert(i&&i.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=r.P.convert(i&&i.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",Y=>{Y.preventDefault()}),this._element.addEventListener("mousedown",Y=>{Y.preventDefault()});const W=this._element.classList;for(const Y in Dc)W.remove(`mapboxgl-marker-anchor-${Y}`);W.add(`mapboxgl-marker-anchor-${this._anchor}`);const X=i&&i.className?i.className.trim().split(/\s+/):[];W.add(...X),this._popup=null}_createDefaultMarker(){const i=H("div"),o=Q("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},i);if(this._altitude===0){const u=Q("radialGradient",{id:"shadowGradient"},Q("defs",{},o));Q("stop",{offset:"10%","stop-opacity":.4},u),Q("stop",{offset:"100%","stop-opacity":.05},u),Q("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},o)}return Q("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},o),Q("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},o),Q("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},o),i}addTo(i){return i===this._map||(this.remove(),this._map=i,i.getCanvasContainer().appendChild(this._element),i.on("move",this._updateMoving),i.on("moveend",this._update),i.on("remove",this._clearFadeTimer),i._addMarker(this),this.setDraggable(this._draggable),this._update(),i.on("click",this._onMapClick)),this}remove(){const i=this._map;return i&&(i.off("click",this._onMapClick),i.off("move",this._updateMoving),i.off("moveend",this._update),i.off("mousedown",this._addDragHandler),i.off("touchstart",this._addDragHandler),i.off("mouseup",this._onUp),i.off("touchend",this._onUp),i.off("mousemove",this._onMove),i.off("touchmove",this._onMove),i.off("remove",this._clearFadeTimer),i._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(i){return this._lngLat=r.aR.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(i){return i===this._altitude||(this._defaultMarker&&(this._altitude===0&&i!==0||this._altitude!==0&&i===0)&&(this._element=this._createDefaultMarker()),this._altitude=i||wn.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){const m=Math.sqrt(Math.pow(13.5,2)/2);i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(38.1-13.5+m)],"bottom-right":[-m,-1*(38.1-13.5+m)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=i,i._marker=this,i._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(i){const o=i.code,u=i.charCode||i.keyCode;o!=="Space"&&o!=="Enter"&&u!==32&&u!==13||this.togglePopup()}_onMapClick(i){const o=i.originalEvent.target,u=this._element;this._popup&&(o===u||u.contains(o))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const i=this._popup;return i?(i.isOpen()?(i.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(i.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const i=this._map,o=this._pos;if(!i||!o)return!1;const u=i.unproject(o,this._altitude),m=i.getFreeCameraOptions();if(!m.position)return!1;const y=m.position.toLngLat();return y.distanceTo(u)<.9*y.distanceTo(this._lngLat)}_evaluateOpacity(){const i=this._map;if(!i)return;const o=this._pos;if(!o||o.x<0||o.x>i.transform.width||o.y<0||o.y>i.transform.height)return void this._clearFadeTimer();const u=i.unproject(o,this._altitude);let m;i._showingGlobe()&&r.eY(i.transform,this._lngLat)?m=0:(m=1-i._queryFogOpacity(u),i.transform._terrainEnabled()&&i.getTerrain()&&this._behindTerrain()&&(m*=this._occludedOpacity)),this._element.style.opacity=`${m}`,this._element.style.pointerEvents=m>0?"auto":"none",this._popup&&this._popup._setOpacity(m),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const i=this._pos;if(!i||!this._map)return;const o=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${i.x}px,${i.y}px)
            ${Dc[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${o.x}px,${o.y}px)
        `}_calculateXYTransform(){const i=this._pos,o=this._map,u=this.getPitchAlignment();if(!o||!i||u!=="map")return"";if(!o._showingGlobe()){const C=o.getPitch();return C?`rotateX(${C}deg)`:""}const m=r.cW(r.eZ(o.transform,this._lngLat)),y=i.sub(r.e_(o.transform)),b=Math.abs(y.x)+Math.abs(y.y);if(b===0)return"";const A=m/b;return`rotateX(${-y.y*A}deg) rotateY(${y.x*A}deg)`}_calculateZTransform(){const i=this._pos,o=this._map;if(!o||!i)return"";let u=0;const m=this.getRotationAlignment();if(m==="map")if(o._showingGlobe()){const y=o.project(new r.aR(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),b=o.project(new r.aR(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(y);u=r.cW(Math.atan2(b.y,b.x))-90}else u=-o.getBearing();else if(m==="horizon"){const y=r.ah(4,6,o.getZoom()),b=r.e_(o.transform);b.y+=y*o.transform.height;const A=i.sub(b),C=r.cW(Math.atan2(A.y,A.x));u=(C>90?C-270:C+90)*(1-y)}return u+=this._rotation,u?`rotateZ(${u}deg)`:""}_update(i){cancelAnimationFrame(this._updateFrameId);const o=this._map;o&&(o.transform.renderWorldCopies&&(this._lngLat=hu(this._lngLat,this._pos,o.transform)),this._pos=o.project(this._lngLat,this._altitude),i===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),o._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(o._showingGlobe()||o.getTerrain()||o.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(i){return this._offset=r.P.convert(i),this._update(),this}addClassName(i){return this._element.classList.add(i),this}removeClassName(i){return this._element.classList.remove(i),this}toggleClassName(i){return this._element.classList.toggle(i)}_onMove(i){const o=this._map;if(!o)return;const u=this._pointerdownPos,m=this._positionDelta;if(u&&m){if(!this._isDragging){const y=this._clickTolerance||o._clickTolerance;if(i.point.dist(u)<y)return;this._isDragging=!0}this._pos=i.point.sub(m),this._lngLat=o.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new r.z("dragstart"))),this.fire(new r.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const i=this._map;i&&(i.off("mousemove",this._onMove),i.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new r.z("dragend")),this._state="inactive"}_addDragHandler(i){const o=this._map,u=this._pos;o&&u&&this._element.contains(i.originalEvent.target)&&(i.preventDefault(),this._positionDelta=i.point.sub(u),this._pointerdownPos=i.point,this._state="pending",o.on("mousemove",this._onMove),o.on("touchmove",this._onMove),o.once("mouseup",this._onUp),o.once("touchend",this._onUp))}setDraggable(i){this._draggable=!!i;const o=this._map;return o&&(i?(o.on("mousedown",this._addDragHandler),o.on("touchstart",this._addDragHandler)):(o.off("mousedown",this._addDragHandler),o.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(i){return this._rotation=i||wn.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(i){return this._rotationAlignment=i||wn.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(i){return this._pitchAlignment=i||wn.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(i){return this._occludedOpacity=i||wn.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const no={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Aa={maxWidth:100,unit:"metric"},Ta={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Uo={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},Gn=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function eg(d=new r.P(0,0),i="bottom"){if(typeof d=="number"){const o=Math.round(Math.sqrt(.5*Math.pow(d,2)));switch(i){case"top":return new r.P(0,d);case"top-left":return new r.P(o,o);case"top-right":return new r.P(-o,o);case"bottom":return new r.P(0,-d);case"bottom-left":return new r.P(o,-o);case"bottom-right":return new r.P(-o,-o);case"left":return new r.P(d,0);case"right":return new r.P(-d,0)}return new r.P(0,0)}return d instanceof r.P||Array.isArray(d)?r.P.convert(d):r.P.convert(d[i]||[0,0])}return{version:E,supported:G.supported,setRTLTextPlugin:r.f2,getRTLTextPluginStatus:r.f1,Map:class extends ef{constructor(d){P.mark(k.create);const i=d;if((d=Object.assign({},Rc,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(d.antialias&&r.eW(window)&&(d.antialias=!1,r.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Gs(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies,null,null),d),this._repaint=!!d.repaint,this._interactive=d.interactive,this._minTileCacheSize=d.minTileCacheSize,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=d.crossSourceCollisions,this._collectResourceTiming=d.collectResourceTiming,this._language=this._parseLanguage(d.language),this._worldview=d.worldview,this._renderTaskQueue=new Kr,this._domRenderTaskQueue=new Kr,this._controls=[],this._markers=[],this._popups=[],this._mapId=r.b2(),this._locale=Object.assign({},Lc,d.locale),this._clickTolerance=d.clickTolerance,this._cooperativeGestures=d.cooperativeGestures,this._performanceMetricsCollection=d.performanceMetricsCollection,this._tessellationStep=d.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=d.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new sa(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=d.scaleFactor,this._requestManager=new Tt(d.transformRequest,d.accessToken,d.testMode),this._silenceAuthErrors=!!d.testMode,this._contextCreateOptions=d.contextCreateOptions?Object.assign({},d.contextCreateOptions):{},typeof d.container=="string"){const o=document.getElementById(d.container);if(!o)throw new Error(`Container '${d.container.toString()}' not found.`);this._container=o}else{if(!(d.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(this._container.childNodes.length>0&&r.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),d.maxBounds&&this.setMaxBounds(d.maxBounds),this._spriteFormat=d.spriteFormat,r.aY(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new vl),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new kc(this,d),this._localFontFamily=d.localFontFamily,this._localIdeographFontFamily=d.localIdeographFontFamily,(d.style||!d.testMode)&&this.setStyle(d.style||r.e.DEFAULT_STYLE,{config:d.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),d.projection&&this.setProjection(d.projection),this.indoor=new So(this),d.hash&&(this._hash=new Hd(typeof d.hash=="string"&&d.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){i.center==null&&i.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch});const o=d.bounds;o&&(this.resize(),this.fitBounds(o,Object.assign({},d.fitBoundsOptions,{duration:0})))}this.resize(),d.attributionControl&&this.addControl(new Mc({customAttribution:d.customAttribution})),this._logoControl=new ra,this.addControl(this._logoControl,d.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",o=>{this._update(o.dataType==="style"),this.fire(new r.z(`${o.dataType}data`,o))}),this.on("dataloading",o=>{this.fire(new r.z(`${o.dataType}dataloading`,o))}),this._interactions=new Qp(this)}_getMapId(){return this._mapId}addControl(d,i){if(i===void 0&&(i=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new r.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const o=d.onAdd(this);this._controls.push(d);const u=this._controlPositions[i];return i.indexOf("bottom")!==-1?u.insertBefore(o,u.firstChild):u.appendChild(o),this}removeControl(d){if(!d||!d.onRemove)return this.fire(new r.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(d);return i>-1&&this._controls.splice(i,1),d.onRemove(this),this}hasControl(d){return this._controls.indexOf(d)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(d){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const i=!this._moving;return i&&this.fire(new r.z("movestart",d)).fire(new r.z("move",d)),this.fire(new r.z("resize",d)),i&&this.fire(new r.z("moveend",d)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(d){return this.transform.setMaxBounds(r.aI.convert(d)),this._update()}setMinZoom(d){if((d=d!=null?d:-2)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d?this.setZoom(d):this.fire(new r.z("zoomstart")).fire(new r.z("zoom")).fire(new r.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(d){if((d=d!=null?d:22)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d?this.setZoom(d):this.fire(new r.z("zoomstart")).fire(new r.z("zoom")).fire(new r.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(d){if((d=d!=null?d:0)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d?this.setPitch(d):this.fire(new r.z("pitchstart")).fire(new r.z("pitch")).fire(new r.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(d){if((d=d!=null?d:85)>85)throw new Error("maxPitch must be less than or equal to 85");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d?this.setPitch(d):this.fire(new r.z("pitchstart")).fire(new r.z("pitch")).fire(new r.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(d){return this._scaleFactor=d,this.painter.scaleFactor=d,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(i=>i.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(d){return this.transform.renderWorldCopies=d,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(d){return d==="auto"?navigator.language:Array.isArray(d)?d.length===0?void 0:d.map(i=>i==="auto"?navigator.language:i):d}setLanguage(d){const i=this._parseLanguage(d);if(!this.style||i===this._language)return this;this._language=i,this.style.reloadSources();for(const o of this._controls)o._setLanguage&&o._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(d){return this.style&&d!==this._worldview?(this._worldview=d,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(d){return this._lazyInitEmptyStyle(),d?typeof d=="string"&&(d={name:d}):d=null,this._useExplicitProjection=!!d,this._prioritizeAndUpdateProjection(d,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const d=this.transform,i=d.projection.name;let o;i==="globe"&&d.zoom>=r.cK?(d.setMercatorFromTransition(),o=!0):i==="mercator"&&d.zoom<r.cK&&(d.setProjection({name:"globe"}),o=!0),o&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(d,i){return this._updateProjection(d||i||{name:"mercator"})}_updateProjection(d){let i;return i=d.name==="globe"&&this.transform.zoom>=r.cK?this.transform.setMercatorFromTransition():this.transform.setProjection(d),this.style.applyProjectionUpdate(),i&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(d,i){return this.transform.locationPoint3D(r.aR.convert(d),i)}unproject(d,i){return this.transform.pointLocation3D(r.P.convert(d),i)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(d,i,o){const u=m=>{let y=[];if(Array.isArray(i)){const b=i.filter(A=>this.getLayer(A));y=b.length?this.queryRenderedFeatures(m,{layers:b}):[]}else y=this.queryRenderedFeatures(m,{target:i});return y};if(d==="mouseenter"||d==="mouseover"){let m=!1;return{listener:o,targets:i,delegates:{mousemove:b=>{const A=u(b.point);A.length?m||(m=!0,o.call(this,new hs(d,this,b.originalEvent,{features:A}))):m=!1},mouseout:()=>{m=!1}}}}if(d==="mouseleave"||d==="mouseout"){let m=!1;return{listener:o,targets:i,delegates:{mousemove:A=>{u(A.point).length?m=!0:m&&(m=!1,o.call(this,new hs(d,this,A.originalEvent)))},mouseout:A=>{m&&(m=!1,o.call(this,new hs(d,this,A.originalEvent)))}}}}{const m=y=>{const b=u(y.point);b.length&&(y.features=b,o.call(this,y),delete y.features)};return{listener:o,targets:i,delegates:{[d]:m}}}}on(d,i,o){if(typeof i=="function"||o===void 0)return super.on(d,i);if(typeof i=="string"&&(i=[i]),!this._areTargetsValid(i))return this;const u=this._createDelegatedListener(d,i,o);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(u);for(const m in u.delegates)this.on(m,u.delegates[m]);return this}once(d,i,o){if(typeof i=="function"||o===void 0)return super.once(d,i);if(typeof i=="string"&&(i=[i]),!this._areTargetsValid(i))return this;const u=this._createDelegatedListener(d,i,o);for(const m in u.delegates)this.once(m,u.delegates[m]);return this}off(d,i,o){if(typeof i=="function"||o===void 0)return super.off(d,i);if(typeof i=="string"&&(i=[i]),!this._areTargetsValid(i))return this;const u=this._delegatedListeners?this._delegatedListeners[d]:void 0;return u&&(m=>{for(let y=0;y<m.length;y++){const b=m[y];if(b.listener===o&&qm(b.targets,i)){for(const A in b.delegates)this.off(A,b.delegates[A]);return m.splice(y,1),this}}})(u),this}queryRenderedFeatures(d,i){if(!this.style)return[];if(d===void 0||d instanceof r.P||Array.isArray(d)||i!==void 0||(i=d,d=void 0),d=d||[[0,0],[this.transform.width,this.transform.height]],!i){const y=this.style.queryRenderedFeatures(d,void 0,this.transform),b=this.style.queryRenderedFeatureset(d,void 0,this.transform);return y.concat(b)}let o=!0;if(i.target&&(o=this._isTargetValid(i.target),o&&!i.layers))return this.style.queryRenderedFeatureset(d,i,this.transform);let u=!0;if(i.layers&&Array.isArray(i.layers)){for(const y of i.layers)if(!this._isValidId(y)){u=!1;break}if(u&&!i.target)return this.style.queryRenderedFeatures(d,i,this.transform)}let m=[];return u&&(m=m.concat(this.style.queryRenderedFeatures(d,i,this.transform))),o&&(m=m.concat(this.style.queryRenderedFeatureset(d,i,this.transform))),m}querySourceFeatures(d,i){return!d||typeof d=="string"&&!this._isValidId(d)?[]:this.style.querySourceFeatures(d,i)}queryRasterValue(d,i,o){return this._isValidId(d)?this.style.queryRasterValue(d,i,o):Promise.resolve(null)}isPointOnSurface(d){const{name:i}=this.transform.projection;return i!=="globe"&&i!=="mercator"&&r.w(`${i} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(r.P.convert(d))}addInteraction(d,i){return this._interactions.add(d,i),this}removeInteraction(d){return this._interactions.remove(d),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(d){return this._cooperativeGestures=d,this}setStyle(d,i){return i=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},i),this.style&&d&&i.diff!==!1&&i.localFontFamily===this._localFontFamily&&i.localIdeographFontFamily===this._localIdeographFontFamily&&!i.config?(this.style._diffStyle(d,(o,u)=>{if(o){const m=typeof o=="string"?o:o instanceof Error?o.message:o.error;r.w(`Unable to perform style diff: ${m}. Rebuilding the style from scratch.`),this._updateStyle(d,i)}else u&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._localFontFamily=i.localFontFamily,this._updateStyle(d,i))}_getUIString(d){const i=this._locale[d];if(i==null)throw new Error(`Missing UI string '${d}'`);return i}_updateStyle(d,i){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),d){const o=Object.assign({},i);i&&i.config&&(o.initialConfig=i.config,delete o.config),this.style=new Mn(this,o).load(d),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Mn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(r.w("There is no style added to the map."),!1)}_isValidId(d){return d==null?(this.fire(new r.y(new Error("IDs can't be empty."))),!1):!r.dm(d)||(this.fire(new r.y(new Error(`IDs can't contain special symbols: "${d}".`))),!1)}_isTargetValid(d){return"featuresetId"in d?this._isValidId("importId"in d?d.importId:d.featuresetId):"layerId"in d&&this._isValidId(d.layerId)}_areTargetsValid(d){if(Array.isArray(d)){for(const i of d)if(!this._isValidId(i))return!1;return!0}return this._isTargetValid(d)}addSource(d,i){return this._isValidId(d)?(this._lazyInitEmptyStyle(),this.style.addSource(d,i),this._update(!0)):this}isSourceLoaded(d){return!!this._isValidId(d)&&!!this.style&&this.style._isSourceCacheLoaded(d)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(d,i,o){this._lazyInitEmptyStyle(),this.style.addSourceType(d,i,o)}removeSource(d){return this._isValidId(d)?(this.style.removeSource(d),this._updateTerrain(),this._update(!0)):this}getSource(d){return this._isValidId(d)?this.style.getOwnSource(d):null}addImage(d,i,{pixelRatio:o=1,sdf:u=!1,stretchX:m,stretchY:y,content:b}={}){this._lazyInitEmptyStyle();const A=r.I.from(d);if(i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap){const{width:C,height:z,data:D}=r.o.getImageData(i);this.style.addImage(A,{data:new r.q({width:C,height:z},D),pixelRatio:o,stretchX:m,stretchY:y,content:b,sdf:u,version:0,usvg:!1})}else if(i.width===void 0||i.height===void 0)this.fire(new r.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:C,height:z}=i,D=i;this.style.addImage(A,{data:new r.q({width:C,height:z},new Uint8Array(D.data)),pixelRatio:o,stretchX:m,stretchY:y,content:b,sdf:u,usvg:!1,version:0,userImage:D}),D.onAdd&&D.onAdd(this,d)}}updateImage(d,i){this._lazyInitEmptyStyle();const o=r.I.from(d),u=this.style.getImage(o);if(!u)return void this.fire(new r.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const m=i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap?r.o.getImageData(i):i,{width:y,height:b,data:A}=m;if(y===void 0||b===void 0)return void this.fire(new r.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(y!==(u.usvg?u.icon.usvg_tree.width:u.data.width)||b!==(u.usvg?u.icon.usvg_tree.height:u.data.height))return void this.fire(new r.y(new Error(`The width and height of the updated image (${y}, ${b})
                must be that same as the previous version of the image
                (${u.data.width}, ${u.data.height})`)));const C=!(i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap);let z=!1;u.usvg?(u.data=new r.q({width:y,height:b},new Uint8Array(A)),u.usvg=!1,u.icon=void 0,z=!0):u.data.replace(A,C),this.style.updateImage(o,u,z)}hasImage(d){return d?!!this.style&&!!this.style.getImage(r.I.from(d)):(this.fire(new r.y(new Error("Missing required image id"))),!1)}removeImage(d){this.style.removeImage(r.I.from(d))}loadImage(d,i){r.n(this._requestManager.transformRequest(d,r.R.Image),(o,u)=>{i(o,u instanceof HTMLImageElement?r.o.getImageData(u):u)})}listImages(){return this.style.listImages().map(d=>d.name)}addModel(d,i){this._lazyInitEmptyStyle(),this.style.addModel(d,i)}hasModel(d){return d?this.style.hasModel(d):(this.fire(new r.y(new Error("Missing required model id"))),!1)}removeModel(d){this.style.removeModel(d)}listModels(){return this.style.listModels()}addLayer(d,i){return this._isValidId(d.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(d,i),this._update(!0)):this}getSlot(d){const i=this.getLayer(d);return i&&i.slot||null}setSlot(d,i){return this.style.setSlot(d,i),this.style.mergeLayers(),this._update(!0)}addImport(d,i){return this.style.addImport(d,i).catch(o=>this.fire(new r.y(new Error("Failed to add import",o)))),this}updateImport(d,i){return typeof i!="string"&&i.id!==d?(this.removeImport(d),this.addImport(i)):(this.style.updateImport(d,i),this._update(!0))}removeImport(d){return this.style.removeImport(d),this}moveImport(d,i){return this.style.moveImport(d,i),this._update(!0)}moveLayer(d,i){return this._isValidId(d)?(this.style.moveLayer(d,i),this._update(!0)):this}removeLayer(d){return this._isValidId(d)?(this.style.removeLayer(d),this._update(!0)):this}getLayer(d){if(!this._isValidId(d))return null;const i=this.style.getOwnLayer(d);return i?i.type==="custom"?i.implementation:i.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(d,i,o){return this._isValidId(d)?(this.style.setLayerZoomRange(d,i,o),this._update(!0)):this}setFilter(d,i,o={}){return this._isValidId(d)?(this.style.setFilter(d,i,o),this._update(!0)):this}getFilter(d){return this._isValidId(d)?this.style.getFilter(d):null}setPaintProperty(d,i,o,u={}){return this._isValidId(d)?(this.style.setPaintProperty(d,i,o,u),this._update(!0)):this}getPaintProperty(d,i){return this._isValidId(d)?this.style.getPaintProperty(d,i):null}setLayoutProperty(d,i,o,u={}){return this._isValidId(d)?(this.style.setLayoutProperty(d,i,o,u),this._update(!0)):this}getLayoutProperty(d,i){return this._isValidId(d)?this.style.getLayoutProperty(d,i):null}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(d){return this.style.setGlyphsUrl(d),this._update(!0)}getSchema(d){return this.style.getSchema(d)}setSchema(d,i){return this.style.setSchema(d,i),this._update(!0)}getConfig(d){return this.style.getConfig(d)}setConfig(d,i){return this.style.setConfig(d,i),this._update(!0)}getConfigProperty(d,i){return this.style.getConfigProperty(d,i)}setConfigProperty(d,i,o){return this.style.setConfigProperty(d,i,o),this._update(!0)}getFeaturesetDescriptors(d){return this.style.getFeaturesetDescriptors(d)}setLights(d){if(this._lazyInitEmptyStyle(),d&&d.length===1&&d[0].type==="flat"){const i=d[0];i.properties?this.style.setFlatLight(i.properties,i.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(d),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const d=this.style.getLights()||[];return d.length===0&&d.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),d}setLight(d,i={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:d}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(d){return this._lazyInitEmptyStyle(),!d&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(d),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(d){return this._lazyInitEmptyStyle(),this.style.setFog(d),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(d){return this._lazyInitEmptyStyle(),this.style.setSnow(d),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(d){return this._lazyInitEmptyStyle(),this.style.setRain(d),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(d){return this._lazyInitEmptyStyle(),this.style.setColorTheme(d),this._update(!0)}setImportColorTheme(d,i){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(d,i),this._update(!0)}setCamera(d){return this.style.setCamera(d),this._triggerCameraUpdate(d)}_triggerCameraUpdate(d){return this._update(this.transform.setOrthographicProjectionAtLowPitch(d["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(d){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(r.aR.convert(d),this.transform):0}setFeatureState(d,i){return d.source&&!this._isValidId(d.source)?this:(this.style.setFeatureState(d,i),this._update())}removeFeatureState(d,i){return d.source&&!this._isValidId(d.source)?this:(this.style.removeFeatureState(d,i),this._update())}getFeatureState(d){return d.source&&!this._isValidId(d.source)?null:this.style.getFeatureState(d)}_selectIndoorFloor(d){this.indoor.selectFloor(d)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new Pc),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;const d=this._container.getBoundingClientRect().width||400,i=this._container.getBoundingClientRect().height||300;let o,u,m,y=this._container;for(;y&&(!u||!m);){const b=window.getComputedStyle(y).transform;b&&b!=="none"&&(o=b.match(/matrix.*\((.+)\)/)[1].split(", "),o[0]&&o[0]!=="0"&&o[0]!=="1"&&(u=o[0]),o[3]&&o[3]!=="0"&&o[3]!=="1"&&(m=o[3])),y=y.parentElement}this._containerWidth=u?Math.abs(d/u):d,this._containerHeight=m?Math.abs(i/m):i}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&r.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const d=this._container;d.classList.add("mapboxgl-map"),(this._missingCSSCanary=H("div","mapboxgl-canary",d)).style.visibility="hidden",this._detectMissingCSS();const i=this._canvasContainer=H("div","mapboxgl-canvas-container",d);this._canvas=H("canvas","mapboxgl-canvas",i),this._interactive&&(i.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const o=this._controlContainer=H("div","mapboxgl-control-container",d),u=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(m=>{u[m]=H("div",`mapboxgl-ctrl-${m}`,o)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(d,i){const o=r.o.devicePixelRatio||1;this._canvas.width=o*Math.ceil(d),this._canvas.height=o*Math.ceil(i),this._canvas.style.width=`${d}px`,this._canvas.style.height=`${i}px`}_addMarker(d){this._markers.push(d)}_removeMarker(d){const i=this._markers.indexOf(d);i!==-1&&this._markers.splice(i,1)}_addPopup(d){this._popups.push(d)}_removePopup(d){const i=this._popups.indexOf(d);i!==-1&&this._popups.splice(i,1)}_setupPainter(){const d=Object.assign({},G.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),i=this._canvas.getContext("webgl2",d);i?(nn(i,!0),this.painter=new jd(i,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp,this._worldview),this.on("data",o=>{o.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),r.k.testSupport(i)):this.fire(new r.y(new Error("Failed to initialize WebGL")))}_contextLost(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new r.z("webglcontextlost",{originalEvent:d}))}_contextRestored(d){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new r.z("webglcontextrestored",{originalEvent:d}))}_onMapScroll(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(d){return this._update(),this._renderTaskQueue.add(d)}_cancelRenderFrame(d){this._renderTaskQueue.remove(d)}_requestDomTask(d){!this.loaded()||this.loaded()&&!this.isMoving()?d():this._domRenderTaskQueue.add(d)}_render(d){let i;this.fire(new r.z("renderstart")),++this._frameId;const o=this.painter.context.extTimerQuery,u=r.o.now(),m=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(i=m.createQuery(),m.beginQuery(o.TIME_ELAPSED_EXT,i)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(d),this._domRenderTaskQueue.run(d),this._removed)return;this._updateProjectionTransition();const y=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const z=this.transform.zoom,D=this.transform.pitch,U=r.o.now(),F=new r.ac(z,{now:U,fadeDuration:y,pitch:D,transition:this.style.transition,worldview:this._worldview});this.style.update(F)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let b=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),b=this._updateAverageElevation(u),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):b=this._updateAverageElevation(u);const A=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,y,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),A&&(this._placementDirty=A.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:y,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new r.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,P.mark(k.load),this.fire(new r.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),i){const z=r.o.now()-u;m.endQuery(o.TIME_ELAPSED_EXT),setTimeout(()=>{const D=m.getQueryParameter(i,m.QUERY_RESULT)/1e6;m.deleteQuery(i),this.fire(new r.z("gpu-timing-frame",{cpuTime:z,gpuTime:D}))},50)}if(this.listens("gpu-timing-layer")){const z=this.painter.collectGpuTimers();setTimeout(()=>{const D=this.painter.queryGpuTimers(z);this.fire(new r.z("gpu-timing-layer",{layerTimes:D}))},50)}if(this.listens("gpu-timing-deferred-render")){const z=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const D=this.painter.queryGpuTimeDeferredRender(z);this.fire(new r.z("gpu-timing-deferred-render",{gpuTime:D}))},50)}const C=this._sourcesDirty||this._styleDirty||this._placementDirty||b;if(C||this._repaint)this.triggerRepaint();else{const z=this.idle();if(z&&(b=this._updateAverageElevation(u,!0)),b)this.triggerRepaint();else if(this._triggerFrame(!1),z&&(this.fire(new r.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const D=this._calculateSpeedIndex();this.fire(new r.z("speedindexcompleted",{speedIndex:D})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||C||(this._fullyLoaded=!0,P.mark(k.fullLoad),this._performanceMetricsCollection&&zi(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(d){for(const i of this._markers)d&&!this.getRenderWorldCopies()&&(i._lngLat=i._lngLat.wrap()),i._update();for(const i of this._popups)!d||this.getRenderWorldCopies()||i._trackPointer||(i._lngLat=i._lngLat.wrap()),i._update()}_updateAverageElevation(d,i=!1){const o=m=>(this.transform.averageElevation=m,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&o(0);const u=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(u||(i||d-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(d)){const m=this.transform.averageElevation;let y=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(y)?y=0:this._averageElevationLastSampledAt=d;const b=Math.abs(m-y);if(b>1){if(this._isInitialLoad||u)return this._averageElevation.jumpTo(y),o(y);this._averageElevation.easeTo(y,d,300)}else if(b>1e-4)return this._averageElevation.jumpTo(y),o(y)}return!!this._averageElevation.isEasing(d)&&o(this._averageElevation.getValue(d))}_authenticate(){Wi(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,d=>{if(d&&(d.message===bt||d.status===401)){const i=this.painter.context.gl;nn(i,!1),this._logoControl instanceof ra&&this._logoControl._updateLogo(),i&&i.clear(i.DEPTH_BUFFER_BIT|i.COLOR_BUFFER_BIT|i.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new r.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),ar(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&mi(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const d=this._isDragging();this.painter.updateTerrain(this.style,d)}_calculateSpeedIndex(){const d=this.painter.canvasCopy(),i=this.painter.getCanvasCopiesAndTimestamps();i.timeStamps.push(performance.now());const o=this.painter.context.gl,u=o.createFramebuffer();function m(y){o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,y,0);const b=new Uint8Array(o.drawingBufferWidth*o.drawingBufferHeight*4);return o.readPixels(0,0,o.drawingBufferWidth,o.drawingBufferHeight,o.RGBA,o.UNSIGNED_BYTE,b),b}return o.bindFramebuffer(o.FRAMEBUFFER,u),this._canvasPixelComparison(m(d),i.canvasCopies.map(m),i.timeStamps)}_canvasPixelComparison(d,i,o){let u=o[1]-o[0];const m=d.length/4;for(let y=0;y<i.length;y++){const b=i[y];let A=0;for(let C=0;C<b.length;C+=4)b[C]===d[C]&&b[C+1]===d[C+1]&&b[C+2]===d[C+2]&&b[C+3]===d[C+3]&&(A+=1);u+=(o[y+2]-o[y+1])*(1-A/m)}return u}remove(){this._hash&&this._hash.remove();for(const i of this._controls)i.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const d=this.painter.context.gl.getExtension("WEBGL_lose_context");d&&d.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),ns.delete(this.painter.context.gl),mr.remove(),Br.remove(),this._removed=!0,this.fire(new r.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(d){this._renderNextFrame=this._renderNextFrame||d,this.style&&!this._frame&&(this._frame=r.o.frame(i=>{const o=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,o&&this._render(i)}))}_preloadTiles(d){const i=this.style?this.style.getSourceCaches():[];return r.bw(i,(o,u)=>o._preloadTiles(d,u),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(d){this._trackResize&&this.resize({originalEvent:d})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(d){this._showParseStatus!==d&&(this._showParseStatus=d,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(d){this._showTerrainWireframe!==d&&(this._showTerrainWireframe=d,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(d){this._showLayers2DWireframe!==d&&(this._showLayers2DWireframe=d,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(d){this._showLayers3DWireframe!==d&&(this._showLayers3DWireframe=d,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(d){this._speedIndexTiming!==d&&(this._speedIndexTiming=d,this._update())}get showPadding(){return!!this._showPadding}set showPadding(d){this._showPadding!==d&&(this._showPadding=d,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,this._tp.refreshUI(),d?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(d){this._repaint!==d&&(this._repaint=d,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(d){this._vertices=d,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(d){this._showTileAABBs!==d&&(this._showTileAABBs=d,this._tp.refreshUI(),d&&this._update())}_setCacheLimits(d,i){r.eX(d,i)}get version(){return E}},NavigationControl:class{constructor(d={}){this.options=Object.assign({},Zm,d),this._container=H("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",i=>i.preventDefault()),this.options.showZoom&&(r.aY(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",i=>{this._map&&this._map.zoomIn({},{originalEvent:i})}),H("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",i=>{this._map&&this._map.zoomOut({},{originalEvent:i})}),H("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(r.aY(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",i=>{const o=this._map;o&&(this.options.visualizePitch?o.resetNorthPitch({},{originalEvent:i}):o.resetNorth({},{originalEvent:i}))}),this._compassIcon=H("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const d=this._map;if(!d)return;const i=d.getZoom(),o=i===d.getMaxZoom(),u=i===d.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=u,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",u.toString())}_rotateCompassArrow(){const d=this._map;if(!d)return;const i=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(d.transform.pitch*(Math.PI/180)),.5)}) rotateX(${d.transform.pitch}deg) rotateZ(${d.transform.angle*(180/Math.PI)}deg)`:`rotate(${d.transform.angle*(180/Math.PI)}deg)`;d._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=i)})}onAdd(d){return this._map=d,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),d.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&d.on("pitch",this._rotateCompassArrow),d.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new $m(d,this._compass,this.options.visualizePitch)),this._container}onRemove(){const d=this._map;d&&(this._container.remove(),this.options.showZoom&&d.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&d.off("pitch",this._rotateCompassArrow),d.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(d,i){const o=H("button",d,this._container);return o.type="button",o.addEventListener("click",i),o}_setButtonTitle(d,i){if(!this._map)return;const o=this._map._getUIString(`NavigationControl.${i}`);d.setAttribute("aria-label",o),d.firstElementChild&&d.firstElementChild.setAttribute("title",o)}},GeolocateControl:class extends r.E{constructor(d={}){super();const i=navigator.geolocation;this.options=Object.assign({geolocation:i},no,d),r.aY(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=eu(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(d){return this._map=d,this._container=H("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(d){const i=(o=!!this.options.geolocation)=>{this._supportsGeolocation=o,d(o)};this._supportsGeolocation!==void 0?d(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(o=>i(o.state!=="denied")).catch(()=>i()):i()}_isOutOfMapMaxBounds(d){const i=this._map.getMaxBounds(),o=d.coords;return!!i&&(o.longitude<i.getWest()||o.longitude>i.getEast()||o.latitude<i.getSouth()||o.latitude>i.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(d){if(this._map){if(this._isOutOfMapMaxBounds(d))return this._setErrorState(),this.fire(new r.z("outofmaxbounds",d)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=d,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(d),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(d),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.z("geolocate",d)),this._finish()}}_updateCamera(d){const i=new r.aR(d.coords.longitude,d.coords.latitude),o=d.coords.accuracy,u=this._map.getBearing(),m=Object.assign({bearing:u},this.options.fitBoundsOptions);this._map.fitBounds(i.toBounds(o),m,{geolocateSource:!0})}_updateMarker(d){if(d){const i=new r.aR(d.coords.longitude,d.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=d.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const d=this._map.transform,i=r.ce(1,d._center.lat)*d.worldSize,o=Math.ceil(2*this._accuracy*i);this._circleElement.style.width=`${o}px`,this._circleElement.style.height=`${o}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(d){if(this._map){if(this.options.trackUserLocation)if(d.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(d.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.z("error",d)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(d){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",i=>i.preventDefault()),this._geolocateButton=H("button","mapboxgl-ctrl-geolocate",this._container),H("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",d===!1){r.w("Geolocation support is not available so the GeolocateControl will be disabled.");const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}else{const i=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=H("div","mapboxgl-user-location"),this._dotElement.appendChild(H("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(H("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Vo({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=H("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Vo({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",i=>{i.geolocateSource||this._watchState!=="ACTIVE_LOCK"||i.originalEvent&&i.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new r.z("trackuserlocationend")))})}}_onDeviceOrientation(d){this._userLocationDotMarker&&(d.webkitCompassHeading?this._heading=d.webkitCompassHeading:d.absolute===!0&&(this._heading=-1*d.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return r.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new r.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new r.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new r.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let d;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(d={maximumAge:6e5,timeout:0},this._noTimeout=!0):(d=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,d),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const d=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(i=>{i==="granted"&&d()}).catch(console.error):d()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Mc,ScaleControl:class{constructor(d={}){this.options=Object.assign({},Aa,d),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),r.aY(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const d=this.options.maxWidth||100,i=this._map,o=i._containerHeight/2,u=i._containerWidth/2-d/2,m=i.unproject([u,o]),y=i.unproject([u+d,o]),b=m.distanceTo(y);if(this.options.unit==="imperial"){const A=3.2808*b;A>5280?this._setScale(d,A/5280,"mile"):this._setScale(d,A,"foot")}else this.options.unit==="nautical"?this._setScale(d,b/1852,"nautical-mile"):b>=1e3?this._setScale(d,b/1e3,"kilometer"):this._setScale(d,b,"meter")}_setScale(d,i,o){this._map._requestDomTask(()=>{const u=function(y){const b=Math.pow(10,`${Math.floor(y)}`.length-1);let A=y/b;return A=A>=10?10:A>=5?5:A>=3?3:A>=2?2:A>=1?1:function(C){const z=Math.pow(10,Math.ceil(-Math.log(C)/Math.LN10));return Math.round(C*z)/z}(A),b*A}(i),m=u/i;this._container.innerHTML=this._isNumberFormatSupported&&o!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:o}).format(u):`${u}&nbsp;${Ta[o]}`,this._container.style.width=d*m+"px"})}onAdd(d){return this._map=d,this._language=d.getLanguage(),this._container=H("div","mapboxgl-ctrl mapboxgl-ctrl-scale",d.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(d){this._language=d,this._update()}setUnit(d){this.options.unit=d,this._update()}},FullscreenControl:class{constructor(d={}){this._fullscreen=!1,d&&d.container&&(d.container instanceof HTMLElement?this._container=d.container:r.w("Full screen control 'container' must be a DOM element.")),r.aY(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(d){return this._map=d,this._container||(this._container=this._map.getContainer()),this._controlContainer=H("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",r.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const d=this._fullscreenButton=H("button","mapboxgl-ctrl-fullscreen",this._controlContainer);H("span","mapboxgl-ctrl-icon",d).setAttribute("aria-hidden","true"),d.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const d=this._getTitle();this._fullscreenButton.setAttribute("aria-label",d),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",d)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:Pc,Popup:class extends r.E{constructor(d){super(),this.options=Object.assign(Object.create(Uo),d),this._altitude=this.options.altitude,r.aY(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(d&&d.className?d.className.trim().split(/\s+/):[])}addTo(d){return this._map&&this.remove(),this._map=d,this.options.closeOnClick&&d.on("preclick",this._onClose),this.options.closeOnMove&&d.on("move",this._onClose),d.on("remove",this.remove),this._update(),d._addPopup(this),this._focusFirstElement(),this._trackPointer?(d.on("mousemove",this._onMouseEvent),d.on("mouseup",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")):d.on("move",this._update),this.fire(new r.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const d=this._map;return d&&(d.off("move",this._update),d.off("move",this._onClose),d.off("preclick",this._onClose),d.off("click",this._onClose),d.off("remove",this.remove),d.off("mousemove",this._onMouseEvent),d.off("mouseup",this._onMouseEvent),d.off("drag",this._onMouseEvent),d._canvasContainer&&d._canvasContainer.classList.remove("mapboxgl-track-pointer"),d._removePopup(this),this._map=void 0),this.fire(new r.z("close")),this}getLngLat(){return this._lngLat}setLngLat(d){this._lngLat=r.aR.convert(d),this._pos=null,this._trackPointer=!1,this._update();const i=this._map;return i&&(i.on("move",this._update),i.off("mousemove",this._onMouseEvent),i._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(d){return this._altitude=d,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const d=this._map;return d&&(d.off("move",this._update),d.on("mousemove",this._onMouseEvent),d.on("drag",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(d){return this.setDOMContent(document.createTextNode(d))}setHTML(d){const i=document.createDocumentFragment(),o=document.createElement("body");let u;for(o.innerHTML=d;u=o.firstChild,u;)i.appendChild(u);return this.setDOMContent(i)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(d){return this.options.maxWidth=d,this._update(),this}setDOMContent(d){let i=this._content;if(i)for(;i.hasChildNodes();)i.firstChild&&i.removeChild(i.firstChild);else i=this._content=H("div","mapboxgl-popup-content",this._container||void 0);if(i.appendChild(d),this.options.closeButton){const o=this._closeButton=H("button","mapboxgl-popup-close-button",i);o.type="button",o.setAttribute("aria-label","Close popup"),o.innerHTML='<span aria-hidden="true">&#215;</span>',o.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(d){return this._classList.add(d),this._updateClassList(),this}removeClassName(d){return this._classList.delete(d),this._updateClassList(),this}setOffset(d){return this.options.offset=d,this._update(),this}toggleClassName(d){let i;return this._classList.delete(d)?i=!1:(this._classList.add(d),i=!0),this._updateClassList(),i}_onMouseEvent(d){this._update(d.point)}_getAnchor(d){if(this.options.anchor)return this.options.anchor;const i=this._map,o=this._container,u=this._pos;if(!i||!o||!u)return"bottom";const m=o.offsetWidth,y=o.offsetHeight,b=u.x<m/2,A=u.x>i.transform.width-m/2;if(u.y+d<y)return b?"top-left":A?"top-right":"top";if(u.y>i.transform.height-y){if(b)return"bottom-left";if(A)return"bottom-right"}return b?"left":A?"right":"bottom"}_updateClassList(){const d=this._container;if(!d)return;const i=[...this._classList];i.push("mapboxgl-popup"),this._anchor&&i.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&i.push("mapboxgl-popup-track-pointer"),d.className=i.join(" ")}_update(d){const i=this._map,o=this._content;if(!i||!this._lngLat&&!this._trackPointer||!o)return;let u=this._container;if(u||(u=this._container=H("div","mapboxgl-popup",i.getContainer()),this._tip=H("div","mapboxgl-popup-tip",u),u.appendChild(o)),this.options.maxWidth&&u.style.maxWidth!==this.options.maxWidth&&(u.style.maxWidth=this.options.maxWidth),i.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=hu(this._lngLat,this._pos,i.transform)),!this._trackPointer||d){const m=this._pos=this._trackPointer&&d instanceof r.P?d:i.project(this._lngLat,this._altitude),y=eg(this.options.offset),b=this._anchor=this._getAnchor(y.y),A=eg(this.options.offset,b),C=m.add(A).round();i._requestDomTask(()=>{this._container&&b&&(this._container.style.transform=`${Dc[b]} translate(${C.x}px,${C.y}px)`)})}if(!this._marker&&i._showingGlobe()){const m=r.eY(i.transform,this._lngLat)?0:1;this._setOpacity(m)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const d=this._container.querySelector(Gn);d&&d.focus()}_onClose(){this.remove()}_setOpacity(d){this._container&&(this._container.style.opacity=`${d}`),this._content&&(this._content.style.pointerEvents=d?"auto":"none")}},Marker:Vo,Style:Mn,LngLat:r.aR,LngLatBounds:r.aI,Point:r.P,MercatorCoordinate:r.ae,FreeCameraOptions:rd,Evented:r.E,config:r.e,prewarm:r.f0,clearPrewarmedResources:r.e$,get accessToken(){return r.e.ACCESS_TOKEN},set accessToken(d){r.e.ACCESS_TOKEN=d},get baseApiUrl(){return r.e.API_URL},set baseApiUrl(d){r.e.API_URL=d},get workerCount(){return r.f9.workerCount},set workerCount(d){r.f9.workerCount=d},get maxParallelImageRequests(){return r.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(d){r.e.MAX_PARALLEL_IMAGE_REQUESTS=d},clearStorage(d){r.f8(d)},get workerUrl(){return r.f7.workerUrl},set workerUrl(d){r.f7.workerUrl=d},get workerClass(){return r.f7.workerClass},set workerClass(d){r.f7.workerClass=d},get workerParams(){return r.f7.workerParams},set workerParams(d){r.f7.workerParams=d},get dracoUrl(){return r.f6()},set dracoUrl(d){r.f5(d)},get meshoptUrl(){return r.f4()},set meshoptUrl(d){r.f3(d)},setNow:r.o.setNow,restoreNow:r.o.restoreNow}});var v=f;return v})})(Fw);var b2=Fw.exports;const Mu=x2(b2);function nm(S){var t=typeof S;return S!=null&&(t=="object"||t=="function")}var w2=typeof global=="object"&&global&&global.Object===Object&&global,S2=typeof self=="object"&&self&&self.Object===Object&&self,Nw=w2||S2||Function("return this")(),fy=function(){return Nw.Date.now()},A2=/\s/;function T2(S){for(var t=S.length;t--&&A2.test(S.charAt(t)););return t}var E2=/^\s+/;function C2(S){return S&&S.slice(0,T2(S)+1).replace(E2,"")}var am=Nw.Symbol,Vw=Object.prototype,I2=Vw.hasOwnProperty,k2=Vw.toString,Nf=am?am.toStringTag:void 0;function M2(S){var t=I2.call(S,Nf),a=S[Nf];try{S[Nf]=void 0;var c=!0}catch{}var f=k2.call(S);return c&&(t?S[Nf]=a:delete S[Nf]),f}var P2=Object.prototype,L2=P2.toString;function z2(S){return L2.call(S)}var R2="[object Null]",D2="[object Undefined]",lw=am?am.toStringTag:void 0;function O2(S){return S==null?S===void 0?D2:R2:lw&&lw in Object(S)?M2(S):z2(S)}function F2(S){return S!=null&&typeof S=="object"}var B2="[object Symbol]";function N2(S){return typeof S=="symbol"||F2(S)&&O2(S)==B2}var cw=NaN,V2=/^[-+]0x[0-9a-f]+$/i,U2=/^0b[01]+$/i,j2=/^0o[0-7]+$/i,H2=parseInt;function hw(S){if(typeof S=="number")return S;if(N2(S))return cw;if(nm(S)){var t=typeof S.valueOf=="function"?S.valueOf():S;S=nm(t)?t+"":t}if(typeof S!="string")return S===0?S:+S;S=C2(S);var a=U2.test(S);return a||j2.test(S)?H2(S.slice(2),a?2:8):V2.test(S)?cw:+S}var W2="Expected a function",G2=Math.max,X2=Math.min;function Kg(S,t,a){var c,f,_,v,r,E,k=0,P=!1,L=!1,O=!0;if(typeof S!="function")throw new TypeError(W2);t=hw(t)||0,nm(a)&&(P=!!a.leading,L="maxWait"in a,_=L?G2(hw(a.maxWait)||0,t):_,O="trailing"in a?!!a.trailing:O);function N(Te){var Se=c,Ie=f;return c=f=void 0,k=Te,v=S.apply(Ie,Se),v}function G(Te){return k=Te,r=setTimeout(ee,t),P?N(Te):v}function H(Te){var Se=Te-E,Ie=Te-k,Ue=t-Se;return L?X2(Ue,_-Ie):Ue}function Q(Te){var Se=Te-E,Ie=Te-k;return E===void 0||Se>=t||Se<0||L&&Ie>=_}function ee(){var Te=fy();if(Q(Te))return ie(Te);r=setTimeout(ee,H(Te))}function ie(Te){return r=void 0,O&&c?N(Te):(c=f=void 0,v)}function ue(){r!==void 0&&clearTimeout(r),k=0,c=E=f=r=void 0}function ve(){return r===void 0?v:ie(fy())}function ce(){var Te=fy(),Se=Q(Te);if(c=arguments,f=this,E=Te,Se){if(r===void 0)return G(E);if(L)return clearTimeout(r),r=setTimeout(ee,t),N(E)}return r===void 0&&(r=setTimeout(ee,t)),v}return ce.cancel=ue,ce.flush=ve,ce}var Y2="Expected a function";function q2(S,t,a){var c=!0,f=!0;if(typeof S!="function")throw new TypeError(Y2);return nm(a)&&(c="leading"in a?!!a.leading:c,f="trailing"in a?!!a.trailing:f),Kg(S,t,{leading:c,maxWait:t,trailing:f})}var Ru=function(){return Ru=Object.assign||function(t){for(var a,c=1,f=arguments.length;c<f;c++){a=arguments[c];for(var _ in a)Object.prototype.hasOwnProperty.call(a,_)&&(t[_]=a[_])}return t},Ru.apply(this,arguments)};function Uw(S){return!S||!S.ownerDocument||!S.ownerDocument.defaultView?window:S.ownerDocument.defaultView}function jw(S){return!S||!S.ownerDocument?document:S.ownerDocument}var Hw=function(S){var t={},a=Array.prototype.reduce.call(S,function(c,f){var _=f.name.match(/data-simplebar-(.+)/);if(_){var v=_[1].replace(/\W+(.)/g,function(r,E){return E.toUpperCase()});switch(f.value){case"true":c[v]=!0;break;case"false":c[v]=!1;break;case void 0:c[v]=!0;break;default:c[v]=f.value}}return c},t);return a};function Ww(S,t){var a;S&&(a=S.classList).add.apply(a,t.split(" "))}function Gw(S,t){S&&t.split(" ").forEach(function(a){S.classList.remove(a)})}function Xw(S){return".".concat(S.split(" ").join("."))}var tx=!!(typeof window<"u"&&window.document&&window.document.createElement),Z2=Object.freeze({__proto__:null,addClasses:Ww,canUseDOM:tx,classNamesToQuery:Xw,getElementDocument:jw,getElementWindow:Uw,getOptions:Hw,removeClasses:Gw}),zu=null,uw=null;tx&&window.addEventListener("resize",function(){uw!==window.devicePixelRatio&&(uw=window.devicePixelRatio,zu=null)});function dw(){if(zu===null){if(typeof document>"u")return zu=0,zu;var S=document.body,t=document.createElement("div");t.classList.add("simplebar-hide-scrollbar"),S.appendChild(t);var a=t.getBoundingClientRect().right;S.removeChild(t),zu=a}return zu}var Fl=Uw,py=jw,$2=Hw,Bl=Ww,Nl=Gw,zn=Xw,Qg=function(){function S(t,a){a===void 0&&(a={});var c=this;if(this.removePreventClickId=null,this.minScrollbarWidth=20,this.stopScrollDelay=175,this.isScrolling=!1,this.isMouseEntering=!1,this.isDragging=!1,this.scrollXTicking=!1,this.scrollYTicking=!1,this.wrapperEl=null,this.contentWrapperEl=null,this.contentEl=null,this.offsetEl=null,this.maskEl=null,this.placeholderEl=null,this.heightAutoObserverWrapperEl=null,this.heightAutoObserverEl=null,this.rtlHelpers=null,this.scrollbarWidth=0,this.resizeObserver=null,this.mutationObserver=null,this.elStyles=null,this.isRtl=null,this.mouseX=0,this.mouseY=0,this.onMouseMove=function(){},this.onWindowResize=function(){},this.onStopScrolling=function(){},this.onMouseEntered=function(){},this.onScroll=function(){var f=Fl(c.el);c.scrollXTicking||(f.requestAnimationFrame(c.scrollX),c.scrollXTicking=!0),c.scrollYTicking||(f.requestAnimationFrame(c.scrollY),c.scrollYTicking=!0),c.isScrolling||(c.isScrolling=!0,Bl(c.el,c.classNames.scrolling)),c.showScrollbar("x"),c.showScrollbar("y"),c.onStopScrolling()},this.scrollX=function(){c.axis.x.isOverflowing&&c.positionScrollbar("x"),c.scrollXTicking=!1},this.scrollY=function(){c.axis.y.isOverflowing&&c.positionScrollbar("y"),c.scrollYTicking=!1},this._onStopScrolling=function(){Nl(c.el,c.classNames.scrolling),c.options.autoHide&&(c.hideScrollbar("x"),c.hideScrollbar("y")),c.isScrolling=!1},this.onMouseEnter=function(){c.isMouseEntering||(Bl(c.el,c.classNames.mouseEntered),c.showScrollbar("x"),c.showScrollbar("y"),c.isMouseEntering=!0),c.onMouseEntered()},this._onMouseEntered=function(){Nl(c.el,c.classNames.mouseEntered),c.options.autoHide&&(c.hideScrollbar("x"),c.hideScrollbar("y")),c.isMouseEntering=!1},this._onMouseMove=function(f){c.mouseX=f.clientX,c.mouseY=f.clientY,(c.axis.x.isOverflowing||c.axis.x.forceVisible)&&c.onMouseMoveForAxis("x"),(c.axis.y.isOverflowing||c.axis.y.forceVisible)&&c.onMouseMoveForAxis("y")},this.onMouseLeave=function(){c.onMouseMove.cancel(),(c.axis.x.isOverflowing||c.axis.x.forceVisible)&&c.onMouseLeaveForAxis("x"),(c.axis.y.isOverflowing||c.axis.y.forceVisible)&&c.onMouseLeaveForAxis("y"),c.mouseX=-1,c.mouseY=-1},this._onWindowResize=function(){c.scrollbarWidth=c.getScrollbarWidth(),c.hideNativeScrollbar()},this.onPointerEvent=function(f){if(!(!c.axis.x.track.el||!c.axis.y.track.el||!c.axis.x.scrollbar.el||!c.axis.y.scrollbar.el)){var _,v;c.axis.x.track.rect=c.axis.x.track.el.getBoundingClientRect(),c.axis.y.track.rect=c.axis.y.track.el.getBoundingClientRect(),(c.axis.x.isOverflowing||c.axis.x.forceVisible)&&(_=c.isWithinBounds(c.axis.x.track.rect)),(c.axis.y.isOverflowing||c.axis.y.forceVisible)&&(v=c.isWithinBounds(c.axis.y.track.rect)),(_||v)&&(f.stopPropagation(),f.type==="pointerdown"&&f.pointerType!=="touch"&&(_&&(c.axis.x.scrollbar.rect=c.axis.x.scrollbar.el.getBoundingClientRect(),c.isWithinBounds(c.axis.x.scrollbar.rect)?c.onDragStart(f,"x"):c.onTrackClick(f,"x")),v&&(c.axis.y.scrollbar.rect=c.axis.y.scrollbar.el.getBoundingClientRect(),c.isWithinBounds(c.axis.y.scrollbar.rect)?c.onDragStart(f,"y"):c.onTrackClick(f,"y"))))}},this.drag=function(f){var _,v,r,E,k,P,L,O,N,G,H;if(!(!c.draggedAxis||!c.contentWrapperEl)){var Q,ee=c.axis[c.draggedAxis].track,ie=(v=(_=ee.rect)===null||_===void 0?void 0:_[c.axis[c.draggedAxis].sizeAttr])!==null&&v!==void 0?v:0,ue=c.axis[c.draggedAxis].scrollbar,ve=(E=(r=c.contentWrapperEl)===null||r===void 0?void 0:r[c.axis[c.draggedAxis].scrollSizeAttr])!==null&&E!==void 0?E:0,ce=parseInt((P=(k=c.elStyles)===null||k===void 0?void 0:k[c.axis[c.draggedAxis].sizeAttr])!==null&&P!==void 0?P:"0px",10);f.preventDefault(),f.stopPropagation(),c.draggedAxis==="y"?Q=f.pageY:Q=f.pageX;var Te=Q-((O=(L=ee.rect)===null||L===void 0?void 0:L[c.axis[c.draggedAxis].offsetAttr])!==null&&O!==void 0?O:0)-c.axis[c.draggedAxis].dragOffset;Te=c.draggedAxis==="x"&&c.isRtl?((G=(N=ee.rect)===null||N===void 0?void 0:N[c.axis[c.draggedAxis].sizeAttr])!==null&&G!==void 0?G:0)-ue.size-Te:Te;var Se=Te/(ie-ue.size),Ie=Se*(ve-ce);c.draggedAxis==="x"&&c.isRtl&&(Ie=!((H=S.getRtlHelpers())===null||H===void 0)&&H.isScrollingToNegative?-Ie:Ie),c.contentWrapperEl[c.axis[c.draggedAxis].scrollOffsetAttr]=Ie}},this.onEndDrag=function(f){c.isDragging=!1;var _=py(c.el),v=Fl(c.el);f.preventDefault(),f.stopPropagation(),Nl(c.el,c.classNames.dragging),c.onStopScrolling(),_.removeEventListener("mousemove",c.drag,!0),_.removeEventListener("mouseup",c.onEndDrag,!0),c.removePreventClickId=v.setTimeout(function(){_.removeEventListener("click",c.preventClick,!0),_.removeEventListener("dblclick",c.preventClick,!0),c.removePreventClickId=null})},this.preventClick=function(f){f.preventDefault(),f.stopPropagation()},this.el=t,this.options=Ru(Ru({},S.defaultOptions),a),this.classNames=Ru(Ru({},S.defaultOptions.classNames),a.classNames),this.axis={x:{scrollOffsetAttr:"scrollLeft",sizeAttr:"width",scrollSizeAttr:"scrollWidth",offsetSizeAttr:"offsetWidth",offsetAttr:"left",overflowAttr:"overflowX",dragOffset:0,isOverflowing:!0,forceVisible:!1,track:{size:null,el:null,rect:null,isVisible:!1},scrollbar:{size:null,el:null,rect:null,isVisible:!1}},y:{scrollOffsetAttr:"scrollTop",sizeAttr:"height",scrollSizeAttr:"scrollHeight",offsetSizeAttr:"offsetHeight",offsetAttr:"top",overflowAttr:"overflowY",dragOffset:0,isOverflowing:!0,forceVisible:!1,track:{size:null,el:null,rect:null,isVisible:!1},scrollbar:{size:null,el:null,rect:null,isVisible:!1}}},typeof this.el!="object"||!this.el.nodeName)throw new Error("Argument passed to SimpleBar must be an HTML element instead of ".concat(this.el));this.onMouseMove=q2(this._onMouseMove,64),this.onWindowResize=Kg(this._onWindowResize,64,{leading:!0}),this.onStopScrolling=Kg(this._onStopScrolling,this.stopScrollDelay),this.onMouseEntered=Kg(this._onMouseEntered,this.stopScrollDelay),this.init()}return S.getRtlHelpers=function(){if(S.rtlHelpers)return S.rtlHelpers;var t=document.createElement("div");t.innerHTML='<div class="simplebar-dummy-scrollbar-size"><div></div></div>';var a=t.firstElementChild,c=a==null?void 0:a.firstElementChild;if(!c)return null;document.body.appendChild(a),a.scrollLeft=0;var f=S.getOffset(a),_=S.getOffset(c);a.scrollLeft=-999;var v=S.getOffset(c);return document.body.removeChild(a),S.rtlHelpers={isScrollOriginAtZero:f.left!==_.left,isScrollingToNegative:_.left!==v.left},S.rtlHelpers},S.prototype.getScrollbarWidth=function(){try{return this.contentWrapperEl&&getComputedStyle(this.contentWrapperEl,"::-webkit-scrollbar").display==="none"||"scrollbarWidth"in document.documentElement.style||"-ms-overflow-style"in document.documentElement.style?0:dw()}catch{return dw()}},S.getOffset=function(t){var a=t.getBoundingClientRect(),c=py(t),f=Fl(t);return{top:a.top+(f.pageYOffset||c.documentElement.scrollTop),left:a.left+(f.pageXOffset||c.documentElement.scrollLeft)}},S.prototype.init=function(){tx&&(this.initDOM(),this.rtlHelpers=S.getRtlHelpers(),this.scrollbarWidth=this.getScrollbarWidth(),this.recalculate(),this.initListeners())},S.prototype.initDOM=function(){var t,a;this.wrapperEl=this.el.querySelector(zn(this.classNames.wrapper)),this.contentWrapperEl=this.options.scrollableNode||this.el.querySelector(zn(this.classNames.contentWrapper)),this.contentEl=this.options.contentNode||this.el.querySelector(zn(this.classNames.contentEl)),this.offsetEl=this.el.querySelector(zn(this.classNames.offset)),this.maskEl=this.el.querySelector(zn(this.classNames.mask)),this.placeholderEl=this.findChild(this.wrapperEl,zn(this.classNames.placeholder)),this.heightAutoObserverWrapperEl=this.el.querySelector(zn(this.classNames.heightAutoObserverWrapperEl)),this.heightAutoObserverEl=this.el.querySelector(zn(this.classNames.heightAutoObserverEl)),this.axis.x.track.el=this.findChild(this.el,"".concat(zn(this.classNames.track)).concat(zn(this.classNames.horizontal))),this.axis.y.track.el=this.findChild(this.el,"".concat(zn(this.classNames.track)).concat(zn(this.classNames.vertical))),this.axis.x.scrollbar.el=((t=this.axis.x.track.el)===null||t===void 0?void 0:t.querySelector(zn(this.classNames.scrollbar)))||null,this.axis.y.scrollbar.el=((a=this.axis.y.track.el)===null||a===void 0?void 0:a.querySelector(zn(this.classNames.scrollbar)))||null,this.options.autoHide||(Bl(this.axis.x.scrollbar.el,this.classNames.visible),Bl(this.axis.y.scrollbar.el,this.classNames.visible))},S.prototype.initListeners=function(){var t=this,a,c=Fl(this.el);if(this.el.addEventListener("mouseenter",this.onMouseEnter),this.el.addEventListener("pointerdown",this.onPointerEvent,!0),this.el.addEventListener("mousemove",this.onMouseMove),this.el.addEventListener("mouseleave",this.onMouseLeave),(a=this.contentWrapperEl)===null||a===void 0||a.addEventListener("scroll",this.onScroll),c.addEventListener("resize",this.onWindowResize),!!this.contentEl){if(window.ResizeObserver){var f=!1,_=c.ResizeObserver||ResizeObserver;this.resizeObserver=new _(function(){f&&c.requestAnimationFrame(function(){t.recalculate()})}),this.resizeObserver.observe(this.el),this.resizeObserver.observe(this.contentEl),c.requestAnimationFrame(function(){f=!0})}this.mutationObserver=new c.MutationObserver(function(){c.requestAnimationFrame(function(){t.recalculate()})}),this.mutationObserver.observe(this.contentEl,{childList:!0,subtree:!0,characterData:!0})}},S.prototype.recalculate=function(){if(!(!this.heightAutoObserverEl||!this.contentEl||!this.contentWrapperEl||!this.wrapperEl||!this.placeholderEl)){var t=Fl(this.el);this.elStyles=t.getComputedStyle(this.el),this.isRtl=this.elStyles.direction==="rtl";var a=this.contentEl.offsetWidth,c=this.heightAutoObserverEl.offsetHeight<=1,f=this.heightAutoObserverEl.offsetWidth<=1||a>0,_=this.contentWrapperEl.offsetWidth,v=this.elStyles.overflowX,r=this.elStyles.overflowY;this.contentEl.style.padding="".concat(this.elStyles.paddingTop," ").concat(this.elStyles.paddingRight," ").concat(this.elStyles.paddingBottom," ").concat(this.elStyles.paddingLeft),this.wrapperEl.style.margin="-".concat(this.elStyles.paddingTop," -").concat(this.elStyles.paddingRight," -").concat(this.elStyles.paddingBottom," -").concat(this.elStyles.paddingLeft);var E=this.contentEl.scrollHeight,k=this.contentEl.scrollWidth;this.contentWrapperEl.style.height=c?"auto":"100%",this.placeholderEl.style.width=f?"".concat(a||k,"px"):"auto",this.placeholderEl.style.height="".concat(E,"px");var P=this.contentWrapperEl.offsetHeight;this.axis.x.isOverflowing=a!==0&&k>a,this.axis.y.isOverflowing=E>P,this.axis.x.isOverflowing=v==="hidden"?!1:this.axis.x.isOverflowing,this.axis.y.isOverflowing=r==="hidden"?!1:this.axis.y.isOverflowing,this.axis.x.forceVisible=this.options.forceVisible==="x"||this.options.forceVisible===!0,this.axis.y.forceVisible=this.options.forceVisible==="y"||this.options.forceVisible===!0,this.hideNativeScrollbar();var L=this.axis.x.isOverflowing?this.scrollbarWidth:0,O=this.axis.y.isOverflowing?this.scrollbarWidth:0;this.axis.x.isOverflowing=this.axis.x.isOverflowing&&k>_-O,this.axis.y.isOverflowing=this.axis.y.isOverflowing&&E>P-L,this.axis.x.scrollbar.size=this.getScrollbarSize("x"),this.axis.y.scrollbar.size=this.getScrollbarSize("y"),this.axis.x.scrollbar.el&&(this.axis.x.scrollbar.el.style.width="".concat(this.axis.x.scrollbar.size,"px")),this.axis.y.scrollbar.el&&(this.axis.y.scrollbar.el.style.height="".concat(this.axis.y.scrollbar.size,"px")),this.positionScrollbar("x"),this.positionScrollbar("y"),this.toggleTrackVisibility("x"),this.toggleTrackVisibility("y")}},S.prototype.getScrollbarSize=function(t){var a,c;if(t===void 0&&(t="y"),!this.axis[t].isOverflowing||!this.contentEl)return 0;var f=this.contentEl[this.axis[t].scrollSizeAttr],_=(c=(a=this.axis[t].track.el)===null||a===void 0?void 0:a[this.axis[t].offsetSizeAttr])!==null&&c!==void 0?c:0,v=_/f,r;return r=Math.max(~~(v*_),this.options.scrollbarMinSize),this.options.scrollbarMaxSize&&(r=Math.min(r,this.options.scrollbarMaxSize)),r},S.prototype.positionScrollbar=function(t){var a,c,f;t===void 0&&(t="y");var _=this.axis[t].scrollbar;if(!(!this.axis[t].isOverflowing||!this.contentWrapperEl||!_.el||!this.elStyles)){var v=this.contentWrapperEl[this.axis[t].scrollSizeAttr],r=((a=this.axis[t].track.el)===null||a===void 0?void 0:a[this.axis[t].offsetSizeAttr])||0,E=parseInt(this.elStyles[this.axis[t].sizeAttr],10),k=this.contentWrapperEl[this.axis[t].scrollOffsetAttr];k=t==="x"&&this.isRtl&&(!((c=S.getRtlHelpers())===null||c===void 0)&&c.isScrollOriginAtZero)?-k:k,t==="x"&&this.isRtl&&(k=!((f=S.getRtlHelpers())===null||f===void 0)&&f.isScrollingToNegative?k:-k);var P=k/(v-E),L=~~((r-_.size)*P);L=t==="x"&&this.isRtl?-L+(r-_.size):L,_.el.style.transform=t==="x"?"translate3d(".concat(L,"px, 0, 0)"):"translate3d(0, ".concat(L,"px, 0)")}},S.prototype.toggleTrackVisibility=function(t){t===void 0&&(t="y");var a=this.axis[t].track.el,c=this.axis[t].scrollbar.el;!a||!c||!this.contentWrapperEl||(this.axis[t].isOverflowing||this.axis[t].forceVisible?(a.style.visibility="visible",this.contentWrapperEl.style[this.axis[t].overflowAttr]="scroll",this.el.classList.add("".concat(this.classNames.scrollable,"-").concat(t))):(a.style.visibility="hidden",this.contentWrapperEl.style[this.axis[t].overflowAttr]="hidden",this.el.classList.remove("".concat(this.classNames.scrollable,"-").concat(t))),this.axis[t].isOverflowing?c.style.display="block":c.style.display="none")},S.prototype.showScrollbar=function(t){t===void 0&&(t="y"),this.axis[t].isOverflowing&&!this.axis[t].scrollbar.isVisible&&(Bl(this.axis[t].scrollbar.el,this.classNames.visible),this.axis[t].scrollbar.isVisible=!0)},S.prototype.hideScrollbar=function(t){t===void 0&&(t="y"),!this.isDragging&&this.axis[t].isOverflowing&&this.axis[t].scrollbar.isVisible&&(Nl(this.axis[t].scrollbar.el,this.classNames.visible),this.axis[t].scrollbar.isVisible=!1)},S.prototype.hideNativeScrollbar=function(){this.offsetEl&&(this.offsetEl.style[this.isRtl?"left":"right"]=this.axis.y.isOverflowing||this.axis.y.forceVisible?"-".concat(this.scrollbarWidth,"px"):"0px",this.offsetEl.style.bottom=this.axis.x.isOverflowing||this.axis.x.forceVisible?"-".concat(this.scrollbarWidth,"px"):"0px")},S.prototype.onMouseMoveForAxis=function(t){t===void 0&&(t="y");var a=this.axis[t];!a.track.el||!a.scrollbar.el||(a.track.rect=a.track.el.getBoundingClientRect(),a.scrollbar.rect=a.scrollbar.el.getBoundingClientRect(),this.isWithinBounds(a.track.rect)?(this.showScrollbar(t),Bl(a.track.el,this.classNames.hover),this.isWithinBounds(a.scrollbar.rect)?Bl(a.scrollbar.el,this.classNames.hover):Nl(a.scrollbar.el,this.classNames.hover)):(Nl(a.track.el,this.classNames.hover),this.options.autoHide&&this.hideScrollbar(t)))},S.prototype.onMouseLeaveForAxis=function(t){t===void 0&&(t="y"),Nl(this.axis[t].track.el,this.classNames.hover),Nl(this.axis[t].scrollbar.el,this.classNames.hover),this.options.autoHide&&this.hideScrollbar(t)},S.prototype.onDragStart=function(t,a){var c;a===void 0&&(a="y"),this.isDragging=!0;var f=py(this.el),_=Fl(this.el),v=this.axis[a].scrollbar,r=a==="y"?t.pageY:t.pageX;this.axis[a].dragOffset=r-(((c=v.rect)===null||c===void 0?void 0:c[this.axis[a].offsetAttr])||0),this.draggedAxis=a,Bl(this.el,this.classNames.dragging),f.addEventListener("mousemove",this.drag,!0),f.addEventListener("mouseup",this.onEndDrag,!0),this.removePreventClickId===null?(f.addEventListener("click",this.preventClick,!0),f.addEventListener("dblclick",this.preventClick,!0)):(_.clearTimeout(this.removePreventClickId),this.removePreventClickId=null)},S.prototype.onTrackClick=function(t,a){var c=this,f,_,v,r;a===void 0&&(a="y");var E=this.axis[a];if(!(!this.options.clickOnTrack||!E.scrollbar.el||!this.contentWrapperEl)){t.preventDefault();var k=Fl(this.el);this.axis[a].scrollbar.rect=E.scrollbar.el.getBoundingClientRect();var P=this.axis[a].scrollbar,L=(_=(f=P.rect)===null||f===void 0?void 0:f[this.axis[a].offsetAttr])!==null&&_!==void 0?_:0,O=parseInt((r=(v=this.elStyles)===null||v===void 0?void 0:v[this.axis[a].sizeAttr])!==null&&r!==void 0?r:"0px",10),N=this.contentWrapperEl[this.axis[a].scrollOffsetAttr],G=a==="y"?this.mouseY-L:this.mouseX-L,H=G<0?-1:1,Q=H===-1?N-O:N+O,ee=40,ie=function(){c.contentWrapperEl&&(H===-1?N>Q&&(N-=ee,c.contentWrapperEl[c.axis[a].scrollOffsetAttr]=N,k.requestAnimationFrame(ie)):N<Q&&(N+=ee,c.contentWrapperEl[c.axis[a].scrollOffsetAttr]=N,k.requestAnimationFrame(ie)))};ie()}},S.prototype.getContentElement=function(){return this.contentEl},S.prototype.getScrollElement=function(){return this.contentWrapperEl},S.prototype.removeListeners=function(){var t=Fl(this.el);this.el.removeEventListener("mouseenter",this.onMouseEnter),this.el.removeEventListener("pointerdown",this.onPointerEvent,!0),this.el.removeEventListener("mousemove",this.onMouseMove),this.el.removeEventListener("mouseleave",this.onMouseLeave),this.contentWrapperEl&&this.contentWrapperEl.removeEventListener("scroll",this.onScroll),t.removeEventListener("resize",this.onWindowResize),this.mutationObserver&&this.mutationObserver.disconnect(),this.resizeObserver&&this.resizeObserver.disconnect(),this.onMouseMove.cancel(),this.onWindowResize.cancel(),this.onStopScrolling.cancel(),this.onMouseEntered.cancel()},S.prototype.unMount=function(){this.removeListeners()},S.prototype.isWithinBounds=function(t){return this.mouseX>=t.left&&this.mouseX<=t.left+t.width&&this.mouseY>=t.top&&this.mouseY<=t.top+t.height},S.prototype.findChild=function(t,a){var c=t.matches||t.webkitMatchesSelector||t.mozMatchesSelector||t.msMatchesSelector;return Array.prototype.filter.call(t.children,function(f){return c.call(f,a)})[0]},S.rtlHelpers=null,S.defaultOptions={forceVisible:!1,clickOnTrack:!0,scrollbarMinSize:25,scrollbarMaxSize:0,ariaLabel:"scrollable content",tabIndex:0,classNames:{contentEl:"simplebar-content",contentWrapper:"simplebar-content-wrapper",offset:"simplebar-offset",mask:"simplebar-mask",wrapper:"simplebar-wrapper",placeholder:"simplebar-placeholder",scrollbar:"simplebar-scrollbar",track:"simplebar-track",heightAutoObserverWrapperEl:"simplebar-height-auto-observer-wrapper",heightAutoObserverEl:"simplebar-height-auto-observer",visible:"simplebar-visible",horizontal:"simplebar-horizontal",vertical:"simplebar-vertical",hover:"simplebar-hover",dragging:"simplebar-dragging",scrolling:"simplebar-scrolling",scrollable:"simplebar-scrollable",mouseEntered:"simplebar-mouse-entered"},scrollableNode:null,contentNode:null,autoHide:!0},S.getOptions=$2,S.helpers=Z2,S}(),Ry=function(S,t){return Ry=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,c){a.__proto__=c}||function(a,c){for(var f in c)Object.prototype.hasOwnProperty.call(c,f)&&(a[f]=c[f])},Ry(S,t)};function J2(S,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");Ry(S,t);function a(){this.constructor=S}S.prototype=t===null?Object.create(t):(a.prototype=t.prototype,new a)}var ix=Qg.helpers,gy=ix.getOptions,ca=ix.addClasses,K2=ix.canUseDOM,Dy=function(S){J2(t,S);function t(){for(var a=[],c=0;c<arguments.length;c++)a[c]=arguments[c];var f=S.apply(this,a)||this;return t.instances.set(a[0],f),f}return t.initDOMLoadedElements=function(){document.removeEventListener("DOMContentLoaded",this.initDOMLoadedElements),window.removeEventListener("load",this.initDOMLoadedElements),Array.prototype.forEach.call(document.querySelectorAll("[data-simplebar]"),function(a){a.getAttribute("data-simplebar")!=="init"&&!t.instances.has(a)&&new t(a,gy(a.attributes))})},t.removeObserver=function(){var a;(a=t.globalObserver)===null||a===void 0||a.disconnect()},t.prototype.initDOM=function(){var a=this,c,f,_;if(!Array.prototype.filter.call(this.el.children,function(E){return E.classList.contains(a.classNames.wrapper)}).length){for(this.wrapperEl=document.createElement("div"),this.contentWrapperEl=document.createElement("div"),this.offsetEl=document.createElement("div"),this.maskEl=document.createElement("div"),this.contentEl=document.createElement("div"),this.placeholderEl=document.createElement("div"),this.heightAutoObserverWrapperEl=document.createElement("div"),this.heightAutoObserverEl=document.createElement("div"),ca(this.wrapperEl,this.classNames.wrapper),ca(this.contentWrapperEl,this.classNames.contentWrapper),ca(this.offsetEl,this.classNames.offset),ca(this.maskEl,this.classNames.mask),ca(this.contentEl,this.classNames.contentEl),ca(this.placeholderEl,this.classNames.placeholder),ca(this.heightAutoObserverWrapperEl,this.classNames.heightAutoObserverWrapperEl),ca(this.heightAutoObserverEl,this.classNames.heightAutoObserverEl);this.el.firstChild;)this.contentEl.appendChild(this.el.firstChild);this.contentWrapperEl.appendChild(this.contentEl),this.offsetEl.appendChild(this.contentWrapperEl),this.maskEl.appendChild(this.offsetEl),this.heightAutoObserverWrapperEl.appendChild(this.heightAutoObserverEl),this.wrapperEl.appendChild(this.heightAutoObserverWrapperEl),this.wrapperEl.appendChild(this.maskEl),this.wrapperEl.appendChild(this.placeholderEl),this.el.appendChild(this.wrapperEl),(c=this.contentWrapperEl)===null||c===void 0||c.setAttribute("tabindex",this.options.tabIndex.toString()),(f=this.contentWrapperEl)===null||f===void 0||f.setAttribute("role","region"),(_=this.contentWrapperEl)===null||_===void 0||_.setAttribute("aria-label",this.options.ariaLabel)}if(!this.axis.x.track.el||!this.axis.y.track.el){var v=document.createElement("div"),r=document.createElement("div");ca(v,this.classNames.track),ca(r,this.classNames.scrollbar),v.appendChild(r),this.axis.x.track.el=v.cloneNode(!0),ca(this.axis.x.track.el,this.classNames.horizontal),this.axis.y.track.el=v.cloneNode(!0),ca(this.axis.y.track.el,this.classNames.vertical),this.el.appendChild(this.axis.x.track.el),this.el.appendChild(this.axis.y.track.el)}Qg.prototype.initDOM.call(this),this.el.setAttribute("data-simplebar","init")},t.prototype.unMount=function(){Qg.prototype.unMount.call(this),t.instances.delete(this.el)},t.initHtmlApi=function(){this.initDOMLoadedElements=this.initDOMLoadedElements.bind(this),typeof MutationObserver<"u"&&(this.globalObserver=new MutationObserver(t.handleMutations),this.globalObserver.observe(document,{childList:!0,subtree:!0})),document.readyState==="complete"||document.readyState!=="loading"&&!document.documentElement.doScroll?window.setTimeout(this.initDOMLoadedElements):(document.addEventListener("DOMContentLoaded",this.initDOMLoadedElements),window.addEventListener("load",this.initDOMLoadedElements))},t.handleMutations=function(a){a.forEach(function(c){c.addedNodes.forEach(function(f){f.nodeType===1&&(f.hasAttribute("data-simplebar")?!t.instances.has(f)&&document.documentElement.contains(f)&&new t(f,gy(f.attributes)):f.querySelectorAll("[data-simplebar]").forEach(function(_){_.getAttribute("data-simplebar")!=="init"&&!t.instances.has(_)&&document.documentElement.contains(_)&&new t(_,gy(_.attributes))}))}),c.removedNodes.forEach(function(f){var _;f.nodeType===1&&(f.getAttribute("data-simplebar")==="init"?!document.documentElement.contains(f)&&((_=t.instances.get(f))===null||_===void 0||_.unMount()):Array.prototype.forEach.call(f.querySelectorAll('[data-simplebar="init"]'),function(v){var r;!document.documentElement.contains(v)&&((r=t.instances.get(v))===null||r===void 0||r.unMount())}))})})},t.instances=new WeakMap,t}(Qg);K2&&Dy.initHtmlApi();/*!
 * ApexCharts v5.3.5
 * (c) 2018-2025 ApexCharts
 */function Oy(S,t){(t==null||t>S.length)&&(t=S.length);for(var a=0,c=Array(t);a<t;a++)c[a]=S[a];return c}function Yw(S){if(S===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return S}function pi(S,t){if(!(S instanceof t))throw new TypeError("Cannot call a class as a function")}function fw(S,t){for(var a=0;a<t.length;a++){var c=t[a];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(S,$w(c.key),c)}}function gi(S,t,a){return t&&fw(S.prototype,t),a&&fw(S,a),Object.defineProperty(S,"prototype",{writable:!1}),S}function Uf(S,t){var a=typeof Symbol<"u"&&S[Symbol.iterator]||S["@@iterator"];if(!a){if(Array.isArray(S)||(a=rx(S))||t){a&&(S=a);var c=0,f=function(){};return{s:f,n:function(){return c>=S.length?{done:!0}:{done:!1,value:S[c++]}},e:function(E){throw E},f}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var _,v=!0,r=!1;return{s:function(){a=a.call(S)},n:function(){var E=a.next();return v=E.done,E},e:function(E){r=!0,_=E},f:function(){try{v||a.return==null||a.return()}finally{if(r)throw _}}}}function $f(S){var t=qw();return function(){var a,c=lm(S);if(t){var f=lm(this).constructor;a=Reflect.construct(c,arguments,f)}else a=c.apply(this,arguments);return function(_,v){if(v&&(typeof v=="object"||typeof v=="function"))return v;if(v!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Yw(_)}(this,a)}}function om(S,t,a){return(t=$w(t))in S?Object.defineProperty(S,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):S[t]=a,S}function lm(S){return lm=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},lm(S)}function Jf(S,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");S.prototype=Object.create(t&&t.prototype,{constructor:{value:S,writable:!0,configurable:!0}}),Object.defineProperty(S,"prototype",{writable:!1}),t&&Fy(S,t)}function qw(){try{var S=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(qw=function(){return!!S})()}function pw(S,t){var a=Object.keys(S);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(S);t&&(c=c.filter(function(f){return Object.getOwnPropertyDescriptor(S,f).enumerable})),a.push.apply(a,c)}return a}function Jt(S){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?arguments[t]:{};t%2?pw(Object(a),!0).forEach(function(c){om(S,c,a[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(S,Object.getOwnPropertyDescriptors(a)):pw(Object(a)).forEach(function(c){Object.defineProperty(S,c,Object.getOwnPropertyDescriptor(a,c))})}return S}function Fy(S,t){return Fy=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,c){return a.__proto__=c,a},Fy(S,t)}function Zw(S,t){return function(a){if(Array.isArray(a))return a}(S)||function(a,c){var f=a==null?null:typeof Symbol<"u"&&a[Symbol.iterator]||a["@@iterator"];if(f!=null){var _,v,r,E,k=[],P=!0,L=!1;try{if(r=(f=f.call(a)).next,c===0){if(Object(f)!==f)return;P=!1}else for(;!(P=(_=r.call(f)).done)&&(k.push(_.value),k.length!==c);P=!0);}catch(O){L=!0,v=O}finally{try{if(!P&&f.return!=null&&(E=f.return(),Object(E)!==E))return}finally{if(L)throw v}}return k}}(S,t)||rx(S,t)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function Us(S){return function(t){if(Array.isArray(t))return Oy(t)}(S)||function(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}(S)||rx(S)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function $w(S){var t=function(a,c){if(typeof a!="object"||!a)return a;var f=a[Symbol.toPrimitive];if(f!==void 0){var _=f.call(a,c);if(typeof _!="object")return _;throw new TypeError("@@toPrimitive must return a primitive value.")}return(c==="string"?String:Number)(a)}(S,"string");return typeof t=="symbol"?t:t+""}function Cn(S){return Cn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Cn(S)}function rx(S,t){if(S){if(typeof S=="string")return Oy(S,t);var a={}.toString.call(S).slice(8,-1);return a==="Object"&&S.constructor&&(a=S.constructor.name),a==="Map"||a==="Set"?Array.from(S):a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?Oy(S,t):void 0}}var et=function(){function S(){pi(this,S)}return gi(S,[{key:"shadeRGBColor",value:function(t,a){var c=a.split(","),f=t<0?0:255,_=t<0?-1*t:t,v=parseInt(c[0].slice(4),10),r=parseInt(c[1],10),E=parseInt(c[2],10);return"rgb("+(Math.round((f-v)*_)+v)+","+(Math.round((f-r)*_)+r)+","+(Math.round((f-E)*_)+E)+")"}},{key:"shadeHexColor",value:function(t,a){var c=parseInt(a.slice(1),16),f=t<0?0:255,_=t<0?-1*t:t,v=c>>16,r=c>>8&255,E=255&c;return"#"+(16777216+65536*(Math.round((f-v)*_)+v)+256*(Math.round((f-r)*_)+r)+(Math.round((f-E)*_)+E)).toString(16).slice(1)}},{key:"shadeColor",value:function(t,a){return S.isColorHex(a)?this.shadeHexColor(t,a):this.shadeRGBColor(t,a)}}],[{key:"bind",value:function(t,a){return function(){return t.apply(a,arguments)}}},{key:"isObject",value:function(t){return t&&Cn(t)==="object"&&!Array.isArray(t)&&t!=null}},{key:"is",value:function(t,a){return Object.prototype.toString.call(a)==="[object "+t+"]"}},{key:"isSafari",value:function(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}},{key:"listToArray",value:function(t){var a,c=[];for(a=0;a<t.length;a++)c[a]=t[a];return c}},{key:"extend",value:function(t,a){var c=this;typeof Object.assign!="function"&&(Object.assign=function(_){if(_==null)throw new TypeError("Cannot convert undefined or null to object");for(var v=Object(_),r=1;r<arguments.length;r++){var E=arguments[r];if(E!=null)for(var k in E)E.hasOwnProperty(k)&&(v[k]=E[k])}return v});var f=Object.assign({},t);return this.isObject(t)&&this.isObject(a)&&Object.keys(a).forEach(function(_){c.isObject(a[_])&&_ in t?f[_]=c.extend(t[_],a[_]):Object.assign(f,om({},_,a[_]))}),f}},{key:"extendArray",value:function(t,a){var c=[];return t.map(function(f){c.push(S.extend(a,f))}),t=c}},{key:"monthMod",value:function(t){return t%12}},{key:"clone",value:function(t){var a,c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new WeakMap;if(t===null||Cn(t)!=="object")return t;if(c.has(t))return c.get(t);if(Array.isArray(t)){a=[],c.set(t,a);for(var f=0;f<t.length;f++)a[f]=this.clone(t[f],c)}else if(t instanceof Date)a=new Date(t.getTime());else for(var _ in a={},c.set(t,a),t)t.hasOwnProperty(_)&&(a[_]=this.clone(t[_],c));return a}},{key:"log10",value:function(t){return Math.log(t)/Math.LN10}},{key:"roundToBase10",value:function(t){return Math.pow(10,Math.floor(Math.log10(t)))}},{key:"roundToBase",value:function(t,a){return Math.pow(a,Math.floor(Math.log(t)/Math.log(a)))}},{key:"parseNumber",value:function(t){return typeof t=="number"||t===null?t:parseFloat(t)}},{key:"stripNumber",value:function(t){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:2;return Number.isInteger(t)?t:parseFloat(t.toPrecision(a))}},{key:"randomId",value:function(){return(Math.random()+1).toString(36).substring(4)}},{key:"noExponents",value:function(t){return t.toString().includes("e")?Math.round(t):t}},{key:"elementExists",value:function(t){return!(!t||!t.isConnected)}},{key:"getDimensions",value:function(t){var a=getComputedStyle(t,null),c=t.clientHeight,f=t.clientWidth;return c-=parseFloat(a.paddingTop)+parseFloat(a.paddingBottom),[f-=parseFloat(a.paddingLeft)+parseFloat(a.paddingRight),c]}},{key:"getBoundingClientRect",value:function(t){var a=t.getBoundingClientRect();return{top:a.top,right:a.right,bottom:a.bottom,left:a.left,width:t.clientWidth,height:t.clientHeight,x:a.left,y:a.top}}},{key:"getLargestStringFromArr",value:function(t){return t.reduce(function(a,c){return Array.isArray(c)&&(c=c.reduce(function(f,_){return f.length>_.length?f:_})),a.length>c.length?a:c},0)}},{key:"hexToRgba",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"#999999",a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:.6;t.substring(0,1)!=="#"&&(t="#999999");var c=t.replace("#","");c=c.match(new RegExp("(.{"+c.length/3+"})","g"));for(var f=0;f<c.length;f++)c[f]=parseInt(c[f].length===1?c[f]+c[f]:c[f],16);return a!==void 0&&c.push(a),"rgba("+c.join(",")+")"}},{key:"getOpacityFromRGBA",value:function(t){return parseFloat(t.replace(/^.*,(.+)\)/,"$1"))}},{key:"rgb2hex",value:function(t){return(t=t.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i))&&t.length===4?"#"+("0"+parseInt(t[1],10).toString(16)).slice(-2)+("0"+parseInt(t[2],10).toString(16)).slice(-2)+("0"+parseInt(t[3],10).toString(16)).slice(-2):""}},{key:"isColorHex",value:function(t){return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)|(^#[0-9A-F]{8}$)/i.test(t)}},{key:"getPolygonPos",value:function(t,a){for(var c=[],f=2*Math.PI/a,_=0;_<a;_++){var v={};v.x=t*Math.sin(_*f),v.y=-t*Math.cos(_*f),c.push(v)}return c}},{key:"polarToCartesian",value:function(t,a,c,f){var _=(f-90)*Math.PI/180;return{x:t+c*Math.cos(_),y:a+c*Math.sin(_)}}},{key:"escapeString",value:function(t){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"x",c=t.toString().slice();return c=c.replace(/[` ~!@#$%^&*()|+\=?;:'",.<>{}[\]\\/]/gi,a)}},{key:"negToZero",value:function(t){return t<0?0:t}},{key:"moveIndexInArray",value:function(t,a,c){if(c>=t.length)for(var f=c-t.length+1;f--;)t.push(void 0);return t.splice(c,0,t.splice(a,1)[0]),t}},{key:"extractNumber",value:function(t){return parseFloat(t.replace(/[^\d.]*/g,""))}},{key:"findAncestor",value:function(t,a){for(;(t=t.parentElement)&&!t.classList.contains(a););return t}},{key:"setELstyles",value:function(t,a){for(var c in a)a.hasOwnProperty(c)&&(t.style.key=a[c])}},{key:"preciseAddition",value:function(t,a){var c=(String(t).split(".")[1]||"").length,f=(String(a).split(".")[1]||"").length,_=Math.pow(10,Math.max(c,f));return(Math.round(t*_)+Math.round(a*_))/_}},{key:"isNumber",value:function(t){return!isNaN(t)&&parseFloat(Number(t))===t&&!isNaN(parseInt(t,10))}},{key:"isFloat",value:function(t){return Number(t)===t&&t%1!=0}},{key:"isMsEdge",value:function(){var t=window.navigator.userAgent,a=t.indexOf("Edge/");return a>0&&parseInt(t.substring(a+5,t.indexOf(".",a)),10)}},{key:"getGCD",value:function(t,a){var c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:7,f=Math.pow(10,c-Math.floor(Math.log10(Math.max(t,a))));for(t=Math.round(Math.abs(t)*f),a=Math.round(Math.abs(a)*f);a;){var _=a;a=t%a,t=_}return t/f}},{key:"getPrimeFactors",value:function(t){for(var a=[],c=2;t>=2;)t%c==0?(a.push(c),t/=c):c++;return a}},{key:"mod",value:function(t,a){var c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:7,f=Math.pow(10,c-Math.floor(Math.log10(Math.max(t,a))));return(t=Math.round(Math.abs(t)*f))%(a=Math.round(Math.abs(a)*f))/f}}]),S}(),Nu=function(){function S(t){pi(this,S),this.ctx=t,this.w=t.w}return gi(S,[{key:"animateLine",value:function(t,a,c,f){t.attr(a).animate(f).attr(c)}},{key:"animateMarker",value:function(t,a,c,f){t.attr({opacity:0}).animate(a).attr({opacity:1}).after(function(){f()})}},{key:"animateRect",value:function(t,a,c,f,_){t.attr(a).animate(f).attr(c).after(function(){return _()})}},{key:"animatePathsGradually",value:function(t){var a=t.el,c=t.realIndex,f=t.j,_=t.fill,v=t.pathFrom,r=t.pathTo,E=t.speed,k=t.delay,P=this.w,L=0;P.config.chart.animations.animateGradually.enabled&&(L=P.config.chart.animations.animateGradually.delay),P.config.chart.animations.dynamicAnimation.enabled&&P.globals.dataChanged&&P.config.chart.type!=="bar"&&(L=0),this.morphSVG(a,c,f,P.config.chart.type!=="line"||P.globals.comboCharts?_:"stroke",v,r,E,k*L)}},{key:"showDelayedElements",value:function(){this.w.globals.delayedElements.forEach(function(t){var a=t.el;a.classList.remove("apexcharts-element-hidden"),a.classList.add("apexcharts-hidden-element-shown")})}},{key:"animationCompleted",value:function(t){var a=this.w;a.globals.animationEnded||(a.globals.animationEnded=!0,this.showDelayedElements(),typeof a.config.chart.events.animationEnd=="function"&&a.config.chart.events.animationEnd(this.ctx,{el:t,w:a}))}},{key:"morphSVG",value:function(t,a,c,f,_,v,r,E){var k=this,P=this.w;_||(_=t.attr("pathFrom")),v||(v=t.attr("pathTo"));var L=function(O){return P.config.chart.type==="radar"&&(r=1),"M 0 ".concat(P.globals.gridHeight)};(!_||_.indexOf("undefined")>-1||_.indexOf("NaN")>-1)&&(_=L()),(!v.trim()||v.indexOf("undefined")>-1||v.indexOf("NaN")>-1)&&(v=L()),P.globals.shouldAnimate||(r=1),t.plot(_).animate(1,E).plot(_).animate(r,E).plot(v).after(function(){et.isNumber(c)?c===P.globals.series[P.globals.maxValsInArrayIndex].length-2&&P.globals.shouldAnimate&&k.animationCompleted(t):f!=="none"&&P.globals.shouldAnimate&&(!P.globals.comboCharts&&a===P.globals.series.length-1||P.globals.comboCharts)&&k.animationCompleted(t),k.showDelayedElements()})}}]),S}();const By={},Jw=[];function gr(S,t){if(Array.isArray(S))for(const a of S)gr(a,t);else if(typeof S!="object")Kw(Object.getOwnPropertyNames(t)),By[S]=Object.assign(By[S]||{},t);else for(const a in S)gr(a,S[a])}function Rn(S){return By[S]||{}}function Kw(S){Jw.push(...S)}function sx(S,t){let a;const c=S.length,f=[];for(a=0;a<c;a++)f.push(t(S[a]));return f}function my(S){return S%360*Math.PI/180}function Vu(S){return S.charAt(0).toUpperCase()+S.slice(1)}function Uu(S,t,a,c){return t!=null&&a!=null||(c=c||S.bbox(),t==null?t=c.width/c.height*a:a==null&&(a=c.height/c.width*t)),{width:t,height:a}}function Ny(S,t){const a=S.origin;let c=S.ox!=null?S.ox:S.originX!=null?S.originX:"center",f=S.oy!=null?S.oy:S.originY!=null?S.originY:"center";a!=null&&([c,f]=Array.isArray(a)?a:typeof a=="object"?[a.x,a.y]:[a,a]);const _=typeof c=="string",v=typeof f=="string";if(_||v){const{height:r,width:E,x:k,y:P}=t.bbox();_&&(c=c.includes("left")?k:c.includes("right")?k+E:k+E/2),v&&(f=f.includes("top")?P:f.includes("bottom")?P+r:P+r/2)}return[c,f]}const Q2=new Set(["desc","metadata","title"]),Vy=S=>Q2.has(S.nodeName),Qw=(S,t,a={})=>{const c={...t};for(const f in c)c[f].valueOf()===a[f]&&delete c[f];Object.keys(c).length?S.node.setAttribute("data-svgjs",JSON.stringify(c)):(S.node.removeAttribute("data-svgjs"),S.node.removeAttribute("svgjs:data"))},nx="http://www.w3.org/2000/svg",_y="http://www.w3.org/2000/xmlns/",ju="http://www.w3.org/1999/xlink",Or={window:typeof window>"u"?null:window,document:typeof document>"u"?null:document};function Kf(){return Or.window}let ax=class{};const $c={},ox="___SYMBOL___ROOT___";function Wf(S,t=nx){return Or.document.createElementNS(t,S)}function In(S,t=!1){if(S instanceof ax)return S;if(typeof S=="object")return yy(S);if(S==null)return new $c[ox];if(typeof S=="string"&&S.charAt(0)!=="<")return yy(Or.document.querySelector(S));const a=t?Or.document.createElement("div"):Wf("svg");return a.innerHTML=S,S=yy(a.firstChild),a.removeChild(a.firstChild),S}function ss(S,t){return t&&(t instanceof Or.window.Node||t.ownerDocument&&t instanceof t.ownerDocument.defaultView.Node)?t:Wf(S)}function ua(S){if(!S)return null;if(S.instance instanceof ax)return S.instance;if(S.nodeName==="#document-fragment")return new $c.Fragment(S);let t=Vu(S.nodeName||"Dom");return t==="LinearGradient"||t==="RadialGradient"?t="Gradient":$c[t]||(t="Dom"),new $c[t](S)}let yy=ua;function Fr(S,t=S.name,a=!1){return $c[t]=S,a&&($c[ox]=S),Kw(Object.getOwnPropertyNames(S.prototype)),S}let eE=1e3;function e1(S){return"Svgjs"+Vu(S)+eE++}function t1(S){for(let t=S.children.length-1;t>=0;t--)t1(S.children[t]);return S.id&&(S.id=e1(S.nodeName)),S}function Xi(S,t){let a,c;for(c=(S=Array.isArray(S)?S:[S]).length-1;c>=0;c--)for(a in t)S[c].prototype[a]=t[a]}function rs(S){return function(...t){const a=t[t.length-1];return!a||a.constructor!==Object||a instanceof Array?S.apply(this,t):S.apply(this,t.slice(0,-1)).attr(a)}}gr("Dom",{siblings:function(){return this.parent().children()},position:function(){return this.parent().index(this)},next:function(){return this.siblings()[this.position()+1]},prev:function(){return this.siblings()[this.position()-1]},forward:function(){const S=this.position();return this.parent().add(this.remove(),S+1),this},backward:function(){const S=this.position();return this.parent().add(this.remove(),S?S-1:0),this},front:function(){return this.parent().add(this.remove()),this},back:function(){return this.parent().add(this.remove(),0),this},before:function(S){(S=In(S)).remove();const t=this.position();return this.parent().add(S,t),this},after:function(S){(S=In(S)).remove();const t=this.position();return this.parent().add(S,t+1),this},insertBefore:function(S){return(S=In(S)).before(this),this},insertAfter:function(S){return(S=In(S)).after(this),this}});const i1=/^([+-]?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?)([a-z%]*)$/i,tE=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i,iE=/rgb\((\d+),(\d+),(\d+)\)/,rE=/(#[a-z_][a-z0-9\-_]*)/i,sE=/\)\s*,?\s*/,nE=/\s/g,gw=/^#[a-f0-9]{3}$|^#[a-f0-9]{6}$/i,mw=/^rgb\(/,_w=/^(\s+)?$/,yw=/^[+-]?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,aE=/\.(jpg|jpeg|png|gif|svg)(\?[^=]+.*)?/i,Xo=/[\s,]+/,lx=/[MLHVCSQTAZ]/i;function oE(S){const t=Math.round(S),a=Math.max(0,Math.min(255,t)).toString(16);return a.length===1?"0"+a:a}function Pu(S,t){for(let a=t.length;a--;)if(S[t[a]]==null)return!1;return!0}function xy(S,t,a){return a<0&&(a+=1),a>1&&(a-=1),a<1/6?S+6*(t-S)*a:a<.5?t:a<2/3?S+(t-S)*(2/3-a)*6:S}gr("Dom",{classes:function(){const S=this.attr("class");return S==null?[]:S.trim().split(Xo)},hasClass:function(S){return this.classes().indexOf(S)!==-1},addClass:function(S){if(!this.hasClass(S)){const t=this.classes();t.push(S),this.attr("class",t.join(" "))}return this},removeClass:function(S){return this.hasClass(S)&&this.attr("class",this.classes().filter(function(t){return t!==S}).join(" ")),this},toggleClass:function(S){return this.hasClass(S)?this.removeClass(S):this.addClass(S)}}),gr("Dom",{css:function(S,t){const a={};if(arguments.length===0)return this.node.style.cssText.split(/\s*;\s*/).filter(function(c){return!!c.length}).forEach(function(c){const f=c.split(/\s*:\s*/);a[f[0]]=f[1]}),a;if(arguments.length<2){if(Array.isArray(S)){for(const c of S){const f=c;a[c]=this.node.style.getPropertyValue(f)}return a}if(typeof S=="string")return this.node.style.getPropertyValue(S);if(typeof S=="object")for(const c in S)this.node.style.setProperty(c,S[c]==null||_w.test(S[c])?"":S[c])}return arguments.length===2&&this.node.style.setProperty(S,t==null||_w.test(t)?"":t),this},show:function(){return this.css("display","")},hide:function(){return this.css("display","none")},visible:function(){return this.css("display")!=="none"}}),gr("Dom",{data:function(S,t,a){if(S==null)return this.data(sx(function(c,f){let _;const v=c.length,r=[];for(_=0;_<v;_++)f(c[_])&&r.push(c[_]);return r}(this.node.attributes,c=>c.nodeName.indexOf("data-")===0),c=>c.nodeName.slice(5)));if(S instanceof Array){const c={};for(const f of S)c[f]=this.data(f);return c}if(typeof S=="object")for(t in S)this.data(t,S[t]);else if(arguments.length<2)try{return JSON.parse(this.attr("data-"+S))}catch{return this.attr("data-"+S)}else this.attr("data-"+S,t===null?null:a===!0||typeof t=="string"||typeof t=="number"?t:JSON.stringify(t));return this}}),gr("Dom",{remember:function(S,t){if(typeof arguments[0]=="object")for(const a in S)this.remember(a,S[a]);else{if(arguments.length===1)return this.memory()[S];this.memory()[S]=t}return this},forget:function(){if(arguments.length===0)this._memory={};else for(let S=arguments.length-1;S>=0;S--)delete this.memory()[arguments[S]];return this},memory:function(){return this._memory=this._memory||{}}});class es{constructor(...t){this.init(...t)}static isColor(t){return t&&(t instanceof es||this.isRgb(t)||this.test(t))}static isRgb(t){return t&&typeof t.r=="number"&&typeof t.g=="number"&&typeof t.b=="number"}static random(t="vibrant",a){const{random:c,round:f,sin:_,PI:v}=Math;if(t==="vibrant"){const r=24*c()+57,E=38*c()+45,k=360*c();return new es(r,E,k,"lch")}if(t==="sine"){const r=f(80*_(2*v*(a=a==null?c():a)/.5+.01)+150),E=f(50*_(2*v*a/.5+4.6)+200),k=f(100*_(2*v*a/.5+2.3)+150);return new es(r,E,k)}if(t==="pastel"){const r=8*c()+86,E=17*c()+9,k=360*c();return new es(r,E,k,"lch")}if(t==="dark"){const r=10+10*c(),E=50*c()+86,k=360*c();return new es(r,E,k,"lch")}if(t==="rgb"){const r=255*c(),E=255*c(),k=255*c();return new es(r,E,k)}if(t==="lab"){const r=100*c(),E=256*c()-128,k=256*c()-128;return new es(r,E,k,"lab")}if(t==="grey"){const r=255*c();return new es(r,r,r)}throw new Error("Unsupported random color mode")}static test(t){return typeof t=="string"&&(gw.test(t)||mw.test(t))}cmyk(){const{_a:t,_b:a,_c:c}=this.rgb(),[f,_,v]=[t,a,c].map(E=>E/255),r=Math.min(1-f,1-_,1-v);return r===1?new es(0,0,0,1,"cmyk"):new es((1-f-r)/(1-r),(1-_-r)/(1-r),(1-v-r)/(1-r),r,"cmyk")}hsl(){const{_a:t,_b:a,_c:c}=this.rgb(),[f,_,v]=[t,a,c].map(O=>O/255),r=Math.max(f,_,v),E=Math.min(f,_,v),k=(r+E)/2,P=r===E,L=r-E;return new es(360*(P?0:r===f?((_-v)/L+(_<v?6:0))/6:r===_?((v-f)/L+2)/6:r===v?((f-_)/L+4)/6:0),100*(P?0:k>.5?L/(2-r-E):L/(r+E)),100*k,"hsl")}init(t=0,a=0,c=0,f=0,_="rgb"){if(t=t||0,this.space)for(const L in this.space)delete this[this.space[L]];if(typeof t=="number")_=typeof f=="string"?f:_,f=typeof f=="string"?0:f,Object.assign(this,{_a:t,_b:a,_c:c,_d:f,space:_});else if(t instanceof Array)this.space=a||(typeof t[3]=="string"?t[3]:t[4])||"rgb",Object.assign(this,{_a:t[0],_b:t[1],_c:t[2],_d:t[3]||0});else if(t instanceof Object){const L=function(O,N){const G=Pu(O,"rgb")?{_a:O.r,_b:O.g,_c:O.b,_d:0,space:"rgb"}:Pu(O,"xyz")?{_a:O.x,_b:O.y,_c:O.z,_d:0,space:"xyz"}:Pu(O,"hsl")?{_a:O.h,_b:O.s,_c:O.l,_d:0,space:"hsl"}:Pu(O,"lab")?{_a:O.l,_b:O.a,_c:O.b,_d:0,space:"lab"}:Pu(O,"lch")?{_a:O.l,_b:O.c,_c:O.h,_d:0,space:"lch"}:Pu(O,"cmyk")?{_a:O.c,_b:O.m,_c:O.y,_d:O.k,space:"cmyk"}:{_a:0,_b:0,_c:0,space:"rgb"};return G.space=N||G.space,G}(t,a);Object.assign(this,L)}else if(typeof t=="string")if(mw.test(t)){const L=t.replace(nE,""),[O,N,G]=iE.exec(L).slice(1,4).map(H=>parseInt(H));Object.assign(this,{_a:O,_b:N,_c:G,_d:0,space:"rgb"})}else{if(!gw.test(t))throw Error("Unsupported string format, can't construct Color");{const L=H=>parseInt(H,16),[,O,N,G]=tE.exec(function(H){return H.length===4?["#",H.substring(1,2),H.substring(1,2),H.substring(2,3),H.substring(2,3),H.substring(3,4),H.substring(3,4)].join(""):H}(t)).map(L);Object.assign(this,{_a:O,_b:N,_c:G,_d:0,space:"rgb"})}}const{_a:v,_b:r,_c:E,_d:k}=this,P=this.space==="rgb"?{r:v,g:r,b:E}:this.space==="xyz"?{x:v,y:r,z:E}:this.space==="hsl"?{h:v,s:r,l:E}:this.space==="lab"?{l:v,a:r,b:E}:this.space==="lch"?{l:v,c:r,h:E}:this.space==="cmyk"?{c:v,m:r,y:E,k}:{};Object.assign(this,P)}lab(){const{x:t,y:a,z:c}=this.xyz();return new es(116*a-16,500*(t-a),200*(a-c),"lab")}lch(){const{l:t,a,b:c}=this.lab(),f=Math.sqrt(a**2+c**2);let _=180*Math.atan2(c,a)/Math.PI;return _<0&&(_*=-1,_=360-_),new es(t,f,_,"lch")}rgb(){if(this.space==="rgb")return this;if((t=this.space)==="lab"||t==="xyz"||t==="lch"){let{x:a,y:c,z:f}=this;if(this.space==="lab"||this.space==="lch"){let{l:N,a:G,b:H}=this;if(this.space==="lch"){const{c:Te,h:Se}=this,Ie=Math.PI/180;G=Te*Math.cos(Ie*Se),H=Te*Math.sin(Ie*Se)}const Q=(N+16)/116,ee=G/500+Q,ie=Q-H/200,ue=16/116,ve=.008856,ce=7.787;a=.95047*(ee**3>ve?ee**3:(ee-ue)/ce),c=1*(Q**3>ve?Q**3:(Q-ue)/ce),f=1.08883*(ie**3>ve?ie**3:(ie-ue)/ce)}const _=3.2406*a+-1.5372*c+-.4986*f,v=-.9689*a+1.8758*c+.0415*f,r=.0557*a+-.204*c+1.057*f,E=Math.pow,k=.0031308,P=_>k?1.055*E(_,1/2.4)-.055:12.92*_,L=v>k?1.055*E(v,1/2.4)-.055:12.92*v,O=r>k?1.055*E(r,1/2.4)-.055:12.92*r;return new es(255*P,255*L,255*O)}if(this.space==="hsl"){let{h:a,s:c,l:f}=this;if(a/=360,c/=100,f/=100,c===0)return f*=255,new es(f,f,f);const _=f<.5?f*(1+c):f+c-f*c,v=2*f-_,r=255*xy(v,_,a+1/3),E=255*xy(v,_,a),k=255*xy(v,_,a-1/3);return new es(r,E,k)}if(this.space==="cmyk"){const{c:a,m:c,y:f,k:_}=this,v=255*(1-Math.min(1,a*(1-_)+_)),r=255*(1-Math.min(1,c*(1-_)+_)),E=255*(1-Math.min(1,f*(1-_)+_));return new es(v,r,E)}return this;var t}toArray(){const{_a:t,_b:a,_c:c,_d:f,space:_}=this;return[t,a,c,f,_]}toHex(){const[t,a,c]=this._clamped().map(oE);return`#${t}${a}${c}`}toRgb(){const[t,a,c]=this._clamped();return`rgb(${t},${a},${c})`}toString(){return this.toHex()}xyz(){const{_a:t,_b:a,_c:c}=this.rgb(),[f,_,v]=[t,a,c].map(Q=>Q/255),r=f>.04045?Math.pow((f+.055)/1.055,2.4):f/12.92,E=_>.04045?Math.pow((_+.055)/1.055,2.4):_/12.92,k=v>.04045?Math.pow((v+.055)/1.055,2.4):v/12.92,P=(.4124*r+.3576*E+.1805*k)/.95047,L=(.2126*r+.7152*E+.0722*k)/1,O=(.0193*r+.1192*E+.9505*k)/1.08883,N=P>.008856?Math.pow(P,1/3):7.787*P+16/116,G=L>.008856?Math.pow(L,1/3):7.787*L+16/116,H=O>.008856?Math.pow(O,1/3):7.787*O+16/116;return new es(N,G,H,"xyz")}_clamped(){const{_a:t,_b:a,_c:c}=this.rgb(),{max:f,min:_,round:v}=Math;return[t,a,c].map(r=>f(0,_(v(r),255)))}}class $r{constructor(...t){this.init(...t)}clone(){return new $r(this)}init(t,a){const _=Array.isArray(t)?{x:t[0],y:t[1]}:typeof t=="object"?{x:t.x,y:t.y}:{x:t,y:a};return this.x=_.x==null?0:_.x,this.y=_.y==null?0:_.y,this}toArray(){return[this.x,this.y]}transform(t){return this.clone().transformO(t)}transformO(t){Ni.isMatrixLike(t)||(t=new Ni(t));const{x:a,y:c}=this;return this.x=t.a*a+t.c*c+t.e,this.y=t.b*a+t.d*c+t.f,this}}function Lu(S,t,a){return Math.abs(t-S)<1e-6}class Ni{constructor(...t){this.init(...t)}static formatTransforms(t){const a=t.flip==="both"||t.flip===!0,c=t.flip&&(a||t.flip==="x")?-1:1,f=t.flip&&(a||t.flip==="y")?-1:1,_=t.skew&&t.skew.length?t.skew[0]:isFinite(t.skew)?t.skew:isFinite(t.skewX)?t.skewX:0,v=t.skew&&t.skew.length?t.skew[1]:isFinite(t.skew)?t.skew:isFinite(t.skewY)?t.skewY:0,r=t.scale&&t.scale.length?t.scale[0]*c:isFinite(t.scale)?t.scale*c:isFinite(t.scaleX)?t.scaleX*c:c,E=t.scale&&t.scale.length?t.scale[1]*f:isFinite(t.scale)?t.scale*f:isFinite(t.scaleY)?t.scaleY*f:f,k=t.shear||0,P=t.rotate||t.theta||0,L=new $r(t.origin||t.around||t.ox||t.originX,t.oy||t.originY),O=L.x,N=L.y,G=new $r(t.position||t.px||t.positionX||NaN,t.py||t.positionY||NaN),H=G.x,Q=G.y,ee=new $r(t.translate||t.tx||t.translateX,t.ty||t.translateY),ie=ee.x,ue=ee.y,ve=new $r(t.relative||t.rx||t.relativeX,t.ry||t.relativeY);return{scaleX:r,scaleY:E,skewX:_,skewY:v,shear:k,theta:P,rx:ve.x,ry:ve.y,tx:ie,ty:ue,ox:O,oy:N,px:H,py:Q}}static fromArray(t){return{a:t[0],b:t[1],c:t[2],d:t[3],e:t[4],f:t[5]}}static isMatrixLike(t){return t.a!=null||t.b!=null||t.c!=null||t.d!=null||t.e!=null||t.f!=null}static matrixMultiply(t,a,c){const f=t.a*a.a+t.c*a.b,_=t.b*a.a+t.d*a.b,v=t.a*a.c+t.c*a.d,r=t.b*a.c+t.d*a.d,E=t.e+t.a*a.e+t.c*a.f,k=t.f+t.b*a.e+t.d*a.f;return c.a=f,c.b=_,c.c=v,c.d=r,c.e=E,c.f=k,c}around(t,a,c){return this.clone().aroundO(t,a,c)}aroundO(t,a,c){const f=t||0,_=a||0;return this.translateO(-f,-_).lmultiplyO(c).translateO(f,_)}clone(){return new Ni(this)}decompose(t=0,a=0){const c=this.a,f=this.b,_=this.c,v=this.d,r=this.e,E=this.f,k=c*v-f*_,P=k>0?1:-1,L=P*Math.sqrt(c*c+f*f),O=Math.atan2(P*f,P*c),N=180/Math.PI*O,G=Math.cos(O),H=Math.sin(O),Q=(c*_+f*v)/k,ee=_*L/(Q*c-f)||v*L/(Q*f+c);return{scaleX:L,scaleY:ee,shear:Q,rotate:N,translateX:r-t+t*G*L+a*(Q*G*L-H*ee),translateY:E-a+t*H*L+a*(Q*H*L+G*ee),originX:t,originY:a,a:this.a,b:this.b,c:this.c,d:this.d,e:this.e,f:this.f}}equals(t){if(t===this)return!0;const a=new Ni(t);return Lu(this.a,a.a)&&Lu(this.b,a.b)&&Lu(this.c,a.c)&&Lu(this.d,a.d)&&Lu(this.e,a.e)&&Lu(this.f,a.f)}flip(t,a){return this.clone().flipO(t,a)}flipO(t,a){return t==="x"?this.scaleO(-1,1,a,0):t==="y"?this.scaleO(1,-1,0,a):this.scaleO(-1,-1,t,a||t)}init(t){const a=Ni.fromArray([1,0,0,1,0,0]);return t=t instanceof sn?t.matrixify():typeof t=="string"?Ni.fromArray(t.split(Xo).map(parseFloat)):Array.isArray(t)?Ni.fromArray(t):typeof t=="object"&&Ni.isMatrixLike(t)?t:typeof t=="object"?new Ni().transform(t):arguments.length===6?Ni.fromArray([].slice.call(arguments)):a,this.a=t.a!=null?t.a:a.a,this.b=t.b!=null?t.b:a.b,this.c=t.c!=null?t.c:a.c,this.d=t.d!=null?t.d:a.d,this.e=t.e!=null?t.e:a.e,this.f=t.f!=null?t.f:a.f,this}inverse(){return this.clone().inverseO()}inverseO(){const t=this.a,a=this.b,c=this.c,f=this.d,_=this.e,v=this.f,r=t*f-a*c;if(!r)throw new Error("Cannot invert "+this);const E=f/r,k=-a/r,P=-c/r,L=t/r,O=-(E*_+P*v),N=-(k*_+L*v);return this.a=E,this.b=k,this.c=P,this.d=L,this.e=O,this.f=N,this}lmultiply(t){return this.clone().lmultiplyO(t)}lmultiplyO(t){const a=t instanceof Ni?t:new Ni(t);return Ni.matrixMultiply(a,this,this)}multiply(t){return this.clone().multiplyO(t)}multiplyO(t){const a=t instanceof Ni?t:new Ni(t);return Ni.matrixMultiply(this,a,this)}rotate(t,a,c){return this.clone().rotateO(t,a,c)}rotateO(t,a=0,c=0){t=my(t);const f=Math.cos(t),_=Math.sin(t),{a:v,b:r,c:E,d:k,e:P,f:L}=this;return this.a=v*f-r*_,this.b=r*f+v*_,this.c=E*f-k*_,this.d=k*f+E*_,this.e=P*f-L*_+c*_-a*f+a,this.f=L*f+P*_-a*_-c*f+c,this}scale(){return this.clone().scaleO(...arguments)}scaleO(t,a=t,c=0,f=0){arguments.length===3&&(f=c,c=a,a=t);const{a:_,b:v,c:r,d:E,e:k,f:P}=this;return this.a=_*t,this.b=v*a,this.c=r*t,this.d=E*a,this.e=k*t-c*t+c,this.f=P*a-f*a+f,this}shear(t,a,c){return this.clone().shearO(t,a,c)}shearO(t,a=0,c=0){const{a:f,b:_,c:v,d:r,e:E,f:k}=this;return this.a=f+_*t,this.c=v+r*t,this.e=E+k*t-c*t,this}skew(){return this.clone().skewO(...arguments)}skewO(t,a=t,c=0,f=0){arguments.length===3&&(f=c,c=a,a=t),t=my(t),a=my(a);const _=Math.tan(t),v=Math.tan(a),{a:r,b:E,c:k,d:P,e:L,f:O}=this;return this.a=r+E*_,this.b=E+r*v,this.c=k+P*_,this.d=P+k*v,this.e=L+O*_-f*_,this.f=O+L*v-c*v,this}skewX(t,a,c){return this.skew(t,0,a,c)}skewY(t,a,c){return this.skew(0,t,a,c)}toArray(){return[this.a,this.b,this.c,this.d,this.e,this.f]}toString(){return"matrix("+this.a+","+this.b+","+this.c+","+this.d+","+this.e+","+this.f+")"}transform(t){if(Ni.isMatrixLike(t))return new Ni(t).multiplyO(this);const a=Ni.formatTransforms(t),{x:c,y:f}=new $r(a.ox,a.oy).transform(this),_=new Ni().translateO(a.rx,a.ry).lmultiplyO(this).translateO(-c,-f).scaleO(a.scaleX,a.scaleY).skewO(a.skewX,a.skewY).shearO(a.shear).rotateO(a.theta).translateO(c,f);if(isFinite(a.px)||isFinite(a.py)){const v=new $r(c,f).transform(_),r=isFinite(a.px)?a.px-v.x:0,E=isFinite(a.py)?a.py-v.y:0;_.translateO(r,E)}return _.translateO(a.tx,a.ty),_}translate(t,a){return this.clone().translateO(t,a)}translateO(t,a){return this.e+=t||0,this.f+=a||0,this}valueOf(){return{a:this.a,b:this.b,c:this.c,d:this.d,e:this.e,f:this.f}}}function Vl(){if(!Vl.nodes){const S=In().size(2,0);S.node.style.cssText=["opacity: 0","position: absolute","left: -100%","top: -100%","overflow: hidden"].join(";"),S.attr("focusable","false"),S.attr("aria-hidden","true");const t=S.path().node;Vl.nodes={svg:S,path:t}}if(!Vl.nodes.svg.node.parentNode){const S=Or.document.body||Or.document.documentElement;Vl.nodes.svg.addTo(S)}return Vl.nodes}function r1(S){return!(S.width||S.height||S.x||S.y)}Fr(Ni,"Matrix");class Cs{constructor(...t){this.init(...t)}addOffset(){return this.x+=Or.window.pageXOffset,this.y+=Or.window.pageYOffset,new Cs(this)}init(t){return t=typeof t=="string"?t.split(Xo).map(parseFloat):Array.isArray(t)?t:typeof t=="object"?[t.left!=null?t.left:t.x,t.top!=null?t.top:t.y,t.width,t.height]:arguments.length===4?[].slice.call(arguments):[0,0,0,0],this.x=t[0]||0,this.y=t[1]||0,this.width=this.w=t[2]||0,this.height=this.h=t[3]||0,this.x2=this.x+this.w,this.y2=this.y+this.h,this.cx=this.x+this.w/2,this.cy=this.y+this.h/2,this}isNulled(){return r1(this)}merge(t){const a=Math.min(this.x,t.x),c=Math.min(this.y,t.y),f=Math.max(this.x+this.width,t.x+t.width)-a,_=Math.max(this.y+this.height,t.y+t.height)-c;return new Cs(a,c,f,_)}toArray(){return[this.x,this.y,this.width,this.height]}toString(){return this.x+" "+this.y+" "+this.width+" "+this.height}transform(t){t instanceof Ni||(t=new Ni(t));let a=1/0,c=-1/0,f=1/0,_=-1/0;return[new $r(this.x,this.y),new $r(this.x2,this.y),new $r(this.x,this.y2),new $r(this.x2,this.y2)].forEach(function(v){v=v.transform(t),a=Math.min(a,v.x),c=Math.max(c,v.x),f=Math.min(f,v.y),_=Math.max(_,v.y)}),new Cs(a,f,c-a,_-f)}}function xw(S,t,a){let c;try{if(c=t(S.node),r1(c)&&(f=S.node)!==Or.document&&!(Or.document.documentElement.contains||function(_){for(;_.parentNode;)_=_.parentNode;return _===Or.document}).call(Or.document.documentElement,f))throw new Error("Element not in the dom")}catch{c=a(S)}var f;return c}gr({viewbox:{viewbox(S,t,a,c){return S==null?new Cs(this.attr("viewBox")):this.attr("viewBox",new Cs(S,t,a,c))},zoom(S,t){let{width:a,height:c}=this.attr(["width","height"]);if((a||c)&&typeof a!="string"&&typeof c!="string"||(a=this.node.clientWidth,c=this.node.clientHeight),!a||!c)throw new Error("Impossible to get absolute width and height. Please provide an absolute width and height attribute on the zooming element");const f=this.viewbox(),_=a/f.width,v=c/f.height,r=Math.min(_,v);if(S==null)return r;let E=r/S;E===1/0&&(E=Number.MAX_SAFE_INTEGER/100),t=t||new $r(a/2/_+f.x,c/2/v+f.y);const k=new Cs(f).transform(new Ni({scale:E,origin:t}));return this.viewbox(k)}}}),Fr(Cs,"Box");class Jc extends Array{constructor(t=[],...a){if(super(t,...a),typeof t=="number")return this;this.length=0,this.push(...t)}}Xi([Jc],{each(S,...t){return typeof S=="function"?this.map((a,c,f)=>S.call(a,a,c,f)):this.map(a=>a[S](...t))},toArray(){return Array.prototype.concat.apply([],this)}});const lE=["toArray","constructor","each"];function Qc(S,t){return new Jc(sx((t||Or.document).querySelectorAll(S),function(a){return ua(a)}))}Jc.extend=function(S){S=S.reduce((t,a)=>(lE.includes(a)||a[0]==="_"||(a in Array.prototype&&(t["$"+a]=Array.prototype[a]),t[a]=function(...c){return this.each(a,...c)}),t),{}),Xi([Jc],S)};let cE=0;const s1={};function n1(S){let t=S.getEventHolder();return t===Or.window&&(t=s1),t.events||(t.events={}),t.events}function cx(S){return S.getEventTarget()}function Go(S,t,a,c,f){const _=a.bind(c||S),v=In(S),r=n1(v),E=cx(v);t=Array.isArray(t)?t:t.split(Xo),a._svgjsListenerId||(a._svgjsListenerId=++cE),t.forEach(function(k){const P=k.split(".")[0],L=k.split(".")[1]||"*";r[P]=r[P]||{},r[P][L]=r[P][L]||{},r[P][L][a._svgjsListenerId]=_,E.addEventListener(P,_,f||!1)})}function da(S,t,a,c){const f=In(S),_=n1(f),v=cx(f);(typeof a!="function"||(a=a._svgjsListenerId))&&(t=Array.isArray(t)?t:(t||"").split(Xo)).forEach(function(r){const E=r&&r.split(".")[0],k=r&&r.split(".")[1];let P,L;if(a)_[E]&&_[E][k||"*"]&&(v.removeEventListener(E,_[E][k||"*"][a],c||!1),delete _[E][k||"*"][a]);else if(E&&k){if(_[E]&&_[E][k]){for(L in _[E][k])da(v,[E,k].join("."),L);delete _[E][k]}}else if(k)for(r in _)for(P in _[r])k===P&&da(v,[r,k].join("."));else if(E){if(_[E]){for(P in _[E])da(v,[E,P].join("."));delete _[E]}}else{for(r in _)da(v,r);(function(O){let N=O.getEventHolder();N===Or.window&&(N=s1),N.events&&(N.events={})})(f)}})}class Qf extends ax{addEventListener(){}dispatch(t,a,c){return function(f,_,v,r){const E=cx(f);return _ instanceof Or.window.Event||(_=new Or.window.CustomEvent(_,{detail:v,cancelable:!0,...r})),E.dispatchEvent(_),_}(this,t,a,c)}dispatchEvent(t){const a=this.getEventHolder().events;if(!a)return!0;const c=a[t.type];for(const f in c)for(const _ in c[f])c[f][_](t);return!t.defaultPrevented}fire(t,a,c){return this.dispatch(t,a,c),this}getEventHolder(){return this}getEventTarget(){return this}off(t,a,c){return da(this,t,a,c),this}on(t,a,c,f){return Go(this,t,a,c,f),this}removeEventListener(){}}function vw(){}Fr(Qf,"EventTarget");const vy=400,hE=">",uE=0,dE={"fill-opacity":1,"stroke-opacity":1,"stroke-width":0,"stroke-linejoin":"miter","stroke-linecap":"butt",fill:"#000000",stroke:"#000000",opacity:1,x:0,y:0,cx:0,cy:0,width:0,height:0,r:0,rx:0,ry:0,offset:0,"stop-opacity":1,"stop-color":"#000000","text-anchor":"start"};class Kc extends Array{constructor(...t){super(...t),this.init(...t)}clone(){return new this.constructor(this)}init(t){return typeof t=="number"||(this.length=0,this.push(...this.parse(t))),this}parse(t=[]){return t instanceof Array?t:t.trim().split(Xo).map(parseFloat)}toArray(){return Array.prototype.concat.apply([],this)}toSet(){return new Set(this)}toString(){return this.join(" ")}valueOf(){const t=[];return t.push(...this),t}}class hr{constructor(...t){this.init(...t)}convert(t){return new hr(this.value,t)}divide(t){return t=new hr(t),new hr(this/t,this.unit||t.unit)}init(t,a){return a=Array.isArray(t)?t[1]:a,t=Array.isArray(t)?t[0]:t,this.value=0,this.unit=a||"",typeof t=="number"?this.value=isNaN(t)?0:isFinite(t)?t:t<0?-34e37:34e37:typeof t=="string"?(a=t.match(i1))&&(this.value=parseFloat(a[1]),a[5]==="%"?this.value/=100:a[5]==="s"&&(this.value*=1e3),this.unit=a[5]):t instanceof hr&&(this.value=t.valueOf(),this.unit=t.unit),this}minus(t){return t=new hr(t),new hr(this-t,this.unit||t.unit)}plus(t){return t=new hr(t),new hr(this+t,this.unit||t.unit)}times(t){return t=new hr(t),new hr(this*t,this.unit||t.unit)}toArray(){return[this.value,this.unit]}toJSON(){return this.toString()}toString(){return(this.unit==="%"?~~(1e8*this.value)/1e6:this.unit==="s"?this.value/1e3:this.value)+this.unit}valueOf(){return this.value}}const fE=new Set(["fill","stroke","color","bgcolor","stop-color","flood-color","lighting-color"]),a1=[];class jl extends Qf{constructor(t,a){super(),this.node=t,this.type=t.nodeName,a&&t!==a&&this.attr(a)}add(t,a){return(t=In(t)).removeNamespace&&this.node instanceof Or.window.SVGElement&&t.removeNamespace(),a==null?this.node.appendChild(t.node):t.node!==this.node.childNodes[a]&&this.node.insertBefore(t.node,this.node.childNodes[a]),this}addTo(t,a){return In(t).put(this,a)}children(){return new Jc(sx(this.node.children,function(t){return ua(t)}))}clear(){for(;this.node.hasChildNodes();)this.node.removeChild(this.node.lastChild);return this}clone(t=!0,a=!0){this.writeDataToDom();let c=this.node.cloneNode(t);return a&&(c=t1(c)),new this.constructor(c)}each(t,a){const c=this.children();let f,_;for(f=0,_=c.length;f<_;f++)t.apply(c[f],[f,c]),a&&c[f].each(t,a);return this}element(t,a){return this.put(new jl(Wf(t),a))}first(){return ua(this.node.firstChild)}get(t){return ua(this.node.childNodes[t])}getEventHolder(){return this.node}getEventTarget(){return this.node}has(t){return this.index(t)>=0}html(t,a){return this.xml(t,a,"http://www.w3.org/1999/xhtml")}id(t){return t!==void 0||this.node.id||(this.node.id=e1(this.type)),this.attr("id",t)}index(t){return[].slice.call(this.node.childNodes).indexOf(t.node)}last(){return ua(this.node.lastChild)}matches(t){const a=this.node,c=a.matches||a.matchesSelector||a.msMatchesSelector||a.mozMatchesSelector||a.webkitMatchesSelector||a.oMatchesSelector||null;return c&&c.call(a,t)}parent(t){let a=this;if(!a.node.parentNode)return null;if(a=ua(a.node.parentNode),!t)return a;do if(typeof t=="string"?a.matches(t):a instanceof t)return a;while(a=ua(a.node.parentNode));return a}put(t,a){return t=In(t),this.add(t,a),t}putIn(t,a){return In(t).add(this,a)}remove(){return this.parent()&&this.parent().removeElement(this),this}removeElement(t){return this.node.removeChild(t.node),this}replace(t){return t=In(t),this.node.parentNode&&this.node.parentNode.replaceChild(t.node,this.node),t}round(t=2,a=null){const c=10**t,f=this.attr(a);for(const _ in f)typeof f[_]=="number"&&(f[_]=Math.round(f[_]*c)/c);return this.attr(f),this}svg(t,a){return this.xml(t,a,nx)}toString(){return this.id()}words(t){return this.node.textContent=t,this}wrap(t){const a=this.parent();if(!a)return this.addTo(t);const c=a.index(this);return a.put(t,c).put(this)}writeDataToDom(){return this.each(function(){this.writeDataToDom()}),this}xml(t,a,c){if(typeof t=="boolean"&&(c=a,a=t,t=null),t==null||typeof t=="function"){a=a==null||a,this.writeDataToDom();let r=this;if(t!=null){if(r=ua(r.node.cloneNode(!0)),a){const E=t(r);if(r=E||r,E===!1)return""}r.each(function(){const E=t(this),k=E||this;E===!1?this.remove():E&&this!==k&&this.replace(k)},!0)}return a?r.node.outerHTML:r.node.innerHTML}a=a!=null&&a;const f=Wf("wrapper",c),_=Or.document.createDocumentFragment();f.innerHTML=t;for(let r=f.children.length;r--;)_.appendChild(f.firstElementChild);const v=this.parent();return a?this.replace(_)&&v:this.add(_)}}Xi(jl,{attr:function(S,t,a){if(S==null){S={},t=this.node.attributes;for(const c of t)S[c.nodeName]=yw.test(c.nodeValue)?parseFloat(c.nodeValue):c.nodeValue;return S}if(S instanceof Array)return S.reduce((c,f)=>(c[f]=this.attr(f),c),{});if(typeof S=="object"&&S.constructor===Object)for(t in S)this.attr(t,S[t]);else if(t===null)this.node.removeAttribute(S);else{if(t==null)return(t=this.node.getAttribute(S))==null?dE[S]:yw.test(t)?parseFloat(t):t;typeof(t=a1.reduce((c,f)=>f(S,c,this),t))=="number"?t=new hr(t):fE.has(S)&&es.isColor(t)?t=new es(t):t.constructor===Array&&(t=new Kc(t)),S==="leading"?this.leading&&this.leading(t):typeof a=="string"?this.node.setAttributeNS(a,S,t.toString()):this.node.setAttribute(S,t.toString()),!this.rebuild||S!=="font-size"&&S!=="x"||this.rebuild()}return this},find:function(S){return Qc(S,this.node)},findOne:function(S){return ua(this.node.querySelector(S))}}),Fr(jl,"Dom");let sn=class extends jl{constructor(S,t){var a,c;super(S,t),this.dom={},this.node.instance=this,(S.hasAttribute("data-svgjs")||S.hasAttribute("svgjs:data"))&&this.setData((c=(a=JSON.parse(S.getAttribute("data-svgjs")))!=null?a:JSON.parse(S.getAttribute("svgjs:data")))!=null?c:{})}center(S,t){return this.cx(S).cy(t)}cx(S){return S==null?this.x()+this.width()/2:this.x(S-this.width()/2)}cy(S){return S==null?this.y()+this.height()/2:this.y(S-this.height()/2)}defs(){const S=this.root();return S&&S.defs()}dmove(S,t){return this.dx(S).dy(t)}dx(S=0){return this.x(new hr(S).plus(this.x()))}dy(S=0){return this.y(new hr(S).plus(this.y()))}getEventHolder(){return this}height(S){return this.attr("height",S)}move(S,t){return this.x(S).y(t)}parents(S=this.root()){const t=typeof S=="string";t||(S=In(S));const a=new Jc;let c=this;for(;(c=c.parent())&&c.node!==Or.document&&c.nodeName!=="#document-fragment"&&(a.push(c),t||c.node!==S.node)&&(!t||!c.matches(S));)if(c.node===this.root().node)return null;return a}reference(S){if(!(S=this.attr(S)))return null;const t=(S+"").match(rE);return t?In(t[1]):null}root(){const S=this.parent(function(t){return $c[t]}(ox));return S&&S.root()}setData(S){return this.dom=S,this}size(S,t){const a=Uu(this,S,t);return this.width(new hr(a.width)).height(new hr(a.height))}width(S){return this.attr("width",S)}writeDataToDom(){return Qw(this,this.dom),super.writeDataToDom()}x(S){return this.attr("x",S)}y(S){return this.attr("y",S)}};Xi(sn,{bbox:function(){const S=xw(this,t=>t.getBBox(),t=>{try{const a=t.clone().addTo(Vl().svg).show(),c=a.node.getBBox();return a.remove(),c}catch(a){throw new Error(`Getting bbox of element "${t.node.nodeName}" is not possible: ${a.toString()}`)}});return new Cs(S)},rbox:function(S){const t=xw(this,c=>c.getBoundingClientRect(),c=>{throw new Error(`Getting rbox of element "${c.node.nodeName}" is not possible`)}),a=new Cs(t);return S?a.transform(S.screenCTM().inverseO()):a.addOffset()},inside:function(S,t){const a=this.bbox();return S>a.x&&t>a.y&&S<a.x+a.width&&t<a.y+a.height},point:function(S,t){return new $r(S,t).transformO(this.screenCTM().inverseO())},ctm:function(){return new Ni(this.node.getCTM())},screenCTM:function(){try{if(typeof this.isRoot=="function"&&!this.isRoot()){const S=this.rect(1,1),t=S.node.getScreenCTM();return S.remove(),new Ni(t)}return new Ni(this.node.getScreenCTM())}catch{return console.warn(`Cannot get CTM from SVG node ${this.node.nodeName}. Is the element rendered?`),new Ni}}}),Fr(sn,"Element");const Vf={stroke:["color","width","opacity","linecap","linejoin","miterlimit","dasharray","dashoffset"],fill:["color","opacity","rule"],prefix:function(S,t){return t==="color"?S:S+"-"+t}};["fill","stroke"].forEach(function(S){const t={};let a;t[S]=function(c){if(c===void 0)return this.attr(S);if(typeof c=="string"||c instanceof es||es.isRgb(c)||c instanceof sn)this.attr(S,c);else for(a=Vf[S].length-1;a>=0;a--)c[Vf[S][a]]!=null&&this.attr(Vf.prefix(S,Vf[S][a]),c[Vf[S][a]]);return this},gr(["Element","Runner"],t)}),gr(["Element","Runner"],{matrix:function(S,t,a,c,f,_){return S==null?new Ni(this):this.attr("transform",new Ni(S,t,a,c,f,_))},rotate:function(S,t,a){return this.transform({rotate:S,ox:t,oy:a},!0)},skew:function(S,t,a,c){return arguments.length===1||arguments.length===3?this.transform({skew:S,ox:t,oy:a},!0):this.transform({skew:[S,t],ox:a,oy:c},!0)},shear:function(S,t,a){return this.transform({shear:S,ox:t,oy:a},!0)},scale:function(S,t,a,c){return arguments.length===1||arguments.length===3?this.transform({scale:S,ox:t,oy:a},!0):this.transform({scale:[S,t],ox:a,oy:c},!0)},translate:function(S,t){return this.transform({translate:[S,t]},!0)},relative:function(S,t){return this.transform({relative:[S,t]},!0)},flip:function(S="both",t="center"){return"xybothtrue".indexOf(S)===-1&&(t=S,S="both"),this.transform({flip:S,origin:t},!0)},opacity:function(S){return this.attr("opacity",S)}}),gr("radius",{radius:function(S,t=S){return(this._element||this).type==="radialGradient"?this.attr("r",new hr(S)):this.rx(S).ry(t)}}),gr("Path",{length:function(){return this.node.getTotalLength()},pointAt:function(S){return new $r(this.node.getPointAtLength(S))}}),gr(["Element","Runner"],{font:function(S,t){if(typeof S=="object"){for(t in S)this.font(t,S[t]);return this}return S==="leading"?this.leading(t):S==="anchor"?this.attr("text-anchor",t):S==="size"||S==="family"||S==="weight"||S==="stretch"||S==="variant"||S==="style"?this.attr("font-"+S,t):this.attr(S,t)}});gr("Element",["click","dblclick","mousedown","mouseup","mouseover","mouseout","mousemove","mouseenter","mouseleave","touchstart","touchmove","touchleave","touchend","touchcancel","contextmenu","wheel","pointerdown","pointermove","pointerup","pointerleave","pointercancel"].reduce(function(S,t){return S[t]=function(a){return a===null?this.off(t):this.on(t,a),this},S},{})),gr("Element",{untransform:function(){return this.attr("transform",null)},matrixify:function(){return(this.attr("transform")||"").split(sE).slice(0,-1).map(function(t){const a=t.trim().split("(");return[a[0],a[1].split(Xo).map(function(c){return parseFloat(c)})]}).reverse().reduce(function(t,a){return a[0]==="matrix"?t.lmultiply(Ni.fromArray(a[1])):t[a[0]].apply(t,a[1])},new Ni)},toParent:function(S,t){if(this===S)return this;if(Vy(this.node))return this.addTo(S,t);const a=this.screenCTM(),c=S.screenCTM().inverse();return this.addTo(S,t).untransform().transform(c.multiply(a)),this},toRoot:function(S){return this.toParent(this.root(),S)},transform:function(S,t){if(S==null||typeof S=="string"){const c=new Ni(this).decompose();return S==null?c:c[S]}Ni.isMatrixLike(S)||(S={...S,origin:Ny(S,this)});const a=new Ni(t===!0?this:t||!1).transform(S);return this.attr("transform",a)}});class kn extends sn{flatten(){return this.each(function(){if(this instanceof kn)return this.flatten().ungroup()}),this}ungroup(t=this.parent(),a=t.index(this)){return a=a===-1?t.children().length:a,this.each(function(c,f){return f[f.length-c-1].toParent(t,a)}),this.remove()}}Fr(kn,"Container");class dm extends kn{constructor(t,a=t){super(ss("defs",t),a)}flatten(){return this}ungroup(){return this}}Fr(dm,"Defs");class $n extends sn{}function hx(S){return this.attr("rx",S)}function ux(S){return this.attr("ry",S)}function o1(S){return S==null?this.cx()-this.rx():this.cx(S+this.rx())}function l1(S){return S==null?this.cy()-this.ry():this.cy(S+this.ry())}function c1(S){return this.attr("cx",S)}function h1(S){return this.attr("cy",S)}function u1(S){return S==null?2*this.rx():this.rx(new hr(S).divide(2))}function d1(S){return S==null?2*this.ry():this.ry(new hr(S).divide(2))}Fr($n,"Shape");var pE=Object.freeze({__proto__:null,cx:c1,cy:h1,height:d1,rx:hx,ry:ux,width:u1,x:o1,y:l1});class em extends $n{constructor(t,a=t){super(ss("ellipse",t),a)}size(t,a){const c=Uu(this,t,a);return this.rx(new hr(c.width).divide(2)).ry(new hr(c.height).divide(2))}}Xi(em,pE),gr("Container",{ellipse:rs(function(S=0,t=S){return this.put(new em).size(S,t).move(0,0)})}),Fr(em,"Ellipse");class f1 extends jl{constructor(t=Or.document.createDocumentFragment()){super(t)}xml(t,a,c){if(typeof t=="boolean"&&(c=a,a=t,t=null),t==null||typeof t=="function"){const f=new jl(Wf("wrapper",c));return f.add(this.node.cloneNode(!0)),f.xml(!1,c)}return super.xml(t,!1,c)}}function p1(S,t){return(this._element||this).type==="radialGradient"?this.attr({fx:new hr(S),fy:new hr(t)}):this.attr({x1:new hr(S),y1:new hr(t)})}function g1(S,t){return(this._element||this).type==="radialGradient"?this.attr({cx:new hr(S),cy:new hr(t)}):this.attr({x2:new hr(S),y2:new hr(t)})}Fr(f1,"Fragment");var gE=Object.freeze({__proto__:null,from:p1,to:g1});class jf extends kn{constructor(t,a){super(ss(t+"Gradient",typeof t=="string"?null:t),a)}attr(t,a,c){return t==="transform"&&(t="gradientTransform"),super.attr(t,a,c)}bbox(){return new Cs}targets(){return Qc("svg [fill*="+this.id()+"]")}toString(){return this.url()}update(t){return this.clear(),typeof t=="function"&&t.call(this,this),this}url(){return"url(#"+this.id()+")"}}Xi(jf,gE),gr({Container:{gradient(...S){return this.defs().gradient(...S)}},Defs:{gradient:rs(function(S,t){return this.put(new jf(S)).update(t)})}}),Fr(jf,"Gradient");class Gf extends kn{constructor(t,a=t){super(ss("pattern",t),a)}attr(t,a,c){return t==="transform"&&(t="patternTransform"),super.attr(t,a,c)}bbox(){return new Cs}targets(){return Qc("svg [fill*="+this.id()+"]")}toString(){return this.url()}update(t){return this.clear(),typeof t=="function"&&t.call(this,this),this}url(){return"url(#"+this.id()+")"}}gr({Container:{pattern(...S){return this.defs().pattern(...S)}},Defs:{pattern:rs(function(S,t,a){return this.put(new Gf).update(a).attr({x:0,y:0,width:S,height:t,patternUnits:"userSpaceOnUse"})})}}),Fr(Gf,"Pattern");let tm=class extends $n{constructor(S,t=S){super(ss("image",S),t)}load(S,t){if(!S)return this;const a=new Or.window.Image;return Go(a,"load",function(c){const f=this.parent(Gf);this.width()===0&&this.height()===0&&this.size(a.width,a.height),f instanceof Gf&&f.width()===0&&f.height()===0&&f.size(this.width(),this.height()),typeof t=="function"&&t.call(this,c)},this),Go(a,"load error",function(){da(a)}),this.attr("href",a.src=S,ju)}};var bw;bw=function(S,t,a){return S!=="fill"&&S!=="stroke"||aE.test(t)&&(t=a.root().defs().image(t)),t instanceof tm&&(t=a.root().defs().pattern(0,0,c=>{c.add(t)})),t},a1.push(bw),gr({Container:{image:rs(function(S,t){return this.put(new tm).size(0,0).load(S,t)})}}),Fr(tm,"Image");class Hl extends Kc{bbox(){let t=-1/0,a=-1/0,c=1/0,f=1/0;return this.forEach(function(_){t=Math.max(_[0],t),a=Math.max(_[1],a),c=Math.min(_[0],c),f=Math.min(_[1],f)}),new Cs(c,f,t-c,a-f)}move(t,a){const c=this.bbox();if(t-=c.x,a-=c.y,!isNaN(t)&&!isNaN(a))for(let f=this.length-1;f>=0;f--)this[f]=[this[f][0]+t,this[f][1]+a];return this}parse(t=[0,0]){const a=[];(t=t instanceof Array?Array.prototype.concat.apply([],t):t.trim().split(Xo).map(parseFloat)).length%2!=0&&t.pop();for(let c=0,f=t.length;c<f;c+=2)a.push([t[c],t[c+1]]);return a}size(t,a){let c;const f=this.bbox();for(c=this.length-1;c>=0;c--)f.width&&(this[c][0]=(this[c][0]-f.x)*t/f.width+f.x),f.height&&(this[c][1]=(this[c][1]-f.y)*a/f.height+f.y);return this}toLine(){return{x1:this[0][0],y1:this[0][1],x2:this[1][0],y2:this[1][1]}}toString(){const t=[];for(let a=0,c=this.length;a<c;a++)t.push(this[a].join(","));return t.join(" ")}transform(t){return this.clone().transformO(t)}transformO(t){Ni.isMatrixLike(t)||(t=new Ni(t));for(let a=this.length;a--;){const[c,f]=this[a];this[a][0]=t.a*c+t.c*f+t.e,this[a][1]=t.b*c+t.d*f+t.f}return this}}const mE=Hl;var dx=Object.freeze({__proto__:null,MorphArray:mE,height:function(S){const t=this.bbox();return S==null?t.height:this.size(t.width,S)},width:function(S){const t=this.bbox();return S==null?t.width:this.size(S,t.height)},x:function(S){return S==null?this.bbox().x:this.move(S,this.bbox().y)},y:function(S){return S==null?this.bbox().y:this.move(this.bbox().x,S)}});let Yc=class extends $n{constructor(S,t=S){super(ss("line",S),t)}array(){return new Hl([[this.attr("x1"),this.attr("y1")],[this.attr("x2"),this.attr("y2")]])}move(S,t){return this.attr(this.array().move(S,t).toLine())}plot(S,t,a,c){return S==null?this.array():(S=t!==void 0?{x1:S,y1:t,x2:a,y2:c}:new Hl(S).toLine(),this.attr(S))}size(S,t){const a=Uu(this,S,t);return this.attr(this.array().size(a.width,a.height).toLine())}};Xi(Yc,dx),gr({Container:{line:rs(function(...S){return Yc.prototype.plot.apply(this.put(new Yc),S[0]!=null?S:[0,0,0,0])})}}),Fr(Yc,"Line");let im=class extends kn{constructor(S,t=S){super(ss("marker",S),t)}height(S){return this.attr("markerHeight",S)}orient(S){return this.attr("orient",S)}ref(S,t){return this.attr("refX",S).attr("refY",t)}toString(){return"url(#"+this.id()+")"}update(S){return this.clear(),typeof S=="function"&&S.call(this,this),this}width(S){return this.attr("markerWidth",S)}};function Du(S,t){return function(a){return a==null?this[S]:(this[S]=a,t&&t.call(this),this)}}gr({Container:{marker(...S){return this.defs().marker(...S)}},Defs:{marker:rs(function(S,t,a){return this.put(new im).size(S,t).ref(S/2,t/2).viewbox(0,0,S,t).attr("orient","auto").update(a)})},marker:{marker(S,t,a,c){let f=["marker"];return S!=="all"&&f.push(S),f=f.join("-"),S=arguments[1]instanceof im?arguments[1]:this.defs().marker(t,a,c),this.attr(f,S)}}}),Fr(im,"Marker");const _E={"-":function(S){return S},"<>":function(S){return-Math.cos(S*Math.PI)/2+.5},">":function(S){return Math.sin(S*Math.PI/2)},"<":function(S){return 1-Math.cos(S*Math.PI/2)},bezier:function(S,t,a,c){return function(f){return f<0?S>0?t/S*f:a>0?c/a*f:0:f>1?a<1?(1-c)/(1-a)*f+(c-a)/(1-a):S<1?(1-t)/(1-S)*f+(t-S)/(1-S):1:3*f*(1-f)**2*t+3*f**2*(1-f)*c+f**3}},steps:function(S,t="end"){t=t.split("-").reverse()[0];let a=S;return t==="none"?--a:t==="both"&&++a,(c,f=!1)=>{let _=Math.floor(c*S);const v=c*_%1==0;return t!=="start"&&t!=="both"||++_,f&&v&&--_,c>=0&&_<0&&(_=0),c<=1&&_>a&&(_=a),_/a}}};class fx{done(){return!1}}class Uy extends fx{constructor(t=hE){super(),this.ease=_E[t]||t}step(t,a,c){return typeof t!="number"?c<1?t:a:t+(a-t)*this.ease(c)}}class cm extends fx{constructor(t){super(),this.stepper=t}done(t){return t.done}step(t,a,c,f){return this.stepper(t,a,c,f)}}function ww(){const S=(this._duration||500)/1e3,t=this._overshoot||0,a=Math.PI,c=Math.log(t/100+1e-10),f=-c/Math.sqrt(a*a+c*c),_=3.9/(f*S);this.d=2*f*_,this.k=_*_}Xi(class extends cm{constructor(S=500,t=0){super(),this.duration(S).overshoot(t)}step(S,t,a,c){if(typeof S=="string")return S;if(c.done=a===1/0,a===1/0)return t;if(a===0)return S;a>100&&(a=16),a/=1e3;const f=c.velocity||0,_=-this.d*f-this.k*(S-t),v=S+f*a+_*a*a/2;return c.velocity=f+_*a,c.done=Math.abs(t-v)+Math.abs(f)<.002,c.done?t:v}},{duration:Du("_duration",ww),overshoot:Du("_overshoot",ww)});Xi(class extends cm{constructor(S=.1,t=.01,a=0,c=1e3){super(),this.p(S).i(t).d(a).windup(c)}step(S,t,a,c){if(typeof S=="string")return S;if(c.done=a===1/0,a===1/0)return t;if(a===0)return S;const f=t-S;let _=(c.integral||0)+f*a;const v=(f-(c.error||0))/a,r=this._windup;return r!==!1&&(_=Math.max(-r,Math.min(_,r))),c.error=f,c.integral=_,c.done=Math.abs(f)<.001,c.done?t:S+(this.P*f+this.I*_+this.D*v)}},{windup:Du("_windup"),p:Du("P"),i:Du("I"),d:Du("D")});const yE={M:2,L:2,H:1,V:1,C:6,S:4,Q:4,T:2,A:7,Z:0},jy={M:function(S,t,a){return t.x=a.x=S[0],t.y=a.y=S[1],["M",t.x,t.y]},L:function(S,t){return t.x=S[0],t.y=S[1],["L",S[0],S[1]]},H:function(S,t){return t.x=S[0],["H",S[0]]},V:function(S,t){return t.y=S[0],["V",S[0]]},C:function(S,t){return t.x=S[4],t.y=S[5],["C",S[0],S[1],S[2],S[3],S[4],S[5]]},S:function(S,t){return t.x=S[2],t.y=S[3],["S",S[0],S[1],S[2],S[3]]},Q:function(S,t){return t.x=S[2],t.y=S[3],["Q",S[0],S[1],S[2],S[3]]},T:function(S,t){return t.x=S[0],t.y=S[1],["T",S[0],S[1]]},Z:function(S,t,a){return t.x=a.x,t.y=a.y,["Z"]},A:function(S,t){return t.x=S[5],t.y=S[6],["A",S[0],S[1],S[2],S[3],S[4],S[5],S[6]]}},by="mlhvqtcsaz".split("");for(let S=0,t=by.length;S<t;++S)jy[by[S]]=function(a){return function(c,f,_){if(a==="H")c[0]=c[0]+f.x;else if(a==="V")c[0]=c[0]+f.y;else if(a==="A")c[5]=c[5]+f.x,c[6]=c[6]+f.y;else for(let v=0,r=c.length;v<r;++v)c[v]=c[v]+(v%2?f.y:f.x);return jy[a](c,f,_)}}(by[S].toUpperCase());function Hy(S){return S.segment.length&&S.segment.length-1===yE[S.segment[0].toUpperCase()]}function xE(S,t){S.inNumber&&Wc(S,!1);const a=lx.test(t);if(a)S.segment=[t];else{const c=S.lastCommand,f=c.toLowerCase(),_=c===f;S.segment=[f==="m"?_?"l":"L":c]}return S.inSegment=!0,S.lastCommand=S.segment[0],a}function Wc(S,t){if(!S.inNumber)throw new Error("Parser Error");S.number&&S.segment.push(parseFloat(S.number)),S.inNumber=t,S.number="",S.pointSeen=!1,S.hasExponent=!1,Hy(S)&&Wy(S)}function Wy(S){S.inSegment=!1,S.absolute&&(S.segment=function(t){const a=t.segment[0];return jy[a](t.segment.slice(1),t.p,t.p0)}(S)),S.segments.push(S.segment)}function vE(S){if(!S.segment.length)return!1;const t=S.segment[0].toUpperCase()==="A",a=S.segment.length;return t&&(a===4||a===5)}function bE(S){return S.lastToken.toUpperCase()==="E"}const wE=new Set([" ",",","	",`
`,"\r","\f"]);class za extends Kc{bbox(){return Vl().path.setAttribute("d",this.toString()),new Cs(Vl.nodes.path.getBBox())}move(t,a){const c=this.bbox();if(t-=c.x,a-=c.y,!isNaN(t)&&!isNaN(a))for(let f,_=this.length-1;_>=0;_--)f=this[_][0],f==="M"||f==="L"||f==="T"?(this[_][1]+=t,this[_][2]+=a):f==="H"?this[_][1]+=t:f==="V"?this[_][1]+=a:f==="C"||f==="S"||f==="Q"?(this[_][1]+=t,this[_][2]+=a,this[_][3]+=t,this[_][4]+=a,f==="C"&&(this[_][5]+=t,this[_][6]+=a)):f==="A"&&(this[_][6]+=t,this[_][7]+=a);return this}parse(t="M0 0"){return Array.isArray(t)&&(t=Array.prototype.concat.apply([],t).toString()),function(a,c=!0){let f=0,_="";const v={segment:[],inNumber:!1,number:"",lastToken:"",inSegment:!1,segments:[],pointSeen:!1,hasExponent:!1,absolute:c,p0:new $r,p:new $r};for(;v.lastToken=_,_=a.charAt(f++);)if(v.inSegment||!xE(v,_))if(_!==".")if(isNaN(parseInt(_)))if(wE.has(_))v.inNumber&&Wc(v,!1);else if(_!=="-"&&_!=="+")if(_.toUpperCase()!=="E"){if(lx.test(_)){if(v.inNumber)Wc(v,!1);else{if(!Hy(v))throw new Error("parser Error");Wy(v)}--f}}else v.number+=_,v.hasExponent=!0;else{if(v.inNumber&&!bE(v)){Wc(v,!1),--f;continue}v.number+=_,v.inNumber=!0}else{if(v.number==="0"||vE(v)){v.inNumber=!0,v.number=_,Wc(v,!0);continue}v.inNumber=!0,v.number+=_}else{if(v.pointSeen||v.hasExponent){Wc(v,!1),--f;continue}v.inNumber=!0,v.pointSeen=!0,v.number+=_}return v.inNumber&&Wc(v,!1),v.inSegment&&Hy(v)&&Wy(v),v.segments}(t)}size(t,a){const c=this.bbox();let f,_;for(c.width=c.width===0?1:c.width,c.height=c.height===0?1:c.height,f=this.length-1;f>=0;f--)_=this[f][0],_==="M"||_==="L"||_==="T"?(this[f][1]=(this[f][1]-c.x)*t/c.width+c.x,this[f][2]=(this[f][2]-c.y)*a/c.height+c.y):_==="H"?this[f][1]=(this[f][1]-c.x)*t/c.width+c.x:_==="V"?this[f][1]=(this[f][1]-c.y)*a/c.height+c.y:_==="C"||_==="S"||_==="Q"?(this[f][1]=(this[f][1]-c.x)*t/c.width+c.x,this[f][2]=(this[f][2]-c.y)*a/c.height+c.y,this[f][3]=(this[f][3]-c.x)*t/c.width+c.x,this[f][4]=(this[f][4]-c.y)*a/c.height+c.y,_==="C"&&(this[f][5]=(this[f][5]-c.x)*t/c.width+c.x,this[f][6]=(this[f][6]-c.y)*a/c.height+c.y)):_==="A"&&(this[f][1]=this[f][1]*t/c.width,this[f][2]=this[f][2]*a/c.height,this[f][6]=(this[f][6]-c.x)*t/c.width+c.x,this[f][7]=(this[f][7]-c.y)*a/c.height+c.y);return this}toString(){return function(t){let a="";for(let c=0,f=t.length;c<f;c++)a+=t[c][0],t[c][1]!=null&&(a+=t[c][1],t[c][2]!=null&&(a+=" ",a+=t[c][2],t[c][3]!=null&&(a+=" ",a+=t[c][3],a+=" ",a+=t[c][4],t[c][5]!=null&&(a+=" ",a+=t[c][5],a+=" ",a+=t[c][6],t[c][7]!=null&&(a+=" ",a+=t[c][7])))));return a+" "}(this)}}const m1=S=>{const t=typeof S;return t==="number"?hr:t==="string"?es.isColor(S)?es:Xo.test(S)?lx.test(S)?za:Kc:i1.test(S)?hr:Gy:Xy.indexOf(S.constructor)>-1?S.constructor:Array.isArray(S)?Kc:t==="object"?Xf:Gy};class Gc{constructor(t){this._stepper=t||new Uy("-"),this._from=null,this._to=null,this._type=null,this._context=null,this._morphObj=null}at(t){return this._morphObj.morph(this._from,this._to,t,this._stepper,this._context)}done(){return this._context.map(this._stepper.done).reduce(function(t,a){return t&&a},!0)}from(t){return t==null?this._from:(this._from=this._set(t),this)}stepper(t){return t==null?this._stepper:(this._stepper=t,this)}to(t){return t==null?this._to:(this._to=this._set(t),this)}type(t){return t==null?this._type:(this._type=t,this)}_set(t){this._type||this.type(m1(t));let a=new this._type(t);return this._type===es&&(a=this._to?a[this._to[4]]():this._from?a[this._from[4]]():a),this._type===Xf&&(a=this._to?a.align(this._to):this._from?a.align(this._from):a),a=a.toConsumable(),this._morphObj=this._morphObj||new this._type,this._context=this._context||Array.apply(null,Array(a.length)).map(Object).map(function(c){return c.done=!0,c}),a}}class Gy{constructor(...t){this.init(...t)}init(t){return t=Array.isArray(t)?t[0]:t,this.value=t,this}toArray(){return[this.value]}valueOf(){return this.value}}class ep{constructor(...t){this.init(...t)}init(t){return Array.isArray(t)&&(t={scaleX:t[0],scaleY:t[1],shear:t[2],rotate:t[3],translateX:t[4],translateY:t[5],originX:t[6],originY:t[7]}),Object.assign(this,ep.defaults,t),this}toArray(){const t=this;return[t.scaleX,t.scaleY,t.shear,t.rotate,t.translateX,t.translateY,t.originX,t.originY]}}ep.defaults={scaleX:1,scaleY:1,shear:0,rotate:0,translateX:0,translateY:0,originX:0,originY:0};const SE=(S,t)=>S[0]<t[0]?-1:S[0]>t[0]?1:0;class Xf{constructor(...t){this.init(...t)}align(t){const a=this.values;for(let c=0,f=a.length;c<f;++c){if(a[c+1]===t[c+1]){if(a[c+1]===es&&t[c+7]!==a[c+7]){const r=t[c+7],E=new es(this.values.splice(c+3,5))[r]().toArray();this.values.splice(c+3,0,...E)}c+=a[c+2]+2;continue}if(!t[c+1])return this;const _=new t[c+1]().toArray(),v=a[c+2]+3;a.splice(c,v,t[c],t[c+1],t[c+2],..._),c+=a[c+2]+2}return this}init(t){if(this.values=[],Array.isArray(t))return void(this.values=t.slice());t=t||{};const a=[];for(const c in t){const f=m1(t[c]),_=new f(t[c]).toArray();a.push([c,f,_.length,..._])}return a.sort(SE),this.values=a.reduce((c,f)=>c.concat(f),[]),this}toArray(){return this.values}valueOf(){const t={},a=this.values;for(;a.length;){const c=a.shift(),f=a.shift(),_=a.shift(),v=a.splice(0,_);t[c]=new f(v)}return t}}const Xy=[Gy,ep,Xf];class Ou extends $n{constructor(t,a=t){super(ss("path",t),a)}array(){return this._array||(this._array=new za(this.attr("d")))}clear(){return delete this._array,this}height(t){return t==null?this.bbox().height:this.size(this.bbox().width,t)}move(t,a){return this.attr("d",this.array().move(t,a))}plot(t){return t==null?this.array():this.clear().attr("d",typeof t=="string"?t:this._array=new za(t))}size(t,a){const c=Uu(this,t,a);return this.attr("d",this.array().size(c.width,c.height))}width(t){return t==null?this.bbox().width:this.size(t,this.bbox().height)}x(t){return t==null?this.bbox().x:this.move(t,this.bbox().y)}y(t){return t==null?this.bbox().y:this.move(this.bbox().x,t)}}Ou.prototype.MorphArray=za,gr({Container:{path:rs(function(S){return this.put(new Ou).plot(S||new za)})}}),Fr(Ou,"Path");var _1=Object.freeze({__proto__:null,array:function(){return this._array||(this._array=new Hl(this.attr("points")))},clear:function(){return delete this._array,this},move:function(S,t){return this.attr("points",this.array().move(S,t))},plot:function(S){return S==null?this.array():this.clear().attr("points",typeof S=="string"?S:this._array=new Hl(S))},size:function(S,t){const a=Uu(this,S,t);return this.attr("points",this.array().size(a.width,a.height))}});class qc extends $n{constructor(t,a=t){super(ss("polygon",t),a)}}gr({Container:{polygon:rs(function(S){return this.put(new qc).plot(S||new Hl)})}}),Xi(qc,dx),Xi(qc,_1),Fr(qc,"Polygon");class Zc extends $n{constructor(t,a=t){super(ss("polyline",t),a)}}gr({Container:{polyline:rs(function(S){return this.put(new Zc).plot(S||new Hl)})}}),Xi(Zc,dx),Xi(Zc,_1),Fr(Zc,"Polyline");class rm extends $n{constructor(t,a=t){super(ss("rect",t),a)}}Xi(rm,{rx:hx,ry:ux}),gr({Container:{rect:rs(function(S,t){return this.put(new rm).size(S,t)})}}),Fr(rm,"Rect");class wy{constructor(){this._first=null,this._last=null}first(){return this._first&&this._first.value}last(){return this._last&&this._last.value}push(t){const a=t.next!==void 0?t:{value:t,next:null,prev:null};return this._last?(a.prev=this._last,this._last.next=a,this._last=a):(this._last=a,this._first=a),a}remove(t){t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),t===this._last&&(this._last=t.prev),t===this._first&&(this._first=t.next),t.prev=null,t.next=null}shift(){const t=this._first;return t?(this._first=t.next,this._first&&(this._first.prev=null),this._last=this._first?this._last:null,t.value):null}}const Jr={nextDraw:null,frames:new wy,timeouts:new wy,immediates:new wy,timer:()=>Or.window.performance||Or.window.Date,transforms:[],frame(S){const t=Jr.frames.push({run:S});return Jr.nextDraw===null&&(Jr.nextDraw=Or.window.requestAnimationFrame(Jr._draw)),t},timeout(S,t){t=t||0;const a=Jr.timer().now()+t,c=Jr.timeouts.push({run:S,time:a});return Jr.nextDraw===null&&(Jr.nextDraw=Or.window.requestAnimationFrame(Jr._draw)),c},immediate(S){const t=Jr.immediates.push(S);return Jr.nextDraw===null&&(Jr.nextDraw=Or.window.requestAnimationFrame(Jr._draw)),t},cancelFrame(S){S!=null&&Jr.frames.remove(S)},clearTimeout(S){S!=null&&Jr.timeouts.remove(S)},cancelImmediate(S){S!=null&&Jr.immediates.remove(S)},_draw(S){let t=null;const a=Jr.timeouts.last();for(;(t=Jr.timeouts.shift())&&(S>=t.time?t.run():Jr.timeouts.push(t),t!==a););let c=null;const f=Jr.frames.last();for(;c!==f&&(c=Jr.frames.shift());)c.run(S);let _=null;for(;_=Jr.immediates.shift();)_();Jr.nextDraw=Jr.timeouts.first()||Jr.frames.first()?Or.window.requestAnimationFrame(Jr._draw):null}},AE=function(S){const t=S.start,a=S.runner.duration();return{start:t,duration:a,end:t+a,runner:S.runner}},TE=function(){const S=Or.window;return(S.performance||S.Date).now()};class y1 extends Qf{constructor(t=TE){super(),this._timeSource=t,this.terminate()}active(){return!!this._nextFrame}finish(){return this.time(this.getEndTimeOfTimeline()+1),this.pause()}getEndTime(){const t=this.getLastRunnerInfo(),a=t?t.runner.duration():0;return(t?t.start:this._time)+a}getEndTimeOfTimeline(){const t=this._runners.map(a=>a.start+a.runner.duration());return Math.max(0,...t)}getLastRunnerInfo(){return this.getRunnerInfoById(this._lastRunnerId)}getRunnerInfoById(t){return this._runners[this._runnerIds.indexOf(t)]||null}pause(){return this._paused=!0,this._continue()}persist(t){return t==null?this._persist:(this._persist=t,this)}play(){return this._paused=!1,this.updateTime()._continue()}reverse(t){const a=this.speed();if(t==null)return this.speed(-a);const c=Math.abs(a);return this.speed(t?-c:c)}schedule(t,a,c){if(t==null)return this._runners.map(AE);let f=0;const _=this.getEndTime();if(a=a||0,c==null||c==="last"||c==="after")f=_;else if(c==="absolute"||c==="start")f=a,a=0;else if(c==="now")f=this._time;else if(c==="relative"){const E=this.getRunnerInfoById(t.id);E&&(f=E.start+a,a=0)}else{if(c!=="with-last")throw new Error('Invalid value for the "when" parameter');{const E=this.getLastRunnerInfo();f=E?E.start:this._time}}t.unschedule(),t.timeline(this);const v=t.persist(),r={persist:v===null?this._persist:v,start:f+a,runner:t};return this._lastRunnerId=t.id,this._runners.push(r),this._runners.sort((E,k)=>E.start-k.start),this._runnerIds=this._runners.map(E=>E.runner.id),this.updateTime()._continue(),this}seek(t){return this.time(this._time+t)}source(t){return t==null?this._timeSource:(this._timeSource=t,this)}speed(t){return t==null?this._speed:(this._speed=t,this)}stop(){return this.time(0),this.pause()}time(t){return t==null?this._time:(this._time=t,this._continue(!0))}unschedule(t){const a=this._runnerIds.indexOf(t.id);return a<0||(this._runners.splice(a,1),this._runnerIds.splice(a,1),t.timeline(null)),this}updateTime(){return this.active()||(this._lastSourceTime=this._timeSource()),this}_continue(t=!1){return Jr.cancelFrame(this._nextFrame),this._nextFrame=null,t?this._stepImmediate():(this._paused||(this._nextFrame=Jr.frame(this._step)),this)}_stepFn(t=!1){const a=this._timeSource();let c=a-this._lastSourceTime;t&&(c=0);const f=this._speed*c+(this._time-this._lastStepTime);this._lastSourceTime=a,t||(this._time+=f,this._time=this._time<0?0:this._time),this._lastStepTime=this._time,this.fire("time",this._time);for(let v=this._runners.length;v--;){const r=this._runners[v],E=r.runner;this._time-r.start<=0&&E.reset()}let _=!1;for(let v=0,r=this._runners.length;v<r;v++){const E=this._runners[v],k=E.runner;let P=f;const L=this._time-E.start;if(L<=0){_=!0;continue}L<P&&(P=L),k.active()&&(k.step(P).done?E.persist!==!0&&k.duration()-k.time()+this._time+E.persist<this._time&&(k.unschedule(),--v,--r):_=!0)}return _&&!(this._speed<0&&this._time===0)||this._runnerIds.length&&this._speed<0&&this._time>0?this._continue():(this.pause(),this.fire("finished")),this}terminate(){this._startTime=0,this._speed=1,this._persist=0,this._nextFrame=null,this._paused=!0,this._runners=[],this._runnerIds=[],this._lastRunnerId=-1,this._time=0,this._lastSourceTime=0,this._lastStepTime=0,this._step=this._stepFn.bind(this,!1),this._stepImmediate=this._stepFn.bind(this,!0)}}gr({Element:{timeline:function(S){return S==null?(this._timeline=this._timeline||new y1,this._timeline):(this._timeline=S,this)}}});class Zn extends Qf{constructor(t){super(),this.id=Zn.id++,t=typeof(t=t==null?vy:t)=="function"?new cm(t):t,this._element=null,this._timeline=null,this.done=!1,this._queue=[],this._duration=typeof t=="number"&&t,this._isDeclarative=t instanceof cm,this._stepper=this._isDeclarative?t:new Uy,this._history={},this.enabled=!0,this._time=0,this._lastTime=0,this._reseted=!0,this.transforms=new Ni,this.transformId=1,this._haveReversed=!1,this._reverse=!1,this._loopsDone=0,this._swing=!1,this._wait=0,this._times=1,this._frameId=null,this._persist=!!this._isDeclarative||null}static sanitise(t,a,c){var r,E,k,P,L;let f=1,_=!1,v=0;return a=a!=null?a:uE,c=c||"last",typeof(t=t!=null?t:vy)!="object"||t instanceof fx||(a=(r=t.delay)!=null?r:a,c=(E=t.when)!=null?E:c,_=t.swing||_,f=(k=t.times)!=null?k:f,v=(P=t.wait)!=null?P:v,t=(L=t.duration)!=null?L:vy),{duration:t,delay:a,swing:_,times:f,wait:v,when:c}}active(t){return t==null?this.enabled:(this.enabled=t,this)}addTransform(t){return this.transforms.lmultiplyO(t),this}after(t){return this.on("finished",t)}animate(t,a,c){const f=Zn.sanitise(t,a,c),_=new Zn(f.duration);return this._timeline&&_.timeline(this._timeline),this._element&&_.element(this._element),_.loop(f).schedule(f.delay,f.when)}clearTransform(){return this.transforms=new Ni,this}clearTransformsFromQueue(){this.done&&this._timeline&&this._timeline._runnerIds.includes(this.id)||(this._queue=this._queue.filter(t=>!t.isTransform))}delay(t){return this.animate(0,t)}duration(){return this._times*(this._wait+this._duration)-this._wait}during(t){return this.queue(null,t)}ease(t){return this._stepper=new Uy(t),this}element(t){return t==null?this._element:(this._element=t,t._prepareRunner(),this)}finish(){return this.step(1/0)}loop(t,a,c){return typeof t=="object"&&(a=t.swing,c=t.wait,t=t.times),this._times=t||1/0,this._swing=a||!1,this._wait=c||0,this._times===!0&&(this._times=1/0),this}loops(t){const a=this._duration+this._wait;if(t==null){const _=Math.floor(this._time/a),v=(this._time-_*a)/this._duration;return Math.min(_+v,this._times)}const c=t%1,f=a*Math.floor(t)+this._duration*c;return this.time(f)}persist(t){return t==null?this._persist:(this._persist=t,this)}position(t){const a=this._time,c=this._duration,f=this._wait,_=this._times,v=this._swing,r=this._reverse;let E;if(t==null){const L=function(N){const G=v*Math.floor(N%(2*(f+c))/(f+c)),H=G&&!r||!G&&r,Q=Math.pow(-1,H)*(N%(f+c))/c+H;return Math.max(Math.min(Q,1),0)},O=_*(f+c)-f;return E=a<=0?Math.round(L(1e-5)):a<O?L(a):Math.round(L(O-1e-5)),E}const k=Math.floor(this.loops()),P=v&&k%2==0;return E=k+(P&&!r||r&&P?t:1-t),this.loops(E)}progress(t){return t==null?Math.min(1,this._time/this.duration()):this.time(t*this.duration())}queue(t,a,c,f){return this._queue.push({initialiser:t||vw,runner:a||vw,retarget:c,isTransform:f,initialised:!1,finished:!1}),this.timeline()&&this.timeline()._continue(),this}reset(){return this._reseted||(this.time(0),this._reseted=!0),this}reverse(t){return this._reverse=t==null?!this._reverse:t,this}schedule(t,a,c){if(t instanceof y1||(c=a,a=t,t=this.timeline()),!t)throw Error("Runner cannot be scheduled without timeline");return t.schedule(this,a,c),this}step(t){if(!this.enabled)return this;t=t==null?16:t,this._time+=t;const a=this.position(),c=this._lastPosition!==a&&this._time>=0;this._lastPosition=a;const f=this.duration(),_=this._lastTime<=0&&this._time>0,v=this._lastTime<f&&this._time>=f;this._lastTime=this._time,_&&this.fire("start",this);const r=this._isDeclarative;this.done=!r&&!v&&this._time>=f,this._reseted=!1;let E=!1;return(c||r)&&(this._initialise(c),this.transforms=new Ni,E=this._run(r?t:a),this.fire("step",this)),this.done=this.done||E&&r,v&&this.fire("finished",this),this}time(t){if(t==null)return this._time;const a=t-this._time;return this.step(a),this}timeline(t){return t===void 0?this._timeline:(this._timeline=t,this)}unschedule(){const t=this.timeline();return t&&t.unschedule(this),this}_initialise(t){if(t||this._isDeclarative)for(let a=0,c=this._queue.length;a<c;++a){const f=this._queue[a],_=this._isDeclarative||!f.initialised&&t;t=!f.finished,_&&t&&(f.initialiser.call(this),f.initialised=!0)}}_rememberMorpher(t,a){if(this._history[t]={morpher:a,caller:this._queue[this._queue.length-1]},this._isDeclarative){const c=this.timeline();c&&c.play()}}_run(t){let a=!0;for(let c=0,f=this._queue.length;c<f;++c){const _=this._queue[c],v=_.runner.call(this,t);_.finished=_.finished||v===!0,a=a&&_.finished}return a}_tryRetarget(t,a,c){if(this._history[t]){if(!this._history[t].caller.initialised){const _=this._queue.indexOf(this._history[t].caller);return this._queue.splice(_,1),!1}this._history[t].caller.retarget?this._history[t].caller.retarget.call(this,a,c):this._history[t].morpher.to(a),this._history[t].caller.finished=!1;const f=this.timeline();return f&&f.play(),!0}return!1}}Zn.id=0;class hm{constructor(t=new Ni,a=-1,c=!0){this.transforms=t,this.id=a,this.done=c}clearTransformsFromQueue(){}}Xi([Zn,hm],{mergeWith(S){return new hm(S.transforms.lmultiply(this.transforms),S.id)}});const x1=(S,t)=>S.lmultiplyO(t),v1=S=>S.transforms;function EE(){const S=this._transformationRunners.runners.map(v1).reduce(x1,new Ni);this.transform(S),this._transformationRunners.merge(),this._transformationRunners.length()===1&&(this._frameId=null)}class CE{constructor(){this.runners=[],this.ids=[]}add(t){if(this.runners.includes(t))return;const a=t.id+1;return this.runners.push(t),this.ids.push(a),this}clearBefore(t){const a=this.ids.indexOf(t+1)||1;return this.ids.splice(0,a,0),this.runners.splice(0,a,new hm).forEach(c=>c.clearTransformsFromQueue()),this}edit(t,a){const c=this.ids.indexOf(t+1);return this.ids.splice(c,1,t+1),this.runners.splice(c,1,a),this}getByID(t){return this.runners[this.ids.indexOf(t+1)]}length(){return this.ids.length}merge(){let t=null;for(let a=0;a<this.runners.length;++a){const c=this.runners[a];if(t&&c.done&&t.done&&(!c._timeline||!c._timeline._runnerIds.includes(c.id))&&(!t._timeline||!t._timeline._runnerIds.includes(t.id))){this.remove(c.id);const f=c.mergeWith(t);this.edit(t.id,f),t=f,--a}else t=c}return this}remove(t){const a=this.ids.indexOf(t+1);return this.ids.splice(a,1),this.runners.splice(a,1),this}}gr({Element:{animate(S,t,a){const c=Zn.sanitise(S,t,a),f=this.timeline();return new Zn(c.duration).loop(c).element(this).timeline(f.play()).schedule(c.delay,c.when)},delay(S,t){return this.animate(0,S,t)},_clearTransformRunnersBefore(S){this._transformationRunners.clearBefore(S.id)},_currentTransform(S){return this._transformationRunners.runners.filter(t=>t.id<=S.id).map(v1).reduce(x1,new Ni)},_addRunner(S){this._transformationRunners.add(S),Jr.cancelImmediate(this._frameId),this._frameId=Jr.immediate(EE.bind(this))},_prepareRunner(){this._frameId==null&&(this._transformationRunners=new CE().add(new hm(new Ni(this))))}}});Xi(Zn,{attr(S,t){return this.styleAttr("attr",S,t)},css(S,t){return this.styleAttr("css",S,t)},styleAttr(S,t,a){if(typeof t=="string")return this.styleAttr(S,{[t]:a});let c=t;if(this._tryRetarget(S,c))return this;let f=new Gc(this._stepper).to(c),_=Object.keys(c);return this.queue(function(){f=f.from(this.element()[S](_))},function(v){return this.element()[S](f.at(v).valueOf()),f.done()},function(v){const r=Object.keys(v),E=(k=_,r.filter(L=>!k.includes(L)));var k;if(E.length){const L=this.element()[S](E),O=new Xf(f.from()).valueOf();Object.assign(O,L),f.from(O)}const P=new Xf(f.to()).valueOf();Object.assign(P,v),f.to(P),_=r,c=v}),this._rememberMorpher(S,f),this},zoom(S,t){if(this._tryRetarget("zoom",S,t))return this;let a=new Gc(this._stepper).to(new hr(S));return this.queue(function(){a=a.from(this.element().zoom())},function(c){return this.element().zoom(a.at(c),t),a.done()},function(c,f){t=f,a.to(c)}),this._rememberMorpher("zoom",a),this},transform(S,t,a){if(t=S.relative||t,this._isDeclarative&&!t&&this._tryRetarget("transform",S))return this;const c=Ni.isMatrixLike(S);a=S.affine!=null?S.affine:a!=null?a:!c;const f=new Gc(this._stepper).type(a?ep:Ni);let _,v,r,E,k;return this.queue(function(){v=v||this.element(),_=_||Ny(S,v),k=new Ni(t?void 0:v),v._addRunner(this),t||v._clearTransformRunnersBefore(this)},function(P){t||this.clearTransform();const{x:L,y:O}=new $r(_).transform(v._currentTransform(this));let N=new Ni({...S,origin:[L,O]}),G=this._isDeclarative&&r?r:k;if(a){N=N.decompose(L,O),G=G.decompose(L,O);const Q=N.rotate,ee=G.rotate,ie=[Q-360,Q,Q+360],ue=ie.map(Te=>Math.abs(Te-ee)),ve=Math.min(...ue),ce=ue.indexOf(ve);N.rotate=ie[ce]}t&&(c||(N.rotate=S.rotate||0),this._isDeclarative&&E&&(G.rotate=E)),f.from(G),f.to(N);const H=f.at(P);return E=H.rotate,r=new Ni(H),this.addTransform(r),v._addRunner(this),f.done()},function(P){(P.origin||"center").toString()!==(S.origin||"center").toString()&&(_=Ny(P,v)),S={...P,origin:_}},!0),this._isDeclarative&&this._rememberMorpher("transform",f),this},x(S){return this._queueNumber("x",S)},y(S){return this._queueNumber("y",S)},ax(S){return this._queueNumber("ax",S)},ay(S){return this._queueNumber("ay",S)},dx(S=0){return this._queueNumberDelta("x",S)},dy(S=0){return this._queueNumberDelta("y",S)},dmove(S,t){return this.dx(S).dy(t)},_queueNumberDelta(S,t){if(t=new hr(t),this._tryRetarget(S,t))return this;const a=new Gc(this._stepper).to(t);let c=null;return this.queue(function(){c=this.element()[S](),a.from(c),a.to(c+t)},function(f){return this.element()[S](a.at(f)),a.done()},function(f){a.to(c+new hr(f))}),this._rememberMorpher(S,a),this},_queueObject(S,t){if(this._tryRetarget(S,t))return this;const a=new Gc(this._stepper).to(t);return this.queue(function(){a.from(this.element()[S]())},function(c){return this.element()[S](a.at(c)),a.done()}),this._rememberMorpher(S,a),this},_queueNumber(S,t){return this._queueObject(S,new hr(t))},cx(S){return this._queueNumber("cx",S)},cy(S){return this._queueNumber("cy",S)},move(S,t){return this.x(S).y(t)},amove(S,t){return this.ax(S).ay(t)},center(S,t){return this.cx(S).cy(t)},size(S,t){let a;return S&&t||(a=this._element.bbox()),S||(S=a.width/a.height*t),t||(t=a.height/a.width*S),this.width(S).height(t)},width(S){return this._queueNumber("width",S)},height(S){return this._queueNumber("height",S)},plot(S,t,a,c){if(arguments.length===4)return this.plot([S,t,a,c]);if(this._tryRetarget("plot",S))return this;const f=new Gc(this._stepper).type(this._element.MorphArray).to(S);return this.queue(function(){f.from(this._element.array())},function(_){return this._element.plot(f.at(_)),f.done()}),this._rememberMorpher("plot",f),this},leading(S){return this._queueNumber("leading",S)},viewbox(S,t,a,c){return this._queueObject("viewbox",new Cs(S,t,a,c))},update(S){return typeof S!="object"?this.update({offset:arguments[0],color:arguments[1],opacity:arguments[2]}):(S.opacity!=null&&this.attr("stop-opacity",S.opacity),S.color!=null&&this.attr("stop-color",S.color),S.offset!=null&&this.attr("offset",S.offset),this)}}),Xi(Zn,{rx:hx,ry:ux,from:p1,to:g1}),Fr(Zn,"Runner");class Yy extends kn{constructor(t,a=t){super(ss("svg",t),a),this.namespace()}defs(){return this.isRoot()?ua(this.node.querySelector("defs"))||this.put(new dm):this.root().defs()}isRoot(){return!this.node.parentNode||!(this.node.parentNode instanceof Or.window.SVGElement)&&this.node.parentNode.nodeName!=="#document-fragment"}namespace(){return this.isRoot()?this.attr({xmlns:nx,version:"1.1"}).attr("xmlns:xlink",ju,_y):this.root().namespace()}removeNamespace(){return this.attr({xmlns:null,version:null}).attr("xmlns:xlink",null,_y).attr("xmlns:svgjs",null,_y)}root(){return this.isRoot()?this:super.root()}}gr({Container:{nested:rs(function(){return this.put(new Yy)})}}),Fr(Yy,"Svg",!0);let qy=class extends kn{constructor(S,t=S){super(ss("symbol",S),t)}};gr({Container:{symbol:rs(function(){return this.put(new qy)})}}),Fr(qy,"Symbol");var b1=Object.freeze({__proto__:null,amove:function(S,t){return this.ax(S).ay(t)},ax:function(S){return this.attr("x",S)},ay:function(S){return this.attr("y",S)},build:function(S){return this._build=!!S,this},center:function(S,t,a=this.bbox()){return this.cx(S,a).cy(t,a)},cx:function(S,t=this.bbox()){return S==null?t.cx:this.attr("x",this.attr("x")+S-t.cx)},cy:function(S,t=this.bbox()){return S==null?t.cy:this.attr("y",this.attr("y")+S-t.cy)},length:function(){return this.node.getComputedTextLength()},move:function(S,t,a=this.bbox()){return this.x(S,a).y(t,a)},plain:function(S){return this._build===!1&&this.clear(),this.node.appendChild(Or.document.createTextNode(S)),this},x:function(S,t=this.bbox()){return S==null?t.x:this.attr("x",this.attr("x")+S-t.x)},y:function(S,t=this.bbox()){return S==null?t.y:this.attr("y",this.attr("y")+S-t.y)}});class Ra extends $n{constructor(t,a=t){var c;super(ss("text",t),a),this.dom.leading=(c=this.dom.leading)!=null?c:new hr(1.3),this._rebuild=!0,this._build=!1}leading(t){return t==null?this.dom.leading:(this.dom.leading=new hr(t),this.rebuild())}rebuild(t){if(typeof t=="boolean"&&(this._rebuild=t),this._rebuild){const a=this;let c=0;const f=this.dom.leading;this.each(function(_){if(Vy(this.node))return;const v=Or.window.getComputedStyle(this.node).getPropertyValue("font-size"),r=f*new hr(v);this.dom.newLined&&(this.attr("x",a.attr("x")),this.text()===`
`?c+=r:(this.attr("dy",_?r+c:0),c=0))}),this.fire("rebuild")}return this}setData(t){return this.dom=t,this.dom.leading=new hr(t.leading||1.3),this}writeDataToDom(){return Qw(this,this.dom,{leading:1.3}),this}text(t){if(t===void 0){const a=this.node.childNodes;let c=0;t="";for(let f=0,_=a.length;f<_;++f)a[f].nodeName==="textPath"||Vy(a[f])?f===0&&(c=f+1):(f!==c&&a[f].nodeType!==3&&ua(a[f]).dom.newLined===!0&&(t+=`
`),t+=a[f].textContent);return t}if(this.clear().build(!0),typeof t=="function")t.call(this,this);else for(let a=0,c=(t=(t+"").split(`
`)).length;a<c;a++)this.newLine(t[a]);return this.build(!1).rebuild()}}Xi(Ra,b1),gr({Container:{text:rs(function(S=""){return this.put(new Ra).text(S)}),plain:rs(function(S=""){return this.put(new Ra).plain(S)})}}),Fr(Ra,"Text");class sm extends $n{constructor(t,a=t){super(ss("tspan",t),a),this._build=!1}dx(t){return this.attr("dx",t)}dy(t){return this.attr("dy",t)}newLine(){this.dom.newLined=!0;const t=this.parent();if(!(t instanceof Ra))return this;const a=t.index(this),c=Or.window.getComputedStyle(this.node).getPropertyValue("font-size"),f=t.dom.leading*new hr(c);return this.dy(a?f:0).attr("x",t.x())}text(t){return t==null?this.node.textContent+(this.dom.newLined?`
`:""):(typeof t=="function"?(this.clear().build(!0),t.call(this,this),this.build(!1)):this.plain(t),this)}}Xi(sm,b1),gr({Tspan:{tspan:rs(function(S=""){const t=new sm;return this._build||this.clear(),this.put(t).text(S)})},Text:{newLine:function(S=""){return this.tspan(S).newLine()}}}),Fr(sm,"Tspan");class Sy extends $n{constructor(t,a=t){super(ss("circle",t),a)}radius(t){return this.attr("r",t)}rx(t){return this.attr("r",t)}ry(t){return this.rx(t)}size(t){return this.radius(new hr(t).divide(2))}}Xi(Sy,{x:o1,y:l1,cx:c1,cy:h1,width:u1,height:d1}),gr({Container:{circle:rs(function(S=0){return this.put(new Sy).size(S).move(0,0)})}}),Fr(Sy,"Circle");class Ay extends kn{constructor(t,a=t){super(ss("clipPath",t),a)}remove(){return this.targets().forEach(function(t){t.unclip()}),super.remove()}targets(){return Qc("svg [clip-path*="+this.id()+"]")}}gr({Container:{clip:rs(function(){return this.defs().put(new Ay)})},Element:{clipper(){return this.reference("clip-path")},clipWith(S){const t=S instanceof Ay?S:this.parent().clip().add(S);return this.attr("clip-path","url(#"+t.id()+")")},unclip(){return this.attr("clip-path",null)}}}),Fr(Ay,"ClipPath");class Sw extends sn{constructor(t,a=t){super(ss("foreignObject",t),a)}}gr({Container:{foreignObject:rs(function(S,t){return this.put(new Sw).size(S,t)})}}),Fr(Sw,"ForeignObject");var w1=Object.freeze({__proto__:null,dmove:function(S,t){return this.children().forEach(a=>{let c;try{c=a.node instanceof Kf().SVGSVGElement?new Cs(a.attr(["x","y","width","height"])):a.bbox()}catch{return}const f=new Ni(a),_=f.translate(S,t).transform(f.inverse()),v=new $r(c.x,c.y).transform(_);a.move(v.x,v.y)}),this},dx:function(S){return this.dmove(S,0)},dy:function(S){return this.dmove(0,S)},height:function(S,t=this.bbox()){return S==null?t.height:this.size(t.width,S,t)},move:function(S=0,t=0,a=this.bbox()){const c=S-a.x,f=t-a.y;return this.dmove(c,f)},size:function(S,t,a=this.bbox()){const c=Uu(this,S,t,a),f=c.width/a.width,_=c.height/a.height;return this.children().forEach(v=>{const r=new $r(a).transform(new Ni(v).inverse());v.scale(f,_,r.x,r.y)}),this},width:function(S,t=this.bbox()){return S==null?t.width:this.size(S,t.height,t)},x:function(S,t=this.bbox()){return S==null?t.x:this.move(S,t.y,t)},y:function(S,t=this.bbox()){return S==null?t.y:this.move(t.x,S,t)}});class Ul extends kn{constructor(t,a=t){super(ss("g",t),a)}}Xi(Ul,w1),gr({Container:{group:rs(function(){return this.put(new Ul)})}}),Fr(Ul,"G");class $g extends kn{constructor(t,a=t){super(ss("a",t),a)}target(t){return this.attr("target",t)}to(t){return this.attr("href",t,ju)}}Xi($g,w1),gr({Container:{link:rs(function(S){return this.put(new $g).to(S)})},Element:{unlink(){const S=this.linker();if(!S)return this;const t=S.parent();if(!t)return this.remove();const a=t.index(S);return t.add(this,a),S.remove(),this},linkTo(S){let t=this.linker();return t||(t=new $g,this.wrap(t)),typeof S=="function"?S.call(t,t):t.to(S),this},linker(){const S=this.parent();return S&&S.node.nodeName.toLowerCase()==="a"?S:null}}}),Fr($g,"A");class Ty extends kn{constructor(t,a=t){super(ss("mask",t),a)}remove(){return this.targets().forEach(function(t){t.unmask()}),super.remove()}targets(){return Qc("svg [mask*="+this.id()+"]")}}gr({Container:{mask:rs(function(){return this.defs().put(new Ty)})},Element:{masker(){return this.reference("mask")},maskWith(S){const t=S instanceof Ty?S:this.parent().mask().add(S);return this.attr("mask","url(#"+t.id()+")")},unmask(){return this.attr("mask",null)}}}),Fr(Ty,"Mask");class Aw extends sn{constructor(t,a=t){super(ss("stop",t),a)}update(t){return(typeof t=="number"||t instanceof hr)&&(t={offset:arguments[0],color:arguments[1],opacity:arguments[2]}),t.opacity!=null&&this.attr("stop-opacity",t.opacity),t.color!=null&&this.attr("stop-color",t.color),t.offset!=null&&this.attr("offset",new hr(t.offset)),this}}gr({Gradient:{stop:function(S,t,a){return this.put(new Aw).update(S,t,a)}}}),Fr(Aw,"Stop");class Ey extends sn{constructor(t,a=t){super(ss("style",t),a)}addText(t=""){return this.node.textContent+=t,this}font(t,a,c={}){return this.rule("@font-face",{fontFamily:t,src:a,...c})}rule(t,a){return this.addText(function(c,f){if(!c)return"";if(!f)return c;let _=c+"{";for(const v in f)_+=v.replace(/([A-Z])/g,function(r,E){return"-"+E.toLowerCase()})+":"+f[v]+";";return _+="}",_}(t,a))}}gr("Dom",{style(S,t){return this.put(new Ey).rule(S,t)},fontface(S,t,a){return this.put(new Ey).font(S,t,a)}}),Fr(Ey,"Style");class Cy extends Ra{constructor(t,a=t){super(ss("textPath",t),a)}array(){const t=this.track();return t?t.array():null}plot(t){const a=this.track();let c=null;return a&&(c=a.plot(t)),t==null?c:this}track(){return this.reference("href")}}gr({Container:{textPath:rs(function(S,t){return S instanceof Ra||(S=this.text(S)),S.path(t)})},Text:{path:rs(function(S,t=!0){const a=new Cy;let c;if(S instanceof Ou||(S=this.defs().path(S)),a.attr("href","#"+S,ju),t)for(;c=this.node.firstChild;)a.node.appendChild(c);return this.put(a)}),textPath(){return this.findOne("textPath")}},Path:{text:rs(function(S){return S instanceof Ra||(S=new Ra().addTo(this.parent()).text(S)),S.path(this)}),targets(){return Qc("svg textPath").filter(S=>(S.attr("href")||"").includes(this.id()))}}}),Cy.prototype.MorphArray=za,Fr(Cy,"TextPath");class Tw extends $n{constructor(t,a=t){super(ss("use",t),a)}use(t,a){return this.attr("href",(a||"")+"#"+t,ju)}}gr({Container:{use:rs(function(S,t){return this.put(new Tw).use(S,t)})}}),Fr(Tw,"Use");const IE=In;Xi([Yy,qy,tm,Gf,im],Rn("viewbox")),Xi([Yc,Zc,qc,Ou],Rn("marker")),Xi(Ra,Rn("Text")),Xi(Ou,Rn("Path")),Xi(dm,Rn("Defs")),Xi([Ra,sm],Rn("Tspan")),Xi([rm,em,jf,Zn],Rn("radius")),Xi(Qf,Rn("EventTarget")),Xi(jl,Rn("Dom")),Xi(sn,Rn("Element")),Xi($n,Rn("Shape")),Xi([kn,f1],Rn("Container")),Xi(jf,Rn("Gradient")),Xi(Zn,Rn("Runner")),Jc.extend([...new Set(Jw)]),function(S=[]){Xy.push(...[].concat(S))}([hr,es,Cs,Ni,Kc,Hl,za,$r]),Xi(Xy,{to(S){return new Gc().type(this.constructor).from(this.toArray()).to(S)},fromArray(S){return this.init(S),this},toConsumable(){return this.toArray()},morph(S,t,a,c,f){return this.fromArray(S.map(function(_,v){return c.step(_,t[v],a,f[v],f)}))}});class ps extends sn{constructor(t){super(ss("filter",t),t),this.$source="SourceGraphic",this.$sourceAlpha="SourceAlpha",this.$background="BackgroundImage",this.$backgroundAlpha="BackgroundAlpha",this.$fill="FillPaint",this.$stroke="StrokePaint",this.$autoSetIn=!0}put(t,a){return!(t=super.put(t,a)).attr("in")&&this.$autoSetIn&&t.attr("in",this.$source),t.attr("result")||t.attr("result",t.id()),t}remove(){return this.targets().each("unfilter"),super.remove()}targets(){return Qc('svg [filter*="'+this.id()+'"]')}toString(){return"url(#"+this.id()+")"}}class px extends sn{constructor(t,a){super(t,a),this.result(this.id())}in(t){if(t==null){const a=this.attr("in");return this.parent()&&this.parent().find(`[result="${a}"]`)[0]||a}return this.attr("in",t)}result(t){return this.attr("result",t)}toString(){return this.result()}}const ha=S=>function(...t){for(let a=S.length;a--;)t[a]!=null&&this.attr(S[a],t[a])},kE={blend:ha(["in","in2","mode"]),colorMatrix:ha(["type","values"]),composite:ha(["in","in2","operator"]),convolveMatrix:function(S){S=new Kc(S).toString(),this.attr({order:Math.sqrt(S.split(" ").length),kernelMatrix:S})},diffuseLighting:ha(["surfaceScale","lightingColor","diffuseConstant","kernelUnitLength"]),displacementMap:ha(["in","in2","scale","xChannelSelector","yChannelSelector"]),dropShadow:ha(["in","dx","dy","stdDeviation"]),flood:ha(["flood-color","flood-opacity"]),gaussianBlur:function(S=0,t=S){this.attr("stdDeviation",S+" "+t)},image:function(S){this.attr("href",S,ju)},morphology:ha(["operator","radius"]),offset:ha(["dx","dy"]),specularLighting:ha(["surfaceScale","lightingColor","diffuseConstant","specularExponent","kernelUnitLength"]),tile:ha([]),turbulence:ha(["baseFrequency","numOctaves","seed","stitchTiles","type"])};["blend","colorMatrix","componentTransfer","composite","convolveMatrix","diffuseLighting","displacementMap","dropShadow","flood","gaussianBlur","image","merge","morphology","offset","specularLighting","tile","turbulence"].forEach(S=>{const t=Vu(S),a=kE[S];ps[t+"Effect"]=class extends px{constructor(c){super(ss("fe"+t,c),c)}update(c){return a.apply(this,c),this}},ps.prototype[S]=rs(function(c,...f){const _=new ps[t+"Effect"];return c==null?this.put(_):(typeof c=="function"?c.call(_,_):f.unshift(c),this.put(_).update(f))})}),Xi(ps,{merge(S){const t=this.put(new ps.MergeEffect);return typeof S=="function"?(S.call(t,t),t):((S instanceof Array?S:[...arguments]).forEach(a=>{a instanceof ps.MergeNode?t.put(a):t.mergeNode(a)}),t)},componentTransfer(S={}){const t=this.put(new ps.ComponentTransferEffect);if(typeof S=="function")return S.call(t,t),t;S.r||S.g||S.b||S.a||(S={r:S,g:S,b:S,a:S});for(const a in S)t.add(new ps["Func"+a.toUpperCase()](S[a]));return t}});["distantLight","pointLight","spotLight","mergeNode","FuncR","FuncG","FuncB","FuncA"].forEach(S=>{const t=Vu(S);ps[t]=class extends px{constructor(a){super(ss("fe"+t,a),a)}}});["funcR","funcG","funcB","funcA"].forEach(function(S){const t=ps[Vu(S)],a=rs(function(){return this.put(new t)});ps.ComponentTransferEffect.prototype[S]=a});["distantLight","pointLight","spotLight"].forEach(S=>{const t=ps[Vu(S)],a=rs(function(){return this.put(new t)});ps.DiffuseLightingEffect.prototype[S]=a,ps.SpecularLightingEffect.prototype[S]=a}),Xi(ps.MergeEffect,{mergeNode(S){return this.put(new ps.MergeNode).attr("in",S)}}),Xi(dm,{filter:function(S){const t=this.put(new ps);return typeof S=="function"&&S.call(t,t),t}}),Xi(kn,{filter:function(S){return this.defs().filter(S)}}),Xi(sn,{filterWith:function(S){const t=S instanceof ps?S:this.defs().filter(S);return this.attr("filter",t)},unfilter:function(S){return this.attr("filter",null)},filterer(){return this.reference("filter")}});const ME={blend:function(S,t){return this.parent()&&this.parent().blend(this,S,t)},colorMatrix:function(S,t){return this.parent()&&this.parent().colorMatrix(S,t).in(this)},componentTransfer:function(S){return this.parent()&&this.parent().componentTransfer(S).in(this)},composite:function(S,t){return this.parent()&&this.parent().composite(this,S,t)},convolveMatrix:function(S){return this.parent()&&this.parent().convolveMatrix(S).in(this)},diffuseLighting:function(S,t,a,c){return this.parent()&&this.parent().diffuseLighting(S,a,c).in(this)},displacementMap:function(S,t,a,c){return this.parent()&&this.parent().displacementMap(this,S,t,a,c)},dropShadow:function(S,t,a){return this.parent()&&this.parent().dropShadow(this,S,t,a).in(this)},flood:function(S,t){return this.parent()&&this.parent().flood(S,t)},gaussianBlur:function(S,t){return this.parent()&&this.parent().gaussianBlur(S,t).in(this)},image:function(S){return this.parent()&&this.parent().image(S)},merge:function(S){return S=S instanceof Array?S:[...S],this.parent()&&this.parent().merge(this,...S)},morphology:function(S,t){return this.parent()&&this.parent().morphology(S,t).in(this)},offset:function(S,t){return this.parent()&&this.parent().offset(S,t).in(this)},specularLighting:function(S,t,a,c,f){return this.parent()&&this.parent().specularLighting(S,a,c,f).in(this)},tile:function(){return this.parent()&&this.parent().tile().in(this)},turbulence:function(S,t,a,c,f){return this.parent()&&this.parent().turbulence(S,t,a,c,f).in(this)}};Xi(px,ME),Xi(ps.MergeEffect,{in:function(S){return S instanceof ps.MergeNode?this.add(S,0):this.add(new ps.MergeNode().in(S),0),this}}),Xi([ps.CompositeEffect,ps.BlendEffect,ps.DisplacementMapEffect],{in2:function(S){if(S==null){const t=this.attr("in2");return this.parent()&&this.parent().find(`[result="${t}"]`)[0]||t}return this.attr("in2",S)}}),ps.filter={sepiatone:[.343,.669,.119,0,0,.249,.626,.13,0,0,.172,.334,.111,0,0,0,0,0,1,0]};var rn=function(){function S(t){pi(this,S),this.ctx=t,this.w=t.w}return gi(S,[{key:"getDefaultFilter",value:function(t,a){var c=this.w;t.unfilter(!0),new ps().size("120%","180%","-5%","-40%"),c.config.chart.dropShadow.enabled&&this.dropShadow(t,c.config.chart.dropShadow,a)}},{key:"applyFilter",value:function(t,a,c){var f,_=this,v=this.w;if(t.unfilter(!0),c!=="none"){var r,E,k=v.config.chart.dropShadow,P=c==="lighten"?2:.3;t.filterWith(function(L){L.colorMatrix({type:"matrix",values:`
          `.concat(P,` 0 0 0 0
          0 `).concat(P,` 0 0 0
          0 0 `).concat(P,` 0 0
          0 0 0 1 0
        `),in:"SourceGraphic",result:"brightness"}),k.enabled&&_.addShadow(L,a,k,"brightness")}),!k.noUserSpaceOnUse&&((r=t.filterer())===null||r===void 0||(E=r.node)===null||E===void 0||E.setAttribute("filterUnits","userSpaceOnUse")),this._scaleFilterSize((f=t.filterer())===null||f===void 0?void 0:f.node)}else this.getDefaultFilter(t,a)}},{key:"addShadow",value:function(t,a,c,f){var _,v=this.w,r=c.blur,E=c.top,k=c.left,P=c.color,L=c.opacity;if(P=Array.isArray(P)?P[a]:P,((_=v.config.chart.dropShadow.enabledOnSeries)===null||_===void 0?void 0:_.length)>0&&v.config.chart.dropShadow.enabledOnSeries.indexOf(a)===-1)return t;t.offset({in:f,dx:k,dy:E,result:"offset"}),t.gaussianBlur({in:"offset",stdDeviation:r,result:"blur"}),t.flood({"flood-color":P,"flood-opacity":L,result:"flood"}),t.composite({in:"flood",in2:"blur",operator:"in",result:"shadow"}),t.merge(["shadow",f])}},{key:"dropShadow",value:function(t,a){var c,f,_,v,r,E=this,k=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,P=this.w;return t.unfilter(!0),et.isMsEdge()&&P.config.chart.type==="radialBar"||((c=P.config.chart.dropShadow.enabledOnSeries)===null||c===void 0?void 0:c.length)>0&&((_=P.config.chart.dropShadow.enabledOnSeries)===null||_===void 0?void 0:_.indexOf(k))===-1?t:(t.filterWith(function(L){E.addShadow(L,k,a,"SourceGraphic")}),a.noUserSpaceOnUse||(v=t.filterer())===null||v===void 0||(r=v.node)===null||r===void 0||r.setAttribute("filterUnits","userSpaceOnUse"),this._scaleFilterSize((f=t.filterer())===null||f===void 0?void 0:f.node),t)}},{key:"setSelectionFilter",value:function(t,a,c){var f=this.w;if(f.globals.selectedDataPoints[a]!==void 0&&f.globals.selectedDataPoints[a].indexOf(c)>-1){t.node.setAttribute("selected",!0);var _=f.config.states.active.filter;_!=="none"&&this.applyFilter(t,a,_.type)}}},{key:"_scaleFilterSize",value:function(t){t&&function(a){for(var c in a)a.hasOwnProperty(c)&&t.setAttribute(c,a[c])}({width:"200%",height:"200%",x:"-50%",y:"-50%"})}}]),S}(),Nt=function(){function S(t){pi(this,S),this.ctx=t,this.w=t.w}return gi(S,[{key:"roundPathCorners",value:function(t,a){function c(Ie,Ue,Ke){var qe=Ue.x-Ie.x,ft=Ue.y-Ie.y,bt=Math.sqrt(qe*qe+ft*ft);return f(Ie,Ue,Math.min(1,Ke/bt))}function f(Ie,Ue,Ke){return{x:Ie.x+(Ue.x-Ie.x)*Ke,y:Ie.y+(Ue.y-Ie.y)*Ke}}function _(Ie,Ue){Ie.length>2&&(Ie[Ie.length-2]=Ue.x,Ie[Ie.length-1]=Ue.y)}function v(Ie){return{x:parseFloat(Ie[Ie.length-2]),y:parseFloat(Ie[Ie.length-1])}}t.indexOf("NaN")>-1&&(t="");var r=t.split(/[,\s]/).reduce(function(Ie,Ue){var Ke=Ue.match(/^([a-zA-Z])(.+)/);return Ke?(Ie.push(Ke[1]),Ie.push(Ke[2])):Ie.push(Ue),Ie},[]).reduce(function(Ie,Ue){return parseFloat(Ue)==Ue&&Ie.length?Ie[Ie.length-1].push(Ue):Ie.push([Ue]),Ie},[]),E=[];if(r.length>1){var k=v(r[0]),P=null;r[r.length-1][0]=="Z"&&r[0].length>2&&(P=["L",k.x,k.y],r[r.length-1]=P),E.push(r[0]);for(var L=1;L<r.length;L++){var O=E[E.length-1],N=r[L],G=N==P?r[1]:r[L+1];if(G&&O&&O.length>2&&N[0]=="L"&&G.length>2&&G[0]=="L"){var H,Q,ee=v(O),ie=v(N),ue=v(G);H=c(ie,ee,a),Q=c(ie,ue,a),_(N,H),N.origPoint=ie,E.push(N);var ve=f(H,ie,.5),ce=f(ie,Q,.5),Te=["C",ve.x,ve.y,ce.x,ce.y,Q.x,Q.y];Te.origPoint=ie,E.push(Te)}else E.push(N)}if(P){var Se=v(E[E.length-1]);E.push(["Z"]),_(E[0],Se)}}else E=r;return E.reduce(function(Ie,Ue){return Ie+Ue.join(" ")+" "},"")}},{key:"drawLine",value:function(t,a,c,f){var _=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"#a8a8a8",v=arguments.length>5&&arguments[5]!==void 0?arguments[5]:0,r=arguments.length>6&&arguments[6]!==void 0?arguments[6]:null,E=arguments.length>7&&arguments[7]!==void 0?arguments[7]:"butt";return this.w.globals.dom.Paper.line().attr({x1:t,y1:a,x2:c,y2:f,stroke:_,"stroke-dasharray":v,"stroke-width":r,"stroke-linecap":E})}},{key:"drawRect",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,f=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,_=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0,v=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"#fefefe",r=arguments.length>6&&arguments[6]!==void 0?arguments[6]:1,E=arguments.length>7&&arguments[7]!==void 0?arguments[7]:null,k=arguments.length>8&&arguments[8]!==void 0?arguments[8]:null,P=arguments.length>9&&arguments[9]!==void 0?arguments[9]:0,L=this.w.globals.dom.Paper.rect();return L.attr({x:t,y:a,width:c>0?c:0,height:f>0?f:0,rx:_,ry:_,opacity:r,"stroke-width":E!==null?E:0,stroke:k!==null?k:"none","stroke-dasharray":P}),L.node.setAttribute("fill",v),L}},{key:"drawPolygon",value:function(t){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"#e1e1e1",c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,f=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"none";return this.w.globals.dom.Paper.polygon(t).attr({fill:f,stroke:a,"stroke-width":c})}},{key:"drawCircle",value:function(t){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;t<0&&(t=0);var c=this.w.globals.dom.Paper.circle(2*t);return a!==null&&c.attr(a),c}},{key:"drawPath",value:function(t){var a=t.d,c=a===void 0?"":a,f=t.stroke,_=f===void 0?"#a8a8a8":f,v=t.strokeWidth,r=v===void 0?1:v,E=t.fill,k=t.fillOpacity,P=k===void 0?1:k,L=t.strokeOpacity,O=L===void 0?1:L,N=t.classes,G=t.strokeLinecap,H=G===void 0?null:G,Q=t.strokeDashArray,ee=Q===void 0?0:Q,ie=this.w;return H===null&&(H=ie.config.stroke.lineCap),(c.indexOf("undefined")>-1||c.indexOf("NaN")>-1)&&(c="M 0 ".concat(ie.globals.gridHeight)),ie.globals.dom.Paper.path(c).attr({fill:E,"fill-opacity":P,stroke:_,"stroke-opacity":O,"stroke-linecap":H,"stroke-width":r,"stroke-dasharray":ee,class:N})}},{key:"group",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,a=this.w.globals.dom.Paper.group();return t!==null&&a.attr(t),a}},{key:"move",value:function(t,a){var c=["M",t,a].join(" ");return c}},{key:"line",value:function(t,a){var c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,f=null;return c===null?f=[" L",t,a].join(" "):c==="H"?f=[" H",t].join(" "):c==="V"&&(f=[" V",a].join(" ")),f}},{key:"curve",value:function(t,a,c,f,_,v){var r=["C",t,a,c,f,_,v].join(" ");return r}},{key:"quadraticCurve",value:function(t,a,c,f){return["Q",t,a,c,f].join(" ")}},{key:"arc",value:function(t,a,c,f,_,v,r){var E="A";arguments.length>7&&arguments[7]!==void 0&&arguments[7]&&(E="a");var k=[E,t,a,c,f,_,v,r].join(" ");return k}},{key:"renderPaths",value:function(t){var a,c=t.j,f=t.realIndex,_=t.pathFrom,v=t.pathTo,r=t.stroke,E=t.strokeWidth,k=t.strokeLinecap,P=t.fill,L=t.animationDelay,O=t.initialSpeed,N=t.dataChangeSpeed,G=t.className,H=t.chartType,Q=t.shouldClipToGrid,ee=Q===void 0||Q,ie=t.bindEventsOnPaths,ue=ie===void 0||ie,ve=t.drawShadow,ce=ve===void 0||ve,Te=this.w,Se=new rn(this.ctx),Ie=new Nu(this.ctx),Ue=this.w.config.chart.animations.enabled,Ke=Ue&&this.w.config.chart.animations.dynamicAnimation.enabled;if(_&&_.startsWith("M 0 0")&&v){var qe=v.match(/^M\s+[\d.-]+\s+[\d.-]+/);qe&&(_=_.replace(/^M\s+0\s+0/,qe[0]))}var ft=!!(Ue&&!Te.globals.resized||Ke&&Te.globals.dataChanged&&Te.globals.shouldAnimate);ft?a=_:(a=v,Te.globals.animationEnded=!0);var bt=Te.config.stroke.dashArray,Tt=0;Tt=Array.isArray(bt)?bt[f]:Te.config.stroke.dashArray;var Et=this.drawPath({d:a,stroke:r,strokeWidth:E,fill:P,fillOpacity:1,classes:G,strokeLinecap:k,strokeDashArray:Tt});Et.attr("index",f),ee&&(H==="bar"&&!Te.globals.isHorizontal||Te.globals.comboCharts?Et.attr({"clip-path":"url(#gridRectBarMask".concat(Te.globals.cuid,")")}):Et.attr({"clip-path":"url(#gridRectMask".concat(Te.globals.cuid,")")})),Te.config.chart.dropShadow.enabled&&ce&&Se.dropShadow(Et,Te.config.chart.dropShadow,f),ue&&(Et.node.addEventListener("mouseenter",this.pathMouseEnter.bind(this,Et)),Et.node.addEventListener("mouseleave",this.pathMouseLeave.bind(this,Et)),Et.node.addEventListener("mousedown",this.pathMouseDown.bind(this,Et))),Et.attr({pathTo:v,pathFrom:_});var Lt={el:Et,j:c,realIndex:f,pathFrom:_,pathTo:v,fill:P,strokeWidth:E,delay:L};return!Ue||Te.globals.resized||Te.globals.dataChanged?!Te.globals.resized&&Te.globals.dataChanged||Ie.showDelayedElements():Ie.animatePathsGradually(Jt(Jt({},Lt),{},{speed:O})),Te.globals.dataChanged&&Ke&&ft&&Ie.animatePathsGradually(Jt(Jt({},Lt),{},{speed:N})),Et}},{key:"drawPattern",value:function(t,a,c){var f=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"#a8a8a8",_=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0;return this.w.globals.dom.Paper.pattern(a,c,function(v){t==="horizontalLines"?v.line(0,0,c,0).stroke({color:f,width:_+1}):t==="verticalLines"?v.line(0,0,0,a).stroke({color:f,width:_+1}):t==="slantedLines"?v.line(0,0,a,c).stroke({color:f,width:_}):t==="squares"?v.rect(a,c).fill("none").stroke({color:f,width:_}):t==="circles"&&v.circle(a).fill("none").stroke({color:f,width:_})})}},{key:"drawGradient",value:function(t,a,c,f,_){var v,r=arguments.length>5&&arguments[5]!==void 0?arguments[5]:null,E=arguments.length>6&&arguments[6]!==void 0?arguments[6]:null,k=arguments.length>7&&arguments[7]!==void 0?arguments[7]:[],P=arguments.length>8&&arguments[8]!==void 0?arguments[8]:0,L=this.w;a.length<9&&a.indexOf("#")===0&&(a=et.hexToRgba(a,f)),c.length<9&&c.indexOf("#")===0&&(c=et.hexToRgba(c,_));var O=0,N=1,G=1,H=null;E!==null&&(O=E[0]!==void 0?E[0]/100:0,N=E[1]!==void 0?E[1]/100:1,G=E[2]!==void 0?E[2]/100:1,H=E[3]!==void 0?E[3]/100:null);var Q=!(L.config.chart.type!=="donut"&&L.config.chart.type!=="pie"&&L.config.chart.type!=="polarArea"&&L.config.chart.type!=="bubble");if(v=k&&k.length!==0?L.globals.dom.Paper.gradient(Q?"radial":"linear",function(ue){(Array.isArray(k[P])?k[P]:k).forEach(function(ve){ue.stop(ve.offset/100,ve.color,ve.opacity)})}):L.globals.dom.Paper.gradient(Q?"radial":"linear",function(ue){ue.stop(O,a,f),ue.stop(N,c,_),ue.stop(G,c,_),H!==null&&ue.stop(H,a,f)}),Q){var ee=L.globals.gridWidth/2,ie=L.globals.gridHeight/2;L.config.chart.type!=="bubble"?v.attr({gradientUnits:"userSpaceOnUse",cx:ee,cy:ie,r}):v.attr({cx:.5,cy:.5,r:.8,fx:.2,fy:.2})}else t==="vertical"?v.from(0,0).to(0,1):t==="diagonal"?v.from(0,0).to(1,1):t==="horizontal"?v.from(0,1).to(1,1):t==="diagonal2"&&v.from(1,0).to(0,1);return v}},{key:"getTextBasedOnMaxWidth",value:function(t){var a=t.text,c=t.maxWidth,f=t.fontSize,_=t.fontFamily,v=this.getTextRects(a,f,_),r=v.width/a.length,E=Math.floor(c/r);return c<v.width?a.slice(0,E-3)+"...":a}},{key:"drawText",value:function(t){var a=this,c=t.x,f=t.y,_=t.text,v=t.textAnchor,r=t.fontSize,E=t.fontFamily,k=t.fontWeight,P=t.foreColor,L=t.opacity,O=t.maxWidth,N=t.cssClass,G=N===void 0?"":N,H=t.isPlainText,Q=H===void 0||H,ee=t.dominantBaseline,ie=ee===void 0?"auto":ee,ue=this.w;_===void 0&&(_="");var ve=_;v||(v="start"),P&&P.length||(P=ue.config.chart.foreColor),E=E||ue.config.chart.fontFamily,k=k||"regular";var ce,Te={maxWidth:O,fontSize:r=r||"11px",fontFamily:E};return Array.isArray(_)?ce=ue.globals.dom.Paper.text(function(Se){for(var Ie=0;Ie<_.length;Ie++)ve=_[Ie],O&&(ve=a.getTextBasedOnMaxWidth(Jt({text:_[Ie]},Te))),Ie===0?Se.tspan(ve):Se.tspan(ve).newLine()}):(O&&(ve=this.getTextBasedOnMaxWidth(Jt({text:_},Te))),ce=Q?ue.globals.dom.Paper.plain(_):ue.globals.dom.Paper.text(function(Se){return Se.tspan(ve)})),ce.attr({x:c,y:f,"text-anchor":v,"dominant-baseline":ie,"font-size":r,"font-family":E,"font-weight":k,fill:P,class:"apexcharts-text "+G}),ce.node.style.fontFamily=E,ce.node.style.opacity=L,ce}},{key:"getMarkerPath",value:function(t,a,c,f){var _="";switch(c){case"cross":_="M ".concat(t-(f/=1.4)," ").concat(a-f," L ").concat(t+f," ").concat(a+f,"  M ").concat(t-f," ").concat(a+f," L ").concat(t+f," ").concat(a-f);break;case"plus":_="M ".concat(t-(f/=1.12)," ").concat(a," L ").concat(t+f," ").concat(a,"  M ").concat(t," ").concat(a-f," L ").concat(t," ").concat(a+f);break;case"star":case"sparkle":var v=5;f*=1.15,c==="sparkle"&&(f/=1.1,v=4);for(var r=Math.PI/v,E=0;E<=2*v;E++){var k=E*r,P=E%2==0?f:f/2;_+=(E===0?"M":"L")+(t+P*Math.sin(k))+","+(a-P*Math.cos(k))}_+="Z";break;case"triangle":_="M ".concat(t," ").concat(a-f,` 
             L `).concat(t+f," ").concat(a+f,` 
             L `).concat(t-f," ").concat(a+f,` 
             Z`);break;case"square":case"rect":_="M ".concat(t-(f/=1.125)," ").concat(a-f,` 
           L `).concat(t+f," ").concat(a-f,` 
           L `).concat(t+f," ").concat(a+f,` 
           L `).concat(t-f," ").concat(a+f,` 
           Z`);break;case"diamond":f*=1.05,_="M ".concat(t," ").concat(a-f,` 
             L `).concat(t+f," ").concat(a,` 
             L `).concat(t," ").concat(a+f,` 
             L `).concat(t-f," ").concat(a,` 
            Z`);break;case"line":_="M ".concat(t-(f/=1.1)," ").concat(a,` 
           L `).concat(t+f," ").concat(a);break;default:f*=2,_="M ".concat(t,", ").concat(a,` 
           m -`).concat(f/2,`, 0 
           a `).concat(f/2,",").concat(f/2," 0 1,0 ").concat(f,`,0 
           a `).concat(f/2,",").concat(f/2," 0 1,0 -").concat(f,",0")}return _}},{key:"drawMarkerShape",value:function(t,a,c,f,_){var v=this.drawPath({d:this.getMarkerPath(t,a,c,f,_),stroke:_.pointStrokeColor,strokeDashArray:_.pointStrokeDashArray,strokeWidth:_.pointStrokeWidth,fill:_.pointFillColor,fillOpacity:_.pointFillOpacity,strokeOpacity:_.pointStrokeOpacity});return v.attr({cx:t,cy:a,shape:_.shape,class:_.class?_.class:""}),v}},{key:"drawMarker",value:function(t,a,c){t=t||0;var f=c.pSize||0;return et.isNumber(a)||(f=0,a=0),this.drawMarkerShape(t,a,c==null?void 0:c.shape,f,Jt(Jt({},c),c.shape==="line"||c.shape==="plus"||c.shape==="cross"?{pointStrokeColor:c.pointFillColor,pointStrokeOpacity:c.pointFillOpacity}:{}))}},{key:"pathMouseEnter",value:function(t,a){var c=this.w,f=new rn(this.ctx),_=parseInt(t.node.getAttribute("index"),10),v=parseInt(t.node.getAttribute("j"),10);if(typeof c.config.chart.events.dataPointMouseEnter=="function"&&c.config.chart.events.dataPointMouseEnter(a,this.ctx,{seriesIndex:_,dataPointIndex:v,w:c}),this.ctx.events.fireEvent("dataPointMouseEnter",[a,this.ctx,{seriesIndex:_,dataPointIndex:v,w:c}]),(c.config.states.active.filter.type==="none"||t.node.getAttribute("selected")!=="true")&&c.config.states.hover.filter.type!=="none"&&!c.globals.isTouchDevice){var r=c.config.states.hover.filter;f.applyFilter(t,_,r.type)}}},{key:"pathMouseLeave",value:function(t,a){var c=this.w,f=new rn(this.ctx),_=parseInt(t.node.getAttribute("index"),10),v=parseInt(t.node.getAttribute("j"),10);typeof c.config.chart.events.dataPointMouseLeave=="function"&&c.config.chart.events.dataPointMouseLeave(a,this.ctx,{seriesIndex:_,dataPointIndex:v,w:c}),this.ctx.events.fireEvent("dataPointMouseLeave",[a,this.ctx,{seriesIndex:_,dataPointIndex:v,w:c}]),c.config.states.active.filter.type!=="none"&&t.node.getAttribute("selected")==="true"||c.config.states.hover.filter.type!=="none"&&f.getDefaultFilter(t,_)}},{key:"pathMouseDown",value:function(t,a){var c=this.w,f=new rn(this.ctx),_=parseInt(t.node.getAttribute("index"),10),v=parseInt(t.node.getAttribute("j"),10),r="false";if(t.node.getAttribute("selected")==="true"){if(t.node.setAttribute("selected","false"),c.globals.selectedDataPoints[_].indexOf(v)>-1){var E=c.globals.selectedDataPoints[_].indexOf(v);c.globals.selectedDataPoints[_].splice(E,1)}}else{if(!c.config.states.active.allowMultipleDataPointsSelection&&c.globals.selectedDataPoints.length>0){c.globals.selectedDataPoints=[];var k=c.globals.dom.Paper.find(".apexcharts-series path:not(.apexcharts-decoration-element)"),P=c.globals.dom.Paper.find(".apexcharts-series circle:not(.apexcharts-decoration-element), .apexcharts-series rect:not(.apexcharts-decoration-element)"),L=function(G){Array.prototype.forEach.call(G,function(H){H.node.setAttribute("selected","false"),f.getDefaultFilter(H,_)})};L(k),L(P)}t.node.setAttribute("selected","true"),r="true",c.globals.selectedDataPoints[_]===void 0&&(c.globals.selectedDataPoints[_]=[]),c.globals.selectedDataPoints[_].push(v)}if(r==="true"){var O=c.config.states.active.filter;if(O!=="none")f.applyFilter(t,_,O.type);else if(c.config.states.hover.filter!=="none"&&!c.globals.isTouchDevice){var N=c.config.states.hover.filter;f.applyFilter(t,_,N.type)}}else c.config.states.active.filter.type!=="none"&&(c.config.states.hover.filter.type==="none"||c.globals.isTouchDevice?f.getDefaultFilter(t,_):(N=c.config.states.hover.filter,f.applyFilter(t,_,N.type)));typeof c.config.chart.events.dataPointSelection=="function"&&c.config.chart.events.dataPointSelection(a,this.ctx,{selectedDataPoints:c.globals.selectedDataPoints,seriesIndex:_,dataPointIndex:v,w:c}),a&&this.ctx.events.fireEvent("dataPointSelection",[a,this.ctx,{selectedDataPoints:c.globals.selectedDataPoints,seriesIndex:_,dataPointIndex:v,w:c}])}},{key:"rotateAroundCenter",value:function(t){var a={};return t&&typeof t.getBBox=="function"&&(a=t.getBBox()),{x:a.x+a.width/2,y:a.y+a.height/2}}},{key:"getTextRects",value:function(t,a,c,f){var _=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4],v=this.w,r=this.drawText({x:-200,y:-200,text:t,textAnchor:"start",fontSize:a,fontFamily:c,foreColor:"#fff",opacity:0});f&&r.attr("transform",f),v.globals.dom.Paper.add(r);var E=r.bbox();return _||(E=r.node.getBoundingClientRect()),r.remove(),{width:E.width,height:E.height}}},{key:"placeTextWithEllipsis",value:function(t,a,c){if(typeof t.getComputedTextLength=="function"&&(t.textContent=a,a.length>0&&t.getComputedTextLength()>=c/1.1)){for(var f=a.length-3;f>0;f-=3)if(t.getSubStringLength(0,f)<=c/1.1)return void(t.textContent=a.substring(0,f)+"...");t.textContent="."}}}],[{key:"setAttrs",value:function(t,a){for(var c in a)a.hasOwnProperty(c)&&t.setAttribute(c,a[c])}}]),S}(),Is=function(){function S(t){pi(this,S),this.ctx=t,this.w=t.w}return gi(S,[{key:"getStackedSeriesTotals",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],a=this.w,c=[];if(a.globals.series.length===0)return c;for(var f=0;f<a.globals.series[a.globals.maxValsInArrayIndex].length;f++){for(var _=0,v=0;v<a.globals.series.length;v++)a.globals.series[v][f]!==void 0&&t.indexOf(v)===-1&&(_+=a.globals.series[v][f]);c.push(_)}return c}},{key:"getSeriesTotalByIndex",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return t===null?this.w.config.series.reduce(function(a,c){return a+c},0):this.w.globals.series[t].reduce(function(a,c){return a+c},0)}},{key:"getStackedSeriesTotalsByGroups",value:function(){var t=this,a=this.w,c=[];return a.globals.seriesGroups.forEach(function(f){var _=[];a.config.series.forEach(function(r,E){f.indexOf(a.globals.seriesNames[E])>-1&&_.push(E)});var v=a.globals.series.map(function(r,E){return _.indexOf(E)===-1?E:-1}).filter(function(r){return r!==-1});c.push(t.getStackedSeriesTotals(v))}),c}},{key:"setSeriesYAxisMappings",value:function(){var t=this.w.globals,a=this.w.config,c=[],f=[],_=[],v=t.series.length>a.yaxis.length||a.yaxis.some(function(L){return Array.isArray(L.seriesName)});a.series.forEach(function(L,O){_.push(O),f.push(null)}),a.yaxis.forEach(function(L,O){c[O]=[]});var r=[];a.yaxis.forEach(function(L,O){var N=!1;if(L.seriesName){var G=[];Array.isArray(L.seriesName)?G=L.seriesName:G.push(L.seriesName),G.forEach(function(H){a.series.forEach(function(Q,ee){if(Q.name===H){var ie=ee;O===ee||v?!v||_.indexOf(ee)>-1?c[O].push([O,ee]):console.warn("Series '"+Q.name+"' referenced more than once in what looks like the new style. That is, when using either seriesName: [], or when there are more series than yaxes."):(c[ee].push([ee,O]),ie=O),N=!0,(ie=_.indexOf(ie))!==-1&&_.splice(ie,1)}})})}N||r.push(O)}),c=c.map(function(L,O){var N=[];return L.forEach(function(G){f[G[1]]=G[0],N.push(G[1])}),N});for(var E=a.yaxis.length-1,k=0;k<r.length&&(E=r[k],c[E]=[],_);k++){var P=_[0];_.shift(),c[E].push(P),f[P]=E}_.forEach(function(L){c[E].push(L),f[L]=E}),t.seriesYAxisMap=c.map(function(L){return L}),t.seriesYAxisReverseMap=f.map(function(L){return L}),t.seriesYAxisMap.forEach(function(L,O){L.forEach(function(N){a.series[N]&&a.series[N].group===void 0&&(a.series[N].group="apexcharts-axis-".concat(O.toString()))})})}},{key:"isSeriesNull",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return(t===null?this.w.config.series.filter(function(a){return a!==null}):this.w.config.series[t].data.filter(function(a){return a!==null})).length===0}},{key:"seriesHaveSameValues",value:function(t){return this.w.globals.series[t].every(function(a,c,f){return a===f[0]})}},{key:"getCategoryLabels",value:function(t){var a=this.w,c=t.slice();return a.config.xaxis.convertedCatToNumeric&&(c=t.map(function(f,_){return a.config.xaxis.labels.formatter(f-a.globals.minX+1)})),c}},{key:"getLargestSeries",value:function(){var t=this.w;t.globals.maxValsInArrayIndex=t.globals.series.map(function(a){return a.length}).indexOf(Math.max.apply(Math,t.globals.series.map(function(a){return a.length})))}},{key:"getLargestMarkerSize",value:function(){var t=this.w,a=0;return t.globals.markers.size.forEach(function(c){a=Math.max(a,c)}),t.config.markers.discrete&&t.config.markers.discrete.length&&t.config.markers.discrete.forEach(function(c){a=Math.max(a,c.size)}),a>0&&(t.config.markers.hover.size>0?a=t.config.markers.hover.size:a+=t.config.markers.hover.sizeOffset),t.globals.markers.largestSize=a,a}},{key:"getSeriesTotals",value:function(){var t=this.w;t.globals.seriesTotals=t.globals.series.map(function(a,c){var f=0;if(Array.isArray(a))for(var _=0;_<a.length;_++)f+=a[_];else f+=a;return f})}},{key:"getSeriesTotalsXRange",value:function(t,a){var c=this.w;return c.globals.series.map(function(f,_){for(var v=0,r=0;r<f.length;r++)c.globals.seriesX[_][r]>t&&c.globals.seriesX[_][r]<a&&(v+=f[r]);return v})}},{key:"getPercentSeries",value:function(){var t=this.w;t.globals.seriesPercent=t.globals.series.map(function(a,c){var f=[];if(Array.isArray(a))for(var _=0;_<a.length;_++){var v=t.globals.stackedSeriesTotals[_],r=0;v&&(r=100*a[_]/v),f.push(r)}else{var E=100*a/t.globals.seriesTotals.reduce(function(k,P){return k+P},0);f.push(E)}return f})}},{key:"getCalculatedRatios",value:function(){var t,a,c,f=this,_=this.w,v=_.globals,r=[],E=0,k=[],P=.1,L=0;if(v.yRange=[],v.isMultipleYAxis)for(var O=0;O<v.minYArr.length;O++)v.yRange.push(Math.abs(v.minYArr[O]-v.maxYArr[O])),k.push(0);else v.yRange.push(Math.abs(v.minY-v.maxY));v.xRange=Math.abs(v.maxX-v.minX),v.zRange=Math.abs(v.maxZ-v.minZ);for(var N=0;N<v.yRange.length;N++)r.push(v.yRange[N]/v.gridHeight);if(a=v.xRange/v.gridWidth,t=v.yRange/v.gridWidth,c=v.xRange/v.gridHeight,(E=v.zRange/v.gridHeight*16)||(E=1),v.minY!==Number.MIN_VALUE&&Math.abs(v.minY)!==0&&(v.hasNegs=!0),_.globals.seriesYAxisReverseMap.length>0){var G=function(Q,ee){var ie=_.config.yaxis[_.globals.seriesYAxisReverseMap[ee]],ue=Q<0?-1:1;return Q=Math.abs(Q),ie.logarithmic&&(Q=f.getBaseLog(ie.logBase,Q)),-ue*Q/r[ee]};if(v.isMultipleYAxis){k=[];for(var H=0;H<r.length;H++)k.push(G(v.minYArr[H],H))}else(k=[]).push(G(v.minY,0)),v.minY!==Number.MIN_VALUE&&Math.abs(v.minY)!==0&&(P=-v.minY/t,L=v.minX/a)}else(k=[]).push(0),P=0,L=0;return{yRatio:r,invertedYRatio:t,zRatio:E,xRatio:a,invertedXRatio:c,baseLineInvertedY:P,baseLineY:k,baseLineX:L}}},{key:"getLogSeries",value:function(t){var a=this,c=this.w;return c.globals.seriesLog=t.map(function(f,_){var v=c.globals.seriesYAxisReverseMap[_];return c.config.yaxis[v]&&c.config.yaxis[v].logarithmic?f.map(function(r){return r===null?null:a.getLogVal(c.config.yaxis[v].logBase,r,_)}):f}),c.globals.invalidLogScale?t:c.globals.seriesLog}},{key:"getLogValAtSeriesIndex",value:function(t,a){if(t===null)return null;var c=this.w,f=c.globals.seriesYAxisReverseMap[a];return c.config.yaxis[f]&&c.config.yaxis[f].logarithmic?this.getLogVal(c.config.yaxis[f].logBase,t,a):t}},{key:"getBaseLog",value:function(t,a){return Math.log(a)/Math.log(t)}},{key:"getLogVal",value:function(t,a,c){if(a<=0)return 0;var f=this.w,_=f.globals.minYArr[c]===0?-1:this.getBaseLog(t,f.globals.minYArr[c]),v=(f.globals.maxYArr[c]===0?0:this.getBaseLog(t,f.globals.maxYArr[c]))-_;return a<1?a/v:(this.getBaseLog(t,a)-_)/v}},{key:"getLogYRatios",value:function(t){var a=this,c=this.w,f=this.w.globals;return f.yLogRatio=t.slice(),f.logYRange=f.yRange.map(function(_,v){var r=c.globals.seriesYAxisReverseMap[v];if(c.config.yaxis[r]&&a.w.config.yaxis[r].logarithmic){var E,k=-Number.MAX_VALUE,P=Number.MIN_VALUE;return f.seriesLog.forEach(function(L,O){L.forEach(function(N){c.config.yaxis[O]&&c.config.yaxis[O].logarithmic&&(k=Math.max(N,k),P=Math.min(N,P))})}),E=Math.pow(f.yRange[v],Math.abs(P-k)/f.yRange[v]),f.yLogRatio[v]=E/f.gridHeight,E}}),f.invalidLogScale?t.slice():f.yLogRatio}},{key:"drawSeriesByGroup",value:function(t,a,c,f){var _=this.w,v=[];return t.series.length>0&&a.forEach(function(r){var E=[],k=[];t.i.forEach(function(P,L){_.config.series[P].group===r&&(E.push(t.series[L]),k.push(P))}),E.length>0&&v.push(f.draw(E,c,k))}),v}}],[{key:"checkComboSeries",value:function(t,a){var c=!1,f=0,_=0;return a===void 0&&(a="line"),t.length&&t[0].type!==void 0&&t.forEach(function(v){v.type!=="bar"&&v.type!=="column"&&v.type!=="candlestick"&&v.type!=="boxPlot"||f++,v.type!==void 0&&v.type!==a&&_++}),_>0&&(c=!0),{comboBarCount:f,comboCharts:c}}},{key:"extendArrayProps",value:function(t,a,c){var f,_,v,r,E,k;return(f=a)!==null&&f!==void 0&&f.yaxis&&(a=t.extendYAxis(a,c)),(_=a)!==null&&_!==void 0&&_.annotations&&(a.annotations.yaxis&&(a=t.extendYAxisAnnotations(a)),(v=a)!==null&&v!==void 0&&(r=v.annotations)!==null&&r!==void 0&&r.xaxis&&(a=t.extendXAxisAnnotations(a)),(E=a)!==null&&E!==void 0&&(k=E.annotations)!==null&&k!==void 0&&k.points&&(a=t.extendPointAnnotations(a))),a}}]),S}(),fm=function(){function S(t){pi(this,S),this.w=t.w,this.annoCtx=t}return gi(S,[{key:"setOrientations",value:function(t){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,c=this.w;if(t.label.orientation==="vertical"){var f=a!==null?a:0,_=c.globals.dom.baseEl.querySelector(".apexcharts-xaxis-annotations .apexcharts-xaxis-annotation-label[rel='".concat(f,"']"));if(_!==null){var v=_.getBoundingClientRect();_.setAttribute("x",parseFloat(_.getAttribute("x"))-v.height+4);var r=t.label.position==="top"?v.width:-v.width;_.setAttribute("y",parseFloat(_.getAttribute("y"))+r);var E=this.annoCtx.graphics.rotateAroundCenter(_),k=E.x,P=E.y;_.setAttribute("transform","rotate(-90 ".concat(k," ").concat(P,")"))}}}},{key:"addBackgroundToAnno",value:function(t,a){var c=this.w;if(!t||!a.label.text||!String(a.label.text).trim())return null;var f=c.globals.dom.baseEl.querySelector(".apexcharts-grid").getBoundingClientRect(),_=t.getBoundingClientRect(),v=a.label.style.padding,r=v.left,E=v.right,k=v.top,P=v.bottom;if(a.label.orientation==="vertical"){var L=[r,E,k,P];k=L[0],P=L[1],r=L[2],E=L[3]}var O=_.left-f.left-r,N=_.top-f.top-k,G=this.annoCtx.graphics.drawRect(O-c.globals.barPadForNumericAxis,N,_.width+r+E,_.height+k+P,a.label.borderRadius,a.label.style.background,1,a.label.borderWidth,a.label.borderColor,0);return a.id&&G.node.classList.add(a.id),G}},{key:"annotationsBackground",value:function(){var t=this,a=this.w,c=function(f,_,v){var r=a.globals.dom.baseEl.querySelector(".apexcharts-".concat(v,"-annotations .apexcharts-").concat(v,"-annotation-label[rel='").concat(_,"']"));if(r){var E=r.parentNode,k=t.addBackgroundToAnno(r,f);k&&(E.insertBefore(k.node,r),f.label.mouseEnter&&k.node.addEventListener("mouseenter",f.label.mouseEnter.bind(t,f)),f.label.mouseLeave&&k.node.addEventListener("mouseleave",f.label.mouseLeave.bind(t,f)),f.label.click&&k.node.addEventListener("click",f.label.click.bind(t,f)))}};a.config.annotations.xaxis.forEach(function(f,_){return c(f,_,"xaxis")}),a.config.annotations.yaxis.forEach(function(f,_){return c(f,_,"yaxis")}),a.config.annotations.points.forEach(function(f,_){return c(f,_,"point")})}},{key:"getY1Y2",value:function(t,a){var c,f=this.w,_=t==="y1"?a.y:a.y2,v=!1;if(this.annoCtx.invertAxis){var r=f.config.xaxis.convertedCatToNumeric?f.globals.categoryLabels:f.globals.labels,E=r.indexOf(_),k=f.globals.dom.baseEl.querySelector(".apexcharts-yaxis-texts-g text:nth-child(".concat(E+1,")"));c=k?parseFloat(k.getAttribute("y")):(f.globals.gridHeight/r.length-1)*(E+1)-f.globals.barHeight,a.seriesIndex!==void 0&&f.globals.barHeight&&(c-=f.globals.barHeight/2*(f.globals.series.length-1)-f.globals.barHeight*a.seriesIndex)}else{var P,L=f.globals.seriesYAxisMap[a.yAxisIndex][0],O=f.config.yaxis[a.yAxisIndex].logarithmic?new Is(this.annoCtx.ctx).getLogVal(f.config.yaxis[a.yAxisIndex].logBase,_,L)/f.globals.yLogRatio[L]:(_-f.globals.minYArr[L])/(f.globals.yRange[L]/f.globals.gridHeight);c=f.globals.gridHeight-Math.min(Math.max(O,0),f.globals.gridHeight),v=O>f.globals.gridHeight||O<0,!a.marker||a.y!==void 0&&a.y!==null||(c=0),(P=f.config.yaxis[a.yAxisIndex])!==null&&P!==void 0&&P.reversed&&(c=O)}return typeof _=="string"&&_.includes("px")&&(c=parseFloat(_)),{yP:c,clipped:v}}},{key:"getX1X2",value:function(t,a){var c=this.w,f=t==="x1"?a.x:a.x2,_=this.annoCtx.invertAxis?c.globals.minY:c.globals.minX,v=this.annoCtx.invertAxis?c.globals.maxY:c.globals.maxX,r=this.annoCtx.invertAxis?c.globals.yRange[0]:c.globals.xRange,E=!1,k=this.annoCtx.inversedReversedAxis?(v-f)/(r/c.globals.gridWidth):(f-_)/(r/c.globals.gridWidth);return c.config.xaxis.type!=="category"&&!c.config.xaxis.convertedCatToNumeric||this.annoCtx.invertAxis||c.globals.dataFormatXNumeric||c.config.chart.sparkline.enabled||(k=this.getStringX(f)),typeof f=="string"&&f.includes("px")&&(k=parseFloat(f)),f==null&&a.marker&&(k=c.globals.gridWidth),a.seriesIndex!==void 0&&c.globals.barWidth&&!this.annoCtx.invertAxis&&(k-=c.globals.barWidth/2*(c.globals.series.length-1)-c.globals.barWidth*a.seriesIndex),typeof k!="number"&&(k=0,E=!0),parseFloat(k.toFixed(10))>parseFloat(c.globals.gridWidth.toFixed(10))?(k=c.globals.gridWidth,E=!0):k<0&&(k=0,E=!0),{x:k,clipped:E}}},{key:"getStringX",value:function(t){var a=this.w,c=t;a.config.xaxis.convertedCatToNumeric&&a.globals.categoryLabels.length&&(t=a.globals.categoryLabels.indexOf(t)+1);var f=a.globals.labels.map(function(v){return Array.isArray(v)?v.join(" "):v}).indexOf(t),_=a.globals.dom.baseEl.querySelector(".apexcharts-xaxis-texts-g text:nth-child(".concat(f+1,")"));return _&&(c=parseFloat(_.getAttribute("x"))),c}}]),S}(),PE=function(){function S(t){pi(this,S),this.w=t.w,this.annoCtx=t,this.invertAxis=this.annoCtx.invertAxis,this.helpers=new fm(this.annoCtx)}return gi(S,[{key:"addXaxisAnnotation",value:function(t,a,c){var f,_=this.w,v=this.helpers.getX1X2("x1",t),r=v.x,E=v.clipped,k=!0,P=t.label.text,L=t.strokeDashArray;if(et.isNumber(r)){if(t.x2===null||t.x2===void 0){if(!E){var O=this.annoCtx.graphics.drawLine(r+t.offsetX,0+t.offsetY,r+t.offsetX,_.globals.gridHeight+t.offsetY,t.borderColor,L,t.borderWidth);a.appendChild(O.node),t.id&&O.node.classList.add(t.id)}}else{var N=this.helpers.getX1X2("x2",t);if(f=N.x,k=N.clipped,f<r){var G=r;r=f,f=G}var H=this.annoCtx.graphics.drawRect(r+t.offsetX,0+t.offsetY,f-r,_.globals.gridHeight+t.offsetY,0,t.fillColor,t.opacity,1,t.borderColor,L);H.node.classList.add("apexcharts-annotation-rect"),H.attr("clip-path","url(#gridRectMask".concat(_.globals.cuid,")")),a.appendChild(H.node),t.id&&H.node.classList.add(t.id)}if(!E||!k){var Q=this.annoCtx.graphics.getTextRects(P,parseFloat(t.label.style.fontSize)),ee=t.label.position==="top"?4:t.label.position==="center"?_.globals.gridHeight/2+(t.label.orientation==="vertical"?Q.width/2:0):_.globals.gridHeight,ie=this.annoCtx.graphics.drawText({x:r+t.label.offsetX,y:ee+t.label.offsetY-(t.label.orientation==="vertical"?t.label.position==="top"?Q.width/2-12:-Q.width/2:0),text:P,textAnchor:t.label.textAnchor,fontSize:t.label.style.fontSize,fontFamily:t.label.style.fontFamily,fontWeight:t.label.style.fontWeight,foreColor:t.label.style.color,cssClass:"apexcharts-xaxis-annotation-label ".concat(t.label.style.cssClass," ").concat(t.id?t.id:"")});ie.attr({rel:c}),a.appendChild(ie.node),this.annoCtx.helpers.setOrientations(t,c)}}}},{key:"drawXAxisAnnotations",value:function(){var t=this,a=this.w,c=this.annoCtx.graphics.group({class:"apexcharts-xaxis-annotations"});return a.config.annotations.xaxis.map(function(f,_){t.addXaxisAnnotation(f,c.node,_)}),c}}]),S}(),tn=function(){function S(t){pi(this,S),this.ctx=t,this.w=t.w,this.months31=[1,3,5,7,8,10,12],this.months30=[2,4,6,9,11],this.daysCntOfYear=[0,31,59,90,120,151,181,212,243,273,304,334]}return gi(S,[{key:"isValidDate",value:function(t){return typeof t!="number"&&!isNaN(this.parseDate(t))}},{key:"getTimeStamp",value:function(t){return Date.parse(t)?this.w.config.xaxis.labels.datetimeUTC?new Date(new Date(t).toISOString().substr(0,25)).getTime():new Date(t).getTime():t}},{key:"getDate",value:function(t){return this.w.config.xaxis.labels.datetimeUTC?new Date(new Date(t).toUTCString()):new Date(t)}},{key:"parseDate",value:function(t){var a=Date.parse(t);if(!isNaN(a))return this.getTimeStamp(t);var c=Date.parse(t.replace(/-/g,"/").replace(/[a-z]+/gi," "));return c=this.getTimeStamp(c)}},{key:"parseDateWithTimezone",value:function(t){return Date.parse(t.replace(/-/g,"/").replace(/[a-z]+/gi," "))}},{key:"formatDate",value:function(t,a){var c=this.w.globals.locale,f=this.w.config.xaxis.labels.datetimeUTC,_=["\0"].concat(Us(c.months)),v=[""].concat(Us(c.shortMonths)),r=[""].concat(Us(c.days)),E=[""].concat(Us(c.shortDays));function k(Ie,Ue){var Ke=Ie+"";for(Ue=Ue||2;Ke.length<Ue;)Ke="0"+Ke;return Ke}var P=f?t.getUTCFullYear():t.getFullYear();a=(a=(a=a.replace(/(^|[^\\])yyyy+/g,"$1"+P)).replace(/(^|[^\\])yy/g,"$1"+P.toString().substr(2,2))).replace(/(^|[^\\])y/g,"$1"+P);var L=(f?t.getUTCMonth():t.getMonth())+1;a=(a=(a=(a=a.replace(/(^|[^\\])MMMM+/g,"$1"+_[0])).replace(/(^|[^\\])MMM/g,"$1"+v[0])).replace(/(^|[^\\])MM/g,"$1"+k(L))).replace(/(^|[^\\])M/g,"$1"+L);var O=f?t.getUTCDate():t.getDate();a=(a=(a=(a=a.replace(/(^|[^\\])dddd+/g,"$1"+r[0])).replace(/(^|[^\\])ddd/g,"$1"+E[0])).replace(/(^|[^\\])dd/g,"$1"+k(O))).replace(/(^|[^\\])d/g,"$1"+O);var N=f?t.getUTCHours():t.getHours(),G=N>12?N-12:N===0?12:N;a=(a=(a=(a=a.replace(/(^|[^\\])HH+/g,"$1"+k(N))).replace(/(^|[^\\])H/g,"$1"+N)).replace(/(^|[^\\])hh+/g,"$1"+k(G))).replace(/(^|[^\\])h/g,"$1"+G);var H=f?t.getUTCMinutes():t.getMinutes();a=(a=a.replace(/(^|[^\\])mm+/g,"$1"+k(H))).replace(/(^|[^\\])m/g,"$1"+H);var Q=f?t.getUTCSeconds():t.getSeconds();a=(a=a.replace(/(^|[^\\])ss+/g,"$1"+k(Q))).replace(/(^|[^\\])s/g,"$1"+Q);var ee=f?t.getUTCMilliseconds():t.getMilliseconds();a=a.replace(/(^|[^\\])fff+/g,"$1"+k(ee,3)),ee=Math.round(ee/10),a=a.replace(/(^|[^\\])ff/g,"$1"+k(ee)),ee=Math.round(ee/10);var ie=N<12?"AM":"PM";a=(a=(a=a.replace(/(^|[^\\])f/g,"$1"+ee)).replace(/(^|[^\\])TT+/g,"$1"+ie)).replace(/(^|[^\\])T/g,"$1"+ie.charAt(0));var ue=ie.toLowerCase();a=(a=a.replace(/(^|[^\\])tt+/g,"$1"+ue)).replace(/(^|[^\\])t/g,"$1"+ue.charAt(0));var ve=-t.getTimezoneOffset(),ce=f||!ve?"Z":ve>0?"+":"-";if(!f){var Te=(ve=Math.abs(ve))%60;ce+=k(Math.floor(ve/60))+":"+k(Te)}a=a.replace(/(^|[^\\])K/g,"$1"+ce);var Se=(f?t.getUTCDay():t.getDay())+1;return a=(a=(a=(a=(a=a.replace(new RegExp(r[0],"g"),r[Se])).replace(new RegExp(E[0],"g"),E[Se])).replace(new RegExp(_[0],"g"),_[L])).replace(new RegExp(v[0],"g"),v[L])).replace(/\\(.)/g,"$1")}},{key:"getTimeUnitsfromTimestamp",value:function(t,a,c){var f=this.w;f.config.xaxis.min!==void 0&&(t=f.config.xaxis.min),f.config.xaxis.max!==void 0&&(a=f.config.xaxis.max);var _=this.getDate(t),v=this.getDate(a),r=this.formatDate(_,"yyyy MM dd HH mm ss fff").split(" "),E=this.formatDate(v,"yyyy MM dd HH mm ss fff").split(" ");return{minMillisecond:parseInt(r[6],10),maxMillisecond:parseInt(E[6],10),minSecond:parseInt(r[5],10),maxSecond:parseInt(E[5],10),minMinute:parseInt(r[4],10),maxMinute:parseInt(E[4],10),minHour:parseInt(r[3],10),maxHour:parseInt(E[3],10),minDate:parseInt(r[2],10),maxDate:parseInt(E[2],10),minMonth:parseInt(r[1],10)-1,maxMonth:parseInt(E[1],10)-1,minYear:parseInt(r[0],10),maxYear:parseInt(E[0],10)}}},{key:"isLeapYear",value:function(t){return t%4==0&&t%100!=0||t%400==0}},{key:"calculcateLastDaysOfMonth",value:function(t,a,c){return this.determineDaysOfMonths(t,a)-c}},{key:"determineDaysOfYear",value:function(t){var a=365;return this.isLeapYear(t)&&(a=366),a}},{key:"determineRemainingDaysOfYear",value:function(t,a,c){var f=this.daysCntOfYear[a]+c;return a>1&&this.isLeapYear()&&f++,f}},{key:"determineDaysOfMonths",value:function(t,a){var c=30;switch(t=et.monthMod(t),!0){case this.months30.indexOf(t)>-1:t===2&&(c=this.isLeapYear(a)?29:28);break;case this.months31.indexOf(t)>-1:default:c=31}return c}}]),S}(),tp=function(){function S(t){pi(this,S),this.ctx=t,this.w=t.w,this.tooltipKeyFormat="dd MMM"}return gi(S,[{key:"xLabelFormat",value:function(t,a,c,f){var _=this.w;if(_.config.xaxis.type==="datetime"&&_.config.xaxis.labels.formatter===void 0&&_.config.tooltip.x.formatter===void 0){var v=new tn(this.ctx);return v.formatDate(v.getDate(a),_.config.tooltip.x.format)}return t(a,c,f)}},{key:"defaultGeneralFormatter",value:function(t){return Array.isArray(t)?t.map(function(a){return a}):t}},{key:"defaultYFormatter",value:function(t,a,c){var f=this.w;if(et.isNumber(t))if(f.globals.yValueDecimal!==0)t=t.toFixed(a.decimalsInFloat!==void 0?a.decimalsInFloat:f.globals.yValueDecimal);else{var _=t.toFixed(0);t=t==_?_:t.toFixed(1)}return t}},{key:"setLabelFormatters",value:function(){var t=this,a=this.w;return a.globals.xaxisTooltipFormatter=function(c){return t.defaultGeneralFormatter(c)},a.globals.ttKeyFormatter=function(c){return t.defaultGeneralFormatter(c)},a.globals.ttZFormatter=function(c){return c},a.globals.legendFormatter=function(c){return t.defaultGeneralFormatter(c)},a.config.xaxis.labels.formatter!==void 0?a.globals.xLabelFormatter=a.config.xaxis.labels.formatter:a.globals.xLabelFormatter=function(c){if(et.isNumber(c)){if(!a.config.xaxis.convertedCatToNumeric&&a.config.xaxis.type==="numeric"){if(et.isNumber(a.config.xaxis.decimalsInFloat))return c.toFixed(a.config.xaxis.decimalsInFloat);var f=a.globals.maxX-a.globals.minX;return f>0&&f<100?c.toFixed(1):c.toFixed(0)}return a.globals.isBarHorizontal&&a.globals.maxY-a.globals.minYArr<4?c.toFixed(1):c.toFixed(0)}return c},typeof a.config.tooltip.x.formatter=="function"?a.globals.ttKeyFormatter=a.config.tooltip.x.formatter:a.globals.ttKeyFormatter=a.globals.xLabelFormatter,typeof a.config.xaxis.tooltip.formatter=="function"&&(a.globals.xaxisTooltipFormatter=a.config.xaxis.tooltip.formatter),(Array.isArray(a.config.tooltip.y)||a.config.tooltip.y.formatter!==void 0)&&(a.globals.ttVal=a.config.tooltip.y),a.config.tooltip.z.formatter!==void 0&&(a.globals.ttZFormatter=a.config.tooltip.z.formatter),a.config.legend.formatter!==void 0&&(a.globals.legendFormatter=a.config.legend.formatter),a.config.yaxis.forEach(function(c,f){c.labels.formatter!==void 0?a.globals.yLabelFormatters[f]=c.labels.formatter:a.globals.yLabelFormatters[f]=function(_){return a.globals.xyCharts?Array.isArray(_)?_.map(function(v){return t.defaultYFormatter(v,c,f)}):t.defaultYFormatter(_,c,f):_}}),a.globals}},{key:"heatmapLabelFormatters",value:function(){var t=this.w;if(t.config.chart.type==="heatmap"){t.globals.yAxisScale[0].result=t.globals.seriesNames.slice();var a=t.globals.seriesNames.reduce(function(c,f){return c.length>f.length?c:f},0);t.globals.yAxisScale[0].niceMax=a,t.globals.yAxisScale[0].niceMin=a}}}]),S}(),Wl=function(){function S(t){pi(this,S),this.ctx=t,this.w=t.w}return gi(S,[{key:"getLabel",value:function(t,a,c,f){var _=arguments.length>4&&arguments[4]!==void 0?arguments[4]:[],v=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"12px",r=!(arguments.length>6&&arguments[6]!==void 0)||arguments[6],E=this.w,k=t[f]===void 0?"":t[f],P=k,L=E.globals.xLabelFormatter,O=E.config.xaxis.labels.formatter,N=!1,G=new tp(this.ctx),H=k;r&&(P=G.xLabelFormat(L,k,H,{i:f,dateFormatter:new tn(this.ctx).formatDate,w:E}),O!==void 0&&(P=O(k,t[f],{i:f,dateFormatter:new tn(this.ctx).formatDate,w:E})));var Q,ee;a.length>0?(Q=a[f].unit,ee=null,a.forEach(function(ce){ce.unit==="month"?ee="year":ce.unit==="day"?ee="month":ce.unit==="hour"?ee="day":ce.unit==="minute"&&(ee="hour")}),N=ee===Q,c=a[f].position,P=a[f].value):E.config.xaxis.type==="datetime"&&O===void 0&&(P=""),P===void 0&&(P=""),P=Array.isArray(P)?P:P.toString();var ie=new Nt(this.ctx),ue={};ue=E.globals.rotateXLabels&&r?ie.getTextRects(P,parseInt(v,10),null,"rotate(".concat(E.config.xaxis.labels.rotate," 0 0)"),!1):ie.getTextRects(P,parseInt(v,10));var ve=!E.config.xaxis.labels.showDuplicates&&this.ctx.timeScale;return!Array.isArray(P)&&(String(P)==="NaN"||_.indexOf(P)>=0&&ve)&&(P=""),{x:c,text:P,textRect:ue,isBold:N}}},{key:"checkLabelBasedOnTickamount",value:function(t,a,c){var f=this.w,_=f.config.xaxis.tickAmount;return _==="dataPoints"&&(_=Math.round(f.globals.gridWidth/120)),_>c||t%Math.round(c/(_+1))==0||(a.text=""),a}},{key:"checkForOverflowingLabels",value:function(t,a,c,f,_){var v=this.w;if(t===0&&v.globals.skipFirstTimelinelabel&&(a.text=""),t===c-1&&v.globals.skipLastTimelinelabel&&(a.text=""),v.config.xaxis.labels.hideOverlappingLabels&&f.length>0){var r=_[_.length-1];if(v.config.xaxis.labels.trim&&v.config.xaxis.type!=="datetime")return a;a.x<r.textRect.width/(v.globals.rotateXLabels?Math.abs(v.config.xaxis.labels.rotate)/12:1.01)+r.x&&(a.text="")}return a}},{key:"checkForReversedLabels",value:function(t,a){var c=this.w;return c.config.yaxis[t]&&c.config.yaxis[t].reversed&&a.reverse(),a}},{key:"yAxisAllSeriesCollapsed",value:function(t){var a=this.w.globals;return!a.seriesYAxisMap[t].some(function(c){return a.collapsedSeriesIndices.indexOf(c)===-1})}},{key:"translateYAxisIndex",value:function(t){var a=this.w,c=a.globals,f=a.config.yaxis;return c.series.length>f.length||f.some(function(_){return Array.isArray(_.seriesName)})?t:c.seriesYAxisReverseMap[t]}},{key:"isYAxisHidden",value:function(t){var a=this.w,c=a.config.yaxis[t];if(!c.show||this.yAxisAllSeriesCollapsed(t))return!0;if(!c.showForNullSeries){var f=a.globals.seriesYAxisMap[t],_=new Is(this.ctx);return f.every(function(v){return _.isSeriesNull(v)})}return!1}},{key:"getYAxisForeColor",value:function(t,a){var c=this.w;return Array.isArray(t)&&c.globals.yAxisScale[a]&&this.ctx.theme.pushExtraColors(t,c.globals.yAxisScale[a].result.length,!1),t}},{key:"drawYAxisTicks",value:function(t,a,c,f,_,v,r){var E=this.w,k=new Nt(this.ctx),P=E.globals.translateY+E.config.yaxis[_].labels.offsetY;if(E.globals.isBarHorizontal?P=0:E.config.chart.type==="heatmap"&&(P+=v/2),f.show&&a>0){E.config.yaxis[_].opposite===!0&&(t+=f.width);for(var L=a;L>=0;L--){var O=k.drawLine(t+c.offsetX-f.width+f.offsetX,P+f.offsetY,t+c.offsetX+f.offsetX,P+f.offsetY,f.color);r.add(O),P+=v}}}}]),S}(),LE=function(){function S(t){pi(this,S),this.w=t.w,this.annoCtx=t,this.helpers=new fm(this.annoCtx),this.axesUtils=new Wl(this.annoCtx)}return gi(S,[{key:"addYaxisAnnotation",value:function(t,a,c){var f,_=this.w,v=t.strokeDashArray,r=this.helpers.getY1Y2("y1",t),E=r.yP,k=r.clipped,P=!0,L=!1,O=t.label.text;if(t.y2===null||t.y2===void 0){if(!k){L=!0;var N=this.annoCtx.graphics.drawLine(0+t.offsetX,E+t.offsetY,this._getYAxisAnnotationWidth(t),E+t.offsetY,t.borderColor,v,t.borderWidth);a.appendChild(N.node),t.id&&N.node.classList.add(t.id)}}else{if(f=(r=this.helpers.getY1Y2("y2",t)).yP,P=r.clipped,f>E){var G=E;E=f,f=G}if(!k||!P){L=!0;var H=this.annoCtx.graphics.drawRect(0+t.offsetX,f+t.offsetY,this._getYAxisAnnotationWidth(t),E-f,0,t.fillColor,t.opacity,1,t.borderColor,v);H.node.classList.add("apexcharts-annotation-rect"),H.attr("clip-path","url(#gridRectMask".concat(_.globals.cuid,")")),a.appendChild(H.node),t.id&&H.node.classList.add(t.id)}}if(L){var Q=t.label.position==="right"?_.globals.gridWidth:t.label.position==="center"?_.globals.gridWidth/2:0,ee=this.annoCtx.graphics.drawText({x:Q+t.label.offsetX,y:(f!=null?f:E)+t.label.offsetY-3,text:O,textAnchor:t.label.textAnchor,fontSize:t.label.style.fontSize,fontFamily:t.label.style.fontFamily,fontWeight:t.label.style.fontWeight,foreColor:t.label.style.color,cssClass:"apexcharts-yaxis-annotation-label ".concat(t.label.style.cssClass," ").concat(t.id?t.id:"")});ee.attr({rel:c}),a.appendChild(ee.node)}}},{key:"_getYAxisAnnotationWidth",value:function(t){var a=this.w;return a.globals.gridWidth,(t.width.indexOf("%")>-1?a.globals.gridWidth*parseInt(t.width,10)/100:parseInt(t.width,10))+t.offsetX}},{key:"drawYAxisAnnotations",value:function(){var t=this,a=this.w,c=this.annoCtx.graphics.group({class:"apexcharts-yaxis-annotations"});return a.config.annotations.yaxis.forEach(function(f,_){f.yAxisIndex=t.axesUtils.translateYAxisIndex(f.yAxisIndex),t.axesUtils.isYAxisHidden(f.yAxisIndex)&&t.axesUtils.yAxisAllSeriesCollapsed(f.yAxisIndex)||t.addYaxisAnnotation(f,c.node,_)}),c}}]),S}(),zE=function(){function S(t){pi(this,S),this.w=t.w,this.annoCtx=t,this.helpers=new fm(this.annoCtx)}return gi(S,[{key:"addPointAnnotation",value:function(t,a,c){if(!(this.w.globals.collapsedSeriesIndices.indexOf(t.seriesIndex)>-1)){var f=this.helpers.getX1X2("x1",t),_=f.x,v=f.clipped,r=(f=this.helpers.getY1Y2("y1",t)).yP,E=f.clipped;if(et.isNumber(_)&&!E&&!v){var k={pSize:t.marker.size,pointStrokeWidth:t.marker.strokeWidth,pointFillColor:t.marker.fillColor,pointStrokeColor:t.marker.strokeColor,shape:t.marker.shape,pRadius:t.marker.radius,class:"apexcharts-point-annotation-marker ".concat(t.marker.cssClass," ").concat(t.id?t.id:"")},P=this.annoCtx.graphics.drawMarker(_+t.marker.offsetX,r+t.marker.offsetY,k);a.appendChild(P.node);var L=t.label.text?t.label.text:"",O=this.annoCtx.graphics.drawText({x:_+t.label.offsetX,y:r+t.label.offsetY-t.marker.size-parseFloat(t.label.style.fontSize)/1.6,text:L,textAnchor:t.label.textAnchor,fontSize:t.label.style.fontSize,fontFamily:t.label.style.fontFamily,fontWeight:t.label.style.fontWeight,foreColor:t.label.style.color,cssClass:"apexcharts-point-annotation-label ".concat(t.label.style.cssClass," ").concat(t.id?t.id:"")});if(O.attr({rel:c}),a.appendChild(O.node),t.customSVG.SVG){var N=this.annoCtx.graphics.group({class:"apexcharts-point-annotations-custom-svg "+t.customSVG.cssClass});N.attr({transform:"translate(".concat(_+t.customSVG.offsetX,", ").concat(r+t.customSVG.offsetY,")")}),N.node.innerHTML=t.customSVG.SVG,a.appendChild(N.node)}if(t.image.path){var G=t.image.width?t.image.width:20,H=t.image.height?t.image.height:20;P=this.annoCtx.addImage({x:_+t.image.offsetX-G/2,y:r+t.image.offsetY-H/2,width:G,height:H,path:t.image.path,appendTo:".apexcharts-point-annotations"})}t.mouseEnter&&P.node.addEventListener("mouseenter",t.mouseEnter.bind(this,t)),t.mouseLeave&&P.node.addEventListener("mouseleave",t.mouseLeave.bind(this,t)),t.click&&P.node.addEventListener("click",t.click.bind(this,t))}}}},{key:"drawPointAnnotations",value:function(){var t=this,a=this.w,c=this.annoCtx.graphics.group({class:"apexcharts-point-annotations"});return a.config.annotations.points.map(function(f,_){t.addPointAnnotation(f,c.node,_)}),c}}]),S}(),S1={name:"en",options:{months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],toolbar:{exportToSVG:"Download SVG",exportToPNG:"Download PNG",exportToCSV:"Download CSV",menu:"Menu",selection:"Selection",selectionZoom:"Selection Zoom",zoomIn:"Zoom In",zoomOut:"Zoom Out",pan:"Panning",reset:"Reset Zoom"}}},Xc=function(){function S(){pi(this,S),this.yAxis={show:!0,showAlways:!1,showForNullSeries:!0,seriesName:void 0,opposite:!1,reversed:!1,logarithmic:!1,logBase:10,tickAmount:void 0,stepSize:void 0,forceNiceScale:!1,max:void 0,min:void 0,floating:!1,decimalsInFloat:void 0,labels:{show:!0,showDuplicates:!1,minWidth:0,maxWidth:160,offsetX:0,offsetY:0,align:void 0,rotate:0,padding:20,style:{colors:[],fontSize:"11px",fontWeight:400,fontFamily:void 0,cssClass:""},formatter:void 0},axisBorder:{show:!1,color:"#e0e0e0",width:1,offsetX:0,offsetY:0},axisTicks:{show:!1,color:"#e0e0e0",width:6,offsetX:0,offsetY:0},title:{text:void 0,rotate:-90,offsetY:0,offsetX:0,style:{color:void 0,fontSize:"11px",fontWeight:900,fontFamily:void 0,cssClass:""}},tooltip:{enabled:!1,offsetX:0},crosshairs:{show:!0,position:"front",stroke:{color:"#b6b6b6",width:1,dashArray:0}}},this.pointAnnotation={id:void 0,x:0,y:null,yAxisIndex:0,seriesIndex:void 0,mouseEnter:void 0,mouseLeave:void 0,click:void 0,marker:{size:4,fillColor:"#fff",strokeWidth:2,strokeColor:"#333",shape:"circle",offsetX:0,offsetY:0,cssClass:""},label:{borderColor:"#c2c2c2",borderWidth:1,borderRadius:2,text:void 0,textAnchor:"middle",offsetX:0,offsetY:0,mouseEnter:void 0,mouseLeave:void 0,click:void 0,style:{background:"#fff",color:void 0,fontSize:"11px",fontFamily:void 0,fontWeight:400,cssClass:"",padding:{left:5,right:5,top:2,bottom:2}}},customSVG:{SVG:void 0,cssClass:void 0,offsetX:0,offsetY:0},image:{path:void 0,width:20,height:20,offsetX:0,offsetY:0}},this.yAxisAnnotation={id:void 0,y:0,y2:null,strokeDashArray:1,fillColor:"#c2c2c2",borderColor:"#c2c2c2",borderWidth:1,opacity:.3,offsetX:0,offsetY:0,width:"100%",yAxisIndex:0,label:{borderColor:"#c2c2c2",borderWidth:1,borderRadius:2,text:void 0,textAnchor:"end",position:"right",offsetX:0,offsetY:-3,mouseEnter:void 0,mouseLeave:void 0,click:void 0,style:{background:"#fff",color:void 0,fontSize:"11px",fontFamily:void 0,fontWeight:400,cssClass:"",padding:{left:5,right:5,top:2,bottom:2}}}},this.xAxisAnnotation={id:void 0,x:0,x2:null,strokeDashArray:1,fillColor:"#c2c2c2",borderColor:"#c2c2c2",borderWidth:1,opacity:.3,offsetX:0,offsetY:0,label:{borderColor:"#c2c2c2",borderWidth:1,borderRadius:2,text:void 0,textAnchor:"middle",orientation:"vertical",position:"top",offsetX:0,offsetY:0,mouseEnter:void 0,mouseLeave:void 0,click:void 0,style:{background:"#fff",color:void 0,fontSize:"11px",fontFamily:void 0,fontWeight:400,cssClass:"",padding:{left:5,right:5,top:2,bottom:2}}}},this.text={x:0,y:0,text:"",textAnchor:"start",foreColor:void 0,fontSize:"13px",fontFamily:void 0,fontWeight:400,appendTo:".apexcharts-annotations",backgroundColor:"transparent",borderColor:"#c2c2c2",borderRadius:0,borderWidth:0,paddingLeft:4,paddingRight:4,paddingTop:2,paddingBottom:2}}return gi(S,[{key:"init",value:function(){return{annotations:{yaxis:[this.yAxisAnnotation],xaxis:[this.xAxisAnnotation],points:[this.pointAnnotation],texts:[],images:[],shapes:[]},chart:{animations:{enabled:!0,speed:800,animateGradually:{delay:150,enabled:!0},dynamicAnimation:{enabled:!0,speed:350}},background:"",locales:[S1],defaultLocale:"en",dropShadow:{enabled:!1,enabledOnSeries:void 0,top:2,left:2,blur:4,color:"#000",opacity:.7},events:{animationEnd:void 0,beforeMount:void 0,mounted:void 0,updated:void 0,click:void 0,mouseMove:void 0,mouseLeave:void 0,xAxisLabelClick:void 0,legendClick:void 0,markerClick:void 0,selection:void 0,dataPointSelection:void 0,dataPointMouseEnter:void 0,dataPointMouseLeave:void 0,beforeZoom:void 0,beforeResetZoom:void 0,zoomed:void 0,scrolled:void 0,brushScrolled:void 0},foreColor:"#373d3f",fontFamily:"Helvetica, Arial, sans-serif",height:"auto",parentHeightOffset:15,redrawOnParentResize:!0,redrawOnWindowResize:!0,id:void 0,group:void 0,nonce:void 0,offsetX:0,offsetY:0,injectStyleSheet:!0,selection:{enabled:!1,type:"x",fill:{color:"#24292e",opacity:.1},stroke:{width:1,color:"#24292e",opacity:.4,dashArray:3},xaxis:{min:void 0,max:void 0},yaxis:{min:void 0,max:void 0}},sparkline:{enabled:!1},brush:{enabled:!1,autoScaleYaxis:!0,target:void 0,targets:void 0},stacked:!1,stackOnlyBar:!0,stackType:"normal",toolbar:{show:!0,offsetX:0,offsetY:0,tools:{download:!0,selection:!0,zoom:!0,zoomin:!0,zoomout:!0,pan:!0,reset:!0,customIcons:[]},export:{csv:{filename:void 0,columnDelimiter:",",headerCategory:"category",headerValue:"value",categoryFormatter:void 0,valueFormatter:void 0},png:{filename:void 0},svg:{filename:void 0},scale:void 0,width:void 0},autoSelected:"zoom"},type:"line",width:"100%",zoom:{enabled:!0,type:"x",autoScaleYaxis:!1,allowMouseWheelZoom:!0,zoomedArea:{fill:{color:"#90CAF9",opacity:.4},stroke:{color:"#0D47A1",opacity:.4,width:1}}}},parsing:{x:void 0,y:void 0},plotOptions:{line:{isSlopeChart:!1,colors:{threshold:0,colorAboveThreshold:void 0,colorBelowThreshold:void 0}},area:{fillTo:"origin"},bar:{horizontal:!1,columnWidth:"70%",barHeight:"70%",distributed:!1,borderRadius:0,borderRadiusApplication:"around",borderRadiusWhenStacked:"last",rangeBarOverlap:!0,rangeBarGroupRows:!1,hideZeroBarsWhenGrouped:!1,isDumbbell:!1,dumbbellColors:void 0,isFunnel:!1,isFunnel3d:!0,colors:{ranges:[],backgroundBarColors:[],backgroundBarOpacity:1,backgroundBarRadius:0},dataLabels:{position:"top",maxItems:100,hideOverflowingLabels:!0,orientation:"horizontal",total:{enabled:!1,formatter:void 0,offsetX:0,offsetY:0,style:{color:"#373d3f",fontSize:"12px",fontFamily:void 0,fontWeight:600}}}},bubble:{zScaling:!0,minBubbleRadius:void 0,maxBubbleRadius:void 0},candlestick:{colors:{upward:"#00B746",downward:"#EF403C"},wick:{useFillColor:!0}},boxPlot:{colors:{upper:"#00E396",lower:"#008FFB"}},heatmap:{radius:2,enableShades:!0,shadeIntensity:.5,reverseNegativeShade:!1,distributed:!1,useFillColorAsStroke:!1,colorScale:{inverse:!1,ranges:[],min:void 0,max:void 0}},treemap:{enableShades:!0,shadeIntensity:.5,distributed:!1,reverseNegativeShade:!1,useFillColorAsStroke:!1,borderRadius:4,dataLabels:{format:"scale"},colorScale:{inverse:!1,ranges:[],min:void 0,max:void 0},seriesTitle:{show:!0,offsetY:1,offsetX:1,borderColor:"#000",borderWidth:1,borderRadius:2,style:{background:"rgba(0, 0, 0, 0.6)",color:"#fff",fontSize:"12px",fontFamily:void 0,fontWeight:400,cssClass:"",padding:{left:6,right:6,top:2,bottom:2}}}},radialBar:{inverseOrder:!1,startAngle:0,endAngle:360,offsetX:0,offsetY:0,hollow:{margin:5,size:"50%",background:"transparent",image:void 0,imageWidth:150,imageHeight:150,imageOffsetX:0,imageOffsetY:0,imageClipped:!0,position:"front",dropShadow:{enabled:!1,top:0,left:0,blur:3,color:"#000",opacity:.5}},track:{show:!0,startAngle:void 0,endAngle:void 0,background:"#f2f2f2",strokeWidth:"97%",opacity:1,margin:5,dropShadow:{enabled:!1,top:0,left:0,blur:3,color:"#000",opacity:.5}},dataLabels:{show:!0,name:{show:!0,fontSize:"16px",fontFamily:void 0,fontWeight:600,color:void 0,offsetY:0,formatter:function(t){return t}},value:{show:!0,fontSize:"14px",fontFamily:void 0,fontWeight:400,color:void 0,offsetY:16,formatter:function(t){return t+"%"}},total:{show:!1,label:"Total",fontSize:"16px",fontWeight:600,fontFamily:void 0,color:void 0,formatter:function(t){return t.globals.seriesTotals.reduce(function(a,c){return a+c},0)/t.globals.series.length+"%"}}},barLabels:{enabled:!1,offsetX:0,offsetY:0,useSeriesColors:!0,fontFamily:void 0,fontWeight:600,fontSize:"16px",formatter:function(t){return t},onClick:void 0}},pie:{customScale:1,offsetX:0,offsetY:0,startAngle:0,endAngle:360,expandOnClick:!0,dataLabels:{offset:0,minAngleToShowLabel:10},donut:{size:"65%",background:"transparent",labels:{show:!1,name:{show:!0,fontSize:"16px",fontFamily:void 0,fontWeight:600,color:void 0,offsetY:-10,formatter:function(t){return t}},value:{show:!0,fontSize:"20px",fontFamily:void 0,fontWeight:400,color:void 0,offsetY:10,formatter:function(t){return t}},total:{show:!1,showAlways:!1,label:"Total",fontSize:"16px",fontWeight:400,fontFamily:void 0,color:void 0,formatter:function(t){return t.globals.seriesTotals.reduce(function(a,c){return a+c},0)}}}}},polarArea:{rings:{strokeWidth:1,strokeColor:"#e8e8e8"},spokes:{strokeWidth:1,connectorColors:"#e8e8e8"}},radar:{size:void 0,offsetX:0,offsetY:0,polygons:{strokeWidth:1,strokeColors:"#e8e8e8",connectorColors:"#e8e8e8",fill:{colors:void 0}}}},colors:void 0,dataLabels:{enabled:!0,enabledOnSeries:void 0,formatter:function(t){return t!==null?t:""},textAnchor:"middle",distributed:!1,offsetX:0,offsetY:0,style:{fontSize:"12px",fontFamily:void 0,fontWeight:600,colors:void 0},background:{enabled:!0,foreColor:"#fff",backgroundColor:void 0,borderRadius:2,padding:4,opacity:.9,borderWidth:1,borderColor:"#fff",dropShadow:{enabled:!1,top:1,left:1,blur:1,color:"#000",opacity:.8}},dropShadow:{enabled:!1,top:1,left:1,blur:1,color:"#000",opacity:.8}},fill:{type:"solid",colors:void 0,opacity:.85,gradient:{shade:"dark",type:"horizontal",shadeIntensity:.5,gradientToColors:void 0,inverseColors:!0,opacityFrom:1,opacityTo:1,stops:[0,50,100],colorStops:[]},image:{src:[],width:void 0,height:void 0},pattern:{style:"squares",width:6,height:6,strokeWidth:2}},forecastDataPoints:{count:0,fillOpacity:.5,strokeWidth:void 0,dashArray:4},grid:{show:!0,borderColor:"#e0e0e0",strokeDashArray:0,position:"back",xaxis:{lines:{show:!1}},yaxis:{lines:{show:!0}},row:{colors:void 0,opacity:.5},column:{colors:void 0,opacity:.5},padding:{top:0,right:10,bottom:0,left:12}},labels:[],legend:{show:!0,showForSingleSeries:!1,showForNullSeries:!0,showForZeroSeries:!0,floating:!1,position:"bottom",horizontalAlign:"center",inverseOrder:!1,fontSize:"12px",fontFamily:void 0,fontWeight:400,width:void 0,height:void 0,formatter:void 0,tooltipHoverFormatter:void 0,offsetX:-20,offsetY:4,customLegendItems:[],clusterGroupedSeries:!0,clusterGroupedSeriesOrientation:"vertical",labels:{colors:void 0,useSeriesColors:!1},markers:{size:7,fillColors:void 0,strokeWidth:1,shape:void 0,offsetX:0,offsetY:0,customHTML:void 0,onClick:void 0},itemMargin:{horizontal:5,vertical:4},onItemClick:{toggleDataSeries:!0},onItemHover:{highlightDataSeries:!0}},markers:{discrete:[],size:0,colors:void 0,strokeColors:"#fff",strokeWidth:2,strokeOpacity:.9,strokeDashArray:0,fillOpacity:1,shape:"circle",offsetX:0,offsetY:0,showNullDataPoints:!0,onClick:void 0,onDblClick:void 0,hover:{size:void 0,sizeOffset:3}},noData:{text:void 0,align:"center",verticalAlign:"middle",offsetX:0,offsetY:0,style:{color:void 0,fontSize:"14px",fontFamily:void 0}},responsive:[],series:void 0,states:{hover:{filter:{type:"lighten"}},active:{allowMultipleDataPointsSelection:!1,filter:{type:"darken"}}},title:{text:void 0,align:"left",margin:5,offsetX:0,offsetY:0,floating:!1,style:{fontSize:"14px",fontWeight:900,fontFamily:void 0,color:void 0}},subtitle:{text:void 0,align:"left",margin:5,offsetX:0,offsetY:30,floating:!1,style:{fontSize:"12px",fontWeight:400,fontFamily:void 0,color:void 0}},stroke:{show:!0,curve:"smooth",lineCap:"butt",width:2,colors:void 0,dashArray:0,fill:{type:"solid",colors:void 0,opacity:.85,gradient:{shade:"dark",type:"horizontal",shadeIntensity:.5,gradientToColors:void 0,inverseColors:!0,opacityFrom:1,opacityTo:1,stops:[0,50,100],colorStops:[]}}},tooltip:{enabled:!0,enabledOnSeries:void 0,shared:!0,hideEmptySeries:!1,followCursor:!1,intersect:!1,inverseOrder:!1,custom:void 0,fillSeriesColor:!1,theme:"light",cssClass:"",style:{fontSize:"12px",fontFamily:void 0},onDatasetHover:{highlightDataSeries:!1},x:{show:!0,format:"dd MMM",formatter:void 0},y:{formatter:void 0,title:{formatter:function(t){return t?t+": ":""}}},z:{formatter:void 0,title:"Size: "},marker:{show:!0,fillColors:void 0},items:{display:"flex"},fixed:{enabled:!1,position:"topRight",offsetX:0,offsetY:0}},xaxis:{type:"category",categories:[],convertedCatToNumeric:!1,offsetX:0,offsetY:0,overwriteCategories:void 0,labels:{show:!0,rotate:-45,rotateAlways:!1,hideOverlappingLabels:!0,trim:!1,minHeight:void 0,maxHeight:120,showDuplicates:!0,style:{colors:[],fontSize:"12px",fontWeight:400,fontFamily:void 0,cssClass:""},offsetX:0,offsetY:0,format:void 0,formatter:void 0,datetimeUTC:!0,datetimeFormatter:{year:"yyyy",month:"MMM 'yy",day:"dd MMM",hour:"HH:mm",minute:"HH:mm:ss",second:"HH:mm:ss"}},group:{groups:[],style:{colors:[],fontSize:"12px",fontWeight:400,fontFamily:void 0,cssClass:""}},axisBorder:{show:!0,color:"#e0e0e0",width:"100%",height:1,offsetX:0,offsetY:0},axisTicks:{show:!0,color:"#e0e0e0",height:6,offsetX:0,offsetY:0},stepSize:void 0,tickAmount:void 0,tickPlacement:"on",min:void 0,max:void 0,range:void 0,floating:!1,decimalsInFloat:void 0,position:"bottom",title:{text:void 0,offsetX:0,offsetY:0,style:{color:void 0,fontSize:"12px",fontWeight:900,fontFamily:void 0,cssClass:""}},crosshairs:{show:!0,width:1,position:"back",opacity:.9,stroke:{color:"#b6b6b6",width:1,dashArray:3},fill:{type:"solid",color:"#B1B9C4",gradient:{colorFrom:"#D8E3F0",colorTo:"#BED1E6",stops:[0,100],opacityFrom:.4,opacityTo:.5}},dropShadow:{enabled:!1,left:0,top:0,blur:1,opacity:.8}},tooltip:{enabled:!0,offsetY:0,formatter:void 0,style:{fontSize:"12px",fontFamily:void 0}}},yaxis:this.yAxis,theme:{mode:"",palette:"palette1",monochrome:{enabled:!1,color:"#008FFB",shadeTo:"light",shadeIntensity:.65}}}}}]),S}(),RE=function(){function S(t){pi(this,S),this.ctx=t,this.w=t.w,this.graphics=new Nt(this.ctx),this.w.globals.isBarHorizontal&&(this.invertAxis=!0),this.helpers=new fm(this),this.xAxisAnnotations=new PE(this),this.yAxisAnnotations=new LE(this),this.pointsAnnotations=new zE(this),this.w.globals.isBarHorizontal&&this.w.config.yaxis[0].reversed&&(this.inversedReversedAxis=!0),this.xDivision=this.w.globals.gridWidth/this.w.globals.dataPoints}return gi(S,[{key:"drawAxesAnnotations",value:function(){var t=this.w;if(t.globals.axisCharts&&t.globals.dataPoints){for(var a=this.yAxisAnnotations.drawYAxisAnnotations(),c=this.xAxisAnnotations.drawXAxisAnnotations(),f=this.pointsAnnotations.drawPointAnnotations(),_=t.config.chart.animations.enabled,v=[a,c,f],r=[c.node,a.node,f.node],E=0;E<3;E++)t.globals.dom.elGraphical.add(v[E]),!_||t.globals.resized||t.globals.dataChanged||t.config.chart.type!=="scatter"&&t.config.chart.type!=="bubble"&&t.globals.dataPoints>1&&r[E].classList.add("apexcharts-element-hidden"),t.globals.delayedElements.push({el:r[E],index:0});this.helpers.annotationsBackground()}}},{key:"drawImageAnnos",value:function(){var t=this;this.w.config.annotations.images.map(function(a,c){t.addImage(a,c)})}},{key:"drawTextAnnos",value:function(){var t=this;this.w.config.annotations.texts.map(function(a,c){t.addText(a,c)})}},{key:"addXaxisAnnotation",value:function(t,a,c){this.xAxisAnnotations.addXaxisAnnotation(t,a,c)}},{key:"addYaxisAnnotation",value:function(t,a,c){this.yAxisAnnotations.addYaxisAnnotation(t,a,c)}},{key:"addPointAnnotation",value:function(t,a,c){this.pointsAnnotations.addPointAnnotation(t,a,c)}},{key:"addText",value:function(t,a){var c=t.x,f=t.y,_=t.text,v=t.textAnchor,r=t.foreColor,E=t.fontSize,k=t.fontFamily,P=t.fontWeight,L=t.cssClass,O=t.backgroundColor,N=t.borderWidth,G=t.strokeDashArray,H=t.borderRadius,Q=t.borderColor,ee=t.appendTo,ie=ee===void 0?".apexcharts-svg":ee,ue=t.paddingLeft,ve=ue===void 0?4:ue,ce=t.paddingRight,Te=ce===void 0?4:ce,Se=t.paddingBottom,Ie=Se===void 0?2:Se,Ue=t.paddingTop,Ke=Ue===void 0?2:Ue,qe=this.w,ft=this.graphics.drawText({x:c,y:f,text:_,textAnchor:v||"start",fontSize:E||"12px",fontWeight:P||"regular",fontFamily:k||qe.config.chart.fontFamily,foreColor:r||qe.config.chart.foreColor,cssClass:L}),bt=qe.globals.dom.baseEl.querySelector(ie);bt&&bt.appendChild(ft.node);var Tt=ft.bbox();if(_){var Et=this.graphics.drawRect(Tt.x-ve,Tt.y-Ke,Tt.width+ve+Te,Tt.height+Ie+Ke,H,O||"transparent",1,N,Q,G);bt.insertBefore(Et.node,ft.node)}}},{key:"addImage",value:function(t,a){var c=this.w,f=t.path,_=t.x,v=_===void 0?0:_,r=t.y,E=r===void 0?0:r,k=t.width,P=k===void 0?20:k,L=t.height,O=L===void 0?20:L,N=t.appendTo,G=N===void 0?".apexcharts-svg":N,H=c.globals.dom.Paper.image(f);H.size(P,O).move(v,E);var Q=c.globals.dom.baseEl.querySelector(G);return Q&&Q.appendChild(H.node),H}},{key:"addXaxisAnnotationExternal",value:function(t,a,c){return this.addAnnotationExternal({params:t,pushToMemory:a,context:c,type:"xaxis",contextMethod:c.addXaxisAnnotation}),c}},{key:"addYaxisAnnotationExternal",value:function(t,a,c){return this.addAnnotationExternal({params:t,pushToMemory:a,context:c,type:"yaxis",contextMethod:c.addYaxisAnnotation}),c}},{key:"addPointAnnotationExternal",value:function(t,a,c){return this.invertAxis===void 0&&(this.invertAxis=c.w.globals.isBarHorizontal),this.addAnnotationExternal({params:t,pushToMemory:a,context:c,type:"point",contextMethod:c.addPointAnnotation}),c}},{key:"addAnnotationExternal",value:function(t){var a=t.params,c=t.pushToMemory,f=t.context,_=t.type,v=t.contextMethod,r=f,E=r.w,k=E.globals.dom.baseEl.querySelector(".apexcharts-".concat(_,"-annotations")),P=k.childNodes.length+1,L=new Xc,O=Object.assign({},_==="xaxis"?L.xAxisAnnotation:_==="yaxis"?L.yAxisAnnotation:L.pointAnnotation),N=et.extend(O,a);switch(_){case"xaxis":this.addXaxisAnnotation(N,k,P);break;case"yaxis":this.addYaxisAnnotation(N,k,P);break;case"point":this.addPointAnnotation(N,k,P)}var G=E.globals.dom.baseEl.querySelector(".apexcharts-".concat(_,"-annotations .apexcharts-").concat(_,"-annotation-label[rel='").concat(P,"']")),H=this.helpers.addBackgroundToAnno(G,N);return H&&k.insertBefore(H.node,G),c&&E.globals.memory.methodsToExec.push({context:r,id:N.id?N.id:et.randomId(),method:v,label:"addAnnotation",params:a}),f}},{key:"clearAnnotations",value:function(t){for(var a=t.w,c=a.globals.dom.baseEl.querySelectorAll(".apexcharts-yaxis-annotations, .apexcharts-xaxis-annotations, .apexcharts-point-annotations"),f=a.globals.memory.methodsToExec.length-1;f>=0;f--)a.globals.memory.methodsToExec[f].label!=="addText"&&a.globals.memory.methodsToExec[f].label!=="addAnnotation"||a.globals.memory.methodsToExec.splice(f,1);c=et.listToArray(c),Array.prototype.forEach.call(c,function(_){for(;_.firstChild;)_.removeChild(_.firstChild)})}},{key:"removeAnnotation",value:function(t,a){var c=t.w,f=c.globals.dom.baseEl.querySelectorAll(".".concat(a));f&&(c.globals.memory.methodsToExec.map(function(_,v){_.id===a&&c.globals.memory.methodsToExec.splice(v,1)}),Object.keys(c.config.annotations).forEach(function(_){var v=c.config.annotations[_];Array.isArray(v)&&(c.config.annotations[_]=v.filter(function(r){return r.id!==a}))}),Array.prototype.forEach.call(f,function(_){_.parentElement.removeChild(_)}))}}]),S}(),Iy=function(S){var t,a=S.isTimeline,c=S.ctx,f=S.seriesIndex,_=S.dataPointIndex,v=S.y1,r=S.y2,E=S.w,k=E.globals.seriesRangeStart[f][_],P=E.globals.seriesRangeEnd[f][_],L=E.globals.labels[_],O=E.config.series[f].name?E.config.series[f].name:"",N=E.globals.ttKeyFormatter,G=E.config.tooltip.y.title.formatter,H={w:E,seriesIndex:f,dataPointIndex:_,start:k,end:P};typeof G=="function"&&(O=G(O,H)),(t=E.config.series[f].data[_])!==null&&t!==void 0&&t.x&&(L=E.config.series[f].data[_].x),a||E.config.xaxis.type==="datetime"&&(L=new tp(c).xLabelFormat(E.globals.ttKeyFormatter,L,L,{i:void 0,dateFormatter:new tn(c).formatDate,w:E})),typeof N=="function"&&(L=N(L,H)),Number.isFinite(v)&&Number.isFinite(r)&&(k=v,P=r);var Q="",ee="",ie=E.globals.colors[f];if(E.config.tooltip.x.formatter===void 0)if(E.config.xaxis.type==="datetime"){var ue=new tn(c);Q=ue.formatDate(ue.getDate(k),E.config.tooltip.x.format),ee=ue.formatDate(ue.getDate(P),E.config.tooltip.x.format)}else Q=k,ee=P;else Q=E.config.tooltip.x.formatter(k),ee=E.config.tooltip.x.formatter(P);return{start:k,end:P,startVal:Q,endVal:ee,ylabel:L,color:ie,seriesName:O}},ky=function(S){var t=S.color,a=S.seriesName,c=S.ylabel,f=S.start,_=S.end,v=S.seriesIndex,r=S.dataPointIndex,E=S.ctx.tooltip.tooltipLabels.getFormatters(v);f=E.yLbFormatter(f),_=E.yLbFormatter(_);var k=E.yLbFormatter(S.w.globals.series[v][r]),P=`<span class="value start-value">
  `.concat(f,`
  </span> <span class="separator">-</span> <span class="value end-value">
  `).concat(_,`
  </span>`);return'<div class="apexcharts-tooltip-rangebar"><div> <span class="series-name" style="color: '+t+'">'+(a||"")+'</span></div><div> <span class="category">'+c+": </span> "+(S.w.globals.comboCharts?S.w.config.series[v].type==="rangeArea"||S.w.config.series[v].type==="rangeBar"?P:"<span>".concat(k,"</span>"):P)+" </div></div>"},Yf=function(){function S(t){pi(this,S),this.opts=t}return gi(S,[{key:"hideYAxis",value:function(){this.opts.yaxis[0].show=!1,this.opts.yaxis[0].title.text="",this.opts.yaxis[0].axisBorder.show=!1,this.opts.yaxis[0].axisTicks.show=!1,this.opts.yaxis[0].floating=!0}},{key:"line",value:function(){return{dataLabels:{enabled:!1},stroke:{width:5,curve:"straight"},markers:{size:0,hover:{sizeOffset:6}},xaxis:{crosshairs:{width:1}}}}},{key:"sparkline",value:function(t){return this.hideYAxis(),et.extend(t,{grid:{show:!1,padding:{left:0,right:0,top:0,bottom:0}},legend:{show:!1},xaxis:{labels:{show:!1},tooltip:{enabled:!1},axisBorder:{show:!1},axisTicks:{show:!1}},chart:{toolbar:{show:!1},zoom:{enabled:!1}},dataLabels:{enabled:!1}})}},{key:"slope",value:function(){return this.hideYAxis(),{chart:{toolbar:{show:!1},zoom:{enabled:!1}},dataLabels:{enabled:!0,formatter:function(t,a){var c=a.w.config.series[a.seriesIndex].name;return t!==null?c+": "+t:""},background:{enabled:!1},offsetX:-5},grid:{xaxis:{lines:{show:!0}},yaxis:{lines:{show:!1}}},xaxis:{position:"top",labels:{style:{fontSize:14,fontWeight:900}},tooltip:{enabled:!1},crosshairs:{show:!1}},markers:{size:8,hover:{sizeOffset:1}},legend:{show:!1},tooltip:{shared:!1,intersect:!0,followCursor:!0},stroke:{width:5,curve:"straight"}}}},{key:"bar",value:function(){return{chart:{stacked:!1},plotOptions:{bar:{dataLabels:{position:"center"}}},dataLabels:{style:{colors:["#fff"]},background:{enabled:!1}},stroke:{width:0,lineCap:"square"},fill:{opacity:.85},legend:{markers:{shape:"square"}},tooltip:{shared:!1,intersect:!0},xaxis:{tooltip:{enabled:!1},tickPlacement:"between",crosshairs:{width:"barWidth",position:"back",fill:{type:"gradient"},dropShadow:{enabled:!1},stroke:{width:0}}}}}},{key:"funnel",value:function(){return this.hideYAxis(),Jt(Jt({},this.bar()),{},{chart:{animations:{speed:800,animateGradually:{enabled:!1}}},plotOptions:{bar:{horizontal:!0,borderRadiusApplication:"around",borderRadius:0,dataLabels:{position:"center"}}},grid:{show:!1,padding:{left:0,right:0}},xaxis:{labels:{show:!1},tooltip:{enabled:!1},axisBorder:{show:!1},axisTicks:{show:!1}}})}},{key:"candlestick",value:function(){var t=this;return{stroke:{width:1},fill:{opacity:1},dataLabels:{enabled:!1},tooltip:{shared:!0,custom:function(a){var c=a.seriesIndex,f=a.dataPointIndex,_=a.w;return t._getBoxTooltip(_,c,f,["Open","High","","Low","Close"],"candlestick")}},states:{active:{filter:{type:"none"}}},xaxis:{crosshairs:{width:1}}}}},{key:"boxPlot",value:function(){var t=this;return{chart:{animations:{dynamicAnimation:{enabled:!1}}},stroke:{width:1,colors:["#24292e"]},dataLabels:{enabled:!1},tooltip:{shared:!0,custom:function(a){var c=a.seriesIndex,f=a.dataPointIndex,_=a.w;return t._getBoxTooltip(_,c,f,["Minimum","Q1","Median","Q3","Maximum"],"boxPlot")}},markers:{size:7,strokeWidth:1,strokeColors:"#111"},xaxis:{crosshairs:{width:1}}}}},{key:"rangeBar",value:function(){return{chart:{animations:{animateGradually:!1}},stroke:{width:0,lineCap:"square"},plotOptions:{bar:{borderRadius:0,dataLabels:{position:"center"}}},dataLabels:{enabled:!1,formatter:function(t,a){a.ctx;var c=a.seriesIndex,f=a.dataPointIndex,_=a.w,v=function(){var r=_.globals.seriesRangeStart[c][f];return _.globals.seriesRangeEnd[c][f]-r};return _.globals.comboCharts?_.config.series[c].type==="rangeBar"||_.config.series[c].type==="rangeArea"?v():t:v()},background:{enabled:!1},style:{colors:["#fff"]}},markers:{size:10},tooltip:{shared:!1,followCursor:!0,custom:function(t){return t.w.config.plotOptions&&t.w.config.plotOptions.bar&&t.w.config.plotOptions.bar.horizontal?function(a){var c=Iy(Jt(Jt({},a),{},{isTimeline:!0})),f=c.color,_=c.seriesName,v=c.ylabel,r=c.startVal,E=c.endVal;return ky(Jt(Jt({},a),{},{color:f,seriesName:_,ylabel:v,start:r,end:E}))}(t):function(a){var c=Iy(a),f=c.color,_=c.seriesName,v=c.ylabel,r=c.start,E=c.end;return ky(Jt(Jt({},a),{},{color:f,seriesName:_,ylabel:v,start:r,end:E}))}(t)}},xaxis:{tickPlacement:"between",tooltip:{enabled:!1},crosshairs:{stroke:{width:0}}}}}},{key:"dumbbell",value:function(t){var a,c;return(a=t.plotOptions.bar)!==null&&a!==void 0&&a.barHeight||(t.plotOptions.bar.barHeight=2),(c=t.plotOptions.bar)!==null&&c!==void 0&&c.columnWidth||(t.plotOptions.bar.columnWidth=2),t}},{key:"area",value:function(){return{stroke:{width:4,fill:{type:"solid",gradient:{inverseColors:!1,shade:"light",type:"vertical",opacityFrom:.65,opacityTo:.5,stops:[0,100,100]}}},fill:{type:"gradient",gradient:{inverseColors:!1,shade:"light",type:"vertical",opacityFrom:.65,opacityTo:.5,stops:[0,100,100]}},markers:{size:0,hover:{sizeOffset:6}},tooltip:{followCursor:!1}}}},{key:"rangeArea",value:function(){return{stroke:{curve:"straight",width:0},fill:{type:"solid",opacity:.6},markers:{size:0},states:{hover:{filter:{type:"none"}},active:{filter:{type:"none"}}},tooltip:{intersect:!1,shared:!0,followCursor:!0,custom:function(t){return function(a){var c=Iy(a),f=c.color,_=c.seriesName,v=c.ylabel,r=c.start,E=c.end;return ky(Jt(Jt({},a),{},{color:f,seriesName:_,ylabel:v,start:r,end:E}))}(t)}}}}},{key:"brush",value:function(t){return et.extend(t,{chart:{toolbar:{autoSelected:"selection",show:!1},zoom:{enabled:!1}},dataLabels:{enabled:!1},stroke:{width:1},tooltip:{enabled:!1},xaxis:{tooltip:{enabled:!1}}})}},{key:"stacked100",value:function(t){t.dataLabels=t.dataLabels||{},t.dataLabels.formatter=t.dataLabels.formatter||void 0;var a=t.dataLabels.formatter;return t.yaxis.forEach(function(c,f){t.yaxis[f].min=0,t.yaxis[f].max=100}),t.chart.type==="bar"&&(t.dataLabels.formatter=a||function(c){return typeof c=="number"&&c?c.toFixed(0)+"%":c}),t}},{key:"stackedBars",value:function(){var t=this.bar();return Jt(Jt({},t),{},{plotOptions:Jt(Jt({},t.plotOptions),{},{bar:Jt(Jt({},t.plotOptions.bar),{},{borderRadiusApplication:"end",borderRadiusWhenStacked:"last"})})})}},{key:"convertCatToNumeric",value:function(t){return t.xaxis.convertedCatToNumeric=!0,t}},{key:"convertCatToNumericXaxis",value:function(t,a,c){t.xaxis.type="numeric",t.xaxis.labels=t.xaxis.labels||{},t.xaxis.labels.formatter=t.xaxis.labels.formatter||function(v){return et.isNumber(v)?Math.floor(v):v};var f=t.xaxis.labels.formatter,_=t.xaxis.categories&&t.xaxis.categories.length?t.xaxis.categories:t.labels;return c&&c.length&&(_=c.map(function(v){return Array.isArray(v)?v:String(v)})),_&&_.length&&(t.xaxis.labels.formatter=function(v){return et.isNumber(v)?f(_[Math.floor(v)-1]):f(v)}),t.xaxis.categories=[],t.labels=[],t.xaxis.tickAmount=t.xaxis.tickAmount||"dataPoints",t}},{key:"bubble",value:function(){return{dataLabels:{style:{colors:["#fff"]}},tooltip:{shared:!1,intersect:!0},xaxis:{crosshairs:{width:0}},fill:{type:"solid",gradient:{shade:"light",inverse:!0,shadeIntensity:.55,opacityFrom:.4,opacityTo:.8}}}}},{key:"scatter",value:function(){return{dataLabels:{enabled:!1},tooltip:{shared:!1,intersect:!0},markers:{size:6,strokeWidth:1,hover:{sizeOffset:2}}}}},{key:"heatmap",value:function(){return{chart:{stacked:!1},fill:{opacity:1},dataLabels:{style:{colors:["#fff"]}},stroke:{colors:["#fff"]},tooltip:{followCursor:!0,marker:{show:!1},x:{show:!1}},legend:{position:"top",markers:{shape:"square"}},grid:{padding:{right:20}}}}},{key:"treemap",value:function(){return{chart:{zoom:{enabled:!1}},dataLabels:{style:{fontSize:14,fontWeight:600,colors:["#fff"]}},stroke:{show:!0,width:2,colors:["#fff"]},legend:{show:!1},fill:{opacity:1,gradient:{stops:[0,100]}},tooltip:{followCursor:!0,x:{show:!1}},grid:{padding:{left:0,right:0}},xaxis:{crosshairs:{show:!1},tooltip:{enabled:!1}}}}},{key:"pie",value:function(){return{chart:{toolbar:{show:!1}},plotOptions:{pie:{donut:{labels:{show:!1}}}},dataLabels:{formatter:function(t){return t.toFixed(1)+"%"},style:{colors:["#fff"]},background:{enabled:!1},dropShadow:{enabled:!0}},stroke:{colors:["#fff"]},fill:{opacity:1,gradient:{shade:"light",stops:[0,100]}},tooltip:{theme:"dark",fillSeriesColor:!0},legend:{position:"right"},grid:{padding:{left:0,right:0,top:0,bottom:0}}}}},{key:"donut",value:function(){return{chart:{toolbar:{show:!1}},dataLabels:{formatter:function(t){return t.toFixed(1)+"%"},style:{colors:["#fff"]},background:{enabled:!1},dropShadow:{enabled:!0}},stroke:{colors:["#fff"]},fill:{opacity:1,gradient:{shade:"light",shadeIntensity:.35,stops:[80,100],opacityFrom:1,opacityTo:1}},tooltip:{theme:"dark",fillSeriesColor:!0},legend:{position:"right"},grid:{padding:{left:0,right:0,top:0,bottom:0}}}}},{key:"polarArea",value:function(){return{chart:{toolbar:{show:!1}},dataLabels:{formatter:function(t){return t.toFixed(1)+"%"},enabled:!1},stroke:{show:!0,width:2},fill:{opacity:.7},tooltip:{theme:"dark",fillSeriesColor:!0},legend:{position:"right"},grid:{padding:{left:0,right:0,top:0,bottom:0}}}}},{key:"radar",value:function(){return this.opts.yaxis[0].labels.offsetY=this.opts.yaxis[0].labels.offsetY?this.opts.yaxis[0].labels.offsetY:6,{dataLabels:{enabled:!1,style:{fontSize:"11px"}},stroke:{width:2},markers:{size:5,strokeWidth:1,strokeOpacity:1},fill:{opacity:.2},tooltip:{shared:!1,intersect:!0,followCursor:!0},grid:{show:!1,padding:{left:0,right:0,top:0,bottom:0}},xaxis:{labels:{formatter:function(t){return t},style:{colors:["#a8a8a8"],fontSize:"11px"}},tooltip:{enabled:!1},crosshairs:{show:!1}}}}},{key:"radialBar",value:function(){return{chart:{animations:{dynamicAnimation:{enabled:!0,speed:800}},toolbar:{show:!1}},fill:{gradient:{shade:"dark",shadeIntensity:.4,inverseColors:!1,type:"diagonal2",opacityFrom:1,opacityTo:1,stops:[70,98,100]}},legend:{show:!1,position:"right"},tooltip:{enabled:!1,fillSeriesColor:!0},grid:{padding:{left:0,right:0,top:0,bottom:0}}}}},{key:"_getBoxTooltip",value:function(t,a,c,f,_){var v=t.globals.seriesCandleO[a][c],r=t.globals.seriesCandleH[a][c],E=t.globals.seriesCandleM[a][c],k=t.globals.seriesCandleL[a][c],P=t.globals.seriesCandleC[a][c];return t.config.series[a].type&&t.config.series[a].type!==_?`<div class="apexcharts-custom-tooltip">
          `.concat(t.config.series[a].name?t.config.series[a].name:"series-"+(a+1),": <strong>").concat(t.globals.series[a][c],`</strong>
        </div>`):'<div class="apexcharts-tooltip-box apexcharts-tooltip-'.concat(t.config.chart.type,'">')+"<div>".concat(f[0],': <span class="value">')+v+"</span></div>"+"<div>".concat(f[1],': <span class="value">')+r+"</span></div>"+(E?"<div>".concat(f[2],': <span class="value">')+E+"</span></div>":"")+"<div>".concat(f[3],': <span class="value">')+k+"</span></div>"+"<div>".concat(f[4],': <span class="value">')+P+"</span></div></div>"}}]),S}(),qf=function(){function S(t){pi(this,S),this.opts=t}return gi(S,[{key:"init",value:function(t){var a=t.responsiveOverride,c=this.opts,f=new Xc,_=new Yf(c);this.chartType=c.chart.type,c=this.extendYAxis(c),c=this.extendAnnotations(c);var v=f.init(),r={};if(c&&Cn(c)==="object"){var E,k,P,L,O,N,G,H,Q,ee,ie={};ie=["line","area","bar","candlestick","boxPlot","rangeBar","rangeArea","bubble","scatter","heatmap","treemap","pie","polarArea","donut","radar","radialBar"].indexOf(c.chart.type)!==-1?_[c.chart.type]():_.line(),(E=c.plotOptions)!==null&&E!==void 0&&(k=E.bar)!==null&&k!==void 0&&k.isFunnel&&(ie=_.funnel()),c.chart.stacked&&c.chart.type==="bar"&&(ie=_.stackedBars()),(P=c.chart.brush)!==null&&P!==void 0&&P.enabled&&(ie=_.brush(ie)),(L=c.plotOptions)!==null&&L!==void 0&&(O=L.line)!==null&&O!==void 0&&O.isSlopeChart&&(ie=_.slope()),c.chart.stacked&&c.chart.stackType==="100%"&&(c=_.stacked100(c)),(N=c.plotOptions)!==null&&N!==void 0&&(G=N.bar)!==null&&G!==void 0&&G.isDumbbell&&(c=_.dumbbell(c)),this.checkForDarkTheme(window.Apex),this.checkForDarkTheme(c),c.xaxis=c.xaxis||window.Apex.xaxis||{},a||(c.xaxis.convertedCatToNumeric=!1),((H=(c=this.checkForCatToNumericXAxis(this.chartType,ie,c)).chart.sparkline)!==null&&H!==void 0&&H.enabled||(Q=window.Apex.chart)!==null&&Q!==void 0&&(ee=Q.sparkline)!==null&&ee!==void 0&&ee.enabled)&&(ie=_.sparkline(ie)),r=et.extend(v,ie)}var ue=et.extend(r,window.Apex);return v=et.extend(ue,c),v=this.handleUserInputErrors(v)}},{key:"checkForCatToNumericXAxis",value:function(t,a,c){var f,_,v=new Yf(c),r=(t==="bar"||t==="boxPlot")&&((f=c.plotOptions)===null||f===void 0||(_=f.bar)===null||_===void 0?void 0:_.horizontal),E=t==="pie"||t==="polarArea"||t==="donut"||t==="radar"||t==="radialBar"||t==="heatmap",k=c.xaxis.type!=="datetime"&&c.xaxis.type!=="numeric",P=c.xaxis.tickPlacement?c.xaxis.tickPlacement:a.xaxis&&a.xaxis.tickPlacement;return r||E||!k||P==="between"||(c=v.convertCatToNumeric(c)),c}},{key:"extendYAxis",value:function(t,a){var c=new Xc;(t.yaxis===void 0||!t.yaxis||Array.isArray(t.yaxis)&&t.yaxis.length===0)&&(t.yaxis={}),t.yaxis.constructor!==Array&&window.Apex.yaxis&&window.Apex.yaxis.constructor!==Array&&(t.yaxis=et.extend(t.yaxis,window.Apex.yaxis)),t.yaxis.constructor!==Array?t.yaxis=[et.extend(c.yAxis,t.yaxis)]:t.yaxis=et.extendArray(t.yaxis,c.yAxis);var f=!1;t.yaxis.forEach(function(v){v.logarithmic&&(f=!0)});var _=t.series;return a&&!_&&(_=a.config.series),f&&_.length!==t.yaxis.length&&_.length&&(t.yaxis=_.map(function(v,r){if(v.name||(_[r].name="series-".concat(r+1)),t.yaxis[r])return t.yaxis[r].seriesName=_[r].name,t.yaxis[r];var E=et.extend(c.yAxis,t.yaxis[0]);return E.show=!1,E})),f&&_.length>1&&_.length!==t.yaxis.length&&console.warn("A multi-series logarithmic chart should have equal number of series and y-axes"),t}},{key:"extendAnnotations",value:function(t){return t.annotations===void 0&&(t.annotations={},t.annotations.yaxis=[],t.annotations.xaxis=[],t.annotations.points=[]),t=this.extendYAxisAnnotations(t),t=this.extendXAxisAnnotations(t),t=this.extendPointAnnotations(t)}},{key:"extendYAxisAnnotations",value:function(t){var a=new Xc;return t.annotations.yaxis=et.extendArray(t.annotations.yaxis!==void 0?t.annotations.yaxis:[],a.yAxisAnnotation),t}},{key:"extendXAxisAnnotations",value:function(t){var a=new Xc;return t.annotations.xaxis=et.extendArray(t.annotations.xaxis!==void 0?t.annotations.xaxis:[],a.xAxisAnnotation),t}},{key:"extendPointAnnotations",value:function(t){var a=new Xc;return t.annotations.points=et.extendArray(t.annotations.points!==void 0?t.annotations.points:[],a.pointAnnotation),t}},{key:"checkForDarkTheme",value:function(t){t.theme&&t.theme.mode==="dark"&&(t.tooltip||(t.tooltip={}),t.tooltip.theme!=="light"&&(t.tooltip.theme="dark"),t.chart.foreColor||(t.chart.foreColor="#f6f7f8"),t.theme.palette||(t.theme.palette="palette4"))}},{key:"handleUserInputErrors",value:function(t){var a=t;if(a.tooltip.shared&&a.tooltip.intersect)throw new Error("tooltip.shared cannot be enabled when tooltip.intersect is true. Turn off any other option by setting it to false.");if(a.chart.type==="bar"&&a.plotOptions.bar.horizontal){if(a.yaxis.length>1)throw new Error("Multiple Y Axis for bars are not supported. Switch to column chart by setting plotOptions.bar.horizontal=false");a.yaxis[0].reversed&&(a.yaxis[0].opposite=!0),a.xaxis.tooltip.enabled=!1,a.yaxis[0].tooltip.enabled=!1,a.chart.zoom.enabled=!1}return a.chart.type!=="bar"&&a.chart.type!=="rangeBar"||a.tooltip.shared&&a.xaxis.crosshairs.width==="barWidth"&&a.series.length>1&&(a.xaxis.crosshairs.width="tickWidth"),a.chart.type!=="candlestick"&&a.chart.type!=="boxPlot"||a.yaxis[0].reversed&&(console.warn("Reversed y-axis in ".concat(a.chart.type," chart is not supported.")),a.yaxis[0].reversed=!1),a}}]),S}(),A1=function(){function S(){pi(this,S)}return gi(S,[{key:"initGlobalVars",value:function(t){t.series=[],t.seriesCandleO=[],t.seriesCandleH=[],t.seriesCandleM=[],t.seriesCandleL=[],t.seriesCandleC=[],t.seriesRangeStart=[],t.seriesRangeEnd=[],t.seriesRange=[],t.seriesPercent=[],t.seriesGoals=[],t.seriesX=[],t.seriesZ=[],t.seriesNames=[],t.seriesTotals=[],t.seriesLog=[],t.seriesColors=[],t.stackedSeriesTotals=[],t.seriesXvalues=[],t.seriesYvalues=[],t.dataWasParsed=!1,t.originalSeries=null,t.labels=[],t.hasXaxisGroups=!1,t.groups=[],t.barGroups=[],t.lineGroups=[],t.areaGroups=[],t.hasSeriesGroups=!1,t.seriesGroups=[],t.categoryLabels=[],t.timescaleLabels=[],t.noLabelsProvided=!1,t.resizeTimer=null,t.selectionResizeTimer=null,t.lastWheelExecution=0,t.delayedElements=[],t.pointsArray=[],t.dataLabelsRects=[],t.isXNumeric=!1,t.skipLastTimelinelabel=!1,t.skipFirstTimelinelabel=!1,t.isDataXYZ=!1,t.isMultiLineX=!1,t.isMultipleYAxis=!1,t.maxY=-Number.MAX_VALUE,t.minY=Number.MIN_VALUE,t.minYArr=[],t.maxYArr=[],t.maxX=-Number.MAX_VALUE,t.minX=Number.MAX_VALUE,t.initialMaxX=-Number.MAX_VALUE,t.initialMinX=Number.MAX_VALUE,t.maxDate=0,t.minDate=Number.MAX_VALUE,t.minZ=Number.MAX_VALUE,t.maxZ=-Number.MAX_VALUE,t.minXDiff=Number.MAX_VALUE,t.yAxisScale=[],t.xAxisScale=null,t.xAxisTicksPositions=[],t.yLabelsCoords=[],t.yTitleCoords=[],t.barPadForNumericAxis=0,t.padHorizontal=0,t.xRange=0,t.yRange=[],t.zRange=0,t.dataPoints=0,t.xTickAmount=0,t.multiAxisTickAmount=0}},{key:"globalVars",value:function(t){return{chartID:null,cuid:null,events:{beforeMount:[],mounted:[],updated:[],clicked:[],selection:[],dataPointSelection:[],zoomed:[],scrolled:[]},colors:[],clientX:null,clientY:null,fill:{colors:[]},stroke:{colors:[]},dataLabels:{style:{colors:[]}},radarPolygons:{fill:{colors:[]}},markers:{colors:[],size:t.markers.size,largestSize:0},animationEnded:!1,isTouchDevice:"ontouchstart"in window||navigator.msMaxTouchPoints,isDirty:!1,isExecCalled:!1,initialConfig:null,initialSeries:[],lastXAxis:[],lastYAxis:[],columnSeries:null,labels:[],timescaleLabels:[],noLabelsProvided:!1,allSeriesCollapsed:!1,collapsedSeries:[],collapsedSeriesIndices:[],ancillaryCollapsedSeries:[],ancillaryCollapsedSeriesIndices:[],risingSeries:[],dataFormatXNumeric:!1,capturedSeriesIndex:-1,capturedDataPointIndex:-1,selectedDataPoints:[],invalidLogScale:!1,ignoreYAxisIndexes:[],maxValsInArrayIndex:0,radialSize:0,selection:void 0,zoomEnabled:t.chart.toolbar.autoSelected==="zoom"&&t.chart.toolbar.tools.zoom&&t.chart.zoom.enabled,panEnabled:t.chart.toolbar.autoSelected==="pan"&&t.chart.toolbar.tools.pan,selectionEnabled:t.chart.toolbar.autoSelected==="selection"&&t.chart.toolbar.tools.selection,yaxis:null,mousedown:!1,lastClientPosition:{},visibleXRange:void 0,yValueDecimal:0,total:0,SVGNS:"http://www.w3.org/2000/svg",svgWidth:0,svgHeight:0,noData:!1,locale:{},dom:{},memory:{methodsToExec:[]},shouldAnimate:!0,skipLastTimelinelabel:!1,skipFirstTimelinelabel:!1,delayedElements:[],axisCharts:!0,isDataXYZ:!1,isSlopeChart:t.plotOptions.line.isSlopeChart,resized:!1,resizeTimer:null,comboCharts:!1,dataChanged:!1,previousPaths:[],allSeriesHasEqualX:!0,pointsArray:[],dataLabelsRects:[],lastDrawnDataLabelsIndexes:[],hasNullValues:!1,zoomed:!1,gridWidth:0,gridHeight:0,rotateXLabels:!1,defaultLabels:!1,xLabelFormatter:void 0,yLabelFormatters:[],xaxisTooltipFormatter:void 0,ttKeyFormatter:void 0,ttVal:void 0,ttZFormatter:void 0,LINE_HEIGHT_RATIO:1.618,xAxisLabelsHeight:0,xAxisGroupLabelsHeight:0,xAxisLabelsWidth:0,yAxisLabelsWidth:0,scaleX:1,scaleY:1,translateX:0,translateY:0,translateYAxisX:[],yAxisWidths:[],translateXAxisY:0,translateXAxisX:0,tooltip:null,niceScaleAllowedMagMsd:[[1,1,2,5,5,5,10,10,10,10,10],[1,1,2,5,5,5,10,10,10,10,10]],niceScaleDefaultTicks:[1,2,4,4,6,6,6,6,6,6,6,6,6,6,6,6,6,6,12,12,12,12,12,12,12,12,12,24],seriesYAxisMap:[],seriesYAxisReverseMap:[]}}},{key:"init",value:function(t){var a=this.globalVars(t);return this.initGlobalVars(a),a.initialConfig=et.extend({},t),a.initialSeries=et.clone(t.series),a.lastXAxis=et.clone(a.initialConfig.xaxis),a.lastYAxis=et.clone(a.initialConfig.yaxis),a}}]),S}(),DE=function(){function S(t){pi(this,S),this.opts=t}return gi(S,[{key:"init",value:function(){var t=new qf(this.opts).init({responsiveOverride:!1});return{config:t,globals:new A1().init(t)}}}]),S}(),Da=function(){function S(t){pi(this,S),this.ctx=t,this.w=t.w,this.opts=null,this.seriesIndex=0,this.patternIDs=[]}return gi(S,[{key:"clippedImgArea",value:function(t){var a=this.w,c=a.config,f=parseInt(a.globals.gridWidth,10),_=parseInt(a.globals.gridHeight,10),v=f>_?f:_,r=t.image,E=0,k=0;t.width===void 0&&t.height===void 0?c.fill.image.width!==void 0&&c.fill.image.height!==void 0?(E=c.fill.image.width+1,k=c.fill.image.height):(E=v+1,k=v):(E=t.width,k=t.height);var P=document.createElementNS(a.globals.SVGNS,"pattern");Nt.setAttrs(P,{id:t.patternID,patternUnits:t.patternUnits?t.patternUnits:"userSpaceOnUse",width:E+"px",height:k+"px"});var L=document.createElementNS(a.globals.SVGNS,"image");P.appendChild(L),L.setAttributeNS(window.SVG.xlink,"href",r),Nt.setAttrs(L,{x:0,y:0,preserveAspectRatio:"none",width:E+"px",height:k+"px"}),L.style.opacity=t.opacity,a.globals.dom.elDefs.node.appendChild(P)}},{key:"getSeriesIndex",value:function(t){var a=this.w,c=a.config.chart.type;return(c==="bar"||c==="rangeBar")&&a.config.plotOptions.bar.distributed||c==="heatmap"||c==="treemap"?this.seriesIndex=t.seriesNumber:this.seriesIndex=t.seriesNumber%a.globals.series.length,this.seriesIndex}},{key:"computeColorStops",value:function(t,a){var c,f=this.w,_=null,v=null,r=Uf(t);try{for(r.s();!(c=r.n()).done;){var E=c.value;E>=a.threshold?(_===null||E>_)&&(_=E):(v===null||E<v)&&(v=E)}}catch(L){r.e(L)}finally{r.f()}_===null&&(_=a.threshold),v===null&&(v=a.threshold);var k=_-a.threshold+(a.threshold-v);k===0&&(k=1);var P=100-(a.threshold-v)/k*100;return[{offset:P=Math.max(0,Math.min(P,100)),color:a.colorAboveThreshold,opacity:f.config.fill.opacity},{offset:0,color:a.colorBelowThreshold,opacity:f.config.fill.opacity}]}},{key:"fillPath",value:function(t){var a,c,f,_=this.w;this.opts=t;var v,r,E,k=this.w.config;this.seriesIndex=this.getSeriesIndex(t);var P=k.plotOptions.line.colors.colorAboveThreshold&&k.plotOptions.line.colors.colorBelowThreshold,L=this.getFillColors()[this.seriesIndex];_.globals.seriesColors[this.seriesIndex]!==void 0&&(L=_.globals.seriesColors[this.seriesIndex]),typeof L=="function"&&(L=L({seriesIndex:this.seriesIndex,dataPointIndex:t.dataPointIndex,value:t.value,w:_}));var O,N,G,H=t.fillType?t.fillType:this.getFillType(this.seriesIndex),Q=Array.isArray(k.fill.opacity)?k.fill.opacity[this.seriesIndex]:k.fill.opacity,ee=H==="gradient"||P;t.color&&(L=t.color),(a=_.config.series[this.seriesIndex])!==null&&a!==void 0&&(c=a.data)!==null&&c!==void 0&&(f=c[t.dataPointIndex])!==null&&f!==void 0&&f.fillColor&&(L=(O=_.config.series[this.seriesIndex])===null||O===void 0||(N=O.data)===null||N===void 0||(G=N[t.dataPointIndex])===null||G===void 0?void 0:G.fillColor),L||(L="#fff",console.warn("undefined color - ApexCharts"));var ie=L;if(L.indexOf("rgb")===-1?L.indexOf("#")===-1?ie=L:L.length<9&&(ie=et.hexToRgba(L,Q)):L.indexOf("rgba")>-1?Q=et.getOpacityFromRGBA(L):ie=et.hexToRgba(et.rgb2hex(L),Q),t.opacity&&(Q=t.opacity),H==="pattern"&&(r=this.handlePatternFill({fillConfig:t.fillConfig,patternFill:r,fillColor:L,fillOpacity:Q,defaultColor:ie})),ee){var ue=Us(k.fill.gradient.colorStops)||[],ve=k.fill.gradient.type;P&&(ue[this.seriesIndex]=this.computeColorStops(_.globals.series[this.seriesIndex],k.plotOptions.line.colors),ve="vertical"),E=this.handleGradientFill({type:ve,fillConfig:t.fillConfig,fillColor:L,fillOpacity:Q,colorStops:ue,i:this.seriesIndex})}if(H==="image"){var ce=k.fill.image.src,Te=t.patternID?t.patternID:"",Se="pattern".concat(_.globals.cuid).concat(t.seriesNumber+1).concat(Te);this.patternIDs.indexOf(Se)===-1&&(this.clippedImgArea({opacity:Q,image:Array.isArray(ce)?t.seriesNumber<ce.length?ce[t.seriesNumber]:ce[0]:ce,width:t.width?t.width:void 0,height:t.height?t.height:void 0,patternUnits:t.patternUnits,patternID:Se}),this.patternIDs.push(Se)),v="url(#".concat(Se,")")}else v=ee?E:H==="pattern"?r:ie;return t.solid&&(v=ie),v}},{key:"getFillType",value:function(t){var a=this.w;return Array.isArray(a.config.fill.type)?a.config.fill.type[t]:a.config.fill.type}},{key:"getFillColors",value:function(){var t=this.w,a=t.config,c=this.opts,f=[];return t.globals.comboCharts?t.config.series[this.seriesIndex].type==="line"?Array.isArray(t.globals.stroke.colors)?f=t.globals.stroke.colors:f.push(t.globals.stroke.colors):Array.isArray(t.globals.fill.colors)?f=t.globals.fill.colors:f.push(t.globals.fill.colors):a.chart.type==="line"?Array.isArray(t.globals.stroke.colors)?f=t.globals.stroke.colors:f.push(t.globals.stroke.colors):Array.isArray(t.globals.fill.colors)?f=t.globals.fill.colors:f.push(t.globals.fill.colors),c.fillColors!==void 0&&(f=[],Array.isArray(c.fillColors)?f=c.fillColors.slice():f.push(c.fillColors)),f}},{key:"handlePatternFill",value:function(t){var a=t.fillConfig,c=t.patternFill,f=t.fillColor,_=t.fillOpacity,v=t.defaultColor,r=this.w.config.fill;a&&(r=a);var E=this.opts,k=new Nt(this.ctx),P=Array.isArray(r.pattern.strokeWidth)?r.pattern.strokeWidth[this.seriesIndex]:r.pattern.strokeWidth,L=f;return Array.isArray(r.pattern.style)?c=r.pattern.style[E.seriesNumber]!==void 0?k.drawPattern(r.pattern.style[E.seriesNumber],r.pattern.width,r.pattern.height,L,P,_):v:c=k.drawPattern(r.pattern.style,r.pattern.width,r.pattern.height,L,P,_),c}},{key:"handleGradientFill",value:function(t){var a=t.type,c=t.fillColor,f=t.fillOpacity,_=t.fillConfig,v=t.colorStops,r=t.i,E=this.w.config.fill;_&&(E=Jt(Jt({},E),_));var k=this.opts,P=new Nt(this.ctx),L=new et;a=a||E.gradient.type;var O,N=c,G=E.gradient.opacityFrom===void 0?f:Array.isArray(E.gradient.opacityFrom)?E.gradient.opacityFrom[r]:E.gradient.opacityFrom;N.indexOf("rgba")>-1&&(G=et.getOpacityFromRGBA(N));var H=E.gradient.opacityTo===void 0?f:Array.isArray(E.gradient.opacityTo)?E.gradient.opacityTo[r]:E.gradient.opacityTo;if(E.gradient.gradientToColors===void 0||E.gradient.gradientToColors.length===0)O=E.gradient.shade==="dark"?L.shadeColor(-1*parseFloat(E.gradient.shadeIntensity),c.indexOf("rgb")>-1?et.rgb2hex(c):c):L.shadeColor(parseFloat(E.gradient.shadeIntensity),c.indexOf("rgb")>-1?et.rgb2hex(c):c);else if(E.gradient.gradientToColors[k.seriesNumber]){var Q=E.gradient.gradientToColors[k.seriesNumber];O=Q,Q.indexOf("rgba")>-1&&(H=et.getOpacityFromRGBA(Q))}else O=c;if(E.gradient.gradientFrom&&(N=E.gradient.gradientFrom),E.gradient.gradientTo&&(O=E.gradient.gradientTo),E.gradient.inverseColors){var ee=N;N=O,O=ee}return N.indexOf("rgb")>-1&&(N=et.rgb2hex(N)),O.indexOf("rgb")>-1&&(O=et.rgb2hex(O)),P.drawGradient(a,N,O,G,H,k.size,E.gradient.stops,v,r)}}]),S}(),Hu=function(){function S(t,a){pi(this,S),this.ctx=t,this.w=t.w}return gi(S,[{key:"setGlobalMarkerSize",value:function(){var t=this.w;if(t.globals.markers.size=Array.isArray(t.config.markers.size)?t.config.markers.size:[t.config.markers.size],t.globals.markers.size.length>0){if(t.globals.markers.size.length<t.globals.series.length+1)for(var a=0;a<=t.globals.series.length;a++)t.globals.markers.size[a]===void 0&&t.globals.markers.size.push(t.globals.markers.size[0])}else t.globals.markers.size=t.config.series.map(function(c){return t.config.markers.size})}},{key:"plotChartMarkers",value:function(t){var a=t.pointsPos,c=t.seriesIndex,f=t.j,_=t.pSize,v=t.alwaysDrawMarker,r=v!==void 0&&v,E=t.isVirtualPoint,k=E!==void 0&&E,P=this.w,L=c,O=a,N=null,G=new Nt(this.ctx),H=P.config.markers.discrete&&P.config.markers.discrete.length;if(Array.isArray(O.x))for(var Q=0;Q<O.x.length;Q++){var ee=void 0,ie=f,ue=!et.isNumber(O.y[Q]);P.globals.markers.largestSize===0&&P.globals.hasNullValues&&P.globals.series[L][f+1]!==null&&!k&&(ue=!0),f===1&&Q===0&&(ie=0),f===1&&Q===1&&(ie=1);var ve="apexcharts-marker";if(P.config.chart.type!=="line"&&P.config.chart.type!=="area"||P.globals.comboCharts||P.config.tooltip.intersect||(ve+=" no-pointer-events"),(Array.isArray(P.config.markers.size)?P.globals.markers.size[c]>0:P.config.markers.size>0)||r||H){ue||(ve+=" w".concat(et.randomId()));var ce=this.getMarkerConfig({cssClass:ve,seriesIndex:c,dataPointIndex:ie});P.config.series[L].data[ie]&&(P.config.series[L].data[ie].fillColor&&(ce.pointFillColor=P.config.series[L].data[ie].fillColor),P.config.series[L].data[ie].strokeColor&&(ce.pointStrokeColor=P.config.series[L].data[ie].strokeColor)),_!==void 0&&(ce.pSize=_),(O.x[Q]<-P.globals.markers.largestSize||O.x[Q]>P.globals.gridWidth+P.globals.markers.largestSize||O.y[Q]<-P.globals.markers.largestSize||O.y[Q]>P.globals.gridHeight+P.globals.markers.largestSize)&&(ce.pSize=0),!ue&&((P.globals.markers.size[c]>0||r||H)&&!N&&(N=G.group({class:r||H?"":"apexcharts-series-markers"})).attr("clip-path","url(#gridRectMarkerMask".concat(P.globals.cuid,")")),(ee=G.drawMarker(O.x[Q],O.y[Q],ce)).attr("rel",ie),ee.attr("j",ie),ee.attr("index",c),ee.node.setAttribute("default-marker-size",ce.pSize),new rn(this.ctx).setSelectionFilter(ee,c,ie),this.addEvents(ee),N&&N.add(ee))}else P.globals.pointsArray[c]===void 0&&(P.globals.pointsArray[c]=[]),P.globals.pointsArray[c].push([O.x[Q],O.y[Q]])}return N}},{key:"getMarkerConfig",value:function(t){var a=t.cssClass,c=t.seriesIndex,f=t.dataPointIndex,_=f===void 0?null:f,v=t.radius,r=v===void 0?null:v,E=t.size,k=E===void 0?null:E,P=t.strokeWidth,L=P===void 0?null:P,O=this.w,N=this.getMarkerStyle(c),G=k===null?O.globals.markers.size[c]:k,H=O.config.markers;return _!==null&&H.discrete.length&&H.discrete.map(function(Q){Q.seriesIndex===c&&Q.dataPointIndex===_&&(N.pointStrokeColor=Q.strokeColor,N.pointFillColor=Q.fillColor,G=Q.size,N.pointShape=Q.shape)}),{pSize:r===null?G:r,pRadius:r!==null?r:H.radius,pointStrokeWidth:L!==null?L:Array.isArray(H.strokeWidth)?H.strokeWidth[c]:H.strokeWidth,pointStrokeColor:N.pointStrokeColor,pointFillColor:N.pointFillColor,shape:N.pointShape||(Array.isArray(H.shape)?H.shape[c]:H.shape),class:a,pointStrokeOpacity:Array.isArray(H.strokeOpacity)?H.strokeOpacity[c]:H.strokeOpacity,pointStrokeDashArray:Array.isArray(H.strokeDashArray)?H.strokeDashArray[c]:H.strokeDashArray,pointFillOpacity:Array.isArray(H.fillOpacity)?H.fillOpacity[c]:H.fillOpacity,seriesIndex:c}}},{key:"addEvents",value:function(t){var a=this.w,c=new Nt(this.ctx);t.node.addEventListener("mouseenter",c.pathMouseEnter.bind(this.ctx,t)),t.node.addEventListener("mouseleave",c.pathMouseLeave.bind(this.ctx,t)),t.node.addEventListener("mousedown",c.pathMouseDown.bind(this.ctx,t)),t.node.addEventListener("click",a.config.markers.onClick),t.node.addEventListener("dblclick",a.config.markers.onDblClick),t.node.addEventListener("touchstart",c.pathMouseDown.bind(this.ctx,t),{passive:!0})}},{key:"getMarkerStyle",value:function(t){var a=this.w,c=a.globals.markers.colors,f=a.config.markers.strokeColor||a.config.markers.strokeColors;return{pointStrokeColor:Array.isArray(f)?f[t]:f,pointFillColor:Array.isArray(c)?c[t]:c}}}]),S}(),T1=function(){function S(t){pi(this,S),this.ctx=t,this.w=t.w,this.initialAnim=this.w.config.chart.animations.enabled}return gi(S,[{key:"draw",value:function(t,a,c){var f=this.w,_=new Nt(this.ctx),v=c.realIndex,r=c.pointsPos,E=c.zRatio,k=c.elParent,P=_.group({class:"apexcharts-series-markers apexcharts-series-".concat(f.config.chart.type)});if(P.attr("clip-path","url(#gridRectMarkerMask".concat(f.globals.cuid,")")),Array.isArray(r.x))for(var L=0;L<r.x.length;L++){var O=a+1,N=!0;a===0&&L===0&&(O=0),a===0&&L===1&&(O=1);var G=f.globals.markers.size[v];if(E!==1/0){var H=f.config.plotOptions.bubble;G=f.globals.seriesZ[v][O],H.zScaling&&(G/=E),H.minBubbleRadius&&G<H.minBubbleRadius&&(G=H.minBubbleRadius),H.maxBubbleRadius&&G>H.maxBubbleRadius&&(G=H.maxBubbleRadius)}var Q=r.x[L],ee=r.y[L];if(G=G||0,ee!==null&&f.globals.series[v][O]!==void 0||(N=!1),N){var ie=this.drawPoint(Q,ee,G,v,O,a);P.add(ie)}k.add(P)}}},{key:"drawPoint",value:function(t,a,c,f,_,v){var r=this.w,E=f,k=new Nu(this.ctx),P=new rn(this.ctx),L=new Da(this.ctx),O=new Hu(this.ctx),N=new Nt(this.ctx),G=O.getMarkerConfig({cssClass:"apexcharts-marker",seriesIndex:E,dataPointIndex:_,radius:r.config.chart.type==="bubble"||r.globals.comboCharts&&r.config.series[f]&&r.config.series[f].type==="bubble"?c:null}),H=L.fillPath({seriesNumber:f,dataPointIndex:_,color:G.pointFillColor,patternUnits:"objectBoundingBox",value:r.globals.series[f][v]}),Q=N.drawMarker(t,a,G);if(r.config.series[E].data[_]&&r.config.series[E].data[_].fillColor&&(H=r.config.series[E].data[_].fillColor),Q.attr({fill:H}),r.config.chart.dropShadow.enabled){var ee=r.config.chart.dropShadow;P.dropShadow(Q,ee,f)}if(!this.initialAnim||r.globals.dataChanged||r.globals.resized)r.globals.animationEnded=!0;else{var ie=r.config.chart.animations.speed;k.animateMarker(Q,ie,r.globals.easing,function(){window.setTimeout(function(){k.animationCompleted(Q)},100)})}return Q.attr({rel:_,j:_,index:f,"default-marker-size":G.pSize}),P.setSelectionFilter(Q,f,_),O.addEvents(Q),Q.node.classList.add("apexcharts-marker"),Q}},{key:"centerTextInBubble",value:function(t){var a=this.w;return{y:t+=parseInt(a.config.dataLabels.style.fontSize,10)/4}}}]),S}(),Fu=function(){function S(t){pi(this,S),this.ctx=t,this.w=t.w}return gi(S,[{key:"dataLabelsCorrection",value:function(t,a,c,f,_,v,r){var E=this.w,k=!1,P=new Nt(this.ctx).getTextRects(c,r),L=P.width,O=P.height;a<0&&(a=0),a>E.globals.gridHeight+O&&(a=E.globals.gridHeight+O/2),E.globals.dataLabelsRects[f]===void 0&&(E.globals.dataLabelsRects[f]=[]),E.globals.dataLabelsRects[f].push({x:t,y:a,width:L,height:O});var N=E.globals.dataLabelsRects[f].length-2,G=E.globals.lastDrawnDataLabelsIndexes[f]!==void 0?E.globals.lastDrawnDataLabelsIndexes[f][E.globals.lastDrawnDataLabelsIndexes[f].length-1]:0;if(E.globals.dataLabelsRects[f][N]!==void 0){var H=E.globals.dataLabelsRects[f][G];(t>H.x+H.width||a>H.y+H.height||a+O<H.y||t+L<H.x)&&(k=!0)}return(_===0||v)&&(k=!0),{x:t,y:a,textRects:P,drawnextLabel:k}}},{key:"drawDataLabel",value:function(t){var a=this,c=t.type,f=t.pos,_=t.i,v=t.j,r=t.isRangeStart,E=t.strokeWidth,k=E===void 0?2:E,P=this.w,L=new Nt(this.ctx),O=P.config.dataLabels,N=0,G=0,H=v,Q=null;if(P.globals.collapsedSeriesIndices.indexOf(_)!==-1||!O.enabled||!Array.isArray(f.x))return Q;Q=L.group({class:"apexcharts-data-labels"});for(var ee=0;ee<f.x.length;ee++)if(N=f.x[ee]+O.offsetX,G=f.y[ee]+O.offsetY+k,!isNaN(N)){v===1&&ee===0&&(H=0),v===1&&ee===1&&(H=1);var ie=P.globals.series[_][H];c==="rangeArea"&&(ie=r?P.globals.seriesRangeStart[_][H]:P.globals.seriesRangeEnd[_][H]);var ue="",ve=function(Te){return P.config.dataLabels.formatter(Te,{ctx:a.ctx,seriesIndex:_,dataPointIndex:H,w:P})};P.config.chart.type==="bubble"?(ue=ve(ie=P.globals.seriesZ[_][H]),G=f.y[ee],G=new T1(this.ctx).centerTextInBubble(G,_,H).y):ie!==void 0&&(ue=ve(ie));var ce=P.config.dataLabels.textAnchor;P.globals.isSlopeChart&&(ce=H===0?"end":H===P.config.series[_].data.length-1?"start":"middle"),this.plotDataLabelsText({x:N,y:G,text:ue,i:_,j:H,parent:Q,offsetCorrection:!0,dataLabelsConfig:P.config.dataLabels,textAnchor:ce})}return Q}},{key:"plotDataLabelsText",value:function(t){var a=this.w,c=new Nt(this.ctx),f=t.x,_=t.y,v=t.i,r=t.j,E=t.text,k=t.textAnchor,P=t.fontSize,L=t.parent,O=t.dataLabelsConfig,N=t.color,G=t.alwaysDrawDataLabel,H=t.offsetCorrection,Q=t.className,ee=null;if(Array.isArray(a.config.dataLabels.enabledOnSeries)&&a.config.dataLabels.enabledOnSeries.indexOf(v)<0)return ee;var ie={x:f,y:_,drawnextLabel:!0,textRects:null};H&&(ie=this.dataLabelsCorrection(f,_,E,v,r,G,parseInt(O.style.fontSize,10))),a.globals.zoomed||(f=ie.x,_=ie.y),ie.textRects&&(f<-20-ie.textRects.width||f>a.globals.gridWidth+ie.textRects.width+30)&&(E="");var ue=a.globals.dataLabels.style.colors[v];((a.config.chart.type==="bar"||a.config.chart.type==="rangeBar")&&a.config.plotOptions.bar.distributed||a.config.dataLabels.distributed)&&(ue=a.globals.dataLabels.style.colors[r]),typeof ue=="function"&&(ue=ue({series:a.globals.series,seriesIndex:v,dataPointIndex:r,w:a})),N&&(ue=N);var ve=O.offsetX,ce=O.offsetY;if(a.config.chart.type!=="bar"&&a.config.chart.type!=="rangeBar"||(ve=0,ce=0),a.globals.isSlopeChart&&(r!==0&&(ve=-2*O.offsetX+5),r!==0&&r!==a.config.series[v].data.length-1&&(ve=0)),ie.drawnextLabel){if(k==="middle"&&f===a.globals.gridWidth&&(k="end"),(ee=c.drawText({width:100,height:parseInt(O.style.fontSize,10),x:f+ve,y:_+ce,foreColor:ue,textAnchor:k||O.textAnchor,text:E,fontSize:P||O.style.fontSize,fontFamily:O.style.fontFamily,fontWeight:O.style.fontWeight||"normal"})).attr({class:Q||"apexcharts-datalabel",cx:f,cy:_}),O.dropShadow.enabled){var Te=O.dropShadow;new rn(this.ctx).dropShadow(ee,Te)}L.add(ee),a.globals.lastDrawnDataLabelsIndexes[v]===void 0&&(a.globals.lastDrawnDataLabelsIndexes[v]=[]),a.globals.lastDrawnDataLabelsIndexes[v].push(r)}return ee}},{key:"addBackgroundToDataLabel",value:function(t,a){var c=this.w,f=c.config.dataLabels.background,_=f.padding,v=f.padding/2,r=a.width,E=a.height,k=new Nt(this.ctx).drawRect(a.x-_,a.y-v/2,r+2*_,E+v,f.borderRadius,c.config.chart.background!=="transparent"&&c.config.chart.background?c.config.chart.background:"#fff",f.opacity,f.borderWidth,f.borderColor);return f.dropShadow.enabled&&new rn(this.ctx).dropShadow(k,f.dropShadow),k}},{key:"dataLabelsBackground",value:function(){var t=this.w;if(t.config.chart.type!=="bubble")for(var a=t.globals.dom.baseEl.querySelectorAll(".apexcharts-datalabels text"),c=0;c<a.length;c++){var f=a[c],_=f.getBBox(),v=null;if(_.width&&_.height&&(v=this.addBackgroundToDataLabel(f,_)),v){f.parentNode.insertBefore(v.node,f);var r=t.config.dataLabels.background.backgroundColor||f.getAttribute("fill");t.config.chart.animations.enabled&&!t.globals.resized&&!t.globals.dataChanged?v.animate().attr({fill:r}):v.attr({fill:r}),f.setAttribute("fill",t.config.dataLabels.background.foreColor)}}}},{key:"bringForward",value:function(){for(var t=this.w,a=t.globals.dom.baseEl.querySelectorAll(".apexcharts-datalabels"),c=t.globals.dom.baseEl.querySelector(".apexcharts-plot-series:last-child"),f=0;f<a.length;f++)c&&c.insertBefore(a[f],c.nextSibling)}}]),S}(),E1=`.apexcharts-flip-y {
  transform: scaleY(-1) translateY(-100%);
  transform-origin: top;
  transform-box: fill-box;
}
.apexcharts-flip-x {
  transform: scaleX(-1);
  transform-origin: center;
  transform-box: fill-box;
}
.apexcharts-legend {
  display: flex;
  overflow: auto;
  padding: 0 10px;
}
.apexcharts-legend.apexcharts-legend-group-horizontal {
  flex-direction: column;
}
.apexcharts-legend-group {
  display: flex;
}
.apexcharts-legend-group-vertical {
  flex-direction: column-reverse;
}
.apexcharts-legend.apx-legend-position-bottom, .apexcharts-legend.apx-legend-position-top {
  flex-wrap: wrap
}
.apexcharts-legend.apx-legend-position-right, .apexcharts-legend.apx-legend-position-left {
  flex-direction: column;
  bottom: 0;
}
.apexcharts-legend.apx-legend-position-bottom.apexcharts-align-left, .apexcharts-legend.apx-legend-position-top.apexcharts-align-left, .apexcharts-legend.apx-legend-position-right, .apexcharts-legend.apx-legend-position-left {
  justify-content: flex-start;
  align-items: flex-start;
}
.apexcharts-legend.apx-legend-position-bottom.apexcharts-align-center, .apexcharts-legend.apx-legend-position-top.apexcharts-align-center {
  justify-content: center;
  align-items: center;
}
.apexcharts-legend.apx-legend-position-bottom.apexcharts-align-right, .apexcharts-legend.apx-legend-position-top.apexcharts-align-right {
  justify-content: flex-end;
  align-items: flex-end;
}
.apexcharts-legend-series {
  cursor: pointer;
  line-height: normal;
  display: flex;
  align-items: center;
}
.apexcharts-legend-text {
  position: relative;
  font-size: 14px;
}
.apexcharts-legend-text *, .apexcharts-legend-marker * {
  pointer-events: none;
}
.apexcharts-legend-marker {
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  margin-right: 1px;
}

.apexcharts-legend-series.apexcharts-no-click {
  cursor: auto;
}
.apexcharts-legend .apexcharts-hidden-zero-series, .apexcharts-legend .apexcharts-hidden-null-series {
  display: none !important;
}
.apexcharts-inactive-legend {
  opacity: 0.45;
} `,fa=function(){function S(t){pi(this,S),this.ctx=t,this.w=t.w,this.legendInactiveClass="legend-mouseover-inactive"}return gi(S,[{key:"getAllSeriesEls",value:function(){return this.w.globals.dom.baseEl.getElementsByClassName("apexcharts-series")}},{key:"getSeriesByName",value:function(t){return this.w.globals.dom.baseEl.querySelector(".apexcharts-inner .apexcharts-series[seriesName='".concat(et.escapeString(t),"']"))}},{key:"isSeriesHidden",value:function(t){var a=this.getSeriesByName(t),c=parseInt(a.getAttribute("data:realIndex"),10);return{isHidden:a.classList.contains("apexcharts-series-collapsed"),realIndex:c}}},{key:"addCollapsedClassToSeries",value:function(t,a){var c=this.w;function f(_){for(var v=0;v<_.length;v++)_[v].index===a&&t.node.classList.add("apexcharts-series-collapsed")}f(c.globals.collapsedSeries),f(c.globals.ancillaryCollapsedSeries)}},{key:"toggleSeries",value:function(t){var a=this.isSeriesHidden(t);return this.ctx.legend.legendHelpers.toggleDataSeries(a.realIndex,a.isHidden),a.isHidden}},{key:"showSeries",value:function(t){var a=this.isSeriesHidden(t);a.isHidden&&this.ctx.legend.legendHelpers.toggleDataSeries(a.realIndex,!0)}},{key:"hideSeries",value:function(t){var a=this.isSeriesHidden(t);a.isHidden||this.ctx.legend.legendHelpers.toggleDataSeries(a.realIndex,!1)}},{key:"resetSeries",value:function(){var t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0],a=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],c=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2],f=this.w,_=et.clone(f.globals.initialSeries);f.globals.previousPaths=[],c?(f.globals.collapsedSeries=[],f.globals.ancillaryCollapsedSeries=[],f.globals.collapsedSeriesIndices=[],f.globals.ancillaryCollapsedSeriesIndices=[]):_=this.emptyCollapsedSeries(_),f.config.series=_,t&&(a&&(f.globals.zoomed=!1,this.ctx.updateHelpers.revertDefaultAxisMinMax()),this.ctx.updateHelpers._updateSeries(_,f.config.chart.animations.dynamicAnimation.enabled))}},{key:"emptyCollapsedSeries",value:function(t){for(var a=this.w,c=0;c<t.length;c++)a.globals.collapsedSeriesIndices.indexOf(c)>-1&&(t[c].data=[]);return t}},{key:"highlightSeries",value:function(t){var a=this.w,c=this.getSeriesByName(t),f=parseInt(c==null?void 0:c.getAttribute("data:realIndex"),10),_=a.globals.dom.baseEl.querySelectorAll(".apexcharts-series, .apexcharts-datalabels, .apexcharts-yaxis"),v=null,r=null,E=null;if(a.globals.axisCharts||a.config.chart.type==="radialBar")if(a.globals.axisCharts){v=a.globals.dom.baseEl.querySelector(".apexcharts-series[data\\:realIndex='".concat(f,"']")),r=a.globals.dom.baseEl.querySelector(".apexcharts-datalabels[data\\:realIndex='".concat(f,"']"));var k=a.globals.seriesYAxisReverseMap[f];E=a.globals.dom.baseEl.querySelector(".apexcharts-yaxis[rel='".concat(k,"']"))}else v=a.globals.dom.baseEl.querySelector(".apexcharts-series[rel='".concat(f+1,"']"));else v=a.globals.dom.baseEl.querySelector(".apexcharts-series[rel='".concat(f+1,"'] path"));for(var P=0;P<_.length;P++)_[P].classList.add(this.legendInactiveClass);if(v)a.globals.axisCharts||v.parentNode.classList.remove(this.legendInactiveClass),v.classList.remove(this.legendInactiveClass),r!==null&&r.classList.remove(this.legendInactiveClass),E!==null&&E.classList.remove(this.legendInactiveClass);else for(var L=0;L<_.length;L++)_[L].classList.remove(this.legendInactiveClass)}},{key:"toggleSeriesOnHover",value:function(t,a){var c=this.w;a||(a=t.target);var f=c.globals.dom.baseEl.querySelectorAll(".apexcharts-series, .apexcharts-datalabels, .apexcharts-yaxis");if(t.type==="mousemove"){var _=parseInt(a.getAttribute("rel"),10)-1;this.highlightSeries(c.globals.seriesNames[_])}else if(t.type==="mouseout")for(var v=0;v<f.length;v++)f[v].classList.remove(this.legendInactiveClass)}},{key:"highlightRangeInSeries",value:function(t,a){var c=this,f=this.w,_=f.globals.dom.baseEl.getElementsByClassName("apexcharts-heatmap-rect"),v=function(k){for(var P=0;P<_.length;P++)_[P].classList[k](c.legendInactiveClass)};if(t.type==="mousemove"){var r=parseInt(a.getAttribute("rel"),10)-1;v("add");var E=f.config.plotOptions.heatmap.colorScale.ranges;(function(k,P){for(var L=0;L<_.length;L++){var O=Number(_[L].getAttribute("val"));O>=k.from&&(O<k.to||k.to===P&&O===P)&&_[L].classList.remove(c.legendInactiveClass)}})(E[r],E.reduce(function(k,P){return Math.max(k,P.to)},0))}else t.type==="mouseout"&&v("remove")}},{key:"getActiveConfigSeriesIndex",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"asc",a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],c=this.w,f=0;if(c.config.series.length>1){for(var _=c.config.series.map(function(r,E){return r.data&&r.data.length>0&&c.globals.collapsedSeriesIndices.indexOf(E)===-1&&(!c.globals.comboCharts||a.length===0||a.length&&a.indexOf(c.config.series[E].type)>-1)?E:-1}),v=t==="asc"?0:_.length-1;t==="asc"?v<_.length:v>=0;t==="asc"?v++:v--)if(_[v]!==-1){f=_[v];break}}return f}},{key:"getBarSeriesIndices",value:function(){return this.w.globals.comboCharts?this.w.config.series.map(function(t,a){return t.type==="bar"||t.type==="column"?a:-1}).filter(function(t){return t!==-1}):this.w.config.series.map(function(t,a){return a})}},{key:"getPreviousPaths",value:function(){var t=this.w;function a(v,r,E){for(var k=v[r].childNodes,P={type:E,paths:[],realIndex:v[r].getAttribute("data:realIndex")},L=0;L<k.length;L++)if(k[L].hasAttribute("pathTo")){var O=k[L].getAttribute("pathTo");P.paths.push({d:O})}t.globals.previousPaths.push(P)}t.globals.previousPaths=[],["line","area","bar","rangebar","rangeArea","candlestick","radar"].forEach(function(v){for(var r,E=(r=v,t.globals.dom.baseEl.querySelectorAll(".apexcharts-".concat(r,"-series .apexcharts-series"))),k=0;k<E.length;k++)a(E,k,v)});var c=t.globals.dom.baseEl.querySelectorAll(".apexcharts-".concat(t.config.chart.type," .apexcharts-series"));if(c.length>0)for(var f=function(v){for(var r=t.globals.dom.baseEl.querySelectorAll(".apexcharts-".concat(t.config.chart.type," .apexcharts-series[data\\:realIndex='").concat(v,"'] rect")),E=[],k=function(L){var O=function(G){return r[L].getAttribute(G)},N={x:parseFloat(O("x")),y:parseFloat(O("y")),width:parseFloat(O("width")),height:parseFloat(O("height"))};E.push({rect:N,color:r[L].getAttribute("color")})},P=0;P<r.length;P++)k(P);t.globals.previousPaths.push(E)},_=0;_<c.length;_++)f(_);t.globals.axisCharts||(t.globals.previousPaths=t.globals.series)}},{key:"clearPreviousPaths",value:function(){var t=this.w;t.globals.previousPaths=[],t.globals.allSeriesCollapsed=!1}},{key:"handleNoData",value:function(){var t=this.w,a=t.config.noData,c=new Nt(this.ctx),f=t.globals.svgWidth/2,_=t.globals.svgHeight/2,v="middle";if(t.globals.noData=!0,t.globals.animationEnded=!0,a.align==="left"?(f=10,v="start"):a.align==="right"&&(f=t.globals.svgWidth-10,v="end"),a.verticalAlign==="top"?_=50:a.verticalAlign==="bottom"&&(_=t.globals.svgHeight-50),f+=a.offsetX,_=_+parseInt(a.style.fontSize,10)+2+a.offsetY,a.text!==void 0&&a.text!==""){var r=c.drawText({x:f,y:_,text:a.text,textAnchor:v,fontSize:a.style.fontSize,fontFamily:a.style.fontFamily,foreColor:a.style.color,opacity:1,class:"apexcharts-text-nodata"});t.globals.dom.Paper.add(r)}}},{key:"setNullSeriesToZeroValues",value:function(t){for(var a=this.w,c=0;c<t.length;c++)if(t[c].length===0)for(var f=0;f<t[a.globals.maxValsInArrayIndex].length;f++)t[c].push(0);return t}},{key:"hasAllSeriesEqualX",value:function(){for(var t=!0,a=this.w,c=this.filteredSeriesX(),f=0;f<c.length-1;f++)if(c[f][0]!==c[f+1][0]){t=!1;break}return a.globals.allSeriesHasEqualX=t,t}},{key:"filteredSeriesX",value:function(){var t=this.w.globals.seriesX.map(function(a){return a.length>0?a:[]});return t}}]),S}(),gx=function(){function S(t){pi(this,S),this.ctx=t,this.w=t.w,this.twoDSeries=[],this.threeDSeries=[],this.twoDSeriesX=[],this.seriesGoals=[],this.coreUtils=new Is(this.ctx)}return gi(S,[{key:"isMultiFormat",value:function(){return this.isFormatXY()||this.isFormat2DArray()}},{key:"isFormatXY",value:function(){var t=this.w.config.series.slice(),a=new fa(this.ctx);if(this.activeSeriesIndex=a.getActiveConfigSeriesIndex(),t[this.activeSeriesIndex].data!==void 0&&t[this.activeSeriesIndex].data.length>0&&t[this.activeSeriesIndex].data[0]!==null&&t[this.activeSeriesIndex].data[0].x!==void 0&&t[this.activeSeriesIndex].data[0]!==null)return!0}},{key:"isFormat2DArray",value:function(){var t=this.w.config.series.slice(),a=new fa(this.ctx);if(this.activeSeriesIndex=a.getActiveConfigSeriesIndex(),t[this.activeSeriesIndex].data!==void 0&&t[this.activeSeriesIndex].data.length>0&&t[this.activeSeriesIndex].data[0]!==void 0&&t[this.activeSeriesIndex].data[0]!==null&&t[this.activeSeriesIndex].data[0].constructor===Array)return!0}},{key:"handleFormat2DArray",value:function(t,a){for(var c=this.w.config,f=this.w.globals,_=c.chart.type==="boxPlot"||c.series[a].type==="boxPlot",v=0;v<t[a].data.length;v++)if(t[a].data[v][1]!==void 0&&(Array.isArray(t[a].data[v][1])&&t[a].data[v][1].length===4&&!_?this.twoDSeries.push(et.parseNumber(t[a].data[v][1][3])):t[a].data[v].length>=5?this.twoDSeries.push(et.parseNumber(t[a].data[v][4])):this.twoDSeries.push(et.parseNumber(t[a].data[v][1])),f.dataFormatXNumeric=!0),c.xaxis.type==="datetime"){var r=new Date(t[a].data[v][0]);r=new Date(r).getTime(),this.twoDSeriesX.push(r)}else this.twoDSeriesX.push(t[a].data[v][0]);for(var E=0;E<t[a].data.length;E++)t[a].data[E][2]!==void 0&&(this.threeDSeries.push(t[a].data[E][2]),f.isDataXYZ=!0)}},{key:"handleFormatXY",value:function(t,a){var c=this.w.config,f=this.w.globals,_=new tn(this.ctx),v=a;f.collapsedSeriesIndices.indexOf(a)>-1&&(v=this.activeSeriesIndex);for(var r=0;r<t[a].data.length;r++)t[a].data[r].y!==void 0&&(Array.isArray(t[a].data[r].y)?this.twoDSeries.push(et.parseNumber(t[a].data[r].y[t[a].data[r].y.length-1])):this.twoDSeries.push(et.parseNumber(t[a].data[r].y))),t[a].data[r].goals!==void 0&&Array.isArray(t[a].data[r].goals)?(this.seriesGoals[a]===void 0&&(this.seriesGoals[a]=[]),this.seriesGoals[a].push(t[a].data[r].goals)):(this.seriesGoals[a]===void 0&&(this.seriesGoals[a]=[]),this.seriesGoals[a].push(null));for(var E=0;E<t[v].data.length;E++){var k=typeof t[v].data[E].x=="string",P=Array.isArray(t[v].data[E].x),L=!P&&!!_.isValidDate(t[v].data[E].x);if(k||L)if(k||c.xaxis.convertedCatToNumeric){var O=f.isBarHorizontal&&f.isRangeData;c.xaxis.type!=="datetime"||O?(this.fallbackToCategory=!0,this.twoDSeriesX.push(t[v].data[E].x),isNaN(t[v].data[E].x)||this.w.config.xaxis.type==="category"||typeof t[v].data[E].x=="string"||(f.isXNumeric=!0)):this.twoDSeriesX.push(_.parseDate(t[v].data[E].x))}else c.xaxis.type==="datetime"?this.twoDSeriesX.push(_.parseDate(t[v].data[E].x.toString())):(f.dataFormatXNumeric=!0,f.isXNumeric=!0,this.twoDSeriesX.push(parseFloat(t[v].data[E].x)));else P?(this.fallbackToCategory=!0,this.twoDSeriesX.push(t[v].data[E].x)):(f.isXNumeric=!0,f.dataFormatXNumeric=!0,this.twoDSeriesX.push(t[v].data[E].x))}if(t[a].data[0]&&t[a].data[0].z!==void 0){for(var N=0;N<t[a].data.length;N++)this.threeDSeries.push(t[a].data[N].z);f.isDataXYZ=!0}}},{key:"handleRangeData",value:function(t,a){var c=this.w.globals,f={};return this.isFormat2DArray()?f=this.handleRangeDataFormat("array",t,a):this.isFormatXY()&&(f=this.handleRangeDataFormat("xy",t,a)),c.seriesRangeStart[a]=f.start===void 0?[]:f.start,c.seriesRangeEnd[a]=f.end===void 0?[]:f.end,c.seriesRange[a]=f.rangeUniques,c.seriesRange.forEach(function(_,v){_&&_.forEach(function(r,E){r.y.forEach(function(k,P){for(var L=0;L<r.y.length;L++)if(P!==L){var O=k.y1,N=k.y2,G=r.y[L].y1;O<=r.y[L].y2&&G<=N&&(r.overlaps.indexOf(k.rangeName)<0&&r.overlaps.push(k.rangeName),r.overlaps.indexOf(r.y[L].rangeName)<0&&r.overlaps.push(r.y[L].rangeName))}})})}),f}},{key:"handleCandleStickBoxData",value:function(t,a){var c=this.w.globals,f={};return this.isFormat2DArray()?f=this.handleCandleStickBoxDataFormat("array",t,a):this.isFormatXY()&&(f=this.handleCandleStickBoxDataFormat("xy",t,a)),c.seriesCandleO[a]=f.o,c.seriesCandleH[a]=f.h,c.seriesCandleM[a]=f.m,c.seriesCandleL[a]=f.l,c.seriesCandleC[a]=f.c,f}},{key:"handleRangeDataFormat",value:function(t,a,c){var f=[],_=[],v=a[c].data.filter(function(P,L,O){return L===O.findIndex(function(N){return N.x===P.x})}).map(function(P,L){return{x:P.x,overlaps:[],y:[]}});if(t==="array")for(var r=0;r<a[c].data.length;r++)Array.isArray(a[c].data[r])?(f.push(a[c].data[r][1][0]),_.push(a[c].data[r][1][1])):(f.push(a[c].data[r]),_.push(a[c].data[r]));else if(t==="xy")for(var E=function(P){var L=Array.isArray(a[c].data[P].y),O=et.randomId(),N=a[c].data[P].x,G={y1:L?a[c].data[P].y[0]:a[c].data[P].y,y2:L?a[c].data[P].y[1]:a[c].data[P].y,rangeName:O};a[c].data[P].rangeName=O;var H=v.findIndex(function(Q){return Q.x===N});v[H].y.push(G),f.push(G.y1),_.push(G.y2)},k=0;k<a[c].data.length;k++)E(k);return{start:f,end:_,rangeUniques:v}}},{key:"handleCandleStickBoxDataFormat",value:function(t,a,c){var f=this.w,_=f.config.chart.type==="boxPlot"||f.config.series[c].type==="boxPlot",v=[],r=[],E=[],k=[],P=[];if(t==="array")if(_&&a[c].data[0].length===6||!_&&a[c].data[0].length===5)for(var L=0;L<a[c].data.length;L++)v.push(a[c].data[L][1]),r.push(a[c].data[L][2]),_?(E.push(a[c].data[L][3]),k.push(a[c].data[L][4]),P.push(a[c].data[L][5])):(k.push(a[c].data[L][3]),P.push(a[c].data[L][4]));else for(var O=0;O<a[c].data.length;O++)Array.isArray(a[c].data[O][1])&&(v.push(a[c].data[O][1][0]),r.push(a[c].data[O][1][1]),_?(E.push(a[c].data[O][1][2]),k.push(a[c].data[O][1][3]),P.push(a[c].data[O][1][4])):(k.push(a[c].data[O][1][2]),P.push(a[c].data[O][1][3])));else if(t==="xy")for(var N=0;N<a[c].data.length;N++)Array.isArray(a[c].data[N].y)&&(v.push(a[c].data[N].y[0]),r.push(a[c].data[N].y[1]),_?(E.push(a[c].data[N].y[2]),k.push(a[c].data[N].y[3]),P.push(a[c].data[N].y[4])):(k.push(a[c].data[N].y[2]),P.push(a[c].data[N].y[3])));return{o:v,h:r,m:E,l:k,c:P}}},{key:"parseDataAxisCharts",value:function(t){var a=this,c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.ctx,f=this.w.config,_=this.w.globals,v=new tn(c),r=f.labels.length>0?f.labels.slice():f.xaxis.categories.slice();_.isRangeBar=f.chart.type==="rangeBar"&&_.isBarHorizontal,_.hasXaxisGroups=f.xaxis.type==="category"&&f.xaxis.group.groups.length>0,_.hasXaxisGroups&&(_.groups=f.xaxis.group.groups),t.forEach(function(N,G){N.name!==void 0?_.seriesNames.push(N.name):_.seriesNames.push("series-"+parseInt(G+1,10))}),this.coreUtils.setSeriesYAxisMappings();var E=[],k=Us(new Set(f.series.map(function(N){return N.group})));f.series.forEach(function(N,G){var H=k.indexOf(N.group);E[H]||(E[H]=[]),E[H].push(_.seriesNames[G])}),_.seriesGroups=E;for(var P=function(){for(var N=0;N<r.length;N++)if(typeof r[N]=="string"){if(!v.isValidDate(r[N]))throw new Error("You have provided invalid Date format. Please provide a valid JavaScript Date");a.twoDSeriesX.push(v.parseDate(r[N]))}else a.twoDSeriesX.push(r[N])},L=0;L<t.length;L++){if(this.twoDSeries=[],this.twoDSeriesX=[],this.threeDSeries=[],t[L].data===void 0)return void console.error("It is a possibility that you may have not included 'data' property in series.");if(f.chart.type!=="rangeBar"&&f.chart.type!=="rangeArea"&&t[L].type!=="rangeBar"&&t[L].type!=="rangeArea"||(_.isRangeData=!0,this.handleRangeData(t,L)),this.isMultiFormat())this.isFormat2DArray()?this.handleFormat2DArray(t,L):this.isFormatXY()&&this.handleFormatXY(t,L),f.chart.type!=="candlestick"&&t[L].type!=="candlestick"&&f.chart.type!=="boxPlot"&&t[L].type!=="boxPlot"||this.handleCandleStickBoxData(t,L),_.series.push(this.twoDSeries),_.labels.push(this.twoDSeriesX),_.seriesX.push(this.twoDSeriesX),_.seriesGoals=this.seriesGoals,L!==this.activeSeriesIndex||this.fallbackToCategory||(_.isXNumeric=!0);else{f.xaxis.type==="datetime"?(_.isXNumeric=!0,P(),_.seriesX.push(this.twoDSeriesX)):f.xaxis.type==="numeric"&&(_.isXNumeric=!0,r.length>0&&(this.twoDSeriesX=r,_.seriesX.push(this.twoDSeriesX))),_.labels.push(this.twoDSeriesX);var O=t[L].data.map(function(N){return et.parseNumber(N)});_.series.push(O)}_.seriesZ.push(this.threeDSeries),t[L].color!==void 0?_.seriesColors.push(t[L].color):_.seriesColors.push(void 0)}return this.w}},{key:"parseDataNonAxisCharts",value:function(t){var a=this.w.globals,c=this.w.config,f=Array.isArray(t)&&t.every(function(P){return typeof P=="number"})&&c.labels.length>0,_=Array.isArray(t)&&t.some(function(P){return P&&Cn(P)==="object"&&P.data||P&&Cn(P)==="object"&&P.parsing});if(f&&_&&console.warn("ApexCharts: Both old format (numeric series + labels) and new format (series objects with data/parsing) detected. Using old format for backward compatibility."),f){a.series=t.slice(),a.seriesNames=c.labels.slice();for(var v=0;v<a.series.length;v++)a.seriesNames[v]===void 0&&a.seriesNames.push("series-"+(v+1));return this.w}if(Array.isArray(t)&&t.every(function(P){return typeof P=="number"})){a.series=t.slice(),a.seriesNames=[];for(var r=0;r<a.series.length;r++)a.seriesNames.push(c.labels[r]||"series-".concat(r+1));return this.w}var E=this.extractPieDataFromSeries(t);a.series=E.values,a.seriesNames=E.labels,c.chart.type==="radialBar"&&(a.series=a.series.map(function(P){var L=et.parseNumber(P);return L>100&&console.warn("ApexCharts: RadialBar value ".concat(L," > 100, consider using percentage values (0-100)")),L}));for(var k=0;k<a.series.length;k++)a.seriesNames[k]===void 0&&a.seriesNames.push("series-"+(k+1));return this.w}},{key:"resetParsingFlags",value:function(){var t=this.w;t.globals.dataWasParsed=!1,t.globals.originalSeries=null,t.config.series&&t.config.series.forEach(function(a){a.__apexParsed&&delete a.__apexParsed})}},{key:"extractPieDataFromSeries",value:function(t){var a=[],c=[];if(!Array.isArray(t))return console.warn("ApexCharts: Expected array for series data"),{values:[],labels:[]};if(t.length===0)return console.warn("ApexCharts: Empty series array"),{values:[],labels:[]};var f=t[0];return Cn(f)==="object"&&f!==null&&f.data?(this.extractPieDataFromSeriesObjects(t,a,c),{values:a,labels:c}):(console.warn("ApexCharts: Unsupported series format for pie/donut/radialBar. Expected series objects with data property."),{values:[],labels:[]})}},{key:"extractPieDataFromSeriesObjects",value:function(t,a,c){t.forEach(function(f,_){f.data&&Array.isArray(f.data)?f.data.forEach(function(v){Cn(v)==="object"&&v!==null?v.x!==void 0&&v.y!==void 0?(c.push(String(v.x)),a.push(et.parseNumber(v.y))):console.warn("ApexCharts: Invalid data point format for pie chart. Expected {x, y} format:",v):console.warn("ApexCharts: Expected object data point, got:",Cn(v))}):console.warn("ApexCharts: Series ".concat(_," has no valid data array"))})}},{key:"handleExternalLabelsData",value:function(t){var a=this.w.config,c=this.w.globals;a.xaxis.categories.length>0?c.labels=a.xaxis.categories:a.labels.length>0?c.labels=a.labels.slice():this.fallbackToCategory?(c.labels=c.labels[0],c.seriesRange.length&&(c.seriesRange.map(function(f){f.forEach(function(_){c.labels.indexOf(_.x)<0&&_.x&&c.labels.push(_.x)})}),c.labels=Array.from(new Set(c.labels.map(JSON.stringify)),JSON.parse)),a.xaxis.convertedCatToNumeric&&(new Yf(a).convertCatToNumericXaxis(a,this.ctx,c.seriesX[0]),this._generateExternalLabels(t))):this._generateExternalLabels(t)}},{key:"_generateExternalLabels",value:function(t){var a=this.w.globals,c=this.w.config,f=[];if(a.axisCharts){if(a.series.length>0)if(this.isFormatXY())for(var _=c.series.map(function(L,O){return L.data.filter(function(N,G,H){return H.findIndex(function(Q){return Q.x===N.x})===G})}),v=_.reduce(function(L,O,N,G){return G[L].length>O.length?L:N},0),r=0;r<_[v].length;r++)f.push(r+1);else for(var E=0;E<a.series[a.maxValsInArrayIndex].length;E++)f.push(E+1);a.seriesX=[];for(var k=0;k<t.length;k++)a.seriesX.push(f);this.w.globals.isBarHorizontal||(a.isXNumeric=!0)}if(f.length===0){f=a.axisCharts?[]:a.series.map(function(L,O){return O+1});for(var P=0;P<t.length;P++)a.seriesX.push(f)}a.labels=f,c.xaxis.convertedCatToNumeric&&(a.categoryLabels=f.map(function(L){return c.xaxis.labels.formatter(L)})),a.noLabelsProvided=!0}},{key:"parseRawDataIfNeeded",value:function(t){var a=this,c=this.w.config,f=this.w.globals,_=c.parsing;if(f.dataWasParsed||!_&&!t.some(function(r){return r.parsing}))return t;var v=t.map(function(r,E){var k,P,L;if(!r.data||!Array.isArray(r.data)||r.data.length===0)return r;var O={x:((k=r.parsing)===null||k===void 0?void 0:k.x)||(_==null?void 0:_.x),y:((P=r.parsing)===null||P===void 0?void 0:P.y)||(_==null?void 0:_.y),z:((L=r.parsing)===null||L===void 0?void 0:L.z)||(_==null?void 0:_.z)};if(!O.x&&!O.y)return r;var N=r.data[0];if(Cn(N)==="object"&&N!==null&&(N.hasOwnProperty("x")||N.hasOwnProperty("y"))||Array.isArray(N))return r;if(!O.x||!O.y||Array.isArray(O.y)&&O.y.length===0)return console.warn("ApexCharts: Series ".concat(E," has parsing config but missing x or y field specification")),r;var G=r.data.map(function(H,Q){if(Cn(H)!=="object"||H===null)return console.warn("ApexCharts: Series ".concat(E,", data point ").concat(Q," is not an object, skipping parsing")),H;var ee,ie=a.getNestedValue(H,O.x),ue=void 0;if(Array.isArray(O.y)){var ve=O.y.map(function(Se){return a.getNestedValue(H,Se)});ee=a.w.config.chart.type==="bubble"&&ve.length===2?ve[0]:ve}else ee=a.getNestedValue(H,O.y);O.z&&(ue=a.getNestedValue(H,O.z)),ie===void 0&&console.warn("ApexCharts: Series ".concat(E,", data point ").concat(Q," missing field '").concat(O.x,"'")),ee===void 0&&console.warn("ApexCharts: Series ".concat(E,", data point ").concat(Q," missing field '").concat(O.y,"'"));var ce={x:ie,y:ee};if(a.w.config.chart.type==="bubble"&&Array.isArray(O.y)&&O.y.length===2){var Te=a.getNestedValue(H,O.y[1]);Te!==void 0&&(ce.z=Te)}return ue!==void 0&&(ce.z=ue),ce});return Jt(Jt({},r),{},{data:G,__apexParsed:!0})});return f.dataWasParsed=!0,f.originalSeries||(f.originalSeries=et.clone(t)),v}},{key:"getNestedValue",value:function(t,a){if(t&&Cn(t)==="object"&&a){if(a.indexOf(".")===-1)return t[a];for(var c=a.split("."),f=t,_=0;_<c.length;_++){if(f==null||Cn(f)!=="object")return;f=f[c[_]]}return f}}},{key:"parseData",value:function(t){var a=this.w,c=a.config,f=a.globals;if(t=this.parseRawDataIfNeeded(t),c.series=t,f.initialSeries=et.clone(t),this.excludeCollapsedSeriesInYAxis(),this.fallbackToCategory=!1,this.ctx.core.resetGlobals(),this.ctx.core.isMultipleY(),f.axisCharts?(this.parseDataAxisCharts(t),this.coreUtils.getLargestSeries()):this.parseDataNonAxisCharts(t),c.chart.stacked){var _=new fa(this.ctx);f.series=_.setNullSeriesToZeroValues(f.series)}this.coreUtils.getSeriesTotals(),f.axisCharts&&(f.stackedSeriesTotals=this.coreUtils.getStackedSeriesTotals(),f.stackedSeriesTotalsByGroups=this.coreUtils.getStackedSeriesTotalsByGroups()),this.coreUtils.getPercentSeries(),f.dataFormatXNumeric||f.isXNumeric&&(c.xaxis.type!=="numeric"||c.labels.length!==0||c.xaxis.categories.length!==0)||this.handleExternalLabelsData(t);for(var v=this.coreUtils.getCategoryLabels(f.labels),r=0;r<v.length;r++)if(Array.isArray(v[r])){f.isMultiLineX=!0;break}}},{key:"excludeCollapsedSeriesInYAxis",value:function(){var t=this.w,a=[];t.globals.seriesYAxisMap.forEach(function(c,f){var _=0;c.forEach(function(v){t.globals.collapsedSeriesIndices.indexOf(v)!==-1&&_++}),_>0&&_==c.length&&a.push(f)}),t.globals.ignoreYAxisIndexes=a.map(function(c){return c})}}]),S}(),Hf=function(){function S(t){pi(this,S),this.ctx=t,this.w=t.w}return gi(S,[{key:"svgStringToNode",value:function(t){return new DOMParser().parseFromString(t,"image/svg+xml").documentElement}},{key:"scaleSvgNode",value:function(t,a){var c=parseFloat(t.getAttributeNS(null,"width")),f=parseFloat(t.getAttributeNS(null,"height"));t.setAttributeNS(null,"width",c*a),t.setAttributeNS(null,"height",f*a),t.setAttributeNS(null,"viewBox","0 0 "+c+" "+f)}},{key:"getSvgString",value:function(t){var a=this;return new Promise(function(c){var f=a.w,_=t||f.config.chart.toolbar.export.scale||f.config.chart.toolbar.export.width/f.globals.svgWidth;_||(_=1);var v=f.globals.svgWidth*_,r=f.globals.svgHeight*_,E=f.globals.dom.elWrap.cloneNode(!0);E.style.width=v+"px",E.style.height=r+"px";var k=new XMLSerializer().serializeToString(E),P=`
        .apexcharts-tooltip, .apexcharts-toolbar, .apexcharts-xaxistooltip, .apexcharts-yaxistooltip, .apexcharts-xcrosshairs, .apexcharts-ycrosshairs, .apexcharts-zoom-rect, .apexcharts-selection-rect {
          display: none;
        }
      `;f.config.legend.show&&f.globals.dom.elLegendWrap&&f.globals.dom.elLegendWrap.children.length>0&&(P+=E1);var L=`
        <svg xmlns="http://www.w3.org/2000/svg"
          version="1.1"
          xmlns:xlink="http://www.w3.org/1999/xlink"
          class="apexcharts-svg"
          xmlns:data="ApexChartsNS"
          transform="translate(0, 0)"
          width="`.concat(f.globals.svgWidth,'px" height="').concat(f.globals.svgHeight,`px">
          <foreignObject width="100%" height="100%">
            <div xmlns="http://www.w3.org/1999/xhtml" style="width:`).concat(v,"px; height:").concat(r,`px;">
            <style type="text/css">
              `).concat(P,`
            </style>
              `).concat(k,`
            </div>
          </foreignObject>
        </svg>
      `),O=a.svgStringToNode(L);_!==1&&a.scaleSvgNode(O,_),a.convertImagesToBase64(O).then(function(){L=new XMLSerializer().serializeToString(O),c(L.replace(/&nbsp;/g,"&#160;"))})})}},{key:"convertImagesToBase64",value:function(t){var a=this,c=t.getElementsByTagName("image"),f=Array.from(c).map(function(_){var v=_.getAttributeNS("http://www.w3.org/1999/xlink","href");return v&&!v.startsWith("data:")?a.getBase64FromUrl(v).then(function(r){_.setAttributeNS("http://www.w3.org/1999/xlink","href",r)}).catch(function(r){console.error("Error converting image to base64:",r)}):Promise.resolve()});return Promise.all(f)}},{key:"getBase64FromUrl",value:function(t){return new Promise(function(a,c){var f=new Image;f.crossOrigin="Anonymous",f.onload=function(){var _=document.createElement("canvas");_.width=f.width,_.height=f.height,_.getContext("2d").drawImage(f,0,0),a(_.toDataURL())},f.onerror=c,f.src=t})}},{key:"svgUrl",value:function(){var t=this;return new Promise(function(a){t.getSvgString().then(function(c){var f=new Blob([c],{type:"image/svg+xml;charset=utf-8"});a(URL.createObjectURL(f))})})}},{key:"dataURI",value:function(t){var a=this;return new Promise(function(c){var f=a.w,_=t?t.scale||t.width/f.globals.svgWidth:1,v=document.createElement("canvas");v.width=f.globals.svgWidth*_,v.height=parseInt(f.globals.dom.elWrap.style.height,10)*_;var r=f.config.chart.background!=="transparent"&&f.config.chart.background?f.config.chart.background:"#fff",E=v.getContext("2d");E.fillStyle=r,E.fillRect(0,0,v.width*_,v.height*_),a.getSvgString(_).then(function(k){var P="data:image/svg+xml,"+encodeURIComponent(k),L=new Image;L.crossOrigin="anonymous",L.onload=function(){if(E.drawImage(L,0,0),v.msToBlob){var O=v.msToBlob();c({blob:O})}else{var N=v.toDataURL("image/png");c({imgURI:N})}},L.src=P})})}},{key:"exportToSVG",value:function(){var t=this;this.svgUrl().then(function(a){t.triggerDownload(a,t.w.config.chart.toolbar.export.svg.filename,".svg")})}},{key:"exportToPng",value:function(){var t=this,a=this.w.config.chart.toolbar.export.scale,c=this.w.config.chart.toolbar.export.width,f=a?{scale:a}:c?{width:c}:void 0;this.dataURI(f).then(function(_){var v=_.imgURI,r=_.blob;r?navigator.msSaveOrOpenBlob(r,t.w.globals.chartID+".png"):t.triggerDownload(v,t.w.config.chart.toolbar.export.png.filename,".png")})}},{key:"exportToCSV",value:function(t){var a=this,c=t.series,f=t.fileName,_=t.columnDelimiter,v=_===void 0?",":_,r=t.lineDelimiter,E=r===void 0?`
`:r,k=this.w;c||(c=k.config.series);var P=[],L=[],O="",N=k.globals.series.map(function(ce,Te){return k.globals.collapsedSeriesIndices.indexOf(Te)===-1?ce:[]}),G=function(ce){return typeof k.config.chart.toolbar.export.csv.categoryFormatter=="function"?k.config.chart.toolbar.export.csv.categoryFormatter(ce):k.config.xaxis.type==="datetime"&&String(ce).length>=10?new Date(ce).toDateString():et.isNumber(ce)?ce:ce.split(v).join("")},H=function(ce){return typeof k.config.chart.toolbar.export.csv.valueFormatter=="function"?k.config.chart.toolbar.export.csv.valueFormatter(ce):ce},Q=Math.max.apply(Math,Us(c.map(function(ce){return ce.data?ce.data.length:0}))),ee=new gx(this.ctx),ie=new Wl(this.ctx),ue=function(ce){var Te="";if(k.globals.axisCharts){if(k.config.xaxis.type==="category"||k.config.xaxis.convertedCatToNumeric)if(k.globals.isBarHorizontal){var Se=k.globals.yLabelFormatters[0],Ie=new fa(a.ctx).getActiveConfigSeriesIndex();Te=Se(k.globals.labels[ce],{seriesIndex:Ie,dataPointIndex:ce,w:k})}else Te=ie.getLabel(k.globals.labels,k.globals.timescaleLabels,0,ce).text;k.config.xaxis.type==="datetime"&&(k.config.xaxis.categories.length?Te=k.config.xaxis.categories[ce]:k.config.labels.length&&(Te=k.config.labels[ce]))}else Te=k.config.labels[ce];return Te===null?"nullvalue":(Array.isArray(Te)&&(Te=Te.join(" ")),et.isNumber(Te)?Te:Te.split(v).join(""))},ve=function(ce,Te){if(P.length&&Te===0&&L.push(P.join(v)),ce.data){ce.data=ce.data.length&&ce.data||Us(Array(Q)).map(function(){return""});for(var Se=0;Se<ce.data.length;Se++){P=[];var Ie=ue(Se);if(Ie!=="nullvalue"){if(Ie||(ee.isFormatXY()?Ie=c[Te].data[Se].x:ee.isFormat2DArray()&&(Ie=c[Te].data[Se]?c[Te].data[Se][0]:"")),Te===0){P.push(G(Ie));for(var Ue=0;Ue<k.globals.series.length;Ue++){var Ke,qe=ee.isFormatXY()?(Ke=c[Ue].data[Se])===null||Ke===void 0?void 0:Ke.y:N[Ue][Se];P.push(H(qe))}}(k.config.chart.type==="candlestick"||ce.type&&ce.type==="candlestick")&&(P.pop(),P.push(k.globals.seriesCandleO[Te][Se]),P.push(k.globals.seriesCandleH[Te][Se]),P.push(k.globals.seriesCandleL[Te][Se]),P.push(k.globals.seriesCandleC[Te][Se])),(k.config.chart.type==="boxPlot"||ce.type&&ce.type==="boxPlot")&&(P.pop(),P.push(k.globals.seriesCandleO[Te][Se]),P.push(k.globals.seriesCandleH[Te][Se]),P.push(k.globals.seriesCandleM[Te][Se]),P.push(k.globals.seriesCandleL[Te][Se]),P.push(k.globals.seriesCandleC[Te][Se])),k.config.chart.type==="rangeBar"&&(P.pop(),P.push(k.globals.seriesRangeStart[Te][Se]),P.push(k.globals.seriesRangeEnd[Te][Se])),P.length&&L.push(P.join(v))}}}};P.push(k.config.chart.toolbar.export.csv.headerCategory),k.config.chart.type==="boxPlot"?(P.push("minimum"),P.push("q1"),P.push("median"),P.push("q3"),P.push("maximum")):k.config.chart.type==="candlestick"?(P.push("open"),P.push("high"),P.push("low"),P.push("close")):k.config.chart.type==="rangeBar"?(P.push("minimum"),P.push("maximum")):c.map(function(ce,Te){var Se=(ce.name?ce.name:"series-".concat(Te))+"";k.globals.axisCharts&&P.push(Se.split(v).join("")?Se.split(v).join(""):"series-".concat(Te))}),k.globals.axisCharts||(P.push(k.config.chart.toolbar.export.csv.headerValue),L.push(P.join(v))),k.globals.allSeriesHasEqualX||!k.globals.axisCharts||k.config.xaxis.categories.length||k.config.labels.length?c.map(function(ce,Te){k.globals.axisCharts?ve(ce,Te):((P=[]).push(G(k.globals.labels[Te])),P.push(H(N[Te])),L.push(P.join(v)))}):function(){var ce=new Set,Te={};c.forEach(function(Se,Ie){Se==null||Se.data.forEach(function(Ue){var Ke,qe;if(ee.isFormatXY())Ke=Ue.x,qe=Ue.y;else{if(!ee.isFormat2DArray())return;Ke=Ue[0],qe=Ue[1]}Te[Ke]||(Te[Ke]=Array(c.length).fill("")),Te[Ke][Ie]=H(qe),ce.add(Ke)})}),P.length&&L.push(P.join(v)),Array.from(ce).sort().forEach(function(Se){L.push([G(Se),Te[Se].join(v)])})}(),O+=L.join(E),this.triggerDownload("data:text/csv; charset=utf-8,"+encodeURIComponent("\uFEFF"+O),f||k.config.chart.toolbar.export.csv.filename,".csv")}},{key:"triggerDownload",value:function(t,a,c){var f=document.createElement("a");f.href=t,f.download=(a||this.w.globals.chartID)+c,document.body.appendChild(f),f.click(),document.body.removeChild(f)}}]),S}(),Zf=function(){function S(t,a){pi(this,S),this.ctx=t,this.elgrid=a,this.w=t.w;var c=this.w;this.axesUtils=new Wl(t),this.xaxisLabels=c.globals.labels.slice(),c.globals.timescaleLabels.length>0&&!c.globals.isBarHorizontal&&(this.xaxisLabels=c.globals.timescaleLabels.slice()),c.config.xaxis.overwriteCategories&&(this.xaxisLabels=c.config.xaxis.overwriteCategories),this.drawnLabels=[],this.drawnLabelsRects=[],c.config.xaxis.position==="top"?this.offY=0:this.offY=c.globals.gridHeight,this.offY=this.offY+c.config.xaxis.axisBorder.offsetY,this.isCategoryBarHorizontal=c.config.chart.type==="bar"&&c.config.plotOptions.bar.horizontal,this.xaxisFontSize=c.config.xaxis.labels.style.fontSize,this.xaxisFontFamily=c.config.xaxis.labels.style.fontFamily,this.xaxisForeColors=c.config.xaxis.labels.style.colors,this.xaxisBorderWidth=c.config.xaxis.axisBorder.width,this.isCategoryBarHorizontal&&(this.xaxisBorderWidth=c.config.yaxis[0].axisBorder.width.toString()),String(this.xaxisBorderWidth).indexOf("%")>-1?this.xaxisBorderWidth=c.globals.gridWidth*parseInt(this.xaxisBorderWidth,10)/100:this.xaxisBorderWidth=parseInt(this.xaxisBorderWidth,10),this.xaxisBorderHeight=c.config.xaxis.axisBorder.height,this.yaxis=c.config.yaxis[0]}return gi(S,[{key:"drawXaxis",value:function(){var t=this.w,a=new Nt(this.ctx),c=a.group({class:"apexcharts-xaxis",transform:"translate(".concat(t.config.xaxis.offsetX,", ").concat(t.config.xaxis.offsetY,")")}),f=a.group({class:"apexcharts-xaxis-texts-g",transform:"translate(".concat(t.globals.translateXAxisX,", ").concat(t.globals.translateXAxisY,")")});c.add(f);for(var _=[],v=0;v<this.xaxisLabels.length;v++)_.push(this.xaxisLabels[v]);if(this.drawXAxisLabelAndGroup(!0,a,f,_,t.globals.isXNumeric,function(G,H){return H}),t.globals.hasXaxisGroups){var r=t.globals.groups;_=[];for(var E=0;E<r.length;E++)_.push(r[E].title);var k={};t.config.xaxis.group.style&&(k.xaxisFontSize=t.config.xaxis.group.style.fontSize,k.xaxisFontFamily=t.config.xaxis.group.style.fontFamily,k.xaxisForeColors=t.config.xaxis.group.style.colors,k.fontWeight=t.config.xaxis.group.style.fontWeight,k.cssClass=t.config.xaxis.group.style.cssClass),this.drawXAxisLabelAndGroup(!1,a,f,_,!1,function(G,H){return r[G].cols*H},k)}if(t.config.xaxis.title.text!==void 0){var P=a.group({class:"apexcharts-xaxis-title"}),L=a.drawText({x:t.globals.gridWidth/2+t.config.xaxis.title.offsetX,y:this.offY+parseFloat(this.xaxisFontSize)+(t.config.xaxis.position==="bottom"?t.globals.xAxisLabelsHeight:-t.globals.xAxisLabelsHeight-10)+t.config.xaxis.title.offsetY,text:t.config.xaxis.title.text,textAnchor:"middle",fontSize:t.config.xaxis.title.style.fontSize,fontFamily:t.config.xaxis.title.style.fontFamily,fontWeight:t.config.xaxis.title.style.fontWeight,foreColor:t.config.xaxis.title.style.color,cssClass:"apexcharts-xaxis-title-text "+t.config.xaxis.title.style.cssClass});P.add(L),c.add(P)}if(t.config.xaxis.axisBorder.show){var O=t.globals.barPadForNumericAxis,N=a.drawLine(t.globals.padHorizontal+t.config.xaxis.axisBorder.offsetX-O,this.offY,this.xaxisBorderWidth+O,this.offY,t.config.xaxis.axisBorder.color,0,this.xaxisBorderHeight);this.elgrid&&this.elgrid.elGridBorders&&t.config.grid.show?this.elgrid.elGridBorders.add(N):c.add(N)}return c}},{key:"drawXAxisLabelAndGroup",value:function(t,a,c,f,_,v){var r,E=this,k=arguments.length>6&&arguments[6]!==void 0?arguments[6]:{},P=[],L=[],O=this.w,N=k.xaxisFontSize||this.xaxisFontSize,G=k.xaxisFontFamily||this.xaxisFontFamily,H=k.xaxisForeColors||this.xaxisForeColors,Q=k.fontWeight||O.config.xaxis.labels.style.fontWeight,ee=k.cssClass||O.config.xaxis.labels.style.cssClass,ie=O.globals.padHorizontal,ue=f.length,ve=O.config.xaxis.type==="category"?O.globals.dataPoints:ue;if(ve===0&&ue>ve&&(ve=ue),_){var ce=Math.max(Number(O.config.xaxis.tickAmount)||1,ve>1?ve-1:ve);r=O.globals.gridWidth/Math.min(ce,ue-1),ie=ie+v(0,r)/2+O.config.xaxis.labels.offsetX}else r=O.globals.gridWidth/ve,ie=ie+v(0,r)+O.config.xaxis.labels.offsetX;for(var Te=function(Ie){var Ue=ie-v(Ie,r)/2+O.config.xaxis.labels.offsetX;Ie===0&&ue===1&&r/2===ie&&ve===1&&(Ue=O.globals.gridWidth/2);var Ke=E.axesUtils.getLabel(f,O.globals.timescaleLabels,Ue,Ie,P,N,t),qe=28;if(O.globals.rotateXLabels&&t&&(qe=22),O.config.xaxis.title.text&&O.config.xaxis.position==="top"&&(qe+=parseFloat(O.config.xaxis.title.style.fontSize)+2),t||(qe=qe+parseFloat(N)+(O.globals.xAxisLabelsHeight-O.globals.xAxisGroupLabelsHeight)+(O.globals.rotateXLabels?10:0)),Ke=O.config.xaxis.tickAmount!==void 0&&O.config.xaxis.tickAmount!=="dataPoints"&&O.config.xaxis.type!=="datetime"?E.axesUtils.checkLabelBasedOnTickamount(Ie,Ke,ue):E.axesUtils.checkForOverflowingLabels(Ie,Ke,ue,P,L),O.config.xaxis.labels.show){var ft=a.drawText({x:Ke.x,y:E.offY+O.config.xaxis.labels.offsetY+qe-(O.config.xaxis.position==="top"?O.globals.xAxisHeight+O.config.xaxis.axisTicks.height-2:0),text:Ke.text,textAnchor:"middle",fontWeight:Ke.isBold?600:Q,fontSize:N,fontFamily:G,foreColor:Array.isArray(H)?t&&O.config.xaxis.convertedCatToNumeric?H[O.globals.minX+Ie-1]:H[Ie]:H,isPlainText:!1,cssClass:(t?"apexcharts-xaxis-label ":"apexcharts-xaxis-group-label ")+ee});if(c.add(ft),ft.on("click",function(Tt){if(typeof O.config.chart.events.xAxisLabelClick=="function"){var Et=Object.assign({},O,{labelIndex:Ie});O.config.chart.events.xAxisLabelClick(Tt,E.ctx,Et)}}),t){var bt=document.createElementNS(O.globals.SVGNS,"title");bt.textContent=Array.isArray(Ke.text)?Ke.text.join(" "):Ke.text,ft.node.appendChild(bt),Ke.text!==""&&(P.push(Ke.text),L.push(Ke))}}Ie<ue-1&&(ie+=v(Ie+1,r))},Se=0;Se<=ue-1;Se++)Te(Se)}},{key:"drawXaxisInversed",value:function(t){var a,c,f=this,_=this.w,v=new Nt(this.ctx),r=_.config.yaxis[0].opposite?_.globals.translateYAxisX[t]:0,E=v.group({class:"apexcharts-yaxis apexcharts-xaxis-inversed",rel:t}),k=v.group({class:"apexcharts-yaxis-texts-g apexcharts-xaxis-inversed-texts-g",transform:"translate("+r+", 0)"});E.add(k);var P=[];if(_.config.yaxis[t].show)for(var L=0;L<this.xaxisLabels.length;L++)P.push(this.xaxisLabels[L]);a=_.globals.gridHeight/P.length,c=-a/2.2;var O=_.globals.yLabelFormatters[0],N=_.config.yaxis[0].labels;if(N.show)for(var G=function(ce){var Te=P[ce]===void 0?"":P[ce];Te=O(Te,{seriesIndex:t,dataPointIndex:ce,w:_});var Se=f.axesUtils.getYAxisForeColor(N.style.colors,t),Ie=0;Array.isArray(Te)&&(Ie=Te.length/2*parseInt(N.style.fontSize,10));var Ue=N.offsetX-15,Ke="end";f.yaxis.opposite&&(Ke="start"),_.config.yaxis[0].labels.align==="left"?(Ue=N.offsetX,Ke="start"):_.config.yaxis[0].labels.align==="center"?(Ue=N.offsetX,Ke="middle"):_.config.yaxis[0].labels.align==="right"&&(Ke="end");var qe=v.drawText({x:Ue,y:c+a+N.offsetY-Ie,text:Te,textAnchor:Ke,foreColor:Array.isArray(Se)?Se[ce]:Se,fontSize:N.style.fontSize,fontFamily:N.style.fontFamily,fontWeight:N.style.fontWeight,isPlainText:!1,cssClass:"apexcharts-yaxis-label "+N.style.cssClass,maxWidth:N.maxWidth});k.add(qe),qe.on("click",function(Tt){if(typeof _.config.chart.events.xAxisLabelClick=="function"){var Et=Object.assign({},_,{labelIndex:ce});_.config.chart.events.xAxisLabelClick(Tt,f.ctx,Et)}});var ft=document.createElementNS(_.globals.SVGNS,"title");if(ft.textContent=Array.isArray(Te)?Te.join(" "):Te,qe.node.appendChild(ft),_.config.yaxis[t].labels.rotate!==0){var bt=v.rotateAroundCenter(qe.node);qe.node.setAttribute("transform","rotate(".concat(_.config.yaxis[t].labels.rotate," 0 ").concat(bt.y,")"))}c+=a},H=0;H<=P.length-1;H++)G(H);if(_.config.yaxis[0].title.text!==void 0){var Q=v.group({class:"apexcharts-yaxis-title apexcharts-xaxis-title-inversed",transform:"translate("+r+", 0)"}),ee=v.drawText({x:_.config.yaxis[0].title.offsetX,y:_.globals.gridHeight/2+_.config.yaxis[0].title.offsetY,text:_.config.yaxis[0].title.text,textAnchor:"middle",foreColor:_.config.yaxis[0].title.style.color,fontSize:_.config.yaxis[0].title.style.fontSize,fontWeight:_.config.yaxis[0].title.style.fontWeight,fontFamily:_.config.yaxis[0].title.style.fontFamily,cssClass:"apexcharts-yaxis-title-text "+_.config.yaxis[0].title.style.cssClass});Q.add(ee),E.add(Q)}var ie=0;this.isCategoryBarHorizontal&&_.config.yaxis[0].opposite&&(ie=_.globals.gridWidth);var ue=_.config.xaxis.axisBorder;if(ue.show){var ve=v.drawLine(_.globals.padHorizontal+ue.offsetX+ie,1+ue.offsetY,_.globals.padHorizontal+ue.offsetX+ie,_.globals.gridHeight+ue.offsetY,ue.color,0);this.elgrid&&this.elgrid.elGridBorders&&_.config.grid.show?this.elgrid.elGridBorders.add(ve):E.add(ve)}return _.config.yaxis[0].axisTicks.show&&this.axesUtils.drawYAxisTicks(ie,P.length,_.config.yaxis[0].axisBorder,_.config.yaxis[0].axisTicks,0,a,E),E}},{key:"drawXaxisTicks",value:function(t,a,c){var f=this.w,_=t;if(!(t<0||t-2>f.globals.gridWidth)){var v=this.offY+f.config.xaxis.axisTicks.offsetY;if(a=a+v+f.config.xaxis.axisTicks.height,f.config.xaxis.position==="top"&&(a=v-f.config.xaxis.axisTicks.height),f.config.xaxis.axisTicks.show){var r=new Nt(this.ctx).drawLine(t+f.config.xaxis.axisTicks.offsetX,v+f.config.xaxis.offsetY,_+f.config.xaxis.axisTicks.offsetX,a+f.config.xaxis.offsetY,f.config.xaxis.axisTicks.color);c.add(r),r.node.classList.add("apexcharts-xaxis-tick")}}}},{key:"getXAxisTicksPositions",value:function(){var t=this.w,a=[],c=this.xaxisLabels.length,f=t.globals.padHorizontal;if(t.globals.timescaleLabels.length>0)for(var _=0;_<c;_++)f=this.xaxisLabels[_].position,a.push(f);else for(var v=c,r=0;r<v;r++){var E=v;t.globals.isXNumeric&&t.config.chart.type!=="bar"&&(E-=1),f+=t.globals.gridWidth/E,a.push(f)}return a}},{key:"xAxisLabelCorrections",value:function(){var t=this.w,a=new Nt(this.ctx),c=t.globals.dom.baseEl.querySelector(".apexcharts-xaxis-texts-g"),f=t.globals.dom.baseEl.querySelectorAll(".apexcharts-xaxis-texts-g text:not(.apexcharts-xaxis-group-label)"),_=t.globals.dom.baseEl.querySelectorAll(".apexcharts-yaxis-inversed text"),v=t.globals.dom.baseEl.querySelectorAll(".apexcharts-xaxis-inversed-texts-g text tspan");if(t.globals.rotateXLabels||t.config.xaxis.labels.rotateAlways)for(var r=0;r<f.length;r++){var E=a.rotateAroundCenter(f[r]);E.y=E.y-1,E.x=E.x+1,f[r].setAttribute("transform","rotate(".concat(t.config.xaxis.labels.rotate," ").concat(E.x," ").concat(E.y,")")),f[r].setAttribute("text-anchor","end"),c.setAttribute("transform","translate(0, ".concat(-10,")"));var k=f[r].childNodes;t.config.xaxis.labels.trim&&Array.prototype.forEach.call(k,function(N){a.placeTextWithEllipsis(N,N.textContent,t.globals.xAxisLabelsHeight-(t.config.legend.position==="bottom"?20:10))})}else(function(){for(var N=t.globals.gridWidth/(t.globals.labels.length+1),G=0;G<f.length;G++){var H=f[G].childNodes;t.config.xaxis.labels.trim&&t.config.xaxis.type!=="datetime"&&Array.prototype.forEach.call(H,function(Q){a.placeTextWithEllipsis(Q,Q.textContent,N)})}})();if(_.length>0){var P=_[_.length-1].getBBox(),L=_[0].getBBox();P.x<-20&&_[_.length-1].parentNode.removeChild(_[_.length-1]),L.x+L.width>t.globals.gridWidth&&!t.globals.isBarHorizontal&&_[0].parentNode.removeChild(_[0]);for(var O=0;O<v.length;O++)a.placeTextWithEllipsis(v[O],v[O].textContent,t.config.yaxis[0].labels.maxWidth-(t.config.yaxis[0].title.text?2*parseFloat(t.config.yaxis[0].title.style.fontSize):0)-15)}}}]),S}(),C1=function(){function S(t){pi(this,S),this.ctx=t,this.w=t.w;var a=this.w;this.xaxisLabels=a.globals.labels.slice(),this.axesUtils=new Wl(t),this.isRangeBar=a.globals.seriesRange.length&&a.globals.isBarHorizontal,a.globals.timescaleLabels.length>0&&(this.xaxisLabels=a.globals.timescaleLabels.slice())}return gi(S,[{key:"drawGridArea",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,a=this.w,c=new Nt(this.ctx);t||(t=c.group({class:"apexcharts-grid"}));var f=c.drawLine(a.globals.padHorizontal,1,a.globals.padHorizontal,a.globals.gridHeight,"transparent"),_=c.drawLine(a.globals.padHorizontal,a.globals.gridHeight,a.globals.gridWidth,a.globals.gridHeight,"transparent");return t.add(_),t.add(f),t}},{key:"drawGrid",value:function(){if(this.w.globals.axisCharts){var t=this.renderGrid();return this.drawGridArea(t.el),t}return null}},{key:"createGridMask",value:function(){var t=this.w,a=t.globals,c=new Nt(this.ctx),f=Array.isArray(t.config.stroke.width)?Math.max.apply(Math,Us(t.config.stroke.width)):t.config.stroke.width,_=function(P){var L=document.createElementNS(a.SVGNS,"clipPath");return L.setAttribute("id",P),L};a.dom.elGridRectMask=_("gridRectMask".concat(a.cuid)),a.dom.elGridRectBarMask=_("gridRectBarMask".concat(a.cuid)),a.dom.elGridRectMarkerMask=_("gridRectMarkerMask".concat(a.cuid)),a.dom.elForecastMask=_("forecastMask".concat(a.cuid)),a.dom.elNonForecastMask=_("nonForecastMask".concat(a.cuid));var v=0,r=0;(["bar","rangeBar","candlestick","boxPlot"].includes(t.config.chart.type)||t.globals.comboBarCount>0)&&t.globals.isXNumeric&&!t.globals.isBarHorizontal&&(v=Math.max(t.config.grid.padding.left,a.barPadForNumericAxis),r=Math.max(t.config.grid.padding.right,a.barPadForNumericAxis)),a.dom.elGridRect=c.drawRect(-f/2-2,-f/2-2,a.gridWidth+f+4,a.gridHeight+f+4,0,"#fff"),a.dom.elGridRectBar=c.drawRect(-f/2-v-2,-f/2-2,a.gridWidth+f+r+v+4,a.gridHeight+f+4,0,"#fff");var E=t.globals.markers.largestSize;a.dom.elGridRectMarker=c.drawRect(Math.min(-f/2-v-2,-E),-E,a.gridWidth+Math.max(f+r+v+4,2*E),a.gridHeight+2*E,0,"#fff"),a.dom.elGridRectMask.appendChild(a.dom.elGridRect.node),a.dom.elGridRectBarMask.appendChild(a.dom.elGridRectBar.node),a.dom.elGridRectMarkerMask.appendChild(a.dom.elGridRectMarker.node);var k=a.dom.baseEl.querySelector("defs");k.appendChild(a.dom.elGridRectMask),k.appendChild(a.dom.elGridRectBarMask),k.appendChild(a.dom.elGridRectMarkerMask),k.appendChild(a.dom.elForecastMask),k.appendChild(a.dom.elNonForecastMask)}},{key:"_drawGridLines",value:function(t){var a=t.i,c=t.x1,f=t.y1,_=t.x2,v=t.y2,r=t.xCount,E=t.parent,k=this.w;if(!(a===0&&k.globals.skipFirstTimelinelabel||a===r-1&&k.globals.skipLastTimelinelabel&&!k.config.xaxis.labels.formatter||k.config.chart.type==="radar")){k.config.grid.xaxis.lines.show&&this._drawGridLine({i:a,x1:c,y1:f,x2:_,y2:v,xCount:r,parent:E});var P=0;if(k.globals.hasXaxisGroups&&k.config.xaxis.tickPlacement==="between"){var L=k.globals.groups;if(L){for(var O=0,N=0;O<a&&N<L.length;N++)O+=L[N].cols;O===a&&(P=.6*k.globals.xAxisLabelsHeight)}}new Zf(this.ctx).drawXaxisTicks(c,P,k.globals.dom.elGraphical)}}},{key:"_drawGridLine",value:function(t){var a=t.i,c=t.x1,f=t.y1,_=t.x2,v=t.y2,r=t.xCount,E=t.parent,k=this.w,P=E.node.classList.contains("apexcharts-gridlines-horizontal"),L=k.globals.barPadForNumericAxis,O=f===0&&v===0||c===0&&_===0||f===k.globals.gridHeight&&v===k.globals.gridHeight||k.globals.isBarHorizontal&&(a===0||a===r-1),N=new Nt(this).drawLine(c-(P?L:0),f,_+(P?L:0),v,k.config.grid.borderColor,k.config.grid.strokeDashArray);N.node.classList.add("apexcharts-gridline"),O&&k.config.grid.show?this.elGridBorders.add(N):E.add(N)}},{key:"_drawGridBandRect",value:function(t){var a=t.c,c=t.x1,f=t.y1,_=t.x2,v=t.y2,r=t.type,E=this.w,k=new Nt(this.ctx),P=E.globals.barPadForNumericAxis,L=E.config.grid[r].colors[a],O=k.drawRect(c-(r==="row"?P:0),f,_+(r==="row"?2*P:0),v,0,L,E.config.grid[r].opacity);this.elg.add(O),O.attr("clip-path","url(#gridRectMask".concat(E.globals.cuid,")")),O.node.classList.add("apexcharts-grid-".concat(r))}},{key:"_drawXYLines",value:function(t){var a=this,c=t.xCount,f=t.tickAmount,_=this.w;if(_.config.grid.xaxis.lines.show||_.config.xaxis.axisTicks.show){var v,r=_.globals.padHorizontal,E=_.globals.gridHeight;_.globals.timescaleLabels.length?function(G){for(var H=G.xC,Q=G.x1,ee=G.y1,ie=G.x2,ue=G.y2,ve=0;ve<H;ve++)Q=a.xaxisLabels[ve].position,ie=a.xaxisLabels[ve].position,a._drawGridLines({i:ve,x1:Q,y1:ee,x2:ie,y2:ue,xCount:c,parent:a.elgridLinesV})}({xC:c,x1:r,y1:0,x2:v,y2:E}):(_.globals.isXNumeric&&(c=_.globals.xAxisScale.result.length),function(G){for(var H=G.xC,Q=G.x1,ee=G.y1,ie=G.x2,ue=G.y2,ve=0;ve<H+(_.globals.isXNumeric?0:1);ve++)ve===0&&H===1&&_.globals.dataPoints===1&&(ie=Q=_.globals.gridWidth/2),a._drawGridLines({i:ve,x1:Q,y1:ee,x2:ie,y2:ue,xCount:c,parent:a.elgridLinesV}),ie=Q+=_.globals.gridWidth/(_.globals.isXNumeric?H-1:H)}({xC:c,x1:r,y1:0,x2:v,y2:E}))}if(_.config.grid.yaxis.lines.show){var k=0,P=0,L=_.globals.gridWidth,O=f+1;this.isRangeBar&&(O=_.globals.labels.length);for(var N=0;N<O+(this.isRangeBar?1:0);N++)this._drawGridLine({i:N,xCount:O+(this.isRangeBar?1:0),x1:0,y1:k,x2:L,y2:P,parent:this.elgridLinesH}),P=k+=_.globals.gridHeight/(this.isRangeBar?O:f)}}},{key:"_drawInvertedXYLines",value:function(t){var a=t.xCount,c=this.w;if(c.config.grid.xaxis.lines.show||c.config.xaxis.axisTicks.show)for(var f,_=c.globals.padHorizontal,v=c.globals.gridHeight,r=0;r<a+1;r++)c.config.grid.xaxis.lines.show&&this._drawGridLine({i:r,xCount:a+1,x1:_,y1:0,x2:f,y2:v,parent:this.elgridLinesV}),new Zf(this.ctx).drawXaxisTicks(_,0,c.globals.dom.elGraphical),f=_+=c.globals.gridWidth/a;if(c.config.grid.yaxis.lines.show)for(var E=0,k=0,P=c.globals.gridWidth,L=0;L<c.globals.dataPoints+1;L++)this._drawGridLine({i:L,xCount:c.globals.dataPoints+1,x1:0,y1:E,x2:P,y2:k,parent:this.elgridLinesH}),k=E+=c.globals.gridHeight/c.globals.dataPoints}},{key:"renderGrid",value:function(){var t=this.w,a=t.globals,c=new Nt(this.ctx);this.elg=c.group({class:"apexcharts-grid"}),this.elgridLinesH=c.group({class:"apexcharts-gridlines-horizontal"}),this.elgridLinesV=c.group({class:"apexcharts-gridlines-vertical"}),this.elGridBorders=c.group({class:"apexcharts-grid-borders"}),this.elg.add(this.elgridLinesH),this.elg.add(this.elgridLinesV),t.config.grid.show||(this.elgridLinesV.hide(),this.elgridLinesH.hide(),this.elGridBorders.hide());for(var f=0;f<a.seriesYAxisMap.length&&a.ignoreYAxisIndexes.includes(f);)f++;f===a.seriesYAxisMap.length&&(f=0);var _,v=a.yAxisScale[f].result.length-1;if(!a.isBarHorizontal||this.isRangeBar){var r,E,k;_=this.xaxisLabels.length,this.isRangeBar&&(v=a.labels.length,t.config.xaxis.tickAmount&&t.config.xaxis.labels.formatter&&(_=t.config.xaxis.tickAmount),((r=a.yAxisScale)===null||r===void 0||(E=r[f])===null||E===void 0||(k=E.result)===null||k===void 0?void 0:k.length)>0&&t.config.xaxis.type!=="datetime"&&(_=a.yAxisScale[f].result.length-1)),this._drawXYLines({xCount:_,tickAmount:v})}else _=v,v=a.xTickAmount,this._drawInvertedXYLines({xCount:_,tickAmount:v});return this.drawGridBands(_,v),{el:this.elg,elGridBorders:this.elGridBorders,xAxisTickWidth:a.gridWidth/_}}},{key:"drawGridBands",value:function(t,a){var c,f,_=this,v=this.w;if(((c=v.config.grid.row.colors)===null||c===void 0?void 0:c.length)>0&&function(G,H,Q,ee,ie,ue){for(var ve=0,ce=0;ve<H;ve++,ce++)ce>=v.config.grid[G].colors.length&&(ce=0),_._drawGridBandRect({c:ce,x1:Q,y1:ee,x2:ie,y2:ue,type:G}),ee+=v.globals.gridHeight/a}("row",a,0,0,v.globals.gridWidth,v.globals.gridHeight/a),((f=v.config.grid.column.colors)===null||f===void 0?void 0:f.length)>0){var r=v.globals.isBarHorizontal||v.config.xaxis.tickPlacement!=="on"||v.config.xaxis.type!=="category"&&!v.config.xaxis.convertedCatToNumeric?t:t-1;v.globals.isXNumeric&&(r=v.globals.xAxisScale.result.length-1);for(var E=v.globals.padHorizontal,k=v.globals.padHorizontal+v.globals.gridWidth/r,P=v.globals.gridHeight,L=0,O=0;L<t;L++,O++){var N;O>=v.config.grid.column.colors.length&&(O=0),v.config.xaxis.type==="datetime"&&(E=this.xaxisLabels[L].position,k=(((N=this.xaxisLabels[L+1])===null||N===void 0?void 0:N.position)||v.globals.gridWidth)-this.xaxisLabels[L].position),this._drawGridBandRect({c:O,x1:E,y1:0,x2:k,y2:P,type:"column"}),E+=v.globals.gridWidth/r}}}}]),S}(),I1=function(){function S(t){pi(this,S),this.ctx=t,this.w=t.w,this.coreUtils=new Is(this.ctx)}return gi(S,[{key:"niceScale",value:function(t,a){var c,f,_,v,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,E=1e-11,k=this.w,P=k.globals;P.isBarHorizontal?(c=k.config.xaxis,f=Math.max((P.svgWidth-100)/25,2)):(c=k.config.yaxis[r],f=Math.max((P.svgHeight-100)/15,2)),et.isNumber(f)||(f=10),_=c.min!==void 0&&c.min!==null,v=c.max!==void 0&&c.min!==null;var L=c.stepSize!==void 0&&c.stepSize!==null,O=c.tickAmount!==void 0&&c.tickAmount!==null,N=O?c.tickAmount:P.niceScaleDefaultTicks[Math.min(Math.round(f/2),P.niceScaleDefaultTicks.length-1)];if(P.isMultipleYAxis&&!O&&P.multiAxisTickAmount>0&&(N=P.multiAxisTickAmount,O=!0),N=N==="dataPoints"?P.dataPoints-1:Math.abs(Math.round(N)),(t===Number.MIN_VALUE&&a===0||!et.isNumber(t)&&!et.isNumber(a)||t===Number.MIN_VALUE&&a===-Number.MAX_VALUE)&&(t=et.isNumber(c.min)?c.min:0,a=et.isNumber(c.max)?c.max:t+N,P.allSeriesCollapsed=!1),t>a){console.warn("axis.min cannot be greater than axis.max: swapping min and max");var G=a;a=t,t=G}else t===a&&(t=t===0?0:t-1,a=a===0?2:a+1);var H=[];N<1&&(N=1);var Q=N,ee=Math.abs(a-t);!_&&t>0&&t/ee<.15&&(t=0,_=!0),!v&&a<0&&-a/ee<.15&&(a=0,v=!0);var ie=(ee=Math.abs(a-t))/Q,ue=ie,ve=Math.floor(Math.log10(ue)),ce=Math.pow(10,ve),Te=Math.ceil(ue/ce);if(ie=ue=(Te=P.niceScaleAllowedMagMsd[P.yValueDecimal===0?0:1][Te])*ce,P.isBarHorizontal&&c.stepSize&&c.type!=="datetime"?(ie=c.stepSize,L=!0):L&&(ie=c.stepSize),L&&c.forceNiceScale){var Se=Math.floor(Math.log10(ie));ie*=Math.pow(10,ve-Se)}if(_&&v){var Ie=ee/Q;if(O)if(L)if(et.mod(ee,ie)!=0){var Ue=et.getGCD(ie,Ie);ie=Ie/Ue<10?Ue:Ie}else et.mod(ie,Ie)==0?ie=Ie:(Ie=ie,O=!1);else ie=Ie;else if(L)et.mod(ee,ie)==0?Ie=ie:ie=Ie;else if(et.mod(ee,ie)==0)Ie=ie;else{Ie=ee/(Q=Math.ceil(ee/ie));var Ke=et.getGCD(ee,ie);ee/Ke<f&&(Ie=Ke),ie=Ie}Q=Math.round(ee/ie)}else{if(_||v){if(v)if(O)t=a-ie*Q;else{var qe=t;t=ie*Math.floor(t/ie),Math.abs(a-t)/et.getGCD(ee,ie)>f&&(t=a-ie*N,t+=ie*Math.floor((qe-t)/ie))}else if(_)if(O)a=t+ie*Q;else{var ft=a;a=ie*Math.ceil(a/ie),Math.abs(a-t)/et.getGCD(ee,ie)>f&&(a=t+ie*N,a+=ie*Math.ceil((ft-a)/ie))}}else if(P.isMultipleYAxis&&O){var bt=ie*Math.floor(t/ie),Tt=bt+ie*Q;Tt<a&&(ie*=2),Tt=a,a=(t=bt)+ie*Q,ee=Math.abs(a-t),t>0&&t<Math.abs(Tt-a)&&(t=0,a=ie*Q),a<0&&-a<Math.abs(bt-t)&&(a=0,t=-ie*Q)}else t=ie*Math.floor(t/ie),a=ie*Math.ceil(a/ie);ee=Math.abs(a-t),ie=et.getGCD(ee,ie),Q=Math.round(ee/ie)}if(O||_||v||(Q=Math.ceil((ee-E)/(ie+E)))>16&&et.getPrimeFactors(Q).length<2&&Q++,!O&&c.forceNiceScale&&P.yValueDecimal===0&&Q>ee&&(Q=ee,ie=Math.round(ee/Q)),Q>f&&(!O&&!L||c.forceNiceScale)){var Et=et.getPrimeFactors(Q),Lt=Et.length-1,qt=Q;e:for(var ui=0;ui<Lt;ui++)for(var Ti=0;Ti<=Lt-ui;Ti++){for(var vi=Math.min(Ti+ui,Lt),Kt=qt,Hi=1,Br=Ti;Br<=vi;Br++)Hi*=Et[Br];if((Kt/=Hi)<f){qt=Kt;break e}}ie=qt===Q?ee:ee/qt,Q=Math.round(ee/ie)}P.isMultipleYAxis&&P.multiAxisTickAmount==0&&P.ignoreYAxisIndexes.indexOf(r)<0&&(P.multiAxisTickAmount=Q);var ar=t-ie,Xr=ie*E;do ar+=ie,H.push(et.stripNumber(ar,7));while(a-ar>Xr);return{result:H,niceMin:H[0],niceMax:H[H.length-1]}}},{key:"linearScale",value:function(t,a){var c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:10,f=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,_=arguments.length>4&&arguments[4]!==void 0?arguments[4]:void 0,v=Math.abs(a-t),r=[];if(t===a)return{result:r=[t],niceMin:r[0],niceMax:r[r.length-1]};(c=this._adjustTicksForSmallRange(c,f,v))==="dataPoints"&&(c=this.w.globals.dataPoints-1),_||(_=v/c),_=Math.round(100*(_+Number.EPSILON))/100,c===Number.MAX_VALUE&&(c=5,_=1);for(var E=t;c>=0;)r.push(E),E=et.preciseAddition(E,_),c-=1;return{result:r,niceMin:r[0],niceMax:r[r.length-1]}}},{key:"logarithmicScaleNice",value:function(t,a,c){a<=0&&(a=Math.max(t,c)),t<=0&&(t=Math.min(a,c));for(var f=[],_=Math.ceil(Math.log(a)/Math.log(c)+1),v=Math.floor(Math.log(t)/Math.log(c));v<_;v++)f.push(Math.pow(c,v));return{result:f,niceMin:f[0],niceMax:f[f.length-1]}}},{key:"logarithmicScale",value:function(t,a,c){a<=0&&(a=Math.max(t,c)),t<=0&&(t=Math.min(a,c));for(var f=[],_=Math.log(a)/Math.log(c),v=Math.log(t)/Math.log(c),r=_-v,E=Math.round(r),k=r/E,P=0,L=v;P<E;P++,L+=k)f.push(Math.pow(c,L));return f.push(Math.pow(c,_)),{result:f,niceMin:t,niceMax:a}}},{key:"_adjustTicksForSmallRange",value:function(t,a,c){var f=t;if(a!==void 0&&this.w.config.yaxis[a].labels.formatter&&this.w.config.yaxis[a].tickAmount===void 0){var _=Number(this.w.config.yaxis[a].labels.formatter(1));et.isNumber(_)&&this.w.globals.yValueDecimal===0&&(f=Math.ceil(c))}return f<t?f:t}},{key:"setYScaleForIndex",value:function(t,a,c){var f=this.w.globals,_=this.w.config,v=f.isBarHorizontal?_.xaxis:_.yaxis[t];f.yAxisScale[t]===void 0&&(f.yAxisScale[t]=[]);var r=Math.abs(c-a);v.logarithmic&&r<=5&&(f.invalidLogScale=!0),v.logarithmic&&r>5?(f.allSeriesCollapsed=!1,f.yAxisScale[t]=v.forceNiceScale?this.logarithmicScaleNice(a,c,v.logBase):this.logarithmicScale(a,c,v.logBase)):c!==-Number.MAX_VALUE&&et.isNumber(c)&&a!==Number.MAX_VALUE&&et.isNumber(a)?(f.allSeriesCollapsed=!1,f.yAxisScale[t]=this.niceScale(a,c,t)):f.yAxisScale[t]=this.niceScale(Number.MIN_VALUE,0,t)}},{key:"setXScale",value:function(t,a){var c=this.w,f=c.globals;if(a!==-Number.MAX_VALUE&&et.isNumber(a)){var _=f.xTickAmount;f.xAxisScale=this.linearScale(t,a,_,0,c.config.xaxis.max===void 0?c.config.xaxis.stepSize:void 0)}else f.xAxisScale=this.linearScale(0,10,10);return f.xAxisScale}},{key:"scaleMultipleYAxes",value:function(){var t=this,a=this.w.config,c=this.w.globals;this.coreUtils.setSeriesYAxisMappings();var f=c.seriesYAxisMap,_=c.minYArr,v=c.maxYArr;c.allSeriesCollapsed=!0,c.barGroups=[],f.forEach(function(r,E){var k=[];r.forEach(function(P){var L,O=(L=a.series[P])===null||L===void 0?void 0:L.group;k.indexOf(O)<0&&k.push(O)}),r.length>0?function(){var P,L,O=Number.MAX_VALUE,N=-Number.MAX_VALUE,G=O,H=N;if(a.chart.stacked)(function(){var ie=new Array(c.dataPoints).fill(0),ue=[],ve=[],ce=[];k.forEach(function(){ue.push(ie.map(function(){return Number.MIN_VALUE})),ve.push(ie.map(function(){return Number.MIN_VALUE})),ce.push(ie.map(function(){return Number.MIN_VALUE}))});for(var Te=function(Ie){!P&&a.series[r[Ie]].type&&(P=a.series[r[Ie]].type);var Ue=r[Ie];L=a.series[Ue].group?a.series[Ue].group:"axis-".concat(E),!(c.collapsedSeriesIndices.indexOf(Ue)<0&&c.ancillaryCollapsedSeriesIndices.indexOf(Ue)<0)||(c.allSeriesCollapsed=!1,k.forEach(function(Ke,qe){if(a.series[Ue].group===Ke)for(var ft=0;ft<c.series[Ue].length;ft++){var bt=c.series[Ue][ft];bt>=0?ve[qe][ft]+=bt:ce[qe][ft]+=bt,ue[qe][ft]+=bt,G=Math.min(G,bt),H=Math.max(H,bt)}})),P!=="bar"&&P!=="column"||c.barGroups.push(L)},Se=0;Se<r.length;Se++)Te(Se);P||(P=a.chart.type),P==="bar"||P==="column"?k.forEach(function(Ie,Ue){O=Math.min(O,Math.min.apply(null,ce[Ue])),N=Math.max(N,Math.max.apply(null,ve[Ue]))}):(k.forEach(function(Ie,Ue){G=Math.min(G,Math.min.apply(null,ue[Ue])),H=Math.max(H,Math.max.apply(null,ue[Ue]))}),O=G,N=H),O===Number.MIN_VALUE&&N===Number.MIN_VALUE&&(N=-Number.MAX_VALUE)})();else for(var Q=0;Q<r.length;Q++){var ee=r[Q];O=Math.min(O,_[ee]),N=Math.max(N,v[ee]),!(c.collapsedSeriesIndices.indexOf(ee)<0&&c.ancillaryCollapsedSeriesIndices.indexOf(ee)<0)||(c.allSeriesCollapsed=!1)}a.yaxis[E].min!==void 0&&(O=typeof a.yaxis[E].min=="function"?a.yaxis[E].min(O):a.yaxis[E].min),a.yaxis[E].max!==void 0&&(N=typeof a.yaxis[E].max=="function"?a.yaxis[E].max(N):a.yaxis[E].max),c.barGroups=c.barGroups.filter(function(ie,ue,ve){return ve.indexOf(ie)===ue}),t.setYScaleForIndex(E,O,N),r.forEach(function(ie){_[ie]=c.yAxisScale[E].niceMin,v[ie]=c.yAxisScale[E].niceMax})}():t.setYScaleForIndex(E,0,-Number.MAX_VALUE)})}}]),S}(),Zy=function(){function S(t){pi(this,S),this.ctx=t,this.w=t.w,this.scales=new I1(t)}return gi(S,[{key:"init",value:function(){this.setYRange(),this.setXRange(),this.setZRange()}},{key:"getMinYMaxY",value:function(t){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Number.MAX_VALUE,c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-Number.MAX_VALUE,f=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,_=this.w.config,v=this.w.globals,r=-Number.MAX_VALUE,E=Number.MIN_VALUE;f===null&&(f=t+1);var k=v.series,P=k,L=k;_.chart.type==="candlestick"?(P=v.seriesCandleL,L=v.seriesCandleH):_.chart.type==="boxPlot"?(P=v.seriesCandleO,L=v.seriesCandleC):v.isRangeData&&(P=v.seriesRangeStart,L=v.seriesRangeEnd);var O=!1;if(v.seriesX.length>=f){var N,G=(N=v.brushSource)===null||N===void 0?void 0:N.w.config.chart.brush;(_.chart.zoom.enabled&&_.chart.zoom.autoScaleYaxis||G!=null&&G.enabled&&G!=null&&G.autoScaleYaxis)&&(O=!0)}for(var H=t;H<f;H++){v.dataPoints=Math.max(v.dataPoints,k[H].length);var Q=_.series[H].type;v.categoryLabels.length&&(v.dataPoints=v.categoryLabels.filter(function(Ue){return Ue!==void 0}).length),v.labels.length&&_.xaxis.type!=="datetime"&&v.series.reduce(function(Ue,Ke){return Ue+Ke.length},0)!==0&&(v.dataPoints=Math.max(v.dataPoints,v.labels.length));var ee=0,ie=k[H].length-1;if(O){if(_.xaxis.min)for(;ee<ie&&v.seriesX[H][ee]<_.xaxis.min;ee++);if(_.xaxis.max)for(;ie>ee&&v.seriesX[H][ie]>_.xaxis.max;ie--);}for(var ue=ee;ue<=ie&&ue<v.series[H].length;ue++){var ve=k[H][ue];if(ve!==null&&et.isNumber(ve)){var ce,Te,Se,Ie;switch(((ce=L[H])===null||ce===void 0?void 0:ce[ue])!==void 0&&(r=Math.max(r,L[H][ue]),a=Math.min(a,L[H][ue])),((Te=P[H])===null||Te===void 0?void 0:Te[ue])!==void 0&&(a=Math.min(a,P[H][ue]),c=Math.max(c,P[H][ue])),Q){case"candlestick":v.seriesCandleC[H][ue]!==void 0&&(r=Math.max(r,v.seriesCandleH[H][ue]),a=Math.min(a,v.seriesCandleL[H][ue]));break;case"boxPlot":v.seriesCandleC[H][ue]!==void 0&&(r=Math.max(r,v.seriesCandleC[H][ue]),a=Math.min(a,v.seriesCandleO[H][ue]))}Q&&Q!=="candlestick"&&Q!=="boxPlot"&&Q!=="rangeArea"&&Q!=="rangeBar"&&(r=Math.max(r,v.series[H][ue]),a=Math.min(a,v.series[H][ue])),v.seriesGoals[H]&&v.seriesGoals[H][ue]&&Array.isArray(v.seriesGoals[H][ue])&&v.seriesGoals[H][ue].forEach(function(Ue){r=Math.max(r,Ue.value),a=Math.min(a,Ue.value)}),c=r,ve=et.noExponents(ve),et.isFloat(ve)&&(v.yValueDecimal=Math.max(v.yValueDecimal,ve.toString().split(".")[1].length)),E>((Se=P[H])===null||Se===void 0?void 0:Se[ue])&&((Ie=P[H])===null||Ie===void 0?void 0:Ie[ue])<0&&(E=P[H][ue])}else v.hasNullValues=!0}Q!=="bar"&&Q!=="column"||(E<0&&r<0&&(r=0,c=Math.max(c,0)),E===Number.MIN_VALUE&&(E=0,a=Math.min(a,0)))}return _.chart.type==="rangeBar"&&v.seriesRangeStart.length&&v.isBarHorizontal&&(E=a),_.chart.type==="bar"&&(E<0&&r<0&&(r=0),E===Number.MIN_VALUE&&(E=0)),{minY:E,maxY:r,lowestY:a,highestY:c}}},{key:"setYRange",value:function(){var t=this.w.globals,a=this.w.config;t.maxY=-Number.MAX_VALUE,t.minY=Number.MIN_VALUE;var c,f=Number.MAX_VALUE;if(t.isMultipleYAxis){f=Number.MAX_VALUE;for(var _=0;_<t.series.length;_++)c=this.getMinYMaxY(_),t.minYArr[_]=c.lowestY,t.maxYArr[_]=c.highestY,f=Math.min(f,c.lowestY)}return c=this.getMinYMaxY(0,f,null,t.series.length),a.chart.type==="bar"?(t.minY=c.minY,t.maxY=c.maxY):(t.minY=c.lowestY,t.maxY=c.highestY),f=c.lowestY,a.chart.stacked&&this._setStackedMinMax(),a.chart.type==="line"||a.chart.type==="area"||a.chart.type==="scatter"||a.chart.type==="candlestick"||a.chart.type==="boxPlot"||a.chart.type==="rangeBar"&&!t.isBarHorizontal?t.minY===Number.MIN_VALUE&&f!==-Number.MAX_VALUE&&f!==t.maxY&&(t.minY=f):t.minY=t.minY!==Number.MIN_VALUE?Math.min(c.minY,t.minY):c.minY,a.yaxis.forEach(function(v,r){v.max!==void 0&&(typeof v.max=="number"?t.maxYArr[r]=v.max:typeof v.max=="function"&&(t.maxYArr[r]=v.max(t.isMultipleYAxis?t.maxYArr[r]:t.maxY)),t.maxY=t.maxYArr[r]),v.min!==void 0&&(typeof v.min=="number"?t.minYArr[r]=v.min:typeof v.min=="function"&&(t.minYArr[r]=v.min(t.isMultipleYAxis?t.minYArr[r]===Number.MIN_VALUE?0:t.minYArr[r]:t.minY)),t.minY=t.minYArr[r])}),t.isBarHorizontal&&["min","max"].forEach(function(v){a.xaxis[v]!==void 0&&typeof a.xaxis[v]=="number"&&(v==="min"?t.minY=a.xaxis[v]:t.maxY=a.xaxis[v])}),t.isMultipleYAxis?(this.scales.scaleMultipleYAxes(),t.minY=f):(this.scales.setYScaleForIndex(0,t.minY,t.maxY),t.minY=t.yAxisScale[0].niceMin,t.maxY=t.yAxisScale[0].niceMax,t.minYArr[0]=t.minY,t.maxYArr[0]=t.maxY),t.barGroups=[],t.lineGroups=[],t.areaGroups=[],a.series.forEach(function(v){switch(v.type||a.chart.type){case"bar":case"column":t.barGroups.push(v.group);break;case"line":t.lineGroups.push(v.group);break;case"area":t.areaGroups.push(v.group)}}),t.barGroups=t.barGroups.filter(function(v,r,E){return E.indexOf(v)===r}),t.lineGroups=t.lineGroups.filter(function(v,r,E){return E.indexOf(v)===r}),t.areaGroups=t.areaGroups.filter(function(v,r,E){return E.indexOf(v)===r}),{minY:t.minY,maxY:t.maxY,minYArr:t.minYArr,maxYArr:t.maxYArr,yAxisScale:t.yAxisScale}}},{key:"setXRange",value:function(){var t=this.w.globals,a=this.w.config,c=a.xaxis.type==="numeric"||a.xaxis.type==="datetime"||a.xaxis.type==="category"&&!t.noLabelsProvided||t.noLabelsProvided||t.isXNumeric;if(t.isXNumeric&&function(){for(var E=0;E<t.series.length;E++)if(t.labels[E])for(var k=0;k<t.labels[E].length;k++)t.labels[E][k]!==null&&et.isNumber(t.labels[E][k])&&(t.maxX=Math.max(t.maxX,t.labels[E][k]),t.initialMaxX=Math.max(t.maxX,t.labels[E][k]),t.minX=Math.min(t.minX,t.labels[E][k]),t.initialMinX=Math.min(t.minX,t.labels[E][k]))}(),t.noLabelsProvided&&a.xaxis.categories.length===0&&(t.maxX=t.labels[t.labels.length-1],t.initialMaxX=t.labels[t.labels.length-1],t.minX=1,t.initialMinX=1),t.isXNumeric||t.noLabelsProvided||t.dataFormatXNumeric){var f=10;if(a.xaxis.tickAmount===void 0)f=Math.round(t.svgWidth/150),a.xaxis.type==="numeric"&&t.dataPoints<30&&(f=t.dataPoints-1),f>t.dataPoints&&t.dataPoints!==0&&(f=t.dataPoints-1);else if(a.xaxis.tickAmount==="dataPoints"){if(t.series.length>1&&(f=t.series[t.maxValsInArrayIndex].length-1),t.isXNumeric){var _=Math.round(t.maxX-t.minX);_<30&&(f=_)}}else f=a.xaxis.tickAmount;if(t.xTickAmount=f,a.xaxis.max!==void 0&&typeof a.xaxis.max=="number"&&(t.maxX=a.xaxis.max),a.xaxis.min!==void 0&&typeof a.xaxis.min=="number"&&(t.minX=a.xaxis.min),a.xaxis.range!==void 0&&(t.minX=t.maxX-a.xaxis.range),t.minX!==Number.MAX_VALUE&&t.maxX!==-Number.MAX_VALUE)if(a.xaxis.convertedCatToNumeric&&!t.dataFormatXNumeric){for(var v=[],r=t.minX-1;r<t.maxX;r++)v.push(r+1);t.xAxisScale={result:v,niceMin:v[0],niceMax:v[v.length-1]}}else t.xAxisScale=this.scales.setXScale(t.minX,t.maxX);else t.xAxisScale=this.scales.linearScale(0,f,f,0,a.xaxis.stepSize),t.noLabelsProvided&&t.labels.length>0&&(t.xAxisScale=this.scales.linearScale(1,t.labels.length,f-1,0,a.xaxis.stepSize),t.seriesX=t.labels.slice());c&&(t.labels=t.xAxisScale.result.slice())}return t.isBarHorizontal&&t.labels.length&&(t.xTickAmount=t.labels.length),this._handleSingleDataPoint(),this._getMinXDiff(),{minX:t.minX,maxX:t.maxX}}},{key:"setZRange",value:function(){var t=this.w.globals;if(t.isDataXYZ){for(var a=0;a<t.series.length;a++)if(t.seriesZ[a]!==void 0)for(var c=0;c<t.seriesZ[a].length;c++)t.seriesZ[a][c]!==null&&et.isNumber(t.seriesZ[a][c])&&(t.maxZ=Math.max(t.maxZ,t.seriesZ[a][c]),t.minZ=Math.min(t.minZ,t.seriesZ[a][c]))}}},{key:"_handleSingleDataPoint",value:function(){var t=this.w.globals,a=this.w.config;if(t.minX===t.maxX){var c=new tn(this.ctx);if(a.xaxis.type==="datetime"){var f=c.getDate(t.minX);a.xaxis.labels.datetimeUTC?f.setUTCDate(f.getUTCDate()-2):f.setDate(f.getDate()-2),t.minX=new Date(f).getTime();var _=c.getDate(t.maxX);a.xaxis.labels.datetimeUTC?_.setUTCDate(_.getUTCDate()+2):_.setDate(_.getDate()+2),t.maxX=new Date(_).getTime()}else(a.xaxis.type==="numeric"||a.xaxis.type==="category"&&!t.noLabelsProvided)&&(t.minX=t.minX-2,t.initialMinX=t.minX,t.maxX=t.maxX+2,t.initialMaxX=t.maxX)}}},{key:"_getMinXDiff",value:function(){var t=this.w.globals;t.isXNumeric&&t.seriesX.forEach(function(a,c){if(a.length){a.length===1&&a.push(t.seriesX[t.maxValsInArrayIndex][t.seriesX[t.maxValsInArrayIndex].length-1]);var f=a.slice();f.sort(function(_,v){return _-v}),f.forEach(function(_,v){if(v>0){var r=_-f[v-1];r>0&&(t.minXDiff=Math.min(r,t.minXDiff))}}),t.dataPoints!==1&&t.minXDiff!==Number.MAX_VALUE||(t.minXDiff=.5)}})}},{key:"_setStackedMinMax",value:function(){var t=this,a=this.w.globals;if(a.series.length){var c=a.seriesGroups;c.length||(c=[this.w.globals.seriesNames.map(function(v){return v})]);var f={},_={};c.forEach(function(v){f[v]=[],_[v]=[],t.w.config.series.map(function(r,E){return v.indexOf(a.seriesNames[E])>-1?E:null}).filter(function(r){return r!==null}).forEach(function(r){for(var E=0;E<a.series[a.maxValsInArrayIndex].length;E++){var k,P,L,O;f[v][E]===void 0&&(f[v][E]=0,_[v][E]=0),(t.w.config.chart.stacked&&!a.comboCharts||t.w.config.chart.stacked&&a.comboCharts&&(!t.w.config.chart.stackOnlyBar||((k=t.w.config.series)===null||k===void 0||(P=k[r])===null||P===void 0?void 0:P.type)==="bar"||((L=t.w.config.series)===null||L===void 0||(O=L[r])===null||O===void 0?void 0:O.type)==="column"))&&a.series[r][E]!==null&&et.isNumber(a.series[r][E])&&(a.series[r][E]>0?f[v][E]+=parseFloat(a.series[r][E])+1e-4:_[v][E]+=parseFloat(a.series[r][E]))}})}),Object.entries(f).forEach(function(v){var r=Zw(v,1)[0];f[r].forEach(function(E,k){a.maxY=Math.max(a.maxY,f[r][k]),a.minY=Math.min(a.minY,_[r][k])})})}}}]),S}(),mx=function(){function S(t,a){pi(this,S),this.ctx=t,this.elgrid=a,this.w=t.w;var c=this.w;this.xaxisFontSize=c.config.xaxis.labels.style.fontSize,this.axisFontFamily=c.config.xaxis.labels.style.fontFamily,this.xaxisForeColors=c.config.xaxis.labels.style.colors,this.isCategoryBarHorizontal=c.config.chart.type==="bar"&&c.config.plotOptions.bar.horizontal,this.xAxisoffX=c.config.xaxis.position==="bottom"?c.globals.gridHeight:0,this.drawnLabels=[],this.axesUtils=new Wl(t)}return gi(S,[{key:"drawYaxis",value:function(t){var a=this.w,c=new Nt(this.ctx),f=a.config.yaxis[t].labels.style,_=f.fontSize,v=f.fontFamily,r=f.fontWeight,E=c.group({class:"apexcharts-yaxis",rel:t,transform:"translate(".concat(a.globals.translateYAxisX[t],", 0)")});if(this.axesUtils.isYAxisHidden(t))return E;var k=c.group({class:"apexcharts-yaxis-texts-g"});E.add(k);var P=a.globals.yAxisScale[t].result.length-1,L=a.globals.gridHeight/P,O=a.globals.yLabelFormatters[t],N=this.axesUtils.checkForReversedLabels(t,a.globals.yAxisScale[t].result.slice());if(a.config.yaxis[t].labels.show){var G=a.globals.translateY+a.config.yaxis[t].labels.offsetY;a.globals.isBarHorizontal?G=0:a.config.chart.type==="heatmap"&&(G-=L/2),G+=parseInt(_,10)/3;for(var H=P;H>=0;H--){var Q=O(N[H],H,a),ee=a.config.yaxis[t].labels.padding;a.config.yaxis[t].opposite&&a.config.yaxis.length!==0&&(ee*=-1);var ie=this.getTextAnchor(a.config.yaxis[t].labels.align,a.config.yaxis[t].opposite),ue=this.axesUtils.getYAxisForeColor(f.colors,t),ve=Array.isArray(ue)?ue[H]:ue,ce=et.listToArray(a.globals.dom.baseEl.querySelectorAll(".apexcharts-yaxis[rel='".concat(t,"'] .apexcharts-yaxis-label tspan"))).map(function(Se){return Se.textContent}),Te=c.drawText({x:ee,y:G,text:ce.includes(Q)&&!a.config.yaxis[t].labels.showDuplicates?"":Q,textAnchor:ie,fontSize:_,fontFamily:v,fontWeight:r,maxWidth:a.config.yaxis[t].labels.maxWidth,foreColor:ve,isPlainText:!1,cssClass:"apexcharts-yaxis-label ".concat(f.cssClass)});k.add(Te),this.addTooltip(Te,Q),a.config.yaxis[t].labels.rotate!==0&&this.rotateLabel(c,Te,firstLabel,a.config.yaxis[t].labels.rotate),G+=L}}return this.addYAxisTitle(c,E,t),this.addAxisBorder(c,E,t,P,L),E}},{key:"getTextAnchor",value:function(t,a){return t==="left"?"start":t==="center"?"middle":t==="right"?"end":a?"start":"end"}},{key:"addTooltip",value:function(t,a){var c=document.createElementNS(this.w.globals.SVGNS,"title");c.textContent=Array.isArray(a)?a.join(" "):a,t.node.appendChild(c)}},{key:"rotateLabel",value:function(t,a,c,f){var _=t.rotateAroundCenter(c.node),v=t.rotateAroundCenter(a.node);a.node.setAttribute("transform","rotate(".concat(f," ").concat(_.x," ").concat(v.y,")"))}},{key:"addYAxisTitle",value:function(t,a,c){var f=this.w;if(f.config.yaxis[c].title.text!==void 0){var _=t.group({class:"apexcharts-yaxis-title"}),v=f.config.yaxis[c].opposite?f.globals.translateYAxisX[c]:0,r=t.drawText({x:v,y:f.globals.gridHeight/2+f.globals.translateY+f.config.yaxis[c].title.offsetY,text:f.config.yaxis[c].title.text,textAnchor:"end",foreColor:f.config.yaxis[c].title.style.color,fontSize:f.config.yaxis[c].title.style.fontSize,fontWeight:f.config.yaxis[c].title.style.fontWeight,fontFamily:f.config.yaxis[c].title.style.fontFamily,cssClass:"apexcharts-yaxis-title-text ".concat(f.config.yaxis[c].title.style.cssClass)});_.add(r),a.add(_)}}},{key:"addAxisBorder",value:function(t,a,c,f,_){var v=this.w,r=v.config.yaxis[c].axisBorder,E=31+r.offsetX;if(v.config.yaxis[c].opposite&&(E=-31-r.offsetX),r.show){var k=t.drawLine(E,v.globals.translateY+r.offsetY-2,E,v.globals.gridHeight+v.globals.translateY+r.offsetY+2,r.color,0,r.width);a.add(k)}v.config.yaxis[c].axisTicks.show&&this.axesUtils.drawYAxisTicks(E,f,r,v.config.yaxis[c].axisTicks,c,_,a)}},{key:"drawYaxisInversed",value:function(t){var a=this.w,c=new Nt(this.ctx),f=c.group({class:"apexcharts-xaxis apexcharts-yaxis-inversed"}),_=c.group({class:"apexcharts-xaxis-texts-g",transform:"translate(".concat(a.globals.translateXAxisX,", ").concat(a.globals.translateXAxisY,")")});f.add(_);var v=a.globals.yAxisScale[t].result.length-1,r=a.globals.gridWidth/v+.1,E=r+a.config.xaxis.labels.offsetX,k=a.globals.xLabelFormatter,P=this.axesUtils.checkForReversedLabels(t,a.globals.yAxisScale[t].result.slice()),L=a.globals.timescaleLabels;if(L.length>0&&(this.xaxisLabels=L.slice(),v=(P=L.slice()).length),a.config.xaxis.labels.show)for(var O=L.length?0:v;L.length?O<L.length:O>=0;L.length?O++:O--){var N=k(P[O],O,a),G=a.globals.gridWidth+a.globals.padHorizontal-(E-r+a.config.xaxis.labels.offsetX);if(L.length){var H=this.axesUtils.getLabel(P,L,G,O,this.drawnLabels,this.xaxisFontSize);G=H.x,N=H.text,this.drawnLabels.push(H.text),O===0&&a.globals.skipFirstTimelinelabel&&(N=""),O===P.length-1&&a.globals.skipLastTimelinelabel&&(N="")}var Q=c.drawText({x:G,y:this.xAxisoffX+a.config.xaxis.labels.offsetY+30-(a.config.xaxis.position==="top"?a.globals.xAxisHeight+a.config.xaxis.axisTicks.height-2:0),text:N,textAnchor:"middle",foreColor:Array.isArray(this.xaxisForeColors)?this.xaxisForeColors[t]:this.xaxisForeColors,fontSize:this.xaxisFontSize,fontFamily:this.xaxisFontFamily,fontWeight:a.config.xaxis.labels.style.fontWeight,isPlainText:!1,cssClass:"apexcharts-xaxis-label ".concat(a.config.xaxis.labels.style.cssClass)});_.add(Q),Q.tspan(N),this.addTooltip(Q,N),E+=r}return this.inversedYAxisTitleText(f),this.inversedYAxisBorder(f),f}},{key:"inversedYAxisBorder",value:function(t){var a=this.w,c=new Nt(this.ctx),f=a.config.xaxis.axisBorder;if(f.show){var _=0;a.config.chart.type==="bar"&&a.globals.isXNumeric&&(_-=15);var v=c.drawLine(a.globals.padHorizontal+_+f.offsetX,this.xAxisoffX,a.globals.gridWidth,this.xAxisoffX,f.color,0,f.height);this.elgrid&&this.elgrid.elGridBorders&&a.config.grid.show?this.elgrid.elGridBorders.add(v):t.add(v)}}},{key:"inversedYAxisTitleText",value:function(t){var a=this.w,c=new Nt(this.ctx);if(a.config.xaxis.title.text!==void 0){var f=c.group({class:"apexcharts-xaxis-title apexcharts-yaxis-title-inversed"}),_=c.drawText({x:a.globals.gridWidth/2+a.config.xaxis.title.offsetX,y:this.xAxisoffX+parseFloat(this.xaxisFontSize)+parseFloat(a.config.xaxis.title.style.fontSize)+a.config.xaxis.title.offsetY+20,text:a.config.xaxis.title.text,textAnchor:"middle",fontSize:a.config.xaxis.title.style.fontSize,fontFamily:a.config.xaxis.title.style.fontFamily,fontWeight:a.config.xaxis.title.style.fontWeight,foreColor:a.config.xaxis.title.style.color,cssClass:"apexcharts-xaxis-title-text ".concat(a.config.xaxis.title.style.cssClass)});f.add(_),t.add(f)}}},{key:"yAxisTitleRotate",value:function(t,a){var c=this.w,f=new Nt(this.ctx),_=c.globals.dom.baseEl.querySelector(".apexcharts-yaxis[rel='".concat(t,"'] .apexcharts-yaxis-texts-g")),v=_?_.getBoundingClientRect():{width:0,height:0},r=c.globals.dom.baseEl.querySelector(".apexcharts-yaxis[rel='".concat(t,"'] .apexcharts-yaxis-title text")),E=r?r.getBoundingClientRect():{width:0,height:0};if(r){var k=this.xPaddingForYAxisTitle(t,v,E,a);r.setAttribute("x",k.xPos-(a?10:0));var P=f.rotateAroundCenter(r);r.setAttribute("transform","rotate(".concat(a?-1*c.config.yaxis[t].title.rotate:c.config.yaxis[t].title.rotate," ").concat(P.x," ").concat(P.y,")"))}}},{key:"xPaddingForYAxisTitle",value:function(t,a,c,f){var _=this.w,v=0,r=10;return _.config.yaxis[t].title.text===void 0||t<0?{xPos:v,padd:0}:(f?v=a.width+_.config.yaxis[t].title.offsetX+c.width/2+r/2:(v=-1*a.width+_.config.yaxis[t].title.offsetX+r/2+c.width/2,_.globals.isBarHorizontal&&(r=25,v=-1*a.width-_.config.yaxis[t].title.offsetX-r)),{xPos:v,padd:r})}},{key:"setYAxisXPosition",value:function(t,a){var c=this.w,f=0,_=0,v=18,r=1;c.config.yaxis.length>1&&(this.multipleYs=!0),c.config.yaxis.forEach(function(E,k){var P=c.globals.ignoreYAxisIndexes.includes(k)||!E.show||E.floating||t[k].width===0,L=t[k].width+a[k].width;E.opposite?c.globals.isBarHorizontal?(_=c.globals.gridWidth+c.globals.translateX-1,c.globals.translateYAxisX[k]=_-E.labels.offsetX):(_=c.globals.gridWidth+c.globals.translateX+r,P||(r+=L+20),c.globals.translateYAxisX[k]=_-E.labels.offsetX+20):(f=c.globals.translateX-v,P||(v+=L+20),c.globals.translateYAxisX[k]=f+E.labels.offsetX)})}},{key:"setYAxisTextAlignments",value:function(){var t=this.w;et.listToArray(t.globals.dom.baseEl.getElementsByClassName("apexcharts-yaxis")).forEach(function(a,c){var f=t.config.yaxis[c];if(f&&!f.floating&&f.labels.align!==void 0){var _=t.globals.dom.baseEl.querySelector(".apexcharts-yaxis[rel='".concat(c,"'] .apexcharts-yaxis-texts-g")),v=et.listToArray(t.globals.dom.baseEl.querySelectorAll(".apexcharts-yaxis[rel='".concat(c,"'] .apexcharts-yaxis-label"))),r=_.getBoundingClientRect();v.forEach(function(E){E.setAttribute("text-anchor",f.labels.align)}),f.labels.align!=="left"||f.opposite?f.labels.align==="center"?_.setAttribute("transform","translate(".concat(r.width/2*(f.opposite?1:-1),", 0)")):f.labels.align==="right"&&f.opposite&&_.setAttribute("transform","translate(".concat(r.width,", 0)")):_.setAttribute("transform","translate(-".concat(r.width,", 0)"))}})}}]),S}(),OE=function(){function S(t){pi(this,S),this.ctx=t,this.w=t.w,this.documentEvent=et.bind(this.documentEvent,this)}return gi(S,[{key:"addEventListener",value:function(t,a){var c=this.w;c.globals.events.hasOwnProperty(t)?c.globals.events[t].push(a):c.globals.events[t]=[a]}},{key:"removeEventListener",value:function(t,a){var c=this.w;if(c.globals.events.hasOwnProperty(t)){var f=c.globals.events[t].indexOf(a);f!==-1&&c.globals.events[t].splice(f,1)}}},{key:"fireEvent",value:function(t,a){var c=this.w;if(c.globals.events.hasOwnProperty(t)){a&&a.length||(a=[]);for(var f=c.globals.events[t],_=f.length,v=0;v<_;v++)f[v].apply(null,a)}}},{key:"setupEventHandlers",value:function(){var t=this,a=this.w,c=this.ctx,f=a.globals.dom.baseEl.querySelector(a.globals.chartClass);this.ctx.eventList.forEach(function(_){f.addEventListener(_,function(v){var r=v.target.getAttribute("i")===null&&a.globals.capturedSeriesIndex!==-1?a.globals.capturedSeriesIndex:v.target.getAttribute("i"),E=v.target.getAttribute("j")===null&&a.globals.capturedDataPointIndex!==-1?a.globals.capturedDataPointIndex:v.target.getAttribute("j"),k=Object.assign({},a,{seriesIndex:a.globals.axisCharts?r:0,dataPointIndex:E});v.type==="mousemove"||v.type==="touchmove"?typeof a.config.chart.events.mouseMove=="function"&&a.config.chart.events.mouseMove(v,c,k):v.type==="mouseleave"||v.type==="touchleave"?typeof a.config.chart.events.mouseLeave=="function"&&a.config.chart.events.mouseLeave(v,c,k):(v.type==="mouseup"&&v.which===1||v.type==="touchend")&&(typeof a.config.chart.events.click=="function"&&a.config.chart.events.click(v,c,k),c.ctx.events.fireEvent("click",[v,c,k]))},{capture:!1,passive:!0})}),this.ctx.eventList.forEach(function(_){a.globals.dom.baseEl.addEventListener(_,t.documentEvent,{passive:!0})}),this.ctx.core.setupBrushHandler()}},{key:"documentEvent",value:function(t){var a=this.w,c=t.target.className;if(t.type==="click"){var f=a.globals.dom.baseEl.querySelector(".apexcharts-menu");f&&f.classList.contains("apexcharts-menu-open")&&c!=="apexcharts-menu-icon"&&f.classList.remove("apexcharts-menu-open")}a.globals.clientX=t.type==="touchmove"?t.touches[0].clientX:t.clientX,a.globals.clientY=t.type==="touchmove"?t.touches[0].clientY:t.clientY}}]),S}(),FE=function(){function S(t){pi(this,S),this.ctx=t,this.w=t.w}return gi(S,[{key:"setCurrentLocaleValues",value:function(t){var a=this.w.config.chart.locales;window.Apex.chart&&window.Apex.chart.locales&&window.Apex.chart.locales.length>0&&(a=this.w.config.chart.locales.concat(window.Apex.chart.locales));var c=a.filter(function(_){return _.name===t})[0];if(!c)throw new Error("Wrong locale name provided. Please make sure you set the correct locale name in options");var f=et.extend(S1,c);this.w.globals.locale=f.options}}]),S}(),BE=function(){function S(t){pi(this,S),this.ctx=t,this.w=t.w}return gi(S,[{key:"drawAxis",value:function(t,a){var c,f,_=this,v=this.w.globals,r=this.w.config,E=new Zf(this.ctx,a),k=new mx(this.ctx,a);v.axisCharts&&t!=="radar"&&(v.isBarHorizontal?(f=k.drawYaxisInversed(0),c=E.drawXaxisInversed(0),v.dom.elGraphical.add(c),v.dom.elGraphical.add(f)):(c=E.drawXaxis(),v.dom.elGraphical.add(c),r.yaxis.map(function(P,L){if(v.ignoreYAxisIndexes.indexOf(L)===-1&&(f=k.drawYaxis(L),v.dom.Paper.add(f),_.w.config.grid.position==="back")){var O=v.dom.Paper.children()[1];O.remove(),v.dom.Paper.add(O)}})))}}]),S}(),$y=function(){function S(t){pi(this,S),this.ctx=t,this.w=t.w}return gi(S,[{key:"drawXCrosshairs",value:function(){var t=this.w,a=new Nt(this.ctx),c=new rn(this.ctx),f=t.config.xaxis.crosshairs.fill.gradient,_=t.config.xaxis.crosshairs.dropShadow,v=t.config.xaxis.crosshairs.fill.type,r=f.colorFrom,E=f.colorTo,k=f.opacityFrom,P=f.opacityTo,L=f.stops,O=_.enabled,N=_.left,G=_.top,H=_.blur,Q=_.color,ee=_.opacity,ie=t.config.xaxis.crosshairs.fill.color;if(t.config.xaxis.crosshairs.show){v==="gradient"&&(ie=a.drawGradient("vertical",r,E,k,P,null,L,null));var ue=a.drawRect();t.config.xaxis.crosshairs.width===1&&(ue=a.drawLine());var ve=t.globals.gridHeight;(!et.isNumber(ve)||ve<0)&&(ve=0);var ce=t.config.xaxis.crosshairs.width;(!et.isNumber(ce)||ce<0)&&(ce=0),ue.attr({class:"apexcharts-xcrosshairs",x:0,y:0,y2:ve,width:ce,height:ve,fill:ie,filter:"none","fill-opacity":t.config.xaxis.crosshairs.opacity,stroke:t.config.xaxis.crosshairs.stroke.color,"stroke-width":t.config.xaxis.crosshairs.stroke.width,"stroke-dasharray":t.config.xaxis.crosshairs.stroke.dashArray}),O&&(ue=c.dropShadow(ue,{left:N,top:G,blur:H,color:Q,opacity:ee})),t.globals.dom.elGraphical.add(ue)}}},{key:"drawYCrosshairs",value:function(){var t=this.w,a=new Nt(this.ctx),c=t.config.yaxis[0].crosshairs,f=t.globals.barPadForNumericAxis;if(t.config.yaxis[0].crosshairs.show){var _=a.drawLine(-f,0,t.globals.gridWidth+f,0,c.stroke.color,c.stroke.dashArray,c.stroke.width);_.attr({class:"apexcharts-ycrosshairs"}),t.globals.dom.elGraphical.add(_)}var v=a.drawLine(-f,0,t.globals.gridWidth+f,0,c.stroke.color,0,0);v.attr({class:"apexcharts-ycrosshairs-hidden"}),t.globals.dom.elGraphical.add(v)}}]),S}(),NE=function(){function S(t){pi(this,S),this.ctx=t,this.w=t.w}return gi(S,[{key:"checkResponsiveConfig",value:function(t){var a=this,c=this.w,f=c.config;if(f.responsive.length!==0){var _=f.responsive.slice();_.sort(function(k,P){return k.breakpoint>P.breakpoint?1:P.breakpoint>k.breakpoint?-1:0}).reverse();var v=new qf({}),r=function(){var k=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},P=_[0].breakpoint,L=window.innerWidth>0?window.innerWidth:screen.width;if(L>P){var O=et.clone(c.globals.initialConfig);O.series=et.clone(c.config.series);var N=Is.extendArrayProps(v,O,c);k=et.extend(N,k),k=et.extend(c.config,k),a.overrideResponsiveOptions(k)}else for(var G=0;G<_.length;G++)L<_[G].breakpoint&&(k=Is.extendArrayProps(v,_[G].options,c),k=et.extend(c.config,k),a.overrideResponsiveOptions(k))};if(t){var E=Is.extendArrayProps(v,t,c);E=et.extend(c.config,E),r(E=et.extend(E,t))}else r({})}}},{key:"overrideResponsiveOptions",value:function(t){var a=new qf(t).init({responsiveOverride:!0});this.w.config=a}}]),S}(),VE=function(){function S(t){pi(this,S),this.ctx=t,this.w=t.w,this.colors=[],this.isColorFn=!1,this.isHeatmapDistributed=this.checkHeatmapDistributed(),this.isBarDistributed=this.checkBarDistributed()}return gi(S,[{key:"checkHeatmapDistributed",value:function(){var t=this.w.config,a=t.chart,c=t.plotOptions;return a.type==="treemap"&&c.treemap&&c.treemap.distributed||a.type==="heatmap"&&c.heatmap&&c.heatmap.distributed}},{key:"checkBarDistributed",value:function(){var t=this.w.config,a=t.chart,c=t.plotOptions;return c.bar&&c.bar.distributed&&(a.type==="bar"||a.type==="rangeBar")}},{key:"init",value:function(){this.setDefaultColors()}},{key:"setDefaultColors",value:function(){var t=this.w,a=new et;t.globals.dom.elWrap.classList.add("apexcharts-theme-".concat(t.config.theme.mode||"light"));var c=Us(t.config.colors||t.config.fill.colors||[]);t.globals.colors=this.getColors(c),this.applySeriesColors(t.globals.seriesColors,t.globals.colors),t.config.theme.monochrome.enabled&&(t.globals.colors=this.getMonochromeColors(t.config.theme.monochrome,t.globals.series,a));var f=t.globals.colors.slice();this.pushExtraColors(t.globals.colors),this.applyColorTypes(["fill","stroke"],f),this.applyDataLabelsColors(f),this.applyRadarPolygonsColors(),this.applyMarkersColors(f)}},{key:"getColors",value:function(t){var a=this,c=this.w;return t&&t.length!==0?Array.isArray(t)&&t.length>0&&typeof t[0]=="function"?(this.isColorFn=!0,c.config.series.map(function(f,_){var v=t[_]||t[0];return typeof v=="function"?v({value:c.globals.axisCharts?c.globals.series[_][0]||0:c.globals.series[_],seriesIndex:_,dataPointIndex:_,w:a.w}):v})):t:this.predefined()}},{key:"applySeriesColors",value:function(t,a){t.forEach(function(c,f){c&&(a[f]=c)})}},{key:"getMonochromeColors",value:function(t,a,c){var f=t.color,_=t.shadeIntensity,v=t.shadeTo,r=this.isBarDistributed||this.isHeatmapDistributed?a[0].length*a.length:a.length,E=1/(r/_),k=0;return Array.from({length:r},function(){var P=v==="dark"?c.shadeColor(-1*k,f):c.shadeColor(k,f);return k+=E,P})}},{key:"applyColorTypes",value:function(t,a){var c=this,f=this.w;t.forEach(function(_){f.globals[_].colors=f.config[_].colors===void 0?c.isColorFn?f.config.colors:a:f.config[_].colors.slice(),c.pushExtraColors(f.globals[_].colors)})}},{key:"applyDataLabelsColors",value:function(t){var a=this.w;a.globals.dataLabels.style.colors=a.config.dataLabels.style.colors===void 0?t:a.config.dataLabels.style.colors.slice(),this.pushExtraColors(a.globals.dataLabels.style.colors,50)}},{key:"applyRadarPolygonsColors",value:function(){var t=this.w;t.globals.radarPolygons.fill.colors=t.config.plotOptions.radar.polygons.fill.colors===void 0?[t.config.theme.mode==="dark"?"#343A3F":"none"]:t.config.plotOptions.radar.polygons.fill.colors.slice(),this.pushExtraColors(t.globals.radarPolygons.fill.colors,20)}},{key:"applyMarkersColors",value:function(t){var a=this.w;a.globals.markers.colors=a.config.markers.colors===void 0?t:a.config.markers.colors.slice(),this.pushExtraColors(a.globals.markers.colors)}},{key:"pushExtraColors",value:function(t,a){var c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,f=this.w,_=a||f.globals.series.length;if(c===null&&(c=this.isBarDistributed||this.isHeatmapDistributed||f.config.chart.type==="heatmap"&&f.config.plotOptions.heatmap&&f.config.plotOptions.heatmap.colorScale.inverse),c&&f.globals.series.length&&(_=f.globals.series[f.globals.maxValsInArrayIndex].length*f.globals.series.length),t.length<_)for(var v=_-t.length,r=0;r<v;r++)t.push(t[r])}},{key:"updateThemeOptions",value:function(t){t.chart=t.chart||{},t.tooltip=t.tooltip||{};var a=t.theme.mode,c=a==="dark"?"palette4":a==="light"?"palette1":t.theme.palette||"palette1",f=a==="dark"?"#f6f7f8":a==="light"?"#373d3f":t.chart.foreColor||"#373d3f";return t.tooltip.theme=a||"light",t.chart.foreColor=f,t.theme.palette=c,t}},{key:"predefined",value:function(){var t=this.w.config.theme.palette,a=this.ctx.constructor.getThemePalettes();return a[t]||a.palette1}}]),S}(),UE=function(){function S(t){pi(this,S),this.ctx=t,this.w=t.w}return gi(S,[{key:"draw",value:function(){this.drawTitleSubtitle("title"),this.drawTitleSubtitle("subtitle")}},{key:"drawTitleSubtitle",value:function(t){var a=this.w,c=t==="title"?a.config.title:a.config.subtitle,f=a.globals.svgWidth/2,_=c.offsetY,v="middle";if(c.align==="left"?(f=10,v="start"):c.align==="right"&&(f=a.globals.svgWidth-10,v="end"),f+=c.offsetX,_=_+parseInt(c.style.fontSize,10)+c.margin/2,c.text!==void 0){var r=new Nt(this.ctx).drawText({x:f,y:_,text:c.text,textAnchor:v,fontSize:c.style.fontSize,fontFamily:c.style.fontFamily,fontWeight:c.style.fontWeight,foreColor:c.style.color,opacity:1});r.node.setAttribute("class","apexcharts-".concat(t,"-text")),a.globals.dom.Paper.add(r)}}}]),S}(),jE=function(){function S(t){pi(this,S),this.w=t.w,this.dCtx=t}return gi(S,[{key:"getTitleSubtitleCoords",value:function(t){var a=this.w,c=0,f=0,_=t==="title"?a.config.title.floating:a.config.subtitle.floating,v=a.globals.dom.baseEl.querySelector(".apexcharts-".concat(t,"-text"));if(v!==null&&!_){var r=v.getBoundingClientRect();c=r.width,f=a.globals.axisCharts?r.height+5:r.height}return{width:c,height:f}}},{key:"getLegendsRect",value:function(){var t=this.w,a=t.globals.dom.elLegendWrap;t.config.legend.height||t.config.legend.position!=="top"&&t.config.legend.position!=="bottom"||(a.style.maxHeight=t.globals.svgHeight/2+"px");var c=Object.assign({},et.getBoundingClientRect(a));return a!==null&&!t.config.legend.floating&&t.config.legend.show?this.dCtx.lgRect={x:c.x,y:c.y,height:c.height,width:c.height===0?0:c.width}:this.dCtx.lgRect={x:0,y:0,height:0,width:0},t.config.legend.position!=="left"&&t.config.legend.position!=="right"||1.5*this.dCtx.lgRect.width>t.globals.svgWidth&&(this.dCtx.lgRect.width=t.globals.svgWidth/1.5),this.dCtx.lgRect}},{key:"getDatalabelsRect",value:function(){var t=this,a=this.w,c=[];a.config.series.forEach(function(E,k){E.data.forEach(function(P,L){var O;O=a.globals.series[k][L],f=a.config.dataLabels.formatter(O,{ctx:t.dCtx.ctx,seriesIndex:k,dataPointIndex:L,w:a}),c.push(f)})});var f=et.getLargestStringFromArr(c),_=new Nt(this.dCtx.ctx),v=a.config.dataLabels.style,r=_.getTextRects(f,parseInt(v.fontSize),v.fontFamily);return{width:1.05*r.width,height:r.height}}},{key:"getLargestStringFromMultiArr",value:function(t,a){var c=t;if(this.w.globals.isMultiLineX){var f=a.map(function(v,r){return Array.isArray(v)?v.length:1}),_=Math.max.apply(Math,Us(f));c=a[f.indexOf(_)]}return c}}]),S}(),HE=function(){function S(t){pi(this,S),this.w=t.w,this.dCtx=t}return gi(S,[{key:"getxAxisLabelsCoords",value:function(){var t,a=this.w,c=a.globals.labels.slice();if(a.config.xaxis.convertedCatToNumeric&&c.length===0&&(c=a.globals.categoryLabels),a.globals.timescaleLabels.length>0){var f=this.getxAxisTimeScaleLabelsCoords();t={width:f.width,height:f.height},a.globals.rotateXLabels=!1}else{this.dCtx.lgWidthForSideLegends=a.config.legend.position!=="left"&&a.config.legend.position!=="right"||a.config.legend.floating?0:this.dCtx.lgRect.width;var _=a.globals.xLabelFormatter,v=et.getLargestStringFromArr(c),r=this.dCtx.dimHelpers.getLargestStringFromMultiArr(v,c);a.globals.isBarHorizontal&&(r=v=a.globals.yAxisScale[0].result.reduce(function(G,H){return G.length>H.length?G:H},0));var E=new tp(this.dCtx.ctx),k=v;v=E.xLabelFormat(_,v,k,{i:void 0,dateFormatter:new tn(this.dCtx.ctx).formatDate,w:a}),r=E.xLabelFormat(_,r,k,{i:void 0,dateFormatter:new tn(this.dCtx.ctx).formatDate,w:a}),(a.config.xaxis.convertedCatToNumeric&&v===void 0||String(v).trim()==="")&&(r=v="1");var P=new Nt(this.dCtx.ctx),L=P.getTextRects(v,a.config.xaxis.labels.style.fontSize),O=L;if(v!==r&&(O=P.getTextRects(r,a.config.xaxis.labels.style.fontSize)),(t={width:L.width>=O.width?L.width:O.width,height:L.height>=O.height?L.height:O.height}).width*c.length>a.globals.svgWidth-this.dCtx.lgWidthForSideLegends-this.dCtx.yAxisWidth-this.dCtx.gridPad.left-this.dCtx.gridPad.right&&a.config.xaxis.labels.rotate!==0||a.config.xaxis.labels.rotateAlways){if(!a.globals.isBarHorizontal){a.globals.rotateXLabels=!0;var N=function(G){return P.getTextRects(G,a.config.xaxis.labels.style.fontSize,a.config.xaxis.labels.style.fontFamily,"rotate(".concat(a.config.xaxis.labels.rotate," 0 0)"),!1)};L=N(v),v!==r&&(O=N(r)),t.height=(L.height>O.height?L.height:O.height)/1.5,t.width=L.width>O.width?L.width:O.width}}else a.globals.rotateXLabels=!1}return a.config.xaxis.labels.show||(t={width:0,height:0}),{width:t.width,height:t.height}}},{key:"getxAxisGroupLabelsCoords",value:function(){var t,a=this.w;if(!a.globals.hasXaxisGroups)return{width:0,height:0};var c,f=((t=a.config.xaxis.group.style)===null||t===void 0?void 0:t.fontSize)||a.config.xaxis.labels.style.fontSize,_=a.globals.groups.map(function(L){return L.title}),v=et.getLargestStringFromArr(_),r=this.dCtx.dimHelpers.getLargestStringFromMultiArr(v,_),E=new Nt(this.dCtx.ctx),k=E.getTextRects(v,f),P=k;return v!==r&&(P=E.getTextRects(r,f)),c={width:k.width>=P.width?k.width:P.width,height:k.height>=P.height?k.height:P.height},a.config.xaxis.labels.show||(c={width:0,height:0}),{width:c.width,height:c.height}}},{key:"getxAxisTitleCoords",value:function(){var t=this.w,a=0,c=0;if(t.config.xaxis.title.text!==void 0){var f=new Nt(this.dCtx.ctx).getTextRects(t.config.xaxis.title.text,t.config.xaxis.title.style.fontSize);a=f.width,c=f.height}return{width:a,height:c}}},{key:"getxAxisTimeScaleLabelsCoords",value:function(){var t,a=this.w;this.dCtx.timescaleLabels=a.globals.timescaleLabels.slice();var c=this.dCtx.timescaleLabels.map(function(_){return _.value}),f=c.reduce(function(_,v){return _===void 0?(console.error("You have possibly supplied invalid Date format. Please supply a valid JavaScript Date"),0):_.length>v.length?_:v},0);return 1.05*(t=new Nt(this.dCtx.ctx).getTextRects(f,a.config.xaxis.labels.style.fontSize)).width*c.length>a.globals.gridWidth&&a.config.xaxis.labels.rotate!==0&&(a.globals.overlappingXLabels=!0),t}},{key:"additionalPaddingXLabels",value:function(t){var a=this,c=this.w,f=c.globals,_=c.config,v=_.xaxis.type,r=t.width;f.skipLastTimelinelabel=!1,f.skipFirstTimelinelabel=!1;var E=c.config.yaxis[0].opposite&&c.globals.isBarHorizontal,k=function(P,L){_.yaxis.length>1&&function(O){return f.collapsedSeriesIndices.indexOf(O)!==-1}(L)||function(O){if(a.dCtx.timescaleLabels&&a.dCtx.timescaleLabels.length){var N=a.dCtx.timescaleLabels[0],G=a.dCtx.timescaleLabels[a.dCtx.timescaleLabels.length-1].position+r/1.75-a.dCtx.yAxisWidthRight,H=N.position-r/1.75+a.dCtx.yAxisWidthLeft,Q=c.config.legend.position==="right"&&a.dCtx.lgRect.width>0?a.dCtx.lgRect.width:0;G>f.svgWidth-f.translateX-Q&&(f.skipLastTimelinelabel=!0),H<-(O.show&&!O.floating||_.chart.type!=="bar"&&_.chart.type!=="candlestick"&&_.chart.type!=="rangeBar"&&_.chart.type!=="boxPlot"?10:r/1.75)&&(f.skipFirstTimelinelabel=!0)}else v==="datetime"?a.dCtx.gridPad.right<r&&!f.rotateXLabels&&(f.skipLastTimelinelabel=!0):v!=="datetime"&&a.dCtx.gridPad.right<r/2-a.dCtx.yAxisWidthRight&&!f.rotateXLabels&&!c.config.xaxis.labels.trim&&(a.dCtx.xPadRight=r/2+1)}(P)};_.yaxis.forEach(function(P,L){E?(a.dCtx.gridPad.left<r&&(a.dCtx.xPadLeft=r/2+1),a.dCtx.xPadRight=r/2+1):k(P,L)})}}]),S}(),WE=function(){function S(t){pi(this,S),this.w=t.w,this.dCtx=t}return gi(S,[{key:"getyAxisLabelsCoords",value:function(){var t=this,a=this.w,c=[],f=10,_=new Wl(this.dCtx.ctx);return a.config.yaxis.map(function(v,r){var E={seriesIndex:r,dataPointIndex:-1,w:a},k=a.globals.yAxisScale[r],P=0;if(!_.isYAxisHidden(r)&&v.labels.show&&v.labels.minWidth!==void 0&&(P=v.labels.minWidth),!_.isYAxisHidden(r)&&v.labels.show&&k.result.length){var L=a.globals.yLabelFormatters[r],O=k.niceMin===Number.MIN_VALUE?0:k.niceMin,N=k.result.reduce(function(ve,ce){var Te,Se;return((Te=String(L(ve,E)))===null||Te===void 0?void 0:Te.length)>((Se=String(L(ce,E)))===null||Se===void 0?void 0:Se.length)?ve:ce},O),G=N=L(N,E);if(N!==void 0&&N.length!==0||(N=k.niceMax),a.globals.isBarHorizontal){f=0;var H=a.globals.labels.slice();N=et.getLargestStringFromArr(H),N=L(N,{seriesIndex:r,dataPointIndex:-1,w:a}),G=t.dCtx.dimHelpers.getLargestStringFromMultiArr(N,H)}var Q=new Nt(t.dCtx.ctx),ee="rotate(".concat(v.labels.rotate," 0 0)"),ie=Q.getTextRects(N,v.labels.style.fontSize,v.labels.style.fontFamily,ee,!1),ue=ie;N!==G&&(ue=Q.getTextRects(G,v.labels.style.fontSize,v.labels.style.fontFamily,ee,!1)),c.push({width:(P>ue.width||P>ie.width?P:ue.width>ie.width?ue.width:ie.width)+f,height:ue.height>ie.height?ue.height:ie.height})}else c.push({width:0,height:0})}),c}},{key:"getyAxisTitleCoords",value:function(){var t=this,a=this.w,c=[];return a.config.yaxis.map(function(f,_){if(f.show&&f.title.text!==void 0){var v=new Nt(t.dCtx.ctx),r="rotate(".concat(f.title.rotate," 0 0)"),E=v.getTextRects(f.title.text,f.title.style.fontSize,f.title.style.fontFamily,r,!1);c.push({width:E.width,height:E.height})}else c.push({width:0,height:0})}),c}},{key:"getTotalYAxisWidth",value:function(){var t=this.w,a=0,c=0,f=0,_=t.globals.yAxisScale.length>1?10:0,v=new Wl(this.dCtx.ctx),r=function(E,k){var P=t.config.yaxis[k].floating,L=0;E.width>0&&!P?(L=E.width+_,function(O){return t.globals.ignoreYAxisIndexes.indexOf(O)>-1}(k)&&(L=L-E.width-_)):L=P||v.isYAxisHidden(k)?0:5,t.config.yaxis[k].opposite?f+=L:c+=L,a+=L};return t.globals.yLabelsCoords.map(function(E,k){r(E,k)}),t.globals.yTitleCoords.map(function(E,k){r(E,k)}),t.globals.isBarHorizontal&&!t.config.yaxis[0].floating&&(a=t.globals.yLabelsCoords[0].width+t.globals.yTitleCoords[0].width+15),this.dCtx.yAxisWidthLeft=c,this.dCtx.yAxisWidthRight=f,a}}]),S}(),GE=function(){function S(t){pi(this,S),this.w=t.w,this.dCtx=t}return gi(S,[{key:"gridPadForColumnsInNumericAxis",value:function(t){var a=this.w,c=a.config,f=a.globals;if(f.noData||f.collapsedSeries.length+f.ancillaryCollapsedSeries.length===c.series.length)return 0;var _=function(N){return["bar","rangeBar","candlestick","boxPlot"].includes(N)},v=c.chart.type,r=0,E=_(v)?c.series.length:1;f.comboBarCount>0&&(E=f.comboBarCount),f.collapsedSeries.forEach(function(N){_(N.type)&&(E-=1)}),c.chart.stacked&&(E=1);var k=_(v)||f.comboBarCount>0,P=Math.abs(f.initialMaxX-f.initialMinX);if(k&&f.isXNumeric&&!f.isBarHorizontal&&E>0&&P!==0){P<=3&&(P=f.dataPoints);var L=P/t,O=f.minXDiff&&f.minXDiff/L>0?f.minXDiff/L:0;O>t/2&&(O/=2),(r=O*parseInt(c.plotOptions.bar.columnWidth,10)/100)<1&&(r=1),f.barPadForNumericAxis=r}return r}},{key:"gridPadFortitleSubtitle",value:function(){var t=this,a=this.w,c=a.globals,f=this.dCtx.isSparkline||!c.axisCharts?0:10;["title","subtitle"].forEach(function(r){a.config[r].text!==void 0?f+=a.config[r].margin:f+=t.dCtx.isSparkline||!c.axisCharts?0:5}),!a.config.legend.show||a.config.legend.position!=="bottom"||a.config.legend.floating||c.axisCharts||(f+=10);var _=this.dCtx.dimHelpers.getTitleSubtitleCoords("title"),v=this.dCtx.dimHelpers.getTitleSubtitleCoords("subtitle");c.gridHeight-=_.height+v.height+f,c.translateY+=_.height+v.height+f}},{key:"setGridXPosForDualYAxis",value:function(t,a){var c=this.w,f=new Wl(this.dCtx.ctx);c.config.yaxis.forEach(function(_,v){c.globals.ignoreYAxisIndexes.indexOf(v)!==-1||_.floating||f.isYAxisHidden(v)||(_.opposite&&(c.globals.translateX-=a[v].width+t[v].width+parseInt(_.labels.style.fontSize,10)/1.2+12),c.globals.translateX<2&&(c.globals.translateX=2))})}}]),S}(),um=function(){function S(t){pi(this,S),this.ctx=t,this.w=t.w,this.lgRect={},this.yAxisWidth=0,this.yAxisWidthLeft=0,this.yAxisWidthRight=0,this.xAxisHeight=0,this.isSparkline=this.w.config.chart.sparkline.enabled,this.dimHelpers=new jE(this),this.dimYAxis=new WE(this),this.dimXAxis=new HE(this),this.dimGrid=new GE(this),this.lgWidthForSideLegends=0,this.gridPad=this.w.config.grid.padding,this.xPadRight=0,this.xPadLeft=0}return gi(S,[{key:"plotCoords",value:function(){var t=this,a=this.w,c=a.globals;this.lgRect=this.dimHelpers.getLegendsRect(),this.datalabelsCoords={width:0,height:0};var f=Array.isArray(a.config.stroke.width)?Math.max.apply(Math,Us(a.config.stroke.width)):a.config.stroke.width;this.isSparkline&&((a.config.markers.discrete.length>0||a.config.markers.size>0)&&Object.entries(this.gridPad).forEach(function(v){var r=Zw(v,2),E=r[0],k=r[1];t.gridPad[E]=Math.max(k,t.w.globals.markers.largestSize/1.5)}),this.gridPad.top=Math.max(f/2,this.gridPad.top),this.gridPad.bottom=Math.max(f/2,this.gridPad.bottom)),c.axisCharts?this.setDimensionsForAxisCharts():this.setDimensionsForNonAxisCharts(),this.dimGrid.gridPadFortitleSubtitle(),c.gridHeight=c.gridHeight-this.gridPad.top-this.gridPad.bottom,c.gridWidth=c.gridWidth-this.gridPad.left-this.gridPad.right-this.xPadRight-this.xPadLeft;var _=this.dimGrid.gridPadForColumnsInNumericAxis(c.gridWidth);c.gridWidth=c.gridWidth-2*_,c.translateX=c.translateX+this.gridPad.left+this.xPadLeft+(_>0?_:0),c.translateY=c.translateY+this.gridPad.top}},{key:"setDimensionsForAxisCharts",value:function(){var t=this,a=this.w,c=a.globals,f=this.dimYAxis.getyAxisLabelsCoords(),_=this.dimYAxis.getyAxisTitleCoords();c.isSlopeChart&&(this.datalabelsCoords=this.dimHelpers.getDatalabelsRect()),a.globals.yLabelsCoords=[],a.globals.yTitleCoords=[],a.config.yaxis.map(function(N,G){a.globals.yLabelsCoords.push({width:f[G].width,index:G}),a.globals.yTitleCoords.push({width:_[G].width,index:G})}),this.yAxisWidth=this.dimYAxis.getTotalYAxisWidth();var v=this.dimXAxis.getxAxisLabelsCoords(),r=this.dimXAxis.getxAxisGroupLabelsCoords(),E=this.dimXAxis.getxAxisTitleCoords();this.conditionalChecksForAxisCoords(v,E,r),c.translateXAxisY=a.globals.rotateXLabels?this.xAxisHeight/8:-4,c.translateXAxisX=a.globals.rotateXLabels&&a.globals.isXNumeric&&a.config.xaxis.labels.rotate<=-45?-this.xAxisWidth/4:0,a.globals.isBarHorizontal&&(c.rotateXLabels=!1,c.translateXAxisY=parseInt(a.config.xaxis.labels.style.fontSize,10)/1.5*-1),c.translateXAxisY=c.translateXAxisY+a.config.xaxis.labels.offsetY,c.translateXAxisX=c.translateXAxisX+a.config.xaxis.labels.offsetX;var k=this.yAxisWidth,P=this.xAxisHeight;c.xAxisLabelsHeight=this.xAxisHeight-E.height,c.xAxisGroupLabelsHeight=c.xAxisLabelsHeight-v.height,c.xAxisLabelsWidth=this.xAxisWidth,c.xAxisHeight=this.xAxisHeight;var L=10;(a.config.chart.type==="radar"||this.isSparkline)&&(k=0,P=0),this.isSparkline&&(this.lgRect={height:0,width:0}),(this.isSparkline||a.config.chart.type==="treemap")&&(k=0,P=0,L=0),this.isSparkline||a.config.chart.type==="treemap"||this.dimXAxis.additionalPaddingXLabels(v);var O=function(){c.translateX=k+t.datalabelsCoords.width,c.gridHeight=c.svgHeight-t.lgRect.height-P-(t.isSparkline||a.config.chart.type==="treemap"?0:a.globals.rotateXLabels?10:15),c.gridWidth=c.svgWidth-k-2*t.datalabelsCoords.width};switch(a.config.xaxis.position==="top"&&(L=c.xAxisHeight-a.config.xaxis.axisTicks.height-5),a.config.legend.position){case"bottom":c.translateY=L,O();break;case"top":c.translateY=this.lgRect.height+L,O();break;case"left":c.translateY=L,c.translateX=this.lgRect.width+k+this.datalabelsCoords.width,c.gridHeight=c.svgHeight-P-12,c.gridWidth=c.svgWidth-this.lgRect.width-k-2*this.datalabelsCoords.width;break;case"right":c.translateY=L,c.translateX=k+this.datalabelsCoords.width,c.gridHeight=c.svgHeight-P-12,c.gridWidth=c.svgWidth-this.lgRect.width-k-2*this.datalabelsCoords.width-5;break;default:throw new Error("Legend position not supported")}this.dimGrid.setGridXPosForDualYAxis(_,f),new mx(this.ctx).setYAxisXPosition(f,_)}},{key:"setDimensionsForNonAxisCharts",value:function(){var t=this.w,a=t.globals,c=t.config,f=0;t.config.legend.show&&!t.config.legend.floating&&(f=20);var _=c.chart.type==="pie"||c.chart.type==="polarArea"||c.chart.type==="donut"?"pie":"radialBar",v=c.plotOptions[_].offsetY,r=c.plotOptions[_].offsetX;if(!c.legend.show||c.legend.floating){a.gridHeight=a.svgHeight;var E=a.dom.elWrap.getBoundingClientRect().width;return a.gridWidth=Math.min(E,a.gridHeight),a.translateY=v,void(a.translateX=r+(a.svgWidth-a.gridWidth)/2)}switch(c.legend.position){case"bottom":a.gridHeight=a.svgHeight-this.lgRect.height,a.gridWidth=a.svgWidth,a.translateY=v-10,a.translateX=r+(a.svgWidth-a.gridWidth)/2;break;case"top":a.gridHeight=a.svgHeight-this.lgRect.height,a.gridWidth=a.svgWidth,a.translateY=this.lgRect.height+v+10,a.translateX=r+(a.svgWidth-a.gridWidth)/2;break;case"left":a.gridWidth=a.svgWidth-this.lgRect.width-f,a.gridHeight=c.chart.height!=="auto"?a.svgHeight:a.gridWidth,a.translateY=v,a.translateX=r+this.lgRect.width+f;break;case"right":a.gridWidth=a.svgWidth-this.lgRect.width-f-5,a.gridHeight=c.chart.height!=="auto"?a.svgHeight:a.gridWidth,a.translateY=v,a.translateX=r+10;break;default:throw new Error("Legend position not supported")}}},{key:"conditionalChecksForAxisCoords",value:function(t,a,c){var f=this.w,_=f.globals.hasXaxisGroups?2:1,v=c.height+t.height+a.height,r=f.globals.isMultiLineX?1.2:f.globals.LINE_HEIGHT_RATIO,E=f.globals.rotateXLabels?22:10,k=f.globals.rotateXLabels&&f.config.legend.position==="bottom"?10:0;this.xAxisHeight=v*r+_*E+k,this.xAxisWidth=t.width,this.xAxisHeight-a.height>f.config.xaxis.labels.maxHeight&&(this.xAxisHeight=f.config.xaxis.labels.maxHeight),f.config.xaxis.labels.minHeight&&this.xAxisHeight<f.config.xaxis.labels.minHeight&&(this.xAxisHeight=f.config.xaxis.labels.minHeight),f.config.xaxis.floating&&(this.xAxisHeight=0);var P=0,L=0;f.config.yaxis.forEach(function(O){P+=O.labels.minWidth,L+=O.labels.maxWidth}),this.yAxisWidth<P&&(this.yAxisWidth=P),this.yAxisWidth>L&&(this.yAxisWidth=L)}}]),S}(),XE=function(){function S(t){pi(this,S),this.w=t.w,this.lgCtx=t}return gi(S,[{key:"getLegendStyles",value:function(){var t,a,c,f=document.createElement("style");f.setAttribute("type","text/css");var _=((t=this.lgCtx.ctx)===null||t===void 0||(a=t.opts)===null||a===void 0||(c=a.chart)===null||c===void 0?void 0:c.nonce)||this.w.config.chart.nonce;_&&f.setAttribute("nonce",_);var v=document.createTextNode(E1);return f.appendChild(v),f}},{key:"getLegendDimensions",value:function(){var t=this.w.globals.dom.baseEl.querySelector(".apexcharts-legend").getBoundingClientRect(),a=t.width;return{clwh:t.height,clww:a}}},{key:"appendToForeignObject",value:function(){var t=this.w.globals;this.w.config.chart.injectStyleSheet!==!1&&t.dom.elLegendForeign.appendChild(this.getLegendStyles())}},{key:"toggleDataSeries",value:function(t,a){var c=this,f=this.w;if(f.globals.axisCharts||f.config.chart.type==="radialBar"){f.globals.resized=!0;var _=null,v=null;f.globals.risingSeries=[],f.globals.axisCharts?(_=f.globals.dom.baseEl.querySelector(".apexcharts-series[data\\:realIndex='".concat(t,"']")),v=parseInt(_.getAttribute("data:realIndex"),10)):(_=f.globals.dom.baseEl.querySelector(".apexcharts-series[rel='".concat(t+1,"']")),v=parseInt(_.getAttribute("rel"),10)-1),a?[{cs:f.globals.collapsedSeries,csi:f.globals.collapsedSeriesIndices},{cs:f.globals.ancillaryCollapsedSeries,csi:f.globals.ancillaryCollapsedSeriesIndices}].forEach(function(P){c.riseCollapsedSeries(P.cs,P.csi,v)}):this.hideSeries({seriesEl:_,realIndex:v})}else{var r=f.globals.dom.Paper.findOne(" .apexcharts-series[rel='".concat(t+1,"'] path")),E=f.config.chart.type;if(E==="pie"||E==="polarArea"||E==="donut"){var k=f.config.plotOptions.pie.donut.labels;new Nt(this.lgCtx.ctx).pathMouseDown(r,null),this.lgCtx.ctx.pie.printDataLabelsInner(r.node,k)}r.fire("click")}}},{key:"getSeriesAfterCollapsing",value:function(t){var a=t.realIndex,c=this.w,f=c.globals,_=et.clone(c.config.series);if(f.axisCharts){var v=c.config.yaxis[f.seriesYAxisReverseMap[a]],r={index:a,data:_[a].data.slice(),type:_[a].type||c.config.chart.type};if(v&&v.show&&v.showAlways)f.ancillaryCollapsedSeriesIndices.indexOf(a)<0&&(f.ancillaryCollapsedSeries.push(r),f.ancillaryCollapsedSeriesIndices.push(a));else if(f.collapsedSeriesIndices.indexOf(a)<0){f.collapsedSeries.push(r),f.collapsedSeriesIndices.push(a);var E=f.risingSeries.indexOf(a);f.risingSeries.splice(E,1)}}else f.collapsedSeries.push({index:a,data:_[a]}),f.collapsedSeriesIndices.push(a);return f.allSeriesCollapsed=f.collapsedSeries.length+f.ancillaryCollapsedSeries.length===c.config.series.length,this._getSeriesBasedOnCollapsedState(_)}},{key:"hideSeries",value:function(t){for(var a=t.seriesEl,c=t.realIndex,f=this.w,_=this.getSeriesAfterCollapsing({realIndex:c}),v=a.childNodes,r=0;r<v.length;r++)v[r].classList.contains("apexcharts-series-markers-wrap")&&(v[r].classList.contains("apexcharts-hide")?v[r].classList.remove("apexcharts-hide"):v[r].classList.add("apexcharts-hide"));this.lgCtx.ctx.updateHelpers._updateSeries(_,f.config.chart.animations.dynamicAnimation.enabled)}},{key:"riseCollapsedSeries",value:function(t,a,c){var f=this.w,_=et.clone(f.config.series);if(t.length>0){for(var v=0;v<t.length;v++)t[v].index===c&&(f.globals.axisCharts?_[c].data=t[v].data.slice():_[c]=t[v].data,typeof _[c]!="number"&&(_[c].hidden=!1),t.splice(v,1),a.splice(v,1),f.globals.risingSeries.push(c));_=this._getSeriesBasedOnCollapsedState(_),this.lgCtx.ctx.updateHelpers._updateSeries(_,f.config.chart.animations.dynamicAnimation.enabled)}}},{key:"_getSeriesBasedOnCollapsedState",value:function(t){var a=this.w,c=0;return a.globals.axisCharts?t.forEach(function(f,_){a.globals.collapsedSeriesIndices.indexOf(_)<0&&a.globals.ancillaryCollapsedSeriesIndices.indexOf(_)<0||(t[_].data=[],c++)}):t.forEach(function(f,_){!a.globals.collapsedSeriesIndices.indexOf(_)<0&&(t[_]=0,c++)}),a.globals.allSeriesCollapsed=c===t.length,t}}]),S}(),k1=function(){function S(t){pi(this,S),this.ctx=t,this.w=t.w,this.onLegendClick=this.onLegendClick.bind(this),this.onLegendHovered=this.onLegendHovered.bind(this),this.isBarsDistributed=this.w.config.chart.type==="bar"&&this.w.config.plotOptions.bar.distributed&&this.w.config.series.length===1,this.legendHelpers=new XE(this)}return gi(S,[{key:"init",value:function(){var t=this.w,a=t.globals,c=t.config,f=c.legend.showForSingleSeries&&a.series.length===1||this.isBarsDistributed||a.series.length>1;if(this.legendHelpers.appendToForeignObject(),(f||!a.axisCharts)&&c.legend.show){for(;a.dom.elLegendWrap.firstChild;)a.dom.elLegendWrap.removeChild(a.dom.elLegendWrap.firstChild);this.drawLegends(),c.legend.position==="bottom"||c.legend.position==="top"?this.legendAlignHorizontal():c.legend.position!=="right"&&c.legend.position!=="left"||this.legendAlignVertical()}}},{key:"createLegendMarker",value:function(t){var a=t.i,c=t.fillcolor,f=this.w,_=document.createElement("span");_.classList.add("apexcharts-legend-marker");var v=f.config.legend.markers.shape||f.config.markers.shape,r=v;Array.isArray(v)&&(r=v[a]);var E=Array.isArray(f.config.legend.markers.size)?parseFloat(f.config.legend.markers.size[a]):parseFloat(f.config.legend.markers.size),k=Array.isArray(f.config.legend.markers.offsetX)?parseFloat(f.config.legend.markers.offsetX[a]):parseFloat(f.config.legend.markers.offsetX),P=Array.isArray(f.config.legend.markers.offsetY)?parseFloat(f.config.legend.markers.offsetY[a]):parseFloat(f.config.legend.markers.offsetY),L=Array.isArray(f.config.legend.markers.strokeWidth)?parseFloat(f.config.legend.markers.strokeWidth[a]):parseFloat(f.config.legend.markers.strokeWidth),O=_.style;if(O.height=2*(E+L)+"px",O.width=2*(E+L)+"px",O.left=k+"px",O.top=P+"px",f.config.legend.markers.customHTML)O.background="transparent",O.color=c[a],Array.isArray(f.config.legend.markers.customHTML)?f.config.legend.markers.customHTML[a]&&(_.innerHTML=f.config.legend.markers.customHTML[a]()):_.innerHTML=f.config.legend.markers.customHTML();else{var N=new Hu(this.ctx).getMarkerConfig({cssClass:"apexcharts-legend-marker apexcharts-marker apexcharts-marker-".concat(r),seriesIndex:a,strokeWidth:L,size:E}),G=window.SVG().addTo(_).size("100%","100%"),H=new Nt(this.ctx).drawMarker(0,0,Jt(Jt({},N),{},{pointFillColor:Array.isArray(c)?c[a]:N.pointFillColor,shape:r}));f.globals.dom.Paper.find(".apexcharts-legend-marker.apexcharts-marker").forEach(function(Q){Q.node.classList.contains("apexcharts-marker-triangle")?Q.node.style.transform="translate(50%, 45%)":Q.node.style.transform="translate(50%, 50%)"}),G.add(H)}return _}},{key:"drawLegends",value:function(){var t=this,a=this,c=this.w,f=c.config.legend.fontFamily,_=c.globals.seriesNames,v=c.config.legend.markers.fillColors?c.config.legend.markers.fillColors.slice():c.globals.colors.slice();if(c.config.chart.type==="heatmap"){var r=c.config.plotOptions.heatmap.colorScale.ranges;_=r.map(function(N){return N.name?N.name:N.from+" - "+N.to}),v=r.map(function(N){return N.color})}else this.isBarsDistributed&&(_=c.globals.labels.slice());c.config.legend.customLegendItems.length&&(_=c.config.legend.customLegendItems);var E=c.globals.legendFormatter,k=c.config.legend.inverseOrder,P=[];c.globals.seriesGroups.length>1&&c.config.legend.clusterGroupedSeries&&c.globals.seriesGroups.forEach(function(N,G){P[G]=document.createElement("div"),P[G].classList.add("apexcharts-legend-group","apexcharts-legend-group-".concat(G)),c.config.legend.clusterGroupedSeriesOrientation==="horizontal"?c.globals.dom.elLegendWrap.classList.add("apexcharts-legend-group-horizontal"):P[G].classList.add("apexcharts-legend-group-vertical")});for(var L=function(N){var G,H=E(_[N],{seriesIndex:N,w:c}),Q=!1,ee=!1;if(c.globals.collapsedSeries.length>0)for(var ie=0;ie<c.globals.collapsedSeries.length;ie++)c.globals.collapsedSeries[ie].index===N&&(Q=!0);if(c.globals.ancillaryCollapsedSeriesIndices.length>0)for(var ue=0;ue<c.globals.ancillaryCollapsedSeriesIndices.length;ue++)c.globals.ancillaryCollapsedSeriesIndices[ue]===N&&(ee=!0);var ve=t.createLegendMarker({i:N,fillcolor:v});Nt.setAttrs(ve,{rel:N+1,"data:collapsed":Q||ee}),(Q||ee)&&ve.classList.add("apexcharts-inactive-legend");var ce=document.createElement("div"),Te=document.createElement("span");Te.classList.add("apexcharts-legend-text"),Te.innerHTML=Array.isArray(H)?H.join(" "):H;var Se=c.config.legend.labels.useSeriesColors?c.globals.colors[N]:Array.isArray(c.config.legend.labels.colors)?(G=c.config.legend.labels.colors)===null||G===void 0?void 0:G[N]:c.config.legend.labels.colors;Se||(Se=c.config.chart.foreColor),Te.style.color=Se,Te.style.fontSize=parseFloat(c.config.legend.fontSize)+"px",Te.style.fontWeight=c.config.legend.fontWeight,Te.style.fontFamily=f||c.config.chart.fontFamily,Nt.setAttrs(Te,{rel:N+1,i:N,"data:default-text":encodeURIComponent(H),"data:collapsed":Q||ee}),ce.appendChild(ve),ce.appendChild(Te);var Ie=new Is(t.ctx);c.config.legend.showForZeroSeries||Ie.getSeriesTotalByIndex(N)===0&&Ie.seriesHaveSameValues(N)&&!Ie.isSeriesNull(N)&&c.globals.collapsedSeriesIndices.indexOf(N)===-1&&c.globals.ancillaryCollapsedSeriesIndices.indexOf(N)===-1&&ce.classList.add("apexcharts-hidden-zero-series"),c.config.legend.showForNullSeries||Ie.isSeriesNull(N)&&c.globals.collapsedSeriesIndices.indexOf(N)===-1&&c.globals.ancillaryCollapsedSeriesIndices.indexOf(N)===-1&&ce.classList.add("apexcharts-hidden-null-series"),P.length?c.globals.seriesGroups.forEach(function(Ue,Ke){var qe;Ue.includes((qe=c.config.series[N])===null||qe===void 0?void 0:qe.name)&&(c.globals.dom.elLegendWrap.appendChild(P[Ke]),P[Ke].appendChild(ce))}):c.globals.dom.elLegendWrap.appendChild(ce),c.globals.dom.elLegendWrap.classList.add("apexcharts-align-".concat(c.config.legend.horizontalAlign)),c.globals.dom.elLegendWrap.classList.add("apx-legend-position-"+c.config.legend.position),ce.classList.add("apexcharts-legend-series"),ce.style.margin="".concat(c.config.legend.itemMargin.vertical,"px ").concat(c.config.legend.itemMargin.horizontal,"px"),c.globals.dom.elLegendWrap.style.width=c.config.legend.width?c.config.legend.width+"px":"",c.globals.dom.elLegendWrap.style.height=c.config.legend.height?c.config.legend.height+"px":"",Nt.setAttrs(ce,{rel:N+1,seriesName:et.escapeString(_[N]),"data:collapsed":Q||ee}),(Q||ee)&&ce.classList.add("apexcharts-inactive-legend"),c.config.legend.onItemClick.toggleDataSeries||ce.classList.add("apexcharts-no-click")},O=k?_.length-1:0;k?O>=0:O<=_.length-1;k?O--:O++)L(O);c.globals.dom.elWrap.addEventListener("click",a.onLegendClick,!0),c.config.legend.onItemHover.highlightDataSeries&&c.config.legend.customLegendItems.length===0&&(c.globals.dom.elWrap.addEventListener("mousemove",a.onLegendHovered,!0),c.globals.dom.elWrap.addEventListener("mouseout",a.onLegendHovered,!0))}},{key:"setLegendWrapXY",value:function(t,a){var c=this.w,f=c.globals.dom.elLegendWrap,_=f.clientHeight,v=0,r=0;if(c.config.legend.position==="bottom")r=c.globals.svgHeight-Math.min(_,c.globals.svgHeight/2)-5;else if(c.config.legend.position==="top"){var E=new um(this.ctx),k=E.dimHelpers.getTitleSubtitleCoords("title").height,P=E.dimHelpers.getTitleSubtitleCoords("subtitle").height;r=(k>0?k-10:0)+(P>0?P-10:0)}f.style.position="absolute",v=v+t+c.config.legend.offsetX,r=r+a+c.config.legend.offsetY,f.style.left=v+"px",f.style.top=r+"px",c.config.legend.position==="right"&&(f.style.left="auto",f.style.right=25+c.config.legend.offsetX+"px"),["width","height"].forEach(function(L){f.style[L]&&(f.style[L]=parseInt(c.config.legend[L],10)+"px")})}},{key:"legendAlignHorizontal",value:function(){var t=this.w;t.globals.dom.elLegendWrap.style.right=0;var a=new um(this.ctx),c=a.dimHelpers.getTitleSubtitleCoords("title"),f=a.dimHelpers.getTitleSubtitleCoords("subtitle"),_=0;t.config.legend.position==="top"&&(_=c.height+f.height+t.config.title.margin+t.config.subtitle.margin-10),this.setLegendWrapXY(20,_)}},{key:"legendAlignVertical",value:function(){var t=this.w,a=this.legendHelpers.getLegendDimensions(),c=0;t.config.legend.position==="left"&&(c=20),t.config.legend.position==="right"&&(c=t.globals.svgWidth-a.clww-10),this.setLegendWrapXY(c,20)}},{key:"onLegendHovered",value:function(t){var a=this.w,c=t.target.classList.contains("apexcharts-legend-series")||t.target.classList.contains("apexcharts-legend-text")||t.target.classList.contains("apexcharts-legend-marker");if(a.config.chart.type==="heatmap"||this.isBarsDistributed){if(c){var f=parseInt(t.target.getAttribute("rel"),10)-1;this.ctx.events.fireEvent("legendHover",[this.ctx,f,this.w]),new fa(this.ctx).highlightRangeInSeries(t,t.target)}}else!t.target.classList.contains("apexcharts-inactive-legend")&&c&&new fa(this.ctx).toggleSeriesOnHover(t,t.target)}},{key:"onLegendClick",value:function(t){var a=this.w;if(!a.config.legend.customLegendItems.length&&(t.target.classList.contains("apexcharts-legend-series")||t.target.classList.contains("apexcharts-legend-text")||t.target.classList.contains("apexcharts-legend-marker"))){var c=parseInt(t.target.getAttribute("rel"),10)-1,f=t.target.getAttribute("data:collapsed")==="true",_=this.w.config.chart.events.legendClick;typeof _=="function"&&_(this.ctx,c,this.w),this.ctx.events.fireEvent("legendClick",[this.ctx,c,this.w]);var v=this.w.config.legend.markers.onClick;typeof v=="function"&&t.target.classList.contains("apexcharts-legend-marker")&&(v(this.ctx,c,this.w),this.ctx.events.fireEvent("legendMarkerClick",[this.ctx,c,this.w])),a.config.chart.type!=="treemap"&&a.config.chart.type!=="heatmap"&&!this.isBarsDistributed&&a.config.legend.onItemClick.toggleDataSeries&&this.legendHelpers.toggleDataSeries(c,f)}}}]),S}(),M1=function(){function S(t){pi(this,S),this.ctx=t,this.w=t.w;var a=this.w;this.ev=this.w.config.chart.events,this.selectedClass="apexcharts-selected",this.localeValues=this.w.globals.locale.toolbar,this.minX=a.globals.minX,this.maxX=a.globals.maxX}return gi(S,[{key:"createToolbar",value:function(){var t=this,a=this.w,c=function(){return document.createElement("div")},f=c();if(f.setAttribute("class","apexcharts-toolbar"),f.style.top=a.config.chart.toolbar.offsetY+"px",f.style.right=3-a.config.chart.toolbar.offsetX+"px",a.globals.dom.elWrap.appendChild(f),this.elZoom=c(),this.elZoomIn=c(),this.elZoomOut=c(),this.elPan=c(),this.elSelection=c(),this.elZoomReset=c(),this.elMenuIcon=c(),this.elMenu=c(),this.elCustomIcons=[],this.t=a.config.chart.toolbar.tools,Array.isArray(this.t.customIcons))for(var _=0;_<this.t.customIcons.length;_++)this.elCustomIcons.push(c());var v=[],r=function(L,O,N){var G=L.toLowerCase();t.t[G]&&a.config.chart.zoom.enabled&&v.push({el:O,icon:typeof t.t[G]=="string"?t.t[G]:N,title:t.localeValues[L],class:"apexcharts-".concat(G,"-icon")})};r("zoomIn",this.elZoomIn,`<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
    <path d="M0 0h24v24H0z" fill="none"/>
    <path d="M13 7h-2v4H7v2h4v4h2v-4h4v-2h-4V7zm-1-5C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/>
</svg>
`),r("zoomOut",this.elZoomOut,`<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
    <path d="M0 0h24v24H0z" fill="none"/>
    <path d="M7 11v2h10v-2H7zm5-9C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/>
</svg>
`);var E=function(L){t.t[L]&&a.config.chart[L].enabled&&v.push({el:L==="zoom"?t.elZoom:t.elSelection,icon:typeof t.t[L]=="string"?t.t[L]:L==="zoom"?`<svg xmlns="http://www.w3.org/2000/svg" fill="#000000" height="24" viewBox="0 0 24 24" width="24">
    <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2v1z"/>
</svg>`:`<svg fill="#6E8192" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <path d="M3 5h2V3c-1.1 0-2 .9-2 2zm0 8h2v-2H3v2zm4 8h2v-2H7v2zM3 9h2V7H3v2zm10-6h-2v2h2V3zm6 0v2h2c0-1.1-.9-2-2-2zM5 21v-2H3c0 1.1.9 2 2 2zm-2-4h2v-2H3v2zM9 3H7v2h2V3zm2 18h2v-2h-2v2zm8-8h2v-2h-2v2zm0 8c1.1 0 2-.9 2-2h-2v2zm0-12h2V7h-2v2zm0 8h2v-2h-2v2zm-4 4h2v-2h-2v2zm0-16h2V3h-2v2z"/>
</svg>`,title:t.localeValues[L==="zoom"?"selectionZoom":"selection"],class:"apexcharts-".concat(L,"-icon")})};E("zoom"),E("selection"),this.t.pan&&a.config.chart.zoom.enabled&&v.push({el:this.elPan,icon:typeof this.t.pan=="string"?this.t.pan:`<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" fill="#000000" height="24" viewBox="0 0 24 24" width="24">
    <defs>
        <path d="M0 0h24v24H0z" id="a"/>
    </defs>
    <clipPath id="b">
        <use overflow="visible" xlink:href="#a"/>
    </clipPath>
    <path clip-path="url(#b)" d="M23 5.5V20c0 2.2-1.8 4-4 4h-7.3c-1.08 0-2.1-.43-2.85-1.19L1 14.83s1.26-1.23 1.3-1.25c.22-.19.49-.29.79-.29.22 0 .42.06.6.16.04.01 4.31 2.46 4.31 2.46V4c0-.83.67-1.5 1.5-1.5S11 3.17 11 4v7h1V1.5c0-.83.67-1.5 1.5-1.5S15 .67 15 1.5V11h1V2.5c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5V11h1V5.5c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5z"/>
</svg>`,title:this.localeValues.pan,class:"apexcharts-pan-icon"}),r("reset",this.elZoomReset,`<svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
    <path d="M0 0h24v24H0z" fill="none"/>
</svg>`),this.t.download&&v.push({el:this.elMenuIcon,icon:typeof this.t.download=="string"?this.t.download:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>',title:this.localeValues.menu,class:"apexcharts-menu-icon"});for(var k=0;k<this.elCustomIcons.length;k++)v.push({el:this.elCustomIcons[k],icon:this.t.customIcons[k].icon,title:this.t.customIcons[k].title,index:this.t.customIcons[k].index,class:"apexcharts-toolbar-custom-icon "+this.t.customIcons[k].class});v.forEach(function(L,O){L.index&&et.moveIndexInArray(v,O,L.index)});for(var P=0;P<v.length;P++)Nt.setAttrs(v[P].el,{class:v[P].class,title:v[P].title}),v[P].el.innerHTML=v[P].icon,f.appendChild(v[P].el);this._createHamburgerMenu(f),a.globals.zoomEnabled?this.elZoom.classList.add(this.selectedClass):a.globals.panEnabled?this.elPan.classList.add(this.selectedClass):a.globals.selectionEnabled&&this.elSelection.classList.add(this.selectedClass),this.addToolbarEventListeners()}},{key:"_createHamburgerMenu",value:function(t){this.elMenuItems=[],t.appendChild(this.elMenu),Nt.setAttrs(this.elMenu,{class:"apexcharts-menu"});for(var a=[{name:"exportSVG",title:this.localeValues.exportToSVG},{name:"exportPNG",title:this.localeValues.exportToPNG},{name:"exportCSV",title:this.localeValues.exportToCSV}],c=0;c<a.length;c++)this.elMenuItems.push(document.createElement("div")),this.elMenuItems[c].innerHTML=a[c].title,Nt.setAttrs(this.elMenuItems[c],{class:"apexcharts-menu-item ".concat(a[c].name),title:a[c].title}),this.elMenu.appendChild(this.elMenuItems[c])}},{key:"addToolbarEventListeners",value:function(){var t=this;this.elZoomReset.addEventListener("click",this.handleZoomReset.bind(this)),this.elSelection.addEventListener("click",this.toggleZoomSelection.bind(this,"selection")),this.elZoom.addEventListener("click",this.toggleZoomSelection.bind(this,"zoom")),this.elZoomIn.addEventListener("click",this.handleZoomIn.bind(this)),this.elZoomOut.addEventListener("click",this.handleZoomOut.bind(this)),this.elPan.addEventListener("click",this.togglePanning.bind(this)),this.elMenuIcon.addEventListener("click",this.toggleMenu.bind(this)),this.elMenuItems.forEach(function(c){c.classList.contains("exportSVG")?c.addEventListener("click",t.handleDownload.bind(t,"svg")):c.classList.contains("exportPNG")?c.addEventListener("click",t.handleDownload.bind(t,"png")):c.classList.contains("exportCSV")&&c.addEventListener("click",t.handleDownload.bind(t,"csv"))});for(var a=0;a<this.t.customIcons.length;a++)this.elCustomIcons[a].addEventListener("click",this.t.customIcons[a].click.bind(this,this.ctx,this.ctx.w))}},{key:"toggleZoomSelection",value:function(t){this.ctx.getSyncedCharts().forEach(function(a){a.ctx.toolbar.toggleOtherControls();var c=t==="selection"?a.ctx.toolbar.elSelection:a.ctx.toolbar.elZoom,f=t==="selection"?"selectionEnabled":"zoomEnabled";a.w.globals[f]=!a.w.globals[f],c.classList.contains(a.ctx.toolbar.selectedClass)?c.classList.remove(a.ctx.toolbar.selectedClass):c.classList.add(a.ctx.toolbar.selectedClass)})}},{key:"getToolbarIconsReference",value:function(){var t=this.w;this.elZoom||(this.elZoom=t.globals.dom.baseEl.querySelector(".apexcharts-zoom-icon")),this.elPan||(this.elPan=t.globals.dom.baseEl.querySelector(".apexcharts-pan-icon")),this.elSelection||(this.elSelection=t.globals.dom.baseEl.querySelector(".apexcharts-selection-icon"))}},{key:"enableZoomPanFromToolbar",value:function(t){this.toggleOtherControls(),t==="pan"?this.w.globals.panEnabled=!0:this.w.globals.zoomEnabled=!0;var a=t==="pan"?this.elPan:this.elZoom,c=t==="pan"?this.elZoom:this.elPan;a&&a.classList.add(this.selectedClass),c&&c.classList.remove(this.selectedClass)}},{key:"togglePanning",value:function(){this.ctx.getSyncedCharts().forEach(function(t){t.ctx.toolbar.toggleOtherControls(),t.w.globals.panEnabled=!t.w.globals.panEnabled,t.ctx.toolbar.elPan.classList.contains(t.ctx.toolbar.selectedClass)?t.ctx.toolbar.elPan.classList.remove(t.ctx.toolbar.selectedClass):t.ctx.toolbar.elPan.classList.add(t.ctx.toolbar.selectedClass)})}},{key:"toggleOtherControls",value:function(){var t=this,a=this.w;a.globals.panEnabled=!1,a.globals.zoomEnabled=!1,a.globals.selectionEnabled=!1,this.getToolbarIconsReference(),[this.elPan,this.elSelection,this.elZoom].forEach(function(c){c&&c.classList.remove(t.selectedClass)})}},{key:"handleZoomIn",value:function(){var t=this.w;t.globals.isRangeBar&&(this.minX=t.globals.minY,this.maxX=t.globals.maxY);var a=(this.minX+this.maxX)/2,c=(this.minX+a)/2,f=(this.maxX+a)/2,_=this._getNewMinXMaxX(c,f);t.globals.disableZoomIn||this.zoomUpdateOptions(_.minX,_.maxX)}},{key:"handleZoomOut",value:function(){var t=this.w;if(t.globals.isRangeBar&&(this.minX=t.globals.minY,this.maxX=t.globals.maxY),!(t.config.xaxis.type==="datetime"&&new Date(this.minX).getUTCFullYear()<1e3)){var a=(this.minX+this.maxX)/2,c=this.minX-(a-this.minX),f=this.maxX-(a-this.maxX),_=this._getNewMinXMaxX(c,f);t.globals.disableZoomOut||this.zoomUpdateOptions(_.minX,_.maxX)}}},{key:"_getNewMinXMaxX",value:function(t,a){var c=this.w.config.xaxis.convertedCatToNumeric;return{minX:c?Math.floor(t):t,maxX:c?Math.floor(a):a}}},{key:"zoomUpdateOptions",value:function(t,a){var c=this.w;if(t!==void 0||a!==void 0){if(!(c.config.xaxis.convertedCatToNumeric&&(t<1&&(t=1,a=c.globals.dataPoints),a-t<2))){var f={min:t,max:a},_=this.getBeforeZoomRange(f);_&&(f=_.xaxis);var v={xaxis:f},r=et.clone(c.globals.initialConfig.yaxis);c.config.chart.group||(v.yaxis=r),this.w.globals.zoomed=!0,this.ctx.updateHelpers._updateOptions(v,!1,this.w.config.chart.animations.dynamicAnimation.enabled),this.zoomCallback(f,r)}}else this.handleZoomReset()}},{key:"zoomCallback",value:function(t,a){typeof this.ev.zoomed=="function"&&(this.ev.zoomed(this.ctx,{xaxis:t,yaxis:a}),this.ctx.events.fireEvent("zoomed",{xaxis:t,yaxis:a}))}},{key:"getBeforeZoomRange",value:function(t,a){var c=null;return typeof this.ev.beforeZoom=="function"&&(c=this.ev.beforeZoom(this,{xaxis:t,yaxis:a})),c}},{key:"toggleMenu",value:function(){var t=this;window.setTimeout(function(){t.elMenu.classList.contains("apexcharts-menu-open")?t.elMenu.classList.remove("apexcharts-menu-open"):t.elMenu.classList.add("apexcharts-menu-open")},0)}},{key:"handleDownload",value:function(t){var a=this.w,c=new Hf(this.ctx);switch(t){case"svg":c.exportToSVG(this.ctx);break;case"png":c.exportToPng(this.ctx);break;case"csv":c.exportToCSV({series:a.config.series,columnDelimiter:a.config.chart.toolbar.export.csv.columnDelimiter})}}},{key:"handleZoomReset",value:function(t){this.ctx.getSyncedCharts().forEach(function(a){var c=a.w;if(c.globals.lastXAxis.min=c.globals.initialConfig.xaxis.min,c.globals.lastXAxis.max=c.globals.initialConfig.xaxis.max,a.updateHelpers.revertDefaultAxisMinMax(),typeof c.config.chart.events.beforeResetZoom=="function"){var f=c.config.chart.events.beforeResetZoom(a,c);f&&a.updateHelpers.revertDefaultAxisMinMax(f)}typeof c.config.chart.events.zoomed=="function"&&a.ctx.toolbar.zoomCallback({min:c.config.xaxis.min,max:c.config.xaxis.max}),c.globals.zoomed=!1;var _=a.ctx.series.emptyCollapsedSeries(et.clone(c.globals.initialSeries));a.updateHelpers._updateSeries(_,c.config.chart.animations.dynamicAnimation.enabled)})}},{key:"destroy",value:function(){this.elZoom=null,this.elZoomIn=null,this.elZoomOut=null,this.elPan=null,this.elSelection=null,this.elZoomReset=null,this.elMenuIcon=null}}]),S}(),YE=function(S){Jf(a,M1);var t=$f(a);function a(c){var f;return pi(this,a),(f=t.call(this,c)).ctx=c,f.w=c.w,f.dragged=!1,f.graphics=new Nt(f.ctx),f.eventList=["mousedown","mouseleave","mousemove","touchstart","touchmove","mouseup","touchend","wheel"],f.clientX=0,f.clientY=0,f.startX=0,f.endX=0,f.dragX=0,f.startY=0,f.endY=0,f.dragY=0,f.moveDirection="none",f.debounceTimer=null,f.debounceDelay=100,f.wheelDelay=400,f}return gi(a,[{key:"init",value:function(c){var f=this,_=c.xyRatios,v=this.w,r=this;this.xyRatios=_,this.zoomRect=this.graphics.drawRect(0,0,0,0),this.selectionRect=this.graphics.drawRect(0,0,0,0),this.gridRect=v.globals.dom.baseEl.querySelector(".apexcharts-grid"),this.constraints=new Cs(0,0,v.globals.gridWidth,v.globals.gridHeight),this.zoomRect.node.classList.add("apexcharts-zoom-rect"),this.selectionRect.node.classList.add("apexcharts-selection-rect"),v.globals.dom.Paper.add(this.zoomRect),v.globals.dom.Paper.add(this.selectionRect),v.config.chart.selection.type==="x"?this.slDraggableRect=this.selectionRect.draggable({minX:0,minY:0,maxX:v.globals.gridWidth,maxY:v.globals.gridHeight}).on("dragmove.namespace",this.selectionDragging.bind(this,"dragging")):v.config.chart.selection.type==="y"?this.slDraggableRect=this.selectionRect.draggable({minX:0,maxX:v.globals.gridWidth}).on("dragmove.namespace",this.selectionDragging.bind(this,"dragging")):this.slDraggableRect=this.selectionRect.draggable().on("dragmove.namespace",this.selectionDragging.bind(this,"dragging")),this.preselectedSelection(),this.hoverArea=v.globals.dom.baseEl.querySelector("".concat(v.globals.chartClass," .apexcharts-svg")),this.hoverArea.classList.add("apexcharts-zoomable"),this.eventList.forEach(function(E){f.hoverArea.addEventListener(E,r.svgMouseEvents.bind(r,_),{capture:!1,passive:!0})}),v.config.chart.zoom.enabled&&v.config.chart.zoom.allowMouseWheelZoom&&this.hoverArea.addEventListener("wheel",r.mouseWheelEvent.bind(r),{capture:!1,passive:!1})}},{key:"destroy",value:function(){this.slDraggableRect&&(this.slDraggableRect.draggable(!1),this.slDraggableRect.off(),this.selectionRect.off()),this.selectionRect=null,this.zoomRect=null,this.gridRect=null}},{key:"svgMouseEvents",value:function(c,f){var _=this.w,v=this.ctx.toolbar,r=_.globals.zoomEnabled?_.config.chart.zoom.type:_.config.chart.selection.type,E=_.config.chart.toolbar.autoSelected;if(f.shiftKey?(this.shiftWasPressed=!0,v.enableZoomPanFromToolbar(E==="pan"?"zoom":"pan")):this.shiftWasPressed&&(v.enableZoomPanFromToolbar(E),this.shiftWasPressed=!1),f.target){var k,P=f.target.classList;if(f.target.parentNode&&f.target.parentNode!==null&&(k=f.target.parentNode.classList),!(P.contains("apexcharts-legend-marker")||P.contains("apexcharts-legend-text")||k&&k.contains("apexcharts-toolbar"))){if(this.clientX=f.type==="touchmove"||f.type==="touchstart"?f.touches[0].clientX:f.type==="touchend"?f.changedTouches[0].clientX:f.clientX,this.clientY=f.type==="touchmove"||f.type==="touchstart"?f.touches[0].clientY:f.type==="touchend"?f.changedTouches[0].clientY:f.clientY,f.type==="mousedown"&&f.which===1||f.type==="touchstart"){var L=this.gridRect.getBoundingClientRect();this.startX=this.clientX-L.left-_.globals.barPadForNumericAxis,this.startY=this.clientY-L.top,this.dragged=!1,this.w.globals.mousedown=!0}(f.type==="mousemove"&&f.which===1||f.type==="touchmove")&&(this.dragged=!0,_.globals.panEnabled?(_.globals.selection=null,this.w.globals.mousedown&&this.panDragging({context:this,zoomtype:r,xyRatios:c})):(this.w.globals.mousedown&&_.globals.zoomEnabled||this.w.globals.mousedown&&_.globals.selectionEnabled)&&(this.selection=this.selectionDrawing({context:this,zoomtype:r}))),f.type!=="mouseup"&&f.type!=="touchend"&&f.type!=="mouseleave"||this.handleMouseUp({zoomtype:r}),this.makeSelectionRectDraggable()}}}},{key:"handleMouseUp",value:function(c){var f,_=c.zoomtype,v=c.isResized,r=this.w,E=(f=this.gridRect)===null||f===void 0?void 0:f.getBoundingClientRect();E&&(this.w.globals.mousedown||v)&&(this.endX=this.clientX-E.left-r.globals.barPadForNumericAxis,this.endY=this.clientY-E.top,this.dragX=Math.abs(this.endX-this.startX),this.dragY=Math.abs(this.endY-this.startY),(r.globals.zoomEnabled||r.globals.selectionEnabled)&&this.selectionDrawn({context:this,zoomtype:_})),r.globals.zoomEnabled&&this.hideSelectionRect(this.selectionRect),this.dragged=!1,this.w.globals.mousedown=!1}},{key:"mouseWheelEvent",value:function(c){var f=this,_=this.w;c.preventDefault();var v=Date.now();v-_.globals.lastWheelExecution>this.wheelDelay&&(this.executeMouseWheelZoom(c),_.globals.lastWheelExecution=v),this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(function(){v-_.globals.lastWheelExecution>f.wheelDelay&&(f.executeMouseWheelZoom(c),_.globals.lastWheelExecution=v)},this.debounceDelay)}},{key:"executeMouseWheelZoom",value:function(c){var f,_=this.w;this.minX=_.globals.isRangeBar?_.globals.minY:_.globals.minX,this.maxX=_.globals.isRangeBar?_.globals.maxY:_.globals.maxX;var v=(f=this.gridRect)===null||f===void 0?void 0:f.getBoundingClientRect();if(v){var r,E,k,P=(c.clientX-v.left)/v.width,L=this.minX,O=this.maxX,N=O-L;if(c.deltaY<0){var G=L+P*N;E=G-(r=.5*N)/2,k=G+r/2}else E=L-(r=1.5*N)/2,k=O+r/2;if(!_.globals.isRangeBar){E=Math.max(E,_.globals.initialMinX),k=Math.min(k,_.globals.initialMaxX);var H=.01*(_.globals.initialMaxX-_.globals.initialMinX);if(k-E<H){var Q=(E+k)/2;E=Q-H/2,k=Q+H/2}}var ee=this._getNewMinXMaxX(E,k);isNaN(ee.minX)||isNaN(ee.maxX)||this.zoomUpdateOptions(ee.minX,ee.maxX)}}},{key:"makeSelectionRectDraggable",value:function(){var c=this,f=this.w;if(this.selectionRect){var _=this.selectionRect.node.getBoundingClientRect();_.width>0&&_.height>0&&(this.selectionRect.select(!1).resize(!1),this.selectionRect.select({createRot:function(){},updateRot:function(){},createHandle:function(v,r,E,k,P){return P==="l"||P==="r"?v.circle(8).css({"stroke-width":1,stroke:"#333",fill:"#fff"}):v.circle(0)},updateHandle:function(v,r){return v.center(r[0],r[1])}}).resize().on("resize",function(){var v=f.globals.zoomEnabled?f.config.chart.zoom.type:f.config.chart.selection.type;c.handleMouseUp({zoomtype:v,isResized:!0})}))}}},{key:"preselectedSelection",value:function(){var c=this.w,f=this.xyRatios;if(!c.globals.zoomEnabled){if(c.globals.selection!==void 0&&c.globals.selection!==null)this.drawSelectionRect(Jt(Jt({},c.globals.selection),{},{translateX:c.globals.translateX,translateY:c.globals.translateY}));else if(c.config.chart.selection.xaxis.min!==void 0&&c.config.chart.selection.xaxis.max!==void 0){var _=(c.config.chart.selection.xaxis.min-c.globals.minX)/f.xRatio,v=c.globals.gridWidth-(c.globals.maxX-c.config.chart.selection.xaxis.max)/f.xRatio-_;c.globals.isRangeBar&&(_=(c.config.chart.selection.xaxis.min-c.globals.yAxisScale[0].niceMin)/f.invertedYRatio,v=(c.config.chart.selection.xaxis.max-c.config.chart.selection.xaxis.min)/f.invertedYRatio);var r={x:_,y:0,width:v,height:c.globals.gridHeight,translateX:c.globals.translateX,translateY:c.globals.translateY,selectionEnabled:!0};this.drawSelectionRect(r),this.makeSelectionRectDraggable(),typeof c.config.chart.events.selection=="function"&&c.config.chart.events.selection(this.ctx,{xaxis:{min:c.config.chart.selection.xaxis.min,max:c.config.chart.selection.xaxis.max},yaxis:{}})}}}},{key:"drawSelectionRect",value:function(c){var f=c.x,_=c.y,v=c.width,r=c.height,E=c.translateX,k=E===void 0?0:E,P=c.translateY,L=P===void 0?0:P,O=this.w,N=this.zoomRect,G=this.selectionRect;if(this.dragged||O.globals.selection!==null){var H={transform:"translate("+k+", "+L+")"};O.globals.zoomEnabled&&this.dragged&&(v<0&&(v=1),N.attr({x:f,y:_,width:v,height:r,fill:O.config.chart.zoom.zoomedArea.fill.color,"fill-opacity":O.config.chart.zoom.zoomedArea.fill.opacity,stroke:O.config.chart.zoom.zoomedArea.stroke.color,"stroke-width":O.config.chart.zoom.zoomedArea.stroke.width,"stroke-opacity":O.config.chart.zoom.zoomedArea.stroke.opacity}),Nt.setAttrs(N.node,H)),O.globals.selectionEnabled&&(G.attr({x:f,y:_,width:v>0?v:0,height:r>0?r:0,fill:O.config.chart.selection.fill.color,"fill-opacity":O.config.chart.selection.fill.opacity,stroke:O.config.chart.selection.stroke.color,"stroke-width":O.config.chart.selection.stroke.width,"stroke-dasharray":O.config.chart.selection.stroke.dashArray,"stroke-opacity":O.config.chart.selection.stroke.opacity}),Nt.setAttrs(G.node,H))}}},{key:"hideSelectionRect",value:function(c){c&&c.attr({x:0,y:0,width:0,height:0})}},{key:"selectionDrawing",value:function(c){var f=c.context,_=c.zoomtype,v=this.w,r=f,E=this.gridRect.getBoundingClientRect(),k=r.startX-1,P=r.startY,L=!1,O=!1,N=r.clientX-E.left-v.globals.barPadForNumericAxis,G=r.clientY-E.top,H=N-k,Q=G-P,ee={translateX:v.globals.translateX,translateY:v.globals.translateY};return Math.abs(H+k)>v.globals.gridWidth?H=v.globals.gridWidth-k:N<0&&(H=k),k>N&&(L=!0,H=Math.abs(H)),P>G&&(O=!0,Q=Math.abs(Q)),ee=Jt(Jt({},ee=_==="x"?{x:L?k-H:k,y:0,width:H,height:v.globals.gridHeight}:_==="y"?{x:0,y:O?P-Q:P,width:v.globals.gridWidth,height:Q}:{x:L?k-H:k,y:O?P-Q:P,width:H,height:Q}),{},{translateX:v.globals.translateX,translateY:v.globals.translateY}),r.drawSelectionRect(ee),r.selectionDragging("resizing"),ee}},{key:"selectionDragging",value:function(c,f){var _=this,v=this.w;if(f){f.preventDefault();var r=f.detail,E=r.handler,k=r.box,P=k.x,L=k.y;P<this.constraints.x&&(P=this.constraints.x),L<this.constraints.y&&(L=this.constraints.y),k.x2>this.constraints.x2&&(P=this.constraints.x2-k.w),k.y2>this.constraints.y2&&(L=this.constraints.y2-k.h),E.move(P,L);var O=this.xyRatios,N=this.selectionRect,G=0;c==="resizing"&&(G=30);var H=function(ee){return parseFloat(N.node.getAttribute(ee))},Q={x:H("x"),y:H("y"),width:H("width"),height:H("height")};v.globals.selection=Q,typeof v.config.chart.events.selection=="function"&&v.globals.selectionEnabled&&(clearTimeout(this.w.globals.selectionResizeTimer),this.w.globals.selectionResizeTimer=window.setTimeout(function(){var ee,ie,ue,ve,ce=_.gridRect.getBoundingClientRect(),Te=N.node.getBoundingClientRect();v.globals.isRangeBar?(ee=v.globals.yAxisScale[0].niceMin+(Te.left-ce.left)*O.invertedYRatio,ie=v.globals.yAxisScale[0].niceMin+(Te.right-ce.left)*O.invertedYRatio,ue=0,ve=1):(ee=v.globals.xAxisScale.niceMin+(Te.left-ce.left)*O.xRatio,ie=v.globals.xAxisScale.niceMin+(Te.right-ce.left)*O.xRatio,ue=v.globals.yAxisScale[0].niceMin+(ce.bottom-Te.bottom)*O.yRatio[0],ve=v.globals.yAxisScale[0].niceMax-(Te.top-ce.top)*O.yRatio[0]);var Se={xaxis:{min:ee,max:ie},yaxis:{min:ue,max:ve}};v.config.chart.events.selection(_.ctx,Se),v.config.chart.brush.enabled&&v.config.chart.events.brushScrolled!==void 0&&v.config.chart.events.brushScrolled(_.ctx,Se)},G))}}},{key:"selectionDrawn",value:function(c){var f,_,v=c.context,r=c.zoomtype,E=this.w,k=v,P=this.xyRatios,L=this.ctx.toolbar,O=E.globals.zoomEnabled?k.zoomRect.node.getBoundingClientRect():k.selectionRect.node.getBoundingClientRect(),N=k.gridRect.getBoundingClientRect(),G=O.left-N.left-E.globals.barPadForNumericAxis,H=O.right-N.left-E.globals.barPadForNumericAxis,Q=O.top-N.top,ee=O.bottom-N.top;E.globals.isRangeBar?(f=E.globals.yAxisScale[0].niceMin+G*P.invertedYRatio,_=E.globals.yAxisScale[0].niceMin+H*P.invertedYRatio):(f=E.globals.xAxisScale.niceMin+G*P.xRatio,_=E.globals.xAxisScale.niceMin+H*P.xRatio);var ie=[],ue=[];if(E.config.yaxis.forEach(function(Ke,qe){var ft=E.globals.seriesYAxisMap[qe][0],bt=E.globals.yAxisScale[qe].niceMax-P.yRatio[ft]*Q,Tt=E.globals.yAxisScale[qe].niceMax-P.yRatio[ft]*ee;ie.push(bt),ue.push(Tt)}),k.dragged&&(k.dragX>10||k.dragY>10)&&f!==_){if(E.globals.zoomEnabled){var ve=et.clone(E.globals.initialConfig.yaxis),ce=et.clone(E.globals.initialConfig.xaxis);if(E.globals.zoomed=!0,E.config.xaxis.convertedCatToNumeric&&(f=Math.floor(f),_=Math.floor(_),f<1&&(f=1,_=E.globals.dataPoints),_-f<2&&(_=f+1)),r!=="xy"&&r!=="x"||(ce={min:f,max:_}),r!=="xy"&&r!=="y"||ve.forEach(function(Ke,qe){ve[qe].min=ue[qe],ve[qe].max=ie[qe]}),L){var Te=L.getBeforeZoomRange(ce,ve);Te&&(ce=Te.xaxis?Te.xaxis:ce,ve=Te.yaxis?Te.yaxis:ve)}var Se={xaxis:ce};E.config.chart.group||(Se.yaxis=ve),k.ctx.updateHelpers._updateOptions(Se,!1,k.w.config.chart.animations.dynamicAnimation.enabled),typeof E.config.chart.events.zoomed=="function"&&L.zoomCallback(ce,ve)}else if(E.globals.selectionEnabled){var Ie,Ue=null;Ie={min:f,max:_},r!=="xy"&&r!=="y"||(Ue=et.clone(E.config.yaxis)).forEach(function(Ke,qe){Ue[qe].min=ue[qe],Ue[qe].max=ie[qe]}),E.globals.selection=k.selection,typeof E.config.chart.events.selection=="function"&&E.config.chart.events.selection(k.ctx,{xaxis:Ie,yaxis:Ue})}}}},{key:"panDragging",value:function(c){var f=c.context,_=this.w,v=f;if(_.globals.lastClientPosition.x!==void 0){var r=_.globals.lastClientPosition.x-v.clientX,E=_.globals.lastClientPosition.y-v.clientY;Math.abs(r)>Math.abs(E)&&r>0?this.moveDirection="left":Math.abs(r)>Math.abs(E)&&r<0?this.moveDirection="right":Math.abs(E)>Math.abs(r)&&E>0?this.moveDirection="up":Math.abs(E)>Math.abs(r)&&E<0&&(this.moveDirection="down")}_.globals.lastClientPosition={x:v.clientX,y:v.clientY};var k=_.globals.isRangeBar?_.globals.minY:_.globals.minX,P=_.globals.isRangeBar?_.globals.maxY:_.globals.maxX;v.panScrolled(k,P)}},{key:"panScrolled",value:function(c,f){var _=this.w,v=this.xyRatios,r=et.clone(_.globals.initialConfig.yaxis),E=v.xRatio,k=_.globals.minX,P=_.globals.maxX;_.globals.isRangeBar&&(E=v.invertedYRatio,k=_.globals.minY,P=_.globals.maxY),this.moveDirection==="left"?(c=k+_.globals.gridWidth/15*E,f=P+_.globals.gridWidth/15*E):this.moveDirection==="right"&&(c=k-_.globals.gridWidth/15*E,f=P-_.globals.gridWidth/15*E),_.globals.isRangeBar||(c<_.globals.initialMinX||f>_.globals.initialMaxX)&&(c=k,f=P);var L={xaxis:{min:c,max:f}};_.config.chart.group||(L.yaxis=r),this.updateScrolledChart(L,c,f)}},{key:"updateScrolledChart",value:function(c,f,_){var v=this.w;if(this.ctx.updateHelpers._updateOptions(c,!1,!1),typeof v.config.chart.events.scrolled=="function"){var r={xaxis:{min:f,max:_}};v.config.chart.events.scrolled(this.ctx,r),this.ctx.events.fireEvent("scrolled",r)}}}]),a}(),P1=function(){function S(t){pi(this,S),this.w=t.w,this.ttCtx=t,this.ctx=t.ctx}return gi(S,[{key:"getNearestValues",value:function(t){var a=t.hoverArea,c=t.elGrid,f=t.clientX,_=t.clientY,v=this.w,r=c.getBoundingClientRect(),E=r.width,k=r.height,P=E/(v.globals.dataPoints-1),L=k/v.globals.dataPoints,O=this.hasBars();!v.globals.comboCharts&&!O||v.config.xaxis.convertedCatToNumeric||(P=E/v.globals.dataPoints);var N=f-r.left-v.globals.barPadForNumericAxis,G=_-r.top;N<0||G<0||N>E||G>k?(a.classList.remove("hovering-zoom"),a.classList.remove("hovering-pan")):v.globals.zoomEnabled?(a.classList.remove("hovering-pan"),a.classList.add("hovering-zoom")):v.globals.panEnabled&&(a.classList.remove("hovering-zoom"),a.classList.add("hovering-pan"));var H=Math.round(N/P),Q=Math.floor(G/L);O&&!v.config.xaxis.convertedCatToNumeric&&(H=Math.ceil(N/P),H-=1);var ee=null,ie=null,ue=v.globals.seriesXvalues.map(function(Ie){return Ie.filter(function(Ue){return et.isNumber(Ue)})}),ve=v.globals.seriesYvalues.map(function(Ie){return Ie.filter(function(Ue){return et.isNumber(Ue)})});if(v.globals.isXNumeric){var ce=this.ttCtx.getElGrid().getBoundingClientRect(),Te=N*(ce.width/E),Se=G*(ce.height/k);ee=(ie=this.closestInMultiArray(Te,Se,ue,ve)).index,H=ie.j,ee!==null&&v.globals.hasNullValues&&(ue=v.globals.seriesXvalues[ee],H=(ie=this.closestInArray(Te,ue)).j)}return v.globals.capturedSeriesIndex=ee===null?-1:ee,(!H||H<1)&&(H=0),v.globals.isBarHorizontal?v.globals.capturedDataPointIndex=Q:v.globals.capturedDataPointIndex=H,{capturedSeries:ee,j:v.globals.isBarHorizontal?Q:H,hoverX:N,hoverY:G}}},{key:"getFirstActiveXArray",value:function(t){for(var a=this.w,c=0,f=t.map(function(v,r){return v.length>0?r:-1}),_=0;_<f.length;_++)if(f[_]!==-1&&a.globals.collapsedSeriesIndices.indexOf(_)===-1&&a.globals.ancillaryCollapsedSeriesIndices.indexOf(_)===-1){c=f[_];break}return c}},{key:"closestInMultiArray",value:function(t,a,c,f){for(var _,v=this.w,r=1/0,E=null,k=null,P=0;P<c.length;P++)if(_=P,v.globals.collapsedSeriesIndices.indexOf(_)===-1&&v.globals.ancillaryCollapsedSeriesIndices.indexOf(_)===-1)for(var L=c[P],O=f[P],N=Math.min(L.length,O.length),G=0;G<N;G++){var H=t-L[G],Q=Math.sqrt(H*H);if(!v.globals.allSeriesHasEqualX){var ee=a-O[G];Q=Math.sqrt(H*H+ee*ee)}Q<r&&(r=Q,E=P,k=G)}return{index:E,j:k}}},{key:"closestInArray",value:function(t,a){for(var c=a[0],f=null,_=Math.abs(t-c),v=0;v<a.length;v++){var r=Math.abs(t-a[v]);r<_&&(_=r,f=v)}return{j:f}}},{key:"isXoverlap",value:function(t){var a=[],c=this.w.globals.seriesX.filter(function(_){return _[0]!==void 0});if(c.length>0)for(var f=0;f<c.length-1;f++)c[f][t]!==void 0&&c[f+1][t]!==void 0&&c[f][t]!==c[f+1][t]&&a.push("unEqual");return a.length===0}},{key:"isInitialSeriesSameLen",value:function(){for(var t=!0,a=this.w.globals.initialSeries,c=0;c<a.length-1;c++)if(a[c].data.length!==a[c+1].data.length){t=!1;break}return t}},{key:"getBarsHeight",value:function(t){return Us(t).reduce(function(a,c){return a+c.getBBox().height},0)}},{key:"getElMarkers",value:function(t){return typeof t=="number"?this.w.globals.dom.baseEl.querySelectorAll(".apexcharts-series[data\\:realIndex='".concat(t,"'] .apexcharts-series-markers-wrap > *")):this.w.globals.dom.baseEl.querySelectorAll(".apexcharts-series-markers-wrap > *")}},{key:"getAllMarkers",value:function(){var t=this,a=arguments.length>0&&arguments[0]!==void 0&&arguments[0],c=this.w.globals.dom.baseEl.querySelectorAll(".apexcharts-series-markers-wrap");c=Us(c),a&&(c=c.filter(function(_){var v=Number(_.getAttribute("data:realIndex"));return t.w.globals.collapsedSeriesIndices.indexOf(v)===-1})),c.sort(function(_,v){var r=Number(_.getAttribute("data:realIndex")),E=Number(v.getAttribute("data:realIndex"));return E<r?1:E>r?-1:0});var f=[];return c.forEach(function(_){f.push(_.querySelector(".apexcharts-marker"))}),f}},{key:"hasMarkers",value:function(t){return this.getElMarkers(t).length>0}},{key:"getPathFromPoint",value:function(t,a){var c=Number(t.getAttribute("cx")),f=Number(t.getAttribute("cy")),_=t.getAttribute("shape");return new Nt(this.ctx).getMarkerPath(c,f,_,a)}},{key:"getElBars",value:function(){return this.w.globals.dom.baseEl.querySelectorAll(".apexcharts-bar-series,  .apexcharts-candlestick-series, .apexcharts-boxPlot-series, .apexcharts-rangebar-series")}},{key:"hasBars",value:function(){return this.getElBars().length>0}},{key:"getHoverMarkerSize",value:function(t){var a=this.w,c=a.config.markers.hover.size;return c===void 0&&(c=a.globals.markers.size[t]+a.config.markers.hover.sizeOffset),c}},{key:"toggleAllTooltipSeriesGroups",value:function(t){var a=this.w,c=this.ttCtx;c.allTooltipSeriesGroups.length===0&&(c.allTooltipSeriesGroups=a.globals.dom.baseEl.querySelectorAll(".apexcharts-tooltip-series-group"));for(var f=c.allTooltipSeriesGroups,_=0;_<f.length;_++)t==="enable"?(f[_].classList.add("apexcharts-active"),f[_].style.display=a.config.tooltip.items.display):(f[_].classList.remove("apexcharts-active"),f[_].style.display="none")}}]),S}(),qE=function(){function S(t){pi(this,S),this.w=t.w,this.ctx=t.ctx,this.ttCtx=t,this.tooltipUtil=new P1(t)}return gi(S,[{key:"drawSeriesTexts",value:function(t){var a=t.shared,c=a===void 0||a,f=t.ttItems,_=t.i,v=_===void 0?0:_,r=t.j,E=r===void 0?null:r,k=t.y1,P=t.y2,L=t.e,O=this.w;O.config.tooltip.custom!==void 0?this.handleCustomTooltip({i:v,j:E,y1:k,y2:P,w:O}):this.toggleActiveInactiveSeries(c,v);var N=this.getValuesToPrint({i:v,j:E});this.printLabels({i:v,j:E,values:N,ttItems:f,shared:c,e:L});var G=this.ttCtx.getElTooltip();this.ttCtx.tooltipRect.ttWidth=G.getBoundingClientRect().width,this.ttCtx.tooltipRect.ttHeight=G.getBoundingClientRect().height}},{key:"printLabels",value:function(t){var a,c=this,f=t.i,_=t.j,v=t.values,r=t.ttItems,E=t.shared,k=t.e,P=this.w,L=[],O=function(ce){return P.globals.seriesGoals[ce]&&P.globals.seriesGoals[ce][_]&&Array.isArray(P.globals.seriesGoals[ce][_])},N=v.xVal,G=v.zVal,H=v.xAxisTTVal,Q="",ee=P.globals.colors[f];_!==null&&P.config.plotOptions.bar.distributed&&(ee=P.globals.colors[_]);for(var ie=function(ce,Te){var Se=c.getFormatters(f);Q=c.getSeriesName({fn:Se.yLbTitleFormatter,index:f,seriesIndex:f,j:_}),P.config.chart.type==="treemap"&&(Q=Se.yLbTitleFormatter(String(P.config.series[f].data[_].x),{series:P.globals.series,seriesIndex:f,dataPointIndex:_,w:P}));var Ie=P.config.tooltip.inverseOrder?Te:ce;if(P.globals.axisCharts){var Ue=function(ft){var bt,Tt,Et,Lt;return P.globals.isRangeData?Se.yLbFormatter((bt=P.globals.seriesRangeStart)===null||bt===void 0||(Tt=bt[ft])===null||Tt===void 0?void 0:Tt[_],{series:P.globals.seriesRangeStart,seriesIndex:ft,dataPointIndex:_,w:P})+" - "+Se.yLbFormatter((Et=P.globals.seriesRangeEnd)===null||Et===void 0||(Lt=Et[ft])===null||Lt===void 0?void 0:Lt[_],{series:P.globals.seriesRangeEnd,seriesIndex:ft,dataPointIndex:_,w:P}):Se.yLbFormatter(P.globals.series[ft][_],{series:P.globals.series,seriesIndex:ft,dataPointIndex:_,w:P})};if(E)Se=c.getFormatters(Ie),Q=c.getSeriesName({fn:Se.yLbTitleFormatter,index:Ie,seriesIndex:f,j:_}),ee=P.globals.colors[Ie],a=Ue(Ie),O(Ie)&&(L=P.globals.seriesGoals[Ie][_].map(function(ft){return{attrs:ft,val:Se.yLbFormatter(ft.value,{seriesIndex:Ie,dataPointIndex:_,w:P})}}));else{var Ke,qe=k==null||(Ke=k.target)===null||Ke===void 0?void 0:Ke.getAttribute("fill");qe&&(qe.indexOf("url")!==-1?qe.indexOf("Pattern")!==-1&&(ee=P.globals.dom.baseEl.querySelector(qe.substr(4).slice(0,-1)).childNodes[0].getAttribute("stroke")):ee=qe),a=Ue(f),O(f)&&Array.isArray(P.globals.seriesGoals[f][_])&&(L=P.globals.seriesGoals[f][_].map(function(ft){return{attrs:ft,val:Se.yLbFormatter(ft.value,{seriesIndex:f,dataPointIndex:_,w:P})}}))}}_===null&&(a=Se.yLbFormatter(P.globals.series[f],Jt(Jt({},P),{},{seriesIndex:f,dataPointIndex:f}))),c.DOMHandling({i:f,t:Ie,j:_,ttItems:r,values:{val:a,goalVals:L,xVal:N,xAxisTTVal:H,zVal:G},seriesName:Q,shared:E,pColor:ee})},ue=0,ve=P.globals.series.length-1;ue<P.globals.series.length;ue++,ve--)ie(ue,ve)}},{key:"getFormatters",value:function(t){var a,c=this.w,f=c.globals.yLabelFormatters[t];return c.globals.ttVal!==void 0?Array.isArray(c.globals.ttVal)?(f=c.globals.ttVal[t]&&c.globals.ttVal[t].formatter,a=c.globals.ttVal[t]&&c.globals.ttVal[t].title&&c.globals.ttVal[t].title.formatter):(f=c.globals.ttVal.formatter,typeof c.globals.ttVal.title.formatter=="function"&&(a=c.globals.ttVal.title.formatter)):a=c.config.tooltip.y.title.formatter,typeof f!="function"&&(f=c.globals.yLabelFormatters[0]?c.globals.yLabelFormatters[0]:function(_){return _}),typeof a!="function"&&(a=function(_){return _?_+": ":""}),{yLbFormatter:f,yLbTitleFormatter:a}}},{key:"getSeriesName",value:function(t){var a=t.fn,c=t.index,f=t.seriesIndex,_=t.j,v=this.w;return a(String(v.globals.seriesNames[c]),{series:v.globals.series,seriesIndex:f,dataPointIndex:_,w:v})}},{key:"DOMHandling",value:function(t){t.i;var a=t.t,c=t.j,f=t.ttItems,_=t.values,v=t.seriesName,r=t.shared,E=t.pColor,k=this.w,P=this.ttCtx,L=_.val,O=_.goalVals,N=_.xVal,G=_.xAxisTTVal,H=_.zVal,Q=null;Q=f[a].children,k.config.tooltip.fillSeriesColor&&(f[a].style.backgroundColor=E,Q[0].style.display="none"),P.showTooltipTitle&&(P.tooltipTitle===null&&(P.tooltipTitle=k.globals.dom.baseEl.querySelector(".apexcharts-tooltip-title")),P.tooltipTitle.innerHTML=N),P.isXAxisTooltipEnabled&&(P.xaxisTooltipText.innerHTML=G!==""?G:N);var ee=f[a].querySelector(".apexcharts-tooltip-text-y-label");ee&&(ee.innerHTML=v||"");var ie=f[a].querySelector(".apexcharts-tooltip-text-y-value");ie&&(ie.innerHTML=L!==void 0?L:""),Q[0]&&Q[0].classList.contains("apexcharts-tooltip-marker")&&(k.config.tooltip.marker.fillColors&&Array.isArray(k.config.tooltip.marker.fillColors)&&(E=k.config.tooltip.marker.fillColors[a]),k.config.tooltip.fillSeriesColor?Q[0].style.backgroundColor=E:Q[0].style.color=E),k.config.tooltip.marker.show||(Q[0].style.display="none");var ue=f[a].querySelector(".apexcharts-tooltip-text-goals-label"),ve=f[a].querySelector(".apexcharts-tooltip-text-goals-value");if(O.length&&k.globals.seriesGoals[a]){var ce=function(){var Ie="<div>",Ue="<div>";O.forEach(function(Ke,qe){Ie+=' <div style="display: flex"><span class="apexcharts-tooltip-marker" style="background-color: '.concat(Ke.attrs.strokeColor,'; height: 3px; border-radius: 0; top: 5px;"></span> ').concat(Ke.attrs.name,"</div>"),Ue+="<div>".concat(Ke.val,"</div>")}),ue.innerHTML=Ie+"</div>",ve.innerHTML=Ue+"</div>"};r?k.globals.seriesGoals[a][c]&&Array.isArray(k.globals.seriesGoals[a][c])?ce():(ue.innerHTML="",ve.innerHTML=""):ce()}else ue.innerHTML="",ve.innerHTML="";if(H!==null&&(f[a].querySelector(".apexcharts-tooltip-text-z-label").innerHTML=k.config.tooltip.z.title,f[a].querySelector(".apexcharts-tooltip-text-z-value").innerHTML=H!==void 0?H:""),r&&Q[0]){if(k.config.tooltip.hideEmptySeries){var Te=f[a].querySelector(".apexcharts-tooltip-marker"),Se=f[a].querySelector(".apexcharts-tooltip-text");parseFloat(L)==0?(Te.style.display="none",Se.style.display="none"):(Te.style.display="block",Se.style.display="block")}L==null||k.globals.ancillaryCollapsedSeriesIndices.indexOf(a)>-1||k.globals.collapsedSeriesIndices.indexOf(a)>-1||Array.isArray(P.tConfig.enabledOnSeries)&&P.tConfig.enabledOnSeries.indexOf(a)===-1?Q[0].parentNode.style.display="none":Q[0].parentNode.style.display=k.config.tooltip.items.display}else Array.isArray(P.tConfig.enabledOnSeries)&&P.tConfig.enabledOnSeries.indexOf(a)===-1&&(Q[0].parentNode.style.display="none")}},{key:"toggleActiveInactiveSeries",value:function(t,a){var c=this.w;if(t)this.tooltipUtil.toggleAllTooltipSeriesGroups("enable");else{this.tooltipUtil.toggleAllTooltipSeriesGroups("disable");var f=c.globals.dom.baseEl.querySelector(".apexcharts-tooltip-series-group-".concat(a));f&&(f.classList.add("apexcharts-active"),f.style.display=c.config.tooltip.items.display)}}},{key:"getValuesToPrint",value:function(t){var a=t.i,c=t.j,f=this.w,_=this.ctx.series.filteredSeriesX(),v="",r="",E=null,k=null,P={series:f.globals.series,seriesIndex:a,dataPointIndex:c,w:f},L=f.globals.ttZFormatter;c===null?k=f.globals.series[a]:f.globals.isXNumeric&&f.config.chart.type!=="treemap"?(v=_[a][c],_[a].length===0&&(v=_[this.tooltipUtil.getFirstActiveXArray(_)][c])):v=new gx(this.ctx).isFormatXY()?f.config.series[a].data[c]!==void 0?f.config.series[a].data[c].x:"":f.globals.labels[c]!==void 0?f.globals.labels[c]:"";var O=v;return f.globals.isXNumeric&&f.config.xaxis.type==="datetime"?v=new tp(this.ctx).xLabelFormat(f.globals.ttKeyFormatter,O,O,{i:void 0,dateFormatter:new tn(this.ctx).formatDate,w:this.w}):v=f.globals.isBarHorizontal?f.globals.yLabelFormatters[0](O,P):f.globals.xLabelFormatter(O,P),f.config.tooltip.x.formatter!==void 0&&(v=f.globals.ttKeyFormatter(O,P)),f.globals.seriesZ.length>0&&f.globals.seriesZ[a].length>0&&(E=L(f.globals.seriesZ[a][c],f)),r=typeof f.config.xaxis.tooltip.formatter=="function"?f.globals.xaxisTooltipFormatter(O,P):v,{val:Array.isArray(k)?k.join(" "):k,xVal:Array.isArray(v)?v.join(" "):v,xAxisTTVal:Array.isArray(r)?r.join(" "):r,zVal:E}}},{key:"handleCustomTooltip",value:function(t){var a=t.i,c=t.j,f=t.y1,_=t.y2,v=t.w,r=this.ttCtx.getElTooltip(),E=v.config.tooltip.custom;Array.isArray(E)&&E[a]&&(E=E[a]);var k=E({ctx:this.ctx,series:v.globals.series,seriesIndex:a,dataPointIndex:c,y1:f,y2:_,w:v});typeof k=="string"||typeof k=="number"?r.innerHTML=k:(k instanceof Element||typeof k.nodeName=="string")&&(r.innerHTML="",r.appendChild(k.cloneNode(!0)))}}]),S}(),L1=function(){function S(t){pi(this,S),this.ttCtx=t,this.ctx=t.ctx,this.w=t.w}return gi(S,[{key:"moveXCrosshairs",value:function(t){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,c=this.ttCtx,f=this.w,_=c.getElXCrosshairs(),v=t-c.xcrosshairsWidth/2,r=f.globals.labels.slice().length;if(a!==null&&(v=f.globals.gridWidth/r*a),_===null||f.globals.isBarHorizontal||(_.setAttribute("x",v),_.setAttribute("x1",v),_.setAttribute("x2",v),_.setAttribute("y2",f.globals.gridHeight),_.classList.add("apexcharts-active")),v<0&&(v=0),v>f.globals.gridWidth&&(v=f.globals.gridWidth),c.isXAxisTooltipEnabled){var E=v;f.config.xaxis.crosshairs.width!=="tickWidth"&&f.config.xaxis.crosshairs.width!=="barWidth"||(E=v+c.xcrosshairsWidth/2),this.moveXAxisTooltip(E)}}},{key:"moveYCrosshairs",value:function(t){var a=this.ttCtx;a.ycrosshairs!==null&&Nt.setAttrs(a.ycrosshairs,{y1:t,y2:t}),a.ycrosshairsHidden!==null&&Nt.setAttrs(a.ycrosshairsHidden,{y1:t,y2:t})}},{key:"moveXAxisTooltip",value:function(t){var a=this.w,c=this.ttCtx;if(c.xaxisTooltip!==null&&c.xcrosshairsWidth!==0){c.xaxisTooltip.classList.add("apexcharts-active");var f=c.xaxisOffY+a.config.xaxis.tooltip.offsetY+a.globals.translateY+1+a.config.xaxis.offsetY;if(t-=c.xaxisTooltip.getBoundingClientRect().width/2,!isNaN(t)){t+=a.globals.translateX;var _;_=new Nt(this.ctx).getTextRects(c.xaxisTooltipText.innerHTML),c.xaxisTooltipText.style.minWidth=_.width+"px",c.xaxisTooltip.style.left=t+"px",c.xaxisTooltip.style.top=f+"px"}}}},{key:"moveYAxisTooltip",value:function(t){var a=this.w,c=this.ttCtx;c.yaxisTTEls===null&&(c.yaxisTTEls=a.globals.dom.baseEl.querySelectorAll(".apexcharts-yaxistooltip"));var f=parseInt(c.ycrosshairsHidden.getAttribute("y1"),10),_=a.globals.translateY+f,v=c.yaxisTTEls[t].getBoundingClientRect(),r=v.height,E=a.globals.translateYAxisX[t]-2;a.config.yaxis[t].opposite&&(E-=v.width),_-=r/2,a.globals.ignoreYAxisIndexes.indexOf(t)===-1&&_>0&&_<a.globals.gridHeight?(c.yaxisTTEls[t].classList.add("apexcharts-active"),c.yaxisTTEls[t].style.top=_+"px",c.yaxisTTEls[t].style.left=E+a.config.yaxis[t].tooltip.offsetX+"px"):c.yaxisTTEls[t].classList.remove("apexcharts-active")}},{key:"moveTooltip",value:function(t,a){var c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,f=this.w,_=this.ttCtx,v=_.getElTooltip(),r=_.tooltipRect,E=c!==null?parseFloat(c):1,k=parseFloat(t)+E+5,P=parseFloat(a)+E/2;if(k>f.globals.gridWidth/2&&(k=k-r.ttWidth-E-10),k>f.globals.gridWidth-r.ttWidth-10&&(k=f.globals.gridWidth-r.ttWidth),k<-20&&(k=-20),f.config.tooltip.followCursor){var L=_.getElGrid().getBoundingClientRect();(k=_.e.clientX-L.left)>f.globals.gridWidth/2&&(k-=_.tooltipRect.ttWidth),(P=_.e.clientY+f.globals.translateY-L.top)>f.globals.gridHeight/2&&(P-=_.tooltipRect.ttHeight)}else f.globals.isBarHorizontal||r.ttHeight/2+P>f.globals.gridHeight&&(P=f.globals.gridHeight-r.ttHeight+f.globals.translateY);isNaN(k)||(k+=f.globals.translateX,v.style.left=k+"px",v.style.top=P+"px")}},{key:"moveMarkers",value:function(t,a){var c=this.w,f=this.ttCtx;if(c.globals.markers.size[t]>0)for(var _=c.globals.dom.baseEl.querySelectorAll(" .apexcharts-series[data\\:realIndex='".concat(t,"'] .apexcharts-marker")),v=0;v<_.length;v++)parseInt(_[v].getAttribute("rel"),10)===a&&(f.marker.resetPointsSize(),f.marker.enlargeCurrentPoint(a,_[v]));else f.marker.resetPointsSize(),this.moveDynamicPointOnHover(a,t)}},{key:"moveDynamicPointOnHover",value:function(t,a){var c,f,_,v,r=this.w,E=this.ttCtx,k=new Nt(this.ctx),P=r.globals.pointsArray,L=E.tooltipUtil.getHoverMarkerSize(a),O=r.config.series[a].type;if(!O||O!=="column"&&O!=="candlestick"&&O!=="boxPlot"){_=(c=P[a][t])===null||c===void 0?void 0:c[0],v=((f=P[a][t])===null||f===void 0?void 0:f[1])||0;var N=r.globals.dom.baseEl.querySelector(".apexcharts-series[data\\:realIndex='".concat(a,"'] .apexcharts-series-markers path"));if(N&&v<r.globals.gridHeight&&v>0){var G=N.getAttribute("shape"),H=k.getMarkerPath(_,v,G,1.5*L);N.setAttribute("d",H)}this.moveXCrosshairs(_),E.fixedTooltip||this.moveTooltip(_,v,L)}}},{key:"moveDynamicPointsOnHover",value:function(t){var a,c=this.ttCtx,f=c.w,_=0,v=0,r=f.globals.pointsArray,E=new fa(this.ctx),k=new Nt(this.ctx);a=E.getActiveConfigSeriesIndex("asc",["line","area","scatter","bubble"]);var P=c.tooltipUtil.getHoverMarkerSize(a);if(r[a]&&(_=r[a][t][0],v=r[a][t][1]),!isNaN(_)){var L=c.tooltipUtil.getAllMarkers();if(L.length)for(var O=0;O<f.globals.series.length;O++){var N=r[O];if(f.globals.comboCharts&&N===void 0&&L.splice(O,0,null),N&&N.length){var G=r[O][t][1],H=void 0;L[O].setAttribute("cx",_);var Q=L[O].getAttribute("shape");if(f.config.chart.type==="rangeArea"&&!f.globals.comboCharts){var ee=t+f.globals.series[O].length;H=r[O][ee][1],G-=Math.abs(G-H)/2}if(G!==null&&!isNaN(G)&&G<f.globals.gridHeight+P&&G+P>0){var ie=k.getMarkerPath(_,G,Q,P);L[O].setAttribute("d",ie)}else L[O].setAttribute("d","")}}this.moveXCrosshairs(_),c.fixedTooltip||this.moveTooltip(_,v||f.globals.gridHeight,P)}}},{key:"moveStickyTooltipOverBars",value:function(t,a){var c=this.w,f=this.ttCtx,_=c.globals.columnSeries?c.globals.columnSeries.length:c.globals.series.length;c.config.chart.stacked&&(_=c.globals.barGroups.length);var v=_>=2&&_%2==0?Math.floor(_/2):Math.floor(_/2)+1;c.globals.isBarHorizontal&&(v=new fa(this.ctx).getActiveConfigSeriesIndex("desc")+1);var r=c.globals.dom.baseEl.querySelector(".apexcharts-bar-series .apexcharts-series[rel='".concat(v,"'] path[j='").concat(t,"'], .apexcharts-candlestick-series .apexcharts-series[rel='").concat(v,"'] path[j='").concat(t,"'], .apexcharts-boxPlot-series .apexcharts-series[rel='").concat(v,"'] path[j='").concat(t,"'], .apexcharts-rangebar-series .apexcharts-series[rel='").concat(v,"'] path[j='").concat(t,"']"));r||typeof a!="number"||(r=c.globals.dom.baseEl.querySelector(".apexcharts-bar-series .apexcharts-series[data\\:realIndex='".concat(a,"'] path[j='").concat(t,`'],
        .apexcharts-candlestick-series .apexcharts-series[data\\:realIndex='`).concat(a,"'] path[j='").concat(t,`'],
        .apexcharts-boxPlot-series .apexcharts-series[data\\:realIndex='`).concat(a,"'] path[j='").concat(t,`'],
        .apexcharts-rangebar-series .apexcharts-series[data\\:realIndex='`).concat(a,"'] path[j='").concat(t,"']")));var E=r?parseFloat(r.getAttribute("cx")):0,k=r?parseFloat(r.getAttribute("cy")):0,P=r?parseFloat(r.getAttribute("barWidth")):0,L=f.getElGrid().getBoundingClientRect(),O=r&&(r.classList.contains("apexcharts-candlestick-area")||r.classList.contains("apexcharts-boxPlot-area"));c.globals.isXNumeric?(r&&!O&&(E-=_%2!=0?P/2:0),r&&O&&(E-=P/2)):c.globals.isBarHorizontal||(E=f.xAxisTicksPositions[t-1]+f.dataPointsDividedWidth/2,isNaN(E)&&(E=f.xAxisTicksPositions[t]-f.dataPointsDividedWidth/2)),c.globals.isBarHorizontal?k-=f.tooltipRect.ttHeight:c.config.tooltip.followCursor?k=f.e.clientY-L.top-f.tooltipRect.ttHeight/2:k+f.tooltipRect.ttHeight+15>c.globals.gridHeight&&(k=c.globals.gridHeight),c.globals.isBarHorizontal||this.moveXCrosshairs(E),f.fixedTooltip||this.moveTooltip(E,k||c.globals.gridHeight)}}]),S}(),ZE=function(){function S(t){pi(this,S),this.w=t.w,this.ttCtx=t,this.ctx=t.ctx,this.tooltipPosition=new L1(t)}return gi(S,[{key:"drawDynamicPoints",value:function(){var t=this.w,a=new Nt(this.ctx),c=new Hu(this.ctx),f=t.globals.dom.baseEl.querySelectorAll(".apexcharts-series");f=Us(f),t.config.chart.stacked&&f.sort(function(L,O){return parseFloat(L.getAttribute("data:realIndex"))-parseFloat(O.getAttribute("data:realIndex"))});for(var _=0;_<f.length;_++){var v=f[_].querySelector(".apexcharts-series-markers-wrap");if(v!==null){var r=void 0,E="apexcharts-marker w".concat((Math.random()+1).toString(36).substring(4));t.config.chart.type!=="line"&&t.config.chart.type!=="area"||t.globals.comboCharts||t.config.tooltip.intersect||(E+=" no-pointer-events");var k=c.getMarkerConfig({cssClass:E,seriesIndex:Number(v.getAttribute("data:realIndex"))});(r=a.drawMarker(0,0,k)).node.setAttribute("default-marker-size",0);var P=document.createElementNS(t.globals.SVGNS,"g");P.classList.add("apexcharts-series-markers"),P.appendChild(r.node),v.appendChild(P)}}}},{key:"enlargeCurrentPoint",value:function(t,a){var c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,f=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,_=this.w;_.config.chart.type!=="bubble"&&this.newPointSize(t,a);var v=a.getAttribute("cx"),r=a.getAttribute("cy");if(c!==null&&f!==null&&(v=c,r=f),this.tooltipPosition.moveXCrosshairs(v),!this.fixedTooltip){if(_.config.chart.type==="radar"){var E=this.ttCtx.getElGrid().getBoundingClientRect();v=this.ttCtx.e.clientX-E.left}this.tooltipPosition.moveTooltip(v,r,_.config.markers.hover.size)}}},{key:"enlargePoints",value:function(t){for(var a=this.w,c=this,f=this.ttCtx,_=t,v=a.globals.dom.baseEl.querySelectorAll(".apexcharts-series:not(.apexcharts-series-collapsed) .apexcharts-marker"),r=a.config.markers.hover.size,E=0;E<v.length;E++){var k=v[E].getAttribute("rel"),P=v[E].getAttribute("index");if(r===void 0&&(r=a.globals.markers.size[P]+a.config.markers.hover.sizeOffset),_===parseInt(k,10)){c.newPointSize(_,v[E]);var L=v[E].getAttribute("cx"),O=v[E].getAttribute("cy");c.tooltipPosition.moveXCrosshairs(L),f.fixedTooltip||c.tooltipPosition.moveTooltip(L,O,r)}else c.oldPointSize(v[E])}}},{key:"newPointSize",value:function(t,a){var c=this.w,f=c.config.markers.hover.size,_=t===0?a.parentNode.firstChild:a.parentNode.lastChild;if(_.getAttribute("default-marker-size")!=="0"){var v=parseInt(_.getAttribute("index"),10);f===void 0&&(f=c.globals.markers.size[v]+c.config.markers.hover.sizeOffset),f<0&&(f=0);var r=this.ttCtx.tooltipUtil.getPathFromPoint(a,f);a.setAttribute("d",r)}}},{key:"oldPointSize",value:function(t){var a=parseFloat(t.getAttribute("default-marker-size")),c=this.ttCtx.tooltipUtil.getPathFromPoint(t,a);t.setAttribute("d",c)}},{key:"resetPointsSize",value:function(){for(var t=this.w.globals.dom.baseEl.querySelectorAll(".apexcharts-series:not(.apexcharts-series-collapsed) .apexcharts-marker"),a=0;a<t.length;a++){var c=parseFloat(t[a].getAttribute("default-marker-size"));if(et.isNumber(c)&&c>0){var f=this.ttCtx.tooltipUtil.getPathFromPoint(t[a],c);t[a].setAttribute("d",f)}else t[a].setAttribute("d","M0,0")}}}]),S}(),$E=function(){function S(t){pi(this,S),this.w=t.w;var a=this.w;this.ttCtx=t,this.isVerticalGroupedRangeBar=!a.globals.isBarHorizontal&&a.config.chart.type==="rangeBar"&&a.config.plotOptions.bar.rangeBarGroupRows}return gi(S,[{key:"getAttr",value:function(t,a){return parseFloat(t.target.getAttribute(a))}},{key:"handleHeatTreeTooltip",value:function(t){var a=t.e,c=t.opt,f=t.x,_=t.y,v=t.type,r=this.ttCtx,E=this.w;if(a.target.classList.contains("apexcharts-".concat(v,"-rect"))){var k=this.getAttr(a,"i"),P=this.getAttr(a,"j"),L=this.getAttr(a,"cx"),O=this.getAttr(a,"cy"),N=this.getAttr(a,"width"),G=this.getAttr(a,"height");if(r.tooltipLabels.drawSeriesTexts({ttItems:c.ttItems,i:k,j:P,shared:!1,e:a}),E.globals.capturedSeriesIndex=k,E.globals.capturedDataPointIndex=P,f=L+r.tooltipRect.ttWidth/2+N,_=O+r.tooltipRect.ttHeight/2-G/2,r.tooltipPosition.moveXCrosshairs(L+N/2),f>E.globals.gridWidth/2&&(f=L-r.tooltipRect.ttWidth/2+N),r.w.config.tooltip.followCursor){var H=E.globals.dom.elWrap.getBoundingClientRect();f=E.globals.clientX-H.left-(f>E.globals.gridWidth/2?r.tooltipRect.ttWidth:0),_=E.globals.clientY-H.top-(_>E.globals.gridHeight/2?r.tooltipRect.ttHeight:0)}}return{x:f,y:_}}},{key:"handleMarkerTooltip",value:function(t){var a,c,f=t.e,_=t.opt,v=t.x,r=t.y,E=this.w,k=this.ttCtx;if(f.target.classList.contains("apexcharts-marker")){var P=parseInt(_.paths.getAttribute("cx"),10),L=parseInt(_.paths.getAttribute("cy"),10),O=parseFloat(_.paths.getAttribute("val"));if(c=parseInt(_.paths.getAttribute("rel"),10),a=parseInt(_.paths.parentNode.parentNode.parentNode.getAttribute("rel"),10)-1,k.intersect){var N=et.findAncestor(_.paths,"apexcharts-series");N&&(a=parseInt(N.getAttribute("data:realIndex"),10))}if(k.tooltipLabels.drawSeriesTexts({ttItems:_.ttItems,i:a,j:c,shared:!k.showOnIntersect&&E.config.tooltip.shared,e:f}),f.type==="mouseup"&&k.markerClick(f,a,c),E.globals.capturedSeriesIndex=a,E.globals.capturedDataPointIndex=c,v=P,r=L+E.globals.translateY-1.4*k.tooltipRect.ttHeight,k.w.config.tooltip.followCursor){var G=k.getElGrid().getBoundingClientRect();r=k.e.clientY+E.globals.translateY-G.top}O<0&&(r=L),k.marker.enlargeCurrentPoint(c,_.paths,v,r)}return{x:v,y:r}}},{key:"handleBarTooltip",value:function(t){var a,c,f=t.e,_=t.opt,v=this.w,r=this.ttCtx,E=r.getElTooltip(),k=0,P=0,L=0,O=this.getBarTooltipXY({e:f,opt:_});if(O.j!==null||O.barHeight!==0||O.barWidth!==0){a=O.i;var N=O.j;if(v.globals.capturedSeriesIndex=a,v.globals.capturedDataPointIndex=N,v.globals.isBarHorizontal&&r.tooltipUtil.hasBars()||!v.config.tooltip.shared?(P=O.x,L=O.y,c=Array.isArray(v.config.stroke.width)?v.config.stroke.width[a]:v.config.stroke.width,k=P):v.globals.comboCharts||v.config.tooltip.shared||(k/=2),isNaN(L)&&(L=v.globals.svgHeight-r.tooltipRect.ttHeight),parseInt(_.paths.parentNode.getAttribute("data:realIndex"),10),P+r.tooltipRect.ttWidth>v.globals.gridWidth?P-=r.tooltipRect.ttWidth:P<0&&(P=0),r.w.config.tooltip.followCursor){var G=r.getElGrid().getBoundingClientRect();L=r.e.clientY-G.top}r.tooltip===null&&(r.tooltip=v.globals.dom.baseEl.querySelector(".apexcharts-tooltip")),v.config.tooltip.shared||(v.globals.comboBarCount>0?r.tooltipPosition.moveXCrosshairs(k+c/2):r.tooltipPosition.moveXCrosshairs(k)),!r.fixedTooltip&&(!v.config.tooltip.shared||v.globals.isBarHorizontal&&r.tooltipUtil.hasBars())&&(L=L+v.globals.translateY-r.tooltipRect.ttHeight/2,E.style.left=P+v.globals.translateX+"px",E.style.top=L+"px")}}},{key:"getBarTooltipXY",value:function(t){var a=this,c=t.e,f=t.opt,_=this.w,v=null,r=this.ttCtx,E=0,k=0,P=0,L=0,O=0,N=c.target.classList;if(N.contains("apexcharts-bar-area")||N.contains("apexcharts-candlestick-area")||N.contains("apexcharts-boxPlot-area")||N.contains("apexcharts-rangebar-area")){var G=c.target,H=G.getBoundingClientRect(),Q=f.elGrid.getBoundingClientRect(),ee=H.height;O=H.height;var ie=H.width,ue=parseInt(G.getAttribute("cx"),10),ve=parseInt(G.getAttribute("cy"),10);L=parseFloat(G.getAttribute("barWidth"));var ce=c.type==="touchmove"?c.touches[0].clientX:c.clientX;v=parseInt(G.getAttribute("j"),10),E=parseInt(G.parentNode.getAttribute("rel"),10)-1;var Te=G.getAttribute("data-range-y1"),Se=G.getAttribute("data-range-y2");_.globals.comboCharts&&(E=parseInt(G.parentNode.getAttribute("data:realIndex"),10));var Ie=function(Ke){return _.globals.isXNumeric?ue-ie/2:a.isVerticalGroupedRangeBar?ue+ie/2:ue-r.dataPointsDividedWidth+ie/2},Ue=function(){return ve-r.dataPointsDividedHeight+ee/2-r.tooltipRect.ttHeight/2};r.tooltipLabels.drawSeriesTexts({ttItems:f.ttItems,i:E,j:v,y1:Te?parseInt(Te,10):null,y2:Se?parseInt(Se,10):null,shared:!r.showOnIntersect&&_.config.tooltip.shared,e:c}),_.config.tooltip.followCursor?_.globals.isBarHorizontal?(k=ce-Q.left+15,P=Ue()):(k=Ie(),P=c.clientY-Q.top-r.tooltipRect.ttHeight/2-15):_.globals.isBarHorizontal?((k=ue)<r.xyRatios.baseLineInvertedY&&(k=ue-r.tooltipRect.ttWidth),P=Ue()):(k=Ie(),P=ve)}return{x:k,y:P,barHeight:O,barWidth:L,i:E,j:v}}}]),S}(),JE=function(){function S(t){pi(this,S),this.w=t.w,this.ttCtx=t}return gi(S,[{key:"drawXaxisTooltip",value:function(){var t=this.w,a=this.ttCtx,c=t.config.xaxis.position==="bottom";a.xaxisOffY=c?t.globals.gridHeight+1:-t.globals.xAxisHeight-t.config.xaxis.axisTicks.height+3;var f=c?"apexcharts-xaxistooltip apexcharts-xaxistooltip-bottom":"apexcharts-xaxistooltip apexcharts-xaxistooltip-top",_=t.globals.dom.elWrap;a.isXAxisTooltipEnabled&&t.globals.dom.baseEl.querySelector(".apexcharts-xaxistooltip")===null&&(a.xaxisTooltip=document.createElement("div"),a.xaxisTooltip.setAttribute("class",f+" apexcharts-theme-"+t.config.tooltip.theme),_.appendChild(a.xaxisTooltip),a.xaxisTooltipText=document.createElement("div"),a.xaxisTooltipText.classList.add("apexcharts-xaxistooltip-text"),a.xaxisTooltipText.style.fontFamily=t.config.xaxis.tooltip.style.fontFamily||t.config.chart.fontFamily,a.xaxisTooltipText.style.fontSize=t.config.xaxis.tooltip.style.fontSize,a.xaxisTooltip.appendChild(a.xaxisTooltipText))}},{key:"drawYaxisTooltip",value:function(){for(var t=this.w,a=this.ttCtx,c=0;c<t.config.yaxis.length;c++){var f=t.config.yaxis[c].opposite||t.config.yaxis[c].crosshairs.opposite;a.yaxisOffX=f?t.globals.gridWidth+1:1;var _="apexcharts-yaxistooltip apexcharts-yaxistooltip-".concat(c,f?" apexcharts-yaxistooltip-right":" apexcharts-yaxistooltip-left"),v=t.globals.dom.elWrap;t.globals.dom.baseEl.querySelector(".apexcharts-yaxistooltip apexcharts-yaxistooltip-".concat(c))===null&&(a.yaxisTooltip=document.createElement("div"),a.yaxisTooltip.setAttribute("class",_+" apexcharts-theme-"+t.config.tooltip.theme),v.appendChild(a.yaxisTooltip),c===0&&(a.yaxisTooltipText=[]),a.yaxisTooltipText[c]=document.createElement("div"),a.yaxisTooltipText[c].classList.add("apexcharts-yaxistooltip-text"),a.yaxisTooltip.appendChild(a.yaxisTooltipText[c]))}}},{key:"setXCrosshairWidth",value:function(){var t=this.w,a=this.ttCtx,c=a.getElXCrosshairs();if(a.xcrosshairsWidth=parseInt(t.config.xaxis.crosshairs.width,10),t.globals.comboCharts){var f=t.globals.dom.baseEl.querySelector(".apexcharts-bar-area");if(f!==null&&t.config.xaxis.crosshairs.width==="barWidth"){var _=parseFloat(f.getAttribute("barWidth"));a.xcrosshairsWidth=_}else if(t.config.xaxis.crosshairs.width==="tickWidth"){var v=t.globals.labels.length;a.xcrosshairsWidth=t.globals.gridWidth/v}}else if(t.config.xaxis.crosshairs.width==="tickWidth"){var r=t.globals.labels.length;a.xcrosshairsWidth=t.globals.gridWidth/r}else if(t.config.xaxis.crosshairs.width==="barWidth"){var E=t.globals.dom.baseEl.querySelector(".apexcharts-bar-area");if(E!==null){var k=parseFloat(E.getAttribute("barWidth"));a.xcrosshairsWidth=k}else a.xcrosshairsWidth=1}t.globals.isBarHorizontal&&(a.xcrosshairsWidth=0),c!==null&&a.xcrosshairsWidth>0&&c.setAttribute("width",a.xcrosshairsWidth)}},{key:"handleYCrosshair",value:function(){var t=this.w,a=this.ttCtx;a.ycrosshairs=t.globals.dom.baseEl.querySelector(".apexcharts-ycrosshairs"),a.ycrosshairsHidden=t.globals.dom.baseEl.querySelector(".apexcharts-ycrosshairs-hidden")}},{key:"drawYaxisTooltipText",value:function(t,a,c){var f=this.ttCtx,_=this.w,v=_.globals,r=v.seriesYAxisMap[t];if(f.yaxisTooltips[t]&&r.length>0){var E=v.yLabelFormatters[t],k=f.getElGrid().getBoundingClientRect(),P=r[0],L=0;c.yRatio.length>1&&(L=P);var O=(a-k.top)*c.yRatio[L],N=v.maxYArr[P]-v.minYArr[P],G=v.minYArr[P]+(N-O);_.config.yaxis[t].reversed&&(G=v.maxYArr[P]-(N-O)),f.tooltipPosition.moveYCrosshairs(a-k.top),f.yaxisTooltipText[t].innerHTML=E(G),f.tooltipPosition.moveYAxisTooltip(t)}}}]),S}(),Ew=function(){function S(t){pi(this,S),this.ctx=t,this.w=t.w;var a=this.w;this.tConfig=a.config.tooltip,this.tooltipUtil=new P1(this),this.tooltipLabels=new qE(this),this.tooltipPosition=new L1(this),this.marker=new ZE(this),this.intersect=new $E(this),this.axesTooltip=new JE(this),this.showOnIntersect=this.tConfig.intersect,this.showTooltipTitle=this.tConfig.x.show,this.fixedTooltip=this.tConfig.fixed.enabled,this.xaxisTooltip=null,this.yaxisTTEls=null,this.isBarShared=!a.globals.isBarHorizontal&&this.tConfig.shared,this.lastHoverTime=Date.now()}return gi(S,[{key:"getElTooltip",value:function(t){return t||(t=this),t.w.globals.dom.baseEl?t.w.globals.dom.baseEl.querySelector(".apexcharts-tooltip"):null}},{key:"getElXCrosshairs",value:function(){return this.w.globals.dom.baseEl.querySelector(".apexcharts-xcrosshairs")}},{key:"getElGrid",value:function(){return this.w.globals.dom.baseEl.querySelector(".apexcharts-grid")}},{key:"drawTooltip",value:function(t){var a=this.w;this.xyRatios=t,this.isXAxisTooltipEnabled=a.config.xaxis.tooltip.enabled&&a.globals.axisCharts,this.yaxisTooltips=a.config.yaxis.map(function(v,r){return!!(v.show&&v.tooltip.enabled&&a.globals.axisCharts)}),this.allTooltipSeriesGroups=[],a.globals.axisCharts||(this.showTooltipTitle=!1);var c=document.createElement("div");if(c.classList.add("apexcharts-tooltip"),a.config.tooltip.cssClass&&c.classList.add(a.config.tooltip.cssClass),c.classList.add("apexcharts-theme-".concat(this.tConfig.theme||"light")),a.globals.dom.elWrap.appendChild(c),a.globals.axisCharts){this.axesTooltip.drawXaxisTooltip(),this.axesTooltip.drawYaxisTooltip(),this.axesTooltip.setXCrosshairWidth(),this.axesTooltip.handleYCrosshair();var f=new Zf(this.ctx);this.xAxisTicksPositions=f.getXAxisTicksPositions()}if(!a.globals.comboCharts&&!this.tConfig.intersect&&a.config.chart.type!=="rangeBar"||this.tConfig.shared||(this.showOnIntersect=!0),a.config.markers.size!==0&&a.globals.markers.largestSize!==0||this.marker.drawDynamicPoints(this),a.globals.collapsedSeries.length!==a.globals.series.length){this.dataPointsDividedHeight=a.globals.gridHeight/a.globals.dataPoints,this.dataPointsDividedWidth=a.globals.gridWidth/a.globals.dataPoints,this.showTooltipTitle&&(this.tooltipTitle=document.createElement("div"),this.tooltipTitle.classList.add("apexcharts-tooltip-title"),this.tooltipTitle.style.fontFamily=this.tConfig.style.fontFamily||a.config.chart.fontFamily,this.tooltipTitle.style.fontSize=this.tConfig.style.fontSize,c.appendChild(this.tooltipTitle));var _=a.globals.series.length;(a.globals.xyCharts||a.globals.comboCharts)&&this.tConfig.shared&&(_=this.showOnIntersect?1:a.globals.series.length),this.legendLabels=a.globals.dom.baseEl.querySelectorAll(".apexcharts-legend-text"),this.ttItems=this.createTTElements(_),this.addSVGEvents()}}},{key:"createTTElements",value:function(t){for(var a=this,c=this.w,f=[],_=this.getElTooltip(),v=function(E){var k=document.createElement("div");k.classList.add("apexcharts-tooltip-series-group","apexcharts-tooltip-series-group-".concat(E)),k.style.order=c.config.tooltip.inverseOrder?t-E:E+1;var P=document.createElement("span");P.classList.add("apexcharts-tooltip-marker"),c.config.tooltip.fillSeriesColor?P.style.backgroundColor=c.globals.colors[E]:P.style.color=c.globals.colors[E];var L=c.config.markers.shape,O=L;Array.isArray(L)&&(O=L[E]),P.setAttribute("shape",O),k.appendChild(P);var N=document.createElement("div");N.classList.add("apexcharts-tooltip-text"),N.style.fontFamily=a.tConfig.style.fontFamily||c.config.chart.fontFamily,N.style.fontSize=a.tConfig.style.fontSize,["y","goals","z"].forEach(function(G){var H=document.createElement("div");H.classList.add("apexcharts-tooltip-".concat(G,"-group"));var Q=document.createElement("span");Q.classList.add("apexcharts-tooltip-text-".concat(G,"-label")),H.appendChild(Q);var ee=document.createElement("span");ee.classList.add("apexcharts-tooltip-text-".concat(G,"-value")),H.appendChild(ee),N.appendChild(H)}),k.appendChild(N),_.appendChild(k),f.push(k)},r=0;r<t;r++)v(r);return f}},{key:"addSVGEvents",value:function(){var t=this.w,a=t.config.chart.type,c=this.getElTooltip(),f=!(a!=="bar"&&a!=="candlestick"&&a!=="boxPlot"&&a!=="rangeBar"),_=a==="area"||a==="line"||a==="scatter"||a==="bubble"||a==="radar",v=t.globals.dom.Paper.node,r=this.getElGrid();r&&(this.seriesBound=r.getBoundingClientRect());var E,k=[],P=[],L={hoverArea:v,elGrid:r,tooltipEl:c,tooltipY:k,tooltipX:P,ttItems:this.ttItems};if(t.globals.axisCharts&&(_?E=t.globals.dom.baseEl.querySelectorAll(".apexcharts-series[data\\:longestSeries='true'] .apexcharts-marker"):f?E=t.globals.dom.baseEl.querySelectorAll(".apexcharts-series .apexcharts-bar-area, .apexcharts-series .apexcharts-candlestick-area, .apexcharts-series .apexcharts-boxPlot-area, .apexcharts-series .apexcharts-rangebar-area"):a!=="heatmap"&&a!=="treemap"||(E=t.globals.dom.baseEl.querySelectorAll(".apexcharts-series .apexcharts-heatmap, .apexcharts-series .apexcharts-treemap")),E&&E.length))for(var O=0;O<E.length;O++)k.push(E[O].getAttribute("cy")),P.push(E[O].getAttribute("cx"));if(t.globals.xyCharts&&!this.showOnIntersect||t.globals.comboCharts&&!this.showOnIntersect||f&&this.tooltipUtil.hasBars()&&this.tConfig.shared)this.addPathsEventListeners([v],L);else if(f&&!t.globals.comboCharts||_&&this.showOnIntersect)this.addDatapointEventsListeners(L);else if(!t.globals.axisCharts||a==="heatmap"||a==="treemap"){var N=t.globals.dom.baseEl.querySelectorAll(".apexcharts-series");this.addPathsEventListeners(N,L)}if(this.showOnIntersect){var G=t.globals.dom.baseEl.querySelectorAll(".apexcharts-line-series .apexcharts-marker, .apexcharts-area-series .apexcharts-marker");G.length>0&&this.addPathsEventListeners(G,L),this.tooltipUtil.hasBars()&&!this.tConfig.shared&&this.addDatapointEventsListeners(L)}}},{key:"drawFixedTooltipRect",value:function(){var t=this.w,a=this.getElTooltip(),c=a.getBoundingClientRect(),f=c.width+10,_=c.height+10,v=this.tConfig.fixed.offsetX,r=this.tConfig.fixed.offsetY,E=this.tConfig.fixed.position.toLowerCase();return E.indexOf("right")>-1&&(v=v+t.globals.svgWidth-f+10),E.indexOf("bottom")>-1&&(r=r+t.globals.svgHeight-_-10),a.style.left=v+"px",a.style.top=r+"px",{x:v,y:r,ttWidth:f,ttHeight:_}}},{key:"addDatapointEventsListeners",value:function(t){var a=this.w.globals.dom.baseEl.querySelectorAll(".apexcharts-series-markers .apexcharts-marker, .apexcharts-bar-area, .apexcharts-candlestick-area, .apexcharts-boxPlot-area, .apexcharts-rangebar-area");this.addPathsEventListeners(a,t)}},{key:"addPathsEventListeners",value:function(t,a){for(var c=this,f=function(v){var r={paths:t[v],tooltipEl:a.tooltipEl,tooltipY:a.tooltipY,tooltipX:a.tooltipX,elGrid:a.elGrid,hoverArea:a.hoverArea,ttItems:a.ttItems};["mousemove","mouseup","touchmove","mouseout","touchend"].map(function(E){return t[v].addEventListener(E,c.onSeriesHover.bind(c,r),{capture:!1,passive:!0})})},_=0;_<t.length;_++)f(_)}},{key:"onSeriesHover",value:function(t,a){var c=this,f=Date.now()-this.lastHoverTime;f>=20?this.seriesHover(t,a):(clearTimeout(this.seriesHoverTimeout),this.seriesHoverTimeout=setTimeout(function(){c.seriesHover(t,a)},20-f))}},{key:"seriesHover",value:function(t,a){var c=this;this.lastHoverTime=Date.now();var f=[],_=this.w;_.config.chart.group&&(f=this.ctx.getGroupedCharts()),_.globals.axisCharts&&(_.globals.minX===-1/0&&_.globals.maxX===1/0||_.globals.dataPoints===0)||(f.length?f.forEach(function(v){var r=c.getElTooltip(v),E={paths:t.paths,tooltipEl:r,tooltipY:t.tooltipY,tooltipX:t.tooltipX,elGrid:t.elGrid,hoverArea:t.hoverArea,ttItems:v.w.globals.tooltip.ttItems};v.w.globals.minX===c.w.globals.minX&&v.w.globals.maxX===c.w.globals.maxX&&v.w.globals.tooltip.seriesHoverByContext({chartCtx:v,ttCtx:v.w.globals.tooltip,opt:E,e:a})}):this.seriesHoverByContext({chartCtx:this.ctx,ttCtx:this.w.globals.tooltip,opt:t,e:a}))}},{key:"seriesHoverByContext",value:function(t){var a=t.chartCtx,c=t.ttCtx,f=t.opt,_=t.e,v=a.w,r=this.getElTooltip(a);r&&(c.tooltipRect={x:0,y:0,ttWidth:r.getBoundingClientRect().width,ttHeight:r.getBoundingClientRect().height},c.e=_,c.tooltipUtil.hasBars()&&!v.globals.comboCharts&&!c.isBarShared&&this.tConfig.onDatasetHover.highlightDataSeries&&new fa(a).toggleSeriesOnHover(_,_.target.parentNode),v.globals.axisCharts?c.axisChartsTooltips({e:_,opt:f,tooltipRect:c.tooltipRect}):c.nonAxisChartsTooltips({e:_,opt:f,tooltipRect:c.tooltipRect}),c.fixedTooltip&&c.drawFixedTooltipRect())}},{key:"axisChartsTooltips",value:function(t){var a,c,f=t.e,_=t.opt,v=this.w,r=_.elGrid.getBoundingClientRect(),E=f.type==="touchmove"?f.touches[0].clientX:f.clientX,k=f.type==="touchmove"?f.touches[0].clientY:f.clientY;if(this.clientY=k,this.clientX=E,v.globals.capturedSeriesIndex=-1,v.globals.capturedDataPointIndex=-1,k<r.top||k>r.top+r.height)this.handleMouseOut(_);else{if(Array.isArray(this.tConfig.enabledOnSeries)&&!v.config.tooltip.shared){var P=parseInt(_.paths.getAttribute("index"),10);if(this.tConfig.enabledOnSeries.indexOf(P)<0)return void this.handleMouseOut(_)}var L=this.getElTooltip(),O=this.getElXCrosshairs(),N=[];v.config.chart.group&&(N=this.ctx.getSyncedCharts());var G=v.globals.xyCharts||v.config.chart.type==="bar"&&!v.globals.isBarHorizontal&&this.tooltipUtil.hasBars()&&this.tConfig.shared||v.globals.comboCharts&&this.tooltipUtil.hasBars();if(f.type==="mousemove"||f.type==="touchmove"||f.type==="mouseup"){if(v.globals.collapsedSeries.length+v.globals.ancillaryCollapsedSeries.length===v.globals.series.length)return;O!==null&&O.classList.add("apexcharts-active");var H=this.yaxisTooltips.filter(function(ie){return ie===!0});if(this.ycrosshairs!==null&&H.length&&this.ycrosshairs.classList.add("apexcharts-active"),G&&!this.showOnIntersect||N.length>1)this.handleStickyTooltip(f,E,k,_);else if(v.config.chart.type==="heatmap"||v.config.chart.type==="treemap"){var Q=this.intersect.handleHeatTreeTooltip({e:f,opt:_,x:a,y:c,type:v.config.chart.type});a=Q.x,c=Q.y,L.style.left=a+"px",L.style.top=c+"px"}else this.tooltipUtil.hasBars()&&this.intersect.handleBarTooltip({e:f,opt:_}),this.tooltipUtil.hasMarkers()&&this.intersect.handleMarkerTooltip({e:f,opt:_,x:a,y:c});if(this.yaxisTooltips.length)for(var ee=0;ee<v.config.yaxis.length;ee++)this.axesTooltip.drawYaxisTooltipText(ee,k,this.xyRatios);v.globals.dom.baseEl.classList.add("apexcharts-tooltip-active"),_.tooltipEl.classList.add("apexcharts-active")}else f.type!=="mouseout"&&f.type!=="touchend"||this.handleMouseOut(_)}}},{key:"nonAxisChartsTooltips",value:function(t){var a=t.e,c=t.opt,f=t.tooltipRect,_=this.w,v=c.paths.getAttribute("rel"),r=this.getElTooltip(),E=_.globals.dom.elWrap.getBoundingClientRect();if(a.type==="mousemove"||a.type==="touchmove"){_.globals.dom.baseEl.classList.add("apexcharts-tooltip-active"),r.classList.add("apexcharts-active"),this.tooltipLabels.drawSeriesTexts({ttItems:c.ttItems,i:parseInt(v,10)-1,shared:!1});var k=_.globals.clientX-E.left-f.ttWidth/2,P=_.globals.clientY-E.top-f.ttHeight-10;if(r.style.left=k+"px",r.style.top=P+"px",_.config.legend.tooltipHoverFormatter){var L=v-1,O=(0,_.config.legend.tooltipHoverFormatter)(this.legendLabels[L].getAttribute("data:default-text"),{seriesIndex:L,dataPointIndex:L,w:_});this.legendLabels[L].innerHTML=O}}else a.type!=="mouseout"&&a.type!=="touchend"||(r.classList.remove("apexcharts-active"),_.globals.dom.baseEl.classList.remove("apexcharts-tooltip-active"),_.config.legend.tooltipHoverFormatter&&this.legendLabels.forEach(function(N){var G=N.getAttribute("data:default-text");N.innerHTML=decodeURIComponent(G)}))}},{key:"handleStickyTooltip",value:function(t,a,c,f){var _=this.w,v=this.tooltipUtil.getNearestValues({context:this,hoverArea:f.hoverArea,elGrid:f.elGrid,clientX:a,clientY:c}),r=v.j,E=v.capturedSeries;_.globals.collapsedSeriesIndices.includes(E)&&(E=null);var k=f.elGrid.getBoundingClientRect();if(v.hoverX<0||v.hoverX>k.width)this.handleMouseOut(f);else if(E!==null)this.handleStickyCapturedSeries(t,E,f,r);else if(this.tooltipUtil.isXoverlap(r)||_.globals.isBarHorizontal){var P=_.globals.series.findIndex(function(L,O){return!_.globals.collapsedSeriesIndices.includes(O)});this.create(t,this,P,r,f.ttItems)}}},{key:"handleStickyCapturedSeries",value:function(t,a,c,f){var _=this.w;if(!this.tConfig.shared&&_.globals.series[a][f]===null)return void this.handleMouseOut(c);if(_.globals.series[a][f]!==void 0)this.tConfig.shared&&this.tooltipUtil.isXoverlap(f)&&this.tooltipUtil.isInitialSeriesSameLen()?this.create(t,this,a,f,c.ttItems):this.create(t,this,a,f,c.ttItems,!1);else if(this.tooltipUtil.isXoverlap(f)){var v=_.globals.series.findIndex(function(r,E){return!_.globals.collapsedSeriesIndices.includes(E)});this.create(t,this,v,f,c.ttItems)}}},{key:"deactivateHoverFilter",value:function(){for(var t=this.w,a=new Nt(this.ctx),c=t.globals.dom.Paper.find(".apexcharts-bar-area"),f=0;f<c.length;f++)a.pathMouseLeave(c[f])}},{key:"handleMouseOut",value:function(t){var a=this.w,c=this.getElXCrosshairs();if(a.globals.dom.baseEl.classList.remove("apexcharts-tooltip-active"),t.tooltipEl.classList.remove("apexcharts-active"),this.deactivateHoverFilter(),a.config.chart.type!=="bubble"&&this.marker.resetPointsSize(),c!==null&&c.classList.remove("apexcharts-active"),this.ycrosshairs!==null&&this.ycrosshairs.classList.remove("apexcharts-active"),this.isXAxisTooltipEnabled&&this.xaxisTooltip.classList.remove("apexcharts-active"),this.yaxisTooltips.length){this.yaxisTTEls===null&&(this.yaxisTTEls=a.globals.dom.baseEl.querySelectorAll(".apexcharts-yaxistooltip"));for(var f=0;f<this.yaxisTTEls.length;f++)this.yaxisTTEls[f].classList.remove("apexcharts-active")}a.config.legend.tooltipHoverFormatter&&this.legendLabels.forEach(function(_){var v=_.getAttribute("data:default-text");_.innerHTML=decodeURIComponent(v)})}},{key:"markerClick",value:function(t,a,c){var f=this.w;typeof f.config.chart.events.markerClick=="function"&&f.config.chart.events.markerClick(t,this.ctx,{seriesIndex:a,dataPointIndex:c,w:f}),this.ctx.events.fireEvent("markerClick",[t,this.ctx,{seriesIndex:a,dataPointIndex:c,w:f}])}},{key:"create",value:function(t,a,c,f,_){var v,r,E,k,P,L,O,N,G,H,Q,ee,ie,ue,ve,ce,Te=arguments.length>5&&arguments[5]!==void 0?arguments[5]:null,Se=this.w,Ie=a;t.type==="mouseup"&&this.markerClick(t,c,f),Te===null&&(Te=this.tConfig.shared);var Ue=this.tooltipUtil.hasMarkers(c),Ke=this.tooltipUtil.getElBars(),qe=function(){Se.globals.markers.largestSize>0?Ie.marker.enlargePoints(f):Ie.tooltipPosition.moveDynamicPointsOnHover(f)};if(Se.config.legend.tooltipHoverFormatter){var ft=Se.config.legend.tooltipHoverFormatter,bt=Array.from(this.legendLabels);bt.forEach(function(Br){var ar=Br.getAttribute("data:default-text");Br.innerHTML=decodeURIComponent(ar)});for(var Tt=0;Tt<bt.length;Tt++){var Et=bt[Tt],Lt=parseInt(Et.getAttribute("i"),10),qt=decodeURIComponent(Et.getAttribute("data:default-text")),ui=ft(qt,{seriesIndex:Te?Lt:c,dataPointIndex:f,w:Se});if(Te)Et.innerHTML=Se.globals.collapsedSeriesIndices.indexOf(Lt)<0?ui:qt;else if(Et.innerHTML=Lt===c?ui:qt,c===Lt)break}}var Ti=Jt(Jt({ttItems:_,i:c,j:f},((v=Se.globals.seriesRange)===null||v===void 0||(r=v[c])===null||r===void 0||(E=r[f])===null||E===void 0||(k=E.y[0])===null||k===void 0?void 0:k.y1)!==void 0&&{y1:(P=Se.globals.seriesRange)===null||P===void 0||(L=P[c])===null||L===void 0||(O=L[f])===null||O===void 0||(N=O.y[0])===null||N===void 0?void 0:N.y1}),((G=Se.globals.seriesRange)===null||G===void 0||(H=G[c])===null||H===void 0||(Q=H[f])===null||Q===void 0||(ee=Q.y[0])===null||ee===void 0?void 0:ee.y2)!==void 0&&{y2:(ie=Se.globals.seriesRange)===null||ie===void 0||(ue=ie[c])===null||ue===void 0||(ve=ue[f])===null||ve===void 0||(ce=ve.y[0])===null||ce===void 0?void 0:ce.y2});if(Te){if(Ie.tooltipLabels.drawSeriesTexts(Jt(Jt({},Ti),{},{shared:!this.showOnIntersect&&this.tConfig.shared})),Ue)qe();else if(this.tooltipUtil.hasBars()&&(this.barSeriesHeight=this.tooltipUtil.getBarsHeight(Ke),this.barSeriesHeight>0)){var vi=new Nt(this.ctx),Kt=Se.globals.dom.Paper.find(".apexcharts-bar-area[j='".concat(f,"']"));this.deactivateHoverFilter(),Ie.tooltipUtil.getAllMarkers(!0).length&&!this.barSeriesHeight&&qe(),Ie.tooltipPosition.moveStickyTooltipOverBars(f,c);for(var Hi=0;Hi<Kt.length;Hi++)vi.pathMouseEnter(Kt[Hi])}}else Ie.tooltipLabels.drawSeriesTexts(Jt({shared:!1},Ti)),this.tooltipUtil.hasBars()&&Ie.tooltipPosition.moveStickyTooltipOverBars(f,c),Ue&&Ie.tooltipPosition.moveMarkers(c,f)}}]),S}(),KE=function(){function S(t){pi(this,S),this.w=t.w,this.barCtx=t,this.totalFormatter=this.w.config.plotOptions.bar.dataLabels.total.formatter,this.totalFormatter||(this.totalFormatter=this.w.config.dataLabels.formatter)}return gi(S,[{key:"handleBarDataLabels",value:function(t){var a,c,f=t.x,_=t.y,v=t.y1,r=t.y2,E=t.i,k=t.j,P=t.realIndex,L=t.columnGroupIndex,O=t.series,N=t.barHeight,G=t.barWidth,H=t.barXPosition,Q=t.barYPosition,ee=t.visibleSeries,ie=this.w,ue=new Nt(this.barCtx.ctx),ve=Array.isArray(this.barCtx.strokeWidth)?this.barCtx.strokeWidth[P]:this.barCtx.strokeWidth;ie.globals.isXNumeric&&!ie.globals.isBarHorizontal?(a=f+parseFloat(G*(ee+1)),c=_+parseFloat(N*(ee+1))-ve):(a=f+parseFloat(G*ee),c=_+parseFloat(N*ee));var ce,Te=null,Se=f,Ie=_,Ue={},Ke=ie.config.dataLabels,qe=this.barCtx.barOptions.dataLabels,ft=this.barCtx.barOptions.dataLabels.total;Q!==void 0&&this.barCtx.isRangeBar&&(c=Q,Ie=Q),H!==void 0&&this.barCtx.isVerticalGroupedRangeBar&&(a=H,Se=H);var bt=Ke.offsetX,Tt=Ke.offsetY,Et={width:0,height:0};if(ie.config.dataLabels.enabled){var Lt=ie.globals.series[E][k];Et=ue.getTextRects(ie.config.dataLabels.formatter?ie.config.dataLabels.formatter(Lt,Jt(Jt({},ie),{},{seriesIndex:E,dataPointIndex:k,w:ie})):ie.globals.yLabelFormatters[0](Lt),parseFloat(Ke.style.fontSize))}var qt={x:f,y:_,i:E,j:k,realIndex:P,columnGroupIndex:L,bcx:a,bcy:c,barHeight:N,barWidth:G,textRects:Et,strokeWidth:ve,dataLabelsX:Se,dataLabelsY:Ie,dataLabelsConfig:Ke,barDataLabelsConfig:qe,barTotalDataLabelsConfig:ft,offX:bt,offY:Tt};return Ue=this.barCtx.isHorizontal?this.calculateBarsDataLabelsPosition(qt):this.calculateColumnsDataLabelsPosition(qt),ce=this.drawCalculatedDataLabels({x:Ue.dataLabelsX,y:Ue.dataLabelsY,val:this.barCtx.isRangeBar?[v,r]:ie.config.chart.stackType==="100%"?O[P][k]:ie.globals.series[P][k],i:P,j:k,barWidth:G,barHeight:N,textRects:Et,dataLabelsConfig:Ke}),ie.config.chart.stacked&&ft.enabled&&(Te=this.drawTotalDataLabels({x:Ue.totalDataLabelsX,y:Ue.totalDataLabelsY,barWidth:G,barHeight:N,realIndex:P,textAnchor:Ue.totalDataLabelsAnchor,val:this.getStackedTotalDataLabel({realIndex:P,j:k}),dataLabelsConfig:Ke,barTotalDataLabelsConfig:ft})),{dataLabelsPos:Ue,dataLabels:ce,totalDataLabels:Te}}},{key:"getStackedTotalDataLabel",value:function(t){var a=t.realIndex,c=t.j,f=this.w,_=this.barCtx.stackedSeriesTotals[c];return this.totalFormatter&&(_=this.totalFormatter(_,Jt(Jt({},f),{},{seriesIndex:a,dataPointIndex:c,w:f}))),_}},{key:"calculateColumnsDataLabelsPosition",value:function(t){var a=this,c=this.w,f=t.i,_=t.j,v=t.realIndex;t.columnGroupIndex;var r,E,k=t.y,P=t.bcx,L=t.barWidth,O=t.barHeight,N=t.textRects,G=t.dataLabelsX,H=t.dataLabelsY,Q=t.dataLabelsConfig,ee=t.barDataLabelsConfig,ie=t.barTotalDataLabelsConfig,ue=t.strokeWidth,ve=t.offX,ce=t.offY,Te=P;O=Math.abs(O);var Se=c.config.plotOptions.bar.dataLabels.orientation==="vertical",Ie=this.barCtx.barHelpers.getZeroValueEncounters({i:f,j:_}).zeroEncounters;P-=ue/2;var Ue=c.globals.gridWidth/c.globals.dataPoints;this.barCtx.isVerticalGroupedRangeBar?G+=L/2:(G=c.globals.isXNumeric?P-L/2+ve:P-Ue+L/2+ve,!c.config.chart.stacked&&Ie>0&&c.config.plotOptions.bar.hideZeroBarsWhenGrouped&&(G-=L*Ie)),Se&&(G=G+N.height/2-ue/2-2);var Ke=c.globals.series[f][_]<0,qe=k;switch(this.barCtx.isReversed&&(qe=k+(Ke?O:-O)),ee.position){case"center":H=Se?Ke?qe-O/2+ce:qe+O/2-ce:Ke?qe-O/2+N.height/2+ce:qe+O/2+N.height/2-ce;break;case"bottom":H=Se?Ke?qe-O+ce:qe+O-ce:Ke?qe-O+N.height+ue+ce:qe+O-N.height/2+ue-ce;break;case"top":H=Se?Ke?qe+ce:qe-ce:Ke?qe-N.height/2-ce:qe+N.height+ce}var ft=qe;if(c.globals.seriesGroups.forEach(function(Et){var Lt;(Lt=a.barCtx[Et.join(",")])===null||Lt===void 0||Lt.prevY.forEach(function(qt){ft=Ke?Math.max(qt[_],ft):Math.min(qt[_],ft)})}),this.barCtx.lastActiveBarSerieIndex===v&&ie.enabled){var bt=new Nt(this.barCtx.ctx).getTextRects(this.getStackedTotalDataLabel({realIndex:v,j:_}),Q.fontSize);r=Ke?ft-bt.height/2-ce-ie.offsetY+18:ft+bt.height+ce+ie.offsetY-18;var Tt=Ue;E=Te+(c.globals.isXNumeric?-L*c.globals.barGroups.length/2:c.globals.barGroups.length*L/2-(c.globals.barGroups.length-1)*L-Tt)+ie.offsetX}return c.config.chart.stacked||(H<0?H=0+ue:H+N.height/3>c.globals.gridHeight&&(H=c.globals.gridHeight-ue)),{bcx:P,bcy:k,dataLabelsX:G,dataLabelsY:H,totalDataLabelsX:E,totalDataLabelsY:r,totalDataLabelsAnchor:"middle"}}},{key:"calculateBarsDataLabelsPosition",value:function(t){var a=this,c=this.w,f=t.x,_=t.i,v=t.j,r=t.realIndex,E=t.bcy,k=t.barHeight,P=t.barWidth,L=t.textRects,O=t.dataLabelsX,N=t.strokeWidth,G=t.dataLabelsConfig,H=t.barDataLabelsConfig,Q=t.barTotalDataLabelsConfig,ee=t.offX,ie=t.offY,ue=c.globals.gridHeight/c.globals.dataPoints,ve=this.barCtx.barHelpers.getZeroValueEncounters({i:_,j:v}).zeroEncounters;P=Math.abs(P);var ce,Te,Se=E-(this.barCtx.isRangeBar?0:ue)+k/2+L.height/2+ie-3;!c.config.chart.stacked&&ve>0&&c.config.plotOptions.bar.hideZeroBarsWhenGrouped&&(Se-=k*ve);var Ie="start",Ue=c.globals.series[_][v]<0,Ke=f;switch(this.barCtx.isReversed&&(Ke=f+(Ue?-P:P),Ie=Ue?"start":"end"),H.position){case"center":O=Ue?Ke+P/2-ee:Math.max(L.width/2,Ke-P/2)+ee;break;case"bottom":O=Ue?Ke+P-N-ee:Ke-P+N+ee;break;case"top":O=Ue?Ke-N-ee:Ke-N+ee}var qe=Ke;if(c.globals.seriesGroups.forEach(function(bt){var Tt;(Tt=a.barCtx[bt.join(",")])===null||Tt===void 0||Tt.prevX.forEach(function(Et){qe=Ue?Math.min(Et[v],qe):Math.max(Et[v],qe)})}),this.barCtx.lastActiveBarSerieIndex===r&&Q.enabled){var ft=new Nt(this.barCtx.ctx).getTextRects(this.getStackedTotalDataLabel({realIndex:r,j:v}),G.fontSize);Ue?(ce=qe-N-ee-Q.offsetX,Ie="end"):ce=qe+ee+Q.offsetX+(this.barCtx.isReversed?-(P+N):N),Te=Se-L.height/2+ft.height/2+Q.offsetY+N,c.globals.barGroups.length>1&&(Te-=c.globals.barGroups.length/2*(k/2))}return c.config.chart.stacked||(G.textAnchor==="start"?O-L.width<0?O=Ue?L.width+N:N:O+L.width>c.globals.gridWidth&&(O=Ue?c.globals.gridWidth-N:c.globals.gridWidth-L.width-N):G.textAnchor==="middle"?O-L.width/2<0?O=L.width/2+N:O+L.width/2>c.globals.gridWidth&&(O=c.globals.gridWidth-L.width/2-N):G.textAnchor==="end"&&(O<1?O=L.width+N:O+1>c.globals.gridWidth&&(O=c.globals.gridWidth-L.width-N))),{bcx:f,bcy:E,dataLabelsX:O,dataLabelsY:Se,totalDataLabelsX:ce,totalDataLabelsY:Te,totalDataLabelsAnchor:Ie}}},{key:"drawCalculatedDataLabels",value:function(t){var a=t.x,c=t.y,f=t.val,_=t.i,v=t.j,r=t.textRects,E=t.barHeight,k=t.barWidth,P=t.dataLabelsConfig,L=this.w,O="rotate(0)";L.config.plotOptions.bar.dataLabels.orientation==="vertical"&&(O="rotate(-90, ".concat(a,", ").concat(c,")"));var N=new Fu(this.barCtx.ctx),G=new Nt(this.barCtx.ctx),H=P.formatter,Q=null,ee=L.globals.collapsedSeriesIndices.indexOf(_)>-1;if(P.enabled&&!ee){Q=G.group({class:"apexcharts-data-labels",transform:O});var ie="";f!==void 0&&(ie=H(f,Jt(Jt({},L),{},{seriesIndex:_,dataPointIndex:v,w:L}))),!f&&L.config.plotOptions.bar.hideZeroBarsWhenGrouped&&(ie="");var ue=L.globals.series[_][v]<0,ve=L.config.plotOptions.bar.dataLabels.position;L.config.plotOptions.bar.dataLabels.orientation==="vertical"&&(ve==="top"&&(P.textAnchor=ue?"end":"start"),ve==="center"&&(P.textAnchor="middle"),ve==="bottom"&&(P.textAnchor=ue?"end":"start")),this.barCtx.isRangeBar&&this.barCtx.barOptions.dataLabels.hideOverflowingLabels&&k<G.getTextRects(ie,parseFloat(P.style.fontSize)).width&&(ie=""),L.config.chart.stacked&&this.barCtx.barOptions.dataLabels.hideOverflowingLabels&&(this.barCtx.isHorizontal?r.width/1.6>Math.abs(k)&&(ie=""):r.height/1.6>Math.abs(E)&&(ie=""));var ce=Jt({},P);this.barCtx.isHorizontal&&f<0&&(P.textAnchor==="start"?ce.textAnchor="end":P.textAnchor==="end"&&(ce.textAnchor="start")),N.plotDataLabelsText({x:a,y:c,text:ie,i:_,j:v,parent:Q,dataLabelsConfig:ce,alwaysDrawDataLabel:!0,offsetCorrection:!0})}return Q}},{key:"drawTotalDataLabels",value:function(t){var a=t.x,c=t.y,f=t.val,_=t.realIndex,v=t.textAnchor,r=t.barTotalDataLabelsConfig;this.w;var E,k=new Nt(this.barCtx.ctx);return r.enabled&&a!==void 0&&c!==void 0&&this.barCtx.lastActiveBarSerieIndex===_&&(E=k.drawText({x:a,y:c,foreColor:r.style.color,text:f,textAnchor:v,fontFamily:r.style.fontFamily,fontSize:r.style.fontSize,fontWeight:r.style.fontWeight})),E}}]),S}(),QE=function(){function S(t){pi(this,S),this.w=t.w,this.barCtx=t}return gi(S,[{key:"initVariables",value:function(t){var a=this.w;this.barCtx.series=t,this.barCtx.totalItems=0,this.barCtx.seriesLen=0,this.barCtx.visibleI=-1,this.barCtx.visibleItems=1;for(var c=0;c<t.length;c++)if(t[c].length>0&&(this.barCtx.seriesLen=this.barCtx.seriesLen+1,this.barCtx.totalItems+=t[c].length),a.globals.isXNumeric)for(var f=0;f<t[c].length;f++)a.globals.seriesX[c][f]>a.globals.minX&&a.globals.seriesX[c][f]<a.globals.maxX&&this.barCtx.visibleItems++;else this.barCtx.visibleItems=a.globals.dataPoints;this.arrBorderRadius=this.createBorderRadiusArr(a.globals.series),et.isSafari()&&(this.arrBorderRadius=this.arrBorderRadius.map(function(_){return _.map(function(v){return"none"})})),this.barCtx.seriesLen===0&&(this.barCtx.seriesLen=1),this.barCtx.zeroSerieses=[],a.globals.comboCharts||this.checkZeroSeries({series:t})}},{key:"initialPositions",value:function(t){var a,c,f,_,v,r,E,k,P=this.w,L=P.globals.dataPoints;this.barCtx.isRangeBar&&(L=P.globals.labels.length);var O=this.barCtx.seriesLen;if(P.config.plotOptions.bar.rangeBarGroupRows&&(O=1),this.barCtx.isHorizontal)v=(f=P.globals.gridHeight/L)/O,P.globals.isXNumeric&&(v=(f=P.globals.gridHeight/this.barCtx.totalItems)/this.barCtx.seriesLen),v=v*parseInt(this.barCtx.barOptions.barHeight,10)/100,String(this.barCtx.barOptions.barHeight).indexOf("%")===-1&&(v=parseInt(this.barCtx.barOptions.barHeight,10)),k=this.barCtx.baseLineInvertedY+P.globals.padHorizontal+(this.barCtx.isReversed?P.globals.gridWidth:0)-(this.barCtx.isReversed?2*this.barCtx.baseLineInvertedY:0),this.barCtx.isFunnel&&(k=P.globals.gridWidth/2),c=(f-v*this.barCtx.seriesLen)/2;else{if(_=P.globals.gridWidth/this.barCtx.visibleItems,P.config.xaxis.convertedCatToNumeric&&(_=P.globals.gridWidth/P.globals.dataPoints),r=_/O*parseInt(this.barCtx.barOptions.columnWidth,10)/100,P.globals.isXNumeric){var N=this.barCtx.xRatio;P.globals.minXDiff&&P.globals.minXDiff!==.5&&P.globals.minXDiff/N>0&&(_=P.globals.minXDiff/N),(r=_/O*parseInt(this.barCtx.barOptions.columnWidth,10)/100)<1&&(r=1)}String(this.barCtx.barOptions.columnWidth).indexOf("%")===-1&&(r=parseInt(this.barCtx.barOptions.columnWidth,10)),E=P.globals.gridHeight-this.barCtx.baseLineY[this.barCtx.translationsIndex]-(this.barCtx.isReversed?P.globals.gridHeight:0)+(this.barCtx.isReversed?2*this.barCtx.baseLineY[this.barCtx.translationsIndex]:0),P.globals.isXNumeric?a=this.barCtx.getBarXForNumericXAxis({x:a,j:0,realIndex:t,barWidth:r}).x:a=P.globals.padHorizontal+et.noExponents(_-r*this.barCtx.seriesLen)/2}return P.globals.barHeight=v,P.globals.barWidth=r,{x:a,y:c,yDivision:f,xDivision:_,barHeight:v,barWidth:r,zeroH:E,zeroW:k}}},{key:"initializeStackedPrevVars",value:function(t){t.w.globals.seriesGroups.forEach(function(a){t[a]||(t[a]={}),t[a].prevY=[],t[a].prevX=[],t[a].prevYF=[],t[a].prevXF=[],t[a].prevYVal=[],t[a].prevXVal=[]})}},{key:"initializeStackedXYVars",value:function(t){t.w.globals.seriesGroups.forEach(function(a){t[a]||(t[a]={}),t[a].xArrj=[],t[a].xArrjF=[],t[a].xArrjVal=[],t[a].yArrj=[],t[a].yArrjF=[],t[a].yArrjVal=[]})}},{key:"getPathFillColor",value:function(t,a,c,f){var _,v,r,E,k=this.w,P=this.barCtx.ctx.fill,L=null,O=this.barCtx.barOptions.distributed?c:a,N=!1;return this.barCtx.barOptions.colors.ranges.length>0&&this.barCtx.barOptions.colors.ranges.map(function(G){t[a][c]>=G.from&&t[a][c]<=G.to&&(L=G.color,N=!0)}),{color:P.fillPath({seriesNumber:this.barCtx.barOptions.distributed?O:f,dataPointIndex:c,color:L,value:t[a][c],fillConfig:(_=k.config.series[a].data[c])===null||_===void 0?void 0:_.fill,fillType:(v=k.config.series[a].data[c])!==null&&v!==void 0&&(r=v.fill)!==null&&r!==void 0&&r.type?(E=k.config.series[a].data[c])===null||E===void 0?void 0:E.fill.type:Array.isArray(k.config.fill.type)?k.config.fill.type[f]:k.config.fill.type}),useRangeColor:N}}},{key:"getStrokeWidth",value:function(t,a,c){var f=0,_=this.w;return this.barCtx.series[t][a]===void 0||this.barCtx.series[t][a]===null||_.config.chart.type==="bar"&&!this.barCtx.series[t][a]?this.barCtx.isNullValue=!0:this.barCtx.isNullValue=!1,_.config.stroke.show&&(this.barCtx.isNullValue||(f=Array.isArray(this.barCtx.strokeWidth)?this.barCtx.strokeWidth[c]:this.barCtx.strokeWidth)),f}},{key:"createBorderRadiusArr",value:function(t){var a,c=this.w,f=!this.w.config.chart.stacked||c.config.plotOptions.bar.borderRadius<=0,_=t.length,v=0|((a=t[0])===null||a===void 0?void 0:a.length),r=Array.from({length:_},function(){return Array(v).fill(f?"top":"none")});if(f)return r;for(var E=0;E<v;E++){for(var k=[],P=[],L=0,O=0;O<_;O++){var N=t[O][E];N>0?(k.push(O),L++):N<0&&(P.push(O),L++)}if(k.length>0&&P.length===0)if(k.length===1)r[k[0]][E]="both";else{var G,H=k[0],Q=k[k.length-1],ee=Uf(k);try{for(ee.s();!(G=ee.n()).done;){var ie=G.value;r[ie][E]=ie===H?"bottom":ie===Q?"top":"none"}}catch(Lt){ee.e(Lt)}finally{ee.f()}}else if(P.length>0&&k.length===0)if(P.length===1)r[P[0]][E]="both";else{var ue,ve=Math.max.apply(Math,P),ce=Math.min.apply(Math,P),Te=Uf(P);try{for(Te.s();!(ue=Te.n()).done;){var Se=ue.value;r[Se][E]=Se===ve?"bottom":Se===ce?"top":"none"}}catch(Lt){Te.e(Lt)}finally{Te.f()}}else if(k.length>0&&P.length>0){var Ie,Ue=k[k.length-1],Ke=Uf(k);try{for(Ke.s();!(Ie=Ke.n()).done;){var qe=Ie.value;r[qe][E]=qe===Ue?"top":"none"}}catch(Lt){Ke.e(Lt)}finally{Ke.f()}var ft,bt=Math.max.apply(Math,P),Tt=Uf(P);try{for(Tt.s();!(ft=Tt.n()).done;){var Et=ft.value;r[Et][E]=Et===bt?"bottom":"none"}}catch(Lt){Tt.e(Lt)}finally{Tt.f()}}else L===1&&(r[k[0]||P[0]][E]="both")}return r}},{key:"barBackground",value:function(t){var a=t.j,c=t.i,f=t.x1,_=t.x2,v=t.y1,r=t.y2,E=t.elSeries,k=this.w,P=new Nt(this.barCtx.ctx),L=new fa(this.barCtx.ctx).getActiveConfigSeriesIndex();if(this.barCtx.barOptions.colors.backgroundBarColors.length>0&&L===c){a>=this.barCtx.barOptions.colors.backgroundBarColors.length&&(a%=this.barCtx.barOptions.colors.backgroundBarColors.length);var O=this.barCtx.barOptions.colors.backgroundBarColors[a],N=P.drawRect(f!==void 0?f:0,v!==void 0?v:0,_!==void 0?_:k.globals.gridWidth,r!==void 0?r:k.globals.gridHeight,this.barCtx.barOptions.colors.backgroundBarRadius,O,this.barCtx.barOptions.colors.backgroundBarOpacity);E.add(N),N.node.classList.add("apexcharts-backgroundBar")}}},{key:"getColumnPaths",value:function(t){var a,c=t.barWidth,f=t.barXPosition,_=t.y1,v=t.y2,r=t.strokeWidth,E=t.isReversed,k=t.series,P=t.seriesGroup,L=t.realIndex,O=t.i,N=t.j,G=t.w,H=new Nt(this.barCtx.ctx);(r=Array.isArray(r)?r[L]:r)||(r=0);var Q=c,ee=f;(a=G.config.series[L].data[N])!==null&&a!==void 0&&a.columnWidthOffset&&(ee=f-G.config.series[L].data[N].columnWidthOffset/2,Q=c+G.config.series[L].data[N].columnWidthOffset);var ie=r/2,ue=ee+ie,ve=ee+Q-ie,ce=(k[O][N]>=0?1:-1)*(E?-1:1);_+=.001-ie*ce,v+=.001+ie*ce;var Te=H.move(ue,_),Se=H.move(ue,_),Ie=H.line(ve,_);if(G.globals.previousPaths.length>0&&(Se=this.barCtx.getPreviousPath(L,N,!1)),Te=Te+H.line(ue,v)+H.line(ve,v)+Ie+(G.config.plotOptions.bar.borderRadiusApplication==="around"||this.arrBorderRadius[L][N]==="both"?" Z":" z"),Se=Se+H.line(ue,_)+Ie+Ie+Ie+Ie+Ie+H.line(ue,_)+(G.config.plotOptions.bar.borderRadiusApplication==="around"||this.arrBorderRadius[L][N]==="both"?" Z":" z"),this.arrBorderRadius[L][N]!=="none"&&(Te=H.roundPathCorners(Te,G.config.plotOptions.bar.borderRadius)),G.config.chart.stacked){var Ue=this.barCtx;(Ue=this.barCtx[P]).yArrj.push(v-ie*ce),Ue.yArrjF.push(Math.abs(_-v+r*ce)),Ue.yArrjVal.push(this.barCtx.series[O][N])}return{pathTo:Te,pathFrom:Se}}},{key:"getBarpaths",value:function(t){var a,c=t.barYPosition,f=t.barHeight,_=t.x1,v=t.x2,r=t.strokeWidth,E=t.isReversed,k=t.series,P=t.seriesGroup,L=t.realIndex,O=t.i,N=t.j,G=t.w,H=new Nt(this.barCtx.ctx);(r=Array.isArray(r)?r[L]:r)||(r=0);var Q=c,ee=f;(a=G.config.series[L].data[N])!==null&&a!==void 0&&a.barHeightOffset&&(Q=c-G.config.series[L].data[N].barHeightOffset/2,ee=f+G.config.series[L].data[N].barHeightOffset);var ie=r/2,ue=Q+ie,ve=Q+ee-ie,ce=(k[O][N]>=0?1:-1)*(E?-1:1);_+=.001+ie*ce,v+=.001-ie*ce;var Te=H.move(_,ue),Se=H.move(_,ue);G.globals.previousPaths.length>0&&(Se=this.barCtx.getPreviousPath(L,N,!1));var Ie=H.line(_,ve);if(Te=Te+H.line(v,ue)+H.line(v,ve)+Ie+(G.config.plotOptions.bar.borderRadiusApplication==="around"||this.arrBorderRadius[L][N]==="both"?" Z":" z"),Se=Se+H.line(_,ue)+Ie+Ie+Ie+Ie+Ie+H.line(_,ue)+(G.config.plotOptions.bar.borderRadiusApplication==="around"||this.arrBorderRadius[L][N]==="both"?" Z":" z"),this.arrBorderRadius[L][N]!=="none"&&(Te=H.roundPathCorners(Te,G.config.plotOptions.bar.borderRadius)),G.config.chart.stacked){var Ue=this.barCtx;(Ue=this.barCtx[P]).xArrj.push(v+ie*ce),Ue.xArrjF.push(Math.abs(_-v-r*ce)),Ue.xArrjVal.push(this.barCtx.series[O][N])}return{pathTo:Te,pathFrom:Se}}},{key:"checkZeroSeries",value:function(t){for(var a=t.series,c=this.w,f=0;f<a.length;f++){for(var _=0,v=0;v<a[c.globals.maxValsInArrayIndex].length;v++)_+=a[f][v];_===0&&this.barCtx.zeroSerieses.push(f)}}},{key:"getXForValue",value:function(t,a){var c=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2]?a:null;return t!=null&&(c=a+t/this.barCtx.invertedYRatio-2*(this.barCtx.isReversed?t/this.barCtx.invertedYRatio:0)),c}},{key:"getYForValue",value:function(t,a,c){var f=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3]?a:null;return t!=null&&(f=a-t/this.barCtx.yRatio[c]+2*(this.barCtx.isReversed?t/this.barCtx.yRatio[c]:0)),f}},{key:"getGoalValues",value:function(t,a,c,f,_,v){var r=this,E=this.w,k=[],P=function(N,G){var H;k.push((om(H={},t,t==="x"?r.getXForValue(N,a,!1):r.getYForValue(N,c,v,!1)),om(H,"attrs",G),H))};if(E.globals.seriesGoals[f]&&E.globals.seriesGoals[f][_]&&Array.isArray(E.globals.seriesGoals[f][_])&&E.globals.seriesGoals[f][_].forEach(function(N){P(N.value,N)}),this.barCtx.barOptions.isDumbbell&&E.globals.seriesRange.length){var L=this.barCtx.barOptions.dumbbellColors?this.barCtx.barOptions.dumbbellColors:E.globals.colors,O={strokeHeight:t==="x"?0:E.globals.markers.size[f],strokeWidth:t==="x"?E.globals.markers.size[f]:0,strokeDashArray:0,strokeLineCap:"round",strokeColor:Array.isArray(L[f])?L[f][0]:L[f]};P(E.globals.seriesRangeStart[f][_],O),P(E.globals.seriesRangeEnd[f][_],Jt(Jt({},O),{},{strokeColor:Array.isArray(L[f])?L[f][1]:L[f]}))}return k}},{key:"drawGoalLine",value:function(t){var a=t.barXPosition,c=t.barYPosition,f=t.goalX,_=t.goalY,v=t.barWidth,r=t.barHeight,E=new Nt(this.barCtx.ctx),k=E.group({className:"apexcharts-bar-goals-groups"});k.node.classList.add("apexcharts-element-hidden"),this.barCtx.w.globals.delayedElements.push({el:k.node}),k.attr("clip-path","url(#gridRectMarkerMask".concat(this.barCtx.w.globals.cuid,")"));var P=null;return this.barCtx.isHorizontal?Array.isArray(f)&&f.forEach(function(L){if(L.x>=-1&&L.x<=E.w.globals.gridWidth+1){var O=L.attrs.strokeHeight!==void 0?L.attrs.strokeHeight:r/2,N=c+O+r/2;P=E.drawLine(L.x,N-2*O,L.x,N,L.attrs.strokeColor?L.attrs.strokeColor:void 0,L.attrs.strokeDashArray,L.attrs.strokeWidth?L.attrs.strokeWidth:2,L.attrs.strokeLineCap),k.add(P)}}):Array.isArray(_)&&_.forEach(function(L){if(L.y>=-1&&L.y<=E.w.globals.gridHeight+1){var O=L.attrs.strokeWidth!==void 0?L.attrs.strokeWidth:v/2,N=a+O+v/2;P=E.drawLine(N-2*O,L.y,N,L.y,L.attrs.strokeColor?L.attrs.strokeColor:void 0,L.attrs.strokeDashArray,L.attrs.strokeHeight?L.attrs.strokeHeight:2,L.attrs.strokeLineCap),k.add(P)}}),k}},{key:"drawBarShadow",value:function(t){var a=t.prevPaths,c=t.currPaths,f=t.color,_=this.w,v=a.x,r=a.x1,E=a.barYPosition,k=c.x,P=c.x1,L=c.barYPosition,O=E+c.barHeight,N=new Nt(this.barCtx.ctx),G=new et,H=N.move(r,O)+N.line(v,O)+N.line(k,L)+N.line(P,L)+N.line(r,O)+(_.config.plotOptions.bar.borderRadiusApplication==="around"||this.arrBorderRadius[realIndex][j]==="both"?" Z":" z");return N.drawPath({d:H,fill:G.shadeColor(.5,et.rgb2hex(f)),stroke:"none",strokeWidth:0,fillOpacity:1,classes:"apexcharts-bar-shadow apexcharts-decoration-element"})}},{key:"getZeroValueEncounters",value:function(t){var a,c=t.i,f=t.j,_=this.w,v=0,r=0;return(_.config.plotOptions.bar.horizontal?_.globals.series.map(function(E,k){return k}):((a=_.globals.columnSeries)===null||a===void 0?void 0:a.i.map(function(E){return E}))||[]).forEach(function(E){var k=_.globals.seriesPercent[E][f];k&&v++,E<c&&k===0&&r++}),{nonZeroColumns:v,zeroEncounters:r}}},{key:"getGroupIndex",value:function(t){var a=this.w,c=a.globals.seriesGroups.findIndex(function(v){return v.indexOf(a.globals.seriesNames[t])>-1}),f=this.barCtx.columnGroupIndices,_=f.indexOf(c);return _<0&&(f.push(c),_=f.length-1),{groupIndex:c,columnGroupIndex:_}}}]),S}(),Bu=function(){function S(t,a){pi(this,S),this.ctx=t,this.w=t.w;var c=this.w;this.barOptions=c.config.plotOptions.bar,this.isHorizontal=this.barOptions.horizontal,this.strokeWidth=c.config.stroke.width,this.isNullValue=!1,this.isRangeBar=c.globals.seriesRange.length&&this.isHorizontal,this.isVerticalGroupedRangeBar=!c.globals.isBarHorizontal&&c.globals.seriesRange.length&&c.config.plotOptions.bar.rangeBarGroupRows,this.isFunnel=this.barOptions.isFunnel,this.xyRatios=a,this.xyRatios!==null&&(this.xRatio=a.xRatio,this.yRatio=a.yRatio,this.invertedXRatio=a.invertedXRatio,this.invertedYRatio=a.invertedYRatio,this.baseLineY=a.baseLineY,this.baseLineInvertedY=a.baseLineInvertedY),this.yaxisIndex=0,this.translationsIndex=0,this.seriesLen=0,this.pathArr=[];var f=new fa(this.ctx);this.lastActiveBarSerieIndex=f.getActiveConfigSeriesIndex("desc",["bar","column"]),this.columnGroupIndices=[];var _=f.getBarSeriesIndices(),v=new Is(this.ctx);this.stackedSeriesTotals=v.getStackedSeriesTotals(this.w.config.series.map(function(r,E){return _.indexOf(E)===-1?E:-1}).filter(function(r){return r!==-1})),this.barHelpers=new QE(this)}return gi(S,[{key:"draw",value:function(t,a){var c=this.w,f=new Nt(this.ctx),_=new Is(this.ctx,c);t=_.getLogSeries(t),this.series=t,this.yRatio=_.getLogYRatios(this.yRatio),this.barHelpers.initVariables(t);var v=f.group({class:"apexcharts-bar-series apexcharts-plot-series"});c.config.dataLabels.enabled&&this.totalItems>this.barOptions.dataLabels.maxItems&&console.warn("WARNING: DataLabels are enabled but there are too many to display. This may cause performance issue when rendering - ApexCharts");for(var r=0,E=0;r<t.length;r++,E++){var k,P,L,O,N=void 0,G=void 0,H=[],Q=[],ee=c.globals.comboCharts?a[r]:r,ie=this.barHelpers.getGroupIndex(ee).columnGroupIndex,ue=f.group({class:"apexcharts-series",rel:r+1,seriesName:et.escapeString(c.globals.seriesNames[ee]),"data:realIndex":ee});this.ctx.series.addCollapsedClassToSeries(ue,ee),t[r].length>0&&(this.visibleI=this.visibleI+1);var ve=0,ce=0;this.yRatio.length>1&&(this.yaxisIndex=c.globals.seriesYAxisReverseMap[ee],this.translationsIndex=ee);var Te=this.translationsIndex;this.isReversed=c.config.yaxis[this.yaxisIndex]&&c.config.yaxis[this.yaxisIndex].reversed;var Se=this.barHelpers.initialPositions(ee);G=Se.y,ve=Se.barHeight,P=Se.yDivision,O=Se.zeroW,N=Se.x,ce=Se.barWidth,k=Se.xDivision,L=Se.zeroH,this.isHorizontal||Q.push(N+ce/2);var Ie=f.group({class:"apexcharts-datalabels","data:realIndex":ee});c.globals.delayedElements.push({el:Ie.node}),Ie.node.classList.add("apexcharts-element-hidden");var Ue=f.group({class:"apexcharts-bar-goals-markers"}),Ke=f.group({class:"apexcharts-bar-shadows"});c.globals.delayedElements.push({el:Ke.node}),Ke.node.classList.add("apexcharts-element-hidden");for(var qe=0;qe<t[r].length;qe++){var ft=this.barHelpers.getStrokeWidth(r,qe,ee),bt=null,Tt={indexes:{i:r,j:qe,realIndex:ee,translationsIndex:Te,bc:E},x:N,y:G,strokeWidth:ft,elSeries:ue};this.isHorizontal?(bt=this.drawBarPaths(Jt(Jt({},Tt),{},{barHeight:ve,zeroW:O,yDivision:P})),ce=this.series[r][qe]/this.invertedYRatio):(bt=this.drawColumnPaths(Jt(Jt({},Tt),{},{xDivision:k,barWidth:ce,zeroH:L})),ve=this.series[r][qe]/this.yRatio[Te]);var Et=this.barHelpers.getPathFillColor(t,r,qe,ee);if(this.isFunnel&&this.barOptions.isFunnel3d&&this.pathArr.length&&qe>0){var Lt,qt=this.barHelpers.drawBarShadow({color:typeof Et.color=="string"&&((Lt=Et.color)===null||Lt===void 0?void 0:Lt.indexOf("url"))===-1?Et.color:et.hexToRgba(c.globals.colors[r]),prevPaths:this.pathArr[this.pathArr.length-1],currPaths:bt});Ke.add(qt),c.config.chart.dropShadow.enabled&&new rn(this.ctx).dropShadow(qt,c.config.chart.dropShadow,ee)}this.pathArr.push(bt);var ui=this.barHelpers.drawGoalLine({barXPosition:bt.barXPosition,barYPosition:bt.barYPosition,goalX:bt.goalX,goalY:bt.goalY,barHeight:ve,barWidth:ce});ui&&Ue.add(ui),G=bt.y,N=bt.x,qe>0&&Q.push(N+ce/2),H.push(G),this.renderSeries(Jt(Jt({realIndex:ee,pathFill:Et.color},Et.useRangeColor?{lineFill:Et.color}:{}),{},{j:qe,i:r,columnGroupIndex:ie,pathFrom:bt.pathFrom,pathTo:bt.pathTo,strokeWidth:ft,elSeries:ue,x:N,y:G,series:t,barHeight:Math.abs(bt.barHeight?bt.barHeight:ve),barWidth:Math.abs(bt.barWidth?bt.barWidth:ce),elDataLabelsWrap:Ie,elGoalsMarkers:Ue,elBarShadows:Ke,visibleSeries:this.visibleI,type:"bar"}))}c.globals.seriesXvalues[ee]=Q,c.globals.seriesYvalues[ee]=H,v.add(ue)}return v}},{key:"renderSeries",value:function(t){var a=t.realIndex,c=t.pathFill,f=t.lineFill,_=t.j,v=t.i,r=t.columnGroupIndex,E=t.pathFrom,k=t.pathTo,P=t.strokeWidth,L=t.elSeries,O=t.x,N=t.y,G=t.y1,H=t.y2,Q=t.series,ee=t.barHeight,ie=t.barWidth,ue=t.barXPosition,ve=t.barYPosition,ce=t.elDataLabelsWrap,Te=t.elGoalsMarkers,Se=t.elBarShadows,Ie=t.visibleSeries,Ue=t.type,Ke=t.classes,qe=this.w,ft=new Nt(this.ctx),bt=!1;if(!f){var Tt=typeof qe.globals.stroke.colors[a]=="function"?function(Ti){var vi,Kt=qe.config.stroke.colors;return Array.isArray(Kt)&&Kt.length>0&&((vi=Kt[Ti])||(vi=""),typeof vi=="function")?vi({value:qe.globals.series[Ti][_],dataPointIndex:_,w:qe}):vi}(a):qe.globals.stroke.colors[a];f=this.barOptions.distributed?qe.globals.stroke.colors[_]:Tt}var Et=new KE(this).handleBarDataLabels({x:O,y:N,y1:G,y2:H,i:v,j:_,series:Q,realIndex:a,columnGroupIndex:r,barHeight:ee,barWidth:ie,barXPosition:ue,barYPosition:ve,visibleSeries:Ie});qe.globals.isBarHorizontal||(Et.dataLabelsPos.dataLabelsX+Math.max(ie,qe.globals.barPadForNumericAxis)<0||Et.dataLabelsPos.dataLabelsX-Math.max(ie,qe.globals.barPadForNumericAxis)>qe.globals.gridWidth)&&(bt=!0),qe.config.series[v].data[_]&&qe.config.series[v].data[_].strokeColor&&(f=qe.config.series[v].data[_].strokeColor),this.isNullValue&&(c="none");var Lt=_/qe.config.chart.animations.animateGradually.delay*(qe.config.chart.animations.speed/qe.globals.dataPoints)/2.4;if(!bt){var qt=ft.renderPaths({i:v,j:_,realIndex:a,pathFrom:E,pathTo:k,stroke:f,strokeWidth:P,strokeLineCap:qe.config.stroke.lineCap,fill:c,animationDelay:Lt,initialSpeed:qe.config.chart.animations.speed,dataChangeSpeed:qe.config.chart.animations.dynamicAnimation.speed,className:"apexcharts-".concat(Ue,"-area ").concat(Ke),chartType:Ue});qt.attr("clip-path","url(#gridRectBarMask".concat(qe.globals.cuid,")"));var ui=qe.config.forecastDataPoints;ui.count>0&&_>=qe.globals.dataPoints-ui.count&&(qt.node.setAttribute("stroke-dasharray",ui.dashArray),qt.node.setAttribute("stroke-width",ui.strokeWidth),qt.node.setAttribute("fill-opacity",ui.fillOpacity)),G!==void 0&&H!==void 0&&(qt.attr("data-range-y1",G),qt.attr("data-range-y2",H)),new rn(this.ctx).setSelectionFilter(qt,a,_),L.add(qt),qt.attr({cy:Et.dataLabelsPos.bcy,cx:Et.dataLabelsPos.bcx,j:_,val:qe.globals.series[v][_],barHeight:ee,barWidth:ie}),Et.dataLabels!==null&&ce.add(Et.dataLabels),Et.totalDataLabels&&ce.add(Et.totalDataLabels),L.add(ce),Te&&L.add(Te),Se&&L.add(Se)}return L}},{key:"drawBarPaths",value:function(t){var a,c=t.indexes,f=t.barHeight,_=t.strokeWidth,v=t.zeroW,r=t.x,E=t.y,k=t.yDivision,P=t.elSeries,L=this.w,O=c.i,N=c.j;if(L.globals.isXNumeric)a=(E=(L.globals.seriesX[O][N]-L.globals.minX)/this.invertedXRatio-f)+f*this.visibleI;else if(L.config.plotOptions.bar.hideZeroBarsWhenGrouped){var G=this.barHelpers.getZeroValueEncounters({i:O,j:N}),H=G.nonZeroColumns,Q=G.zeroEncounters;H>0&&(f=this.seriesLen*f/H),a=E+f*this.visibleI,a-=f*Q}else a=E+f*this.visibleI;this.isFunnel&&(v-=(this.barHelpers.getXForValue(this.series[O][N],v)-v)/2),r=this.barHelpers.getXForValue(this.series[O][N],v);var ee=this.barHelpers.getBarpaths({barYPosition:a,barHeight:f,x1:v,x2:r,strokeWidth:_,isReversed:this.isReversed,series:this.series,realIndex:c.realIndex,i:O,j:N,w:L});return L.globals.isXNumeric||(E+=k),this.barHelpers.barBackground({j:N,i:O,y1:a-f*this.visibleI,y2:f*this.seriesLen,elSeries:P}),{pathTo:ee.pathTo,pathFrom:ee.pathFrom,x1:v,x:r,y:E,goalX:this.barHelpers.getGoalValues("x",v,null,O,N),barYPosition:a,barHeight:f}}},{key:"drawColumnPaths",value:function(t){var a,c=t.indexes,f=t.x,_=t.y,v=t.xDivision,r=t.barWidth,E=t.zeroH,k=t.strokeWidth,P=t.elSeries,L=this.w,O=c.realIndex,N=c.translationsIndex,G=c.i,H=c.j,Q=c.bc;if(L.globals.isXNumeric){var ee=this.getBarXForNumericXAxis({x:f,j:H,realIndex:O,barWidth:r});f=ee.x,a=ee.barXPosition}else if(L.config.plotOptions.bar.hideZeroBarsWhenGrouped){var ie=this.barHelpers.getZeroValueEncounters({i:G,j:H}),ue=ie.nonZeroColumns,ve=ie.zeroEncounters;ue>0&&(r=this.seriesLen*r/ue),a=f+r*this.visibleI,a-=r*ve}else a=f+r*this.visibleI;_=this.barHelpers.getYForValue(this.series[G][H],E,N);var ce=this.barHelpers.getColumnPaths({barXPosition:a,barWidth:r,y1:E,y2:_,strokeWidth:k,isReversed:this.isReversed,series:this.series,realIndex:O,i:G,j:H,w:L});return L.globals.isXNumeric||(f+=v),this.barHelpers.barBackground({bc:Q,j:H,i:G,x1:a-k/2-r*this.visibleI,x2:r*this.seriesLen+k/2,elSeries:P}),{pathTo:ce.pathTo,pathFrom:ce.pathFrom,x:f,y:_,goalY:this.barHelpers.getGoalValues("y",null,E,G,H,N),barXPosition:a,barWidth:r}}},{key:"getBarXForNumericXAxis",value:function(t){var a=t.x,c=t.barWidth,f=t.realIndex,_=t.j,v=this.w,r=f;return v.globals.seriesX[f].length||(r=v.globals.maxValsInArrayIndex),et.isNumber(v.globals.seriesX[r][_])&&(a=(v.globals.seriesX[r][_]-v.globals.minX)/this.xRatio-c*this.seriesLen/2),{barXPosition:a+c*this.visibleI,x:a}}},{key:"getPreviousPath",value:function(t,a){for(var c=this.w,f="M 0 0",_=0;_<c.globals.previousPaths.length;_++){var v=c.globals.previousPaths[_];v.paths&&v.paths.length>0&&parseInt(v.realIndex,10)===parseInt(t,10)&&c.globals.previousPaths[_].paths[a]!==void 0&&(f=c.globals.previousPaths[_].paths[a].d)}return f}}]),S}(),Cw=function(S){Jf(a,Bu);var t=$f(a);function a(){return pi(this,a),t.apply(this,arguments)}return gi(a,[{key:"draw",value:function(c,f){var _=this,v=this.w;this.graphics=new Nt(this.ctx),this.bar=new Bu(this.ctx,this.xyRatios);var r=new Is(this.ctx,v);c=r.getLogSeries(c),this.yRatio=r.getLogYRatios(this.yRatio),this.barHelpers.initVariables(c),v.config.chart.stackType==="100%"&&(c=v.globals.comboCharts?f.map(function(G){return v.globals.seriesPercent[G]}):v.globals.seriesPercent.slice()),this.series=c,this.barHelpers.initializeStackedPrevVars(this);for(var E=this.graphics.group({class:"apexcharts-bar-series apexcharts-plot-series"}),k=0,P=0,L=function(G,H){var Q=void 0,ee=void 0,ie=void 0,ue=void 0,ve=v.globals.comboCharts?f[G]:G,ce=_.barHelpers.getGroupIndex(ve),Te=ce.groupIndex,Se=ce.columnGroupIndex;_.groupCtx=_[v.globals.seriesGroups[Te]];var Ie=[],Ue=[],Ke=0;_.yRatio.length>1&&(_.yaxisIndex=v.globals.seriesYAxisReverseMap[ve][0],Ke=ve),_.isReversed=v.config.yaxis[_.yaxisIndex]&&v.config.yaxis[_.yaxisIndex].reversed;var qe=_.graphics.group({class:"apexcharts-series",seriesName:et.escapeString(v.globals.seriesNames[ve]),rel:G+1,"data:realIndex":ve});_.ctx.series.addCollapsedClassToSeries(qe,ve);var ft=_.graphics.group({class:"apexcharts-datalabels","data:realIndex":ve}),bt=_.graphics.group({class:"apexcharts-bar-goals-markers"}),Tt=0,Et=0,Lt=_.initialPositions(k,P,Q,ee,ie,ue,Ke);P=Lt.y,Tt=Lt.barHeight,ee=Lt.yDivision,ue=Lt.zeroW,k=Lt.x,Et=Lt.barWidth,Q=Lt.xDivision,ie=Lt.zeroH,v.globals.barHeight=Tt,v.globals.barWidth=Et,_.barHelpers.initializeStackedXYVars(_),_.groupCtx.prevY.length===1&&_.groupCtx.prevY[0].every(function(Xr){return isNaN(Xr)})&&(_.groupCtx.prevY[0]=_.groupCtx.prevY[0].map(function(){return ie}),_.groupCtx.prevYF[0]=_.groupCtx.prevYF[0].map(function(){return 0}));for(var qt=0;qt<v.globals.dataPoints;qt++){var ui=_.barHelpers.getStrokeWidth(G,qt,ve),Ti={indexes:{i:G,j:qt,realIndex:ve,translationsIndex:Ke,bc:H},strokeWidth:ui,x:k,y:P,elSeries:qe,columnGroupIndex:Se,seriesGroup:v.globals.seriesGroups[Te]},vi=null;_.isHorizontal?(vi=_.drawStackedBarPaths(Jt(Jt({},Ti),{},{zeroW:ue,barHeight:Tt,yDivision:ee})),Et=_.series[G][qt]/_.invertedYRatio):(vi=_.drawStackedColumnPaths(Jt(Jt({},Ti),{},{xDivision:Q,barWidth:Et,zeroH:ie})),Tt=_.series[G][qt]/_.yRatio[Ke]);var Kt=_.barHelpers.drawGoalLine({barXPosition:vi.barXPosition,barYPosition:vi.barYPosition,goalX:vi.goalX,goalY:vi.goalY,barHeight:Tt,barWidth:Et});Kt&&bt.add(Kt),P=vi.y,k=vi.x,Ie.push(k),Ue.push(P);var Hi=_.barHelpers.getPathFillColor(c,G,qt,ve),Br="",ar=v.globals.isBarHorizontal?"apexcharts-flip-x":"apexcharts-flip-y";(_.barHelpers.arrBorderRadius[ve][qt]==="bottom"&&v.globals.series[ve][qt]>0||_.barHelpers.arrBorderRadius[ve][qt]==="top"&&v.globals.series[ve][qt]<0)&&(Br=ar),qe=_.renderSeries(Jt(Jt({realIndex:ve,pathFill:Hi.color},Hi.useRangeColor?{lineFill:Hi.color}:{}),{},{j:qt,i:G,columnGroupIndex:Se,pathFrom:vi.pathFrom,pathTo:vi.pathTo,strokeWidth:ui,elSeries:qe,x:k,y:P,series:c,barHeight:Tt,barWidth:Et,elDataLabelsWrap:ft,elGoalsMarkers:bt,type:"bar",visibleSeries:Se,classes:Br}))}v.globals.seriesXvalues[ve]=Ie,v.globals.seriesYvalues[ve]=Ue,_.groupCtx.prevY.push(_.groupCtx.yArrj),_.groupCtx.prevYF.push(_.groupCtx.yArrjF),_.groupCtx.prevYVal.push(_.groupCtx.yArrjVal),_.groupCtx.prevX.push(_.groupCtx.xArrj),_.groupCtx.prevXF.push(_.groupCtx.xArrjF),_.groupCtx.prevXVal.push(_.groupCtx.xArrjVal),E.add(qe)},O=0,N=0;O<c.length;O++,N++)L(O,N);return E}},{key:"initialPositions",value:function(c,f,_,v,r,E,k){var P,L,O=this.w;if(this.isHorizontal){v=O.globals.gridHeight/O.globals.dataPoints;var N=O.config.plotOptions.bar.barHeight;P=String(N).indexOf("%")===-1?parseInt(N,10):v*parseInt(N,10)/100,E=O.globals.padHorizontal+(this.isReversed?O.globals.gridWidth-this.baseLineInvertedY:this.baseLineInvertedY),f=(v-P)/2}else{L=_=O.globals.gridWidth/O.globals.dataPoints;var G=O.config.plotOptions.bar.columnWidth;O.globals.isXNumeric&&O.globals.dataPoints>1?L=(_=O.globals.minXDiff/this.xRatio)*parseInt(this.barOptions.columnWidth,10)/100:String(G).indexOf("%")===-1?L=parseInt(G,10):L*=parseInt(G,10)/100,r=this.isReversed?this.baseLineY[k]:O.globals.gridHeight-this.baseLineY[k],c=O.globals.padHorizontal+(_-L)/2}var H=O.globals.barGroups.length||1;return{x:c,y:f,yDivision:v,xDivision:_,barHeight:P/H,barWidth:L/H,zeroH:r,zeroW:E}}},{key:"drawStackedBarPaths",value:function(c){for(var f,_=c.indexes,v=c.barHeight,r=c.strokeWidth,E=c.zeroW,k=c.x,P=c.y,L=c.columnGroupIndex,O=c.seriesGroup,N=c.yDivision,G=c.elSeries,H=this.w,Q=P+L*v,ee=_.i,ie=_.j,ue=_.realIndex,ve=_.translationsIndex,ce=0,Te=0;Te<this.groupCtx.prevXF.length;Te++)ce+=this.groupCtx.prevXF[Te][ie];var Se=ee;if(H.config.series[ue].name&&(Se=O.indexOf(H.config.series[ue].name)),Se>0){var Ie=E;this.groupCtx.prevXVal[Se-1][ie]<0?Ie=this.series[ee][ie]>=0?this.groupCtx.prevX[Se-1][ie]+ce-2*(this.isReversed?ce:0):this.groupCtx.prevX[Se-1][ie]:this.groupCtx.prevXVal[Se-1][ie]>=0&&(Ie=this.series[ee][ie]>=0?this.groupCtx.prevX[Se-1][ie]:this.groupCtx.prevX[Se-1][ie]-ce+2*(this.isReversed?ce:0)),f=Ie}else f=E;k=this.series[ee][ie]===null?f:f+this.series[ee][ie]/this.invertedYRatio-2*(this.isReversed?this.series[ee][ie]/this.invertedYRatio:0);var Ue=this.barHelpers.getBarpaths({barYPosition:Q,barHeight:v,x1:f,x2:k,strokeWidth:r,isReversed:this.isReversed,series:this.series,realIndex:_.realIndex,seriesGroup:O,i:ee,j:ie,w:H});return this.barHelpers.barBackground({j:ie,i:ee,y1:Q,y2:v,elSeries:G}),P+=N,{pathTo:Ue.pathTo,pathFrom:Ue.pathFrom,goalX:this.barHelpers.getGoalValues("x",E,null,ee,ie,ve),barXPosition:f,barYPosition:Q,x:k,y:P}}},{key:"drawStackedColumnPaths",value:function(c){var f=c.indexes,_=c.x,v=c.y,r=c.xDivision,E=c.barWidth,k=c.zeroH,P=c.columnGroupIndex,L=c.seriesGroup,O=c.elSeries,N=this.w,G=f.i,H=f.j,Q=f.bc,ee=f.realIndex,ie=f.translationsIndex;if(N.globals.isXNumeric){var ue=N.globals.seriesX[ee][H];ue||(ue=0),_=(ue-N.globals.minX)/this.xRatio-E/2*N.globals.barGroups.length}for(var ve,ce=_+P*E,Te=0,Se=0;Se<this.groupCtx.prevYF.length;Se++)Te+=isNaN(this.groupCtx.prevYF[Se][H])?0:this.groupCtx.prevYF[Se][H];var Ie=G;if(L&&(Ie=L.indexOf(N.globals.seriesNames[ee])),Ie>0&&!N.globals.isXNumeric||Ie>0&&N.globals.isXNumeric&&N.globals.seriesX[ee-1][H]===N.globals.seriesX[ee][H]){var Ue,Ke,qe,ft=Math.min(this.yRatio.length+1,ee+1);if(this.groupCtx.prevY[Ie-1]!==void 0&&this.groupCtx.prevY[Ie-1].length)for(var bt=1;bt<ft;bt++){var Tt;if(!isNaN((Tt=this.groupCtx.prevY[Ie-bt])===null||Tt===void 0?void 0:Tt[H])){qe=this.groupCtx.prevY[Ie-bt][H];break}}for(var Et=1;Et<ft;Et++){var Lt,qt;if(((Lt=this.groupCtx.prevYVal[Ie-Et])===null||Lt===void 0?void 0:Lt[H])<0){Ke=this.series[G][H]>=0?qe-Te+2*(this.isReversed?Te:0):qe;break}if(((qt=this.groupCtx.prevYVal[Ie-Et])===null||qt===void 0?void 0:qt[H])>=0){Ke=this.series[G][H]>=0?qe:qe+Te-2*(this.isReversed?Te:0);break}}Ke===void 0&&(Ke=N.globals.gridHeight),ve=(Ue=this.groupCtx.prevYF[0])!==null&&Ue!==void 0&&Ue.every(function(Ti){return Ti===0})&&this.groupCtx.prevYF.slice(1,Ie).every(function(Ti){return Ti.every(function(vi){return isNaN(vi)})})?k:Ke}else ve=k;v=this.series[G][H]?ve-this.series[G][H]/this.yRatio[ie]+2*(this.isReversed?this.series[G][H]/this.yRatio[ie]:0):ve;var ui=this.barHelpers.getColumnPaths({barXPosition:ce,barWidth:E,y1:ve,y2:v,yRatio:this.yRatio[ie],strokeWidth:this.strokeWidth,isReversed:this.isReversed,series:this.series,seriesGroup:L,realIndex:f.realIndex,i:G,j:H,w:N});return this.barHelpers.barBackground({bc:Q,j:H,i:G,x1:ce,x2:E,elSeries:O}),{pathTo:ui.pathTo,pathFrom:ui.pathFrom,goalY:this.barHelpers.getGoalValues("y",null,k,G,H),barXPosition:ce,x:N.globals.isXNumeric?_:_+r,y:v}}}]),a}(),My=function(S){Jf(a,Bu);var t=$f(a);function a(){return pi(this,a),t.apply(this,arguments)}return gi(a,[{key:"draw",value:function(c,f,_){var v=this,r=this.w,E=new Nt(this.ctx),k=r.globals.comboCharts?f:r.config.chart.type,P=new Da(this.ctx);this.candlestickOptions=this.w.config.plotOptions.candlestick,this.boxOptions=this.w.config.plotOptions.boxPlot,this.isHorizontal=r.config.plotOptions.bar.horizontal,this.isOHLC=this.candlestickOptions&&this.candlestickOptions.type==="ohlc";var L=new Is(this.ctx,r);c=L.getLogSeries(c),this.series=c,this.yRatio=L.getLogYRatios(this.yRatio),this.barHelpers.initVariables(c);for(var O=E.group({class:"apexcharts-".concat(k,"-series apexcharts-plot-series")}),N=function(H){v.isBoxPlot=r.config.chart.type==="boxPlot"||r.config.series[H].type==="boxPlot";var Q,ee,ie,ue,ve=void 0,ce=void 0,Te=[],Se=[],Ie=r.globals.comboCharts?_[H]:H,Ue=v.barHelpers.getGroupIndex(Ie).columnGroupIndex,Ke=E.group({class:"apexcharts-series",seriesName:et.escapeString(r.globals.seriesNames[Ie]),rel:H+1,"data:realIndex":Ie});v.ctx.series.addCollapsedClassToSeries(Ke,Ie),c[H].length>0&&(v.visibleI=v.visibleI+1);var qe,ft,bt=0;v.yRatio.length>1&&(v.yaxisIndex=r.globals.seriesYAxisReverseMap[Ie][0],bt=Ie);var Tt=v.barHelpers.initialPositions(Ie);ce=Tt.y,qe=Tt.barHeight,ee=Tt.yDivision,ue=Tt.zeroW,ve=Tt.x,ft=Tt.barWidth,Q=Tt.xDivision,ie=Tt.zeroH,Se.push(ve+ft/2);for(var Et=E.group({class:"apexcharts-datalabels","data:realIndex":Ie}),Lt=E.group({class:"apexcharts-bar-goals-markers"}),qt=function(Ti){var vi=v.barHelpers.getStrokeWidth(H,Ti,Ie),Kt=null,Hi={indexes:{i:H,j:Ti,realIndex:Ie,translationsIndex:bt},x:ve,y:ce,strokeWidth:vi,elSeries:Ke};Kt=v.isHorizontal?v.drawHorizontalBoxPaths(Jt(Jt({},Hi),{},{yDivision:ee,barHeight:qe,zeroW:ue})):v.drawVerticalBoxPaths(Jt(Jt({},Hi),{},{xDivision:Q,barWidth:ft,zeroH:ie})),ce=Kt.y,ve=Kt.x;var Br=v.barHelpers.drawGoalLine({barXPosition:Kt.barXPosition,barYPosition:Kt.barYPosition,goalX:Kt.goalX,goalY:Kt.goalY,barHeight:qe,barWidth:ft});Br&&Lt.add(Br),Ti>0&&Se.push(ve+ft/2),Te.push(ce),Kt.pathTo.forEach(function(ar,Xr){var mi=!v.isBoxPlot&&v.candlestickOptions.wick.useFillColor?Kt.color[Xr]:r.globals.stroke.colors[H],Ci=P.fillPath({seriesNumber:Ie,dataPointIndex:Ti,color:Kt.color[Xr],value:c[H][Ti]});v.renderSeries({realIndex:Ie,pathFill:Ci,lineFill:mi,j:Ti,i:H,pathFrom:Kt.pathFrom,pathTo:ar,strokeWidth:vi,elSeries:Ke,x:ve,y:ce,series:c,columnGroupIndex:Ue,barHeight:qe,barWidth:ft,elDataLabelsWrap:Et,elGoalsMarkers:Lt,visibleSeries:v.visibleI,type:r.config.chart.type})})},ui=0;ui<r.globals.dataPoints;ui++)qt(ui);r.globals.seriesXvalues[Ie]=Se,r.globals.seriesYvalues[Ie]=Te,O.add(Ke)},G=0;G<c.length;G++)N(G);return O}},{key:"drawVerticalBoxPaths",value:function(c){var f=c.indexes,_=c.x;c.y;var v=c.xDivision,r=c.barWidth,E=c.zeroH,k=c.strokeWidth,P=this.w,L=new Nt(this.ctx),O=f.i,N=f.j,G=P.config.plotOptions.candlestick.colors,H=this.boxOptions.colors,Q=f.realIndex,ee=function(ui){return Array.isArray(ui)?ui[Q]:ui},ie=ee(G.upward),ue=ee(G.downward),ve=this.yRatio[f.translationsIndex],ce=this.getOHLCValue(Q,N),Te=E,Se=E,Ie=ce.o<ce.c?[ie]:[ue];this.isBoxPlot&&(Ie=[ee(H.lower),ee(H.upper)]);var Ue=Math.min(ce.o,ce.c),Ke=Math.max(ce.o,ce.c),qe=ce.m;P.globals.isXNumeric&&(_=(P.globals.seriesX[Q][N]-P.globals.minX)/this.xRatio-r/2);var ft=_+r*this.visibleI;this.series[O][N]===void 0||this.series[O][N]===null?(Ue=E,Ke=E):(Ue=E-Ue/ve,Ke=E-Ke/ve,Te=E-ce.h/ve,Se=E-ce.l/ve,qe=E-ce.m/ve);var bt=L.move(ft,E),Tt=L.move(ft+r/2,Ue);if(P.globals.previousPaths.length>0&&(Tt=this.getPreviousPath(Q,N,!0)),this.isOHLC){var Et=ft+r/2,Lt=E-ce.o/ve,qt=E-ce.c/ve;bt=[L.move(Et,Te)+L.line(Et,Se)+L.move(Et,Lt)+L.line(ft,Lt)+L.move(Et,qt)+L.line(ft+r,qt)]}else bt=this.isBoxPlot?[L.move(ft,Ue)+L.line(ft+r/2,Ue)+L.line(ft+r/2,Te)+L.line(ft+r/4,Te)+L.line(ft+r-r/4,Te)+L.line(ft+r/2,Te)+L.line(ft+r/2,Ue)+L.line(ft+r,Ue)+L.line(ft+r,qe)+L.line(ft,qe)+L.line(ft,Ue+k/2),L.move(ft,qe)+L.line(ft+r,qe)+L.line(ft+r,Ke)+L.line(ft+r/2,Ke)+L.line(ft+r/2,Se)+L.line(ft+r-r/4,Se)+L.line(ft+r/4,Se)+L.line(ft+r/2,Se)+L.line(ft+r/2,Ke)+L.line(ft,Ke)+L.line(ft,qe)+"z"]:[L.move(ft,Ke)+L.line(ft+r/2,Ke)+L.line(ft+r/2,Te)+L.line(ft+r/2,Ke)+L.line(ft+r,Ke)+L.line(ft+r,Ue)+L.line(ft+r/2,Ue)+L.line(ft+r/2,Se)+L.line(ft+r/2,Ue)+L.line(ft,Ue)+L.line(ft,Ke-k/2)];return Tt+=L.move(ft,Ue),P.globals.isXNumeric||(_+=v),{pathTo:bt,pathFrom:Tt,x:_,y:Ke,goalY:this.barHelpers.getGoalValues("y",null,E,O,N,f.translationsIndex),barXPosition:ft,color:Ie}}},{key:"drawHorizontalBoxPaths",value:function(c){var f=c.indexes;c.x;var _=c.y,v=c.yDivision,r=c.barHeight,E=c.zeroW,k=c.strokeWidth,P=this.w,L=new Nt(this.ctx),O=f.i,N=f.j,G=this.boxOptions.colors.lower;this.isBoxPlot&&(G=[this.boxOptions.colors.lower,this.boxOptions.colors.upper]);var H=this.invertedYRatio,Q=f.realIndex,ee=this.getOHLCValue(Q,N),ie=E,ue=E,ve=Math.min(ee.o,ee.c),ce=Math.max(ee.o,ee.c),Te=ee.m;P.globals.isXNumeric&&(_=(P.globals.seriesX[Q][N]-P.globals.minX)/this.invertedXRatio-r/2);var Se=_+r*this.visibleI;this.series[O][N]===void 0||this.series[O][N]===null?(ve=E,ce=E):(ve=E+ve/H,ce=E+ce/H,ie=E+ee.h/H,ue=E+ee.l/H,Te=E+ee.m/H);var Ie=L.move(E,Se),Ue=L.move(ve,Se+r/2);return P.globals.previousPaths.length>0&&(Ue=this.getPreviousPath(Q,N,!0)),Ie=[L.move(ve,Se)+L.line(ve,Se+r/2)+L.line(ie,Se+r/2)+L.line(ie,Se+r/2-r/4)+L.line(ie,Se+r/2+r/4)+L.line(ie,Se+r/2)+L.line(ve,Se+r/2)+L.line(ve,Se+r)+L.line(Te,Se+r)+L.line(Te,Se)+L.line(ve+k/2,Se),L.move(Te,Se)+L.line(Te,Se+r)+L.line(ce,Se+r)+L.line(ce,Se+r/2)+L.line(ue,Se+r/2)+L.line(ue,Se+r-r/4)+L.line(ue,Se+r/4)+L.line(ue,Se+r/2)+L.line(ce,Se+r/2)+L.line(ce,Se)+L.line(Te,Se)+"z"],Ue+=L.move(ve,Se),P.globals.isXNumeric||(_+=v),{pathTo:Ie,pathFrom:Ue,x:ce,y:_,goalX:this.barHelpers.getGoalValues("x",E,null,O,N),barYPosition:Se,color:G}}},{key:"getOHLCValue",value:function(c,f){var _=this.w,v=new Is(this.ctx,_),r=v.getLogValAtSeriesIndex(_.globals.seriesCandleH[c][f],c),E=v.getLogValAtSeriesIndex(_.globals.seriesCandleO[c][f],c),k=v.getLogValAtSeriesIndex(_.globals.seriesCandleM[c][f],c),P=v.getLogValAtSeriesIndex(_.globals.seriesCandleC[c][f],c),L=v.getLogValAtSeriesIndex(_.globals.seriesCandleL[c][f],c);return{o:this.isBoxPlot?r:E,h:this.isBoxPlot?E:r,m:k,l:this.isBoxPlot?P:L,c:this.isBoxPlot?L:P}}}]),a}(),z1=function(){function S(t){pi(this,S),this.ctx=t,this.w=t.w}return gi(S,[{key:"checkColorRange",value:function(){var t=this.w,a=!1,c=t.config.plotOptions[t.config.chart.type];return c.colorScale.ranges.length>0&&c.colorScale.ranges.map(function(f,_){f.from<=0&&(a=!0)}),a}},{key:"getShadeColor",value:function(t,a,c,f){var _=this.w,v=1,r=_.config.plotOptions[t].shadeIntensity,E=this.determineColor(t,a,c);_.globals.hasNegs||f?v=_.config.plotOptions[t].reverseNegativeShade?E.percent<0?E.percent/100*(1.25*r):(1-E.percent/100)*(1.25*r):E.percent<=0?1-(1+E.percent/100)*r:(1-E.percent/100)*r:(v=1-E.percent/100,t==="treemap"&&(v=(1-E.percent/100)*(1.25*r)));var k=E.color,P=new et;if(_.config.plotOptions[t].enableShades)if(this.w.config.theme.mode==="dark"){var L=P.shadeColor(-1*v,E.color);k=et.hexToRgba(et.isColorHex(L)?L:et.rgb2hex(L),_.config.fill.opacity)}else{var O=P.shadeColor(v,E.color);k=et.hexToRgba(et.isColorHex(O)?O:et.rgb2hex(O),_.config.fill.opacity)}return{color:k,colorProps:E}}},{key:"determineColor",value:function(t,a,c){var f=this.w,_=f.globals.series[a][c],v=f.config.plotOptions[t],r=v.colorScale.inverse?c:a;v.distributed&&f.config.chart.type==="treemap"&&(r=c);var E=f.globals.colors[r],k=null,P=Math.min.apply(Math,Us(f.globals.series[a])),L=Math.max.apply(Math,Us(f.globals.series[a]));v.distributed||t!=="heatmap"||(P=f.globals.minY,L=f.globals.maxY),v.colorScale.min!==void 0&&(P=v.colorScale.min<f.globals.minY?v.colorScale.min:f.globals.minY,L=v.colorScale.max>f.globals.maxY?v.colorScale.max:f.globals.maxY);var O=Math.abs(L)+Math.abs(P),N=100*_/(O===0?O-1e-6:O);return v.colorScale.ranges.length>0&&v.colorScale.ranges.map(function(G,H){if(_>=G.from&&_<=G.to){E=G.color,k=G.foreColor?G.foreColor:null,P=G.from,L=G.to;var Q=Math.abs(L)+Math.abs(P);N=100*_/(Q===0?Q-1e-6:Q)}}),{color:E,foreColor:k,percent:N}}},{key:"calculateDataLabels",value:function(t){var a=t.text,c=t.x,f=t.y,_=t.i,v=t.j,r=t.colorProps,E=t.fontSize,k=this.w.config.dataLabels,P=new Nt(this.ctx),L=new Fu(this.ctx),O=null;if(k.enabled){O=P.group({class:"apexcharts-data-labels"});var N=k.offsetX,G=k.offsetY,H=c+N,Q=f+parseFloat(k.style.fontSize)/3+G;L.plotDataLabelsText({x:H,y:Q,text:a,i:_,j:v,color:r.foreColor,parent:O,fontSize:E,dataLabelsConfig:k})}return O}},{key:"addListeners",value:function(t){var a=new Nt(this.ctx);t.node.addEventListener("mouseenter",a.pathMouseEnter.bind(this,t)),t.node.addEventListener("mouseleave",a.pathMouseLeave.bind(this,t)),t.node.addEventListener("mousedown",a.pathMouseDown.bind(this,t))}}]),S}(),eC=function(){function S(t,a){pi(this,S),this.ctx=t,this.w=t.w,this.xRatio=a.xRatio,this.yRatio=a.yRatio,this.dynamicAnim=this.w.config.chart.animations.dynamicAnimation,this.helpers=new z1(t),this.rectRadius=this.w.config.plotOptions.heatmap.radius,this.strokeWidth=this.w.config.stroke.show?this.w.config.stroke.width:0}return gi(S,[{key:"draw",value:function(t){var a=this.w,c=new Nt(this.ctx),f=c.group({class:"apexcharts-heatmap"});f.attr("clip-path","url(#gridRectMask".concat(a.globals.cuid,")"));var _=a.globals.gridWidth/a.globals.dataPoints,v=a.globals.gridHeight/a.globals.series.length,r=0,E=!1;this.negRange=this.helpers.checkColorRange();var k=t.slice();a.config.yaxis[0].reversed&&(E=!0,k.reverse());for(var P=E?0:k.length-1;E?P<k.length:P>=0;E?P++:P--){var L=c.group({class:"apexcharts-series apexcharts-heatmap-series",seriesName:et.escapeString(a.globals.seriesNames[P]),rel:P+1,"data:realIndex":P});if(this.ctx.series.addCollapsedClassToSeries(L,P),a.config.chart.dropShadow.enabled){var O=a.config.chart.dropShadow;new rn(this.ctx).dropShadow(L,O,P)}for(var N=0,G=a.config.plotOptions.heatmap.shadeIntensity,H=0,Q=0;Q<a.globals.dataPoints;Q++)if(a.globals.seriesX.length&&!a.globals.allSeriesHasEqualX&&a.globals.minX+a.globals.minXDiff*Q<a.globals.seriesX[P][H])N+=_;else{if(H>=k[P].length)break;var ee=this.helpers.getShadeColor(a.config.chart.type,P,H,this.negRange),ie=ee.color,ue=ee.colorProps;a.config.fill.type==="image"&&(ie=new Da(this.ctx).fillPath({seriesNumber:P,dataPointIndex:H,opacity:a.globals.hasNegs?ue.percent<0?1-(1+ue.percent/100):G+ue.percent/100:ue.percent/100,patternID:et.randomId(),width:a.config.fill.image.width?a.config.fill.image.width:_,height:a.config.fill.image.height?a.config.fill.image.height:v}));var ve=this.rectRadius,ce=c.drawRect(N,r,_,v,ve);if(ce.attr({cx:N,cy:r}),ce.node.classList.add("apexcharts-heatmap-rect"),L.add(ce),ce.attr({fill:ie,i:P,index:P,j:H,val:t[P][H],"stroke-width":this.strokeWidth,stroke:a.config.plotOptions.heatmap.useFillColorAsStroke?ie:a.globals.stroke.colors[0],color:ie}),this.helpers.addListeners(ce),a.config.chart.animations.enabled&&!a.globals.dataChanged){var Te=1;a.globals.resized||(Te=a.config.chart.animations.speed),this.animateHeatMap(ce,N,r,_,v,Te)}if(a.globals.dataChanged){var Se=1;if(this.dynamicAnim.enabled&&a.globals.shouldAnimate){Se=this.dynamicAnim.speed;var Ie=a.globals.previousPaths[P]&&a.globals.previousPaths[P][H]&&a.globals.previousPaths[P][H].color;Ie||(Ie="rgba(255, 255, 255, 0)"),this.animateHeatColor(ce,et.isColorHex(Ie)?Ie:et.rgb2hex(Ie),et.isColorHex(ie)?ie:et.rgb2hex(ie),Se)}}var Ue=(0,a.config.dataLabels.formatter)(a.globals.series[P][H],{value:a.globals.series[P][H],seriesIndex:P,dataPointIndex:H,w:a}),Ke=this.helpers.calculateDataLabels({text:Ue,x:N+_/2,y:r+v/2,i:P,j:H,colorProps:ue,series:k});Ke!==null&&L.add(Ke),N+=_,H++}r+=v,f.add(L)}var qe=a.globals.yAxisScale[0].result.slice();return a.config.yaxis[0].reversed?qe.unshift(""):qe.push(""),a.globals.yAxisScale[0].result=qe,f}},{key:"animateHeatMap",value:function(t,a,c,f,_,v){var r=new Nu(this.ctx);r.animateRect(t,{x:a+f/2,y:c+_/2,width:0,height:0},{x:a,y:c,width:f,height:_},v,function(){r.animationCompleted(t)})}},{key:"animateHeatColor",value:function(t,a,c,f){t.attr({fill:a}).animate(f).attr({fill:c})}}]),S}(),R1=function(){function S(t){pi(this,S),this.ctx=t,this.w=t.w}return gi(S,[{key:"drawYAxisTexts",value:function(t,a,c,f){var _=this.w,v=_.config.yaxis[0],r=_.globals.yLabelFormatters[0];return new Nt(this.ctx).drawText({x:t+v.labels.offsetX,y:a+v.labels.offsetY,text:r(f,c),textAnchor:"middle",fontSize:v.labels.style.fontSize,fontFamily:v.labels.style.fontFamily,foreColor:Array.isArray(v.labels.style.colors)?v.labels.style.colors[c]:v.labels.style.colors})}}]),S}(),D1=function(){function S(t){pi(this,S),this.ctx=t,this.w=t.w;var a=this.w;this.chartType=this.w.config.chart.type,this.initialAnim=this.w.config.chart.animations.enabled,this.dynamicAnim=this.initialAnim&&this.w.config.chart.animations.dynamicAnimation.enabled,this.animBeginArr=[0],this.animDur=0,this.donutDataLabels=this.w.config.plotOptions.pie.donut.labels,this.lineColorArr=a.globals.stroke.colors!==void 0?a.globals.stroke.colors:a.globals.colors,this.defaultSize=Math.min(a.globals.gridWidth,a.globals.gridHeight),this.centerY=this.defaultSize/2,this.centerX=a.globals.gridWidth/2,a.config.chart.type==="radialBar"?this.fullAngle=360:this.fullAngle=Math.abs(a.config.plotOptions.pie.endAngle-a.config.plotOptions.pie.startAngle),this.initialAngle=a.config.plotOptions.pie.startAngle%this.fullAngle,a.globals.radialSize=this.defaultSize/2.05-a.config.stroke.width-(a.config.chart.sparkline.enabled?0:a.config.chart.dropShadow.blur),this.donutSize=a.globals.radialSize*parseInt(a.config.plotOptions.pie.donut.size,10)/100;var c=a.config.plotOptions.pie.customScale,f=a.globals.gridWidth/2,_=a.globals.gridHeight/2;this.translateX=f-f*c,this.translateY=_-_*c,this.dataLabelsGroup=new Nt(this.ctx).group({class:"apexcharts-datalabels-group",transform:"translate(".concat(this.translateX,", ").concat(this.translateY,") scale(").concat(c,")")}),this.maxY=0,this.sliceLabels=[],this.sliceSizes=[],this.prevSectorAngleArr=[]}return gi(S,[{key:"draw",value:function(t){var a=this,c=this.w,f=new Nt(this.ctx),_=f.group({class:"apexcharts-pie"});if(c.globals.noData)return _;for(var v=0,r=0;r<t.length;r++)v+=et.negToZero(t[r]);var E=[],k=f.group();v===0&&(v=1e-5),t.forEach(function(ue){a.maxY=Math.max(a.maxY,ue)}),c.config.yaxis[0].max&&(this.maxY=c.config.yaxis[0].max),c.config.grid.position==="back"&&this.chartType==="polarArea"&&this.drawPolarElements(_);for(var P=0;P<t.length;P++){var L=this.fullAngle*et.negToZero(t[P])/v;E.push(L),this.chartType==="polarArea"?(E[P]=this.fullAngle/t.length,this.sliceSizes.push(c.globals.radialSize*t[P]/this.maxY)):this.sliceSizes.push(c.globals.radialSize)}if(c.globals.dataChanged){for(var O,N=0,G=0;G<c.globals.previousPaths.length;G++)N+=et.negToZero(c.globals.previousPaths[G]);for(var H=0;H<c.globals.previousPaths.length;H++)O=this.fullAngle*et.negToZero(c.globals.previousPaths[H])/N,this.prevSectorAngleArr.push(O)}if(this.donutSize<0&&(this.donutSize=0),this.chartType==="donut"){var Q=f.drawCircle(this.donutSize);Q.attr({cx:this.centerX,cy:this.centerY,fill:c.config.plotOptions.pie.donut.background?c.config.plotOptions.pie.donut.background:"transparent"}),k.add(Q)}var ee=this.drawArcs(E,t);if(this.sliceLabels.forEach(function(ue){ee.add(ue)}),k.attr({transform:"translate(".concat(this.translateX,", ").concat(this.translateY,") scale(").concat(c.config.plotOptions.pie.customScale,")")}),k.add(ee),_.add(k),this.donutDataLabels.show){var ie=this.renderInnerDataLabels(this.dataLabelsGroup,this.donutDataLabels,{hollowSize:this.donutSize,centerX:this.centerX,centerY:this.centerY,opacity:this.donutDataLabels.show});_.add(ie)}return c.config.grid.position==="front"&&this.chartType==="polarArea"&&this.drawPolarElements(_),_}},{key:"drawArcs",value:function(t,a){var c=this.w,f=new rn(this.ctx),_=new Nt(this.ctx),v=new Da(this.ctx),r=_.group({class:"apexcharts-slices"}),E=this.initialAngle,k=this.initialAngle,P=this.initialAngle,L=this.initialAngle;this.strokeWidth=c.config.stroke.show?c.config.stroke.width:0;for(var O=0;O<t.length;O++){var N=_.group({class:"apexcharts-series apexcharts-pie-series",seriesName:et.escapeString(c.globals.seriesNames[O]),rel:O+1,"data:realIndex":O});r.add(N),k=L,P=(E=P)+t[O],L=k+this.prevSectorAngleArr[O];var G=P<E?this.fullAngle+P-E:P-E,H=v.fillPath({seriesNumber:O,size:this.sliceSizes[O],value:a[O]}),Q=this.getChangedPath(k,L),ee=_.drawPath({d:Q,stroke:Array.isArray(this.lineColorArr)?this.lineColorArr[O]:this.lineColorArr,strokeWidth:0,fill:H,fillOpacity:c.config.fill.opacity,classes:"apexcharts-pie-area apexcharts-".concat(this.chartType.toLowerCase(),"-slice-").concat(O)});if(ee.attr({index:0,j:O}),f.setSelectionFilter(ee,0,O),c.config.chart.dropShadow.enabled){var ie=c.config.chart.dropShadow;f.dropShadow(ee,ie,O)}this.addListeners(ee,this.donutDataLabels),Nt.setAttrs(ee.node,{"data:angle":G,"data:startAngle":E,"data:strokeWidth":this.strokeWidth,"data:value":a[O]});var ue={x:0,y:0};this.chartType==="pie"||this.chartType==="polarArea"?ue=et.polarToCartesian(this.centerX,this.centerY,c.globals.radialSize/1.25+c.config.plotOptions.pie.dataLabels.offset,(E+G/2)%this.fullAngle):this.chartType==="donut"&&(ue=et.polarToCartesian(this.centerX,this.centerY,(c.globals.radialSize+this.donutSize)/2+c.config.plotOptions.pie.dataLabels.offset,(E+G/2)%this.fullAngle)),N.add(ee);var ve=0;if(!this.initialAnim||c.globals.resized||c.globals.dataChanged?this.animBeginArr.push(0):((ve=G/this.fullAngle*c.config.chart.animations.speed)===0&&(ve=1),this.animDur=ve+this.animDur,this.animBeginArr.push(this.animDur)),this.dynamicAnim&&c.globals.dataChanged?this.animatePaths(ee,{size:this.sliceSizes[O],endAngle:P,startAngle:E,prevStartAngle:k,prevEndAngle:L,animateStartingPos:!0,i:O,animBeginArr:this.animBeginArr,shouldSetPrevPaths:!0,dur:c.config.chart.animations.dynamicAnimation.speed}):this.animatePaths(ee,{size:this.sliceSizes[O],endAngle:P,startAngle:E,i:O,totalItems:t.length-1,animBeginArr:this.animBeginArr,dur:ve}),c.config.plotOptions.pie.expandOnClick&&this.chartType!=="polarArea"&&ee.node.addEventListener("mouseup",this.pieClicked.bind(this,O)),c.globals.selectedDataPoints[0]!==void 0&&c.globals.selectedDataPoints[0].indexOf(O)>-1&&this.pieClicked(O),c.config.dataLabels.enabled){var ce=ue.x,Te=ue.y,Se=100*G/this.fullAngle+"%";if(G!==0&&c.config.plotOptions.pie.dataLabels.minAngleToShowLabel<t[O]){var Ie=c.config.dataLabels.formatter;Ie!==void 0&&(Se=Ie(c.globals.seriesPercent[O][0],{seriesIndex:O,w:c}));var Ue=c.globals.dataLabels.style.colors[O],Ke=_.group({class:"apexcharts-datalabels"}),qe=_.drawText({x:ce,y:Te,text:Se,textAnchor:"middle",fontSize:c.config.dataLabels.style.fontSize,fontFamily:c.config.dataLabels.style.fontFamily,fontWeight:c.config.dataLabels.style.fontWeight,foreColor:Ue});if(Ke.add(qe),c.config.dataLabels.dropShadow.enabled){var ft=c.config.dataLabels.dropShadow;f.dropShadow(qe,ft)}qe.node.classList.add("apexcharts-pie-label"),c.config.chart.animations.animate&&c.globals.resized===!1&&(qe.node.classList.add("apexcharts-pie-label-delay"),qe.node.style.animationDelay=c.config.chart.animations.speed/940+"s"),this.sliceLabels.push(Ke)}}}return r}},{key:"addListeners",value:function(t,a){var c=new Nt(this.ctx);t.node.addEventListener("mouseenter",c.pathMouseEnter.bind(this,t)),t.node.addEventListener("mouseleave",c.pathMouseLeave.bind(this,t)),t.node.addEventListener("mouseleave",this.revertDataLabelsInner.bind(this,t.node,a)),t.node.addEventListener("mousedown",c.pathMouseDown.bind(this,t)),this.donutDataLabels.total.showAlways||(t.node.addEventListener("mouseenter",this.printDataLabelsInner.bind(this,t.node,a)),t.node.addEventListener("mousedown",this.printDataLabelsInner.bind(this,t.node,a)))}},{key:"animatePaths",value:function(t,a){var c=this.w,f=a.endAngle<a.startAngle?this.fullAngle+a.endAngle-a.startAngle:a.endAngle-a.startAngle,_=f,v=a.startAngle,r=a.startAngle;a.prevStartAngle!==void 0&&a.prevEndAngle!==void 0&&(v=a.prevEndAngle,_=a.prevEndAngle<a.prevStartAngle?this.fullAngle+a.prevEndAngle-a.prevStartAngle:a.prevEndAngle-a.prevStartAngle),a.i===c.config.series.length-1&&(f+r>this.fullAngle?a.endAngle=a.endAngle-(f+r):f+r<this.fullAngle&&(a.endAngle=a.endAngle+(this.fullAngle-(f+r)))),f===this.fullAngle&&(f=this.fullAngle-.01),this.animateArc(t,v,r,f,_,a)}},{key:"animateArc",value:function(t,a,c,f,_,v){var r,E=this,k=this.w,P=new Nu(this.ctx),L=v.size;(isNaN(a)||isNaN(_))&&(a=c,_=f,v.dur=0);var O=f,N=c,G=a<c?this.fullAngle+a-c:a-c;k.globals.dataChanged&&v.shouldSetPrevPaths&&v.prevEndAngle&&(r=E.getPiePath({me:E,startAngle:v.prevStartAngle,angle:v.prevEndAngle<v.prevStartAngle?this.fullAngle+v.prevEndAngle-v.prevStartAngle:v.prevEndAngle-v.prevStartAngle,size:L}),t.attr({d:r})),v.dur!==0?t.animate(v.dur,v.animBeginArr[v.i]).after(function(){E.chartType!=="pie"&&E.chartType!=="donut"&&E.chartType!=="polarArea"||this.animate(k.config.chart.animations.dynamicAnimation.speed).attr({"stroke-width":E.strokeWidth}),v.i===k.config.series.length-1&&P.animationCompleted(t)}).during(function(H){O=G+(f-G)*H,v.animateStartingPos&&(O=_+(f-_)*H,N=a-_+(c-(a-_))*H),r=E.getPiePath({me:E,startAngle:N,angle:O,size:L}),t.node.setAttribute("data:pathOrig",r),t.attr({d:r})}):(r=E.getPiePath({me:E,startAngle:N,angle:f,size:L}),v.isTrack||(k.globals.animationEnded=!0),t.node.setAttribute("data:pathOrig",r),t.attr({d:r,"stroke-width":E.strokeWidth}))}},{key:"pieClicked",value:function(t){var a,c=this.w,f=this,_=f.sliceSizes[t]+(c.config.plotOptions.pie.expandOnClick?4:0),v=c.globals.dom.Paper.findOne(".apexcharts-".concat(f.chartType.toLowerCase(),"-slice-").concat(t));if(v.attr("data:pieClicked")!=="true"){var r=c.globals.dom.baseEl.getElementsByClassName("apexcharts-pie-area");Array.prototype.forEach.call(r,function(L){L.setAttribute("data:pieClicked","false");var O=L.getAttribute("data:pathOrig");O&&L.setAttribute("d",O)}),c.globals.capturedDataPointIndex=t,v.attr("data:pieClicked","true");var E=parseInt(v.attr("data:startAngle"),10),k=parseInt(v.attr("data:angle"),10);a=f.getPiePath({me:f,startAngle:E,angle:k,size:_}),k!==360&&v.plot(a)}else{v.attr({"data:pieClicked":"false"}),this.revertDataLabelsInner(v.node,this.donutDataLabels);var P=v.attr("data:pathOrig");v.attr({d:P})}}},{key:"getChangedPath",value:function(t,a){var c="";return this.dynamicAnim&&this.w.globals.dataChanged&&(c=this.getPiePath({me:this,startAngle:t,angle:a-t,size:this.size})),c}},{key:"getPiePath",value:function(t){var a,c=t.me,f=t.startAngle,_=t.angle,v=t.size,r=new Nt(this.ctx),E=f,k=Math.PI*(E-90)/180,P=_+f;Math.ceil(P)>=this.fullAngle+this.w.config.plotOptions.pie.startAngle%this.fullAngle&&(P=this.fullAngle+this.w.config.plotOptions.pie.startAngle%this.fullAngle-.01),Math.ceil(P)>this.fullAngle&&(P-=this.fullAngle);var L=Math.PI*(P-90)/180,O=c.centerX+v*Math.cos(k),N=c.centerY+v*Math.sin(k),G=c.centerX+v*Math.cos(L),H=c.centerY+v*Math.sin(L),Q=et.polarToCartesian(c.centerX,c.centerY,c.donutSize,P),ee=et.polarToCartesian(c.centerX,c.centerY,c.donutSize,E),ie=_>180?1:0,ue=["M",O,N,"A",v,v,0,ie,1,G,H];return a=c.chartType==="donut"?[].concat(ue,["L",Q.x,Q.y,"A",c.donutSize,c.donutSize,0,ie,0,ee.x,ee.y,"L",O,N,"z"]).join(" "):c.chartType==="pie"||c.chartType==="polarArea"?[].concat(ue,["L",c.centerX,c.centerY,"L",O,N]).join(" "):[].concat(ue).join(" "),r.roundPathCorners(a,2*this.strokeWidth)}},{key:"drawPolarElements",value:function(t){var a=this.w,c=new I1(this.ctx),f=new Nt(this.ctx),_=new R1(this.ctx),v=f.group(),r=f.group(),E=c.niceScale(0,Math.ceil(this.maxY),0),k=E.result.reverse(),P=E.result.length;this.maxY=E.niceMax;for(var L=a.globals.radialSize,O=L/(P-1),N=0;N<P-1;N++){var G=f.drawCircle(L);if(G.attr({cx:this.centerX,cy:this.centerY,fill:"none","stroke-width":a.config.plotOptions.polarArea.rings.strokeWidth,stroke:a.config.plotOptions.polarArea.rings.strokeColor}),a.config.yaxis[0].show){var H=_.drawYAxisTexts(this.centerX,this.centerY-L+parseInt(a.config.yaxis[0].labels.style.fontSize,10)/2,N,k[N]);r.add(H)}v.add(G),L-=O}this.drawSpokes(t),t.add(v),t.add(r)}},{key:"renderInnerDataLabels",value:function(t,a,c){var f=this.w,_=new Nt(this.ctx),v=a.total.show;t.node.innerHTML="",t.node.style.opacity=c.opacity;var r,E,k=c.centerX,P=this.donutDataLabels.total.label?c.centerY:c.centerY-c.centerY/6;r=a.name.color===void 0?f.globals.colors[0]:a.name.color;var L=a.name.fontSize,O=a.name.fontFamily,N=a.name.fontWeight;E=a.value.color===void 0?f.config.chart.foreColor:a.value.color;var G=a.value.formatter,H="",Q="";if(v?(r=a.total.color,L=a.total.fontSize,O=a.total.fontFamily,N=a.total.fontWeight,Q=this.donutDataLabels.total.label?a.total.label:"",H=a.total.formatter(f)):f.globals.series.length===1&&(H=G(f.globals.series[0],f),Q=f.globals.seriesNames[0]),Q&&(Q=a.name.formatter(Q,a.total.show,f)),a.name.show){var ee=_.drawText({x:k,y:P+parseFloat(a.name.offsetY),text:Q,textAnchor:"middle",foreColor:r,fontSize:L,fontWeight:N,fontFamily:O});ee.node.classList.add("apexcharts-datalabel-label"),t.add(ee)}if(a.value.show){var ie=a.name.show?parseFloat(a.value.offsetY)+16:a.value.offsetY,ue=_.drawText({x:k,y:P+ie,text:H,textAnchor:"middle",foreColor:E,fontWeight:a.value.fontWeight,fontSize:a.value.fontSize,fontFamily:a.value.fontFamily});ue.node.classList.add("apexcharts-datalabel-value"),t.add(ue)}return t}},{key:"printInnerLabels",value:function(t,a,c,f){var _,v=this.w;f?_=t.name.color===void 0?v.globals.colors[parseInt(f.parentNode.getAttribute("rel"),10)-1]:t.name.color:v.globals.series.length>1&&t.total.show&&(_=t.total.color);var r=v.globals.dom.baseEl.querySelector(".apexcharts-datalabel-label"),E=v.globals.dom.baseEl.querySelector(".apexcharts-datalabel-value");c=(0,t.value.formatter)(c,v),f||typeof t.total.formatter!="function"||(c=t.total.formatter(v));var k=a===t.total.label;a=this.donutDataLabels.total.label?t.name.formatter(a,k,v):"",r!==null&&(r.textContent=a),E!==null&&(E.textContent=c),r!==null&&(r.style.fill=_)}},{key:"printDataLabelsInner",value:function(t,a){var c=this.w,f=t.getAttribute("data:value"),_=c.globals.seriesNames[parseInt(t.parentNode.getAttribute("rel"),10)-1];c.globals.series.length>1&&this.printInnerLabels(a,_,f,t);var v=c.globals.dom.baseEl.querySelector(".apexcharts-datalabels-group");v!==null&&(v.style.opacity=1)}},{key:"drawSpokes",value:function(t){var a=this,c=this.w,f=new Nt(this.ctx),_=c.config.plotOptions.polarArea.spokes;if(_.strokeWidth!==0){for(var v=[],r=360/c.globals.series.length,E=0;E<c.globals.series.length;E++)v.push(et.polarToCartesian(this.centerX,this.centerY,c.globals.radialSize,c.config.plotOptions.pie.startAngle+r*E));v.forEach(function(k,P){var L=f.drawLine(k.x,k.y,a.centerX,a.centerY,Array.isArray(_.connectorColors)?_.connectorColors[P]:_.connectorColors);t.add(L)})}}},{key:"revertDataLabelsInner",value:function(){var t=this.w;if(this.donutDataLabels.show){var a=t.globals.dom.Paper.findOne(".apexcharts-datalabels-group"),c=this.renderInnerDataLabels(a,this.donutDataLabels,{hollowSize:this.donutSize,centerX:this.centerX,centerY:this.centerY,opacity:this.donutDataLabels.show});t.globals.dom.Paper.findOne(".apexcharts-radialbar, .apexcharts-pie").add(c)}}}]),S}(),tC=function(){function S(t){pi(this,S),this.ctx=t,this.w=t.w,this.chartType=this.w.config.chart.type,this.initialAnim=this.w.config.chart.animations.enabled,this.dynamicAnim=this.initialAnim&&this.w.config.chart.animations.dynamicAnimation.enabled,this.animDur=0;var a=this.w;this.graphics=new Nt(this.ctx),this.lineColorArr=a.globals.stroke.colors!==void 0?a.globals.stroke.colors:a.globals.colors,this.defaultSize=a.globals.svgHeight<a.globals.svgWidth?a.globals.gridHeight:a.globals.gridWidth,this.isLog=a.config.yaxis[0].logarithmic,this.logBase=a.config.yaxis[0].logBase,this.coreUtils=new Is(this.ctx),this.maxValue=this.isLog?this.coreUtils.getLogVal(this.logBase,a.globals.maxY,0):a.globals.maxY,this.minValue=this.isLog?this.coreUtils.getLogVal(this.logBase,this.w.globals.minY,0):a.globals.minY,this.polygons=a.config.plotOptions.radar.polygons,this.strokeWidth=a.config.stroke.show?a.config.stroke.width:0,this.size=this.defaultSize/2.1-this.strokeWidth-a.config.chart.dropShadow.blur,a.config.xaxis.labels.show&&(this.size=this.size-a.globals.xAxisLabelsWidth/1.75),a.config.plotOptions.radar.size!==void 0&&(this.size=a.config.plotOptions.radar.size),this.dataRadiusOfPercent=[],this.dataRadius=[],this.angleArr=[],this.yaxisLabelsTextsPos=[]}return gi(S,[{key:"draw",value:function(t){var a=this,c=this.w,f=new Da(this.ctx),_=[],v=new Fu(this.ctx);t.length&&(this.dataPointsLen=t[c.globals.maxValsInArrayIndex].length),this.disAngle=2*Math.PI/this.dataPointsLen;var r=c.globals.gridWidth/2,E=c.globals.gridHeight/2,k=r+c.config.plotOptions.radar.offsetX,P=E+c.config.plotOptions.radar.offsetY,L=this.graphics.group({class:"apexcharts-radar-series apexcharts-plot-series",transform:"translate(".concat(k||0,", ").concat(P||0,")")}),O=[],N=null,G=null;if(this.yaxisLabels=this.graphics.group({class:"apexcharts-yaxis"}),t.forEach(function(Q,ee){var ie=Q.length===c.globals.dataPoints,ue=a.graphics.group().attr({class:"apexcharts-series","data:longestSeries":ie,seriesName:et.escapeString(c.globals.seriesNames[ee]),rel:ee+1,"data:realIndex":ee});a.dataRadiusOfPercent[ee]=[],a.dataRadius[ee]=[],a.angleArr[ee]=[],Q.forEach(function(bt,Tt){var Et=Math.abs(a.maxValue-a.minValue);bt-=a.minValue,a.isLog&&(bt=a.coreUtils.getLogVal(a.logBase,bt,0)),a.dataRadiusOfPercent[ee][Tt]=bt/Et,a.dataRadius[ee][Tt]=a.dataRadiusOfPercent[ee][Tt]*a.size,a.angleArr[ee][Tt]=Tt*a.disAngle}),O=a.getDataPointsPos(a.dataRadius[ee],a.angleArr[ee]);var ve=a.createPaths(O,{x:0,y:0});N=a.graphics.group({class:"apexcharts-series-markers-wrap apexcharts-element-hidden"}),G=a.graphics.group({class:"apexcharts-datalabels","data:realIndex":ee}),c.globals.delayedElements.push({el:N.node,index:ee});var ce={i:ee,realIndex:ee,animationDelay:ee,initialSpeed:c.config.chart.animations.speed,dataChangeSpeed:c.config.chart.animations.dynamicAnimation.speed,className:"apexcharts-radar",shouldClipToGrid:!1,bindEventsOnPaths:!1,stroke:c.globals.stroke.colors[ee],strokeLineCap:c.config.stroke.lineCap},Te=null;c.globals.previousPaths.length>0&&(Te=a.getPreviousPath(ee));for(var Se=0;Se<ve.linePathsTo.length;Se++){var Ie=a.graphics.renderPaths(Jt(Jt({},ce),{},{pathFrom:Te===null?ve.linePathsFrom[Se]:Te,pathTo:ve.linePathsTo[Se],strokeWidth:Array.isArray(a.strokeWidth)?a.strokeWidth[ee]:a.strokeWidth,fill:"none",drawShadow:!1}));ue.add(Ie);var Ue=f.fillPath({seriesNumber:ee}),Ke=a.graphics.renderPaths(Jt(Jt({},ce),{},{pathFrom:Te===null?ve.areaPathsFrom[Se]:Te,pathTo:ve.areaPathsTo[Se],strokeWidth:0,fill:Ue,drawShadow:!1}));if(c.config.chart.dropShadow.enabled){var qe=new rn(a.ctx),ft=c.config.chart.dropShadow;qe.dropShadow(Ke,Object.assign({},ft,{noUserSpaceOnUse:!0}),ee)}ue.add(Ke)}Q.forEach(function(bt,Tt){var Et=new Hu(a.ctx).getMarkerConfig({cssClass:"apexcharts-marker",seriesIndex:ee,dataPointIndex:Tt}),Lt=a.graphics.drawMarker(O[Tt].x,O[Tt].y,Et);Lt.attr("rel",Tt),Lt.attr("j",Tt),Lt.attr("index",ee),Lt.node.setAttribute("default-marker-size",Et.pSize);var qt=a.graphics.group({class:"apexcharts-series-markers"});qt&&qt.add(Lt),N.add(qt),ue.add(N);var ui=c.config.dataLabels;if(ui.enabled){var Ti=ui.formatter(c.globals.series[ee][Tt],{seriesIndex:ee,dataPointIndex:Tt,w:c});v.plotDataLabelsText({x:O[Tt].x,y:O[Tt].y,text:Ti,textAnchor:"middle",i:ee,j:ee,parent:G,offsetCorrection:!1,dataLabelsConfig:Jt({},ui)})}ue.add(G)}),_.push(ue)}),this.drawPolygons({parent:L}),c.config.xaxis.labels.show){var H=this.drawXAxisTexts();L.add(H)}return _.forEach(function(Q){L.add(Q)}),L.add(this.yaxisLabels),L}},{key:"drawPolygons",value:function(t){for(var a=this,c=this.w,f=t.parent,_=new R1(this.ctx),v=c.globals.yAxisScale[0].result.reverse(),r=v.length,E=[],k=this.size/(r-1),P=0;P<r;P++)E[P]=k*P;E.reverse();var L=[],O=[];E.forEach(function(N,G){var H=et.getPolygonPos(N,a.dataPointsLen),Q="";H.forEach(function(ee,ie){if(G===0){var ue=a.graphics.drawLine(ee.x,ee.y,0,0,Array.isArray(a.polygons.connectorColors)?a.polygons.connectorColors[ie]:a.polygons.connectorColors);O.push(ue)}ie===0&&a.yaxisLabelsTextsPos.push({x:ee.x,y:ee.y}),Q+=ee.x+","+ee.y+" "}),L.push(Q)}),L.forEach(function(N,G){var H=a.polygons.strokeColors,Q=a.polygons.strokeWidth,ee=a.graphics.drawPolygon(N,Array.isArray(H)?H[G]:H,Array.isArray(Q)?Q[G]:Q,c.globals.radarPolygons.fill.colors[G]);f.add(ee)}),O.forEach(function(N){f.add(N)}),c.config.yaxis[0].show&&this.yaxisLabelsTextsPos.forEach(function(N,G){var H=_.drawYAxisTexts(N.x,N.y,G,v[G]);a.yaxisLabels.add(H)})}},{key:"drawXAxisTexts",value:function(){var t=this,a=this.w,c=a.config.xaxis.labels,f=this.graphics.group({class:"apexcharts-xaxis"}),_=et.getPolygonPos(this.size,this.dataPointsLen);return a.globals.labels.forEach(function(v,r){var E=a.config.xaxis.labels.formatter,k=new Fu(t.ctx);if(_[r]){var P=t.getTextPos(_[r],t.size),L=E(v,{seriesIndex:-1,dataPointIndex:r,w:a});k.plotDataLabelsText({x:P.newX,y:P.newY,text:L,textAnchor:P.textAnchor,i:r,j:r,parent:f,className:"apexcharts-xaxis-label",color:Array.isArray(c.style.colors)&&c.style.colors[r]?c.style.colors[r]:"#a8a8a8",dataLabelsConfig:Jt({textAnchor:P.textAnchor,dropShadow:{enabled:!1}},c),offsetCorrection:!1}).on("click",function(O){if(typeof a.config.chart.events.xAxisLabelClick=="function"){var N=Object.assign({},a,{labelIndex:r});a.config.chart.events.xAxisLabelClick(O,t.ctx,N)}})}}),f}},{key:"createPaths",value:function(t,a){var c=this,f=[],_=[],v=[],r=[];if(t.length){_=[this.graphics.move(a.x,a.y)],r=[this.graphics.move(a.x,a.y)];var E=this.graphics.move(t[0].x,t[0].y),k=this.graphics.move(t[0].x,t[0].y);t.forEach(function(P,L){E+=c.graphics.line(P.x,P.y),k+=c.graphics.line(P.x,P.y),L===t.length-1&&(E+="Z",k+="Z")}),f.push(E),v.push(k)}return{linePathsFrom:_,linePathsTo:f,areaPathsFrom:r,areaPathsTo:v}}},{key:"getTextPos",value:function(t,a){var c="middle",f=t.x,_=t.y;return Math.abs(t.x)>=10?t.x>0?(c="start",f+=10):t.x<0&&(c="end",f-=10):c="middle",Math.abs(t.y)>=a-10&&(t.y<0?_-=10:t.y>0&&(_+=10)),{textAnchor:c,newX:f,newY:_}}},{key:"getPreviousPath",value:function(t){for(var a=this.w,c=null,f=0;f<a.globals.previousPaths.length;f++){var _=a.globals.previousPaths[f];_.paths.length>0&&parseInt(_.realIndex,10)===parseInt(t,10)&&a.globals.previousPaths[f].paths[0]!==void 0&&(c=a.globals.previousPaths[f].paths[0].d)}return c}},{key:"getDataPointsPos",value:function(t,a){var c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.dataPointsLen;t=t||[],a=a||[];for(var f=[],_=0;_<c;_++){var v={};v.x=t[_]*Math.sin(a[_]),v.y=-t[_]*Math.cos(a[_]),f.push(v)}return f}}]),S}(),iC=function(S){Jf(a,D1);var t=$f(a);function a(c){var f;pi(this,a),(f=t.call(this,c)).ctx=c,f.w=c.w,f.animBeginArr=[0],f.animDur=0;var _=f.w;return f.startAngle=_.config.plotOptions.radialBar.startAngle,f.endAngle=_.config.plotOptions.radialBar.endAngle,f.totalAngle=Math.abs(_.config.plotOptions.radialBar.endAngle-_.config.plotOptions.radialBar.startAngle),f.trackStartAngle=_.config.plotOptions.radialBar.track.startAngle,f.trackEndAngle=_.config.plotOptions.radialBar.track.endAngle,f.barLabels=f.w.config.plotOptions.radialBar.barLabels,f.donutDataLabels=f.w.config.plotOptions.radialBar.dataLabels,f.radialDataLabels=f.donutDataLabels,f.trackStartAngle||(f.trackStartAngle=f.startAngle),f.trackEndAngle||(f.trackEndAngle=f.endAngle),f.endAngle===360&&(f.endAngle=359.99),f.margin=parseInt(_.config.plotOptions.radialBar.track.margin,10),f.onBarLabelClick=f.onBarLabelClick.bind(Yw(f)),f}return gi(a,[{key:"draw",value:function(c){var f=this.w,_=new Nt(this.ctx),v=_.group({class:"apexcharts-radialbar"});if(f.globals.noData)return v;var r=_.group(),E=this.defaultSize/2,k=f.globals.gridWidth/2,P=this.defaultSize/2.05;f.config.chart.sparkline.enabled||(P=P-f.config.stroke.width-f.config.chart.dropShadow.blur);var L=f.globals.fill.colors;if(f.config.plotOptions.radialBar.track.show){var O=this.drawTracks({size:P,centerX:k,centerY:E,colorArr:L,series:c});r.add(O)}var N=this.drawArcs({size:P,centerX:k,centerY:E,colorArr:L,series:c}),G=360;f.config.plotOptions.radialBar.startAngle<0&&(G=this.totalAngle);var H=(360-G)/360;if(f.globals.radialSize=P-P*H,this.radialDataLabels.value.show){var Q=Math.max(this.radialDataLabels.value.offsetY,this.radialDataLabels.name.offsetY);f.globals.radialSize+=Q*H}return r.add(N.g),f.config.plotOptions.radialBar.hollow.position==="front"&&(N.g.add(N.elHollow),N.dataLabels&&N.g.add(N.dataLabels)),v.add(r),v}},{key:"drawTracks",value:function(c){var f=this.w,_=new Nt(this.ctx),v=_.group({class:"apexcharts-tracks"}),r=new rn(this.ctx),E=new Da(this.ctx),k=this.getStrokeWidth(c);c.size=c.size-k/2;for(var P=0;P<c.series.length;P++){var L=_.group({class:"apexcharts-radialbar-track apexcharts-track"});v.add(L),L.attr({rel:P+1}),c.size=c.size-k-this.margin;var O=f.config.plotOptions.radialBar.track,N=E.fillPath({seriesNumber:0,size:c.size,fillColors:Array.isArray(O.background)?O.background[P]:O.background,solid:!0}),G=this.trackStartAngle,H=this.trackEndAngle;Math.abs(H)+Math.abs(G)>=360&&(H=360-Math.abs(this.startAngle)-.1);var Q=_.drawPath({d:"",stroke:N,strokeWidth:k*parseInt(O.strokeWidth,10)/100,fill:"none",strokeOpacity:O.opacity,classes:"apexcharts-radialbar-area"});if(O.dropShadow.enabled){var ee=O.dropShadow;r.dropShadow(Q,ee)}L.add(Q),Q.attr("id","apexcharts-radialbarTrack-"+P),this.animatePaths(Q,{centerX:c.centerX,centerY:c.centerY,endAngle:H,startAngle:G,size:c.size,i:P,totalItems:2,animBeginArr:0,dur:0,isTrack:!0})}return v}},{key:"drawArcs",value:function(c){var f=this.w,_=new Nt(this.ctx),v=new Da(this.ctx),r=new rn(this.ctx),E=_.group(),k=this.getStrokeWidth(c);c.size=c.size-k/2;var P=f.config.plotOptions.radialBar.hollow.background,L=c.size-k*c.series.length-this.margin*c.series.length-k*parseInt(f.config.plotOptions.radialBar.track.strokeWidth,10)/100/2,O=L-f.config.plotOptions.radialBar.hollow.margin;f.config.plotOptions.radialBar.hollow.image!==void 0&&(P=this.drawHollowImage(c,E,L,P));var N=this.drawHollow({size:O,centerX:c.centerX,centerY:c.centerY,fill:P||"transparent"});if(f.config.plotOptions.radialBar.hollow.dropShadow.enabled){var G=f.config.plotOptions.radialBar.hollow.dropShadow;r.dropShadow(N,G)}var H=1;!this.radialDataLabels.total.show&&f.globals.series.length>1&&(H=0);var Q=null;if(this.radialDataLabels.show){var ee=f.globals.dom.Paper.findOne(".apexcharts-datalabels-group");Q=this.renderInnerDataLabels(ee,this.radialDataLabels,{hollowSize:L,centerX:c.centerX,centerY:c.centerY,opacity:H})}f.config.plotOptions.radialBar.hollow.position==="back"&&(E.add(N),Q&&E.add(Q));var ie=!1;f.config.plotOptions.radialBar.inverseOrder&&(ie=!0);for(var ue=ie?c.series.length-1:0;ie?ue>=0:ue<c.series.length;ie?ue--:ue++){var ve=_.group({class:"apexcharts-series apexcharts-radial-series",seriesName:et.escapeString(f.globals.seriesNames[ue])});E.add(ve),ve.attr({rel:ue+1,"data:realIndex":ue}),this.ctx.series.addCollapsedClassToSeries(ve,ue),c.size=c.size-k-this.margin;var ce=v.fillPath({seriesNumber:ue,size:c.size,value:c.series[ue]}),Te=this.startAngle,Se=void 0,Ie=et.negToZero(c.series[ue]>100?100:c.series[ue])/100,Ue=Math.round(this.totalAngle*Ie)+this.startAngle,Ke=void 0;f.globals.dataChanged&&(Se=this.startAngle,Ke=Math.round(this.totalAngle*et.negToZero(f.globals.previousPaths[ue])/100)+Se),Math.abs(Ue)+Math.abs(Te)>360&&(Ue-=.01),Math.abs(Ke)+Math.abs(Se)>360&&(Ke-=.01);var qe=Ue-Te,ft=Array.isArray(f.config.stroke.dashArray)?f.config.stroke.dashArray[ue]:f.config.stroke.dashArray,bt=_.drawPath({d:"",stroke:ce,strokeWidth:k,fill:"none",fillOpacity:f.config.fill.opacity,classes:"apexcharts-radialbar-area apexcharts-radialbar-slice-"+ue,strokeDashArray:ft});if(Nt.setAttrs(bt.node,{"data:angle":qe,"data:value":c.series[ue]}),f.config.chart.dropShadow.enabled){var Tt=f.config.chart.dropShadow;r.dropShadow(bt,Tt,ue)}if(r.setSelectionFilter(bt,0,ue),this.addListeners(bt,this.radialDataLabels),ve.add(bt),bt.attr({index:0,j:ue}),this.barLabels.enabled){var Et=et.polarToCartesian(c.centerX,c.centerY,c.size,Te),Lt=this.barLabels.formatter(f.globals.seriesNames[ue],{seriesIndex:ue,w:f}),qt=["apexcharts-radialbar-label"];this.barLabels.onClick||qt.push("apexcharts-no-click");var ui=this.barLabels.useSeriesColors?f.globals.colors[ue]:f.config.chart.foreColor;ui||(ui=f.config.chart.foreColor);var Ti=Et.x+this.barLabels.offsetX,vi=Et.y+this.barLabels.offsetY,Kt=_.drawText({x:Ti,y:vi,text:Lt,textAnchor:"end",dominantBaseline:"middle",fontFamily:this.barLabels.fontFamily,fontWeight:this.barLabels.fontWeight,fontSize:this.barLabels.fontSize,foreColor:ui,cssClass:qt.join(" ")});Kt.on("click",this.onBarLabelClick),Kt.attr({rel:ue+1}),Te!==0&&Kt.attr({"transform-origin":"".concat(Ti," ").concat(vi),transform:"rotate(".concat(Te," 0 0)")}),ve.add(Kt)}var Hi=0;!this.initialAnim||f.globals.resized||f.globals.dataChanged||(Hi=f.config.chart.animations.speed),f.globals.dataChanged&&(Hi=f.config.chart.animations.dynamicAnimation.speed),this.animDur=Hi/(1.2*c.series.length)+this.animDur,this.animBeginArr.push(this.animDur),this.animatePaths(bt,{centerX:c.centerX,centerY:c.centerY,endAngle:Ue,startAngle:Te,prevEndAngle:Ke,prevStartAngle:Se,size:c.size,i:ue,totalItems:2,animBeginArr:this.animBeginArr,dur:Hi,shouldSetPrevPaths:!0})}return{g:E,elHollow:N,dataLabels:Q}}},{key:"drawHollow",value:function(c){var f=new Nt(this.ctx).drawCircle(2*c.size);return f.attr({class:"apexcharts-radialbar-hollow",cx:c.centerX,cy:c.centerY,r:c.size,fill:c.fill}),f}},{key:"drawHollowImage",value:function(c,f,_,v){var r=this.w,E=new Da(this.ctx),k=et.randomId(),P=r.config.plotOptions.radialBar.hollow.image;if(r.config.plotOptions.radialBar.hollow.imageClipped)E.clippedImgArea({width:_,height:_,image:P,patternID:"pattern".concat(r.globals.cuid).concat(k)}),v="url(#pattern".concat(r.globals.cuid).concat(k,")");else{var L=r.config.plotOptions.radialBar.hollow.imageWidth,O=r.config.plotOptions.radialBar.hollow.imageHeight;if(L===void 0&&O===void 0){var N=r.globals.dom.Paper.image(P,function(H){this.move(c.centerX-H.width/2+r.config.plotOptions.radialBar.hollow.imageOffsetX,c.centerY-H.height/2+r.config.plotOptions.radialBar.hollow.imageOffsetY)});f.add(N)}else{var G=r.globals.dom.Paper.image(P,function(H){this.move(c.centerX-L/2+r.config.plotOptions.radialBar.hollow.imageOffsetX,c.centerY-O/2+r.config.plotOptions.radialBar.hollow.imageOffsetY),this.size(L,O)});f.add(G)}}return v}},{key:"getStrokeWidth",value:function(c){var f=this.w;return c.size*(100-parseInt(f.config.plotOptions.radialBar.hollow.size,10))/100/(c.series.length+1)-this.margin}},{key:"onBarLabelClick",value:function(c){var f=parseInt(c.target.getAttribute("rel"),10)-1,_=this.barLabels.onClick,v=this.w;_&&_(v.globals.seriesNames[f],{w:v,seriesIndex:f})}}]),a}(),rC=function(S){Jf(a,Bu);var t=$f(a);function a(){return pi(this,a),t.apply(this,arguments)}return gi(a,[{key:"draw",value:function(c,f){var _=this.w,v=new Nt(this.ctx);this.rangeBarOptions=this.w.config.plotOptions.rangeBar,this.series=c,this.seriesRangeStart=_.globals.seriesRangeStart,this.seriesRangeEnd=_.globals.seriesRangeEnd,this.barHelpers.initVariables(c);for(var r=v.group({class:"apexcharts-rangebar-series apexcharts-plot-series"}),E=0;E<c.length;E++){var k,P,L,O,N=void 0,G=void 0,H=_.globals.comboCharts?f[E]:E,Q=this.barHelpers.getGroupIndex(H).columnGroupIndex,ee=v.group({class:"apexcharts-series",seriesName:et.escapeString(_.globals.seriesNames[H]),rel:E+1,"data:realIndex":H});this.ctx.series.addCollapsedClassToSeries(ee,H),c[E].length>0&&(this.visibleI=this.visibleI+1);var ie=0,ue=0,ve=0;this.yRatio.length>1&&(this.yaxisIndex=_.globals.seriesYAxisReverseMap[H][0],ve=H);var ce=this.barHelpers.initialPositions(H);G=ce.y,O=ce.zeroW,N=ce.x,ue=ce.barWidth,ie=ce.barHeight,k=ce.xDivision,P=ce.yDivision,L=ce.zeroH;for(var Te=v.group({class:"apexcharts-datalabels","data:realIndex":H}),Se=v.group({class:"apexcharts-rangebar-goals-markers"}),Ie=0;Ie<_.globals.dataPoints;Ie++){var Ue=this.barHelpers.getStrokeWidth(E,Ie,H),Ke=this.seriesRangeStart[E][Ie],qe=this.seriesRangeEnd[E][Ie],ft=null,bt=null,Tt=null,Et={x:N,y:G,strokeWidth:Ue,elSeries:ee},Lt=this.seriesLen;if(_.config.plotOptions.bar.rangeBarGroupRows&&(Lt=1),_.config.series[E].data[Ie]===void 0)break;if(this.isHorizontal){Tt=G+ie*this.visibleI;var qt=(P-ie*Lt)/2;if(_.config.series[E].data[Ie].x){var ui=this.detectOverlappingBars({i:E,j:Ie,barYPosition:Tt,srty:qt,barHeight:ie,yDivision:P,initPositions:ce});ie=ui.barHeight,Tt=ui.barYPosition}ue=(ft=this.drawRangeBarPaths(Jt({indexes:{i:E,j:Ie,realIndex:H},barHeight:ie,barYPosition:Tt,zeroW:O,yDivision:P,y1:Ke,y2:qe},Et))).barWidth}else{_.globals.isXNumeric&&(N=(_.globals.seriesX[E][Ie]-_.globals.minX)/this.xRatio-ue/2),bt=N+ue*this.visibleI;var Ti=(k-ue*Lt)/2;if(_.config.series[E].data[Ie].x){var vi=this.detectOverlappingBars({i:E,j:Ie,barXPosition:bt,srtx:Ti,barWidth:ue,xDivision:k,initPositions:ce});ue=vi.barWidth,bt=vi.barXPosition}ie=(ft=this.drawRangeColumnPaths(Jt({indexes:{i:E,j:Ie,realIndex:H,translationsIndex:ve},barWidth:ue,barXPosition:bt,zeroH:L,xDivision:k},Et))).barHeight}var Kt=this.barHelpers.drawGoalLine({barXPosition:ft.barXPosition,barYPosition:Tt,goalX:ft.goalX,goalY:ft.goalY,barHeight:ie,barWidth:ue});Kt&&Se.add(Kt),G=ft.y,N=ft.x;var Hi=this.barHelpers.getPathFillColor(c,E,Ie,H);this.renderSeries({realIndex:H,pathFill:Hi.color,lineFill:Hi.useRangeColor?Hi.color:_.globals.stroke.colors[H],j:Ie,i:E,x:N,y:G,y1:Ke,y2:qe,pathFrom:ft.pathFrom,pathTo:ft.pathTo,strokeWidth:Ue,elSeries:ee,series:c,barHeight:ie,barWidth:ue,barXPosition:bt,barYPosition:Tt,columnGroupIndex:Q,elDataLabelsWrap:Te,elGoalsMarkers:Se,visibleSeries:this.visibleI,type:"rangebar"})}r.add(ee)}return r}},{key:"detectOverlappingBars",value:function(c){var f=c.i,_=c.j,v=c.barYPosition,r=c.barXPosition,E=c.srty,k=c.srtx,P=c.barHeight,L=c.barWidth,O=c.yDivision,N=c.xDivision,G=c.initPositions,H=this.w,Q=[],ee=H.config.series[f].data[_].rangeName,ie=H.config.series[f].data[_].x,ue=Array.isArray(ie)?ie.join(" "):ie,ve=H.globals.labels.map(function(Te){return Array.isArray(Te)?Te.join(" "):Te}).indexOf(ue),ce=H.globals.seriesRange[f].findIndex(function(Te){return Te.x===ue&&Te.overlaps.length>0});return this.isHorizontal?(v=H.config.plotOptions.bar.rangeBarGroupRows?E+O*ve:E+P*this.visibleI+O*ve,ce>-1&&!H.config.plotOptions.bar.rangeBarOverlap&&(Q=H.globals.seriesRange[f][ce].overlaps).indexOf(ee)>-1&&(v=(P=G.barHeight/Q.length)*this.visibleI+O*(100-parseInt(this.barOptions.barHeight,10))/100/2+P*(this.visibleI+Q.indexOf(ee))+O*ve)):(ve>-1&&!H.globals.timescaleLabels.length&&(r=H.config.plotOptions.bar.rangeBarGroupRows?k+N*ve:k+L*this.visibleI+N*ve),ce>-1&&!H.config.plotOptions.bar.rangeBarOverlap&&(Q=H.globals.seriesRange[f][ce].overlaps).indexOf(ee)>-1&&(r=(L=G.barWidth/Q.length)*this.visibleI+N*(100-parseInt(this.barOptions.barWidth,10))/100/2+L*(this.visibleI+Q.indexOf(ee))+N*ve)),{barYPosition:v,barXPosition:r,barHeight:P,barWidth:L}}},{key:"drawRangeColumnPaths",value:function(c){var f=c.indexes,_=c.x,v=c.xDivision,r=c.barWidth,E=c.barXPosition,k=c.zeroH,P=this.w,L=f.i,O=f.j,N=f.realIndex,G=f.translationsIndex,H=this.yRatio[G],Q=this.getRangeValue(N,O),ee=Math.min(Q.start,Q.end),ie=Math.max(Q.start,Q.end);this.series[L][O]===void 0||this.series[L][O]===null?ee=k:(ee=k-ee/H,ie=k-ie/H);var ue=Math.abs(ie-ee),ve=this.barHelpers.getColumnPaths({barXPosition:E,barWidth:r,y1:ee,y2:ie,strokeWidth:this.strokeWidth,series:this.seriesRangeEnd,realIndex:N,i:N,j:O,w:P});if(P.globals.isXNumeric){var ce=this.getBarXForNumericXAxis({x:_,j:O,realIndex:N,barWidth:r});_=ce.x,E=ce.barXPosition}else _+=v;return{pathTo:ve.pathTo,pathFrom:ve.pathFrom,barHeight:ue,x:_,y:Q.start<0&&Q.end<0?ee:ie,goalY:this.barHelpers.getGoalValues("y",null,k,L,O,G),barXPosition:E}}},{key:"preventBarOverflow",value:function(c){var f=this.w;return c<0&&(c=0),c>f.globals.gridWidth&&(c=f.globals.gridWidth),c}},{key:"drawRangeBarPaths",value:function(c){var f=c.indexes,_=c.y,v=c.y1,r=c.y2,E=c.yDivision,k=c.barHeight,P=c.barYPosition,L=c.zeroW,O=this.w,N=f.realIndex,G=f.j,H=this.preventBarOverflow(L+v/this.invertedYRatio),Q=this.preventBarOverflow(L+r/this.invertedYRatio),ee=this.getRangeValue(N,G),ie=Math.abs(Q-H),ue=this.barHelpers.getBarpaths({barYPosition:P,barHeight:k,x1:H,x2:Q,strokeWidth:this.strokeWidth,series:this.seriesRangeEnd,i:N,realIndex:N,j:G,w:O});return O.globals.isXNumeric||(_+=E),{pathTo:ue.pathTo,pathFrom:ue.pathFrom,barWidth:ie,x:ee.start<0&&ee.end<0?H:Q,goalX:this.barHelpers.getGoalValues("x",L,null,N,G),y:_}}},{key:"getRangeValue",value:function(c,f){var _=this.w;return{start:_.globals.seriesRangeStart[c][f],end:_.globals.seriesRangeEnd[c][f]}}}]),a}(),sC=function(){function S(t){pi(this,S),this.w=t.w,this.lineCtx=t}return gi(S,[{key:"sameValueSeriesFix",value:function(t,a){var c=this.w;if((c.config.fill.type==="gradient"||c.config.fill.type[t]==="gradient")&&new Is(this.lineCtx.ctx,c).seriesHaveSameValues(t)){var f=a[t].slice();f[f.length-1]=f[f.length-1]+1e-6,a[t]=f}return a}},{key:"calculatePoints",value:function(t){var a=t.series,c=t.realIndex,f=t.x,_=t.y,v=t.i,r=t.j,E=t.prevY,k=this.w,P=[],L=[],O=this.lineCtx.categoryAxisCorrection+k.config.markers.offsetX;return k.globals.isXNumeric&&(O=(k.globals.seriesX[c][0]-k.globals.minX)/this.lineCtx.xRatio+k.config.markers.offsetX),r===0&&(P.push(O),L.push(et.isNumber(a[v][0])?E+k.config.markers.offsetY:null)),P.push(f+k.config.markers.offsetX),L.push(et.isNumber(a[v][r+1])?_+k.config.markers.offsetY:null),{x:P,y:L}}},{key:"checkPreviousPaths",value:function(t){for(var a=t.pathFromLine,c=t.pathFromArea,f=t.realIndex,_=this.w,v=0;v<_.globals.previousPaths.length;v++){var r=_.globals.previousPaths[v];(r.type==="line"||r.type==="area")&&r.paths.length>0&&parseInt(r.realIndex,10)===parseInt(f,10)&&(r.type==="line"?(this.lineCtx.appendPathFrom=!1,a=_.globals.previousPaths[v].paths[0].d):r.type==="area"&&(this.lineCtx.appendPathFrom=!1,c=_.globals.previousPaths[v].paths[0].d,_.config.stroke.show&&_.globals.previousPaths[v].paths[1]&&(a=_.globals.previousPaths[v].paths[1].d)))}return{pathFromLine:a,pathFromArea:c}}},{key:"determineFirstPrevY",value:function(t){var a,c,f,_=t.i,v=t.realIndex,r=t.series,E=t.prevY,k=t.lineYPosition,P=t.translationsIndex,L=this.w,O=L.config.chart.stacked&&!L.globals.comboCharts||L.config.chart.stacked&&L.globals.comboCharts&&(!this.w.config.chart.stackOnlyBar||((a=this.w.config.series[v])===null||a===void 0?void 0:a.type)==="bar"||((c=this.w.config.series[v])===null||c===void 0?void 0:c.type)==="column");if(((f=r[_])===null||f===void 0?void 0:f[0])!==void 0)E=(k=O&&_>0?this.lineCtx.prevSeriesY[_-1][0]:this.lineCtx.zeroY)-r[_][0]/this.lineCtx.yRatio[P]+2*(this.lineCtx.isReversed?r[_][0]/this.lineCtx.yRatio[P]:0);else if(O&&_>0&&r[_][0]===void 0){for(var N=_-1;N>=0;N--)if(r[N][0]!==null&&r[N][0]!==void 0){E=k=this.lineCtx.prevSeriesY[N][0];break}}return{prevY:E,lineYPosition:k}}}]),S}(),nC=function(S){for(var t,a,c,f,_=function(P){for(var L=[],O=P[0],N=P[1],G=L[0]=Py(O,N),H=1,Q=P.length-1;H<Q;H++)O=N,N=P[H+1],L[H]=.5*(G+(G=Py(O,N)));return L[H]=G,L}(S),v=S.length-1,r=[],E=0;E<v;E++)c=Py(S[E],S[E+1]),Math.abs(c)<1e-6?_[E]=_[E+1]=0:(f=(t=_[E]/c)*t+(a=_[E+1]/c)*a)>9&&(f=3*c/Math.sqrt(f),_[E]=f*t,_[E+1]=f*a);for(var k=0;k<=v;k++)f=(S[Math.min(v,k+1)][0]-S[Math.max(0,k-1)][0])/(6*(1+_[k]*_[k])),r.push([f||0,_[k]*f||0]);return r},aC=function(S){var t=nC(S),a=S[1],c=S[0],f=[],_=t[1],v=t[0];f.push(c,[c[0]+v[0],c[1]+v[1],a[0]-_[0],a[1]-_[1],a[0],a[1]]);for(var r=2,E=t.length;r<E;r++){var k=S[r],P=t[r];f.push([k[0]-P[0],k[1]-P[1],k[0],k[1]])}return f},oC=function(S,t,a){var c=S.slice(t,a);if(t){if(a-t>1&&c[1].length<6){var f=c[0].length;c[1]=[2*c[0][f-2]-c[0][f-4],2*c[0][f-1]-c[0][f-3]].concat(c[1])}c[0]=c[0].slice(-2)}return c};function Py(S,t){return(t[1]-S[1])/(t[0]-S[0])}var Ly=function(){function S(t,a,c){pi(this,S),this.ctx=t,this.w=t.w,this.xyRatios=a,this.pointsChart=!(this.w.config.chart.type!=="bubble"&&this.w.config.chart.type!=="scatter")||c,this.scatter=new T1(this.ctx),this.noNegatives=this.w.globals.minX===Number.MAX_VALUE,this.lineHelpers=new sC(this),this.markers=new Hu(this.ctx),this.prevSeriesY=[],this.categoryAxisCorrection=0,this.yaxisIndex=0}return gi(S,[{key:"draw",value:function(t,a,c,f){var _,v=this.w,r=new Nt(this.ctx),E=v.globals.comboCharts?a:v.config.chart.type,k=r.group({class:"apexcharts-".concat(E,"-series apexcharts-plot-series")}),P=new Is(this.ctx,v);this.yRatio=this.xyRatios.yRatio,this.zRatio=this.xyRatios.zRatio,this.xRatio=this.xyRatios.xRatio,this.baseLineY=this.xyRatios.baseLineY,t=P.getLogSeries(t),this.yRatio=P.getLogYRatios(this.yRatio),this.prevSeriesY=[];for(var L=[],O=0;O<t.length;O++){t=this.lineHelpers.sameValueSeriesFix(O,t);var N=v.globals.comboCharts?c[O]:O,G=this.yRatio.length>1?N:0;this._initSerieVariables(t,O,N);var H=[],Q=[],ee=[],ie=v.globals.padHorizontal+this.categoryAxisCorrection;this.ctx.series.addCollapsedClassToSeries(this.elSeries,N),v.globals.isXNumeric&&v.globals.seriesX.length>0&&(ie=(v.globals.seriesX[N][0]-v.globals.minX)/this.xRatio),ee.push(ie);var ue,ve=ie,ce=void 0,Te=ve,Se=this.zeroY,Ie=this.zeroY;Se=this.lineHelpers.determineFirstPrevY({i:O,realIndex:N,series:t,prevY:Se,lineYPosition:0,translationsIndex:G}).prevY,v.config.stroke.curve==="monotoneCubic"&&t[O][0]===null?H.push(null):H.push(Se),ue=Se,E==="rangeArea"&&(ce=Ie=this.lineHelpers.determineFirstPrevY({i:O,realIndex:N,series:f,prevY:Ie,lineYPosition:0,translationsIndex:G}).prevY,Q.push(H[0]!==null?Ie:null));var Ue=this._calculatePathsFrom({type:E,series:t,i:O,realIndex:N,translationsIndex:G,prevX:Te,prevY:Se,prevY2:Ie}),Ke=[H[0]],qe=[Q[0]],ft={type:E,series:t,realIndex:N,translationsIndex:G,i:O,x:ie,y:1,pX:ve,pY:ue,pathsFrom:Ue,linePaths:[],areaPaths:[],seriesIndex:c,lineYPosition:0,xArrj:ee,yArrj:H,y2Arrj:Q,seriesRangeEnd:f},bt=this._iterateOverDataPoints(Jt(Jt({},ft),{},{iterations:E==="rangeArea"?t[O].length-1:void 0,isRangeStart:!0}));if(E==="rangeArea"){for(var Tt=this._calculatePathsFrom({series:f,i:O,realIndex:N,prevX:Te,prevY:Ie}),Et=this._iterateOverDataPoints(Jt(Jt({},ft),{},{series:f,xArrj:[ie],yArrj:Ke,y2Arrj:qe,pY:ce,areaPaths:bt.areaPaths,pathsFrom:Tt,iterations:f[O].length-1,isRangeStart:!1})),Lt=bt.linePaths.length/2,qt=0;qt<Lt;qt++)bt.linePaths[qt]=Et.linePaths[qt+Lt]+bt.linePaths[qt];bt.linePaths.splice(Lt),bt.pathFromLine=Et.pathFromLine+bt.pathFromLine}else bt.pathFromArea+="z";this._handlePaths({type:E,realIndex:N,i:O,paths:bt}),this.elSeries.add(this.elPointsMain),this.elSeries.add(this.elDataLabelsWrap),L.push(this.elSeries)}if(((_=v.config.series[0])===null||_===void 0?void 0:_.zIndex)!==void 0&&L.sort(function(vi,Kt){return Number(vi.node.getAttribute("zIndex"))-Number(Kt.node.getAttribute("zIndex"))}),v.config.chart.stacked)for(var ui=L.length-1;ui>=0;ui--)k.add(L[ui]);else for(var Ti=0;Ti<L.length;Ti++)k.add(L[Ti]);return k}},{key:"_initSerieVariables",value:function(t,a,c){var f=this.w,_=new Nt(this.ctx);this.xDivision=f.globals.gridWidth/(f.globals.dataPoints-(f.config.xaxis.tickPlacement==="on"?1:0)),this.strokeWidth=Array.isArray(f.config.stroke.width)?f.config.stroke.width[c]:f.config.stroke.width;var v=0;if(this.yRatio.length>1&&(this.yaxisIndex=f.globals.seriesYAxisReverseMap[c],v=c),this.isReversed=f.config.yaxis[this.yaxisIndex]&&f.config.yaxis[this.yaxisIndex].reversed,this.zeroY=f.globals.gridHeight-this.baseLineY[v]-(this.isReversed?f.globals.gridHeight:0)+(this.isReversed?2*this.baseLineY[v]:0),this.areaBottomY=this.zeroY,(this.zeroY>f.globals.gridHeight||f.config.plotOptions.area.fillTo==="end")&&(this.areaBottomY=f.globals.gridHeight),this.categoryAxisCorrection=this.xDivision/2,this.elSeries=_.group({class:"apexcharts-series",zIndex:f.config.series[c].zIndex!==void 0?f.config.series[c].zIndex:c,seriesName:et.escapeString(f.globals.seriesNames[c])}),this.elPointsMain=_.group({class:"apexcharts-series-markers-wrap","data:realIndex":c}),f.globals.hasNullValues){var r=this.markers.plotChartMarkers({pointsPos:{x:[0],y:[f.globals.gridHeight+f.globals.markers.largestSize]},seriesIndex:a,j:0,pSize:.1,alwaysDrawMarker:!0,isVirtualPoint:!0});r!==null&&this.elPointsMain.add(r)}this.elDataLabelsWrap=_.group({class:"apexcharts-datalabels","data:realIndex":c});var E=t[a].length===f.globals.dataPoints;this.elSeries.attr({"data:longestSeries":E,rel:a+1,"data:realIndex":c}),this.appendPathFrom=!0}},{key:"_calculatePathsFrom",value:function(t){var a,c,f,_,v=t.type,r=t.series,E=t.i,k=t.realIndex,P=t.translationsIndex,L=t.prevX,O=t.prevY,N=t.prevY2,G=this.w,H=new Nt(this.ctx);if(r[E][0]===null){for(var Q=0;Q<r[E].length;Q++)if(r[E][Q]!==null){L=this.xDivision*Q,O=this.zeroY-r[E][Q]/this.yRatio[P],a=H.move(L,O),c=H.move(L,this.areaBottomY);break}}else a=H.move(L,O),v==="rangeArea"&&(a=H.move(L,N)+H.line(L,O)),c=H.move(L,this.areaBottomY)+H.line(L,O);if(f=H.move(0,this.areaBottomY)+H.line(0,this.areaBottomY),_=H.move(0,this.areaBottomY)+H.line(0,this.areaBottomY),G.globals.previousPaths.length>0){var ee=this.lineHelpers.checkPreviousPaths({pathFromLine:f,pathFromArea:_,realIndex:k});f=ee.pathFromLine,_=ee.pathFromArea}return{prevX:L,prevY:O,linePath:a,areaPath:c,pathFromLine:f,pathFromArea:_}}},{key:"_handlePaths",value:function(t){var a=t.type,c=t.realIndex,f=t.i,_=t.paths,v=this.w,r=new Nt(this.ctx),E=new Da(this.ctx);this.prevSeriesY.push(_.yArrj),v.globals.seriesXvalues[c]=_.xArrj,v.globals.seriesYvalues[c]=_.yArrj;var k=v.config.forecastDataPoints;if(k.count>0&&a!=="rangeArea"){var P=v.globals.seriesXvalues[c][v.globals.seriesXvalues[c].length-k.count-1],L=r.drawRect(P,0,v.globals.gridWidth,v.globals.gridHeight,0);v.globals.dom.elForecastMask.appendChild(L.node);var O=r.drawRect(0,0,P,v.globals.gridHeight,0);v.globals.dom.elNonForecastMask.appendChild(O.node)}this.pointsChart||v.globals.delayedElements.push({el:this.elPointsMain.node,index:c});var N={i:f,realIndex:c,animationDelay:f,initialSpeed:v.config.chart.animations.speed,dataChangeSpeed:v.config.chart.animations.dynamicAnimation.speed,className:"apexcharts-".concat(a)};if(a==="area")for(var G=E.fillPath({seriesNumber:c}),H=0;H<_.areaPaths.length;H++){var Q=r.renderPaths(Jt(Jt({},N),{},{pathFrom:_.pathFromArea,pathTo:_.areaPaths[H],stroke:"none",strokeWidth:0,strokeLineCap:null,fill:G}));this.elSeries.add(Q)}if(v.config.stroke.show&&!this.pointsChart){var ee=null;if(a==="line")ee=E.fillPath({seriesNumber:c,i:f});else if(v.config.stroke.fill.type==="solid")ee=v.globals.stroke.colors[c];else{var ie=v.config.fill;v.config.fill=v.config.stroke.fill,ee=E.fillPath({seriesNumber:c,i:f}),v.config.fill=ie}for(var ue=0;ue<_.linePaths.length;ue++){var ve=ee;a==="rangeArea"&&(ve=E.fillPath({seriesNumber:c}));var ce=Jt(Jt({},N),{},{pathFrom:_.pathFromLine,pathTo:_.linePaths[ue],stroke:ee,strokeWidth:this.strokeWidth,strokeLineCap:v.config.stroke.lineCap,fill:a==="rangeArea"?ve:"none"}),Te=r.renderPaths(ce);if(this.elSeries.add(Te),Te.attr("fill-rule","evenodd"),k.count>0&&a!=="rangeArea"){var Se=r.renderPaths(ce);Se.node.setAttribute("stroke-dasharray",k.dashArray),k.strokeWidth&&Se.node.setAttribute("stroke-width",k.strokeWidth),this.elSeries.add(Se),Se.attr("clip-path","url(#forecastMask".concat(v.globals.cuid,")")),Te.attr("clip-path","url(#nonForecastMask".concat(v.globals.cuid,")"))}}}}},{key:"_iterateOverDataPoints",value:function(t){var a,c,f=this,_=t.type,v=t.series,r=t.iterations,E=t.realIndex,k=t.translationsIndex,P=t.i,L=t.x,O=t.y,N=t.pX,G=t.pY,H=t.pathsFrom,Q=t.linePaths,ee=t.areaPaths,ie=t.seriesIndex,ue=t.lineYPosition,ve=t.xArrj,ce=t.yArrj,Te=t.y2Arrj,Se=t.isRangeStart,Ie=t.seriesRangeEnd,Ue=this.w,Ke=new Nt(this.ctx),qe=this.yRatio,ft=H.prevY,bt=H.linePath,Tt=H.areaPath,Et=H.pathFromLine,Lt=H.pathFromArea,qt=et.isNumber(Ue.globals.minYArr[E])?Ue.globals.minYArr[E]:Ue.globals.minY;r||(r=Ue.globals.dataPoints>1?Ue.globals.dataPoints-1:Ue.globals.dataPoints);var ui=function(mr,Wi){return Wi-mr/qe[k]+2*(f.isReversed?mr/qe[k]:0)},Ti=O,vi=Ue.config.chart.stacked&&!Ue.globals.comboCharts||Ue.config.chart.stacked&&Ue.globals.comboCharts&&(!this.w.config.chart.stackOnlyBar||((a=this.w.config.series[E])===null||a===void 0?void 0:a.type)==="bar"||((c=this.w.config.series[E])===null||c===void 0?void 0:c.type)==="column"),Kt=Ue.config.stroke.curve;Array.isArray(Kt)&&(Kt=Array.isArray(ie)?Kt[ie[P]]:Kt[P]);for(var Hi,Br=0,ar=0;ar<r&&v[P].length!==0;ar++){var Xr=v[P][ar+1]===void 0||v[P][ar+1]===null;if(Ue.globals.isXNumeric){var mi=Ue.globals.seriesX[E][ar+1];Ue.globals.seriesX[E][ar+1]===void 0&&(mi=Ue.globals.seriesX[E][r-1]),L=(mi-Ue.globals.minX)/this.xRatio}else L+=this.xDivision;vi?P>0&&Ue.globals.collapsedSeries.length<Ue.config.series.length-1?ue=this.prevSeriesY[function(mr){for(var Wi=mr;Wi>0;Wi--){if(!(Ue.globals.collapsedSeriesIndices.indexOf((ie==null?void 0:ie[Wi])||Wi)>-1))return Wi;Wi--}return 0}(P-1)][ar+1]:ue=this.zeroY:ue=this.zeroY,Xr?O=ui(qt,ue):(O=ui(v[P][ar+1],ue),_==="rangeArea"&&(Ti=ui(Ie[P][ar+1],ue))),ve.push(v[P][ar+1]===null?null:L),!Xr||Ue.config.stroke.curve!=="smooth"&&Ue.config.stroke.curve!=="monotoneCubic"?(ce.push(O),Te.push(Ti)):(ce.push(null),Te.push(null));var Ci=this.lineHelpers.calculatePoints({series:v,x:L,y:O,realIndex:E,i:P,j:ar,prevY:ft}),zi=this._createPaths({type:_,series:v,i:P,realIndex:E,j:ar,x:L,y:O,y2:Ti,xArrj:ve,yArrj:ce,y2Arrj:Te,pX:N,pY:G,pathState:Br,segmentStartX:Hi,linePath:bt,areaPath:Tt,linePaths:Q,areaPaths:ee,curve:Kt,isRangeStart:Se});ee=zi.areaPaths,Q=zi.linePaths,N=zi.pX,G=zi.pY,Br=zi.pathState,Hi=zi.segmentStartX,Tt=zi.areaPath,bt=zi.linePath,!this.appendPathFrom||Ue.globals.hasNullValues||Kt==="monotoneCubic"&&_==="rangeArea"||(Et+=Ke.line(L,this.areaBottomY),Lt+=Ke.line(L,this.areaBottomY)),this.handleNullDataPoints(v,Ci,P,ar,E),this._handleMarkersAndLabels({type:_,pointsPos:Ci,i:P,j:ar,realIndex:E,isRangeStart:Se})}return{yArrj:ce,xArrj:ve,pathFromArea:Lt,areaPaths:ee,pathFromLine:Et,linePaths:Q,linePath:bt,areaPath:Tt}}},{key:"_handleMarkersAndLabels",value:function(t){var a=t.type,c=t.pointsPos,f=t.isRangeStart,_=t.i,v=t.j,r=t.realIndex,E=this.w,k=new Fu(this.ctx);if(this.pointsChart)this.scatter.draw(this.elSeries,v,{realIndex:r,pointsPos:c,zRatio:this.zRatio,elParent:this.elPointsMain});else{E.globals.series[_].length>1&&this.elPointsMain.node.classList.add("apexcharts-element-hidden");var P=this.markers.plotChartMarkers({pointsPos:c,seriesIndex:r,j:v+1});P!==null&&this.elPointsMain.add(P)}var L=k.drawDataLabel({type:a,isRangeStart:f,pos:c,i:r,j:v+1});L!==null&&this.elDataLabelsWrap.add(L)}},{key:"_createPaths",value:function(t){var a=t.type,c=t.series,f=t.i;t.realIndex;var _,v=t.j,r=t.x,E=t.y,k=t.xArrj,P=t.yArrj,L=t.y2,O=t.y2Arrj,N=t.pX,G=t.pY,H=t.pathState,Q=t.segmentStartX,ee=t.linePath,ie=t.areaPath,ue=t.linePaths,ve=t.areaPaths,ce=t.curve,Te=t.isRangeStart,Se=new Nt(this.ctx),Ie=this.areaBottomY,Ue=a==="rangeArea",Ke=a==="rangeArea"&&Te;switch(ce){case"monotoneCubic":var qe=Te?P:O;switch(H){case 0:if(qe[v+1]===null)break;H=1;case 1:if(!(Ue?k.length===c[f].length:v===c[f].length-2))break;case 2:var ft=Te?k:k.slice().reverse(),bt=Te?qe:qe.slice().reverse(),Tt=(_=bt,ft.map(function(mi,Ci){return[mi,_[Ci]]}).filter(function(mi){return mi[1]!==null})),Et=Tt.length>1?aC(Tt):Tt,Lt=[];Ue&&(Ke?ve=Tt:Lt=ve.reverse());var qt=0,ui=0;if(function(mi,Ci){for(var zi=function(nn){var ws=[],_s=0;return nn.forEach(function(jr){jr!==null?_s++:_s>0&&(ws.push(_s),_s=0)}),_s>0&&ws.push(_s),ws}(mi),mr=[],Wi=0,ns=0;Wi<zi.length;ns+=zi[Wi++])mr[Wi]=oC(Ci,ns,ns+zi[Wi]);return mr}(bt,Et).forEach(function(mi){qt++;var Ci=function(Wi){for(var ns="",nn=0;nn<Wi.length;nn++){var ws=Wi[nn],_s=ws.length;_s>4?(ns+="C".concat(ws[0],", ").concat(ws[1]),ns+=", ".concat(ws[2],", ").concat(ws[3]),ns+=", ".concat(ws[4],", ").concat(ws[5])):_s>2&&(ns+="S".concat(ws[0],", ").concat(ws[1]),ns+=", ".concat(ws[2],", ").concat(ws[3]))}return ns}(mi),zi=ui,mr=(ui+=mi.length)-1;Ke?ee=Se.move(Tt[zi][0],Tt[zi][1])+Ci:Ue?ee=Se.move(Lt[zi][0],Lt[zi][1])+Se.line(Tt[zi][0],Tt[zi][1])+Ci+Se.line(Lt[mr][0],Lt[mr][1]):(ee=Se.move(Tt[zi][0],Tt[zi][1])+Ci,ie=ee+Se.line(Tt[mr][0],Ie)+Se.line(Tt[zi][0],Ie)+"z",ve.push(ie)),ue.push(ee)}),Ue&&qt>1&&!Ke){var Ti=ue.slice(qt).reverse();ue.splice(qt),Ti.forEach(function(mi){return ue.push(mi)})}H=0}break;case"smooth":var vi=.35*(r-N);if(c[f][v]===null)H=0;else switch(H){case 0:if(Q=N,ee=Ke?Se.move(N,O[v])+Se.line(N,G):Se.move(N,G),ie=Se.move(N,G),c[f][v+1]===null||c[f][v+1]===void 0){ue.push(ee),ve.push(ie);break}if(H=1,v<c[f].length-2){var Kt=Se.curve(N+vi,G,r-vi,E,r,E);ee+=Kt,ie+=Kt;break}case 1:if(c[f][v+1]===null)ee+=Ke?Se.line(N,L):Se.move(N,G),ie+=Se.line(N,Ie)+Se.line(Q,Ie)+"z",ue.push(ee),ve.push(ie),H=-1;else{var Hi=Se.curve(N+vi,G,r-vi,E,r,E);ee+=Hi,ie+=Hi,v>=c[f].length-2&&(Ke&&(ee+=Se.curve(r,E,r,E,r,L)+Se.move(r,L)),ie+=Se.curve(r,E,r,E,r,Ie)+Se.line(Q,Ie)+"z",ue.push(ee),ve.push(ie),H=-1)}}N=r,G=E;break;default:var Br=function(mi,Ci,zi){var mr=[];switch(mi){case"stepline":mr=Se.line(Ci,null,"H")+Se.line(null,zi,"V");break;case"linestep":mr=Se.line(null,zi,"V")+Se.line(Ci,null,"H");break;case"straight":mr=Se.line(Ci,zi)}return mr};if(c[f][v]===null)H=0;else switch(H){case 0:if(Q=N,ee=Ke?Se.move(N,O[v])+Se.line(N,G):Se.move(N,G),ie=Se.move(N,G),c[f][v+1]===null||c[f][v+1]===void 0){ue.push(ee),ve.push(ie);break}if(H=1,v<c[f].length-2){var ar=Br(ce,r,E);ee+=ar,ie+=ar;break}case 1:if(c[f][v+1]===null)ee+=Ke?Se.line(N,L):Se.move(N,G),ie+=Se.line(N,Ie)+Se.line(Q,Ie)+"z",ue.push(ee),ve.push(ie),H=-1;else{var Xr=Br(ce,r,E);ee+=Xr,ie+=Xr,v>=c[f].length-2&&(Ke&&(ee+=Se.line(r,L)),ie+=Se.line(r,Ie)+Se.line(Q,Ie)+"z",ue.push(ee),ve.push(ie),H=-1)}}N=r,G=E}return{linePaths:ue,areaPaths:ve,pX:N,pY:G,pathState:H,segmentStartX:Q,linePath:ee,areaPath:ie}}},{key:"handleNullDataPoints",value:function(t,a,c,f,_){var v=this.w;if(t[c][f]===null&&v.config.markers.showNullDataPoints||t[c].length===1){var r=this.strokeWidth-v.config.markers.strokeWidth/2;r>0||(r=0);var E=this.markers.plotChartMarkers({pointsPos:a,seriesIndex:_,j:f+1,pSize:r,alwaysDrawMarker:!0});E!==null&&this.elPointsMain.add(E)}}}]),S}();window.TreemapSquared={},window.TreemapSquared.generate=function(){function S(r,E,k,P){this.xoffset=r,this.yoffset=E,this.height=P,this.width=k,this.shortestEdge=function(){return Math.min(this.height,this.width)},this.getCoordinates=function(L){var O,N=[],G=this.xoffset,H=this.yoffset,Q=_(L)/this.height,ee=_(L)/this.width;if(this.width>=this.height)for(O=0;O<L.length;O++)N.push([G,H,G+Q,H+L[O]/Q]),H+=L[O]/Q;else for(O=0;O<L.length;O++)N.push([G,H,G+L[O]/ee,H+ee]),G+=L[O]/ee;return N},this.cutArea=function(L){var O;if(this.width>=this.height){var N=L/this.height,G=this.width-N;O=new S(this.xoffset+N,this.yoffset,G,this.height)}else{var H=L/this.width,Q=this.height-H;O=new S(this.xoffset,this.yoffset+H,this.width,Q)}return O}}function t(r,E,k,P,L){P=P===void 0?0:P,L=L===void 0?0:L;var O=a(function(N,G){var H,Q=[],ee=G/_(N);for(H=0;H<N.length;H++)Q[H]=N[H]*ee;return Q}(r,E*k),[],new S(P,L,E,k),[]);return function(N){var G,H,Q=[];for(G=0;G<N.length;G++)for(H=0;H<N[G].length;H++)Q.push(N[G][H]);return Q}(O)}function a(r,E,k,P){var L,O,N;if(r.length!==0)return L=k.shortestEdge(),function(G,H,Q){var ee;if(G.length===0)return!0;(ee=G.slice()).push(H);var ie=c(G,Q),ue=c(ee,Q);return ie>=ue}(E,O=r[0],L)?(E.push(O),a(r.slice(1),E,k,P)):(N=k.cutArea(_(E),P),P.push(k.getCoordinates(E)),a(r,[],N,P)),P;P.push(k.getCoordinates(E))}function c(r,E){var k=Math.min.apply(Math,r),P=Math.max.apply(Math,r),L=_(r);return Math.max(Math.pow(E,2)*P/Math.pow(L,2),Math.pow(L,2)/(Math.pow(E,2)*k))}function f(r){return r&&r.constructor===Array}function _(r){var E,k=0;for(E=0;E<r.length;E++)k+=r[E];return k}function v(r){var E,k=0;if(f(r[0]))for(E=0;E<r.length;E++)k+=v(r[E]);else k=_(r);return k}return function r(E,k,P,L,O){L=L===void 0?0:L,O=O===void 0?0:O;var N,G,H=[],Q=[];if(f(E[0])){for(G=0;G<E.length;G++)H[G]=v(E[G]);for(N=t(H,k,P,L,O),G=0;G<E.length;G++)Q.push(r(E[G],N[G][2]-N[G][0],N[G][3]-N[G][1],N[G][0],N[G][1]))}else Q=t(E,k,P,L,O);return Q}}();var lC=function(){function S(t,a){pi(this,S),this.ctx=t,this.w=t.w,this.strokeWidth=this.w.config.stroke.width,this.helpers=new z1(t),this.dynamicAnim=this.w.config.chart.animations.dynamicAnimation,this.labels=[]}return gi(S,[{key:"draw",value:function(t){var a=this,c=this.w,f=new Nt(this.ctx),_=new Da(this.ctx),v=f.group({class:"apexcharts-treemap"});if(c.globals.noData)return v;var r=[];return t.forEach(function(E){var k=E.map(function(P){return Math.abs(P)});r.push(k)}),this.negRange=this.helpers.checkColorRange(),c.config.series.forEach(function(E,k){E.data.forEach(function(P){Array.isArray(a.labels[k])||(a.labels[k]=[]),a.labels[k].push(P.x)})}),window.TreemapSquared.generate(r,c.globals.gridWidth,c.globals.gridHeight).forEach(function(E,k){var P=f.group({class:"apexcharts-series apexcharts-treemap-series",seriesName:et.escapeString(c.globals.seriesNames[k]),rel:k+1,"data:realIndex":k});if(c.config.chart.dropShadow.enabled){var L=c.config.chart.dropShadow;new rn(a.ctx).dropShadow(v,L,k)}var O=f.group({class:"apexcharts-data-labels"}),N={xMin:1/0,yMin:1/0,xMax:-1/0,yMax:-1/0};E.forEach(function(Et,Lt){var qt=Et[0],ui=Et[1],Ti=Et[2],vi=Et[3];N.xMin=Math.min(N.xMin,qt),N.yMin=Math.min(N.yMin,ui),N.xMax=Math.max(N.xMax,Ti),N.yMax=Math.max(N.yMax,vi);var Kt=a.helpers.getShadeColor(c.config.chart.type,k,Lt,a.negRange),Hi=Kt.color,Br=_.fillPath({color:Hi,seriesNumber:k,dataPointIndex:Lt}),ar=f.drawRect(qt,ui,Ti-qt,vi-ui,c.config.plotOptions.treemap.borderRadius,"#fff",1,a.strokeWidth,c.config.plotOptions.treemap.useFillColorAsStroke?Hi:c.globals.stroke.colors[k]);ar.attr({cx:qt,cy:ui,index:k,i:k,j:Lt,width:Ti-qt,height:vi-ui,fill:Br}),ar.node.classList.add("apexcharts-treemap-rect"),a.helpers.addListeners(ar);var Xr={x:qt+(Ti-qt)/2,y:ui+(vi-ui)/2,width:0,height:0},mi={x:qt,y:ui,width:Ti-qt,height:vi-ui};if(c.config.chart.animations.enabled&&!c.globals.dataChanged){var Ci=1;c.globals.resized||(Ci=c.config.chart.animations.speed),a.animateTreemap(ar,Xr,mi,Ci)}if(c.globals.dataChanged){var zi=1;a.dynamicAnim.enabled&&c.globals.shouldAnimate&&(zi=a.dynamicAnim.speed,c.globals.previousPaths[k]&&c.globals.previousPaths[k][Lt]&&c.globals.previousPaths[k][Lt].rect&&(Xr=c.globals.previousPaths[k][Lt].rect),a.animateTreemap(ar,Xr,mi,zi))}var mr=a.getFontSize(Et),Wi=c.config.dataLabels.formatter(a.labels[k][Lt],{value:c.globals.series[k][Lt],seriesIndex:k,dataPointIndex:Lt,w:c});c.config.plotOptions.treemap.dataLabels.format==="truncate"&&(mr=parseInt(c.config.dataLabels.style.fontSize,10),Wi=a.truncateLabels(Wi,mr,qt,ui,Ti,vi));var ns=null;c.globals.series[k][Lt]&&(ns=a.helpers.calculateDataLabels({text:Wi,x:(qt+Ti)/2,y:(ui+vi)/2+a.strokeWidth/2+mr/3,i:k,j:Lt,colorProps:Kt,fontSize:mr,series:t})),c.config.dataLabels.enabled&&ns&&a.rotateToFitLabel(ns,mr,Wi,qt,ui,Ti,vi),P.add(ar),ns!==null&&P.add(ns)});var G=c.config.plotOptions.treemap.seriesTitle;if(c.config.series.length>1&&G&&G.show){var H=c.config.series[k].name||"";if(H&&N.xMin<1/0&&N.yMin<1/0){var Q=G.offsetX,ee=G.offsetY,ie=G.borderColor,ue=G.borderWidth,ve=G.borderRadius,ce=G.style,Te=ce.color||c.config.chart.foreColor,Se={left:ce.padding.left,right:ce.padding.right,top:ce.padding.top,bottom:ce.padding.bottom},Ie=f.getTextRects(H,ce.fontSize,ce.fontFamily),Ue=Ie.width+Se.left+Se.right,Ke=Ie.height+Se.top+Se.bottom,qe=N.xMin+(Q||0),ft=N.yMin+(ee||0),bt=f.drawRect(qe,ft,Ue,Ke,ve,ce.background,1,ue,ie),Tt=f.drawText({x:qe+Se.left,y:ft+Se.top+.75*Ie.height,text:H,fontSize:ce.fontSize,fontFamily:ce.fontFamily,fontWeight:ce.fontWeight,foreColor:Te,cssClass:ce.cssClass||""});P.add(bt),P.add(Tt)}}P.add(O),v.add(P)}),v}},{key:"getFontSize",value:function(t){var a=this.w,c=function f(_){var v,r=0;if(Array.isArray(_[0]))for(v=0;v<_.length;v++)r+=f(_[v]);else for(v=0;v<_.length;v++)r+=_[v].length;return r}(this.labels)/function f(_){var v,r=0;if(Array.isArray(_[0]))for(v=0;v<_.length;v++)r+=f(_[v]);else for(v=0;v<_.length;v++)r+=1;return r}(this.labels);return function(f,_){var v=f*_,r=Math.pow(v,.5);return Math.min(r/c,parseInt(a.config.dataLabels.style.fontSize,10))}(t[2]-t[0],t[3]-t[1])}},{key:"rotateToFitLabel",value:function(t,a,c,f,_,v,r){var E=new Nt(this.ctx),k=E.getTextRects(c,a);if(k.width+this.w.config.stroke.width+5>v-f&&k.width<=r-_){var P=E.rotateAroundCenter(t.node);t.node.setAttribute("transform","rotate(-90 ".concat(P.x," ").concat(P.y,") translate(").concat(k.height/3,")"))}}},{key:"truncateLabels",value:function(t,a,c,f,_,v){var r=new Nt(this.ctx),E=r.getTextRects(t,a).width+this.w.config.stroke.width+5>_-c&&v-f>_-c?v-f:_-c,k=r.getTextBasedOnMaxWidth({text:t,maxWidth:E,fontSize:a});return t.length!==k.length&&E/a<5?"":k}},{key:"animateTreemap",value:function(t,a,c,f){var _=new Nu(this.ctx);_.animateRect(t,a,c,f,function(){_.animationCompleted(t)})}}]),S}(),O1=86400,cC=10/O1,hC=function(){function S(t){pi(this,S),this.ctx=t,this.w=t.w,this.timeScaleArray=[],this.utc=this.w.config.xaxis.labels.datetimeUTC}return gi(S,[{key:"calculateTimeScaleTicks",value:function(t,a){var c=this,f=this.w;if(f.globals.allSeriesCollapsed)return f.globals.labels=[],f.globals.timescaleLabels=[],[];var _=new tn(this.ctx),v=(a-t)/864e5;this.determineInterval(v),f.globals.disableZoomIn=!1,f.globals.disableZoomOut=!1,v<cC?f.globals.disableZoomIn=!0:v>5e4&&(f.globals.disableZoomOut=!0);var r=_.getTimeUnitsfromTimestamp(t,a,this.utc),E=f.globals.gridWidth/v,k=E/24,P=k/60,L=P/60,O=Math.floor(24*v),N=Math.floor(1440*v),G=Math.floor(v*O1),H=Math.floor(v),Q=Math.floor(v/30),ee=Math.floor(v/365),ie={minMillisecond:r.minMillisecond,minSecond:r.minSecond,minMinute:r.minMinute,minHour:r.minHour,minDate:r.minDate,minMonth:r.minMonth,minYear:r.minYear},ue={firstVal:ie,currentMillisecond:ie.minMillisecond,currentSecond:ie.minSecond,currentMinute:ie.minMinute,currentHour:ie.minHour,currentMonthDate:ie.minDate,currentDate:ie.minDate,currentMonth:ie.minMonth,currentYear:ie.minYear,daysWidthOnXAxis:E,hoursWidthOnXAxis:k,minutesWidthOnXAxis:P,secondsWidthOnXAxis:L,numberOfSeconds:G,numberOfMinutes:N,numberOfHours:O,numberOfDays:H,numberOfMonths:Q,numberOfYears:ee};switch(this.tickInterval){case"years":this.generateYearScale(ue);break;case"months":case"half_year":this.generateMonthScale(ue);break;case"months_days":case"months_fortnight":case"days":case"week_days":this.generateDayScale(ue);break;case"hours":this.generateHourScale(ue);break;case"minutes_fives":case"minutes":this.generateMinuteScale(ue);break;case"seconds_tens":case"seconds_fives":case"seconds":this.generateSecondScale(ue)}var ve=this.timeScaleArray.map(function(ce){var Te={position:ce.position,unit:ce.unit,year:ce.year,day:ce.day?ce.day:1,hour:ce.hour?ce.hour:0,month:ce.month+1};return ce.unit==="month"?Jt(Jt({},Te),{},{day:1,value:ce.value+1}):ce.unit==="day"||ce.unit==="hour"?Jt(Jt({},Te),{},{value:ce.value}):ce.unit==="minute"?Jt(Jt({},Te),{},{value:ce.value,minute:ce.value}):ce.unit==="second"?Jt(Jt({},Te),{},{value:ce.value,minute:ce.minute,second:ce.second}):ce});return ve.filter(function(ce){var Te=1,Se=Math.ceil(f.globals.gridWidth/120),Ie=ce.value;f.config.xaxis.tickAmount!==void 0&&(Se=f.config.xaxis.tickAmount),ve.length>Se&&(Te=Math.floor(ve.length/Se));var Ue=!1,Ke=!1;switch(c.tickInterval){case"years":ce.unit==="year"&&(Ue=!0);break;case"half_year":Te=7,ce.unit==="year"&&(Ue=!0);break;case"months":Te=1,ce.unit==="year"&&(Ue=!0);break;case"months_fortnight":Te=15,ce.unit!=="year"&&ce.unit!=="month"||(Ue=!0),Ie===30&&(Ke=!0);break;case"months_days":Te=10,ce.unit==="month"&&(Ue=!0),Ie===30&&(Ke=!0);break;case"week_days":Te=8,ce.unit==="month"&&(Ue=!0);break;case"days":Te=1,ce.unit==="month"&&(Ue=!0);break;case"hours":ce.unit==="day"&&(Ue=!0);break;case"minutes_fives":case"seconds_fives":Ie%5!=0&&(Ke=!0);break;case"seconds_tens":Ie%10!=0&&(Ke=!0)}if(c.tickInterval==="hours"||c.tickInterval==="minutes_fives"||c.tickInterval==="seconds_tens"||c.tickInterval==="seconds_fives"){if(!Ke)return!0}else if((Ie%Te==0||Ue)&&!Ke)return!0})}},{key:"recalcDimensionsBasedOnFormat",value:function(t,a){var c=this.w,f=this.formatDates(t),_=this.removeOverlappingTS(f);c.globals.timescaleLabels=_.slice(),new um(this.ctx).plotCoords()}},{key:"determineInterval",value:function(t){var a=24*t,c=60*a;switch(!0){case t/365>5:this.tickInterval="years";break;case t>800:this.tickInterval="half_year";break;case t>180:this.tickInterval="months";break;case t>90:this.tickInterval="months_fortnight";break;case t>60:this.tickInterval="months_days";break;case t>30:this.tickInterval="week_days";break;case t>2:this.tickInterval="days";break;case a>2.4:this.tickInterval="hours";break;case c>15:this.tickInterval="minutes_fives";break;case c>5:this.tickInterval="minutes";break;case c>1:this.tickInterval="seconds_tens";break;case 60*c>20:this.tickInterval="seconds_fives";break;default:this.tickInterval="seconds"}}},{key:"generateYearScale",value:function(t){var a=t.firstVal,c=t.currentMonth,f=t.currentYear,_=t.daysWidthOnXAxis,v=t.numberOfYears,r=a.minYear,E=0,k=new tn(this.ctx),P="year";if(a.minDate>1||a.minMonth>0){var L=k.determineRemainingDaysOfYear(a.minYear,a.minMonth,a.minDate);E=(k.determineDaysOfYear(a.minYear)-L+1)*_,r=a.minYear+1,this.timeScaleArray.push({position:E,value:r,unit:P,year:r,month:et.monthMod(c+1)})}else a.minDate===1&&a.minMonth===0&&this.timeScaleArray.push({position:E,value:r,unit:P,year:f,month:et.monthMod(c+1)});for(var O=r,N=E,G=0;G<v;G++)O++,N=k.determineDaysOfYear(O-1)*_+N,this.timeScaleArray.push({position:N,value:O,unit:P,year:O,month:1})}},{key:"generateMonthScale",value:function(t){var a=t.firstVal,c=t.currentMonthDate,f=t.currentMonth,_=t.currentYear,v=t.daysWidthOnXAxis,r=t.numberOfMonths,E=f,k=0,P=new tn(this.ctx),L="month",O=0;if(a.minDate>1){k=(P.determineDaysOfMonths(f+1,a.minYear)-c+1)*v,E=et.monthMod(f+1);var N=_+O,G=et.monthMod(E),H=E;E===0&&(L="year",H=N,G=1,N+=O+=1),this.timeScaleArray.push({position:k,value:H,unit:L,year:N,month:G})}else this.timeScaleArray.push({position:k,value:E,unit:L,year:_,month:et.monthMod(f)});for(var Q=E+1,ee=k,ie=0,ue=1;ie<r;ie++,ue++){(Q=et.monthMod(Q))===0?(L="year",O+=1):L="month";var ve=this._getYear(_,Q,O);ee=P.determineDaysOfMonths(Q,ve)*v+ee;var ce=Q===0?ve:Q;this.timeScaleArray.push({position:ee,value:ce,unit:L,year:ve,month:Q===0?1:Q}),Q++}}},{key:"generateDayScale",value:function(t){var a=t.firstVal,c=t.currentMonth,f=t.currentYear,_=t.hoursWidthOnXAxis,v=t.numberOfDays,r=new tn(this.ctx),E="day",k=a.minDate+1,P=k,L=function(ue,ve,ce){return ue>r.determineDaysOfMonths(ve+1,ce)&&(P=1,E="month",N=ve+=1),ve},O=(24-a.minHour)*_,N=k,G=L(P,c,f);a.minHour===0&&a.minDate===1?(O=0,N=et.monthMod(a.minMonth),E="month",P=a.minDate):a.minDate!==1&&a.minHour===0&&a.minMinute===0&&(O=0,k=a.minDate,N=k,G=L(P=k,c,f),N!==1&&(E="day")),this.timeScaleArray.push({position:O,value:N,unit:E,year:this._getYear(f,G,0),month:et.monthMod(G),day:P});for(var H=O,Q=0;Q<v;Q++){E="day",G=L(P+=1,G,this._getYear(f,G,0));var ee=this._getYear(f,G,0);H=24*_+H;var ie=P===1?et.monthMod(G):P;this.timeScaleArray.push({position:H,value:ie,unit:E,year:ee,month:et.monthMod(G),day:ie})}}},{key:"generateHourScale",value:function(t){var a=t.firstVal,c=t.currentDate,f=t.currentMonth,_=t.currentYear,v=t.minutesWidthOnXAxis,r=t.numberOfHours,E=new tn(this.ctx),k="hour",P=function(Te,Se){return Te>E.determineDaysOfMonths(Se+1,_)&&(Q=1,Se+=1),{month:Se,date:Q}},L=function(Te,Se){return Te>E.determineDaysOfMonths(Se+1,_)?Se+=1:Se},O=60-(a.minMinute+a.minSecond/60),N=O*v,G=a.minHour+1,H=G;O===60&&(N=0,H=G=a.minHour);var Q=c;H>=24&&(H=0,k="day",G=Q+=1);var ee=P(Q,f).month;ee=L(Q,ee),G>31&&(G=Q=1),this.timeScaleArray.push({position:N,value:G,unit:k,day:Q,hour:H,year:_,month:et.monthMod(ee)}),H++;for(var ie=N,ue=0;ue<r;ue++){k="hour",H>=24&&(H=0,k="day",ee=P(Q+=1,ee).month,ee=L(Q,ee));var ve=this._getYear(_,ee,0);ie=60*v+ie;var ce=H===0?Q:H;this.timeScaleArray.push({position:ie,value:ce,unit:k,hour:H,day:Q,year:ve,month:et.monthMod(ee)}),H++}}},{key:"generateMinuteScale",value:function(t){for(var a=t.currentMillisecond,c=t.currentSecond,f=t.currentMinute,_=t.currentHour,v=t.currentDate,r=t.currentMonth,E=t.currentYear,k=t.minutesWidthOnXAxis,P=t.secondsWidthOnXAxis,L=t.numberOfMinutes,O=f+1,N=v,G=r,H=E,Q=_,ee=(60-c-a/1e3)*P,ie=0;ie<L;ie++)O>=60&&(O=0,(Q+=1)===24&&(Q=0)),this.timeScaleArray.push({position:ee,value:O,unit:"minute",hour:Q,minute:O,day:N,year:this._getYear(H,G,0),month:et.monthMod(G)}),ee+=k,O++}},{key:"generateSecondScale",value:function(t){for(var a=t.currentMillisecond,c=t.currentSecond,f=t.currentMinute,_=t.currentHour,v=t.currentDate,r=t.currentMonth,E=t.currentYear,k=t.secondsWidthOnXAxis,P=t.numberOfSeconds,L=c+1,O=f,N=v,G=r,H=E,Q=_,ee=(1e3-a)/1e3*k,ie=0;ie<P;ie++)L>=60&&(L=0,++O>=60&&(O=0,++Q===24&&(Q=0))),this.timeScaleArray.push({position:ee,value:L,unit:"second",hour:Q,minute:O,second:L,day:N,year:this._getYear(H,G,0),month:et.monthMod(G)}),ee+=k,L++}},{key:"createRawDateString",value:function(t,a){var c=t.year;return t.month===0&&(t.month=1),c+="-"+("0"+t.month.toString()).slice(-2),t.unit==="day"?c+=t.unit==="day"?"-"+("0"+a).slice(-2):"-01":c+="-"+("0"+(t.day?t.day:"1")).slice(-2),t.unit==="hour"?c+=t.unit==="hour"?"T"+("0"+a).slice(-2):"T00":c+="T"+("0"+(t.hour?t.hour:"0")).slice(-2),t.unit==="minute"?c+=":"+("0"+a).slice(-2):c+=":"+(t.minute?("0"+t.minute).slice(-2):"00"),t.unit==="second"?c+=":"+("0"+a).slice(-2):c+=":00",this.utc&&(c+=".000Z"),c}},{key:"formatDates",value:function(t){var a=this,c=this.w;return t.map(function(f){var _=f.value.toString(),v=new tn(a.ctx),r=a.createRawDateString(f,_),E=v.getDate(v.parseDate(r));if(a.utc||(E=v.getDate(v.parseDateWithTimezone(r))),c.config.xaxis.labels.format===void 0){var k="dd MMM",P=c.config.xaxis.labels.datetimeFormatter;f.unit==="year"&&(k=P.year),f.unit==="month"&&(k=P.month),f.unit==="day"&&(k=P.day),f.unit==="hour"&&(k=P.hour),f.unit==="minute"&&(k=P.minute),f.unit==="second"&&(k=P.second),_=v.formatDate(E,k)}else _=v.formatDate(E,c.config.xaxis.labels.format);return{dateString:r,position:f.position,value:_,unit:f.unit,year:f.year,month:f.month}})}},{key:"removeOverlappingTS",value:function(t){var a,c=this,f=new Nt(this.ctx),_=!1;t.length>0&&t[0].value&&t.every(function(E){return E.value.length===t[0].value.length})&&(_=!0,a=f.getTextRects(t[0].value).width);var v=0,r=t.map(function(E,k){if(k>0&&c.w.config.xaxis.labels.hideOverlappingLabels){var P=_?a:f.getTextRects(t[v].value).width,L=t[v].position;return E.position>L+P+10?(v=k,E):null}return E});return r=r.filter(function(E){return E!==null})}},{key:"_getYear",value:function(t,a,c){return t+Math.floor(a/12)+c}}]),S}(),uC=function(){function S(t,a){pi(this,S),this.ctx=a,this.w=a.w,this.el=t}return gi(S,[{key:"setupElements",value:function(){var t=this.w,a=t.globals,c=t.config,f=c.chart.type;a.axisCharts=["line","area","bar","rangeBar","rangeArea","candlestick","boxPlot","scatter","bubble","radar","heatmap","treemap"].includes(f),a.xyCharts=["line","area","bar","rangeBar","rangeArea","candlestick","boxPlot","scatter","bubble"].includes(f),a.isBarHorizontal=["bar","rangeBar","boxPlot"].includes(f)&&c.plotOptions.bar.horizontal,a.chartClass=".apexcharts".concat(a.chartID),a.dom.baseEl=this.el,a.dom.elWrap=document.createElement("div"),Nt.setAttrs(a.dom.elWrap,{id:a.chartClass.substring(1),class:"apexcharts-canvas ".concat(a.chartClass.substring(1))}),this.el.appendChild(a.dom.elWrap),a.dom.Paper=window.SVG().addTo(a.dom.elWrap),a.dom.Paper.attr({class:"apexcharts-svg","xmlns:data":"ApexChartsNS",transform:"translate(".concat(c.chart.offsetX,", ").concat(c.chart.offsetY,")")}),a.dom.Paper.node.style.background=c.theme.mode!=="dark"||c.chart.background?c.theme.mode!=="light"||c.chart.background?c.chart.background:"#fff":"#343A3F",this.setSVGDimensions(),a.dom.elLegendForeign=document.createElementNS(a.SVGNS,"foreignObject"),Nt.setAttrs(a.dom.elLegendForeign,{x:0,y:0,width:a.svgWidth,height:a.svgHeight}),a.dom.elLegendWrap=document.createElement("div"),a.dom.elLegendWrap.classList.add("apexcharts-legend"),a.dom.elWrap.appendChild(a.dom.elLegendWrap),a.dom.Paper.node.appendChild(a.dom.elLegendForeign),a.dom.elGraphical=a.dom.Paper.group().attr({class:"apexcharts-inner apexcharts-graphical"}),a.dom.elDefs=a.dom.Paper.defs(),a.dom.Paper.add(a.dom.elGraphical),a.dom.elGraphical.add(a.dom.elDefs)}},{key:"plotChartType",value:function(t,a){var c=this.w,f=this.ctx,_=c.config,v=c.globals,r={line:{series:[],i:[]},area:{series:[],i:[]},scatter:{series:[],i:[]},bubble:{series:[],i:[]},bar:{series:[],i:[]},candlestick:{series:[],i:[]},boxPlot:{series:[],i:[]},rangeBar:{series:[],i:[]},rangeArea:{series:[],seriesRangeEnd:[],i:[]}},E=_.chart.type||"line",k=null,P=0;v.series.forEach(function(Te,Se){var Ie,Ue,Ke=((Ie=t[Se])===null||Ie===void 0?void 0:Ie.type)==="column"?"bar":((Ue=t[Se])===null||Ue===void 0?void 0:Ue.type)||(E==="column"?"bar":E);r[Ke]?(Ke==="rangeArea"?(r[Ke].series.push(v.seriesRangeStart[Se]),r[Ke].seriesRangeEnd.push(v.seriesRangeEnd[Se])):r[Ke].series.push(Te),r[Ke].i.push(Se),Ke==="bar"&&(c.globals.columnSeries=r.bar)):["heatmap","treemap","pie","donut","polarArea","radialBar","radar"].includes(Ke)?k=Ke:console.warn("You have specified an unrecognized series type (".concat(Ke,").")),E!==Ke&&Ke!=="scatter"&&P++}),P>0&&(k&&console.warn("Chart or series type ".concat(k," cannot appear with other chart or series types.")),r.bar.series.length>0&&_.plotOptions.bar.horizontal&&(P-=r.bar.series.length,r.bar={series:[],i:[]},c.globals.columnSeries={series:[],i:[]},console.warn("Horizontal bars are not supported in a mixed/combo chart. Please turn off `plotOptions.bar.horizontal`"))),v.comboCharts||(v.comboCharts=P>0);var L=new Ly(f,a),O=new My(f,a);f.pie=new D1(f);var N=new iC(f);f.rangeBar=new rC(f,a);var G=new tC(f),H=[];if(v.comboCharts){var Q,ee,ie=new Is(f);if(r.area.series.length>0&&(Q=H).push.apply(Q,Us(ie.drawSeriesByGroup(r.area,v.areaGroups,"area",L))),r.bar.series.length>0)if(_.chart.stacked){var ue=new Cw(f,a);H.push(ue.draw(r.bar.series,r.bar.i))}else f.bar=new Bu(f,a),H.push(f.bar.draw(r.bar.series,r.bar.i));if(r.rangeArea.series.length>0&&H.push(L.draw(r.rangeArea.series,"rangeArea",r.rangeArea.i,r.rangeArea.seriesRangeEnd)),r.line.series.length>0&&(ee=H).push.apply(ee,Us(ie.drawSeriesByGroup(r.line,v.lineGroups,"line",L))),r.candlestick.series.length>0&&H.push(O.draw(r.candlestick.series,"candlestick",r.candlestick.i)),r.boxPlot.series.length>0&&H.push(O.draw(r.boxPlot.series,"boxPlot",r.boxPlot.i)),r.rangeBar.series.length>0&&H.push(f.rangeBar.draw(r.rangeBar.series,r.rangeBar.i)),r.scatter.series.length>0){var ve=new Ly(f,a,!0);H.push(ve.draw(r.scatter.series,"scatter",r.scatter.i))}if(r.bubble.series.length>0){var ce=new Ly(f,a,!0);H.push(ce.draw(r.bubble.series,"bubble",r.bubble.i))}}else switch(_.chart.type){case"line":H=L.draw(v.series,"line");break;case"area":H=L.draw(v.series,"area");break;case"bar":_.chart.stacked?H=new Cw(f,a).draw(v.series):(f.bar=new Bu(f,a),H=f.bar.draw(v.series));break;case"candlestick":H=new My(f,a).draw(v.series,"candlestick");break;case"boxPlot":H=new My(f,a).draw(v.series,_.chart.type);break;case"rangeBar":H=f.rangeBar.draw(v.series);break;case"rangeArea":H=L.draw(v.seriesRangeStart,"rangeArea",void 0,v.seriesRangeEnd);break;case"heatmap":H=new eC(f,a).draw(v.series);break;case"treemap":H=new lC(f,a).draw(v.series);break;case"pie":case"donut":case"polarArea":H=f.pie.draw(v.series);break;case"radialBar":H=N.draw(v.series);break;case"radar":H=G.draw(v.series);break;default:H=L.draw(v.series)}return H}},{key:"setSVGDimensions",value:function(){var t=this.w,a=t.globals,c=t.config;c.chart.width=c.chart.width||"100%",c.chart.height=c.chart.height||"auto",a.svgWidth=c.chart.width,a.svgHeight=c.chart.height;var f=et.getDimensions(this.el),_=c.chart.width.toString().split(/[0-9]+/g).pop();_==="%"?et.isNumber(f[0])&&(f[0].width===0&&(f=et.getDimensions(this.el.parentNode)),a.svgWidth=f[0]*parseInt(c.chart.width,10)/100):_!=="px"&&_!==""||(a.svgWidth=parseInt(c.chart.width,10));var v=String(c.chart.height).toString().split(/[0-9]+/g).pop();if(a.svgHeight!=="auto"&&a.svgHeight!=="")if(v==="%"){var r=et.getDimensions(this.el.parentNode);a.svgHeight=r[1]*parseInt(c.chart.height,10)/100}else a.svgHeight=parseInt(c.chart.height,10);else a.svgHeight=a.axisCharts?a.svgWidth/1.61:a.svgWidth/1.2;if(a.svgWidth=Math.max(a.svgWidth,0),a.svgHeight=Math.max(a.svgHeight,0),Nt.setAttrs(a.dom.Paper.node,{width:a.svgWidth,height:a.svgHeight}),v!=="%"){var E=c.chart.sparkline.enabled?0:a.axisCharts?c.chart.parentHeightOffset:0;a.dom.Paper.node.parentNode.parentNode.style.minHeight="".concat(a.svgHeight+E,"px")}a.dom.elWrap.style.width="".concat(a.svgWidth,"px"),a.dom.elWrap.style.height="".concat(a.svgHeight,"px")}},{key:"shiftGraphPosition",value:function(){var t=this.w.globals,a=t.translateY,c=t.translateX;Nt.setAttrs(t.dom.elGraphical.node,{transform:"translate(".concat(c,", ").concat(a,")")})}},{key:"resizeNonAxisCharts",value:function(){var t=this.w,a=t.globals,c=0,f=t.config.chart.sparkline.enabled?1:15;f+=t.config.grid.padding.bottom,["top","bottom"].includes(t.config.legend.position)&&t.config.legend.show&&!t.config.legend.floating&&(c=new k1(this.ctx).legendHelpers.getLegendDimensions().clwh+7);var _=t.globals.dom.baseEl.querySelector(".apexcharts-radialbar, .apexcharts-pie"),v=2.05*t.globals.radialSize;if(_&&!t.config.chart.sparkline.enabled&&t.config.plotOptions.radialBar.startAngle!==0){var r=et.getBoundingClientRect(_);v=r.bottom;var E=r.bottom-r.top;v=Math.max(2.05*t.globals.radialSize,E)}var k=Math.ceil(v+a.translateY+c+f);a.dom.elLegendForeign&&a.dom.elLegendForeign.setAttribute("height",k),t.config.chart.height&&String(t.config.chart.height).includes("%")||(a.dom.elWrap.style.height="".concat(k,"px"),Nt.setAttrs(a.dom.Paper.node,{height:k}),a.dom.Paper.node.parentNode.parentNode.style.minHeight="".concat(k,"px"))}},{key:"coreCalculations",value:function(){new Zy(this.ctx).init()}},{key:"resetGlobals",value:function(){var t=this,a=function(){return t.w.config.series.map(function(){return[]})},c=new A1,f=this.w.globals,_={dataWasParsed:f.dataWasParsed,originalSeries:f.originalSeries};c.initGlobalVars(f),f.seriesXvalues=a(),f.seriesYvalues=a(),_.dataWasParsed&&(f.dataWasParsed=_.dataWasParsed,f.originalSeries=_.originalSeries)}},{key:"isMultipleY",value:function(){return!!(Array.isArray(this.w.config.yaxis)&&this.w.config.yaxis.length>1)&&(this.w.globals.isMultipleYAxis=!0,!0)}},{key:"xySettings",value:function(){var t=this.w,a=null;if(t.globals.axisCharts){if(t.config.xaxis.crosshairs.position==="back"&&new $y(this.ctx).drawXCrosshairs(),t.config.yaxis[0].crosshairs.position==="back"&&new $y(this.ctx).drawYCrosshairs(),t.config.xaxis.type==="datetime"&&t.config.xaxis.labels.formatter===void 0){this.ctx.timeScale=new hC(this.ctx);var c=[];isFinite(t.globals.minX)&&isFinite(t.globals.maxX)&&!t.globals.isBarHorizontal?c=this.ctx.timeScale.calculateTimeScaleTicks(t.globals.minX,t.globals.maxX):t.globals.isBarHorizontal&&(c=this.ctx.timeScale.calculateTimeScaleTicks(t.globals.minY,t.globals.maxY)),this.ctx.timeScale.recalcDimensionsBasedOnFormat(c)}a=new Is(this.ctx).getCalculatedRatios()}return a}},{key:"updateSourceChart",value:function(t){this.ctx.w.globals.selection=void 0,this.ctx.updateHelpers._updateOptions({chart:{selection:{xaxis:{min:t.w.globals.minX,max:t.w.globals.maxX}}}},!1,!1)}},{key:"setupBrushHandler",value:function(){var t=this,a=this.ctx,c=this.w;if(c.config.chart.brush.enabled&&typeof c.config.chart.events.selection!="function"){var f=Array.isArray(c.config.chart.brush.targets)?c.config.chart.brush.targets:[c.config.chart.brush.target];f.forEach(function(_){var v=a.constructor.getChartByID(_);v.w.globals.brushSource=t.ctx,typeof v.w.config.chart.events.zoomed!="function"&&(v.w.config.chart.events.zoomed=function(){return t.updateSourceChart(v)}),typeof v.w.config.chart.events.scrolled!="function"&&(v.w.config.chart.events.scrolled=function(){return t.updateSourceChart(v)})}),c.config.chart.events.selection=function(_,v){f.forEach(function(r){a.constructor.getChartByID(r).ctx.updateHelpers._updateOptions({xaxis:{min:v.xaxis.min,max:v.xaxis.max}},!1,!1,!1,!1)})}}}}]),S}(),dC=function(){function S(t){pi(this,S),this.ctx=t,this.w=t.w}return gi(S,[{key:"_updateOptions",value:function(t){var a=this,c=arguments.length>1&&arguments[1]!==void 0&&arguments[1],f=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2],_=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3],v=arguments.length>4&&arguments[4]!==void 0&&arguments[4];return new Promise(function(r){var E=[a.ctx];_&&(E=a.ctx.getSyncedCharts()),a.ctx.w.globals.isExecCalled&&(E=[a.ctx],a.ctx.w.globals.isExecCalled=!1),E.forEach(function(k,P){var L=k.w;if(L.globals.shouldAnimate=f,c||(L.globals.resized=!0,L.globals.dataChanged=!0,f&&k.series.getPreviousPaths()),t&&Cn(t)==="object"&&(k.config=new qf(t),t=Is.extendArrayProps(k.config,t,L),k.w.globals.chartID!==a.ctx.w.globals.chartID&&delete t.series,L.config=et.extend(L.config,t),v&&(L.globals.lastXAxis=t.xaxis?et.clone(t.xaxis):[],L.globals.lastYAxis=t.yaxis?et.clone(t.yaxis):[],L.globals.initialConfig=et.extend({},L.config),L.globals.initialSeries=et.clone(L.config.series),t.series))){for(var O=0;O<L.globals.collapsedSeriesIndices.length;O++){var N=L.config.series[L.globals.collapsedSeriesIndices[O]];L.globals.collapsedSeries[O].data=L.globals.axisCharts?N.data.slice():N}for(var G=0;G<L.globals.ancillaryCollapsedSeriesIndices.length;G++){var H=L.config.series[L.globals.ancillaryCollapsedSeriesIndices[G]];L.globals.ancillaryCollapsedSeries[G].data=L.globals.axisCharts?H.data.slice():H}k.series.emptyCollapsedSeries(L.config.series)}return k.update(t).then(function(){P===E.length-1&&r(k)})})})}},{key:"_updateSeries",value:function(t,a){var c=this,f=arguments.length>2&&arguments[2]!==void 0&&arguments[2];return new Promise(function(_){var v=c.w;return v.globals.shouldAnimate=a,v.globals.dataChanged=!0,a&&c.ctx.series.getPreviousPaths(),c.ctx.data.resetParsingFlags(),c.ctx.data.parseData(t),f&&(v.globals.initialConfig.series=et.clone(v.config.series),v.globals.initialSeries=et.clone(v.config.series)),c.ctx.update().then(function(){_(c.ctx)})})}},{key:"_extendSeries",value:function(t,a){var c=this.w,f=c.config.series[a];return Jt(Jt({},c.config.series[a]),{},{name:t.name?t.name:f==null?void 0:f.name,color:t.color?t.color:f==null?void 0:f.color,type:t.type?t.type:f==null?void 0:f.type,group:t.group?t.group:f==null?void 0:f.group,hidden:t.hidden!==void 0?t.hidden:f==null?void 0:f.hidden,data:t.data?t.data:f==null?void 0:f.data,zIndex:t.zIndex!==void 0?t.zIndex:a})}},{key:"toggleDataPointSelection",value:function(t,a){var c=this.w,f=null,_=".apexcharts-series[data\\:realIndex='".concat(t,"']");return c.globals.axisCharts?f=c.globals.dom.Paper.findOne("".concat(_," path[j='").concat(a,"'], ").concat(_," circle[j='").concat(a,"'], ").concat(_," rect[j='").concat(a,"']")):a===void 0&&(f=c.globals.dom.Paper.findOne("".concat(_," path[j='").concat(t,"']")),c.config.chart.type!=="pie"&&c.config.chart.type!=="polarArea"&&c.config.chart.type!=="donut"||this.ctx.pie.pieClicked(t)),f?(new Nt(this.ctx).pathMouseDown(f,null),f.node?f.node:null):(console.warn("toggleDataPointSelection: Element not found"),null)}},{key:"forceXAxisUpdate",value:function(t){var a=this.w;if(["min","max"].forEach(function(f){t.xaxis[f]!==void 0&&(a.config.xaxis[f]=t.xaxis[f],a.globals.lastXAxis[f]=t.xaxis[f])}),t.xaxis.categories&&t.xaxis.categories.length&&(a.config.xaxis.categories=t.xaxis.categories),a.config.xaxis.convertedCatToNumeric){var c=new Yf(t);t=c.convertCatToNumericXaxis(t,this.ctx)}return t}},{key:"forceYAxisUpdate",value:function(t){return t.chart&&t.chart.stacked&&t.chart.stackType==="100%"&&(Array.isArray(t.yaxis)?t.yaxis.forEach(function(a,c){t.yaxis[c].min=0,t.yaxis[c].max=100}):(t.yaxis.min=0,t.yaxis.max=100)),t}},{key:"revertDefaultAxisMinMax",value:function(t){var a=this,c=this.w,f=c.globals.lastXAxis,_=c.globals.lastYAxis;t&&t.xaxis&&(f=t.xaxis),t&&t.yaxis&&(_=t.yaxis),c.config.xaxis.min=f.min,c.config.xaxis.max=f.max;var v=function(r){_[r]!==void 0&&(c.config.yaxis[r].min=_[r].min,c.config.yaxis[r].max=_[r].max)};c.config.yaxis.map(function(r,E){c.globals.zoomed||_[E]!==void 0?v(E):a.ctx.opts.yaxis[E]!==void 0&&(r.min=a.ctx.opts.yaxis[E].min,r.max=a.ctx.opts.yaxis[E].max)})}}]),S}();(function(){function S(){for(var _=arguments.length>0&&arguments[0]!==L?arguments[0]:[],v=arguments.length>1?arguments[1]:L,r=arguments.length>2?arguments[2]:L,E=arguments.length>3?arguments[3]:L,k=arguments.length>4?arguments[4]:L,P=arguments.length>5?arguments[5]:L,L=arguments.length>6?arguments[6]:L,O=_.slice(v,r||L),N=E.slice(k,P||L),G=0,H={pos:[0,0],start:[0,0]},Q={pos:[0,0],start:[0,0]};O[G]=t.call(H,O[G]),N[G]=t.call(Q,N[G]),O[G][0]!=N[G][0]||O[G][0]=="M"||O[G][0]=="A"&&(O[G][4]!=N[G][4]||O[G][5]!=N[G][5])?(Array.prototype.splice.apply(O,[G,1].concat(c.call(H,O[G]))),Array.prototype.splice.apply(N,[G,1].concat(c.call(Q,N[G])))):(O[G]=a.call(H,O[G]),N[G]=a.call(Q,N[G])),!(++G==O.length&&G==N.length);)G==O.length&&O.push(["C",H.pos[0],H.pos[1],H.pos[0],H.pos[1],H.pos[0],H.pos[1]]),G==N.length&&N.push(["C",Q.pos[0],Q.pos[1],Q.pos[0],Q.pos[1],Q.pos[0],Q.pos[1]]);return{start:O,dest:N}}function t(_){switch(_[0]){case"z":case"Z":_[0]="L",_[1]=this.start[0],_[2]=this.start[1];break;case"H":_[0]="L",_[2]=this.pos[1];break;case"V":_[0]="L",_[2]=_[1],_[1]=this.pos[0];break;case"T":_[0]="Q",_[3]=_[1],_[4]=_[2],_[1]=this.reflection[1],_[2]=this.reflection[0];break;case"S":_[0]="C",_[6]=_[4],_[5]=_[3],_[4]=_[2],_[3]=_[1],_[2]=this.reflection[1],_[1]=this.reflection[0]}return _}function a(_){var v=_.length;return this.pos=[_[v-2],_[v-1]],"SCQT".indexOf(_[0])!=-1&&(this.reflection=[2*this.pos[0]-_[v-4],2*this.pos[1]-_[v-3]]),_}function c(_){var v=[_];switch(_[0]){case"M":return this.pos=this.start=[_[1],_[2]],v;case"L":_[5]=_[3]=_[1],_[6]=_[4]=_[2],_[1]=this.pos[0],_[2]=this.pos[1];break;case"Q":_[6]=_[4],_[5]=_[3],_[4]=1*_[4]/3+2*_[2]/3,_[3]=1*_[3]/3+2*_[1]/3,_[2]=1*this.pos[1]/3+2*_[2]/3,_[1]=1*this.pos[0]/3+2*_[1]/3;break;case"A":v=function(r,E){var k,P,L,O,N,G,H,Q,ee,ie,ue,ve,ce,Te,Se,Ie,Ue,Ke,qe,ft,bt,Tt,Et,Lt,qt,ui,Ti=Math.abs(E[1]),vi=Math.abs(E[2]),Kt=E[3]%360,Hi=E[4],Br=E[5],ar=E[6],Xr=E[7],mi=new $r(r),Ci=new $r(ar,Xr),zi=[];if(Ti===0||vi===0||mi.x===Ci.x&&mi.y===Ci.y)return[["C",mi.x,mi.y,Ci.x,Ci.y,Ci.x,Ci.y]];for(k=new $r((mi.x-Ci.x)/2,(mi.y-Ci.y)/2).transform(new Ni().rotate(Kt)),P=k.x*k.x/(Ti*Ti)+k.y*k.y/(vi*vi),P>1&&(Ti*=P=Math.sqrt(P),vi*=P),L=new Ni().rotate(Kt).scale(1/Ti,1/vi).rotate(-Kt),mi=mi.transform(L),Ci=Ci.transform(L),O=[Ci.x-mi.x,Ci.y-mi.y],G=O[0]*O[0]+O[1]*O[1],N=Math.sqrt(G),O[0]/=N,O[1]/=N,H=G<4?Math.sqrt(1-G/4):0,Hi===Br&&(H*=-1),Q=new $r((Ci.x+mi.x)/2+H*-O[1],(Ci.y+mi.y)/2+H*O[0]),ee=new $r(mi.x-Q.x,mi.y-Q.y),ie=new $r(Ci.x-Q.x,Ci.y-Q.y),ue=Math.acos(ee.x/Math.sqrt(ee.x*ee.x+ee.y*ee.y)),ee.y<0&&(ue*=-1),ve=Math.acos(ie.x/Math.sqrt(ie.x*ie.x+ie.y*ie.y)),ie.y<0&&(ve*=-1),Br&&ue>ve&&(ve+=2*Math.PI),!Br&&ue<ve&&(ve-=2*Math.PI),Te=Math.ceil(2*Math.abs(ue-ve)/Math.PI),Ie=[],Ue=ue,ce=(ve-ue)/Te,Se=4*Math.tan(ce/4)/3,bt=0;bt<=Te;bt++)qe=Math.cos(Ue),Ke=Math.sin(Ue),ft=new $r(Q.x+qe,Q.y+Ke),Ie[bt]=[new $r(ft.x+Se*Ke,ft.y-Se*qe),ft,new $r(ft.x-Se*Ke,ft.y+Se*qe)],Ue+=ce;for(Ie[0][0]=Ie[0][1].clone(),Ie[Ie.length-1][2]=Ie[Ie.length-1][1].clone(),L=new Ni().rotate(Kt).scale(Ti,vi).rotate(-Kt),bt=0,Tt=Ie.length;bt<Tt;bt++)Ie[bt][0]=Ie[bt][0].transform(L),Ie[bt][1]=Ie[bt][1].transform(L),Ie[bt][2]=Ie[bt][2].transform(L);for(bt=1,Tt=Ie.length;bt<Tt;bt++)Et=(ft=Ie[bt-1][2]).x,Lt=ft.y,qt=(ft=Ie[bt][0]).x,ui=ft.y,ar=(ft=Ie[bt][1]).x,Xr=ft.y,zi.push(["C",Et,Lt,qt,ui,ar,Xr]);return zi}(this.pos,_),_=v[0]}return _[0]="C",this.pos=[_[5],_[6]],this.reflection=[2*_[5]-_[3],2*_[6]-_[4]],v}function f(){var _=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],v=arguments.length>1?arguments[1]:void 0;if(v===!1)return!1;for(var r=v,E=_.length;r<E;++r)if(_[r][0]=="M")return r;return!1}Xi(za,{morph:function(_,v,r,E,k){for(var P=this.parse(_),L=this.parse(v),O=0,N=0,G=!1,H=!1;O!==!1||N!==!1;){var Q;G=f(P,O!==!1&&O+1),H=f(L,N!==!1&&N+1),O===!1&&(O=(Q=new za(ee.start).bbox()).height==0||Q.width==0?P.push(P[0])-1:P.push(["M",Q.x+Q.width/2,Q.y+Q.height/2])-1),N===!1&&(N=(Q=new za(ee.dest).bbox()).height==0||Q.width==0?L.push(L[0])-1:L.push(["M",Q.x+Q.width/2,Q.y+Q.height/2])-1);var ee=S(P,O,G,L,N,H);P=P.slice(0,O).concat(ee.start,G===!1?[]:P.slice(G)),L=L.slice(0,N).concat(ee.dest,H===!1?[]:L.slice(H)),O=G!==!1&&O+ee.start.length,N=H!==!1&&N+ee.dest.length}this._array=P,this.destination=new za,this.destination._array=L;var ie=this.fromArray(P.map(function(ue,ve){var ce=L[ve].map(function(Te,Se){return Se===0?Te:E.step(ue[Se],L[ve][Se],r,k[ve],k)});return ce}));return ie}})})();const Iw=S=>(S.changedTouches&&(S=S.changedTouches[0]),{x:S.clientX,y:S.clientY});class fC{constructor(t){t.remember("_draggable",this),this.el=t,this.drag=this.drag.bind(this),this.startDrag=this.startDrag.bind(this),this.endDrag=this.endDrag.bind(this)}init(t){t?(this.el.on("mousedown.drag",this.startDrag),this.el.on("touchstart.drag",this.startDrag,{passive:!1})):(this.el.off("mousedown.drag"),this.el.off("touchstart.drag"))}startDrag(t){const a=!t.type.indexOf("mouse");if(a&&t.which!==1&&t.buttons!==0||this.el.dispatch("beforedrag",{event:t,handler:this}).defaultPrevented)return;t.preventDefault(),t.stopPropagation(),this.init(!1),this.box=this.el.bbox(),this.lastClick=this.el.point(Iw(t));const c=(a?"mouseup":"touchend")+".drag";Go(window,(a?"mousemove":"touchmove")+".drag",this.drag,this,{passive:!1}),Go(window,c,this.endDrag,this,{passive:!1}),this.el.fire("dragstart",{event:t,handler:this,box:this.box})}drag(t){const{box:a,lastClick:c}=this,f=this.el.point(Iw(t)),_=f.x-c.x,v=f.y-c.y;if(!_&&!v)return a;const r=a.x+_,E=a.y+v;this.box=new Cs(r,E,a.w,a.h),this.lastClick=f,this.el.dispatch("dragmove",{event:t,handler:this,box:this.box}).defaultPrevented||this.move(r,E)}move(t,a){this.el.type==="svg"?Ul.prototype.move.call(this.el,t,a):this.el.move(t,a)}endDrag(t){this.drag(t),this.el.fire("dragend",{event:t,handler:this,box:this.box}),da(window,"mousemove.drag"),da(window,"touchmove.drag"),da(window,"mouseup.drag"),da(window,"touchend.drag"),this.init(!0)}}/*!
* @svgdotjs/svg.select.js - An extension of svg.js which allows to select elements with mouse
* @version 4.0.1
* https://github.com/svgdotjs/svg.select.js
*
* @copyright Ulrich-Matthias Schfer
* @license MIT
*
* BUILT: Mon Jul 01 2024 15:04:42 GMT+0200 (Central European Summer Time)
*/function Jy(S,t,a,c=null){return function(f){f.preventDefault(),f.stopPropagation();var _=f.pageX||f.touches[0].pageX,v=f.pageY||f.touches[0].pageY;t.fire(S,{x:_,y:v,event:f,index:c,points:a})}}function Ky([S,t],{a,b:c,c:f,d:_,e:v,f:r}){return[S*a+t*f+v,S*c+t*_+r]}Xi(sn,{draggable(S=!0){return(this.remember("_draggable")||new fC(this)).init(S),this}});let F1=class{constructor(S){this.el=S,S.remember("_selectHandler",this),this.selection=new Ul,this.order=["lt","t","rt","r","rb","b","lb","l","rot"],this.mutationHandler=this.mutationHandler.bind(this);const t=Kf();this.observer=new t.MutationObserver(this.mutationHandler)}init(S){this.createHandle=S.createHandle||this.createHandleFn,this.createRot=S.createRot||this.createRotFn,this.updateHandle=S.updateHandle||this.updateHandleFn,this.updateRot=S.updateRot||this.updateRotFn,this.el.root().put(this.selection),this.updatePoints(),this.createSelection(),this.createResizeHandles(),this.updateResizeHandles(),this.createRotationHandle(),this.updateRotationHandle(),this.observer.observe(this.el.node,{attributes:!0})}active(S,t){if(!S)return this.selection.clear().remove(),void this.observer.disconnect();this.init(t)}createSelection(){this.selection.polygon(this.handlePoints).addClass("svg_select_shape")}updateSelection(){this.selection.get(0).plot(this.handlePoints)}createResizeHandles(){this.handlePoints.forEach((S,t,a)=>{const c=this.order[t];this.createHandle.call(this,this.selection,S,t,a,c),this.selection.get(t+1).addClass("svg_select_handle svg_select_handle_"+c).on("mousedown.selection touchstart.selection",Jy(c,this.el,this.handlePoints,t))})}createHandleFn(S){S.polyline()}updateHandleFn(S,t,a,c){const f=c.at(a-1),_=c[(a+1)%c.length],v=t,r=[v[0]-f[0],v[1]-f[1]],E=[v[0]-_[0],v[1]-_[1]],k=Math.sqrt(r[0]*r[0]+r[1]*r[1]),P=Math.sqrt(E[0]*E[0]+E[1]*E[1]),L=[r[0]/k,r[1]/k],O=[E[0]/P,E[1]/P],N=[v[0]-10*L[0],v[1]-10*L[1]],G=[v[0]-10*O[0],v[1]-10*O[1]];S.plot([N,v,G])}updateResizeHandles(){this.handlePoints.forEach((S,t,a)=>{const c=this.order[t];this.updateHandle.call(this,this.selection.get(t+1),S,t,a,c)})}createRotFn(S){S.line(),S.circle(5)}getPoint(S){return this.handlePoints[this.order.indexOf(S)]}getPointHandle(S){return this.selection.get(this.order.indexOf(S)+1)}updateRotFn(S,t){const a=this.getPoint("t");S.get(0).plot(a[0],a[1],t[0],t[1]),S.get(1).center(t[0],t[1])}createRotationHandle(){const S=this.selection.group().addClass("svg_select_handle_rot").on("mousedown.selection touchstart.selection",Jy("rot",this.el,this.handlePoints));this.createRot.call(this,S)}updateRotationHandle(){const S=this.selection.findOne("g.svg_select_handle_rot");this.updateRot(S,this.rotationPoint,this.handlePoints)}updatePoints(){const S=this.el.bbox(),t=this.el.parent().screenCTM().inverseO().multiplyO(this.el.screenCTM());this.handlePoints=this.getHandlePoints(S).map(a=>Ky(a,t)),this.rotationPoint=Ky(this.getRotationPoint(S),t)}getHandlePoints({x:S,x2:t,y:a,y2:c,cx:f,cy:_}=this.el.bbox()){return[[S,a],[f,a],[t,a],[t,_],[t,c],[f,c],[S,c],[S,_]]}getRotationPoint({y:S,cx:t}=this.el.bbox()){return[t,S-20]}mutationHandler(){this.updatePoints(),this.updateSelection(),this.updateResizeHandles(),this.updateRotationHandle()}};const kw=S=>function(t=!0,a={}){typeof t=="object"&&(a=t,t=!0);let c=this.remember("_"+S.name);return c||(t.prototype instanceof F1?(c=new t(this),t=!0):c=new S(this),this.remember("_"+S.name,c)),c.active(t,a),this};/*!
* @svgdotjs/svg.resize.js - An extension for svg.js which allows to resize elements which are selected
* @version 2.0.4
* https://github.com/svgdotjs/svg.resize.js
*
* @copyright [object Object]
* @license MIT
*
* BUILT: Fri Sep 13 2024 12:43:14 GMT+0200 (Central European Summer Time)
*//*!
* @svgdotjs/svg.select.js - An extension of svg.js which allows to select elements with mouse
* @version 4.0.1
* https://github.com/svgdotjs/svg.select.js
*
* @copyright Ulrich-Matthias Schfer
* @license MIT
*
* BUILT: Mon Jul 01 2024 15:04:42 GMT+0200 (Central European Summer Time)
*/function Qy(S,t,a,c=null){return function(f){f.preventDefault(),f.stopPropagation();var _=f.pageX||f.touches[0].pageX,v=f.pageY||f.touches[0].pageY;t.fire(S,{x:_,y:v,event:f,index:c,points:a})}}function ex([S,t],{a,b:c,c:f,d:_,e:v,f:r}){return[S*a+t*f+v,S*c+t*_+r]}Xi(sn,{select:kw(F1)}),Xi([qc,Zc,Yc],{pointSelect:kw(class{constructor(S){this.el=S,S.remember("_pointSelectHandler",this),this.selection=new Ul,this.order=["lt","t","rt","r","rb","b","lb","l","rot"],this.mutationHandler=this.mutationHandler.bind(this);const t=Kf();this.observer=new t.MutationObserver(this.mutationHandler)}init(S){this.createHandle=S.createHandle||this.createHandleFn,this.updateHandle=S.updateHandle||this.updateHandleFn,this.el.root().put(this.selection),this.updatePoints(),this.createSelection(),this.createPointHandles(),this.updatePointHandles(),this.observer.observe(this.el.node,{attributes:!0})}active(S,t){if(!S)return this.selection.clear().remove(),void this.observer.disconnect();this.init(t)}createSelection(){this.selection.polygon(this.points).addClass("svg_select_shape_pointSelect")}updateSelection(){this.selection.get(0).plot(this.points)}createPointHandles(){this.points.forEach((S,t,a)=>{this.createHandle.call(this,this.selection,S,t,a),this.selection.get(t+1).addClass("svg_select_handle_point").on("mousedown.selection touchstart.selection",Jy("point",this.el,this.points,t))})}createHandleFn(S){S.circle(5)}updateHandleFn(S,t){S.center(t[0],t[1])}updatePointHandles(){this.points.forEach((S,t,a)=>{this.updateHandle.call(this,this.selection.get(t+1),S,t,a)})}updatePoints(){const S=this.el.parent().screenCTM().inverseO().multiplyO(this.el.screenCTM());this.points=this.el.array().map(t=>Ky(t,S))}mutationHandler(){this.updatePoints(),this.updateSelection(),this.updatePointHandles()}})});class B1{constructor(t){this.el=t,t.remember("_selectHandler",this),this.selection=new Ul,this.order=["lt","t","rt","r","rb","b","lb","l","rot"],this.mutationHandler=this.mutationHandler.bind(this);const a=Kf();this.observer=new a.MutationObserver(this.mutationHandler)}init(t){this.createHandle=t.createHandle||this.createHandleFn,this.createRot=t.createRot||this.createRotFn,this.updateHandle=t.updateHandle||this.updateHandleFn,this.updateRot=t.updateRot||this.updateRotFn,this.el.root().put(this.selection),this.updatePoints(),this.createSelection(),this.createResizeHandles(),this.updateResizeHandles(),this.createRotationHandle(),this.updateRotationHandle(),this.observer.observe(this.el.node,{attributes:!0})}active(t,a){if(!t)return this.selection.clear().remove(),void this.observer.disconnect();this.init(a)}createSelection(){this.selection.polygon(this.handlePoints).addClass("svg_select_shape")}updateSelection(){this.selection.get(0).plot(this.handlePoints)}createResizeHandles(){this.handlePoints.forEach((t,a,c)=>{const f=this.order[a];this.createHandle.call(this,this.selection,t,a,c,f),this.selection.get(a+1).addClass("svg_select_handle svg_select_handle_"+f).on("mousedown.selection touchstart.selection",Qy(f,this.el,this.handlePoints,a))})}createHandleFn(t){t.polyline()}updateHandleFn(t,a,c,f){const _=f.at(c-1),v=f[(c+1)%f.length],r=a,E=[r[0]-_[0],r[1]-_[1]],k=[r[0]-v[0],r[1]-v[1]],P=Math.sqrt(E[0]*E[0]+E[1]*E[1]),L=Math.sqrt(k[0]*k[0]+k[1]*k[1]),O=[E[0]/P,E[1]/P],N=[k[0]/L,k[1]/L],G=[r[0]-10*O[0],r[1]-10*O[1]],H=[r[0]-10*N[0],r[1]-10*N[1]];t.plot([G,r,H])}updateResizeHandles(){this.handlePoints.forEach((t,a,c)=>{const f=this.order[a];this.updateHandle.call(this,this.selection.get(a+1),t,a,c,f)})}createRotFn(t){t.line(),t.circle(5)}getPoint(t){return this.handlePoints[this.order.indexOf(t)]}getPointHandle(t){return this.selection.get(this.order.indexOf(t)+1)}updateRotFn(t,a){const c=this.getPoint("t");t.get(0).plot(c[0],c[1],a[0],a[1]),t.get(1).center(a[0],a[1])}createRotationHandle(){const t=this.selection.group().addClass("svg_select_handle_rot").on("mousedown.selection touchstart.selection",Qy("rot",this.el,this.handlePoints));this.createRot.call(this,t)}updateRotationHandle(){const t=this.selection.findOne("g.svg_select_handle_rot");this.updateRot(t,this.rotationPoint,this.handlePoints)}updatePoints(){const t=this.el.bbox(),a=this.el.parent().screenCTM().inverseO().multiplyO(this.el.screenCTM());this.handlePoints=this.getHandlePoints(t).map(c=>ex(c,a)),this.rotationPoint=ex(this.getRotationPoint(t),a)}getHandlePoints({x:t,x2:a,y:c,y2:f,cx:_,cy:v}=this.el.bbox()){return[[t,c],[_,c],[a,c],[a,v],[a,f],[_,f],[t,f],[t,v]]}getRotationPoint({y:t,cx:a}=this.el.bbox()){return[a,t-20]}mutationHandler(){this.updatePoints(),this.updateSelection(),this.updateResizeHandles(),this.updateRotationHandle()}}const Mw=S=>function(t=!0,a={}){typeof t=="object"&&(a=t,t=!0);let c=this.remember("_"+S.name);return c||(t.prototype instanceof B1?(c=new t(this),t=!0):c=new S(this),this.remember("_"+S.name,c)),c.active(t,a),this};Xi(sn,{select:Mw(B1)}),Xi([qc,Zc,Yc],{pointSelect:Mw(class{constructor(S){this.el=S,S.remember("_pointSelectHandler",this),this.selection=new Ul,this.order=["lt","t","rt","r","rb","b","lb","l","rot"],this.mutationHandler=this.mutationHandler.bind(this);const t=Kf();this.observer=new t.MutationObserver(this.mutationHandler)}init(S){this.createHandle=S.createHandle||this.createHandleFn,this.updateHandle=S.updateHandle||this.updateHandleFn,this.el.root().put(this.selection),this.updatePoints(),this.createSelection(),this.createPointHandles(),this.updatePointHandles(),this.observer.observe(this.el.node,{attributes:!0})}active(S,t){if(!S)return this.selection.clear().remove(),void this.observer.disconnect();this.init(t)}createSelection(){this.selection.polygon(this.points).addClass("svg_select_shape_pointSelect")}updateSelection(){this.selection.get(0).plot(this.points)}createPointHandles(){this.points.forEach((S,t,a)=>{this.createHandle.call(this,this.selection,S,t,a),this.selection.get(t+1).addClass("svg_select_handle_point").on("mousedown.selection touchstart.selection",Qy("point",this.el,this.points,t))})}createHandleFn(S){S.circle(5)}updateHandleFn(S,t){S.center(t[0],t[1])}updatePointHandles(){this.points.forEach((S,t,a)=>{this.updateHandle.call(this,this.selection.get(t+1),S,t,a)})}updatePoints(){const S=this.el.parent().screenCTM().inverseO().multiplyO(this.el.screenCTM());this.points=this.el.array().map(t=>ex(t,S))}mutationHandler(){this.updatePoints(),this.updateSelection(),this.updatePointHandles()}})});const Jg=S=>(S.changedTouches&&(S=S.changedTouches[0]),{x:S.clientX,y:S.clientY}),Pw=S=>{let t=1/0,a=1/0,c=-1/0,f=-1/0;for(let _=0;_<S.length;_++){const v=S[_];t=Math.min(t,v[0]),a=Math.min(a,v[1]),c=Math.max(c,v[0]),f=Math.max(f,v[1])}return new Cs(t,a,c-t,f-a)};class Lw{constructor(t){this.el=t,t.remember("_ResizeHandler",this),this.lastCoordinates=null,this.eventType="",this.lastEvent=null,this.handleResize=this.handleResize.bind(this),this.resize=this.resize.bind(this),this.endResize=this.endResize.bind(this),this.rotate=this.rotate.bind(this),this.movePoint=this.movePoint.bind(this)}active(t,a){var c,f,_,v;this.preserveAspectRatio=(c=a.preserveAspectRatio)!=null?c:!1,this.aroundCenter=(f=a.aroundCenter)!=null?f:!1,this.grid=(_=a.grid)!=null?_:0,this.degree=(v=a.degree)!=null?v:0,this.el.off(".resize"),t&&(this.el.on(["lt.resize","rt.resize","rb.resize","lb.resize","t.resize","r.resize","b.resize","l.resize","rot.resize","point.resize"],this.handleResize),this.lastEvent&&(this.eventType==="rot"?this.rotate(this.lastEvent):this.eventType==="point"?this.movePoint(this.lastEvent):this.resize(this.lastEvent)))}handleResize(t){this.eventType=t.type;const{event:a,index:c,points:f}=t.detail,_=!a.type.indexOf("mouse");if(_&&(a.which||a.buttons)!==1||this.el.dispatch("beforeresize",{event:t,handler:this}).defaultPrevented)return;this.box=this.el.bbox(),this.startPoint=this.el.point(Jg(a)),this.index=c,this.points=f.slice();const v=(_?"mousemove":"touchmove")+".resize",r=(_?"mouseup":"touchcancel.resize touchend")+".resize";t.type==="point"?Go(window,v,this.movePoint):t.type==="rot"?Go(window,v,this.rotate):Go(window,v,this.resize),Go(window,r,this.endResize)}resize(t){this.lastEvent=t;const a=this.snapToGrid(this.el.point(Jg(t)));let c=a.x-this.startPoint.x,f=a.y-this.startPoint.y;this.preserveAspectRatio&&this.aroundCenter&&(c*=2,f*=2);const _=this.box.x+c,v=this.box.y+f,r=this.box.x2+c,E=this.box.y2+f;let k=new Cs(this.box);if(this.eventType.includes("l")&&(k.x=Math.min(_,this.box.x2),k.x2=Math.max(_,this.box.x2)),this.eventType.includes("r")&&(k.x=Math.min(r,this.box.x),k.x2=Math.max(r,this.box.x)),this.eventType.includes("t")&&(k.y=Math.min(v,this.box.y2),k.y2=Math.max(v,this.box.y2)),this.eventType.includes("b")&&(k.y=Math.min(E,this.box.y),k.y2=Math.max(E,this.box.y)),k.width=k.x2-k.x,k.height=k.y2-k.y,this.preserveAspectRatio){const P=k.width/this.box.width,L=k.height/this.box.height,O=["lt","t","rt","r","rb","b","lb","l"],N=(O.indexOf(this.eventType)+4)%O.length,G=this.aroundCenter?[this.box.cx,this.box.cy]:this.points[N];let H=this.eventType.includes("t")||this.eventType.includes("b")?L:P;H=this.eventType.length===2?Math.max(P,L):H,k=function(Q,ee,ie){const ue=[[Q.x,Q.y],[Q.x+Q.width,Q.y],[Q.x+Q.width,Q.y+Q.height],[Q.x,Q.y+Q.height]].map(([ve,ce])=>{const Te=ve-ee[0],Se=(ce-ee[1])*ie;return[Te*ie+ee[0],Se+ee[1]]});return Pw(ue)}(this.box,G,H)}this.el.dispatch("resize",{box:new Cs(k),angle:0,eventType:this.eventType,event:t,handler:this}).defaultPrevented||this.el.size(k.width,k.height).move(k.x,k.y)}movePoint(t){this.lastEvent=t;const{x:a,y:c}=this.snapToGrid(this.el.point(Jg(t))),f=this.el.array().slice();f[this.index]=[a,c],this.el.dispatch("resize",{box:Pw(f),angle:0,eventType:this.eventType,event:t,handler:this}).defaultPrevented||this.el.plot(f)}rotate(t){this.lastEvent=t;const a=this.startPoint,c=this.el.point(Jg(t)),{cx:f,cy:_}=this.box,v=a.x-f,r=a.y-_,E=c.x-f,k=c.y-_,P=Math.sqrt(v*v+r*r)*Math.sqrt(E*E+k*k);if(P===0)return;let L=Math.acos((v*E+r*k)/P)/Math.PI*180;if(!L)return;c.x<a.x&&(L=-L);const O=new Ni(this.el),{x:N,y:G}=new $r(f,_).transformO(O),{rotate:H}=O.decompose(),Q=this.snapToAngle(H+L)-H;this.el.dispatch("resize",{box:this.box,angle:Q,eventType:this.eventType,event:t,handler:this}).defaultPrevented||this.el.transform(O.rotateO(Q,N,G))}endResize(t){this.eventType!=="rot"&&this.eventType!=="point"&&this.resize(t),this.lastEvent=null,this.eventType="",da(window,"mousemove.resize touchmove.resize"),da(window,"mouseup.resize touchend.resize")}snapToGrid(t){return this.grid&&(t.x=Math.round(t.x/this.grid)*this.grid,t.y=Math.round(t.y/this.grid)*this.grid),t}snapToAngle(t){return this.degree&&(t=Math.round(t/this.degree)*this.degree),t}}Xi(sn,{resize:function(S=!0,t={}){typeof S=="object"&&(t=S,S=!0);let a=this.remember("_ResizeHandler");return a||(S.prototype instanceof Lw?(a=new S(this),S=!0):a=new Lw(this),this.remember("_resizeHandler",a)),a.active(S,t),this}}),window.SVG===void 0&&(window.SVG=IE),window.Apex===void 0&&(window.Apex={});var zw=function(){function S(t){pi(this,S),this.ctx=t,this.w=t.w}return gi(S,[{key:"initModules",value:function(){this.ctx.publicMethods=["updateOptions","updateSeries","appendData","appendSeries","isSeriesHidden","highlightSeries","toggleSeries","showSeries","hideSeries","setLocale","resetSeries","zoomX","toggleDataPointSelection","dataURI","exportToCSV","addXaxisAnnotation","addYaxisAnnotation","addPointAnnotation","clearAnnotations","removeAnnotation","paper","destroy"],this.ctx.eventList=["click","mousedown","mousemove","mouseleave","touchstart","touchmove","touchleave","mouseup","touchend"],this.ctx.animations=new Nu(this.ctx),this.ctx.axes=new BE(this.ctx),this.ctx.core=new uC(this.ctx.el,this.ctx),this.ctx.config=new qf({}),this.ctx.data=new gx(this.ctx),this.ctx.grid=new C1(this.ctx),this.ctx.graphics=new Nt(this.ctx),this.ctx.coreUtils=new Is(this.ctx),this.ctx.crosshairs=new $y(this.ctx),this.ctx.events=new OE(this.ctx),this.ctx.exports=new Hf(this.ctx),this.ctx.fill=new Da(this.ctx),this.ctx.localization=new FE(this.ctx),this.ctx.options=new Xc,this.ctx.responsive=new NE(this.ctx),this.ctx.series=new fa(this.ctx),this.ctx.theme=new VE(this.ctx),this.ctx.formatters=new tp(this.ctx),this.ctx.titleSubtitle=new UE(this.ctx),this.ctx.legend=new k1(this.ctx),this.ctx.toolbar=new M1(this.ctx),this.ctx.tooltip=new Ew(this.ctx),this.ctx.dimensions=new um(this.ctx),this.ctx.updateHelpers=new dC(this.ctx),this.ctx.zoomPanSelection=new YE(this.ctx),this.ctx.w.globals.tooltip=new Ew(this.ctx)}}]),S}(),Rw=function(){function S(t){pi(this,S),this.ctx=t,this.w=t.w}return gi(S,[{key:"clear",value:function(t){var a=t.isUpdating;this.ctx.zoomPanSelection&&this.ctx.zoomPanSelection.destroy(),this.ctx.toolbar&&this.ctx.toolbar.destroy(),this.ctx.animations=null,this.ctx.axes=null,this.ctx.annotations=null,this.ctx.core=null,this.ctx.data=null,this.ctx.grid=null,this.ctx.series=null,this.ctx.responsive=null,this.ctx.theme=null,this.ctx.formatters=null,this.ctx.titleSubtitle=null,this.ctx.legend=null,this.ctx.dimensions=null,this.ctx.options=null,this.ctx.crosshairs=null,this.ctx.zoomPanSelection=null,this.ctx.updateHelpers=null,this.ctx.toolbar=null,this.ctx.localization=null,this.ctx.w.globals.tooltip=null,this.clearDomElements({isUpdating:a})}},{key:"killSVG",value:function(t){t.each(function(){this.removeClass("*"),this.off()},!0),t.clear()}},{key:"clearDomElements",value:function(t){var a=this,c=t.isUpdating,f=this.w.globals.dom.Paper.node;f.parentNode&&f.parentNode.parentNode&&!c&&(f.parentNode.parentNode.style.minHeight="unset");var _=this.w.globals.dom.baseEl;_&&this.ctx.eventList.forEach(function(r){_.removeEventListener(r,a.ctx.events.documentEvent)});var v=this.w.globals.dom;if(this.ctx.el!==null)for(;this.ctx.el.firstChild;)this.ctx.el.removeChild(this.ctx.el.firstChild);this.killSVG(v.Paper),v.Paper.remove(),v.elWrap=null,v.elGraphical=null,v.elLegendWrap=null,v.elLegendForeign=null,v.baseEl=null,v.elGridRect=null,v.elGridRectMask=null,v.elGridRectBarMask=null,v.elGridRectMarkerMask=null,v.elForecastMask=null,v.elNonForecastMask=null,v.elDefs=null}}]),S}(),zy=new WeakMap,pC=function(){function S(t,a){pi(this,S),this.opts=a,this.ctx=this,this.w=new DE(a).init(),this.el=t,this.w.globals.cuid=et.randomId(),this.w.globals.chartID=this.w.config.chart.id?et.escapeString(this.w.config.chart.id):this.w.globals.cuid,new zw(this).initModules(),this.lastUpdateOptions=null,this.create=et.bind(this.create,this),this.windowResizeHandler=this._windowResizeHandler.bind(this),this.parentResizeHandler=this._parentResizeCallback.bind(this)}return gi(S,[{key:"render",value:function(){var t=this;return new Promise(function(a,c){if(et.elementExists(t.el)){Apex._chartInstances===void 0&&(Apex._chartInstances=[]),t.w.config.chart.id&&Apex._chartInstances.push({id:t.w.globals.chartID,group:t.w.config.chart.group,chart:t}),t.setLocale(t.w.config.chart.defaultLocale);var f=t.w.config.chart.events.beforeMount;typeof f=="function"&&f(t,t.w),t.events.fireEvent("beforeMount",[t,t.w]),window.addEventListener("resize",t.windowResizeHandler),function(O,N){var G=!1;if(O.nodeType!==Node.DOCUMENT_FRAGMENT_NODE){var H=O.getBoundingClientRect();O.style.display!=="none"&&H.width!==0||(G=!0)}var Q=new ResizeObserver(function(ee){G&&N.call(O,ee),G=!0});O.nodeType===Node.DOCUMENT_FRAGMENT_NODE?Array.from(O.children).forEach(function(ee){return Q.observe(ee)}):Q.observe(O),zy.set(N,Q)}(t.el.parentNode,t.parentResizeHandler);var _=t.el.getRootNode&&t.el.getRootNode(),v=et.is("ShadowRoot",_),r=t.el.ownerDocument,E=v?_.getElementById("apexcharts-css"):r.getElementById("apexcharts-css");if(!E){var k;(E=document.createElement("style")).id="apexcharts-css",E.textContent=`@keyframes opaque {
  0% {
    opacity: 0
  }

  to {
    opacity: 1
  }
}

@keyframes resizeanim {

  0%,
  to {
    opacity: 0
  }
}

.apexcharts-canvas {
  position: relative;
  direction: ltr !important;
  user-select: none
}

.apexcharts-canvas ::-webkit-scrollbar {
  -webkit-appearance: none;
  width: 6px
}

.apexcharts-canvas ::-webkit-scrollbar-thumb {
  border-radius: 4px;
  background-color: rgba(0, 0, 0, .5);
  box-shadow: 0 0 1px rgba(255, 255, 255, .5);
  -webkit-box-shadow: 0 0 1px rgba(255, 255, 255, .5)
}

.apexcharts-inner {
  position: relative
}

.apexcharts-text tspan {
  font-family: inherit
}

rect.legend-mouseover-inactive,
.legend-mouseover-inactive rect,
.legend-mouseover-inactive path,
.legend-mouseover-inactive circle,
.legend-mouseover-inactive line,
.legend-mouseover-inactive text.apexcharts-yaxis-title-text,
.legend-mouseover-inactive text.apexcharts-yaxis-label {
  transition: .15s ease all;
  opacity: .2
}

.apexcharts-legend-text {
  padding-left: 15px;
  margin-left: -15px;
}

.apexcharts-series-collapsed {
  opacity: 0
}

.apexcharts-tooltip {
  border-radius: 5px;
  box-shadow: 2px 2px 6px -4px #999;
  cursor: default;
  font-size: 14px;
  left: 62px;
  opacity: 0;
  pointer-events: none;
  position: absolute;
  top: 20px;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  white-space: nowrap;
  z-index: 12;
  transition: .15s ease all
}

.apexcharts-tooltip.apexcharts-active {
  opacity: 1;
  transition: .15s ease all
}

.apexcharts-tooltip.apexcharts-theme-light {
  border: 1px solid #e3e3e3;
  background: rgba(255, 255, 255, .96)
}

.apexcharts-tooltip.apexcharts-theme-dark {
  color: #fff;
  background: rgba(30, 30, 30, .8)
}

.apexcharts-tooltip * {
  font-family: inherit
}

.apexcharts-tooltip-title {
  padding: 6px;
  font-size: 15px;
  margin-bottom: 4px
}

.apexcharts-tooltip.apexcharts-theme-light .apexcharts-tooltip-title {
  background: #eceff1;
  border-bottom: 1px solid #ddd
}

.apexcharts-tooltip.apexcharts-theme-dark .apexcharts-tooltip-title {
  background: rgba(0, 0, 0, .7);
  border-bottom: 1px solid #333
}

.apexcharts-tooltip-text-goals-value,
.apexcharts-tooltip-text-y-value,
.apexcharts-tooltip-text-z-value {
  display: inline-block;
  margin-left: 5px;
  font-weight: 600
}

.apexcharts-tooltip-text-goals-label:empty,
.apexcharts-tooltip-text-goals-value:empty,
.apexcharts-tooltip-text-y-label:empty,
.apexcharts-tooltip-text-y-value:empty,
.apexcharts-tooltip-text-z-value:empty,
.apexcharts-tooltip-title:empty {
  display: none
}

.apexcharts-tooltip-text-goals-label,
.apexcharts-tooltip-text-goals-value {
  padding: 6px 0 5px
}

.apexcharts-tooltip-goals-group,
.apexcharts-tooltip-text-goals-label,
.apexcharts-tooltip-text-goals-value {
  display: flex
}

.apexcharts-tooltip-text-goals-label:not(:empty),
.apexcharts-tooltip-text-goals-value:not(:empty) {
  margin-top: -6px
}

.apexcharts-tooltip-marker {
  display: inline-block;
  position: relative;
  width: 16px;
  height: 16px;
  font-size: 16px;
  line-height: 16px;
  margin-right: 4px;
  text-align: center;
  vertical-align: middle;
  color: inherit;
}

.apexcharts-tooltip-marker::before {
  content: "";
  display: inline-block;
  width: 100%;
  text-align: center;
  color: currentcolor;
  text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;
  font-size: 26px;
  font-family: Arial, Helvetica, sans-serif;
  line-height: 14px;
  font-weight: 900;
}

.apexcharts-tooltip-marker[shape="circle"]::before {
  content: "\\25CF";
}

.apexcharts-tooltip-marker[shape="square"]::before,
.apexcharts-tooltip-marker[shape="rect"]::before {
  content: "\\25A0";
  transform: translate(-1px, -2px);
}

.apexcharts-tooltip-marker[shape="line"]::before {
  content: "\\2500";
}

.apexcharts-tooltip-marker[shape="diamond"]::before {
  content: "\\25C6";
  font-size: 28px;
}

.apexcharts-tooltip-marker[shape="triangle"]::before {
  content: "\\25B2";
  font-size: 22px;
}

.apexcharts-tooltip-marker[shape="cross"]::before {
  content: "\\2715";
  font-size: 18px;
}

.apexcharts-tooltip-marker[shape="plus"]::before {
  content: "\\2715";
  transform: rotate(45deg) translate(-1px, -1px);
  font-size: 18px;
}

.apexcharts-tooltip-marker[shape="star"]::before {
  content: "\\2605";
  font-size: 18px;
}

.apexcharts-tooltip-marker[shape="sparkle"]::before {
  content: "\\2726";
  font-size: 20px;
}

.apexcharts-tooltip-series-group {
  padding: 0 10px;
  display: none;
  text-align: left;
  justify-content: left;
  align-items: center
}

.apexcharts-tooltip-series-group.apexcharts-active .apexcharts-tooltip-marker {
  opacity: 1
}

.apexcharts-tooltip-series-group.apexcharts-active,
.apexcharts-tooltip-series-group:last-child {
  padding-bottom: 4px
}

.apexcharts-tooltip-y-group {
  padding: 6px 0 5px
}

.apexcharts-custom-tooltip,
.apexcharts-tooltip-box {
  padding: 4px 8px
}

.apexcharts-tooltip-boxPlot {
  display: flex;
  flex-direction: column-reverse
}

.apexcharts-tooltip-box>div {
  margin: 4px 0
}

.apexcharts-tooltip-box span.value {
  font-weight: 700
}

.apexcharts-tooltip-rangebar {
  padding: 5px 8px
}

.apexcharts-tooltip-rangebar .category {
  font-weight: 600;
  color: #777
}

.apexcharts-tooltip-rangebar .series-name {
  font-weight: 700;
  display: block;
  margin-bottom: 5px
}

.apexcharts-xaxistooltip,
.apexcharts-yaxistooltip {
  opacity: 0;
  pointer-events: none;
  color: #373d3f;
  font-size: 13px;
  text-align: center;
  border-radius: 2px;
  position: absolute;
  z-index: 10;
  background: #eceff1;
  border: 1px solid #90a4ae
}

.apexcharts-xaxistooltip {
  padding: 9px 10px;
  transition: .15s ease all
}

.apexcharts-xaxistooltip.apexcharts-theme-dark {
  background: rgba(0, 0, 0, .7);
  border: 1px solid rgba(0, 0, 0, .5);
  color: #fff
}

.apexcharts-xaxistooltip:after,
.apexcharts-xaxistooltip:before {
  left: 50%;
  border: solid transparent;
  content: " ";
  height: 0;
  width: 0;
  position: absolute;
  pointer-events: none
}

.apexcharts-xaxistooltip:after {
  border-color: transparent;
  border-width: 6px;
  margin-left: -6px
}

.apexcharts-xaxistooltip:before {
  border-color: transparent;
  border-width: 7px;
  margin-left: -7px
}

.apexcharts-xaxistooltip-bottom:after,
.apexcharts-xaxistooltip-bottom:before {
  bottom: 100%
}

.apexcharts-xaxistooltip-top:after,
.apexcharts-xaxistooltip-top:before {
  top: 100%
}

.apexcharts-xaxistooltip-bottom:after {
  border-bottom-color: #eceff1
}

.apexcharts-xaxistooltip-bottom:before {
  border-bottom-color: #90a4ae
}

.apexcharts-xaxistooltip-bottom.apexcharts-theme-dark:after,
.apexcharts-xaxistooltip-bottom.apexcharts-theme-dark:before {
  border-bottom-color: rgba(0, 0, 0, .5)
}

.apexcharts-xaxistooltip-top:after {
  border-top-color: #eceff1
}

.apexcharts-xaxistooltip-top:before {
  border-top-color: #90a4ae
}

.apexcharts-xaxistooltip-top.apexcharts-theme-dark:after,
.apexcharts-xaxistooltip-top.apexcharts-theme-dark:before {
  border-top-color: rgba(0, 0, 0, .5)
}

.apexcharts-xaxistooltip.apexcharts-active {
  opacity: 1;
  transition: .15s ease all
}

.apexcharts-yaxistooltip {
  padding: 4px 10px
}

.apexcharts-yaxistooltip.apexcharts-theme-dark {
  background: rgba(0, 0, 0, .7);
  border: 1px solid rgba(0, 0, 0, .5);
  color: #fff
}

.apexcharts-yaxistooltip:after,
.apexcharts-yaxistooltip:before {
  top: 50%;
  border: solid transparent;
  content: " ";
  height: 0;
  width: 0;
  position: absolute;
  pointer-events: none
}

.apexcharts-yaxistooltip:after {
  border-color: transparent;
  border-width: 6px;
  margin-top: -6px
}

.apexcharts-yaxistooltip:before {
  border-color: transparent;
  border-width: 7px;
  margin-top: -7px
}

.apexcharts-yaxistooltip-left:after,
.apexcharts-yaxistooltip-left:before {
  left: 100%
}

.apexcharts-yaxistooltip-right:after,
.apexcharts-yaxistooltip-right:before {
  right: 100%
}

.apexcharts-yaxistooltip-left:after {
  border-left-color: #eceff1
}

.apexcharts-yaxistooltip-left:before {
  border-left-color: #90a4ae
}

.apexcharts-yaxistooltip-left.apexcharts-theme-dark:after,
.apexcharts-yaxistooltip-left.apexcharts-theme-dark:before {
  border-left-color: rgba(0, 0, 0, .5)
}

.apexcharts-yaxistooltip-right:after {
  border-right-color: #eceff1
}

.apexcharts-yaxistooltip-right:before {
  border-right-color: #90a4ae
}

.apexcharts-yaxistooltip-right.apexcharts-theme-dark:after,
.apexcharts-yaxistooltip-right.apexcharts-theme-dark:before {
  border-right-color: rgba(0, 0, 0, .5)
}

.apexcharts-yaxistooltip.apexcharts-active {
  opacity: 1
}

.apexcharts-yaxistooltip-hidden {
  display: none
}

.apexcharts-xcrosshairs,
.apexcharts-ycrosshairs {
  pointer-events: none;
  opacity: 0;
  transition: .15s ease all
}

.apexcharts-xcrosshairs.apexcharts-active,
.apexcharts-ycrosshairs.apexcharts-active {
  opacity: 1;
  transition: .15s ease all
}

.apexcharts-ycrosshairs-hidden {
  opacity: 0
}

.apexcharts-selection-rect {
  cursor: move
}

.svg_select_shape {
  stroke-width: 1;
  stroke-dasharray: 10 10;
  stroke: black;
  stroke-opacity: 0.1;
  pointer-events: none;
  fill: none;
}

.svg_select_handle {
  stroke-width: 3;
  stroke: black;
  fill: none;
}

.svg_select_handle_r {
  cursor: e-resize;
}

.svg_select_handle_l {
  cursor: w-resize;
}

.apexcharts-svg.apexcharts-zoomable.hovering-zoom {
  cursor: crosshair
}

.apexcharts-svg.apexcharts-zoomable.hovering-pan {
  cursor: move
}

.apexcharts-menu-icon,
.apexcharts-pan-icon,
.apexcharts-reset-icon,
.apexcharts-selection-icon,
.apexcharts-toolbar-custom-icon,
.apexcharts-zoom-icon,
.apexcharts-zoomin-icon,
.apexcharts-zoomout-icon {
  cursor: pointer;
  width: 20px;
  height: 20px;
  line-height: 24px;
  color: #6e8192;
  text-align: center
}

.apexcharts-menu-icon svg,
.apexcharts-reset-icon svg,
.apexcharts-zoom-icon svg,
.apexcharts-zoomin-icon svg,
.apexcharts-zoomout-icon svg {
  fill: #6e8192
}

.apexcharts-selection-icon svg {
  fill: #444;
  transform: scale(.76)
}

.apexcharts-theme-dark .apexcharts-menu-icon svg,
.apexcharts-theme-dark .apexcharts-pan-icon svg,
.apexcharts-theme-dark .apexcharts-reset-icon svg,
.apexcharts-theme-dark .apexcharts-selection-icon svg,
.apexcharts-theme-dark .apexcharts-toolbar-custom-icon svg,
.apexcharts-theme-dark .apexcharts-zoom-icon svg,
.apexcharts-theme-dark .apexcharts-zoomin-icon svg,
.apexcharts-theme-dark .apexcharts-zoomout-icon svg {
  fill: #f3f4f5
}

.apexcharts-canvas .apexcharts-reset-zoom-icon.apexcharts-selected svg,
.apexcharts-canvas .apexcharts-selection-icon.apexcharts-selected svg,
.apexcharts-canvas .apexcharts-zoom-icon.apexcharts-selected svg {
  fill: #008ffb
}

.apexcharts-theme-light .apexcharts-menu-icon:hover svg,
.apexcharts-theme-light .apexcharts-reset-icon:hover svg,
.apexcharts-theme-light .apexcharts-selection-icon:not(.apexcharts-selected):hover svg,
.apexcharts-theme-light .apexcharts-zoom-icon:not(.apexcharts-selected):hover svg,
.apexcharts-theme-light .apexcharts-zoomin-icon:hover svg,
.apexcharts-theme-light .apexcharts-zoomout-icon:hover svg {
  fill: #333
}

.apexcharts-menu-icon,
.apexcharts-selection-icon {
  position: relative
}

.apexcharts-reset-icon {
  margin-left: 5px
}

.apexcharts-menu-icon,
.apexcharts-reset-icon,
.apexcharts-zoom-icon {
  transform: scale(.85)
}

.apexcharts-zoomin-icon,
.apexcharts-zoomout-icon {
  transform: scale(.7)
}

.apexcharts-zoomout-icon {
  margin-right: 3px
}

.apexcharts-pan-icon {
  transform: scale(.62);
  position: relative;
  left: 1px;
  top: 0
}

.apexcharts-pan-icon svg {
  fill: #fff;
  stroke: #6e8192;
  stroke-width: 2
}

.apexcharts-pan-icon.apexcharts-selected svg {
  stroke: #008ffb
}

.apexcharts-pan-icon:not(.apexcharts-selected):hover svg {
  stroke: #333
}

.apexcharts-toolbar {
  position: absolute;
  z-index: 11;
  max-width: 176px;
  text-align: right;
  border-radius: 3px;
  padding: 0 6px 2px;
  display: flex;
  justify-content: space-between;
  align-items: center
}

.apexcharts-menu {
  background: #fff;
  position: absolute;
  top: 100%;
  border: 1px solid #ddd;
  border-radius: 3px;
  padding: 3px;
  right: 10px;
  opacity: 0;
  min-width: 110px;
  transition: .15s ease all;
  pointer-events: none
}

.apexcharts-menu.apexcharts-menu-open {
  opacity: 1;
  pointer-events: all;
  transition: .15s ease all
}

.apexcharts-menu-item {
  padding: 6px 7px;
  font-size: 12px;
  cursor: pointer
}

.apexcharts-theme-light .apexcharts-menu-item:hover {
  background: #eee
}

.apexcharts-theme-dark .apexcharts-menu {
  background: rgba(0, 0, 0, .7);
  color: #fff
}

@media screen and (min-width:768px) {
  .apexcharts-canvas:hover .apexcharts-toolbar {
    opacity: 1
  }
}

.apexcharts-canvas .apexcharts-element-hidden,
.apexcharts-datalabel.apexcharts-element-hidden,
.apexcharts-hide .apexcharts-series-points {
  opacity: 0;
}

.apexcharts-hidden-element-shown {
  opacity: 1;
  transition: 0.25s ease all;
}

.apexcharts-datalabel,
.apexcharts-datalabel-label,
.apexcharts-datalabel-value,
.apexcharts-datalabels,
.apexcharts-pie-label {
  cursor: default;
  pointer-events: none
}

.apexcharts-pie-label-delay {
  opacity: 0;
  animation-name: opaque;
  animation-duration: .3s;
  animation-fill-mode: forwards;
  animation-timing-function: ease
}

.apexcharts-radialbar-label {
  cursor: pointer;
}

.apexcharts-annotation-rect,
.apexcharts-area-series .apexcharts-area,
.apexcharts-gridline,
.apexcharts-line,
.apexcharts-point-annotation-label,
.apexcharts-radar-series path:not(.apexcharts-marker),
.apexcharts-radar-series polygon,
.apexcharts-toolbar svg,
.apexcharts-tooltip .apexcharts-marker,
.apexcharts-xaxis-annotation-label,
.apexcharts-yaxis-annotation-label,
.apexcharts-zoom-rect,
.no-pointer-events {
  pointer-events: none
}

.apexcharts-tooltip-active .apexcharts-marker {
  transition: .15s ease all
}

.apexcharts-radar-series .apexcharts-yaxis {
  pointer-events: none;
}

.resize-triggers {
  animation: 1ms resizeanim;
  visibility: hidden;
  opacity: 0;
  height: 100%;
  width: 100%;
  overflow: hidden
}

.contract-trigger:before,
.resize-triggers,
.resize-triggers>div {
  content: " ";
  display: block;
  position: absolute;
  top: 0;
  left: 0
}

.resize-triggers>div {
  height: 100%;
  width: 100%;
  background: #eee;
  overflow: auto
}

.contract-trigger:before {
  overflow: hidden;
  width: 200%;
  height: 200%
}

.apexcharts-bar-goals-markers {
  pointer-events: none
}

.apexcharts-bar-shadows {
  pointer-events: none
}

.apexcharts-rangebar-goals-markers {
  pointer-events: none
}

.apexcharts-disable-transitions * {
  transition: none !important;
}`;var P=((k=t.opts.chart)===null||k===void 0?void 0:k.nonce)||t.w.config.chart.nonce;P&&E.setAttribute("nonce",P),v?_.prepend(E):t.w.config.chart.injectStyleSheet!==!1&&r.head.appendChild(E)}var L=t.create(t.w.config.series,{});if(!L)return a(t);t.mount(L).then(function(){typeof t.w.config.chart.events.mounted=="function"&&t.w.config.chart.events.mounted(t,t.w),t.events.fireEvent("mounted",[t,t.w]),a(L)}).catch(function(O){c(O)})}else c(new Error("Element not found"))})}},{key:"create",value:function(t,a){var c=this,f=this.w;new zw(this).initModules();var _=this.w.globals;if(_.noData=!1,_.animationEnded=!1,!et.elementExists(this.el)||(this.responsive.checkResponsiveConfig(a),f.config.xaxis.convertedCatToNumeric&&new Yf(f.config).convertCatToNumericXaxis(f.config,this.ctx),this.core.setupElements(),f.config.chart.type==="treemap"&&(f.config.grid.show=!1,f.config.yaxis[0].show=!1),_.svgWidth===0))return _.animationEnded=!0,null;var v=t;t.forEach(function(O,N){O.hidden&&(v=c.legend.legendHelpers.getSeriesAfterCollapsing({realIndex:N}))});var r=Is.checkComboSeries(v,f.config.chart.type);_.comboCharts=r.comboCharts,_.comboBarCount=r.comboBarCount;var E=v.every(function(O){return O.data&&O.data.length===0});(v.length===0||E&&_.collapsedSeries.length<1)&&this.series.handleNoData(),this.events.setupEventHandlers(),this.data.parseData(v),this.theme.init(),new Hu(this).setGlobalMarkerSize(),this.formatters.setLabelFormatters(),this.titleSubtitle.draw(),_.noData&&_.collapsedSeries.length!==_.series.length&&!f.config.legend.showForSingleSeries||this.legend.init(),this.series.hasAllSeriesEqualX(),_.axisCharts&&(this.core.coreCalculations(),f.config.xaxis.type!=="category"&&this.formatters.setLabelFormatters(),this.ctx.toolbar.minX=f.globals.minX,this.ctx.toolbar.maxX=f.globals.maxX),this.formatters.heatmapLabelFormatters(),new Is(this).getLargestMarkerSize(),this.dimensions.plotCoords();var k=this.core.xySettings();this.grid.createGridMask();var P=this.core.plotChartType(v,k),L=new Fu(this);return L.bringForward(),f.config.dataLabels.background.enabled&&L.dataLabelsBackground(),this.core.shiftGraphPosition(),f.globals.dataPoints>50&&f.globals.dom.elWrap.classList.add("apexcharts-disable-transitions"),{elGraph:P,xyRatios:k,dimensions:{plot:{left:f.globals.translateX,top:f.globals.translateY,width:f.globals.gridWidth,height:f.globals.gridHeight}}}}},{key:"mount",value:function(){var t=this,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,c=this,f=c.w;return new Promise(function(_,v){if(c.el===null)return v(new Error("Not enough data to display or target element not found"));(a===null||f.globals.allSeriesCollapsed)&&c.series.handleNoData(),c.grid=new C1(c);var r,E,k=c.grid.drawGrid();if(c.annotations=new RE(c),c.annotations.drawImageAnnos(),c.annotations.drawTextAnnos(),f.config.grid.position==="back"&&(k&&f.globals.dom.elGraphical.add(k.el),k!=null&&(r=k.elGridBorders)!==null&&r!==void 0&&r.node&&f.globals.dom.elGraphical.add(k.elGridBorders)),Array.isArray(a.elGraph))for(var P=0;P<a.elGraph.length;P++)f.globals.dom.elGraphical.add(a.elGraph[P]);else f.globals.dom.elGraphical.add(a.elGraph);f.config.grid.position==="front"&&(k&&f.globals.dom.elGraphical.add(k.el),k!=null&&(E=k.elGridBorders)!==null&&E!==void 0&&E.node&&f.globals.dom.elGraphical.add(k.elGridBorders)),f.config.xaxis.crosshairs.position==="front"&&c.crosshairs.drawXCrosshairs(),f.config.yaxis[0].crosshairs.position==="front"&&c.crosshairs.drawYCrosshairs(),f.config.chart.type!=="treemap"&&c.axes.drawAxis(f.config.chart.type,k);var L=new Zf(t.ctx,k),O=new mx(t.ctx,k);if(k!==null&&(L.xAxisLabelCorrections(k.xAxisTickWidth),O.setYAxisTextAlignments(),f.config.yaxis.map(function(G,H){f.globals.ignoreYAxisIndexes.indexOf(H)===-1&&O.yAxisTitleRotate(H,G.opposite)})),c.annotations.drawAxesAnnotations(),!f.globals.noData){if(f.config.tooltip.enabled&&!f.globals.noData&&c.w.globals.tooltip.drawTooltip(a.xyRatios),f.globals.axisCharts&&(f.globals.isXNumeric||f.config.xaxis.convertedCatToNumeric||f.globals.isRangeBar))(f.config.chart.zoom.enabled||f.config.chart.selection&&f.config.chart.selection.enabled||f.config.chart.pan&&f.config.chart.pan.enabled)&&c.zoomPanSelection.init({xyRatios:a.xyRatios});else{var N=f.config.chart.toolbar.tools;["zoom","zoomin","zoomout","selection","pan","reset"].forEach(function(G){N[G]=!1})}f.config.chart.toolbar.show&&!f.globals.allSeriesCollapsed&&c.toolbar.createToolbar()}f.globals.memory.methodsToExec.length>0&&f.globals.memory.methodsToExec.forEach(function(G){G.method(G.params,!1,G.context)}),f.globals.axisCharts||f.globals.noData||c.core.resizeNonAxisCharts(),_(c)})}},{key:"destroy",value:function(){window.removeEventListener("resize",this.windowResizeHandler),function(a,c){var f=zy.get(c);f&&(f.disconnect(),zy.delete(c))}(this.el.parentNode,this.parentResizeHandler);var t=this.w.config.chart.id;t&&Apex._chartInstances.forEach(function(a,c){a.id===et.escapeString(t)&&Apex._chartInstances.splice(c,1)}),new Rw(this.ctx).clear({isUpdating:!1})}},{key:"updateOptions",value:function(t){var a=this,c=arguments.length>1&&arguments[1]!==void 0&&arguments[1],f=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2],_=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3],v=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4],r=this.w;return r.globals.selection=void 0,this.lastUpdateOptions&&JSON.stringify(this.lastUpdateOptions)===JSON.stringify(t)?this:(t.series&&(this.data.resetParsingFlags(),this.series.resetSeries(!1,!0,!1),t.series.length&&t.series[0].data&&(t.series=t.series.map(function(E,k){return a.updateHelpers._extendSeries(E,k)})),this.updateHelpers.revertDefaultAxisMinMax()),t.xaxis&&(t=this.updateHelpers.forceXAxisUpdate(t)),t.yaxis&&(t=this.updateHelpers.forceYAxisUpdate(t)),r.globals.collapsedSeriesIndices.length>0&&this.series.clearPreviousPaths(),t.theme&&(t=this.theme.updateThemeOptions(t)),this.updateHelpers._updateOptions(t,c,f,_,v))}},{key:"updateSeries",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],a=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],c=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2];return this.data.resetParsingFlags(),this.series.resetSeries(!1),this.updateHelpers.revertDefaultAxisMinMax(),this.updateHelpers._updateSeries(t,a,c)}},{key:"appendSeries",value:function(t){var a=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],c=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2];this.data.resetParsingFlags();var f=this.w.config.series.slice();return f.push(t),this.series.resetSeries(!1),this.updateHelpers.revertDefaultAxisMinMax(),this.updateHelpers._updateSeries(f,a,c)}},{key:"appendData",value:function(t){var a=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],c=this;c.data.resetParsingFlags(),c.w.globals.dataChanged=!0,c.series.getPreviousPaths();for(var f=c.w.config.series.slice(),_=0;_<f.length;_++)if(t[_]!==null&&t[_]!==void 0)for(var v=0;v<t[_].data.length;v++)f[_].data.push(t[_].data[v]);return c.w.config.series=f,a&&(c.w.globals.initialSeries=et.clone(c.w.config.series)),this.update()}},{key:"update",value:function(t){var a=this;return new Promise(function(c,f){if(a.lastUpdateOptions&&JSON.stringify(a.lastUpdateOptions)===JSON.stringify(t))return c(a);a.lastUpdateOptions=et.clone(t),new Rw(a.ctx).clear({isUpdating:!0});var _=a.create(a.w.config.series,t);if(!_)return c(a);a.mount(_).then(function(){typeof a.w.config.chart.events.updated=="function"&&a.w.config.chart.events.updated(a,a.w),a.events.fireEvent("updated",[a,a.w]),a.w.globals.isDirty=!0,c(a)}).catch(function(v){f(v)})})}},{key:"getSyncedCharts",value:function(){var t=this.getGroupedCharts(),a=[this];return t.length&&(a=[],t.forEach(function(c){a.push(c)})),a}},{key:"getGroupedCharts",value:function(){var t=this;return Apex._chartInstances.filter(function(a){if(a.group)return!0}).map(function(a){return t.w.config.chart.group===a.group?a.chart:t})}},{key:"toggleSeries",value:function(t){return this.series.toggleSeries(t)}},{key:"highlightSeriesOnLegendHover",value:function(t,a){return this.series.toggleSeriesOnHover(t,a)}},{key:"showSeries",value:function(t){this.series.showSeries(t)}},{key:"hideSeries",value:function(t){this.series.hideSeries(t)}},{key:"highlightSeries",value:function(t){this.series.highlightSeries(t)}},{key:"isSeriesHidden",value:function(t){this.series.isSeriesHidden(t)}},{key:"resetSeries",value:function(){var t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0],a=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];this.series.resetSeries(t,a)}},{key:"addEventListener",value:function(t,a){this.events.addEventListener(t,a)}},{key:"removeEventListener",value:function(t,a){this.events.removeEventListener(t,a)}},{key:"addXaxisAnnotation",value:function(t){var a=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0,f=this;c&&(f=c),f.annotations.addXaxisAnnotationExternal(t,a,f)}},{key:"addYaxisAnnotation",value:function(t){var a=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0,f=this;c&&(f=c),f.annotations.addYaxisAnnotationExternal(t,a,f)}},{key:"addPointAnnotation",value:function(t){var a=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0,f=this;c&&(f=c),f.annotations.addPointAnnotationExternal(t,a,f)}},{key:"clearAnnotations",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:void 0,a=this;t&&(a=t),a.annotations.clearAnnotations(a)}},{key:"removeAnnotation",value:function(t){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:void 0,c=this;a&&(c=a),c.annotations.removeAnnotation(c,t)}},{key:"getChartArea",value:function(){return this.w.globals.dom.baseEl.querySelector(".apexcharts-inner")}},{key:"getSeriesTotalXRange",value:function(t,a){return this.coreUtils.getSeriesTotalsXRange(t,a)}},{key:"getHighestValueInSeries",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return new Zy(this.ctx).getMinYMaxY(t).highestY}},{key:"getLowestValueInSeries",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return new Zy(this.ctx).getMinYMaxY(t).lowestY}},{key:"getSeriesTotal",value:function(){return this.w.globals.seriesTotals}},{key:"toggleDataPointSelection",value:function(t,a){return this.updateHelpers.toggleDataPointSelection(t,a)}},{key:"zoomX",value:function(t,a){this.ctx.toolbar.zoomUpdateOptions(t,a)}},{key:"setLocale",value:function(t){this.localization.setCurrentLocaleValues(t)}},{key:"dataURI",value:function(t){return new Hf(this.ctx).dataURI(t)}},{key:"getSvgString",value:function(t){return new Hf(this.ctx).getSvgString(t)}},{key:"exportToCSV",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return new Hf(this.ctx).exportToCSV(t)}},{key:"paper",value:function(){return this.w.globals.dom.Paper}},{key:"_parentResizeCallback",value:function(){this.w.globals.animationEnded&&this.w.config.chart.redrawOnParentResize&&this._windowResize()}},{key:"_windowResize",value:function(){var t=this;clearTimeout(this.w.globals.resizeTimer),this.w.globals.resizeTimer=window.setTimeout(function(){t.w.globals.resized=!0,t.w.globals.dataChanged=!1,t.ctx.update()},150)}},{key:"_windowResizeHandler",value:function(){var t=this.w.config.chart.redrawOnWindowResize;typeof t=="function"&&(t=t()),t&&this._windowResize()}}],[{key:"getChartByID",value:function(t){var a=et.escapeString(t);if(Apex._chartInstances){var c=Apex._chartInstances.filter(function(f){return f.id===a})[0];return c&&c.chart}}},{key:"initOnLoad",value:function(){for(var t=document.querySelectorAll("[data-apexcharts]"),a=0;a<t.length;a++)new S(t[a],JSON.parse(t[a].getAttribute("data-options"))).render()}},{key:"exec",value:function(t,a){var c=this.getChartByID(t);if(c){c.w.globals.isExecCalled=!0;var f=null;if(c.publicMethods.indexOf(a)!==-1){for(var _=arguments.length,v=new Array(_>2?_-2:0),r=2;r<_;r++)v[r-2]=arguments[r];f=c[a].apply(c,v)}return f}}},{key:"merge",value:function(t,a){return et.extend(t,a)}},{key:"getThemePalettes",value:function(){return{palette1:["#008FFB","#00E396","#FEB019","#FF4560","#775DD0"],palette2:["#3F51B5","#03A9F4","#4CAF50","#F9CE1D","#FF9800"],palette3:["#33B2DF","#546E7A","#D4526E","#13D8AA","#A5978B"],palette4:["#4ECDC4","#C7F464","#81D4FA","#FD6A6A","#546E7A"],palette5:["#2B908F","#F9A3A4","#90EE7E","#FA4443","#69D2E7"],palette6:["#449DD1","#F86624","#EA3546","#662E9B","#C5D86D"],palette7:["#D7263D","#1B998B","#2E294E","#F46036","#E2C044"],palette8:["#662E9B","#F86624","#F9C80E","#EA3546","#43BCCD"],palette9:["#5C4742","#A5978B","#8D5B4C","#5A2A27","#C4BBAF"],palette10:["#A300D6","#7D02EB","#5653FE","#2983FF","#00B1F2"]}}}]),S}();window.ApexCharts=pC;class Dw{constructor(t){this.map=null,this.simpleBarInstances=[],this.themeVerificationTimeout=null,this.systemThemeListener=null,this.config=t,this.init()}init(){this.setupEventListeners(),this.initializeComponents(),this.initializeSimpleBar(),this.setupHorizontalMenu(),this.setupVerticalMenu(),this.setupMainSearchBar(),setTimeout(()=>{this.initializeCharts()},100)}setupEventListeners(){const t=document.querySelector(".btn-toggle"),a=document.querySelector(".sidebar-wrapper"),c=document.querySelector(".overlay");if(t&&a){let _=null,v=null;this.restoreSidebarToggleState(),t.addEventListener("click",r=>{r.preventDefault();const E=document.body;if(a.querySelectorAll(".collapse.show").forEach(P=>{if(!P.querySelector(".active")){let O=window.bootstrap.Collapse.getInstance(P);O||(O=new window.bootstrap.Collapse(P,{toggle:!1})),O.hide()}}),window.innerWidth<1200){a.classList.toggle("mobile-open"),t.classList.toggle("active"),c&&(a.classList.contains("mobile-open")?(c.style.display="block",setTimeout(()=>{c.style.opacity="1",c.style.visibility="visible",this.expandActiveMenuItems()},10)):(c.style.opacity="0",c.style.visibility="hidden",setTimeout(()=>{c.style.display="none"},300)));return}E.classList.contains("toggled")?(E.classList.remove("toggled"),t.classList.remove("active"),localStorage.setItem("sidebar-toggled","false"),_&&v&&(a.removeEventListener("mouseenter",_),a.removeEventListener("mouseleave",v))):(E.classList.add("toggled"),t.classList.add("active"),localStorage.setItem("sidebar-toggled","true"),_=()=>{E.classList.add("sidebar-hovered"),this.expandActiveMenuItems()},v=()=>E.classList.remove("sidebar-hovered"),a.addEventListener("mouseenter",_),a.addEventListener("mouseleave",v))})}c&&c.addEventListener("click",()=>{document.body.classList.remove("toggled","sidebar-hovered"),t&&t.classList.remove("active"),window.innerWidth>=1200&&localStorage.setItem("sidebar-toggled","false"),a&&(a.classList.remove("mobile-open"),c.style.opacity="0",c.style.visibility="hidden",setTimeout(()=>{c.style.display="none"},300))});const f=document.querySelector(".sidebar-close");f&&f.addEventListener("click",()=>{document.body.classList.remove("toggled","sidebar-hovered"),t&&t.classList.remove("active"),window.innerWidth>=1200&&localStorage.setItem("sidebar-toggled","false"),a&&(a.classList.remove("mobile-open"),c&&(c.style.opacity="0",c.style.visibility="hidden",setTimeout(()=>{c.style.display="none"},300)))}),document.addEventListener("click",_=>{const v=_.target;window.innerWidth<1200&&!(a!=null&&a.contains(v))&&!(t!=null&&t.contains(v))&&a&&a.classList.contains("mobile-open")&&(a.classList.remove("mobile-open"),t&&t.classList.remove("active"),window.innerWidth>=1200&&localStorage.setItem("sidebar-toggled","false"),c&&(c.style.opacity="0",c.style.visibility="hidden",setTimeout(()=>{c.style.display="none"},300)))}),window.addEventListener("resize",()=>{this.handleResize()}),this.setupChartPeriodButtons()}initializeComponents(){[].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]')).map(c=>new window.bootstrap.Popover(c)),[].slice.call(document.querySelectorAll(".dropdown-toggle")).map(c=>new window.bootstrap.Dropdown(c)),this.initializeDynamicDropdownPositioning(),this.initializeMobileMenuBodyClass()}initializeDynamicDropdownPositioning(){console.log("Dynamic dropdown positioning initialized"),document.addEventListener("show.bs.dropdown",function(t){console.log("Bootstrap dropdown show event:",t);const a=t.target,c=a.closest(".dropdown"),f=c?c.querySelector(".dropdown-menu"):null;console.log("Toggle element:",a),console.log("Dropdown container:",c),console.log("Dropdown element:",f),f&&a&&!(c!=null&&c.classList.contains("dropdown-mega"))&&(c!=null&&c.closest(".hui-horizontal-scroll"))?(console.log("Processing regular dropdown positioning"),setTimeout(()=>{const _=a.getBoundingClientRect(),v=window.innerWidth,r=200;console.log("Toggle rect:",_);let E=_.left;E+r>v&&(E=v-r-10,console.log("Adjusted for right edge collision")),E<10&&(E=10,console.log("Adjusted for minimum left position")),f.style.left=`${E}px`,f.style.right="auto",console.log("Applied position:",E,"px from left"),console.log("Dropdown styles:",{left:f.style.left,right:f.style.right})},10)):console.log("Skipping - mega menu or missing elements")})}initializeMobileMenuBodyClass(){new MutationObserver(a=>{a.forEach(c=>{if(c.type==="attributes"&&c.attributeName==="style"){const f=document.body,_=f.getAttribute("style");_&&_.includes("overflow: hidden")?(console.log("Body style changed - offcanvas opened, adding mobile-menu-open class"),f.classList.add("mobile-menu-open")):(!_||!_.includes("overflow: hidden"))&&(console.log("Body style changed - offcanvas closed, removing mobile-menu-open class"),f.classList.remove("mobile-menu-open"))}})}).observe(document.body,{attributes:!0,attributeFilter:["style"]}),console.log("Started watching body for style changes")}setupVerticalMenu(){let t=!1;const a=()=>{const c=window.pageYOffset||document.documentElement.scrollTop;c>10&&!t?(document.body.classList.add("page-scrolled"),t=!0):c<=10&&t&&(document.body.classList.remove("page-scrolled"),t=!1)};window.addEventListener("scroll",a,{passive:!0}),a(),console.log("Vertical menu scroll listener initialized")}setupHorizontalMenu(){const t=document.querySelector(".hui-mega-menu"),a=document.querySelector(".ultravioletaction-bar");if(!t){console.log("Horizontal menu not found - skipping Headroom initialization");return}if(!(document.body.classList.contains("horizontal-layout")||document.querySelector(".hui-horizontal-scroll")||document.querySelector(".hui-mega-menu"))){console.log("Not using horizontal layout - skipping Headroom initialization");return}a&&a.classList.contains("fixed-to-top")?(window.headroomInstance=new Ow(t,{offset:100,tolerance:{up:5,down:0},classes:{initial:"hui-navbar",pinned:"hui-navbar--pinned",unpinned:"hui-navbar--unpinned",top:"hui-navbar--top"},onPin:function(){console.log("Headroom: Navbar pinned (visible)")},onUnpin:function(){console.log("Headroom: Navbar unpinned (hidden)")},onTop:function(){console.log("Headroom: At top of page")},onNotTop:function(){console.log("Headroom: Scrolled down from top")}}),window.headroomInstance.init(),console.log("HUI Horizontal Menu Layout Ready - Headroom initialized with smooth animations")):console.log("HUI Horizontal Menu Layout Ready - No headroom (scrollable header)")}initializeSimpleBar(){const t=document.querySelector(".sidebar-wrapper[data-simplebar]");if(t&&window.SimpleBar){const c=new Dy(t,{autoHide:!1,scrollbarMinSize:100,scrollbarMaxSize:300});this.simpleBarInstances.push(c)}document.querySelectorAll("[data-simplebar]:not(.sidebar-wrapper)").forEach(c=>{if(window.SimpleBar){const f=new Dy(c);this.simpleBarInstances.push(f)}})}setupChartPeriodButtons(){const t=document.querySelectorAll(".chart-period-btn");t.forEach(a=>{a.addEventListener("click",c=>{const f=c.target,_=f.getAttribute("data-period");t.forEach(v=>{v.classList.remove("btn-soft-primary","active"),v.classList.add("btn-soft-secondary")}),f.classList.remove("btn-soft-secondary"),f.classList.add("btn-soft-primary","active"),this.updateChartByPeriod(_)})})}updateChartByPeriod(t){const a=document.getElementById("chartdashboard");if(!a)return;const c=a.__apexChart;if(!c)return;let f=[],_=[],v=[],r=[];switch(t){case"1m":f=["Week 1","Week 2","Week 3","Week 4"],_=[18e3,22e3,19500,25e3],v=[3200,4200,3600,4800],r=[1100,1250,1180,1350];break;case"3m":f=["Oct","Nov","Dec"],_=[78e3,82e3,89e3],v=[14e3,16e3,18e3],r=[2400,2580,2750];break;case"6m":f=["Jul","Aug","Sep","Oct","Nov","Dec"],_=[72e3,68e3,75e3,82e3,78e3,89e3],v=[13e3,12e3,14e3,16e3,15e3,18e3],r=[1950,2100,2250,2400,2580,2750];break;default:f=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],_=[45e3,52e3,48e3,61e3,55e3,67e3,72e3,68e3,75e3,82e3,78e3,89e3],v=_.map(E=>Math.round(E*(.15+Math.random()*.1))),r=[1200,1350,1420,1580,1650,1820,1950,2100,2250,2400,2580,2750]}c.updateOptions({xaxis:{categories:f}}),c.updateSeries([{name:"Revenue",data:_},{name:"Profit",data:v},{name:"Users",data:r}])}initializeCharts(){this.waitForApexCharts().then(()=>{this.initializeDashboardChart()})}waitForApexCharts(){return new Promise(t=>{const a=()=>{typeof window.ApexCharts<"u"?t():setTimeout(a,100)};a()})}initializeDashboardChart(){const t=document.getElementById("chartdashboard");if(!t){console.warn("Chart container #chartdashboard not found - this is normal for pages without charts");return}console.log("Initializing dashboard chart..."),console.log("ApexCharts available:",typeof window.ApexCharts<"u");const a=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],c=[45e3,52e3,48e3,61e3,55e3,67e3,72e3,68e3,75e3,82e3,78e3,89e3],f=c.map(r=>Math.round(r*(.15+Math.random()*.1))),v={series:[{name:"Revenue",data:c,color:"#6366f1"},{name:"Profit",data:f,color:"#10b981"},{name:"Users",data:[1200,1350,1420,1580,1650,1820,1950,2100,2250,2400,2580,2750],color:"#f59e0b"}],chart:{type:"line",height:350,toolbar:{show:!0,tools:{download:!0,selection:!0,zoom:!0,zoomin:!0,zoomout:!0,pan:!0,reset:!0}},animations:{enabled:!0,easing:"easeinout",speed:800,animateGradually:{enabled:!0,delay:150},dynamicAnimation:{enabled:!0,speed:350}}},stroke:{curve:"smooth",width:[3,3,3],dashArray:[0,0,0]},markers:{size:[6,6,6],colors:["#6366f1","#10b981","#f59e0b"],strokeColors:"#fff",strokeWidth:2,hover:{size:8}},grid:{borderColor:"#e5e7eb",strokeDashArray:4,xaxis:{lines:{show:!0}},yaxis:{lines:{show:!0}},padding:{top:0,right:0,bottom:0,left:0}},xaxis:{categories:a,labels:{style:{colors:"#6b7280",fontSize:"12px",fontFamily:"Inter, sans-serif"}},axisBorder:{show:!1},axisTicks:{show:!1}},yaxis:[{title:{text:"Revenue & Profit ($)",style:{color:"#6b7280",fontSize:"12px",fontFamily:"Inter, sans-serif"}},labels:{style:{colors:"#6b7280",fontSize:"11px",fontFamily:"Inter, sans-serif"},formatter:function(r){return"$"+(r/1e3).toFixed(0)+"k"}}},{opposite:!0,title:{text:"Users",style:{color:"#6b7280",fontSize:"12px",fontFamily:"Inter, sans-serif"}},labels:{style:{colors:"#6b7280",fontSize:"11px",fontFamily:"Inter, sans-serif"},formatter:function(r){return r.toFixed(0)}}}],tooltip:{shared:!0,intersect:!1,style:{fontSize:"12px",fontFamily:"Inter, sans-serif"},x:{show:!1},y:[{formatter:function(r){return"$"+r.toLocaleString()}},{formatter:function(r){return"$"+r.toLocaleString()}},{formatter:function(r){return r.toLocaleString()+" users"}}]},legend:{position:"top",horizontalAlign:"right",floating:!0,offsetY:-25,offsetX:-5,fontSize:"12px",fontFamily:"Inter, sans-serif",markers:{width:8,height:8,radius:2}},fill:{type:"gradient",gradient:{shade:"light",type:"vertical",shadeIntensity:.25,gradientToColors:["#8b5cf6","#34d399","#fbbf24"],inverseColors:!1,opacityFrom:.1,opacityTo:.1,stops:[0,100]}},responsive:[{breakpoint:1024,options:{chart:{height:300},legend:{position:"bottom"}}},{breakpoint:768,options:{chart:{height:250},legend:{position:"bottom"},yaxis:[{labels:{formatter:function(r){return"$"+(r/1e3).toFixed(0)+"k"}}},{labels:{formatter:function(r){return r.toFixed(0)}}}]}}]};try{const r=window.ApexCharts,E=new r(t,v);E.render(),t.__apexChart=E,console.log("Chart rendered successfully")}catch(r){console.error("Error creating chart:",r)}}handleResize(){this.simpleBarInstances.forEach(t=>{t&&typeof t.recalculate=="function"&&t.recalculate()})}recalculateScrollbars(){this.handleResize()}updateDashboardChart(t){const a=document.getElementById("chartdashboard");if(!a)return;const c=a.__apexChart;c&&(c.updateSeries(t.series),t.categories&&c.updateOptions({xaxis:{categories:t.categories}}))}initializeMap(t){if(!this.config.mapboxToken){console.warn("Mapbox token not provided");return}Mu.accessToken=this.config.mapboxToken,this.map=new Mu.Map({container:t.container,style:t.style,center:t.center,zoom:t.zoom}),this.map.addControl(new Mu.NavigationControl),this.map.addControl(new Mu.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0,showUserHeading:!0}))}addMapMarker(t,a){if(!this.map)return;const c=new Mu.Marker().setLngLat(t).addTo(this.map);a&&c.setPopup(new Mu.Popup().setHTML(a))}setMapStyle(t){this.map&&this.map.setStyle(t)}openDemoHUDModal(t){const a=document.getElementById("demoCommandModal");if(a){const c=a.querySelector("#demoCommandName");c&&(c.textContent=t),typeof window.bootstrap<"u"&&new window.bootstrap.Modal(a).show()}}setupMainSearchBar(){const t=document.querySelector(".search-control"),a=document.querySelector(".search-popup"),c=document.querySelector(".search-close"),f=document.querySelector(".mobile-search-btn"),_=document.querySelector(".mobile-search-close");a&&(a.style.opacity="0",a.style.transform="translateY(-20px)",a.style.display="none",a.style.pointerEvents="none"),c&&(c.style.display="none");const v=()=>{if(!t||!c)return;t.value.trim().length>0?c.style.display="block":c.style.display="none"},r=()=>{a&&(document.readyState!=="complete"||window.performance.now()<1e3||(a.classList.remove("d-none"),a.style.display="block",a.style.visibility="visible",a.style.pointerEvents="auto",typeof window.anime<"u"?window.anime({targets:a,opacity:[0,1],translateY:[-20,0],duration:400,easing:"easeOutCubic"}):(a.style.transition="opacity 0.3s ease, transform 0.3s ease",requestAnimationFrame(()=>{a.style.opacity="1",a.style.transform="translateY(0)"}))))},E=()=>{a&&(typeof window.anime<"u"?window.anime({targets:a,opacity:[1,0],translateY:[0,-20],duration:300,easing:"easeInCubic",complete:()=>{a.classList.add("d-none"),a.style.display="none",a.style.visibility="hidden",a.style.pointerEvents="none"}}):(a.style.opacity="0",a.style.transform="translateY(-20px)",setTimeout(()=>{a.style.display="none",a.style.visibility="hidden",a.style.pointerEvents="none"},300)))};t&&a&&(console.log("search active"),t.addEventListener("click",r),t.addEventListener("input",v),t.addEventListener("focus",v)),c&&t&&c.addEventListener("click",N=>{N.stopPropagation(),t.value="",c.style.display="none",t.focus()}),f&&a&&f.addEventListener("click",r),_&&a&&_.addEventListener("click",E),document.addEventListener("click",N=>{if(a&&a.style.display==="block"){const G=N.target,H=a.contains(G),Q=t&&t.contains(G),ee=f&&f.contains(G);!H&&!Q&&!ee&&E()}});const k=document.getElementById("hud-scanner-canvas");if(k){let N=function(){if(!k)return;const ve=k.parentElement;ve&&(ie=ve.clientWidth,ue=ve.clientHeight,k.width=ie,k.height=ue)},G=function(){if(!H)return;H.clearRect(0,0,ie,ue);const ve=H.createLinearGradient(0,Q-20,0,Q+20);ve.addColorStop(0,"rgba(0, 190, 255, 0)"),ve.addColorStop(.5,"rgba(0, 190, 255, 0.7)"),ve.addColorStop(1,"rgba(0, 190, 255, 0)"),H.fillStyle=ve,H.fillRect(0,Q-20,ie,40),H.strokeStyle="rgba(0, 190, 255, 0.05)",H.lineWidth=1;for(let ce=0;ce<ue;ce+=20)H.beginPath(),H.moveTo(0,ce),H.lineTo(ie,ce),H.stroke();Q+=ee*(ue/200),Q>ue?(Q=ue,ee=-1):Q<0&&(Q=0,ee=1),requestAnimationFrame(G)};const H=k.getContext("2d");let Q=0,ee=1,ie=0,ue=0;N(),window.addEventListener("resize",N),G()}else console.warn("Canvas element #hud-scanner-canvas not found.");document.querySelectorAll(".command-list-item").forEach(N=>{N.addEventListener("click",G=>{var Q;G.preventDefault(),E();const H=((Q=N.querySelector(".command-name"))==null?void 0:Q.textContent)||"Unknown Command";this.openDemoHUDModal(H)})});const L=document.getElementById("hud-search"),O=document.getElementById("command-list");if(L&&O){const N=O.getElementsByTagName("li");L.addEventListener("input",G=>{var ee,ie,ue,ve;const Q=G.target.value.toLowerCase();for(let ce of N){const Te=((ie=(ee=ce.querySelector(".command-name"))==null?void 0:ee.textContent)==null?void 0:ie.toLowerCase())||"",Se=((ve=(ue=ce.querySelector(".command-desc"))==null?void 0:ue.textContent)==null?void 0:ve.toLowerCase())||"";Te.includes(Q)||Se.includes(Q)?ce.style.display="flex":ce.style.display="none"}})}else console.log("Command palette not found - this is normal for pages without command palette")}expandActiveMenuItems(){document.querySelectorAll(".hui-admin-menu .active").forEach(a=>{var f;let c=a.closest("li");for(;c&&!c.closest(".hui-admin-menu > li");)c=((f=c.parentElement)==null?void 0:f.closest("li"))||null;if(c){const _=c.querySelector(".collapse");_&&!_.classList.contains("show")&&new window.bootstrap.Collapse(_,{show:!0});const v=c.querySelector("a");v&&(c.classList.add("mm-active"),v.setAttribute("aria-expanded","true"))}})}restoreSidebarToggleState(){const t=document.querySelector(".btn-toggle"),a=document.querySelector(".sidebar-wrapper"),c=document.body;if(!t||!a||window.innerWidth<1200)return;if(localStorage.getItem("sidebar-toggled")==="true"){c.classList.add("toggled"),t.classList.add("active");const _=()=>{c.classList.add("sidebar-hovered"),this.expandActiveMenuItems()},v=()=>c.classList.remove("sidebar-hovered");a.addEventListener("mouseenter",_),a.addEventListener("mouseleave",v),console.log("Sidebar toggle state restored: toggled")}else console.log("Sidebar toggle state restored: expanded")}}class gC{static showLoading(t){t.classList.add("loading")}static hideLoading(t){t.classList.remove("loading")}static updateTable(t,a){document.getElementById(a)&&console.log("Updating table with data:",t)}static recalculateScrollbars(){window.adminDashboard&&window.adminDashboard.recalculateScrollbars()}static reinitializeCodeHighlighting(){window.codeHighlighting&&window.codeHighlighting.reinitialize()}}document.addEventListener("DOMContentLoaded",()=>{const S={mapboxToken:window.MAPBOX_TOKEN,apiBaseUrl:window.API_BASE_URL||"/api",defaultTheme:"dark",themeTransitionDuration:300,defaultDirection:"ltr",defaultBackgroundAnimation:"wave-lines"};window.AdminDashboard=Dw,window.LivewireHelpers=gC;const t=new Dw(S);window.adminDashboard=t,!window.codeHighlighting&&window.CodeHighlighting&&(window.codeHighlighting=new window.CodeHighlighting);const a=document.querySelector('[data-bs-title="Toggle Fixed Header"]');if(a){const N=document.querySelector(".ultraviolet-action-bar"),G=a.querySelector(".material-symbols-rounded");a.addEventListener("click",function(H){if(H.preventDefault(),N){N.classList.toggle("fixed-to-top"),G&&G.classList.toggle("text-primary"),this.classList.toggle("bg-info"),document.body.classList.toggle("fixed-top-header");const Q=N.classList.contains("fixed-to-top"),ee=document.querySelector(".hui-mega-menu");console.log("Toggle clicked - headroom handling:",{isFixed:Q,navbarExists:!!ee,currentHeadroomInstance:!!window.headroomInstance}),ee?Q?(console.log("Attempting to initialize headroom..."),window.headroomInstance?console.log("Headroom instance already exists"):(window.headroomInstance=new Ow(ee,{offset:100,tolerance:{up:5,down:0},classes:{initial:"hui-navbar",pinned:"hui-navbar--pinned",unpinned:"hui-navbar--unpinned",top:"hui-navbar--top"},onPin:function(){console.log("Headroom: Navbar pinned (visible)")},onUnpin:function(){console.log("Headroom: Navbar unpinned (hidden)")},onTop:function(){console.log("Headroom: At top of page")},onNotTop:function(){console.log("Headroom: Scrolled down from top")}}),window.headroomInstance.init(),console.log("Headroom initialized successfully! Classes:",ee.className))):window.headroomInstance&&(console.log("Destroying headroom..."),window.headroomInstance.destroy(),window.headroomInstance=null,console.log("Headroom destroyed (scrollable header mode)")):console.log("ERROR: navbar (.hui-mega-menu) not found!")}})}console.log("Admin Dashboard initialized (TypeScript/Livewire Version)");const c=document.getElementById("admin-settings-toggle"),f=document.getElementById("admin-settings-menu");let _=!1;console.log("Settings menu elements:",{settingsToggle:c,settingsMenu:f}),c&&f&&(console.log("Settings menu initialized - adding click listener"),c.addEventListener("click",N=>{N.preventDefault(),console.log("Settings toggle clicked!"),_=!_,console.log("Menu should be:",_?"open":"closed"),_?f.classList.add("show"):f.classList.remove("show")}),document.addEventListener("click",N=>{_&&!f.contains(N.target)&&!c.contains(N.target)&&(_=!1,f.classList.remove("show"))}));function v(N=!1){var Q;const G=document.getElementById("admin-rtl-switch");if(!G)return;const H=G.cloneNode(!0);if((Q=G.parentNode)==null||Q.replaceChild(H,G),N){const ee=new URLSearchParams(window.location.search),ie=ee.get("text")==="rtl",ue=ee.get("text")==="ltr",ve=localStorage.getItem("rtl-preference")==="true";let ce;ie||ue?ce=ie:ce=ve,H.checked=ce,r(ce),ie?localStorage.setItem("rtl-preference","true"):ee.get("text")==="ltr"&&localStorage.setItem("rtl-preference","false"),console.log("RTL toggle initialized (initial load):",{isRTL:ce,urlRTL:ie,urlLTR:ue,savedRTL:ve})}else{const ee=document.documentElement.getAttribute("dir")==="rtl";H.checked=ee,console.log("RTL toggle synced with current state:",ee)}H.addEventListener("change",ee=>{const ie=ee.target.checked;console.log("RTL toggle changed:",ie),ee.stopPropagation();const ue=new URL(window.location.href);ue.searchParams.set("text",ie?"rtl":"ltr"),window.location.href=ue.toString()})}v(!0),typeof window.Livewire<"u"&&window.Livewire.hook("morph.updated",()=>{console.log("Livewire updated, re-initializing RTL toggle"),setTimeout(()=>v(!1),100)});function r(N){const G=document.documentElement,H=document.body;N?(G.setAttribute("dir","rtl"),G.setAttribute("lang","ar"),H.classList.add("rtl"),H.classList.remove("ltr"),E()):(G.setAttribute("dir","ltr"),G.setAttribute("lang","en"),H.classList.add("ltr"),H.classList.remove("rtl"),k()),console.log(`RTL mode ${N?"enabled":"disabled"}`,{htmlDir:G.getAttribute("dir"),bodyClasses:H.className,htmlLang:G.getAttribute("lang")})}function E(){k();const N=document.createElement("style");N.id="rtl-styles",N.textContent=`
      [dir="rtl"] {
        direction: rtl !important;
        text-align: right !important;
      }
      
      [dir="rtl"] .card,
      [dir="rtl"] .card-body,
      [dir="rtl"] .card-header,
      [dir="rtl"] .card-footer,
      [dir="rtl"] .navbar,
      [dir="rtl"] .navbar-nav,
      [dir="rtl"] .nav-link,
      [dir="rtl"] .dropdown-menu,
      [dir="rtl"] .btn,
      [dir="rtl"] .form-control,
      [dir="rtl"] .form-label,
      [dir="rtl"] .table,
      [dir="rtl"] .table th,
      [dir="rtl"] .table td,
      [dir="rtl"] .breadcrumb,
      [dir="rtl"] .breadcrumb-item,
      [dir="rtl"] .list-group,
      [dir="rtl"] .list-group-item,
      [dir="rtl"] .modal-content,
      [dir="rtl"] .modal-header,
      [dir="rtl"] .modal-body,
      [dir="rtl"] .modal-footer,
      [dir="rtl"] .alert,
      [dir="rtl"] .badge,
      [dir="rtl"] .progress,
      [dir="rtl"] .sidebar-wrapper,
      [dir="rtl"] .ultraviolet-action-bar,
      [dir="rtl"] .ultraviolet-content,
      [dir="rtl"] .page-breadcrumb,
      [dir="rtl"] .row,
      [dir="rtl"] .col,
      [dir="rtl"] .col-md-6,
      [dir="rtl"] .col-lg-4,
      [dir="rtl"] .col-xl-4,
      [dir="rtl"] .d-flex,
      [dir="rtl"] .justify-content-between,
      [dir="rtl"] .text-start,
      [dir="rtl"] .text-end,
      [dir="rtl"] .ms-auto,
      [dir="rtl"] .me-auto,
      [dir="rtl"] .float-start,
      [dir="rtl"] .float-end,
      [dir="rtl"] .nav-pills,
      [dir="rtl"] .nav-link,
      [dir="rtl"] .form-select,
      [dir="rtl"] .form-label,
      [dir="rtl"] .offcanvas,
      [dir="rtl"] .offcanvas-header,
      [dir="rtl"] .offcanvas-body {
        direction: rtl !important;
        text-align: right !important;
      }
      
      /* Flip Bootstrap spacing classes for RTL */
      [dir="rtl"] .ms-auto {
        margin-left: auto !important;
        margin-right: 0 !important;
      }
      
      [dir="rtl"] .me-auto {
        margin-left: 0 !important;
        margin-right: auto !important;
      }
      
      [dir="rtl"] .text-start {
        text-align: right !important;
      }
      
      [dir="rtl"] .text-end {
        text-align: left !important;
      }
      
      [dir="rtl"] .float-start {
        float: right !important;
      }
      
      [dir="rtl"] .float-end {
        float: left !important;
      }
      
      /* Fix main content area padding for RTL - be more specific to avoid conflicts */
      [dir="rtl"] .ultraviolet-main-wrapper {
        margin-left: 0 !important;
        margin-right: 280px !important;
      }
      
      [dir="rtl"] body.toggled .ultraviolet-main-wrapper {
        margin-left: 0 !important;
        margin-right: 80px !important;
      }
      
      /* Fix sidebar positioning for RTL */
      [dir="rtl"] .sidebar-wrapper {
        right: 0 !important;
        left: auto !important;
      }
      
      /* Fix page action bar layout for RTL - reverse the flex order */
      [dir="rtl"] .page-actions {
        direction: rtl !important;
        flex-direction: row-reverse !important;
      }
      
      /* Keep breadcrumb on the right side in RTL */
      [dir="rtl"] .page-breadcrumb {
        direction: rtl !important;
        text-align: right !important;
        margin-left: auto !important;
        margin-right: 0 !important;
      }
      
      /* Keep action buttons on the left side in RTL */
      [dir="rtl"] .page-actions .dropdown,
      [dir="rtl"] .page-actions .btn,
      [dir="rtl"] .page-actions .form-control,
      [dir="rtl"] .page-actions .input-group {
        direction: rtl !important;
        text-align: right !important;
        margin-left: 0 !important;
        margin-right: auto !important;
      }
      
      /* Fix page actions container positioning for RTL */
      [dir="rtl"] .ms-auto {
        margin-left: 0 !important;
        margin-right: auto !important;
      }
      
      /* Specifically fix the page actions wrapper */
      [dir="rtl"] .page-actions,
      [dir="rtl"] .page-actions.ms-auto {
        margin-left: 0 !important;
        margin-right: auto !important;
      }
      
      /* Fix dropdown positioning for RTL */
      [dir="rtl"] .dropdown-menu {
        right: 0 !important;
        left: auto !important;
        text-align: right !important;
      }
      
      [dir="rtl"] .dropdown-menu-end {
        right: auto !important;
        left: 0 !important;
      }
      
      /* Fix user dropdown in action bar for RTL */
      [dir="rtl"] .ultraviolet-action-bar .dropdown-menu,
      [dir="rtl"] .navbar .dropdown-menu {
        right: auto !important;
        left: 0 !important;
        transform: translateX(0) !important;
      }
      
      /* Fix dropdown positioning for navbar items */
      [dir="rtl"] .navbar-nav .dropdown-menu {
        right: auto !important;
        left: 0 !important;
      }
      
      /* Fix notifications dropdown for RTL */
      [dir="rtl"] .dropdown-notify {
        right: auto !important;
        left: 0 !important;
        transform: translateX(0) !important;
      }
      
      /* Fix notifications dropdown positioning in action bar */
      [dir="rtl"] .ultraviolet-action-bar .dropdown-notify {
        right: auto !important;
        left: 0 !important;
        transform: translateX(0) !important;
      }
      
      /* Fix positioning classes for RTL */
      [dir="rtl"] .position-absolute.end-0 {
        right: auto !important;
        left: 0 !important;
      }
      
      [dir="rtl"] .position-absolute.start-0 {
        right: 0 !important;
        left: auto !important;
      }
      
      /* Fix notify close buttons positioning in RTL */
      [dir="rtl"] .notify-close.position-absolute.end-0 {
        right: auto !important;
        left: 0 !important;
      }
      
      /* Fix button groups and form controls in action bar */
      [dir="rtl"] .btn-group,
      [dir="rtl"] .input-group,
      [dir="rtl"] .form-control,
      [dir="rtl"] .btn {
        direction: rtl !important;
        text-align: right !important;
      }
    `,document.head.appendChild(N)}function k(){const N=document.getElementById("rtl-styles");N&&N.remove()}const P=document.getElementById("admin-dark-mode-switch");if(P){const N=()=>window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",G=()=>{const ce=new URLSearchParams(window.location.search).get("theme");if(ce==="dark"||ce==="light")return ce;const Te=localStorage.getItem("theme-preference");return Te==="dark"||Te==="light"?Te:N()},H=ve=>{const ce=document.documentElement,Te=ce.getAttribute("data-bs-theme");if(Te!==ve)return console.warn(`Theme verification failed: expected ${ve}, got ${Te}`),!1;const Ie=getComputedStyle(ce).getPropertyValue("--bs-body-bg").trim(),Ue=ve==="dark",Ke=Ie.includes("#")&&parseInt(Ie.slice(1,3),16)<128;return Ue&&!Ke?(console.warn("Theme verification failed: dark theme but light background detected"),!1):!Ue&&Ke?(console.warn("Theme verification failed: light theme but dark background detected"),!1):!0},Q=(ve,ce=0)=>{const Te=ve?"dark":"light",Se=document.documentElement,Ie=3;t.themeVerificationTimeout&&clearTimeout(t.themeVerificationTimeout),Se.classList.add("theme-transitioning"),Se.setAttribute("data-bs-theme",Te),localStorage.setItem("theme-preference",Te);const Ue=new URL(window.location.href);if(Ue.searchParams.set("theme",Te),window.history.replaceState({},"",Ue.toString()),window.codeHighlighting&&window.codeHighlighting.loadPrismTheme&&window.codeHighlighting.loadPrismTheme(Te),window.adminBackgroundAnimations){const Ke=localStorage.getItem("admin-background-animation")||S.defaultBackgroundAnimation;window.adminBackgroundAnimations.switchAnimation(Ke)}console.log(`Theme switched to: ${Te} (attempt ${ce+1})`),t.themeVerificationTimeout=setTimeout(()=>{if(!H(Te)&&ce<Ie){console.warn(`Theme verification failed, retrying... (${ce+1}/${Ie})`),Se.removeAttribute("data-bs-theme"),setTimeout(()=>{Q(ve,ce+1)},100);return}setTimeout(()=>{Se.classList.remove("theme-transitioning")},S.themeTransitionDuration),window.dispatchEvent(new CustomEvent("themeChanged",{detail:{theme:Te,isDark:ve,verified:!0}})),console.log(`Theme successfully applied: ${Te}`)},50)},ee=G(),ie=ee==="dark";P.checked=ie;const ue=document.documentElement.getAttribute("data-bs-theme");if((!ue||ue!==ee)&&document.documentElement.setAttribute("data-bs-theme",ee),window.codeHighlighting&&window.codeHighlighting.loadPrismTheme&&window.codeHighlighting.loadPrismTheme(ee),P.addEventListener("change",ve=>{const ce=ve.target.checked;Q(ce)}),window.matchMedia){const ve=window.matchMedia("(prefers-color-scheme: dark)"),ce=Te=>{if(!localStorage.getItem("theme-preference")){const Ie=Te.matches;P.checked=Ie,Q(Ie),console.log("System theme changed, auto-switching to:",Ie?"dark":"light")}};ve.addEventListener("change",ce),t.systemThemeListener=ce}console.log("Theme system initialized:",{initialTheme:ee,isDark:ie,systemPreference:N(),toggleFound:!0,hasSystemListener:!!window.matchMedia})}if(document.getElementById("admin-background")){const N=new v2;window.adminBackgroundAnimations=N;let G=localStorage.getItem("admin-background-animation")||"wave-lines";G==="cosmic-wave"&&(G="node-lines",localStorage.setItem("admin-background-animation","node-lines")),N.init("admin-background",G);const H=document.getElementById("admin-background-select");H&&(H.value=G,H.addEventListener("change",Q=>{const ee=Q.target.value;N.switchAnimation(ee),localStorage.setItem("admin-background-animation",ee),console.log(`Background animation switched to: ${ee}`)})),console.log("Background animations initialized:",G)}document.getElementById("map")&&S.mapboxToken&&t.initializeMap({container:"map",style:"mapbox://styles/mapbox/streets-v12",center:[-74.006,40.7128],zoom:10}),setTimeout(()=>{const N=document.getElementById("chartdashboard");if(N&&!N.__apexChart&&(console.log("Attempting fallback chart initialization..."),typeof window.ApexCharts<"u")){const G=window.ApexCharts,H={series:[{name:"Revenue",data:[45e3,52e3,48e3,61e3,55e3,67e3,72e3,68e3,75e3,82e3,78e3,89e3]}],chart:{type:"line",height:350},xaxis:{categories:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]}},Q=new G(N,H);Q.render(),N.__apexChart=Q,console.log("Fallback chart rendered successfully")}},2e3)});document.addEventListener("DOMContentLoaded",function(){if(document.body.classList.contains("horizontal-menu")){const S=document.getElementById("mainNavContent");S&&(S.addEventListener("show.bs.offcanvas",function(){document.body.classList.add("offcanvas-open")}),S.addEventListener("hide.bs.offcanvas",function(){document.body.classList.remove("offcanvas-open")}))}});export{_C as __vite_legacy_guard};
